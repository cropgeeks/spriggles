var fc=Object.defineProperty;var ec=qe=>{throw TypeError(qe)};var dc=(qe,f,ze)=>f in qe?fc(qe,f,{enumerable:!0,configurable:!0,writable:!0,value:ze}):qe[f]=ze;var yh=(qe,f,ze)=>dc(qe,typeof f!="symbol"?f+"":f,ze),Kh=(qe,f,ze)=>f.has(qe)||ec("Cannot "+ze);var Uh=(qe,f,ze)=>(Kh(qe,f,"read from private field"),ze?ze.call(qe):f.get(qe)),Zh=(qe,f,ze)=>f.has(qe)?ec("Cannot add the same private member more than once"):f instanceof WeakSet?f.add(qe):f.set(qe,ze),Hh=(qe,f,ze,Ke)=>(Kh(qe,f,"write to private field"),Ke?Ke.call(qe,ze):f.set(qe,ze),ze),Qh=(qe,f,ze)=>(Kh(qe,f,"access private method"),ze);import{i as includes,p as propsFactory,g as getCurrentInstanceName,t as toRef,b as toValue,u as useColor,a as createVNode,F as Fragment,e as genericComponent,m as makeThemeProps,f as makeTagProps,h as makeRoundedProps,j as makeElevationProps,k as makeComponentProps,l as makeBorderProps,n as provideTheme,q as useBorder,s as useElevation,v as useRounded,x as provideDefaults,y as useRender,z as getCurrentInstance,A as useId,B as provide,C as inject,D as computed,E as onBeforeUnmount,G as watch,H as reactive,I as useProxiedModel,J as onMounted,K as onUpdated,L as deepEqual,M as wrapInArray,N as findChildrenWithProvide,O as unref,P as mergeProps,Q as destructComputed,R as convertToUnit,S as shallowRef,T as useTheme,U as useIcon,W as useTextColor,X as flattenFragments,Y as Text,Z as IconValue,_ as ref,$ as SUPPORTS_INTERSECTION,a0 as useResizeObserver,a1 as watchEffect,a2 as useRtl,a3 as useBackgroundColor,a4 as clamp$1,a5 as IN_BROWSER,a6 as Transition,a7 as resolveDynamicComponent,a8 as hasEvent,a9 as nextTick,aa as isObject,ab as keyCodes,ac as useDimension,ad as withDirectives,ae as VDefaultsProvider,af as toDisplayString,ag as makeDimensionProps,d as defineComponent,ah as h$1,ai as VImg,aj as makeDisplayProps,ak as useDisplay,al as useGoTo,am as VFadeTransition,an as focusableChildren,ao as useLocale,ap as resolveDirective,aq as VExpandXTransition,ar as vShow,as as EventProp,at as MaybeTransition,au as makeTransitionProps,av as VSlideYTransition,aw as callEvent,ax as onBeforeMount,ay as useToggleScope,az as pick,aA as humanReadableFileSize,aB as filterInputAttrs,aC as useTemplateRef,aD as createElementBlock,o as openBlock,c as createBlock,aE as createCommentVNode,aF as createBaseVNode,aG as isRef,w as withCtx,aH as createTextVNode}from"./index-B4F76EGp.js";const block=["top","bottom"],inline=["start","end","left","right"];function parseAnchor(qe,f){let[ze,Ke]=qe.split(" ");return Ke||(Ke=includes(block,ze)?"start":includes(inline,ze)?"top":"center"),{side:toPhysical(ze,f),align:toPhysical(Ke,f)}}function toPhysical(qe,f){return qe==="start"?f?"right":"left":qe==="end"?f?"left":"right":qe}class Box{constructor(f){let{x:ze,y:Ke,width:Qe,height:Pi}=f;this.x=ze,this.y=Ke,this.width=Qe,this.height=Pi}get top(){return this.y}get bottom(){return this.y+this.height}get left(){return this.x}get right(){return this.x+this.width}}function nullifyTransforms(qe){const f=qe.getBoundingClientRect(),ze=getComputedStyle(qe),Ke=ze.transform;if(Ke){let Qe,Pi,nn,ln,cn;if(Ke.startsWith("matrix3d("))Qe=Ke.slice(9,-1).split(/, /),Pi=Number(Qe[0]),nn=Number(Qe[5]),ln=Number(Qe[12]),cn=Number(Qe[13]);else if(Ke.startsWith("matrix("))Qe=Ke.slice(7,-1).split(/, /),Pi=Number(Qe[0]),nn=Number(Qe[3]),ln=Number(Qe[4]),cn=Number(Qe[5]);else return new Box(f);const hn=ze.transformOrigin,un=f.x-ln-(1-Pi)*parseFloat(hn),xs=f.y-cn-(1-nn)*parseFloat(hn.slice(hn.indexOf(" ")+1)),zn=Pi?f.width/Pi:qe.offsetWidth+1,Xn=nn?f.height/nn:qe.offsetHeight+1;return new Box({x:un,y:xs,width:zn,height:Xn})}else return new Box(f)}function animate(qe,f,ze){if(typeof qe.animate>"u")return{finished:Promise.resolve()};let Ke;try{Ke=qe.animate(f,ze)}catch{return{finished:Promise.resolve()}}return typeof Ke.finished>"u"&&(Ke.finished=new Promise(Qe=>{Ke.onfinish=()=>{Qe(Ke)}})),Ke}const standardEasing="cubic-bezier(0.4, 0, 0.2, 1)",allowedDensities=[null,"default","comfortable","compact"],makeDensityProps=propsFactory({density:{type:String,default:"default",validator:qe=>allowedDensities.includes(qe)}},"density");function useDensity(qe){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:getCurrentInstanceName();return{densityClasses:toRef(()=>`${f}--density-${qe.density}`)}}const allowedVariants$1=["elevated","flat","tonal","outlined","text","plain"];function genOverlays(qe,f){return createVNode(Fragment,null,[qe&&createVNode("span",{key:"overlay",class:`${f}__overlay`},null),createVNode("span",{key:"underlay",class:`${f}__underlay`},null)])}const makeVariantProps=propsFactory({color:String,variant:{type:String,default:"elevated",validator:qe=>allowedVariants$1.includes(qe)}},"variant");function useVariant(qe){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:getCurrentInstanceName();const ze=toRef(()=>{const{variant:Pi}=toValue(qe);return`${f}--variant-${Pi}`}),{colorClasses:Ke,colorStyles:Qe}=useColor(()=>{const{variant:Pi,color:nn}=toValue(qe);return{[["elevated","flat"].includes(Pi)?"background":"text"]:nn}});return{colorClasses:Ke,colorStyles:Qe,variantClasses:ze}}const makeVBtnGroupProps=propsFactory({baseColor:String,divided:Boolean,...makeBorderProps(),...makeComponentProps(),...makeDensityProps(),...makeElevationProps(),...makeRoundedProps(),...makeTagProps(),...makeThemeProps(),...makeVariantProps()},"VBtnGroup"),VBtnGroup=genericComponent()({name:"VBtnGroup",props:makeVBtnGroupProps(),setup(qe,f){let{slots:ze}=f;const{themeClasses:Ke}=provideTheme(qe),{densityClasses:Qe}=useDensity(qe),{borderClasses:Pi}=useBorder(qe),{elevationClasses:nn}=useElevation(qe),{roundedClasses:ln}=useRounded(qe);provideDefaults({VBtn:{height:"auto",baseColor:toRef(()=>qe.baseColor),color:toRef(()=>qe.color),density:toRef(()=>qe.density),flat:!0,variant:toRef(()=>qe.variant)}}),useRender(()=>createVNode(qe.tag,{class:["v-btn-group",{"v-btn-group--divided":qe.divided},Ke.value,Pi.value,Qe.value,nn.value,ln.value,qe.class],style:qe.style},ze))}}),makeGroupProps=propsFactory({modelValue:{type:null,default:void 0},multiple:Boolean,mandatory:[Boolean,String],max:Number,selectedClass:String,disabled:Boolean},"group"),makeGroupItemProps=propsFactory({value:null,disabled:Boolean,selectedClass:String},"group-item");function useGroupItem(qe,f){let ze=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const Ke=getCurrentInstance("useGroupItem");if(!Ke)throw new Error("[Vuetify] useGroupItem composable must be used inside a component setup function");const Qe=useId();provide(Symbol.for(`${f.description}:id`),Qe);const Pi=inject(f,null);if(!Pi){if(!ze)return Pi;throw new Error(`[Vuetify] Could not find useGroup injection with symbol ${f.description}`)}const nn=toRef(()=>qe.value),ln=computed(()=>!!(Pi.disabled.value||qe.disabled));Pi.register({id:Qe,value:nn,disabled:ln},Ke),onBeforeUnmount(()=>{Pi.unregister(Qe)});const cn=computed(()=>Pi.isSelected(Qe)),hn=computed(()=>Pi.items.value[0].id===Qe),un=computed(()=>Pi.items.value[Pi.items.value.length-1].id===Qe),xs=computed(()=>cn.value&&[Pi.selectedClass.value,qe.selectedClass]);return watch(cn,zn=>{Ke.emit("group:selected",{value:zn})},{flush:"sync"}),{id:Qe,isSelected:cn,isFirst:hn,isLast:un,toggle:()=>Pi.select(Qe,!cn.value),select:zn=>Pi.select(Qe,zn),selectedClass:xs,value:nn,disabled:ln,group:Pi}}function useGroup(qe,f){let ze=!1;const Ke=reactive([]),Qe=useProxiedModel(qe,"modelValue",[],zn=>zn==null?[]:getIds(Ke,wrapInArray(zn)),zn=>{const Xn=getValues(Ke,zn);return qe.multiple?Xn:Xn[0]}),Pi=getCurrentInstance("useGroup");function nn(zn,Xn){const ys=zn,Jo=Symbol.for(`${f.description}:id`),ra=findChildrenWithProvide(Jo,Pi==null?void 0:Pi.vnode).indexOf(Xn);unref(ys.value)==null&&(ys.value=ra,ys.useIndexAsValue=!0),ra>-1?Ke.splice(ra,0,ys):Ke.push(ys)}function ln(zn){if(ze)return;cn();const Xn=Ke.findIndex(ys=>ys.id===zn);Ke.splice(Xn,1)}function cn(){const zn=Ke.find(Xn=>!Xn.disabled);zn&&qe.mandatory==="force"&&!Qe.value.length&&(Qe.value=[zn.id])}onMounted(()=>{cn()}),onBeforeUnmount(()=>{ze=!0}),onUpdated(()=>{for(let zn=0;zn<Ke.length;zn++)Ke[zn].useIndexAsValue&&(Ke[zn].value=zn)});function hn(zn,Xn){const ys=Ke.find(Jo=>Jo.id===zn);if(!(Xn&&(ys!=null&&ys.disabled)))if(qe.multiple){const Jo=Qe.value.slice(),ea=Jo.findIndex(na=>na===zn),ra=~ea;if(Xn=Xn??!ra,ra&&qe.mandatory&&Jo.length<=1||!ra&&qe.max!=null&&Jo.length+1>qe.max)return;ea<0&&Xn?Jo.push(zn):ea>=0&&!Xn&&Jo.splice(ea,1),Qe.value=Jo}else{const Jo=Qe.value.includes(zn);if(qe.mandatory&&Jo)return;Qe.value=Xn??!Jo?[zn]:[]}}function un(zn){if(qe.multiple,Qe.value.length){const Xn=Qe.value[0],ys=Ke.findIndex(ra=>ra.id===Xn);let Jo=(ys+zn)%Ke.length,ea=Ke[Jo];for(;ea.disabled&&Jo!==ys;)Jo=(Jo+zn)%Ke.length,ea=Ke[Jo];if(ea.disabled)return;Qe.value=[Ke[Jo].id]}else{const Xn=Ke.find(ys=>!ys.disabled);Xn&&(Qe.value=[Xn.id])}}const xs={register:nn,unregister:ln,selected:Qe,select:hn,disabled:toRef(()=>qe.disabled),prev:()=>un(Ke.length-1),next:()=>un(1),isSelected:zn=>Qe.value.includes(zn),selectedClass:toRef(()=>qe.selectedClass),items:toRef(()=>Ke),getItemIndex:zn=>getItemIndex(Ke,zn)};return provide(f,xs),xs}function getItemIndex(qe,f){const ze=getIds(qe,[f]);return ze.length?qe.findIndex(Ke=>Ke.id===ze[0]):-1}function getIds(qe,f){const ze=[];return f.forEach(Ke=>{const Qe=qe.find(nn=>deepEqual(Ke,nn.value)),Pi=qe[Ke];(Qe==null?void 0:Qe.value)!=null?ze.push(Qe.id):Pi!=null&&ze.push(Pi.id)}),ze}function getValues(qe,f){const ze=[];return f.forEach(Ke=>{const Qe=qe.findIndex(Pi=>Pi.id===Ke);if(~Qe){const Pi=qe[Qe];ze.push(Pi.value!=null?Pi.value:Qe)}}),ze}const VBtnToggleSymbol=Symbol.for("vuetify:v-btn-toggle"),makeVBtnToggleProps=propsFactory({...makeVBtnGroupProps(),...makeGroupProps()},"VBtnToggle");genericComponent()({name:"VBtnToggle",props:makeVBtnToggleProps(),emits:{"update:modelValue":qe=>!0},setup(qe,f){let{slots:ze}=f;const{isSelected:Ke,next:Qe,prev:Pi,select:nn,selected:ln}=useGroup(qe,VBtnToggleSymbol);return useRender(()=>{const cn=VBtnGroup.filterProps(qe);return createVNode(VBtnGroup,mergeProps({class:["v-btn-toggle",qe.class]},cn,{style:qe.style}),{default:()=>{var hn;return[(hn=ze.default)==null?void 0:hn.call(ze,{isSelected:Ke,next:Qe,prev:Pi,select:nn,selected:ln})]}})}),{next:Qe,prev:Pi,select:nn}}});const predefinedSizes=["x-small","small","default","large","x-large"],makeSizeProps=propsFactory({size:{type:[String,Number],default:"default"}},"size");function useSize(qe){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:getCurrentInstanceName();return destructComputed(()=>{const ze=qe.size;let Ke,Qe;return includes(predefinedSizes,ze)?Ke=`${f}--size-${ze}`:ze&&(Qe={width:convertToUnit(ze),height:convertToUnit(ze)}),{sizeClasses:Ke,sizeStyles:Qe}})}const makeVIconProps=propsFactory({color:String,disabled:Boolean,start:Boolean,end:Boolean,icon:IconValue,opacity:[String,Number],...makeComponentProps(),...makeSizeProps(),...makeTagProps({tag:"i"}),...makeThemeProps()},"VIcon"),VIcon=genericComponent()({name:"VIcon",props:makeVIconProps(),setup(qe,f){let{attrs:ze,slots:Ke}=f;const Qe=shallowRef(),{themeClasses:Pi}=useTheme(),{iconData:nn}=useIcon(()=>Qe.value||qe.icon),{sizeClasses:ln}=useSize(qe),{textColorClasses:cn,textColorStyles:hn}=useTextColor(()=>qe.color);return useRender(()=>{var zn,Xn;const un=(zn=Ke.default)==null?void 0:zn.call(Ke);un&&(Qe.value=(Xn=flattenFragments(un).filter(ys=>ys.type===Text&&ys.children&&typeof ys.children=="string")[0])==null?void 0:Xn.children);const xs=!!(ze.onClick||ze.onClickOnce);return createVNode(nn.value.component,{tag:qe.tag,icon:nn.value.icon,class:["v-icon","notranslate",Pi.value,ln.value,cn.value,{"v-icon--clickable":xs,"v-icon--disabled":qe.disabled,"v-icon--start":qe.start,"v-icon--end":qe.end},qe.class],style:[{"--v-icon-opacity":qe.opacity},ln.value?void 0:{fontSize:convertToUnit(qe.size),height:convertToUnit(qe.size),width:convertToUnit(qe.size)},hn.value,qe.style],role:xs?"button":void 0,"aria-hidden":!xs,tabindex:xs?qe.disabled?-1:0:void 0},{default:()=>[un]})}),{}}});function useIntersectionObserver(qe,f){const ze=ref(),Ke=shallowRef(!1);if(SUPPORTS_INTERSECTION){const Qe=new IntersectionObserver(Pi=>{Ke.value=!!Pi.find(nn=>nn.isIntersecting)},f);onBeforeUnmount(()=>{Qe.disconnect()}),watch(ze,(Pi,nn)=>{nn&&(Qe.unobserve(nn),Ke.value=!1),Pi&&Qe.observe(Pi)},{flush:"post"})}return{intersectionRef:ze,isIntersecting:Ke}}const makeVProgressCircularProps=propsFactory({bgColor:String,color:String,indeterminate:[Boolean,String],modelValue:{type:[Number,String],default:0},rotate:{type:[Number,String],default:0},width:{type:[Number,String],default:4},...makeComponentProps(),...makeSizeProps(),...makeTagProps({tag:"div"}),...makeThemeProps()},"VProgressCircular"),VProgressCircular=genericComponent()({name:"VProgressCircular",props:makeVProgressCircularProps(),setup(qe,f){let{slots:ze}=f;const Ke=20,Qe=2*Math.PI*Ke,Pi=ref(),{themeClasses:nn}=provideTheme(qe),{sizeClasses:ln,sizeStyles:cn}=useSize(qe),{textColorClasses:hn,textColorStyles:un}=useTextColor(()=>qe.color),{textColorClasses:xs,textColorStyles:zn}=useTextColor(()=>qe.bgColor),{intersectionRef:Xn,isIntersecting:ys}=useIntersectionObserver(),{resizeRef:Jo,contentRect:ea}=useResizeObserver(),ra=toRef(()=>Math.max(0,Math.min(100,parseFloat(qe.modelValue)))),na=toRef(()=>Number(qe.width)),ta=toRef(()=>cn.value?Number(qe.size):ea.value?ea.value.width:Math.max(na.value,32)),ia=toRef(()=>Ke/(1-na.value/ta.value)*2),sa=toRef(()=>na.value/ta.value*ia.value),Ma=toRef(()=>convertToUnit((100-ra.value)/100*Qe));return watchEffect(()=>{Xn.value=Pi.value,Jo.value=Pi.value}),useRender(()=>createVNode(qe.tag,{ref:Pi,class:["v-progress-circular",{"v-progress-circular--indeterminate":!!qe.indeterminate,"v-progress-circular--visible":ys.value,"v-progress-circular--disable-shrink":qe.indeterminate==="disable-shrink"},nn.value,ln.value,hn.value,qe.class],style:[cn.value,un.value,qe.style],role:"progressbar","aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":qe.indeterminate?void 0:ra.value},{default:()=>[createVNode("svg",{style:{transform:`rotate(calc(-90deg + ${Number(qe.rotate)}deg))`},xmlns:"http://www.w3.org/2000/svg",viewBox:`0 0 ${ia.value} ${ia.value}`},[createVNode("circle",{class:["v-progress-circular__underlay",xs.value],style:zn.value,fill:"transparent",cx:"50%",cy:"50%",r:Ke,"stroke-width":sa.value,"stroke-dasharray":Qe,"stroke-dashoffset":0},null),createVNode("circle",{class:"v-progress-circular__overlay",fill:"transparent",cx:"50%",cy:"50%",r:Ke,"stroke-width":sa.value,"stroke-dasharray":Qe,"stroke-dashoffset":Ma.value},null)]),ze.default&&createVNode("div",{class:"v-progress-circular__content"},[ze.default({value:ra.value})])]})),{}}}),oppositeMap={center:"center",top:"bottom",bottom:"top",left:"right",right:"left"},makeLocationProps=propsFactory({location:String},"location");function useLocation(qe){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,ze=arguments.length>2?arguments[2]:void 0;const{isRtl:Ke}=useRtl();return{locationStyles:computed(()=>{if(!qe.location)return{};const{side:Pi,align:nn}=parseAnchor(qe.location.split(" ").length>1?qe.location:`${qe.location} center`,Ke.value);function ln(hn){return ze?ze(hn):0}const cn={};return Pi!=="center"&&(f?cn[oppositeMap[Pi]]=`calc(100% - ${ln(Pi)}px)`:cn[Pi]=0),nn!=="center"?f?cn[oppositeMap[nn]]=`calc(100% - ${ln(nn)}px)`:cn[nn]=0:(Pi==="center"?cn.top=cn.left="50%":cn[{top:"left",bottom:"left",left:"top",right:"top"}[Pi]]="50%",cn.transform={top:"translateX(-50%)",bottom:"translateX(-50%)",left:"translateY(-50%)",right:"translateY(-50%)",center:"translate(-50%, -50%)"}[Pi]),cn})}}const makeVProgressLinearProps=propsFactory({absolute:Boolean,active:{type:Boolean,default:!0},bgColor:String,bgOpacity:[Number,String],bufferValue:{type:[Number,String],default:0},bufferColor:String,bufferOpacity:[Number,String],clickable:Boolean,color:String,height:{type:[Number,String],default:4},indeterminate:Boolean,max:{type:[Number,String],default:100},modelValue:{type:[Number,String],default:0},opacity:[Number,String],reverse:Boolean,stream:Boolean,striped:Boolean,roundedBar:Boolean,...makeComponentProps(),...makeLocationProps({location:"top"}),...makeRoundedProps(),...makeTagProps(),...makeThemeProps()},"VProgressLinear"),VProgressLinear=genericComponent()({name:"VProgressLinear",props:makeVProgressLinearProps(),emits:{"update:modelValue":qe=>!0},setup(qe,f){var da;let{slots:ze}=f;const Ke=useProxiedModel(qe,"modelValue"),{isRtl:Qe,rtlClasses:Pi}=useRtl(),{themeClasses:nn}=provideTheme(qe),{locationStyles:ln}=useLocation(qe),{textColorClasses:cn,textColorStyles:hn}=useTextColor(()=>qe.color),{backgroundColorClasses:un,backgroundColorStyles:xs}=useBackgroundColor(()=>qe.bgColor||qe.color),{backgroundColorClasses:zn,backgroundColorStyles:Xn}=useBackgroundColor(()=>qe.bufferColor||qe.bgColor||qe.color),{backgroundColorClasses:ys,backgroundColorStyles:Jo}=useBackgroundColor(()=>qe.color),{roundedClasses:ea}=useRounded(qe),{intersectionRef:ra,isIntersecting:na}=useIntersectionObserver(),ta=computed(()=>parseFloat(qe.max)),ia=computed(()=>parseFloat(qe.height)),sa=computed(()=>clamp$1(parseFloat(qe.bufferValue)/ta.value*100,0,100)),Ma=computed(()=>clamp$1(parseFloat(Ke.value)/ta.value*100,0,100)),pa=computed(()=>Qe.value!==qe.reverse),oa=computed(()=>qe.indeterminate?"fade-transition":"slide-x-transition"),ha=IN_BROWSER&&((da=window.matchMedia)==null?void 0:da.call(window,"(forced-colors: active)").matches);function ca(ga){if(!ra.value)return;const{left:qa,right:Ka,width:il}=ra.value.getBoundingClientRect(),cl=pa.value?il-ga.clientX+(Ka-il):ga.clientX-qa;Ke.value=Math.round(cl/il*ta.value)}return useRender(()=>createVNode(qe.tag,{ref:ra,class:["v-progress-linear",{"v-progress-linear--absolute":qe.absolute,"v-progress-linear--active":qe.active&&na.value,"v-progress-linear--reverse":pa.value,"v-progress-linear--rounded":qe.rounded,"v-progress-linear--rounded-bar":qe.roundedBar,"v-progress-linear--striped":qe.striped},ea.value,nn.value,Pi.value,qe.class],style:[{bottom:qe.location==="bottom"?0:void 0,top:qe.location==="top"?0:void 0,height:qe.active?convertToUnit(ia.value):0,"--v-progress-linear-height":convertToUnit(ia.value),...qe.absolute?ln.value:{}},qe.style],role:"progressbar","aria-hidden":qe.active?"false":"true","aria-valuemin":"0","aria-valuemax":qe.max,"aria-valuenow":qe.indeterminate?void 0:Math.min(parseFloat(Ke.value),ta.value),onClick:qe.clickable&&ca},{default:()=>[qe.stream&&createVNode("div",{key:"stream",class:["v-progress-linear__stream",cn.value],style:{...hn.value,[pa.value?"left":"right"]:convertToUnit(-ia.value),borderTop:`${convertToUnit(ia.value/2)} dotted`,opacity:parseFloat(qe.bufferOpacity),top:`calc(50% - ${convertToUnit(ia.value/4)})`,width:convertToUnit(100-sa.value,"%"),"--v-progress-linear-stream-to":convertToUnit(ia.value*(pa.value?1:-1))}},null),createVNode("div",{class:["v-progress-linear__background",ha?void 0:un.value],style:[xs.value,{opacity:parseFloat(qe.bgOpacity),width:qe.stream?0:void 0}]},null),createVNode("div",{class:["v-progress-linear__buffer",ha?void 0:zn.value],style:[Xn.value,{opacity:parseFloat(qe.bufferOpacity),width:convertToUnit(sa.value,"%")}]},null),createVNode(Transition,{name:oa.value},{default:()=>[qe.indeterminate?createVNode("div",{class:"v-progress-linear__indeterminate"},[["long","short"].map(ga=>createVNode("div",{key:ga,class:["v-progress-linear__indeterminate",ga,ha?void 0:ys.value],style:Jo.value},null))]):createVNode("div",{class:["v-progress-linear__determinate",ha?void 0:ys.value],style:[Jo.value,{width:convertToUnit(Ma.value,"%")}]},null)]}),ze.default&&createVNode("div",{class:"v-progress-linear__content"},[ze.default({value:Ma.value,buffer:sa.value})])]})),{}}}),makeLoaderProps=propsFactory({loading:[Boolean,String]},"loader");function useLoader(qe){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:getCurrentInstanceName();return{loaderClasses:toRef(()=>({[`${f}--loading`]:qe.loading}))}}function LoaderSlot(qe,f){var Ke;let{slots:ze}=f;return createVNode("div",{class:`${qe.name}__loader`},[((Ke=ze.default)==null?void 0:Ke.call(ze,{color:qe.color,isActive:qe.active}))||createVNode(VProgressLinear,{absolute:qe.absolute,active:qe.active,color:qe.color,height:"2",indeterminate:!0},null)])}const positionValues=["static","relative","fixed","absolute","sticky"],makePositionProps=propsFactory({position:{type:String,validator:qe=>positionValues.includes(qe)}},"position");function usePosition(qe){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:getCurrentInstanceName();return{positionClasses:toRef(()=>qe.position?`${f}--${qe.position}`:void 0)}}function useRoute(){const qe=getCurrentInstance("useRoute");return computed(()=>{var f;return(f=qe==null?void 0:qe.proxy)==null?void 0:f.$route})}function useLink(qe,f){var un,xs;const ze=resolveDynamicComponent("RouterLink"),Ke=toRef(()=>!!(qe.href||qe.to)),Qe=computed(()=>(Ke==null?void 0:Ke.value)||hasEvent(f,"click")||hasEvent(qe,"click"));if(typeof ze=="string"||!("useLink"in ze)){const zn=toRef(()=>qe.href);return{isLink:Ke,isClickable:Qe,href:zn,linkProps:reactive({href:zn})}}const Pi=ze.useLink({to:toRef(()=>qe.to||""),replace:toRef(()=>qe.replace)}),nn=computed(()=>qe.to?Pi:void 0),ln=useRoute(),cn=computed(()=>{var zn,Xn,ys;return nn.value?qe.exact?ln.value?((ys=nn.value.isExactActive)==null?void 0:ys.value)&&deepEqual(nn.value.route.value.query,ln.value.query):((Xn=nn.value.isExactActive)==null?void 0:Xn.value)??!1:((zn=nn.value.isActive)==null?void 0:zn.value)??!1:!1}),hn=computed(()=>{var zn;return qe.to?(zn=nn.value)==null?void 0:zn.route.value.href:qe.href});return{isLink:Ke,isClickable:Qe,isActive:cn,route:(un=nn.value)==null?void 0:un.route,navigate:(xs=nn.value)==null?void 0:xs.navigate,href:hn,linkProps:reactive({href:hn,"aria-current":toRef(()=>cn.value?"page":void 0)})}}const makeRouterProps=propsFactory({href:String,replace:Boolean,to:[String,Object],exact:Boolean},"router");function useSelectLink(qe,f){watch(()=>{var ze;return(ze=qe.isActive)==null?void 0:ze.value},ze=>{qe.isLink.value&&ze&&f&&nextTick(()=>{f(!0)})},{immediate:!0})}const stopSymbol=Symbol("rippleStop"),DELAY_RIPPLE=80;function transform(qe,f){qe.style.transform=f,qe.style.webkitTransform=f}function isTouchEvent(qe){return qe.constructor.name==="TouchEvent"}function isKeyboardEvent(qe){return qe.constructor.name==="KeyboardEvent"}const calculate=function(qe,f){var xs;let ze=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},Ke=0,Qe=0;if(!isKeyboardEvent(qe)){const zn=f.getBoundingClientRect(),Xn=isTouchEvent(qe)?qe.touches[qe.touches.length-1]:qe;Ke=Xn.clientX-zn.left,Qe=Xn.clientY-zn.top}let Pi=0,nn=.3;(xs=f._ripple)!=null&&xs.circle?(nn=.15,Pi=f.clientWidth/2,Pi=ze.center?Pi:Pi+Math.sqrt((Ke-Pi)**2+(Qe-Pi)**2)/4):Pi=Math.sqrt(f.clientWidth**2+f.clientHeight**2)/2;const ln=`${(f.clientWidth-Pi*2)/2}px`,cn=`${(f.clientHeight-Pi*2)/2}px`,hn=ze.center?ln:`${Ke-Pi}px`,un=ze.center?cn:`${Qe-Pi}px`;return{radius:Pi,scale:nn,x:hn,y:un,centerX:ln,centerY:cn}},ripples={show(qe,f){var Xn;let ze=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!((Xn=f==null?void 0:f._ripple)!=null&&Xn.enabled))return;const Ke=document.createElement("span"),Qe=document.createElement("span");Ke.appendChild(Qe),Ke.className="v-ripple__container",ze.class&&(Ke.className+=` ${ze.class}`);const{radius:Pi,scale:nn,x:ln,y:cn,centerX:hn,centerY:un}=calculate(qe,f,ze),xs=`${Pi*2}px`;Qe.className="v-ripple__animation",Qe.style.width=xs,Qe.style.height=xs,f.appendChild(Ke);const zn=window.getComputedStyle(f);zn&&zn.position==="static"&&(f.style.position="relative",f.dataset.previousPosition="static"),Qe.classList.add("v-ripple__animation--enter"),Qe.classList.add("v-ripple__animation--visible"),transform(Qe,`translate(${ln}, ${cn}) scale3d(${nn},${nn},${nn})`),Qe.dataset.activated=String(performance.now()),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Qe.classList.remove("v-ripple__animation--enter"),Qe.classList.add("v-ripple__animation--in"),transform(Qe,`translate(${hn}, ${un}) scale3d(1,1,1)`)})})},hide(qe){var Pi;if(!((Pi=qe==null?void 0:qe._ripple)!=null&&Pi.enabled))return;const f=qe.getElementsByClassName("v-ripple__animation");if(f.length===0)return;const ze=f[f.length-1];if(ze.dataset.isHiding)return;ze.dataset.isHiding="true";const Ke=performance.now()-Number(ze.dataset.activated),Qe=Math.max(250-Ke,0);setTimeout(()=>{ze.classList.remove("v-ripple__animation--in"),ze.classList.add("v-ripple__animation--out"),setTimeout(()=>{var ln;qe.getElementsByClassName("v-ripple__animation").length===1&&qe.dataset.previousPosition&&(qe.style.position=qe.dataset.previousPosition,delete qe.dataset.previousPosition),((ln=ze.parentNode)==null?void 0:ln.parentNode)===qe&&qe.removeChild(ze.parentNode)},300)},Qe)}};function isRippleEnabled(qe){return typeof qe>"u"||!!qe}function rippleShow(qe){const f={},ze=qe.currentTarget;if(!(!(ze!=null&&ze._ripple)||ze._ripple.touched||qe[stopSymbol])){if(qe[stopSymbol]=!0,isTouchEvent(qe))ze._ripple.touched=!0,ze._ripple.isTouch=!0;else if(ze._ripple.isTouch)return;if(f.center=ze._ripple.centered||isKeyboardEvent(qe),ze._ripple.class&&(f.class=ze._ripple.class),isTouchEvent(qe)){if(ze._ripple.showTimerCommit)return;ze._ripple.showTimerCommit=()=>{ripples.show(qe,ze,f)},ze._ripple.showTimer=window.setTimeout(()=>{var Ke;(Ke=ze==null?void 0:ze._ripple)!=null&&Ke.showTimerCommit&&(ze._ripple.showTimerCommit(),ze._ripple.showTimerCommit=null)},DELAY_RIPPLE)}else ripples.show(qe,ze,f)}}function rippleStop(qe){qe[stopSymbol]=!0}function rippleHide(qe){const f=qe.currentTarget;if(f!=null&&f._ripple){if(window.clearTimeout(f._ripple.showTimer),qe.type==="touchend"&&f._ripple.showTimerCommit){f._ripple.showTimerCommit(),f._ripple.showTimerCommit=null,f._ripple.showTimer=window.setTimeout(()=>{rippleHide(qe)});return}window.setTimeout(()=>{f._ripple&&(f._ripple.touched=!1)}),ripples.hide(f)}}function rippleCancelShow(qe){const f=qe.currentTarget;f!=null&&f._ripple&&(f._ripple.showTimerCommit&&(f._ripple.showTimerCommit=null),window.clearTimeout(f._ripple.showTimer))}let keyboardRipple=!1;function keyboardRippleShow(qe){!keyboardRipple&&(qe.keyCode===keyCodes.enter||qe.keyCode===keyCodes.space)&&(keyboardRipple=!0,rippleShow(qe))}function keyboardRippleHide(qe){keyboardRipple=!1,rippleHide(qe)}function focusRippleHide(qe){keyboardRipple&&(keyboardRipple=!1,rippleHide(qe))}function updateRipple(qe,f,ze){const{value:Ke,modifiers:Qe}=f,Pi=isRippleEnabled(Ke);if(Pi||ripples.hide(qe),qe._ripple=qe._ripple??{},qe._ripple.enabled=Pi,qe._ripple.centered=Qe.center,qe._ripple.circle=Qe.circle,isObject(Ke)&&Ke.class&&(qe._ripple.class=Ke.class),Pi&&!ze){if(Qe.stop){qe.addEventListener("touchstart",rippleStop,{passive:!0}),qe.addEventListener("mousedown",rippleStop);return}qe.addEventListener("touchstart",rippleShow,{passive:!0}),qe.addEventListener("touchend",rippleHide,{passive:!0}),qe.addEventListener("touchmove",rippleCancelShow,{passive:!0}),qe.addEventListener("touchcancel",rippleHide),qe.addEventListener("mousedown",rippleShow),qe.addEventListener("mouseup",rippleHide),qe.addEventListener("mouseleave",rippleHide),qe.addEventListener("keydown",keyboardRippleShow),qe.addEventListener("keyup",keyboardRippleHide),qe.addEventListener("blur",focusRippleHide),qe.addEventListener("dragstart",rippleHide,{passive:!0})}else!Pi&&ze&&removeListeners(qe)}function removeListeners(qe){qe.removeEventListener("mousedown",rippleShow),qe.removeEventListener("touchstart",rippleShow),qe.removeEventListener("touchend",rippleHide),qe.removeEventListener("touchmove",rippleCancelShow),qe.removeEventListener("touchcancel",rippleHide),qe.removeEventListener("mouseup",rippleHide),qe.removeEventListener("mouseleave",rippleHide),qe.removeEventListener("keydown",keyboardRippleShow),qe.removeEventListener("keyup",keyboardRippleHide),qe.removeEventListener("dragstart",rippleHide),qe.removeEventListener("blur",focusRippleHide)}function mounted(qe,f){updateRipple(qe,f,!1)}function unmounted(qe){delete qe._ripple,removeListeners(qe)}function updated(qe,f){if(f.value===f.oldValue)return;const ze=isRippleEnabled(f.oldValue);updateRipple(qe,f,ze)}const Ripple={mounted,unmounted,updated},makeVBtnProps=propsFactory({active:{type:Boolean,default:void 0},activeColor:String,baseColor:String,symbol:{type:null,default:VBtnToggleSymbol},flat:Boolean,icon:[Boolean,String,Function,Object],prependIcon:IconValue,appendIcon:IconValue,block:Boolean,readonly:Boolean,slim:Boolean,stacked:Boolean,ripple:{type:[Boolean,Object],default:!0},text:{type:[String,Number,Boolean],default:void 0},...makeBorderProps(),...makeComponentProps(),...makeDensityProps(),...makeDimensionProps(),...makeElevationProps(),...makeGroupItemProps(),...makeLoaderProps(),...makeLocationProps(),...makePositionProps(),...makeRoundedProps(),...makeRouterProps(),...makeSizeProps(),...makeTagProps({tag:"button"}),...makeThemeProps(),...makeVariantProps({variant:"elevated"})},"VBtn"),VBtn=genericComponent()({name:"VBtn",props:makeVBtnProps(),emits:{"group:selected":qe=>!0},setup(qe,f){let{attrs:ze,slots:Ke}=f;const{themeClasses:Qe}=provideTheme(qe),{borderClasses:Pi}=useBorder(qe),{densityClasses:nn}=useDensity(qe),{dimensionStyles:ln}=useDimension(qe),{elevationClasses:cn}=useElevation(qe),{loaderClasses:hn}=useLoader(qe),{locationStyles:un}=useLocation(qe),{positionClasses:xs}=usePosition(qe),{roundedClasses:zn}=useRounded(qe),{sizeClasses:Xn,sizeStyles:ys}=useSize(qe),Jo=useGroupItem(qe,qe.symbol,!1),ea=useLink(qe,ze),ra=computed(()=>{var da;return qe.active!==void 0?qe.active:ea.isLink.value?(da=ea.isActive)==null?void 0:da.value:Jo==null?void 0:Jo.isSelected.value}),na=toRef(()=>ra.value?qe.activeColor??qe.color:qe.color),ta=computed(()=>{var ga,qa;return{color:(Jo==null?void 0:Jo.isSelected.value)&&(!ea.isLink.value||((ga=ea.isActive)==null?void 0:ga.value))||!Jo||((qa=ea.isActive)==null?void 0:qa.value)?na.value??qe.baseColor:qe.baseColor,variant:qe.variant}}),{colorClasses:ia,colorStyles:sa,variantClasses:Ma}=useVariant(ta),pa=computed(()=>(Jo==null?void 0:Jo.disabled.value)||qe.disabled),oa=toRef(()=>qe.variant==="elevated"&&!(qe.disabled||qe.flat||qe.border)),ha=computed(()=>{if(!(qe.value===void 0||typeof qe.value=="symbol"))return Object(qe.value)===qe.value?JSON.stringify(qe.value,null,0):qe.value});function ca(da){var ga;pa.value||ea.isLink.value&&(da.metaKey||da.ctrlKey||da.shiftKey||da.button!==0||ze.target==="_blank")||((ga=ea.navigate)==null||ga.call(ea,da),Jo==null||Jo.toggle())}return useSelectLink(ea,Jo==null?void 0:Jo.select),useRender(()=>{const da=ea.isLink.value?"a":qe.tag,ga=!!(qe.prependIcon||Ke.prepend),qa=!!(qe.appendIcon||Ke.append),Ka=!!(qe.icon&&qe.icon!==!0);return withDirectives(createVNode(da,mergeProps({type:da==="a"?void 0:"button",class:["v-btn",Jo==null?void 0:Jo.selectedClass.value,{"v-btn--active":ra.value,"v-btn--block":qe.block,"v-btn--disabled":pa.value,"v-btn--elevated":oa.value,"v-btn--flat":qe.flat,"v-btn--icon":!!qe.icon,"v-btn--loading":qe.loading,"v-btn--readonly":qe.readonly,"v-btn--slim":qe.slim,"v-btn--stacked":qe.stacked},Qe.value,Pi.value,ia.value,nn.value,cn.value,hn.value,xs.value,zn.value,Xn.value,Ma.value,qe.class],style:[sa.value,ln.value,un.value,ys.value,qe.style],"aria-busy":qe.loading?!0:void 0,disabled:pa.value||void 0,tabindex:qe.loading||qe.readonly?-1:void 0,onClick:ca,value:ha.value},ea.linkProps),{default:()=>{var il;return[genOverlays(!0,"v-btn"),!qe.icon&&ga&&createVNode("span",{key:"prepend",class:"v-btn__prepend"},[Ke.prepend?createVNode(VDefaultsProvider,{key:"prepend-defaults",disabled:!qe.prependIcon,defaults:{VIcon:{icon:qe.prependIcon}}},Ke.prepend):createVNode(VIcon,{key:"prepend-icon",icon:qe.prependIcon},null)]),createVNode("span",{class:"v-btn__content","data-no-activator":""},[!Ke.default&&Ka?createVNode(VIcon,{key:"content-icon",icon:qe.icon},null):createVNode(VDefaultsProvider,{key:"content-defaults",disabled:!Ka,defaults:{VIcon:{icon:qe.icon}}},{default:()=>{var cl;return[((cl=Ke.default)==null?void 0:cl.call(Ke))??toDisplayString(qe.text)]}})]),!qe.icon&&qa&&createVNode("span",{key:"append",class:"v-btn__append"},[Ke.append?createVNode(VDefaultsProvider,{key:"append-defaults",disabled:!qe.appendIcon,defaults:{VIcon:{icon:qe.appendIcon}}},Ke.append):createVNode(VIcon,{key:"append-icon",icon:qe.appendIcon},null)]),!!qe.loading&&createVNode("span",{key:"loader",class:"v-btn__loader"},[((il=Ke.loader)==null?void 0:il.call(Ke))??createVNode(VProgressCircular,{color:typeof qe.loading=="boolean"?void 0:qe.loading,indeterminate:!0,width:"2"},null)])]}}),[[Ripple,!pa.value&&qe.ripple,"",{center:!!qe.icon}]])}),{group:Jo}}});function getDefaultExportFromCjs(qe){return qe&&qe.__esModule&&Object.prototype.hasOwnProperty.call(qe,"default")?qe.default:qe}function getAugmentedNamespace(qe){if(Object.prototype.hasOwnProperty.call(qe,"__esModule"))return qe;var f=qe.default;if(typeof f=="function"){var ze=function Ke(){return this instanceof Ke?Reflect.construct(f,arguments,this.constructor):f.apply(this,arguments)};ze.prototype=f.prototype}else ze={};return Object.defineProperty(ze,"__esModule",{value:!0}),Object.keys(qe).forEach(function(Ke){var Qe=Object.getOwnPropertyDescriptor(qe,Ke);Object.defineProperty(ze,Ke,Qe.get?Qe:{enumerable:!0,get:function(){return qe[Ke]}})}),ze}var dist={},hasRequiredDist;function requireDist(){return hasRequiredDist||(hasRequiredDist=1,(()=>{var qe={792:(Ke,Qe,Pi)=>{Pi.d(Qe,{Z:()=>cn});var nn=Pi(609),ln=Pi.n(nn)()(function(hn){return hn[1]});ln.push([Ke.id,':host{--divider-width: 1px;--divider-color: #fff;--divider-shadow: none;--default-handle-width: 50px;--default-handle-color: #fff;--default-handle-opacity: 1;--default-handle-shadow: none;--handle-position-start: 50%;position:relative;display:inline-block;overflow:hidden;line-height:0;direction:ltr}@media screen and (-webkit-min-device-pixel-ratio: 0)and (min-resolution: 0.001dpcm){:host{outline-offset:1px}}:host(:focus){outline:2px solid -webkit-focus-ring-color}::slotted(*){-webkit-user-drag:none;-khtml-user-drag:none;-moz-user-drag:none;-o-user-drag:none;user-drag:none;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.first{position:absolute;left:0;top:0;right:0;line-height:normal;font-size:100%;max-height:100%;height:100%;width:100%;--exposure: 50%;--keyboard-transition-time: 0ms;--default-transition-time: 0ms;--transition-time: var(--default-transition-time)}.first .first-overlay-container{position:relative;clip-path:inset(0 var(--exposure) 0 0);transition:clip-path var(--transition-time);height:100%}.first .first-overlay{overflow:hidden;height:100%}.first.focused{will-change:clip-path}.first.focused .first-overlay-container{will-change:clip-path}.second{position:relative}.handle-container{transform:translateX(50%);position:absolute;top:0;right:var(--exposure);height:100%;transition:right var(--transition-time),bottom var(--transition-time)}.focused .handle-container{will-change:right}.divider{position:absolute;height:100%;width:100%;left:0;top:0;display:flex;align-items:center;justify-content:center;flex-direction:column}.divider:after{content:" ";display:block;height:100%;border-left-width:var(--divider-width);border-left-style:solid;border-left-color:var(--divider-color);box-shadow:var(--divider-shadow)}.handle{position:absolute;top:var(--handle-position-start);pointer-events:none;box-sizing:border-box;margin-left:1px;transform:translate(calc(-50% - 0.5px), -50%);line-height:0}.default-handle{width:var(--default-handle-width);opacity:var(--default-handle-opacity);transition:all 1s;filter:drop-shadow(var(--default-handle-shadow))}.default-handle path{stroke:var(--default-handle-color)}.vertical .first-overlay-container{clip-path:inset(0 0 var(--exposure) 0)}.vertical .handle-container{transform:translateY(50%);height:auto;top:unset;bottom:var(--exposure);width:100%;left:0;flex-direction:row}.vertical .divider:after{height:1px;width:100%;border-top-width:var(--divider-width);border-top-style:solid;border-top-color:var(--divider-color);border-left:0}.vertical .handle{top:auto;left:var(--handle-position-start);transform:translate(calc(-50% - 0.5px), -50%) rotate(90deg)}',""]);const cn=ln},609:Ke=>{Ke.exports=function(Qe){var Pi=[];return Pi.toString=function(){return this.map(function(nn){var ln=Qe(nn);return nn[2]?"@media ".concat(nn[2]," {").concat(ln,"}"):ln}).join("")},Pi.i=function(nn,ln,cn){typeof nn=="string"&&(nn=[[null,nn,""]]);var hn={};if(cn)for(var un=0;un<this.length;un++){var xs=this[un][0];xs!=null&&(hn[xs]=!0)}for(var zn=0;zn<nn.length;zn++){var Xn=[].concat(nn[zn]);cn&&hn[Xn[0]]||(ln&&(Xn[2]?Xn[2]="".concat(ln," and ").concat(Xn[2]):Xn[2]=ln),Pi.push(Xn))}},Pi}}},f={};function ze(Ke){var Qe=f[Ke];if(Qe!==void 0)return Qe.exports;var Pi=f[Ke]={id:Ke,exports:{}};return qe[Ke](Pi,Pi.exports,ze),Pi.exports}ze.n=Ke=>{var Qe=Ke&&Ke.__esModule?()=>Ke.default:()=>Ke;return ze.d(Qe,{a:Qe}),Qe},ze.d=(Ke,Qe)=>{for(var Pi in Qe)ze.o(Qe,Pi)&&!ze.o(Ke,Pi)&&Object.defineProperty(Ke,Pi,{enumerable:!0,get:Qe[Pi]})},ze.o=(Ke,Qe)=>Object.prototype.hasOwnProperty.call(Ke,Qe),(()=>{var Ke=ze(792);const Qe="rendered",Pi=(zn,Xn)=>{const ys=zn.getBoundingClientRect();let Jo,ea;return Xn.type==="mousedown"?(Jo=Xn.clientX,ea=Xn.clientY):(Jo=Xn.touches[0].clientX,ea=Xn.touches[0].clientY),Jo>=ys.x&&Jo<=ys.x+ys.width&&ea>=ys.y&&ea<=ys.y+ys.height};let nn;const ln={ArrowLeft:-1,ArrowRight:1},cn=["horizontal","vertical"],hn=zn=>({x:zn.touches[0].pageX,y:zn.touches[0].pageY}),un=zn=>({x:zn.pageX,y:zn.pageY}),xs=typeof window<"u"&&(window==null?void 0:window.HTMLElement);typeof window<"u"&&(window.document&&(nn=document.createElement("template"),nn.innerHTML='<div class="second" id="second"> <slot name="second"><slot name="before"></slot></slot> </div> <div class="first" id="first"> <div class="first-overlay"> <div class="first-overlay-container" id="firstImageContainer"> <slot name="first"><slot name="after"></slot></slot> </div> </div> <div class="handle-container"> <div class="divider"></div> <div class="handle" id="handle"> <slot name="handle"> <svg xmlns="http://www.w3.org/2000/svg" class="default-handle" viewBox="-8 -3 16 6"> <path d="M -5 -2 L -7 0 L -5 2 M 5 -2 L 7 0 L 5 2" fill="none" vector-effect="non-scaling-stroke"/> </svg> </slot> </div> </div> </div> '),window.customElements.define("img-comparison-slider",class extends xs{constructor(){super(),this.exposure=this.hasAttribute("value")?parseFloat(this.getAttribute("value")):50,this.slideOnHover=!1,this.slideDirection="horizontal",this.keyboard="enabled",this.isMouseDown=!1,this.animationDirection=0,this.isFocused=!1,this.dragByHandle=!1,this.onMouseMove=ys=>{if(this.isMouseDown||this.slideOnHover){const Jo=un(ys);this.slideToPage(Jo)}},this.bodyUserSelectStyle="",this.bodyWebkitUserSelectStyle="",this.onMouseDown=ys=>{if(this.slideOnHover||this.handle&&!Pi(this.handleElement,ys))return;ys.preventDefault(),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp),this.isMouseDown=!0,this.enableTransition();const Jo=un(ys);this.slideToPage(Jo),this.focus(),this.bodyUserSelectStyle=window.document.body.style.userSelect,this.bodyWebkitUserSelectStyle=window.document.body.style.webkitUserSelect,window.document.body.style.userSelect="none",window.document.body.style.webkitUserSelect="none"},this.onWindowMouseUp=()=>{this.isMouseDown=!1,window.document.body.style.userSelect=this.bodyUserSelectStyle,window.document.body.style.webkitUserSelect=this.bodyWebkitUserSelectStyle,window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp)},this.touchStartPoint=null,this.isTouchComparing=!1,this.hasTouchMoved=!1,this.onTouchStart=ys=>{this.dragByHandle&&!Pi(this.handleElement,ys)||(this.touchStartPoint=hn(ys),this.isFocused&&(this.enableTransition(),this.slideToPage(this.touchStartPoint)))},this.onTouchMove=ys=>{if(this.touchStartPoint===null)return;const Jo=hn(ys);if(this.isTouchComparing)return this.slideToPage(Jo),ys.preventDefault(),!1;if(!this.hasTouchMoved){const ea=Math.abs(Jo.y-this.touchStartPoint.y),ra=Math.abs(Jo.x-this.touchStartPoint.x);if(this.slideDirection==="horizontal"&&ea<ra||this.slideDirection==="vertical"&&ea>ra)return this.isTouchComparing=!0,this.focus(),this.slideToPage(Jo),ys.preventDefault(),!1;this.hasTouchMoved=!0}},this.onTouchEnd=()=>{this.isTouchComparing=!1,this.hasTouchMoved=!1,this.touchStartPoint=null},this.onBlur=()=>{this.stopSlideAnimation(),this.isFocused=!1,this.firstElement.classList.remove("focused")},this.onFocus=()=>{this.isFocused=!0,this.firstElement.classList.add("focused")},this.onKeyDown=ys=>{if(this.keyboard==="disabled")return;const Jo=ln[ys.key];this.animationDirection!==Jo&&Jo!==void 0&&(this.animationDirection=Jo,this.startSlideAnimation())},this.onKeyUp=ys=>{if(this.keyboard==="disabled")return;const Jo=ln[ys.key];Jo!==void 0&&this.animationDirection===Jo&&this.stopSlideAnimation()},this.resetDimensions=()=>{this.imageWidth=this.offsetWidth,this.imageHeight=this.offsetHeight};const zn=this.attachShadow({mode:"open"}),Xn=document.createElement("style");Xn.innerHTML=Ke.Z,this.getAttribute("nonce")&&Xn.setAttribute("nonce",this.getAttribute("nonce")),zn.appendChild(Xn),zn.appendChild(nn.content.cloneNode(!0)),this.firstElement=zn.getElementById("first"),this.handleElement=zn.getElementById("handle")}set handle(zn){this.dragByHandle=zn.toString().toLowerCase()!=="false"}get handle(){return this.dragByHandle}get value(){return this.exposure}set value(zn){const Xn=parseFloat(zn);Xn!==this.exposure&&(this.exposure=Xn,this.enableTransition(),this.setExposure())}get hover(){return this.slideOnHover}set hover(zn){this.slideOnHover=zn.toString().toLowerCase()!=="false",this.removeEventListener("mousemove",this.onMouseMove),this.slideOnHover&&this.addEventListener("mousemove",this.onMouseMove)}get direction(){return this.slideDirection}set direction(zn){this.slideDirection=zn.toString().toLowerCase(),this.slide(0),this.firstElement.classList.remove(...cn),cn.includes(this.slideDirection)&&this.firstElement.classList.add(this.slideDirection)}static get observedAttributes(){return["hover","direction"]}connectedCallback(){this.hasAttribute("tabindex")||(this.tabIndex=0),this.addEventListener("dragstart",zn=>(zn.preventDefault(),!1)),new ResizeObserver(this.resetDimensions).observe(this),this.setExposure(0),this.keyboard=this.hasAttribute("keyboard")&&this.getAttribute("keyboard")==="disabled"?"disabled":"enabled",this.addEventListener("keydown",this.onKeyDown),this.addEventListener("keyup",this.onKeyUp),this.addEventListener("focus",this.onFocus),this.addEventListener("blur",this.onBlur),this.addEventListener("touchstart",this.onTouchStart,{passive:!0}),this.addEventListener("touchmove",this.onTouchMove,{passive:!1}),this.addEventListener("touchend",this.onTouchEnd),this.addEventListener("mousedown",this.onMouseDown),this.handle=this.hasAttribute("handle")?this.getAttribute("handle"):this.dragByHandle,this.hover=this.hasAttribute("hover")?this.getAttribute("hover"):this.slideOnHover,this.direction=this.hasAttribute("direction")?this.getAttribute("direction"):this.slideDirection,this.resetDimensions(),this.classList.contains(Qe)||this.classList.add(Qe)}disconnectedCallback(){this.transitionTimer&&window.clearTimeout(this.transitionTimer)}attributeChangedCallback(zn,Xn,ys){zn==="hover"&&(this.hover=ys),zn==="direction"&&(this.direction=ys),zn==="keyboard"&&(this.keyboard=ys==="disabled"?"disabled":"enabled")}setExposure(zn=0){var Xn;this.exposure=(Xn=this.exposure+zn)<0?0:Xn>100?100:Xn,this.firstElement.style.setProperty("--exposure",100-this.exposure+"%")}slide(zn=0){this.setExposure(zn);const Xn=new Event("slide");this.dispatchEvent(Xn)}slideToPage(zn){this.slideDirection==="horizontal"&&this.slideToPageX(zn.x),this.slideDirection==="vertical"&&this.slideToPageY(zn.y)}slideToPageX(zn){const Xn=zn-this.getBoundingClientRect().left-window.scrollX;this.exposure=Xn/this.imageWidth*100,this.slide(0)}slideToPageY(zn){const Xn=zn-this.getBoundingClientRect().top-window.scrollY;this.exposure=Xn/this.imageHeight*100,this.slide(0)}enableTransition(){this.firstElement.style.setProperty("--transition-time","100ms"),this.transitionTimer=window.setTimeout(()=>{this.firstElement.style.setProperty("--transition-time","var(--default-transition-time)"),this.transitionTimer=null},100)}startSlideAnimation(){let zn=null,Xn=this.animationDirection;this.firstElement.style.setProperty("--transition-time","var(--keyboard-transition-time)");const ys=Jo=>{if(this.animationDirection===0||Xn!==this.animationDirection)return;zn===null&&(zn=Jo);const ea=(Jo-zn)/16.666666666666668*this.animationDirection;this.slide(ea),setTimeout(()=>window.requestAnimationFrame(ys),0),zn=Jo};window.requestAnimationFrame(ys)}stopSlideAnimation(){this.animationDirection=0,this.firstElement.style.setProperty("--transition-time","var(--default-transition-time)")}}))})()})()),dist}requireDist();const ImgComparisonSlider=defineComponent({name:"ImgComparisonSlider",setup(qe,{slots:f}){return()=>h$1("img-comparison-slider",f.default())}});function t(qe,f,ze){return(f=function(Ke){var Qe=function(Pi,nn){if(typeof Pi!="object"||!Pi)return Pi;var ln=Pi[Symbol.toPrimitive];if(ln!==void 0){var cn=ln.call(Pi,nn);if(typeof cn!="object")return cn;throw new TypeError("@@toPrimitive must return a primitive value.")}return(nn==="string"?String:Number)(Pi)}(Ke,"string");return typeof Qe=="symbol"?Qe:Qe+""}(f))in qe?Object.defineProperty(qe,f,{value:ze,enumerable:!0,configurable:!0,writable:!0}):qe[f]=ze,qe}function e(qe,f){var ze=Object.keys(qe);if(Object.getOwnPropertySymbols){var Ke=Object.getOwnPropertySymbols(qe);f&&(Ke=Ke.filter(function(Qe){return Object.getOwnPropertyDescriptor(qe,Qe).enumerable})),ze.push.apply(ze,Ke)}return ze}function s(qe){for(var f=1;f<arguments.length;f++){var ze=arguments[f]!=null?arguments[f]:{};f%2?e(Object(ze),!0).forEach(function(Ke){t(qe,Ke,ze[Ke])}):Object.getOwnPropertyDescriptors?Object.defineProperties(qe,Object.getOwnPropertyDescriptors(ze)):e(Object(ze)).forEach(function(Ke){Object.defineProperty(qe,Ke,Object.getOwnPropertyDescriptor(ze,Ke))})}return qe}function i(qe,f){if(qe==null)return{};var ze,Ke,Qe=function(nn,ln){if(nn==null)return{};var cn={};for(var hn in nn)if({}.hasOwnProperty.call(nn,hn)){if(ln.indexOf(hn)>=0)continue;cn[hn]=nn[hn]}return cn}(qe,f);if(Object.getOwnPropertySymbols){var Pi=Object.getOwnPropertySymbols(qe);for(Ke=0;Ke<Pi.length;Ke++)ze=Pi[Ke],f.indexOf(ze)>=0||{}.propertyIsEnumerable.call(qe,ze)&&(Qe[ze]=qe[ze])}return Qe}function r(qe,f){return f||(f=qe.slice(0)),Object.freeze(Object.defineProperties(qe,{raw:{value:Object.freeze(f)}}))}class n{constructor(){t(this,"browserShadowBlurConstant",1),t(this,"DPI",96),t(this,"devicePixelRatio",typeof window<"u"?window.devicePixelRatio:1),t(this,"perfLimitSizeTotal",2097152),t(this,"maxCacheSideLimit",4096),t(this,"minCacheSideLimit",256),t(this,"disableStyleCopyPaste",!1),t(this,"enableGLFiltering",!0),t(this,"textureSize",4096),t(this,"forceGLPutImageData",!1),t(this,"cachesBoundsOfCurve",!1),t(this,"fontPaths",{}),t(this,"NUM_FRACTION_DIGITS",4)}}const o=new class extends n{constructor(qe){super(),this.configure(qe)}configure(){let qe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.assign(this,qe)}addFonts(){let qe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fontPaths=s(s({},this.fontPaths),qe)}removeFonts(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(qe=>{delete this.fontPaths[qe]})}clearFonts(){this.fontPaths={}}restoreDefaults(qe){const f=new n,ze=(qe==null?void 0:qe.reduce((Ke,Qe)=>(Ke[Qe]=f[Qe],Ke),{}))||f;this.configure(ze)}},a=function(qe){for(var f=arguments.length,ze=new Array(f>1?f-1:0),Ke=1;Ke<f;Ke++)ze[Ke-1]=arguments[Ke];return console[qe]("fabric",...ze)};class h extends Error{constructor(f,ze){super("fabric: ".concat(f),ze)}}class c extends h{constructor(f){super("".concat(f," 'options.signal' is in 'aborted' state"))}}class l{}class u extends l{testPrecision(f,ze){const Ke="precision ".concat(ze,` float;
void main(){}`),Qe=f.createShader(f.FRAGMENT_SHADER);return!!Qe&&(f.shaderSource(Qe,Ke),f.compileShader(Qe),!!f.getShaderParameter(Qe,f.COMPILE_STATUS))}queryWebGL(f){const ze=f.getContext("webgl");ze&&(this.maxTextureSize=ze.getParameter(ze.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find(Ke=>this.testPrecision(ze,Ke)),ze.getExtension("WEBGL_lose_context").loseContext(),a("log","WebGL: max texture size ".concat(this.maxTextureSize)))}isSupported(f){return!!this.maxTextureSize&&this.maxTextureSize>=f}}const d={};let g;const p$1=()=>g||(g={document,window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new u,dispose(){},copyPasteData:d}),m=()=>p$1().document,v=()=>p$1().window,y$1=()=>{var qe;return Math.max((qe=o.devicePixelRatio)!==null&&qe!==void 0?qe:v().devicePixelRatio,1)},_=new class{constructor(){t(this,"charWidthsCache",{}),t(this,"boundsOfCurveCache",{})}getFontCache(qe){let{fontFamily:f,fontStyle:ze,fontWeight:Ke}=qe;f=f.toLowerCase(),this.charWidthsCache[f]||(this.charWidthsCache[f]={});const Qe=this.charWidthsCache[f],Pi="".concat(ze.toLowerCase(),"_").concat((Ke+"").toLowerCase());return Qe[Pi]||(Qe[Pi]={}),Qe[Pi]}clearFontCache(qe){(qe=(qe||"").toLowerCase())?this.charWidthsCache[qe]&&delete this.charWidthsCache[qe]:this.charWidthsCache={}}limitDimsByArea(qe){const{perfLimitSizeTotal:f}=o,ze=Math.sqrt(f*qe);return[Math.floor(ze),Math.floor(f/ze)]}},x$1="6.6.4";function C(){}const b=Math.PI/2,w$1=2*Math.PI,S$1=Math.PI/180,T=Object.freeze([1,0,0,1,0,0]),O$1=16,k$1=.4477152502,D$1="center",M$1="left",P="top",E$1="bottom",A="right",j$1="none",F$1=/\r?\n/,L="moving",R="scaling",I="rotating",B$1="rotate",X="skewing",Y$1="resizing",W$1="modifyPoly",V="modifyPath",z="changed",G$1="scale",H="scaleX",N$1="scaleY",U="skewX",q="skewY",K$1="fill",J="stroke",Q$1="modified",Z="json",$$1="svg",tt=new class{constructor(){this[Z]=new Map,this[$$1]=new Map}has(qe){return this[Z].has(qe)}getClass(qe){const f=this[Z].get(qe);if(!f)throw new h("No class registered for ".concat(qe));return f}setClass(qe,f){f?this[Z].set(f,qe):(this[Z].set(qe.type,qe),this[Z].set(qe.type.toLowerCase(),qe))}getSVGClass(qe){return this[$$1].get(qe)}setSVGClass(qe,f){this[$$1].set(f??qe.type.toLowerCase(),qe)}},et$1=new class extends Array{remove(qe){const f=this.indexOf(qe);f>-1&&this.splice(f,1)}cancelAll(){const qe=this.splice(0);return qe.forEach(f=>f.abort()),qe}cancelByCanvas(qe){if(!qe)return[];const f=this.filter(ze=>{var Ke;return ze.target===qe||typeof ze.target=="object"&&((Ke=ze.target)===null||Ke===void 0?void 0:Ke.canvas)===qe});return f.forEach(ze=>ze.abort()),f}cancelByTarget(qe){if(!qe)return[];const f=this.filter(ze=>ze.target===qe);return f.forEach(ze=>ze.abort()),f}};let st$1=class{constructor(){t(this,"__eventListeners",{})}on(f,ze){if(this.__eventListeners||(this.__eventListeners={}),typeof f=="object")return Object.entries(f).forEach(Ke=>{let[Qe,Pi]=Ke;this.on(Qe,Pi)}),()=>this.off(f);if(ze){const Ke=f;return this.__eventListeners[Ke]||(this.__eventListeners[Ke]=[]),this.__eventListeners[Ke].push(ze),()=>this.off(Ke,ze)}return()=>!1}once(f,ze){if(typeof f=="object"){const Ke=[];return Object.entries(f).forEach(Qe=>{let[Pi,nn]=Qe;Ke.push(this.once(Pi,nn))}),()=>Ke.forEach(Qe=>Qe())}if(ze){const Ke=this.on(f,function(){for(var Qe=arguments.length,Pi=new Array(Qe),nn=0;nn<Qe;nn++)Pi[nn]=arguments[nn];ze.call(this,...Pi),Ke()});return Ke}return()=>!1}_removeEventListener(f,ze){if(this.__eventListeners[f])if(ze){const Ke=this.__eventListeners[f],Qe=Ke.indexOf(ze);Qe>-1&&Ke.splice(Qe,1)}else this.__eventListeners[f]=[]}off(f,ze){if(this.__eventListeners)if(f===void 0)for(const Ke in this.__eventListeners)this._removeEventListener(Ke);else typeof f=="object"?Object.entries(f).forEach(Ke=>{let[Qe,Pi]=Ke;this._removeEventListener(Qe,Pi)}):this._removeEventListener(f,ze)}fire(f,ze){var Ke;if(!this.__eventListeners)return;const Qe=(Ke=this.__eventListeners[f])===null||Ke===void 0?void 0:Ke.concat();if(Qe)for(let Pi=0;Pi<Qe.length;Pi++)Qe[Pi].call(this,ze||{})}};const it$1=(qe,f)=>{const ze=qe.indexOf(f);return ze!==-1&&qe.splice(ze,1),qe},rt$1=qe=>{if(qe===0)return 1;switch(Math.abs(qe)/b){case 1:case 3:return 0;case 2:return-1}return Math.cos(qe)},nt$1=qe=>{if(qe===0)return 0;const f=qe/b,ze=Math.sign(qe);switch(f){case 1:return ze;case 2:return 0;case 3:return-ze}return Math.sin(qe)};let ot$1=class $h{constructor(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;typeof f=="object"?(this.x=f.x,this.y=f.y):(this.x=f,this.y=ze)}add(f){return new $h(this.x+f.x,this.y+f.y)}addEquals(f){return this.x+=f.x,this.y+=f.y,this}scalarAdd(f){return new $h(this.x+f,this.y+f)}scalarAddEquals(f){return this.x+=f,this.y+=f,this}subtract(f){return new $h(this.x-f.x,this.y-f.y)}subtractEquals(f){return this.x-=f.x,this.y-=f.y,this}scalarSubtract(f){return new $h(this.x-f,this.y-f)}scalarSubtractEquals(f){return this.x-=f,this.y-=f,this}multiply(f){return new $h(this.x*f.x,this.y*f.y)}scalarMultiply(f){return new $h(this.x*f,this.y*f)}scalarMultiplyEquals(f){return this.x*=f,this.y*=f,this}divide(f){return new $h(this.x/f.x,this.y/f.y)}scalarDivide(f){return new $h(this.x/f,this.y/f)}scalarDivideEquals(f){return this.x/=f,this.y/=f,this}eq(f){return this.x===f.x&&this.y===f.y}lt(f){return this.x<f.x&&this.y<f.y}lte(f){return this.x<=f.x&&this.y<=f.y}gt(f){return this.x>f.x&&this.y>f.y}gte(f){return this.x>=f.x&&this.y>=f.y}lerp(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5;return ze=Math.max(Math.min(1,ze),0),new $h(this.x+(f.x-this.x)*ze,this.y+(f.y-this.y)*ze)}distanceFrom(f){const ze=this.x-f.x,Ke=this.y-f.y;return Math.sqrt(ze*ze+Ke*Ke)}midPointFrom(f){return this.lerp(f)}min(f){return new $h(Math.min(this.x,f.x),Math.min(this.y,f.y))}max(f){return new $h(Math.max(this.x,f.x),Math.max(this.y,f.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(f,ze){return this.x=f,this.y=ze,this}setX(f){return this.x=f,this}setY(f){return this.y=f,this}setFromPoint(f){return this.x=f.x,this.y=f.y,this}swap(f){const ze=this.x,Ke=this.y;this.x=f.x,this.y=f.y,f.x=ze,f.y=Ke}clone(){return new $h(this.x,this.y)}rotate(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:at$1;const Ke=nt$1(f),Qe=rt$1(f),Pi=this.subtract(ze);return new $h(Pi.x*Qe-Pi.y*Ke,Pi.x*Ke+Pi.y*Qe).add(ze)}transform(f){let ze=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new $h(f[0]*this.x+f[2]*this.y+(ze?0:f[4]),f[1]*this.x+f[3]*this.y+(ze?0:f[5]))}};const at$1=new ot$1(0,0),ht$1=qe=>!!qe&&Array.isArray(qe._objects);function ct(qe){class f extends qe{constructor(){super(...arguments),t(this,"_objects",[])}_onObjectAdded(Ke){}_onObjectRemoved(Ke){}_onStackOrderChanged(Ke){}add(){for(var Ke=arguments.length,Qe=new Array(Ke),Pi=0;Pi<Ke;Pi++)Qe[Pi]=arguments[Pi];const nn=this._objects.push(...Qe);return Qe.forEach(ln=>this._onObjectAdded(ln)),nn}insertAt(Ke){for(var Qe=arguments.length,Pi=new Array(Qe>1?Qe-1:0),nn=1;nn<Qe;nn++)Pi[nn-1]=arguments[nn];return this._objects.splice(Ke,0,...Pi),Pi.forEach(ln=>this._onObjectAdded(ln)),this._objects.length}remove(){const Ke=this._objects,Qe=[];for(var Pi=arguments.length,nn=new Array(Pi),ln=0;ln<Pi;ln++)nn[ln]=arguments[ln];return nn.forEach(cn=>{const hn=Ke.indexOf(cn);hn!==-1&&(Ke.splice(hn,1),Qe.push(cn),this._onObjectRemoved(cn))}),Qe}forEachObject(Ke){this.getObjects().forEach((Qe,Pi,nn)=>Ke(Qe,Pi,nn))}getObjects(){for(var Ke=arguments.length,Qe=new Array(Ke),Pi=0;Pi<Ke;Pi++)Qe[Pi]=arguments[Pi];return Qe.length===0?[...this._objects]:this._objects.filter(nn=>nn.isType(...Qe))}item(Ke){return this._objects[Ke]}isEmpty(){return this._objects.length===0}size(){return this._objects.length}contains(Ke,Qe){return!!this._objects.includes(Ke)||!!Qe&&this._objects.some(Pi=>Pi instanceof f&&Pi.contains(Ke,!0))}complexity(){return this._objects.reduce((Ke,Qe)=>Ke+=Qe.complexity?Qe.complexity():0,0)}sendObjectToBack(Ke){return!(!Ke||Ke===this._objects[0])&&(it$1(this._objects,Ke),this._objects.unshift(Ke),this._onStackOrderChanged(Ke),!0)}bringObjectToFront(Ke){return!(!Ke||Ke===this._objects[this._objects.length-1])&&(it$1(this._objects,Ke),this._objects.push(Ke),this._onStackOrderChanged(Ke),!0)}sendObjectBackwards(Ke,Qe){if(!Ke)return!1;const Pi=this._objects.indexOf(Ke);if(Pi!==0){const nn=this.findNewLowerIndex(Ke,Pi,Qe);return it$1(this._objects,Ke),this._objects.splice(nn,0,Ke),this._onStackOrderChanged(Ke),!0}return!1}bringObjectForward(Ke,Qe){if(!Ke)return!1;const Pi=this._objects.indexOf(Ke);if(Pi!==this._objects.length-1){const nn=this.findNewUpperIndex(Ke,Pi,Qe);return it$1(this._objects,Ke),this._objects.splice(nn,0,Ke),this._onStackOrderChanged(Ke),!0}return!1}moveObjectTo(Ke,Qe){return Ke!==this._objects[Qe]&&(it$1(this._objects,Ke),this._objects.splice(Qe,0,Ke),this._onStackOrderChanged(Ke),!0)}findNewLowerIndex(Ke,Qe,Pi){let nn;if(Pi){nn=Qe;for(let ln=Qe-1;ln>=0;--ln)if(Ke.isOverlapping(this._objects[ln])){nn=ln;break}}else nn=Qe-1;return nn}findNewUpperIndex(Ke,Qe,Pi){let nn;if(Pi){nn=Qe;for(let ln=Qe+1;ln<this._objects.length;++ln)if(Ke.isOverlapping(this._objects[ln])){nn=ln;break}}else nn=Qe+1;return nn}collectObjects(Ke){let{left:Qe,top:Pi,width:nn,height:ln}=Ke,{includeIntersecting:cn=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const hn=[],un=new ot$1(Qe,Pi),xs=un.add(new ot$1(nn,ln));for(let zn=this._objects.length-1;zn>=0;zn--){const Xn=this._objects[zn];Xn.selectable&&Xn.visible&&(cn&&Xn.intersectsWithRect(un,xs)||Xn.isContainedWithinRect(un,xs)||cn&&Xn.containsPoint(un)||cn&&Xn.containsPoint(xs))&&hn.push(Xn)}return hn}}return f}class lt extends st$1{_setOptions(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};for(const ze in f)this.set(ze,f[ze])}_setObject(f){for(const ze in f)this._set(ze,f[ze])}set(f,ze){return typeof f=="object"?this._setObject(f):this._set(f,ze),this}_set(f,ze){this[f]=ze}toggle(f){const ze=this.get(f);return typeof ze=="boolean"&&this.set(f,!ze),this}get(f){return this[f]}}function ut$1(qe){return v().requestAnimationFrame(qe)}function dt$1(qe){return v().cancelAnimationFrame(qe)}let gt$1=0;const ft$1=()=>gt$1++,pt$1=()=>{const qe=m().createElement("canvas");if(!qe||qe.getContext===void 0)throw new h("Failed to create `canvas` element");return qe},mt$1=()=>m().createElement("img"),vt$1=qe=>{const f=pt$1();return f.width=qe.width,f.height=qe.height,f},yt$1=(qe,f,ze)=>qe.toDataURL("image/".concat(f),ze),_t$1=(qe,f,ze)=>new Promise((Ke,Qe)=>{qe.toBlob(Ke,"image/".concat(f),ze)}),xt$1=qe=>qe*S$1,Ct$1=qe=>qe/S$1,bt$1=qe=>qe.every((f,ze)=>f===T[ze]),wt$1=(qe,f,ze)=>new ot$1(qe).transform(f,ze),St$1=qe=>{const f=1/(qe[0]*qe[3]-qe[1]*qe[2]),ze=[f*qe[3],-f*qe[1],-f*qe[2],f*qe[0],0,0],{x:Ke,y:Qe}=new ot$1(qe[4],qe[5]).transform(ze,!0);return ze[4]=-Ke,ze[5]=-Qe,ze},Tt$1=(qe,f,ze)=>[qe[0]*f[0]+qe[2]*f[1],qe[1]*f[0]+qe[3]*f[1],qe[0]*f[2]+qe[2]*f[3],qe[1]*f[2]+qe[3]*f[3],ze?0:qe[0]*f[4]+qe[2]*f[5]+qe[4],ze?0:qe[1]*f[4]+qe[3]*f[5]+qe[5]],Ot$1=(qe,f)=>qe.reduceRight((ze,Ke)=>Ke&&ze?Tt$1(Ke,ze,f):Ke||ze,void 0)||T.concat(),kt$1=qe=>{let[f,ze]=qe;return Math.atan2(ze,f)},Dt$1=qe=>{const f=kt$1(qe),ze=Math.pow(qe[0],2)+Math.pow(qe[1],2),Ke=Math.sqrt(ze),Qe=(qe[0]*qe[3]-qe[2]*qe[1])/Ke,Pi=Math.atan2(qe[0]*qe[2]+qe[1]*qe[3],ze);return{angle:Ct$1(f),scaleX:Ke,scaleY:Qe,skewX:Ct$1(Pi),skewY:0,translateX:qe[4]||0,translateY:qe[5]||0}},Mt$1=function(qe){return[1,0,0,1,qe,arguments.length>1&&arguments[1]!==void 0?arguments[1]:0]};function Pt$1(){let{angle:qe=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{x:f=0,y:ze=0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const Ke=xt$1(qe),Qe=rt$1(Ke),Pi=nt$1(Ke);return[Qe,Pi,-Pi,Qe,f?f-(Qe*f-Pi*ze):0,ze?ze-(Pi*f+Qe*ze):0]}const Et$1=function(qe){return[qe,0,0,arguments.length>1&&arguments[1]!==void 0?arguments[1]:qe,0,0]},At$1=qe=>Math.tan(xt$1(qe)),jt$1=qe=>[1,0,At$1(qe),1,0,0],Ft$1=qe=>[1,At$1(qe),0,1,0,0],Lt$1=qe=>{let{scaleX:f=1,scaleY:ze=1,flipX:Ke=!1,flipY:Qe=!1,skewX:Pi=0,skewY:nn=0}=qe,ln=Et$1(Ke?-f:f,Qe?-ze:ze);return Pi&&(ln=Tt$1(ln,jt$1(Pi),!0)),nn&&(ln=Tt$1(ln,Ft$1(nn),!0)),ln},Rt$1=qe=>{const{translateX:f=0,translateY:ze=0,angle:Ke=0}=qe;let Qe=Mt$1(f,ze);Ke&&(Qe=Tt$1(Qe,Pt$1({angle:Ke})));const Pi=Lt$1(qe);return bt$1(Pi)||(Qe=Tt$1(Qe,Pi)),Qe},It$1=function(qe){let{signal:f,crossOrigin:ze=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(function(Ke,Qe){if(f&&f.aborted)return Qe(new c("loadImage"));const Pi=mt$1();let nn;f&&(nn=function(cn){Pi.src="",Qe(cn)},f.addEventListener("abort",nn,{once:!0}));const ln=function(){Pi.onload=Pi.onerror=null,nn&&(f==null||f.removeEventListener("abort",nn)),Ke(Pi)};qe?(Pi.onload=ln,Pi.onerror=function(){nn&&(f==null||f.removeEventListener("abort",nn)),Qe(new h("Error loading ".concat(Pi.src)))},ze&&(Pi.crossOrigin=ze),Pi.src=qe):ln()})},Bt$1=function(qe){let{signal:f,reviver:ze=C}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((Ke,Qe)=>{const Pi=[];f&&f.addEventListener("abort",Qe,{once:!0}),Promise.all(qe.map(nn=>tt.getClass(nn.type).fromObject(nn,{signal:f}).then(ln=>(ze(nn,ln),Pi.push(ln),ln)))).then(Ke).catch(nn=>{Pi.forEach(ln=>{ln.dispose&&ln.dispose()}),Qe(nn)}).finally(()=>{f&&f.removeEventListener("abort",Qe)})})},Xt$1=function(qe){let{signal:f}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((ze,Ke)=>{const Qe=[];f&&f.addEventListener("abort",Ke,{once:!0});const Pi=Object.values(qe).map(ln=>ln&&ln.type&&tt.has(ln.type)?Bt$1([ln],{signal:f}).then(cn=>{let[hn]=cn;return Qe.push(hn),hn}):ln),nn=Object.keys(qe);Promise.all(Pi).then(ln=>ln.reduce((cn,hn,un)=>(cn[nn[un]]=hn,cn),{})).then(ze).catch(ln=>{Qe.forEach(cn=>{cn.dispose&&cn.dispose()}),Ke(ln)}).finally(()=>{f&&f.removeEventListener("abort",Ke)})})},Yt$1=function(qe){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:[]).reduce((f,ze)=>(ze in qe&&(f[ze]=qe[ze]),f),{})},Wt$1=(qe,f)=>Object.keys(qe).reduce((ze,Ke)=>(f(qe[Ke],Ke,qe)&&(ze[Ke]=qe[Ke]),ze),{}),Vt$1=(qe,f)=>parseFloat(Number(qe).toFixed(f)),zt$1=qe=>"matrix("+qe.map(f=>Vt$1(f,o.NUM_FRACTION_DIGITS)).join(" ")+")",Gt$1=qe=>!!qe&&qe.toLive!==void 0,Ht$1=qe=>!!qe&&typeof qe.toObject=="function",Nt$1=qe=>!!qe&&qe.offsetX!==void 0&&"source"in qe,Ut$1=qe=>!!qe&&"multiSelectionStacking"in qe;function qt$1(qe){const f=qe&&Kt$1(qe);let ze=0,Ke=0;if(!qe||!f)return{left:ze,top:Ke};let Qe=qe;const Pi=f.documentElement,nn=f.body||{scrollLeft:0,scrollTop:0};for(;Qe&&(Qe.parentNode||Qe.host)&&(Qe=Qe.parentNode||Qe.host,Qe===f?(ze=nn.scrollLeft||Pi.scrollLeft||0,Ke=nn.scrollTop||Pi.scrollTop||0):(ze+=Qe.scrollLeft||0,Ke+=Qe.scrollTop||0),Qe.nodeType!==1||Qe.style.position!=="fixed"););return{left:ze,top:Ke}}const Kt$1=qe=>qe.ownerDocument||null,Jt$1=qe=>{var f;return((f=qe.ownerDocument)===null||f===void 0?void 0:f.defaultView)||null},Qt$1=function(qe,f,ze){let{width:Ke,height:Qe}=ze,Pi=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;qe.width=Ke,qe.height=Qe,Pi>1&&(qe.setAttribute("width",(Ke*Pi).toString()),qe.setAttribute("height",(Qe*Pi).toString()),f.scale(Pi,Pi))},Zt$1=(qe,f)=>{let{width:ze,height:Ke}=f;ze&&(qe.style.width=typeof ze=="number"?"".concat(ze,"px"):ze),Ke&&(qe.style.height=typeof Ke=="number"?"".concat(Ke,"px"):Ke)};function $t$1(qe){return qe.onselectstart!==void 0&&(qe.onselectstart=()=>!1),qe.style.userSelect=j$1,qe}let te$1=class{constructor(f){t(this,"_originalCanvasStyle",void 0),t(this,"lower",void 0);const ze=this.createLowerCanvas(f);this.lower={el:ze,ctx:ze.getContext("2d")}}createLowerCanvas(f){const ze=(Ke=f)&&Ke.getContext!==void 0?f:f&&m().getElementById(f)||pt$1();var Ke;if(ze.hasAttribute("data-fabric"))throw new h("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=ze.style.cssText,ze.setAttribute("data-fabric","main"),ze.classList.add("lower-canvas"),ze}cleanupDOM(f){let{width:ze,height:Ke}=f;const{el:Qe}=this.lower;Qe.classList.remove("lower-canvas"),Qe.removeAttribute("data-fabric"),Qe.setAttribute("width","".concat(ze)),Qe.setAttribute("height","".concat(Ke)),Qe.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(f,ze){const{el:Ke,ctx:Qe}=this.lower;Qt$1(Ke,Qe,f,ze)}setCSSDimensions(f){Zt$1(this.lower.el,f)}calcOffset(){return function(f){var ze;const Ke=f&&Kt$1(f),Qe={left:0,top:0};if(!Ke)return Qe;const Pi=((ze=Jt$1(f))===null||ze===void 0?void 0:ze.getComputedStyle(f,null))||{};Qe.left+=parseInt(Pi.borderLeftWidth,10)||0,Qe.top+=parseInt(Pi.borderTopWidth,10)||0,Qe.left+=parseInt(Pi.paddingLeft,10)||0,Qe.top+=parseInt(Pi.paddingTop,10)||0;let nn={left:0,top:0};const ln=Ke.documentElement;f.getBoundingClientRect!==void 0&&(nn=f.getBoundingClientRect());const cn=qt$1(f);return{left:nn.left+cn.left-(ln.clientLeft||0)+Qe.left,top:nn.top+cn.top-(ln.clientTop||0)+Qe.top}}(this.lower.el)}dispose(){p$1().dispose(this.lower.el),delete this.lower}};const ee$1={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...T]};let se$1=class tc extends ct(lt){get lowerCanvasEl(){var f;return(f=this.elements.lower)===null||f===void 0?void 0:f.el}get contextContainer(){var f;return(f=this.elements.lower)===null||f===void 0?void 0:f.ctx}static getDefaults(){return tc.ownDefaults}constructor(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(ze),this.initElements(f),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(f){this.elements=new te$1(f)}add(){const f=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),f}insertAt(f){for(var ze=arguments.length,Ke=new Array(ze>1?ze-1:0),Qe=1;Qe<ze;Qe++)Ke[Qe-1]=arguments[Qe];const Pi=super.insertAt(f,...Ke);return Ke.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),Pi}remove(){const f=super.remove(...arguments);return f.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),f}_onObjectAdded(f){f.canvas&&f.canvas!==this&&(a("warn",`Canvas is trying to add an object that belongs to a different canvas.
Resulting to default behavior: removing object from previous canvas and adding to new canvas`),f.canvas.remove(f)),f._set("canvas",this),f.setCoords(),this.fire("object:added",{target:f}),f.fire("added",{target:this})}_onObjectRemoved(f){f._set("canvas",void 0),this.fire("object:removed",{target:f}),f.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?y$1():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(f,ze){return this.setDimensions({width:f},ze)}setHeight(f,ze){return this.setDimensions({height:f},ze)}_setDimensionsImpl(f){let{cssOnly:ze=!1,backstoreOnly:Ke=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ze){const Qe=s({width:this.width,height:this.height},f);this.elements.setDimensions(Qe,this.getRetinaScaling()),this.hasLostContext=!0,this.width=Qe.width,this.height=Qe.height}Ke||this.elements.setCSSDimensions(f),this.calcOffset()}setDimensions(f,ze){this._setDimensionsImpl(f,ze),ze&&ze.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(f){this.viewportTransform=f,this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(f,ze){const Ke=f,Qe=[...this.viewportTransform],Pi=wt$1(f,St$1(Qe));Qe[0]=ze,Qe[3]=ze;const nn=wt$1(Pi,Qe);Qe[4]+=Ke.x-nn.x,Qe[5]+=Ke.y-nn.y,this.setViewportTransform(Qe)}setZoom(f){this.zoomToPoint(new ot$1(0,0),f)}absolutePan(f){const ze=[...this.viewportTransform];return ze[4]=-f.x,ze[5]=-f.y,this.setViewportTransform(ze)}relativePan(f){return this.absolutePan(new ot$1(-f.x-this.viewportTransform[4],-f.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(f){f.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=ut$1(()=>this.renderAndReset()))}calcViewportBoundaries(){const f=this.width,ze=this.height,Ke=St$1(this.viewportTransform),Qe=wt$1({x:0,y:0},Ke),Pi=wt$1({x:f,y:ze},Ke),nn=Qe.min(Pi),ln=Qe.max(Pi);return this.vptCoords={tl:nn,tr:new ot$1(ln.x,nn.y),bl:new ot$1(nn.x,ln.y),br:ln}}cancelRequestedRender(){this.nextRenderHandle&&(dt$1(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(f){}renderCanvas(f,ze){if(this.destroyed)return;const Ke=this.viewportTransform,Qe=this.clipPath;this.calcViewportBoundaries(),this.clearContext(f),f.imageSmoothingEnabled=this.imageSmoothingEnabled,f.patternQuality="best",this.fire("before:render",{ctx:f}),this._renderBackground(f),f.save(),f.transform(Ke[0],Ke[1],Ke[2],Ke[3],Ke[4],Ke[5]),this._renderObjects(f,ze),f.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(f),Qe&&(Qe._set("canvas",this),Qe.shouldCache(),Qe._transformDone=!0,Qe.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(f,Qe)),this._renderOverlay(f),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(f),this.fire("after:render",{ctx:f}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(f,ze){const Ke=this.viewportTransform;f.save(),f.transform(...Ke),f.globalCompositeOperation="destination-in",ze.transform(f),f.scale(1/ze.zoomX,1/ze.zoomY),f.drawImage(ze._cacheCanvas,-ze.cacheTranslationX,-ze.cacheTranslationY),f.restore()}_renderObjects(f,ze){for(let Ke=0,Qe=ze.length;Ke<Qe;++Ke)ze[Ke]&&ze[Ke].render(f)}_renderBackgroundOrOverlay(f,ze){const Ke=this["".concat(ze,"Color")],Qe=this["".concat(ze,"Image")],Pi=this.viewportTransform,nn=this["".concat(ze,"Vpt")];if(!Ke&&!Qe)return;const ln=Gt$1(Ke);if(Ke){if(f.save(),f.beginPath(),f.moveTo(0,0),f.lineTo(this.width,0),f.lineTo(this.width,this.height),f.lineTo(0,this.height),f.closePath(),f.fillStyle=ln?Ke.toLive(f):Ke,nn&&f.transform(...Pi),ln){f.transform(1,0,0,1,Ke.offsetX||0,Ke.offsetY||0);const cn=Ke.gradientTransform||Ke.patternTransform;cn&&f.transform(...cn)}f.fill(),f.restore()}if(Qe){f.save();const{skipOffscreen:cn}=this;this.skipOffscreen=nn,nn&&f.transform(...Pi),Qe.render(f),this.skipOffscreen=cn,f.restore()}}_renderBackground(f){this._renderBackgroundOrOverlay(f,"background")}_renderOverlay(f){this._renderBackgroundOrOverlay(f,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new ot$1(this.width/2,this.height/2)}centerObjectH(f){return this._centerObject(f,new ot$1(this.getCenterPoint().x,f.getCenterPoint().y))}centerObjectV(f){return this._centerObject(f,new ot$1(f.getCenterPoint().x,this.getCenterPoint().y))}centerObject(f){return this._centerObject(f,this.getCenterPoint())}viewportCenterObject(f){return this._centerObject(f,this.getVpCenter())}viewportCenterObjectH(f){return this._centerObject(f,new ot$1(this.getVpCenter().x,f.getCenterPoint().y))}viewportCenterObjectV(f){return this._centerObject(f,new ot$1(f.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return wt$1(this.getCenterPoint(),St$1(this.viewportTransform))}_centerObject(f,ze){f.setXY(ze,D$1,D$1),f.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(f){return this.toDatalessObject(f)}toObject(f){return this._toObjectMethod("toObject",f)}toJSON(){return this.toObject()}toDatalessObject(f){return this._toObjectMethod("toDatalessObject",f)}_toObjectMethod(f,ze){const Ke=this.clipPath,Qe=Ke&&!Ke.excludeFromExport?this._toObject(Ke,f,ze):null;return s(s(s({version:x$1},Yt$1(this,ze)),{},{objects:this._objects.filter(Pi=>!Pi.excludeFromExport).map(Pi=>this._toObject(Pi,f,ze))},this.__serializeBgOverlay(f,ze)),Qe?{clipPath:Qe}:null)}_toObject(f,ze,Ke){let Qe;this.includeDefaultValues||(Qe=f.includeDefaultValues,f.includeDefaultValues=!1);const Pi=f[ze](Ke);return this.includeDefaultValues||(f.includeDefaultValues=!!Qe),Pi}__serializeBgOverlay(f,ze){const Ke={},Qe=this.backgroundImage,Pi=this.overlayImage,nn=this.backgroundColor,ln=this.overlayColor;return Gt$1(nn)?nn.excludeFromExport||(Ke.background=nn.toObject(ze)):nn&&(Ke.background=nn),Gt$1(ln)?ln.excludeFromExport||(Ke.overlay=ln.toObject(ze)):ln&&(Ke.overlay=ln),Qe&&!Qe.excludeFromExport&&(Ke.backgroundImage=this._toObject(Qe,f,ze)),Pi&&!Pi.excludeFromExport&&(Ke.overlayImage=this._toObject(Pi,f,ze)),Ke}toSVG(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ze=arguments.length>1?arguments[1]:void 0;f.reviver=ze;const Ke=[];return this._setSVGPreamble(Ke,f),this._setSVGHeader(Ke,f),this.clipPath&&Ke.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,`)" >
`)),this._setSVGBgOverlayColor(Ke,"background"),this._setSVGBgOverlayImage(Ke,"backgroundImage",ze),this._setSVGObjects(Ke,ze),this.clipPath&&Ke.push(`</g>
`),this._setSVGBgOverlayColor(Ke,"overlay"),this._setSVGBgOverlayImage(Ke,"overlayImage",ze),Ke.push("</svg>"),Ke.join("")}_setSVGPreamble(f,ze){ze.suppressPreamble||f.push('<?xml version="1.0" encoding="',ze.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)}_setSVGHeader(f,ze){const Ke=ze.width||"".concat(this.width),Qe=ze.height||"".concat(this.height),Pi=o.NUM_FRACTION_DIGITS,nn=ze.viewBox;let ln;if(nn)ln='viewBox="'.concat(nn.x," ").concat(nn.y," ").concat(nn.width," ").concat(nn.height,'" ');else if(this.svgViewportTransformation){const cn=this.viewportTransform;ln='viewBox="'.concat(Vt$1(-cn[4]/cn[0],Pi)," ").concat(Vt$1(-cn[5]/cn[3],Pi)," ").concat(Vt$1(this.width/cn[0],Pi)," ").concat(Vt$1(this.height/cn[3],Pi),'" ')}else ln='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');f.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',Ke,'" ','height="',Qe,'" ',ln,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",x$1,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(ze),`</defs>
`)}createSVGClipPathMarkup(f){const ze=this.clipPath;return ze?(ze.clipPathId="CLIPPATH_".concat(ft$1()),'<clipPath id="'.concat(ze.clipPathId,`" >
`).concat(ze.toClipPathSVG(f.reviver),`</clipPath>
`)):""}createSVGRefElementsMarkup(){return["background","overlay"].map(f=>{const ze=this["".concat(f,"Color")];if(Gt$1(ze)){const Ke=this["".concat(f,"Vpt")],Qe=this.viewportTransform,Pi={isType:()=>!1,width:this.width/(Ke?Qe[0]:1),height:this.height/(Ke?Qe[3]:1)};return ze.toSVG(Pi,{additionalTransform:Ke?zt$1(Qe):""})}}).join("")}createSVGFontFacesMarkup(){const f=[],ze={},Ke=o.fontPaths;this._objects.forEach(function Pi(nn){f.push(nn),ht$1(nn)&&nn._objects.forEach(Pi)}),f.forEach(Pi=>{if(!(nn=Pi)||typeof nn._renderText!="function")return;var nn;const{styles:ln,fontFamily:cn}=Pi;!ze[cn]&&Ke[cn]&&(ze[cn]=!0,ln&&Object.values(ln).forEach(hn=>{Object.values(hn).forEach(un=>{let{fontFamily:xs=""}=un;!ze[xs]&&Ke[xs]&&(ze[xs]=!0)})}))});const Qe=Object.keys(ze).map(Pi=>`		@font-face {
			font-family: '`.concat(Pi,`';
			src: url('`).concat(Ke[Pi],`');
		}
`)).join("");return Qe?`	<style type="text/css"><![CDATA[
`.concat(Qe,`]]></style>
`):""}_setSVGObjects(f,ze){this.forEachObject(Ke=>{Ke.excludeFromExport||this._setSVGObject(f,Ke,ze)})}_setSVGObject(f,ze,Ke){f.push(ze.toSVG(Ke))}_setSVGBgOverlayImage(f,ze,Ke){const Qe=this[ze];Qe&&!Qe.excludeFromExport&&Qe.toSVG&&f.push(Qe.toSVG(Ke))}_setSVGBgOverlayColor(f,ze){const Ke=this["".concat(ze,"Color")];if(Ke)if(Gt$1(Ke)){const Qe=Ke.repeat||"",Pi=this.width,nn=this.height,ln=this["".concat(ze,"Vpt")]?zt$1(St$1(this.viewportTransform)):"";f.push('<rect transform="'.concat(ln," translate(").concat(Pi/2,",").concat(nn/2,')" x="').concat(Ke.offsetX-Pi/2,'" y="').concat(Ke.offsetY-nn/2,'" width="').concat(Qe!=="repeat-y"&&Qe!=="no-repeat"||!Nt$1(Ke)?Pi:Ke.source.width,'" height="').concat(Qe!=="repeat-x"&&Qe!=="no-repeat"||!Nt$1(Ke)?nn:Ke.source.height,'" fill="url(#SVGID_').concat(Ke.id,`)"></rect>
`))}else f.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',Ke,'"',`></rect>
`)}loadFromJSON(f,ze){let{signal:Ke}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!f)return Promise.reject(new h("`json` is undefined"));const Qe=typeof f=="string"?JSON.parse(f):f,{objects:Pi=[],backgroundImage:nn,background:ln,overlayImage:cn,overlay:hn,clipPath:un}=Qe,xs=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([Bt$1(Pi,{reviver:ze,signal:Ke}),Xt$1({backgroundImage:nn,backgroundColor:ln,overlayImage:cn,overlayColor:hn,clipPath:un},{signal:Ke})]).then(zn=>{let[Xn,ys]=zn;return this.clear(),this.add(...Xn),this.set(Qe),this.set(ys),this.renderOnAddRemove=xs,this})}clone(f){const ze=this.toObject(f);return this.cloneWithoutData().loadFromJSON(ze)}cloneWithoutData(){const f=vt$1(this);return new this.constructor(f)}toDataURL(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:ze="png",quality:Ke=1,multiplier:Qe=1,enableRetinaScaling:Pi=!1}=f,nn=Qe*(Pi?this.getRetinaScaling():1);return yt$1(this.toCanvasElement(nn,f),ze,Ke)}toBlob(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:ze="png",quality:Ke=1,multiplier:Qe=1,enableRetinaScaling:Pi=!1}=f,nn=Qe*(Pi?this.getRetinaScaling():1);return _t$1(this.toCanvasElement(nn,f),ze,Ke)}toCanvasElement(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,{width:ze,height:Ke,left:Qe,top:Pi,filter:nn}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const ln=(ze||this.width)*f,cn=(Ke||this.height)*f,hn=this.getZoom(),un=this.width,xs=this.height,zn=this.skipControlsDrawing,Xn=hn*f,ys=this.viewportTransform,Jo=[Xn,0,0,Xn,(ys[4]-(Qe||0))*f,(ys[5]-(Pi||0))*f],ea=this.enableRetinaScaling,ra=vt$1({width:ln,height:cn}),na=nn?this._objects.filter(ta=>nn(ta)):this._objects;return this.enableRetinaScaling=!1,this.viewportTransform=Jo,this.width=ln,this.height=cn,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(ra.getContext("2d"),na),this.viewportTransform=ys,this.width=un,this.height=xs,this.calcViewportBoundaries(),this.enableRetinaScaling=ea,this.skipControlsDrawing=zn,ra}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),et$1.cancelByCanvas(this),this.disposed=!0,new Promise((f,ze)=>{const Ke=()=>{this.destroy(),f(!0)};Ke.kill=ze,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?f(!1):this.nextRenderHandle?this.__cleanupTask=Ke:Ke()})}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject(f=>f.dispose()),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}};t(se$1,"ownDefaults",ee$1);const ie$1=["touchstart","touchmove","touchend"],re$1=qe=>{const f=qt$1(qe.target),ze=function(Ke){const Qe=Ke.changedTouches;return Qe&&Qe[0]?Qe[0]:Ke}(qe);return new ot$1(ze.clientX+f.left,ze.clientY+f.top)},ne$1=qe=>ie$1.includes(qe.type)||qe.pointerType==="touch",oe$1=qe=>{qe.preventDefault(),qe.stopPropagation()},ae$1=qe=>{let f=0,ze=0,Ke=0,Qe=0;for(let Pi=0,nn=qe.length;Pi<nn;Pi++){const{x:ln,y:cn}=qe[Pi];(ln>Ke||!Pi)&&(Ke=ln),(ln<f||!Pi)&&(f=ln),(cn>Qe||!Pi)&&(Qe=cn),(cn<ze||!Pi)&&(ze=cn)}return{left:f,top:ze,width:Ke-f,height:Qe-ze}},he$1=["translateX","translateY","scaleX","scaleY"],ce$1=(qe,f)=>le$1(qe,Tt$1(f,qe.calcOwnMatrix())),le$1=(qe,f)=>{const ze=Dt$1(f),{translateX:Ke,translateY:Qe,scaleX:Pi,scaleY:nn}=ze,ln=i(ze,he$1),cn=new ot$1(Ke,Qe);qe.flipX=!1,qe.flipY=!1,Object.assign(qe,ln),qe.set({scaleX:Pi,scaleY:nn}),qe.setPositionByOrigin(cn,D$1,D$1)},ue$1=qe=>{qe.scaleX=1,qe.scaleY=1,qe.skewX=0,qe.skewY=0,qe.flipX=!1,qe.flipY=!1,qe.rotate(0)},de$1=qe=>({scaleX:qe.scaleX,scaleY:qe.scaleY,skewX:qe.skewX,skewY:qe.skewY,angle:qe.angle,left:qe.left,flipX:qe.flipX,flipY:qe.flipY,top:qe.top}),ge$1=(qe,f,ze)=>{const Ke=qe/2,Qe=f/2,Pi=[new ot$1(-Ke,-Qe),new ot$1(Ke,-Qe),new ot$1(-Ke,Qe),new ot$1(Ke,Qe)].map(ln=>ln.transform(ze)),nn=ae$1(Pi);return new ot$1(nn.width,nn.height)},fe$1=function(){let qe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:T;return Tt$1(St$1(arguments.length>1&&arguments[1]!==void 0?arguments[1]:T),qe)},pe$1=function(qe){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:T,ze=arguments.length>2&&arguments[2]!==void 0?arguments[2]:T;return qe.transform(fe$1(f,ze))},me$1=function(qe){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:T,ze=arguments.length>2&&arguments[2]!==void 0?arguments[2]:T;return qe.transform(fe$1(f,ze),!0)},ve$1=(qe,f,ze)=>{const Ke=fe$1(f,ze);return le$1(qe,Tt$1(Ke,qe.calcOwnMatrix())),Ke},ye$1=(qe,f)=>{var ze;const{transform:{target:Ke}}=f;(ze=Ke.canvas)===null||ze===void 0||ze.fire("object:".concat(qe),s(s({},f),{},{target:Ke})),Ke.fire(qe,f)},_e={left:-.5,top:-.5,center:0,bottom:.5,right:.5},xe$1=qe=>typeof qe=="string"?_e[qe]:qe-.5,Ce$1="not-allowed";function be$1(qe){return xe$1(qe.originX)===xe$1(D$1)&&xe$1(qe.originY)===xe$1(D$1)}function we$1(qe){return .5-xe$1(qe)}const Se$1=(qe,f)=>qe[f],Te$1=(qe,f,ze,Ke)=>({e:qe,transform:f,pointer:new ot$1(ze,Ke)});function Oe$1(qe,f){const ze=qe.getTotalAngle()+Ct$1(Math.atan2(f.y,f.x))+360;return Math.round(ze%360/45)}function ke$1(qe,f,ze,Ke,Qe){var Pi;let{target:nn,corner:ln}=qe;const cn=nn.controls[ln],hn=((Pi=nn.canvas)===null||Pi===void 0?void 0:Pi.getZoom())||1,un=nn.padding/hn,xs=function(zn,Xn,ys,Jo){const ea=zn.getRelativeCenterPoint(),ra=ys!==void 0&&Jo!==void 0?zn.translateToGivenOrigin(ea,D$1,D$1,ys,Jo):new ot$1(zn.left,zn.top);return(zn.angle?Xn.rotate(-xt$1(zn.angle),ea):Xn).subtract(ra)}(nn,new ot$1(Ke,Qe),f,ze);return xs.x>=un&&(xs.x-=un),xs.x<=-un&&(xs.x+=un),xs.y>=un&&(xs.y-=un),xs.y<=un&&(xs.y+=un),xs.x-=cn.offsetX,xs.y-=cn.offsetY,xs}const De$1=(qe,f,ze,Ke)=>{const{target:Qe,offsetX:Pi,offsetY:nn}=f,ln=ze-Pi,cn=Ke-nn,hn=!Se$1(Qe,"lockMovementX")&&Qe.left!==ln,un=!Se$1(Qe,"lockMovementY")&&Qe.top!==cn;return hn&&Qe.set(M$1,ln),un&&Qe.set(P,cn),(hn||un)&&ye$1(L,Te$1(qe,f,ze,Ke)),hn||un},Me$1={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},Pe$1=(qe,f,ze)=>(ze<0&&(ze+=1),ze>1&&(ze-=1),ze<1/6?qe+6*(f-qe)*ze:ze<.5?f:ze<2/3?qe+(f-qe)*(2/3-ze)*6:qe),Ee$1=(qe,f,ze,Ke)=>{qe/=255,f/=255,ze/=255;const Qe=Math.max(qe,f,ze),Pi=Math.min(qe,f,ze);let nn,ln;const cn=(Qe+Pi)/2;if(Qe===Pi)nn=ln=0;else{const hn=Qe-Pi;switch(ln=cn>.5?hn/(2-Qe-Pi):hn/(Qe+Pi),Qe){case qe:nn=(f-ze)/hn+(f<ze?6:0);break;case f:nn=(ze-qe)/hn+2;break;case ze:nn=(qe-f)/hn+4}nn/=6}return[Math.round(360*nn),Math.round(100*ln),Math.round(100*cn),Ke]},Ae$1=function(){let qe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"1";return parseFloat(qe)/(qe.endsWith("%")?100:1)},je=qe=>Math.min(Math.round(qe),255).toString(16).toUpperCase().padStart(2,"0"),Fe$1=qe=>{let[f,ze,Ke,Qe=1]=qe;const Pi=Math.round(.3*f+.59*ze+.11*Ke);return[Pi,Pi,Pi,Qe]};let Le$1=class Rh{constructor(f){if(t(this,"isUnrecognised",!1),f)if(f instanceof Rh)this.setSource([...f._source]);else if(Array.isArray(f)){const[ze,Ke,Qe,Pi=1]=f;this.setSource([ze,Ke,Qe,Pi])}else this.setSource(this._tryParsingColor(f));else this.setSource([0,0,0,1])}_tryParsingColor(f){return(f=f.toLowerCase())in Me$1&&(f=Me$1[f]),f==="transparent"?[255,255,255,0]:Rh.sourceFromHex(f)||Rh.sourceFromRgb(f)||Rh.sourceFromHsl(f)||(this.isUnrecognised=!0)&&[0,0,0,1]}getSource(){return this._source}setSource(f){this._source=f}toRgb(){const[f,ze,Ke]=this.getSource();return"rgb(".concat(f,",").concat(ze,",").concat(Ke,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){const[f,ze,Ke]=Ee$1(...this.getSource());return"hsl(".concat(f,",").concat(ze,"%,").concat(Ke,"%)")}toHsla(){const[f,ze,Ke,Qe]=Ee$1(...this.getSource());return"hsla(".concat(f,",").concat(ze,"%,").concat(Ke,"%,").concat(Qe,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){const[f,ze,Ke,Qe]=this.getSource();return"".concat(je(f)).concat(je(ze)).concat(je(Ke)).concat(je(Math.round(255*Qe)))}getAlpha(){return this.getSource()[3]}setAlpha(f){return this._source[3]=f,this}toGrayscale(){return this.setSource(Fe$1(this.getSource())),this}toBlackWhite(f){const[ze,,,Ke]=Fe$1(this.getSource()),Qe=ze<(f||127)?0:255;return this.setSource([Qe,Qe,Qe,Ke]),this}overlayWith(f){f instanceof Rh||(f=new Rh(f));const ze=this.getSource(),Ke=f.getSource(),[Qe,Pi,nn]=ze.map((ln,cn)=>Math.round(.5*ln+.5*Ke[cn]));return this.setSource([Qe,Pi,nn,ze[3]]),this}static fromRgb(f){return Rh.fromRgba(f)}static fromRgba(f){return new Rh(Rh.sourceFromRgb(f))}static sourceFromRgb(f){const ze=f.match(/^rgba?\(\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d{0,3}(?:\.\d+)?%?)\s*)?\)$/i);if(ze){const[Ke,Qe,Pi]=ze.slice(1,4).map(nn=>{const ln=parseFloat(nn);return nn.endsWith("%")?Math.round(2.55*ln):ln});return[Ke,Qe,Pi,Ae$1(ze[4])]}}static fromHsl(f){return Rh.fromHsla(f)}static fromHsla(f){return new Rh(Rh.sourceFromHsl(f))}static sourceFromHsl(f){const ze=f.match(/^hsla?\(\s*([+-]?\d{0,3}(?:\.\d+)?(?:deg|turn|rad)?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d*(?:\.\d+)?%?)\s*)?\)$/i);if(!ze)return;const Ke=(Rh.parseAngletoDegrees(ze[1])%360+360)%360/360,Qe=parseFloat(ze[2])/100,Pi=parseFloat(ze[3])/100;let nn,ln,cn;if(Qe===0)nn=ln=cn=Pi;else{const hn=Pi<=.5?Pi*(Qe+1):Pi+Qe-Pi*Qe,un=2*Pi-hn;nn=Pe$1(un,hn,Ke+1/3),ln=Pe$1(un,hn,Ke),cn=Pe$1(un,hn,Ke-1/3)}return[Math.round(255*nn),Math.round(255*ln),Math.round(255*cn),Ae$1(ze[4])]}static fromHex(f){return new Rh(Rh.sourceFromHex(f))}static sourceFromHex(f){if(f.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){const ze=f.slice(f.indexOf("#")+1);let Ke;Ke=ze.length<=4?ze.split("").map(cn=>cn+cn):ze.match(/.{2}/g);const[Qe,Pi,nn,ln=255]=Ke.map(cn=>parseInt(cn,16));return[Qe,Pi,nn,ln/255]}}static parseAngletoDegrees(f){const ze=f.toLowerCase(),Ke=parseFloat(ze);return ze.includes("rad")?Ct$1(Ke):ze.includes("turn")?360*Ke:Ke}};const Re$1=function(qe){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:O$1;const ze=/\D{0,2}$/.exec(qe),Ke=parseFloat(qe),Qe=o.DPI;switch(ze==null?void 0:ze[0]){case"mm":return Ke*Qe/25.4;case"cm":return Ke*Qe/2.54;case"in":return Ke*Qe;case"pt":return Ke*Qe/72;case"pc":return Ke*Qe/72*12;case"em":return Ke*f;default:return Ke}},Ie$1=qe=>{const[f,ze]=qe.trim().split(" "),[Ke,Qe]=(Pi=f)&&Pi!==j$1?[Pi.slice(1,4),Pi.slice(5,8)]:Pi===j$1?[Pi,Pi]:["Mid","Mid"];var Pi;return{meetOrSlice:ze||"meet",alignX:Ke,alignY:Qe}},Be$1=function(qe,f){let ze,Ke,Qe=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];if(f)if(f.toLive)ze="url(#SVGID_".concat(f.id,")");else{const Pi=new Le$1(f),nn=Pi.getAlpha();ze=Pi.toRgb(),nn!==1&&(Ke=nn.toString())}else ze="none";return Qe?"".concat(qe,": ").concat(ze,"; ").concat(Ke?"".concat(qe,"-opacity: ").concat(Ke,"; "):""):"".concat(qe,'="').concat(ze,'" ').concat(Ke?"".concat(qe,'-opacity="').concat(Ke,'" '):"")};class Xe{getSvgStyles(f){const ze=this.fillRule?this.fillRule:"nonzero",Ke=this.strokeWidth?this.strokeWidth:"0",Qe=this.strokeDashArray?this.strokeDashArray.join(" "):j$1,Pi=this.strokeDashOffset?this.strokeDashOffset:"0",nn=this.strokeLineCap?this.strokeLineCap:"butt",ln=this.strokeLineJoin?this.strokeLineJoin:"miter",cn=this.strokeMiterLimit?this.strokeMiterLimit:"4",hn=this.opacity!==void 0?this.opacity:"1",un=this.visible?"":" visibility: hidden;",xs=f?"":this.getSvgFilter(),zn=Be$1(K$1,this.fill);return[Be$1(J,this.stroke),"stroke-width: ",Ke,"; ","stroke-dasharray: ",Qe,"; ","stroke-linecap: ",nn,"; ","stroke-dashoffset: ",Pi,"; ","stroke-linejoin: ",ln,"; ","stroke-miterlimit: ",cn,"; ",zn,"fill-rule: ",ze,"; ","opacity: ",hn,";",xs,un].join("")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const Ke=f?this.calcTransformMatrix():this.calcOwnMatrix(),Qe='transform="'.concat(zt$1(Ke));return"".concat(Qe).concat(ze,'" ')}_toSVG(f){return[""]}toSVG(f){return this._createBaseSVGMarkup(this._toSVG(f),{reviver:f})}toClipPathSVG(f){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(f),{reviver:f})}_createBaseClipPathSVGMarkup(f){let{reviver:ze,additionalTransform:Ke=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const Qe=[this.getSvgTransform(!0,Ke),this.getSvgCommons()].join(""),Pi=f.indexOf("COMMON_PARTS");return f[Pi]=Qe,ze?ze(f.join("")):f.join("")}_createBaseSVGMarkup(f){let{noStyle:ze,reviver:Ke,withShadow:Qe,additionalTransform:Pi}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const nn=ze?"":'style="'.concat(this.getSvgStyles(),'" '),ln=Qe?'style="'.concat(this.getSvgFilter(),'" '):"",cn=this.clipPath,hn=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",un=cn&&cn.absolutePositioned,xs=this.stroke,zn=this.fill,Xn=this.shadow,ys=[],Jo=f.indexOf("COMMON_PARTS");let ea;cn&&(cn.clipPathId="CLIPPATH_".concat(ft$1()),ea='<clipPath id="'.concat(cn.clipPathId,`" >
`).concat(cn.toClipPathSVG(Ke),`</clipPath>
`)),un&&ys.push("<g ",ln,this.getSvgCommons(),` >
`),ys.push("<g ",this.getSvgTransform(!1),un?"":ln+this.getSvgCommons(),` >
`);const ra=[nn,hn,ze?"":this.addPaintOrder()," ",Pi?'transform="'.concat(Pi,'" '):""].join("");return f[Jo]=ra,Gt$1(zn)&&ys.push(zn.toSVG(this)),Gt$1(xs)&&ys.push(xs.toSVG(this)),Xn&&ys.push(Xn.toSVG(this)),cn&&ys.push(ea),ys.push(f.join("")),ys.push(`</g>
`),un&&ys.push(`</g>
`),Ke?Ke(ys.join("")):ys.join("")}addPaintOrder(){return this.paintFirst!==K$1?' paint-order="'.concat(this.paintFirst,'" '):""}}function Ye(qe){return new RegExp("^("+qe.join("|")+")\\b","i")}var We;const Ve$1=String.raw(We||(We=r(["(?:[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?)"],["(?:[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?)"]))),Ge=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+Ve$1+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+Ve$1+"))?\\s+(.*)"),He$1={cx:M$1,x:M$1,r:"radius",cy:P,y:P,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},Ne$1="font-size",Ue="clip-path";Ye(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]);Ye(["symbol","image","marker","pattern","view","svg"]);const Je=Ye(["symbol","g","a","svg","clipPath","defs"]),Ze=new ot$1(1,0),$e=new ot$1,ts=(qe,f)=>qe.rotate(f),es=(qe,f)=>new ot$1(f).subtract(qe),ss=qe=>qe.distanceFrom($e),is=(qe,f)=>Math.atan2(as(qe,f),hs(qe,f)),rs=qe=>is(Ze,qe),ns=qe=>qe.eq($e)?qe:qe.scalarDivide(ss(qe)),os=function(qe){let f=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return ns(new ot$1(-qe.y,qe.x).scalarMultiply(f?1:-1))},as=(qe,f)=>qe.x*f.y-qe.y*f.x,hs=(qe,f)=>qe.x*f.x+qe.y*f.y,cs=(qe,f,ze)=>{if(qe.eq(f)||qe.eq(ze))return!0;const Ke=as(f,ze),Qe=as(f,qe),Pi=as(ze,qe);return Ke>=0?Qe>=0&&Pi<=0:!(Qe<=0&&Pi>=0)},ls="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",us=new RegExp("(?:\\s|^)"+ls+ls+"("+Ve$1+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class ds{constructor(f){const ze=typeof f=="string"?ds.parseShadow(f):f;Object.assign(this,ds.ownDefaults,ze),this.id=ft$1()}static parseShadow(f){const ze=f.trim(),[,Ke=0,Qe=0,Pi=0]=(us.exec(ze)||[]).map(nn=>parseFloat(nn)||0);return{color:(ze.replace(us,"")||"rgb(0,0,0)").trim(),offsetX:Ke,offsetY:Qe,blur:Pi}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(f){const ze=ts(new ot$1(this.offsetX,this.offsetY),xt$1(-f.angle)),Ke=new Le$1(this.color);let Qe=40,Pi=40;return f.width&&f.height&&(Qe=100*Vt$1((Math.abs(ze.x)+this.blur)/f.width,o.NUM_FRACTION_DIGITS)+20,Pi=100*Vt$1((Math.abs(ze.y)+this.blur)/f.height,o.NUM_FRACTION_DIGITS)+20),f.flipX&&(ze.x*=-1),f.flipY&&(ze.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(Pi,'%" height="').concat(100+2*Pi,'%" x="-').concat(Qe,'%" width="').concat(100+2*Qe,`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`).concat(Vt$1(this.blur?this.blur/2:0,o.NUM_FRACTION_DIGITS),`"></feGaussianBlur>
	<feOffset dx="`).concat(Vt$1(ze.x,o.NUM_FRACTION_DIGITS),'" dy="').concat(Vt$1(ze.y,o.NUM_FRACTION_DIGITS),`" result="oBlur" ></feOffset>
	<feFlood flood-color="`).concat(Ke.toRgb(),'" flood-opacity="').concat(Ke.getAlpha(),`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`)}toObject(){const f={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},ze=ds.ownDefaults;return this.includeDefaultValues?f:Wt$1(f,(Ke,Qe)=>Ke!==ze[Qe])}static async fromObject(f){return new this(f)}}t(ds,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),t(ds,"type","shadow"),tt.setClass(ds,"shadow");const gs=(qe,f,ze)=>Math.max(qe,Math.min(f,ze)),fs=[P,M$1,H,N$1,"flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible",U,q],ps=[K$1,J,"strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],ms={top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:M$1,originY:P,strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:K$1,fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0},_s=(qe,f,ze,Ke)=>-ze*Math.cos(qe/Ke*b)+ze+f,ws=()=>!1;class Ss{constructor(f){let{startValue:ze,byValue:Ke,duration:Qe=500,delay:Pi=0,easing:nn=_s,onStart:ln=C,onChange:cn=C,onComplete:hn=C,abort:un=ws,target:xs}=f;t(this,"_state","pending"),t(this,"durationProgress",0),t(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=Qe,this.delay=Pi,this.easing=nn,this._onStart=ln,this._onChange=cn,this._onComplete=hn,this._abort=un,this.target=xs,this.startValue=ze,this.byValue=Ke,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return this._state==="aborted"||this._state==="completed"}start(){const f=ze=>{this._state==="pending"&&(this.startTime=ze||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout(()=>ut$1(f),this.delay):ut$1(f)}tick(f){const ze=(f||+new Date)-this.startTime,Ke=Math.min(ze,this.duration);this.durationProgress=Ke/this.duration;const{value:Qe,valueProgress:Pi}=this.calculate(Ke);this.value=Object.freeze(Qe),this.valueProgress=Pi,this._state!=="aborted"&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):ze>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),ut$1(this.tick)))}register(){et$1.push(this)}unregister(){et$1.remove(this)}abort(){this._state="aborted",this.unregister()}}const Ts=["startValue","endValue"];class Os extends Ss{constructor(f){let{startValue:ze=0,endValue:Ke=100}=f;super(s(s({},i(f,Ts)),{},{startValue:ze,byValue:Ke-ze}))}calculate(f){const ze=this.easing(f,this.startValue,this.byValue,this.duration);return{value:ze,valueProgress:Math.abs((ze-this.startValue)/this.byValue)}}}const ks=["startValue","endValue"];class Ds extends Ss{constructor(f){let{startValue:ze=[0],endValue:Ke=[100]}=f;super(s(s({},i(f,ks)),{},{startValue:ze,byValue:Ke.map((Qe,Pi)=>Qe-ze[Pi])}))}calculate(f){const ze=this.startValue.map((Ke,Qe)=>this.easing(f,Ke,this.byValue[Qe],this.duration,Qe));return{value:ze,valueProgress:Math.abs((ze[0]-this.startValue[0])/this.byValue[0])}}}const Ms=["startValue","endValue","easing","onChange","onComplete","abort"],Ps=(qe,f,ze,Ke)=>f+ze*(1-Math.cos(qe/Ke*b)),Es=qe=>qe&&((f,ze,Ke)=>qe(new Le$1(f).toRgba(),ze,Ke));class As extends Ss{constructor(f){let{startValue:ze,endValue:Ke,easing:Qe=Ps,onChange:Pi,onComplete:nn,abort:ln}=f,cn=i(f,Ms);const hn=new Le$1(ze).getSource(),un=new Le$1(Ke).getSource();super(s(s({},cn),{},{startValue:hn,byValue:un.map((xs,zn)=>xs-hn[zn]),easing:Qe,onChange:Es(Pi),onComplete:Es(nn),abort:Es(ln)}))}calculate(f){const[ze,Ke,Qe,Pi]=this.startValue.map((ln,cn)=>this.easing(f,ln,this.byValue[cn],this.duration,cn)),nn=[...[ze,Ke,Qe].map(Math.round),gs(0,Pi,1)];return{value:nn,valueProgress:nn.map((ln,cn)=>this.byValue[cn]!==0?Math.abs((ln-this.startValue[cn])/this.byValue[cn]):0).find(ln=>ln!==0)||0}}}function js(qe){const f=(ze=>Array.isArray(ze.startValue)||Array.isArray(ze.endValue))(qe)?new Ds(qe):new Os(qe);return f.start(),f}function Fs(qe){const f=new As(qe);return f.start(),f}class Ls{constructor(f){this.status=f,this.points=[]}includes(f){return this.points.some(ze=>ze.eq(f))}append(){for(var f=arguments.length,ze=new Array(f),Ke=0;Ke<f;Ke++)ze[Ke]=arguments[Ke];return this.points=this.points.concat(ze.filter(Qe=>!this.includes(Qe))),this}static isPointContained(f,ze,Ke){let Qe=arguments.length>3&&arguments[3]!==void 0&&arguments[3];if(ze.eq(Ke))return f.eq(ze);if(ze.x===Ke.x)return f.x===ze.x&&(Qe||f.y>=Math.min(ze.y,Ke.y)&&f.y<=Math.max(ze.y,Ke.y));if(ze.y===Ke.y)return f.y===ze.y&&(Qe||f.x>=Math.min(ze.x,Ke.x)&&f.x<=Math.max(ze.x,Ke.x));{const Pi=es(ze,Ke),nn=es(ze,f).divide(Pi);return Qe?Math.abs(nn.x)===Math.abs(nn.y):nn.x===nn.y&&nn.x>=0&&nn.x<=1}}static isPointInPolygon(f,ze){const Ke=new ot$1(f).setX(Math.min(f.x-1,...ze.map(Pi=>Pi.x)));let Qe=0;for(let Pi=0;Pi<ze.length;Pi++){const nn=this.intersectSegmentSegment(ze[Pi],ze[(Pi+1)%ze.length],f,Ke);if(nn.includes(f))return!0;Qe+=+(nn.status==="Intersection")}return Qe%2==1}static intersectLineLine(f,ze,Ke,Qe){let Pi=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4],nn=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5];const ln=ze.x-f.x,cn=ze.y-f.y,hn=Qe.x-Ke.x,un=Qe.y-Ke.y,xs=f.x-Ke.x,zn=f.y-Ke.y,Xn=hn*zn-un*xs,ys=ln*zn-cn*xs,Jo=un*ln-hn*cn;if(Jo!==0){const ea=Xn/Jo,ra=ys/Jo;return(Pi||0<=ea&&ea<=1)&&(nn||0<=ra&&ra<=1)?new Ls("Intersection").append(new ot$1(f.x+ea*ln,f.y+ea*cn)):new Ls}if(Xn===0||ys===0){const ea=Pi||nn||Ls.isPointContained(f,Ke,Qe)||Ls.isPointContained(ze,Ke,Qe)||Ls.isPointContained(Ke,f,ze)||Ls.isPointContained(Qe,f,ze);return new Ls(ea?"Coincident":void 0)}return new Ls("Parallel")}static intersectSegmentLine(f,ze,Ke,Qe){return Ls.intersectLineLine(f,ze,Ke,Qe,!1,!0)}static intersectSegmentSegment(f,ze,Ke,Qe){return Ls.intersectLineLine(f,ze,Ke,Qe,!1,!1)}static intersectLinePolygon(f,ze,Ke){let Qe=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];const Pi=new Ls,nn=Ke.length;for(let ln,cn,hn,un=0;un<nn;un++){if(ln=Ke[un],cn=Ke[(un+1)%nn],hn=Ls.intersectLineLine(f,ze,ln,cn,Qe,!1),hn.status==="Coincident")return hn;Pi.append(...hn.points)}return Pi.points.length>0&&(Pi.status="Intersection"),Pi}static intersectSegmentPolygon(f,ze,Ke){return Ls.intersectLinePolygon(f,ze,Ke,!1)}static intersectPolygonPolygon(f,ze){const Ke=new Ls,Qe=f.length,Pi=[];for(let nn=0;nn<Qe;nn++){const ln=f[nn],cn=f[(nn+1)%Qe],hn=Ls.intersectSegmentPolygon(ln,cn,ze);hn.status==="Coincident"?(Pi.push(hn),Ke.append(ln,cn)):Ke.append(...hn.points)}return Pi.length>0&&Pi.length===f.length?new Ls("Coincident"):(Ke.points.length>0&&(Ke.status="Intersection"),Ke)}static intersectPolygonRectangle(f,ze,Ke){const Qe=ze.min(Ke),Pi=ze.max(Ke),nn=new ot$1(Pi.x,Qe.y),ln=new ot$1(Qe.x,Pi.y);return Ls.intersectPolygonPolygon(f,[Qe,nn,Pi,ln])}}class Rs extends lt{getX(){return this.getXY().x}setX(f){this.setXY(this.getXY().setX(f))}getY(){return this.getXY().y}setY(f){this.setXY(this.getXY().setY(f))}getRelativeX(){return this.left}setRelativeX(f){this.left=f}getRelativeY(){return this.top}setRelativeY(f){this.top=f}getXY(){const f=this.getRelativeXY();return this.group?wt$1(f,this.group.calcTransformMatrix()):f}setXY(f,ze,Ke){this.group&&(f=wt$1(f,St$1(this.group.calcTransformMatrix()))),this.setRelativeXY(f,ze,Ke)}getRelativeXY(){return new ot$1(this.left,this.top)}setRelativeXY(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.originX,Ke=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.originY;this.setPositionByOrigin(f,ze,Ke)}isStrokeAccountedForInDimensions(){return!1}getCoords(){const{tl:f,tr:ze,br:Ke,bl:Qe}=this.aCoords||(this.aCoords=this.calcACoords()),Pi=[f,ze,Ke,Qe];if(this.group){const nn=this.group.calcTransformMatrix();return Pi.map(ln=>wt$1(ln,nn))}return Pi}intersectsWithRect(f,ze){return Ls.intersectPolygonRectangle(this.getCoords(),f,ze).status==="Intersection"}intersectsWithObject(f){const ze=Ls.intersectPolygonPolygon(this.getCoords(),f.getCoords());return ze.status==="Intersection"||ze.status==="Coincident"||f.isContainedWithinObject(this)||this.isContainedWithinObject(f)}isContainedWithinObject(f){return this.getCoords().every(ze=>f.containsPoint(ze))}isContainedWithinRect(f,ze){const{left:Ke,top:Qe,width:Pi,height:nn}=this.getBoundingRect();return Ke>=f.x&&Ke+Pi<=ze.x&&Qe>=f.y&&Qe+nn<=ze.y}isOverlapping(f){return this.intersectsWithObject(f)||this.isContainedWithinObject(f)||f.isContainedWithinObject(this)}containsPoint(f){return Ls.isPointInPolygon(f,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;const{tl:f,br:ze}=this.canvas.vptCoords;return!!this.getCoords().some(Ke=>Ke.x<=ze.x&&Ke.x>=f.x&&Ke.y<=ze.y&&Ke.y>=f.y)||!!this.intersectsWithRect(f,ze)||this.containsPoint(f.midPointFrom(ze))}isPartiallyOnScreen(){if(!this.canvas)return!1;const{tl:f,br:ze}=this.canvas.vptCoords;return this.intersectsWithRect(f,ze)?!0:this.getCoords().every(Ke=>(Ke.x>=ze.x||Ke.x<=f.x)&&(Ke.y>=ze.y||Ke.y<=f.y))&&this.containsPoint(f.midPointFrom(ze))}getBoundingRect(){return ae$1(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(f){this._set(H,f),this._set(N$1,f),this.setCoords()}scaleToWidth(f){const ze=this.getBoundingRect().width/this.getScaledWidth();return this.scale(f/this.width/ze)}scaleToHeight(f){const ze=this.getBoundingRect().height/this.getScaledHeight();return this.scale(f/this.height/ze)}getCanvasRetinaScaling(){var f;return((f=this.canvas)===null||f===void 0?void 0:f.getRetinaScaling())||1}getTotalAngle(){return this.group?Ct$1(kt$1(this.calcTransformMatrix())):this.angle}getViewportTransform(){var f;return((f=this.canvas)===null||f===void 0?void 0:f.viewportTransform)||T.concat()}calcACoords(){const f=Pt$1({angle:this.angle}),{x:ze,y:Ke}=this.getRelativeCenterPoint(),Qe=Mt$1(ze,Ke),Pi=Tt$1(Qe,f),nn=this._getTransformedDimensions(),ln=nn.x/2,cn=nn.y/2;return{tl:wt$1({x:-ln,y:-cn},Pi),tr:wt$1({x:ln,y:-cn},Pi),bl:wt$1({x:-ln,y:cn},Pi),br:wt$1({x:ln,y:cn},Pi)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let f=arguments.length>0&&arguments[0]!==void 0&&arguments[0],ze=[];return!f&&this.group&&(ze=this.group.transformMatrixKey(f)),ze.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,xe$1(this.originX),xe$1(this.originY)),ze}calcTransformMatrix(){let f=arguments.length>0&&arguments[0]!==void 0&&arguments[0],ze=this.calcOwnMatrix();if(f||!this.group)return ze;const Ke=this.transformMatrixKey(f),Qe=this.matrixCache;return Qe&&Qe.key.every((Pi,nn)=>Pi===Ke[nn])?Qe.value:(this.group&&(ze=Tt$1(this.group.calcTransformMatrix(!1),ze)),this.matrixCache={key:Ke,value:ze},ze)}calcOwnMatrix(){const f=this.transformMatrixKey(!0),ze=this.ownMatrixCache;if(ze&&ze.key===f)return ze.value;const Ke=this.getRelativeCenterPoint(),Qe={angle:this.angle,translateX:Ke.x,translateY:Ke.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},Pi=Rt$1(Qe);return this.ownMatrixCache={key:f,value:Pi},Pi}_getNonTransformedDimensions(){return new ot$1(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(f){return this._getTransformedDimensions(f).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}_getTransformedDimensions(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const ze=s({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},f),Ke=ze.strokeWidth;let Qe=Ke,Pi=0;this.strokeUniform&&(Qe=0,Pi=Ke);const nn=ze.width+Qe,ln=ze.height+Qe;let cn;return cn=ze.skewX===0&&ze.skewY===0?new ot$1(nn*ze.scaleX,ln*ze.scaleY):ge$1(nn,ln,Lt$1(ze)),cn.scalarAdd(Pi)}translateToGivenOrigin(f,ze,Ke,Qe,Pi){let nn=f.x,ln=f.y;const cn=xe$1(Qe)-xe$1(ze),hn=xe$1(Pi)-xe$1(Ke);if(cn||hn){const un=this._getTransformedDimensions();nn+=cn*un.x,ln+=hn*un.y}return new ot$1(nn,ln)}translateToCenterPoint(f,ze,Ke){if(ze===D$1&&Ke===D$1)return f;const Qe=this.translateToGivenOrigin(f,ze,Ke,D$1,D$1);return this.angle?Qe.rotate(xt$1(this.angle),f):Qe}translateToOriginPoint(f,ze,Ke){const Qe=this.translateToGivenOrigin(f,D$1,D$1,ze,Ke);return this.angle?Qe.rotate(xt$1(this.angle),f):Qe}getCenterPoint(){const f=this.getRelativeCenterPoint();return this.group?wt$1(f,this.group.calcTransformMatrix()):f}getRelativeCenterPoint(){return this.translateToCenterPoint(new ot$1(this.left,this.top),this.originX,this.originY)}getPointByOrigin(f,ze){return this.translateToOriginPoint(this.getRelativeCenterPoint(),f,ze)}setPositionByOrigin(f,ze,Ke){const Qe=this.translateToCenterPoint(f,ze,Ke),Pi=this.translateToOriginPoint(Qe,this.originX,this.originY);this.set({left:Pi.x,top:Pi.y})}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),M$1,P)}}const Is=["type"],Bs=["extraParam"];let Xs=class qh extends Rs{static getDefaults(){return qh.ownDefaults}get type(){const f=this.constructor.type;return f==="FabricObject"?"object":f.toLowerCase()}set type(f){a("warn","Setting type has no effect",f)}constructor(f){super(),t(this,"_cacheContext",null),Object.assign(this,qh.ownDefaults),this.setOptions(f)}_createCacheCanvas(){this._cacheCanvas=pt$1(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(f){const ze=f.width,Ke=f.height,Qe=o.maxCacheSideLimit,Pi=o.minCacheSideLimit;if(ze<=Qe&&Ke<=Qe&&ze*Ke<=o.perfLimitSizeTotal)return ze<Pi&&(f.width=Pi),Ke<Pi&&(f.height=Pi),f;const nn=ze/Ke,[ln,cn]=_.limitDimsByArea(nn),hn=gs(Pi,ln,Qe),un=gs(Pi,cn,Qe);return ze>hn&&(f.zoomX/=ze/hn,f.width=hn,f.capped=!0),Ke>un&&(f.zoomY/=Ke/un,f.height=un,f.capped=!0),f}_getCacheCanvasDimensions(){const f=this.getTotalObjectScaling(),ze=this._getTransformedDimensions({skewX:0,skewY:0}),Ke=ze.x*f.x/this.scaleX,Qe=ze.y*f.y/this.scaleY;return{width:Math.ceil(Ke+2),height:Math.ceil(Qe+2),zoomX:f.x,zoomY:f.y,x:Ke,y:Qe}}_updateCacheCanvas(){const f=this._cacheCanvas,ze=this._cacheContext,{width:Ke,height:Qe,zoomX:Pi,zoomY:nn,x:ln,y:cn}=this._limitCacheSize(this._getCacheCanvasDimensions()),hn=Ke!==f.width||Qe!==f.height,un=this.zoomX!==Pi||this.zoomY!==nn;if(!f||!ze)return!1;if(hn||un){Ke!==f.width||Qe!==f.height?(f.width=Ke,f.height=Qe):(ze.setTransform(1,0,0,1,0,0),ze.clearRect(0,0,f.width,f.height));const xs=ln/2,zn=cn/2;return this.cacheTranslationX=Math.round(f.width/2-xs)+xs,this.cacheTranslationY=Math.round(f.height/2-zn)+zn,ze.translate(this.cacheTranslationX,this.cacheTranslationY),ze.scale(Pi,nn),this.zoomX=Pi,this.zoomY=nn,!0}return!1}setOptions(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setOptions(f)}transform(f){const ze=this.group&&!this.group._transformDone||this.group&&this.canvas&&f===this.canvas.contextTop,Ke=this.calcTransformMatrix(!ze);f.transform(Ke[0],Ke[1],Ke[2],Ke[3],Ke[4],Ke[5])}getObjectScaling(){if(!this.group)return new ot$1(Math.abs(this.scaleX),Math.abs(this.scaleY));const f=Dt$1(this.calcTransformMatrix());return new ot$1(Math.abs(f.scaleX),Math.abs(f.scaleY))}getTotalObjectScaling(){const f=this.getObjectScaling();if(this.canvas){const ze=this.canvas.getZoom(),Ke=this.getCanvasRetinaScaling();return f.scalarMultiply(ze*Ke)}return f}getObjectOpacity(){let f=this.opacity;return this.group&&(f*=this.group.getObjectOpacity()),f}_constrainScale(f){return Math.abs(f)<this.minScaleLimit?f<0?-this.minScaleLimit:this.minScaleLimit:f===0?1e-4:f}_set(f,ze){f!==H&&f!==N$1||(ze=this._constrainScale(ze)),f===H&&ze<0?(this.flipX=!this.flipX,ze*=-1):f==="scaleY"&&ze<0?(this.flipY=!this.flipY,ze*=-1):f!=="shadow"||!ze||ze instanceof ds||(ze=new ds(ze));const Ke=this[f]!==ze;return this[f]=ze,Ke&&this.constructor.cacheProperties.includes(f)&&(this.dirty=!0),this.parent&&(this.dirty||Ke&&this.constructor.stateProperties.includes(f))&&this.parent._set("dirty",!0),this}isNotVisible(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible}render(f){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(f.save(),this._setupCompositeOperation(f),this.drawSelectionBackground(f),this.transform(f),this._setOpacity(f),this._setShadow(f),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(f)):(this._removeCacheCanvas(),this.drawObject(f,!1,{}),this.dirty=!1),f.restore())}drawSelectionBackground(f){}renderCache(f){if(f=f||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext){const{zoomX:ze,zoomY:Ke,cacheTranslationX:Qe,cacheTranslationY:Pi}=this,{width:nn,height:ln}=this._cacheCanvas;this.drawObject(this._cacheContext,f.forClipping,{zoomX:ze,zoomY:Ke,cacheTranslationX:Qe,cacheTranslationY:Pi,width:nn,height:ln,parentClipPaths:[]}),this.dirty=!1}}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null}hasStroke(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0}hasFill(){return this.fill&&this.fill!=="transparent"}needsItsOwnCache(){return!!(this.paintFirst===J&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.objectCaching&&(!this.parent||!this.parent.isOnACache())||this.needsItsOwnCache(),this.ownCaching}willDrawShadow(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)}drawClipPathOnCache(f,ze,Ke){f.save(),ze.inverted?f.globalCompositeOperation="destination-out":f.globalCompositeOperation="destination-in",f.setTransform(1,0,0,1,0,0),f.drawImage(Ke,0,0),f.restore()}drawObject(f,ze,Ke){const Qe=this.fill,Pi=this.stroke;ze?(this.fill="black",this.stroke="",this._setClippingProperties(f)):this._renderBackground(f),this._render(f),this._drawClipPath(f,this.clipPath,Ke),this.fill=Qe,this.stroke=Pi}createClipPathLayer(f,ze){const Ke=vt$1(ze),Qe=Ke.getContext("2d");if(Qe.translate(ze.cacheTranslationX,ze.cacheTranslationY),Qe.scale(ze.zoomX,ze.zoomY),f._cacheCanvas=Ke,ze.parentClipPaths.forEach(Pi=>{Pi.transform(Qe)}),ze.parentClipPaths.push(f),f.absolutePositioned){const Pi=St$1(this.calcTransformMatrix());Qe.transform(Pi[0],Pi[1],Pi[2],Pi[3],Pi[4],Pi[5])}return f.transform(Qe),f.drawObject(Qe,!0,ze),Ke}_drawClipPath(f,ze,Ke){if(!ze)return;ze._transformDone=!0;const Qe=this.createClipPathLayer(ze,Ke);this.drawClipPathOnCache(f,ze,Qe)}drawCacheOnCanvas(f){f.scale(1/this.zoomX,1/this.zoomY),f.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let f=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(this.isNotVisible())return!1;const ze=this._cacheCanvas,Ke=this._cacheContext;return!(!ze||!Ke||f||!this._updateCacheCanvas())||!!(this.dirty||this.clipPath&&this.clipPath.absolutePositioned)&&(ze&&Ke&&!f&&(Ke.save(),Ke.setTransform(1,0,0,1,0,0),Ke.clearRect(0,0,ze.width,ze.height),Ke.restore()),!0)}_renderBackground(f){if(!this.backgroundColor)return;const ze=this._getNonTransformedDimensions();f.fillStyle=this.backgroundColor,f.fillRect(-ze.x/2,-ze.y/2,ze.x,ze.y),this._removeShadow(f)}_setOpacity(f){this.group&&!this.group._transformDone?f.globalAlpha=this.getObjectOpacity():f.globalAlpha*=this.opacity}_setStrokeStyles(f,ze){const Ke=ze.stroke;Ke&&(f.lineWidth=ze.strokeWidth,f.lineCap=ze.strokeLineCap,f.lineDashOffset=ze.strokeDashOffset,f.lineJoin=ze.strokeLineJoin,f.miterLimit=ze.strokeMiterLimit,Gt$1(Ke)?Ke.gradientUnits==="percentage"||Ke.gradientTransform||Ke.patternTransform?this._applyPatternForTransformedGradient(f,Ke):(f.strokeStyle=Ke.toLive(f),this._applyPatternGradientTransform(f,Ke)):f.strokeStyle=ze.stroke)}_setFillStyles(f,ze){let{fill:Ke}=ze;Ke&&(Gt$1(Ke)?(f.fillStyle=Ke.toLive(f),this._applyPatternGradientTransform(f,Ke)):f.fillStyle=Ke)}_setClippingProperties(f){f.globalAlpha=1,f.strokeStyle="transparent",f.fillStyle="#000000"}_setLineDash(f,ze){ze&&ze.length!==0&&f.setLineDash(ze)}_setShadow(f){if(!this.shadow)return;const ze=this.shadow,Ke=this.canvas,Qe=this.getCanvasRetinaScaling(),[Pi,,,nn]=(Ke==null?void 0:Ke.viewportTransform)||T,ln=Pi*Qe,cn=nn*Qe,hn=ze.nonScaling?new ot$1(1,1):this.getObjectScaling();f.shadowColor=ze.color,f.shadowBlur=ze.blur*o.browserShadowBlurConstant*(ln+cn)*(hn.x+hn.y)/4,f.shadowOffsetX=ze.offsetX*ln*hn.x,f.shadowOffsetY=ze.offsetY*cn*hn.y}_removeShadow(f){this.shadow&&(f.shadowColor="",f.shadowBlur=f.shadowOffsetX=f.shadowOffsetY=0)}_applyPatternGradientTransform(f,ze){if(!Gt$1(ze))return{offsetX:0,offsetY:0};const Ke=ze.gradientTransform||ze.patternTransform,Qe=-this.width/2+ze.offsetX||0,Pi=-this.height/2+ze.offsetY||0;return ze.gradientUnits==="percentage"?f.transform(this.width,0,0,this.height,Qe,Pi):f.transform(1,0,0,1,Qe,Pi),Ke&&f.transform(Ke[0],Ke[1],Ke[2],Ke[3],Ke[4],Ke[5]),{offsetX:Qe,offsetY:Pi}}_renderPaintInOrder(f){this.paintFirst===J?(this._renderStroke(f),this._renderFill(f)):(this._renderFill(f),this._renderStroke(f))}_render(f){}_renderFill(f){this.fill&&(f.save(),this._setFillStyles(f,this),this.fillRule==="evenodd"?f.fill("evenodd"):f.fill(),f.restore())}_renderStroke(f){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(f),f.save(),this.strokeUniform){const ze=this.getObjectScaling();f.scale(1/ze.x,1/ze.y)}this._setLineDash(f,this.strokeDashArray),this._setStrokeStyles(f,this),f.stroke(),f.restore()}}_applyPatternForTransformedGradient(f,ze){var Ke;const Qe=this._limitCacheSize(this._getCacheCanvasDimensions()),Pi=this.getCanvasRetinaScaling(),nn=Qe.x/this.scaleX/Pi,ln=Qe.y/this.scaleY/Pi,cn=vt$1({width:Math.ceil(nn),height:Math.ceil(ln)}),hn=cn.getContext("2d");hn&&(hn.beginPath(),hn.moveTo(0,0),hn.lineTo(nn,0),hn.lineTo(nn,ln),hn.lineTo(0,ln),hn.closePath(),hn.translate(nn/2,ln/2),hn.scale(Qe.zoomX/this.scaleX/Pi,Qe.zoomY/this.scaleY/Pi),this._applyPatternGradientTransform(hn,ze),hn.fillStyle=ze.toLive(f),hn.fill(),f.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),f.scale(Pi*this.scaleX/Qe.zoomX,Pi*this.scaleY/Qe.zoomY),f.strokeStyle=(Ke=hn.createPattern(cn,"no-repeat"))!==null&&Ke!==void 0?Ke:"")}_findCenterFromElement(){return new ot$1(this.left+this.width/2,this.top+this.height/2)}clone(f){const ze=this.toObject(f);return this.constructor.fromObject(ze)}cloneAsImage(f){const ze=this.toCanvasElement(f);return new(tt.getClass("image"))(ze)}toCanvasElement(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const ze=de$1(this),Ke=this.group,Qe=this.shadow,Pi=Math.abs,nn=f.enableRetinaScaling?y$1():1,ln=(f.multiplier||1)*nn,cn=f.canvasProvider||(na=>new se$1(na,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,f.withoutTransform&&ue$1(this),f.withoutShadow&&(this.shadow=null),f.viewportTransform&&ve$1(this,this.getViewportTransform()),this.setCoords();const hn=pt$1(),un=this.getBoundingRect(),xs=this.shadow,zn=new ot$1;if(xs){const na=xs.blur,ta=xs.nonScaling?new ot$1(1,1):this.getObjectScaling();zn.x=2*Math.round(Pi(xs.offsetX)+na)*Pi(ta.x),zn.y=2*Math.round(Pi(xs.offsetY)+na)*Pi(ta.y)}const Xn=un.width+zn.x,ys=un.height+zn.y;hn.width=Math.ceil(Xn),hn.height=Math.ceil(ys);const Jo=cn(hn);f.format==="jpeg"&&(Jo.backgroundColor="#fff"),this.setPositionByOrigin(new ot$1(Jo.width/2,Jo.height/2),D$1,D$1);const ea=this.canvas;Jo._objects=[this],this.set("canvas",Jo),this.setCoords();const ra=Jo.toCanvasElement(ln||1,f);return this.set("canvas",ea),this.shadow=Qe,Ke&&(this.group=Ke),this.set(ze),this.setCoords(),Jo._objects=[],Jo.destroy(),ra}toDataURL(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return yt$1(this.toCanvasElement(f),f.format||"png",f.quality||1)}toBlob(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return _t$1(this.toCanvasElement(f),f.format||"png",f.quality||1)}isType(){for(var f=arguments.length,ze=new Array(f),Ke=0;Ke<f;Ke++)ze[Ke]=arguments[Ke];return ze.includes(this.constructor.type)||ze.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(f){const{centeredRotation:ze,originX:Ke,originY:Qe}=this;if(ze){const{x:Pi,y:nn}=this.getRelativeCenterPoint();this.originX=D$1,this.originY=D$1,this.left=Pi,this.top=nn}if(this.set("angle",f),ze){const{x:Pi,y:nn}=this.translateToOriginPoint(this.getRelativeCenterPoint(),Ke,Qe);this.left=Pi,this.top=nn,this.originX=Ke,this.originY=Qe}}setOnGroup(){}_setupCompositeOperation(f){this.globalCompositeOperation&&(f.globalCompositeOperation=this.globalCompositeOperation)}dispose(){et$1.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&p$1().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}animate(f,ze){return Object.entries(f).reduce((Ke,Qe)=>{let[Pi,nn]=Qe;return Ke[Pi]=this._animate(Pi,nn,ze),Ke},{})}_animate(f,ze){let Ke=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const Qe=f.split("."),Pi=this.constructor.colorProperties.includes(Qe[Qe.length-1]),{abort:nn,startValue:ln,onChange:cn,onComplete:hn}=Ke,un=s(s({},Ke),{},{target:this,startValue:ln??Qe.reduce((xs,zn)=>xs[zn],this),endValue:ze,abort:nn==null?void 0:nn.bind(this),onChange:(xs,zn,Xn)=>{Qe.reduce((ys,Jo,ea)=>(ea===Qe.length-1&&(ys[Jo]=xs),ys[Jo]),this),cn&&cn(xs,zn,Xn)},onComplete:(xs,zn,Xn)=>{this.setCoords(),hn&&hn(xs,zn,Xn)}});return Pi?Fs(un):js(un)}isDescendantOf(f){const{parent:ze,group:Ke}=this;return ze===f||Ke===f||!!ze&&ze.isDescendantOf(f)||!!Ke&&Ke!==ze&&Ke.isDescendantOf(f)}getAncestors(){const f=[];let ze=this;do ze=ze.parent,ze&&f.push(ze);while(ze);return f}findCommonAncestors(f){if(this===f)return{fork:[],otherFork:[],common:[this,...this.getAncestors()]};const ze=this.getAncestors(),Ke=f.getAncestors();if(ze.length===0&&Ke.length>0&&this===Ke[Ke.length-1])return{fork:[],otherFork:[f,...Ke.slice(0,Ke.length-1)],common:[this]};for(let Qe,Pi=0;Pi<ze.length;Pi++){if(Qe=ze[Pi],Qe===f)return{fork:[this,...ze.slice(0,Pi)],otherFork:[],common:ze.slice(Pi)};for(let nn=0;nn<Ke.length;nn++){if(this===Ke[nn])return{fork:[],otherFork:[f,...Ke.slice(0,nn)],common:[this,...ze]};if(Qe===Ke[nn])return{fork:[this,...ze.slice(0,Pi)],otherFork:[f,...Ke.slice(0,nn)],common:ze.slice(Pi)}}}return{fork:[this,...ze],otherFork:[f,...Ke],common:[]}}hasCommonAncestors(f){const ze=this.findCommonAncestors(f);return ze&&!!ze.common.length}isInFrontOf(f){if(this===f)return;const ze=this.findCommonAncestors(f);if(ze.fork.includes(f))return!0;if(ze.otherFork.includes(this))return!1;const Ke=ze.common[0]||this.canvas;if(!Ke)return;const Qe=ze.fork.pop(),Pi=ze.otherFork.pop(),nn=Ke._objects.indexOf(Qe),ln=Ke._objects.indexOf(Pi);return nn>-1&&nn>ln}toObject(){const f=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).concat(qh.customProperties,this.constructor.customProperties||[]);let ze;const Ke=o.NUM_FRACTION_DIGITS,{clipPath:Qe,fill:Pi,stroke:nn,shadow:ln,strokeDashArray:cn,left:hn,top:un,originX:xs,originY:zn,width:Xn,height:ys,strokeWidth:Jo,strokeLineCap:ea,strokeDashOffset:ra,strokeLineJoin:na,strokeUniform:ta,strokeMiterLimit:ia,scaleX:sa,scaleY:Ma,angle:pa,flipX:oa,flipY:ha,opacity:ca,visible:da,backgroundColor:ga,fillRule:qa,paintFirst:Ka,globalCompositeOperation:il,skewX:cl,skewY:wl}=this;Qe&&!Qe.excludeFromExport&&(ze=Qe.toObject(f.concat("inverted","absolutePositioned")));const al=ml=>Vt$1(ml,Ke),vl=s(s({},Yt$1(this,f)),{},{type:this.constructor.type,version:x$1,originX:xs,originY:zn,left:al(hn),top:al(un),width:al(Xn),height:al(ys),fill:Ht$1(Pi)?Pi.toObject():Pi,stroke:Ht$1(nn)?nn.toObject():nn,strokeWidth:al(Jo),strokeDashArray:cn&&cn.concat(),strokeLineCap:ea,strokeDashOffset:ra,strokeLineJoin:na,strokeUniform:ta,strokeMiterLimit:al(ia),scaleX:al(sa),scaleY:al(Ma),angle:al(pa),flipX:oa,flipY:ha,opacity:al(ca),shadow:ln&&ln.toObject(),visible:da,backgroundColor:ga,fillRule:qa,paintFirst:Ka,globalCompositeOperation:il,skewX:al(cl),skewY:al(wl)},ze?{clipPath:ze}:null);return this.includeDefaultValues?vl:this._removeDefaultValues(vl)}toDatalessObject(f){return this.toObject(f)}_removeDefaultValues(f){const ze=this.constructor.getDefaults(),Ke=Object.keys(ze).length>0?ze:Object.getPrototypeOf(this);return Wt$1(f,(Qe,Pi)=>{if(Pi===M$1||Pi===P||Pi==="type")return!0;const nn=Ke[Pi];return Qe!==nn&&!(Array.isArray(Qe)&&Array.isArray(nn)&&Qe.length===0&&nn.length===0)})}toString(){return"#<".concat(this.constructor.type,">")}static _fromObject(f){let ze=i(f,Is),Ke=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{extraParam:Qe}=Ke,Pi=i(Ke,Bs);return Xt$1(ze,Pi).then(nn=>Qe?(delete nn[Qe],new this(ze[Qe],nn)):new this(nn))}static fromObject(f,ze){return this._fromObject(f,ze)}};t(Xs,"stateProperties",fs),t(Xs,"cacheProperties",ps),t(Xs,"ownDefaults",ms),t(Xs,"type","FabricObject"),t(Xs,"colorProperties",[K$1,J,"backgroundColor"]),t(Xs,"customProperties",[]),tt.setClass(Xs),tt.setClass(Xs,"object");const Ys=(qe,f,ze)=>(Ke,Qe,Pi,nn)=>{const ln=f(Ke,Qe,Pi,nn);return ln&&ye$1(qe,s(s({},Te$1(Ke,Qe,Pi,nn)),ze)),ln};function Ws(qe){return(f,ze,Ke,Qe)=>{const{target:Pi,originX:nn,originY:ln}=ze,cn=Pi.getRelativeCenterPoint(),hn=Pi.translateToOriginPoint(cn,nn,ln),un=qe(f,ze,Ke,Qe);return Pi.setPositionByOrigin(hn,ze.originX,ze.originY),un}}const Vs=Ys(Y$1,Ws((qe,f,ze,Ke)=>{const Qe=ke$1(f,f.originX,f.originY,ze,Ke);if(xe$1(f.originX)===xe$1(D$1)||xe$1(f.originX)===xe$1(A)&&Qe.x<0||xe$1(f.originX)===xe$1(M$1)&&Qe.x>0){const{target:Pi}=f,nn=Pi.strokeWidth/(Pi.strokeUniform?Pi.scaleX:1),ln=be$1(f)?2:1,cn=Pi.width,hn=Math.abs(Qe.x*ln/Pi.scaleX)-nn;return Pi.set("width",Math.max(hn,1)),cn!==Pi.width}return!1}));function zs(qe,f,ze,Ke,Qe){Ke=Ke||{};const Pi=this.sizeX||Ke.cornerSize||Qe.cornerSize,nn=this.sizeY||Ke.cornerSize||Qe.cornerSize,ln=Ke.transparentCorners!==void 0?Ke.transparentCorners:Qe.transparentCorners,cn=ln?J:K$1,hn=!ln&&(Ke.cornerStrokeColor||Qe.cornerStrokeColor);let un,xs=f,zn=ze;qe.save(),qe.fillStyle=Ke.cornerColor||Qe.cornerColor||"",qe.strokeStyle=Ke.cornerStrokeColor||Qe.cornerStrokeColor||"",Pi>nn?(un=Pi,qe.scale(1,nn/Pi),zn=ze*Pi/nn):nn>Pi?(un=nn,qe.scale(Pi/nn,1),xs=f*nn/Pi):un=Pi,qe.beginPath(),qe.arc(xs,zn,un/2,0,w$1,!1),qe[cn](),hn&&qe.stroke(),qe.restore()}function Gs(qe,f,ze,Ke,Qe){Ke=Ke||{};const Pi=this.sizeX||Ke.cornerSize||Qe.cornerSize,nn=this.sizeY||Ke.cornerSize||Qe.cornerSize,ln=Ke.transparentCorners!==void 0?Ke.transparentCorners:Qe.transparentCorners,cn=ln?J:K$1,hn=!ln&&(Ke.cornerStrokeColor||Qe.cornerStrokeColor),un=Pi/2,xs=nn/2;qe.save(),qe.fillStyle=Ke.cornerColor||Qe.cornerColor||"",qe.strokeStyle=Ke.cornerStrokeColor||Qe.cornerStrokeColor||"",qe.translate(f,ze);const zn=Qe.getTotalAngle();qe.rotate(xt$1(zn)),qe["".concat(cn,"Rect")](-un,-xs,Pi,nn),hn&&qe.strokeRect(-un,-xs,Pi,nn),qe.restore()}class Hs{constructor(f){t(this,"visible",!0),t(this,"actionName",G$1),t(this,"angle",0),t(this,"x",0),t(this,"y",0),t(this,"offsetX",0),t(this,"offsetY",0),t(this,"sizeX",0),t(this,"sizeY",0),t(this,"touchSizeX",0),t(this,"touchSizeY",0),t(this,"cursorStyle","crosshair"),t(this,"withConnection",!1),Object.assign(this,f)}shouldActivate(f,ze,Ke,Qe){var Pi;let{tl:nn,tr:ln,br:cn,bl:hn}=Qe;return((Pi=ze.canvas)===null||Pi===void 0?void 0:Pi.getActiveObject())===ze&&ze.isControlVisible(f)&&Ls.isPointInPolygon(Ke,[nn,ln,cn,hn])}getActionHandler(f,ze,Ke){return this.actionHandler}getMouseDownHandler(f,ze,Ke){return this.mouseDownHandler}getMouseUpHandler(f,ze,Ke){return this.mouseUpHandler}cursorStyleHandler(f,ze,Ke){return ze.cursorStyle}getActionName(f,ze,Ke){return ze.actionName}getVisibility(f,ze){var Ke,Qe;return(Ke=(Qe=f._controlsVisibility)===null||Qe===void 0?void 0:Qe[ze])!==null&&Ke!==void 0?Ke:this.visible}setVisibility(f,ze,Ke){this.visible=f}positionHandler(f,ze,Ke,Qe){return new ot$1(this.x*f.x+this.offsetX,this.y*f.y+this.offsetY).transform(ze)}calcCornerCoords(f,ze,Ke,Qe,Pi,nn){const ln=Ot$1([Mt$1(Ke,Qe),Pt$1({angle:f}),Et$1((Pi?this.touchSizeX:this.sizeX)||ze,(Pi?this.touchSizeY:this.sizeY)||ze)]);return{tl:new ot$1(-.5,-.5).transform(ln),tr:new ot$1(.5,-.5).transform(ln),br:new ot$1(.5,.5).transform(ln),bl:new ot$1(-.5,.5).transform(ln)}}render(f,ze,Ke,Qe,Pi){((Qe=Qe||{}).cornerStyle||Pi.cornerStyle)==="circle"?zs.call(this,f,ze,Ke,Qe,Pi):Gs.call(this,f,ze,Ke,Qe,Pi)}}const Ns=(qe,f,ze)=>ze.lockRotation?Ce$1:f.cursorStyle,Us=Ys(I,Ws((qe,f,ze,Ke)=>{let{target:Qe,ex:Pi,ey:nn,theta:ln,originX:cn,originY:hn}=f;const un=Qe.translateToOriginPoint(Qe.getRelativeCenterPoint(),cn,hn);if(Se$1(Qe,"lockRotation"))return!1;const xs=Math.atan2(nn-un.y,Pi-un.x),zn=Math.atan2(Ke-un.y,ze-un.x);let Xn=Ct$1(zn-xs+ln);if(Qe.snapAngle&&Qe.snapAngle>0){const Jo=Qe.snapAngle,ea=Qe.snapThreshold||Jo,ra=Math.ceil(Xn/Jo)*Jo,na=Math.floor(Xn/Jo)*Jo;Math.abs(Xn-na)<ea?Xn=na:Math.abs(Xn-ra)<ea&&(Xn=ra)}Xn<0&&(Xn=360+Xn),Xn%=360;const ys=Qe.angle!==Xn;return Qe.angle=Xn,ys}));function qs(qe,f){const ze=f.canvas,Ke=qe[ze.uniScaleKey];return ze.uniformScaling&&!Ke||!ze.uniformScaling&&Ke}function Ks(qe,f,ze){const Ke=Se$1(qe,"lockScalingX"),Qe=Se$1(qe,"lockScalingY");if(Ke&&Qe||!f&&(Ke||Qe)&&ze||Ke&&f==="x"||Qe&&f==="y")return!0;const{width:Pi,height:nn,strokeWidth:ln}=qe;return Pi===0&&ln===0&&f!=="y"||nn===0&&ln===0&&f!=="x"}const Js=["e","se","s","sw","w","nw","n","ne","e"],Qs=(qe,f,ze)=>{const Ke=qs(qe,ze);if(Ks(ze,f.x!==0&&f.y===0?"x":f.x===0&&f.y!==0?"y":"",Ke))return Ce$1;const Qe=Oe$1(ze,f);return"".concat(Js[Qe],"-resize")};function Zs(qe,f,ze,Ke){let Qe=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};const Pi=f.target,nn=Qe.by,ln=qs(qe,Pi);let cn,hn,un,xs,zn,Xn;if(Ks(Pi,nn,ln))return!1;if(f.gestureScale)hn=f.scaleX*f.gestureScale,un=f.scaleY*f.gestureScale;else{if(cn=ke$1(f,f.originX,f.originY,ze,Ke),zn=nn!=="y"?Math.sign(cn.x||f.signX||1):1,Xn=nn!=="x"?Math.sign(cn.y||f.signY||1):1,f.signX||(f.signX=zn),f.signY||(f.signY=Xn),Se$1(Pi,"lockScalingFlip")&&(f.signX!==zn||f.signY!==Xn))return!1;if(xs=Pi._getTransformedDimensions(),ln&&!nn){const ea=Math.abs(cn.x)+Math.abs(cn.y),{original:ra}=f,na=ea/(Math.abs(xs.x*ra.scaleX/Pi.scaleX)+Math.abs(xs.y*ra.scaleY/Pi.scaleY));hn=ra.scaleX*na,un=ra.scaleY*na}else hn=Math.abs(cn.x*Pi.scaleX/xs.x),un=Math.abs(cn.y*Pi.scaleY/xs.y);be$1(f)&&(hn*=2,un*=2),f.signX!==zn&&nn!=="y"&&(f.originX=we$1(f.originX),hn*=-1,f.signX=zn),f.signY!==Xn&&nn!=="x"&&(f.originY=we$1(f.originY),un*=-1,f.signY=Xn)}const ys=Pi.scaleX,Jo=Pi.scaleY;return nn?(nn==="x"&&Pi.set(H,hn),nn==="y"&&Pi.set(N$1,un)):(!Se$1(Pi,"lockScalingX")&&Pi.set(H,hn),!Se$1(Pi,"lockScalingY")&&Pi.set(N$1,un)),ys!==Pi.scaleX||Jo!==Pi.scaleY}const $s=Ys(R,Ws((qe,f,ze,Ke)=>Zs(qe,f,ze,Ke))),ti=Ys(R,Ws((qe,f,ze,Ke)=>Zs(qe,f,ze,Ke,{by:"x"}))),ei=Ys(R,Ws((qe,f,ze,Ke)=>Zs(qe,f,ze,Ke,{by:"y"}))),si=["target","ex","ey","skewingSide"],ii={x:{counterAxis:"y",scale:H,skew:U,lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:N$1,skew:q,lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},ri=["ns","nesw","ew","nwse"],ni=(qe,f,ze)=>{if(f.x!==0&&Se$1(ze,"lockSkewingY")||f.y!==0&&Se$1(ze,"lockSkewingX"))return Ce$1;const Ke=Oe$1(ze,f)%4;return"".concat(ri[Ke],"-resize")};function oi(qe,f,ze,Ke,Qe){const{target:Pi}=ze,{counterAxis:nn,origin:ln,lockSkewing:cn,skew:hn,flip:un}=ii[qe];if(Se$1(Pi,cn))return!1;const{origin:xs,flip:zn}=ii[nn],Xn=xe$1(ze[xs])*(Pi[zn]?-1:1),ys=-Math.sign(Xn)*(Pi[un]?-1:1),Jo=.5*-((Pi[hn]===0&&ke$1(ze,D$1,D$1,Ke,Qe)[qe]>0||Pi[hn]>0?1:-1)*ys)+.5;return Ys(X,Ws((ra,na,ta,ia)=>function(sa,Ma,pa){let{target:oa,ex:ha,ey:ca,skewingSide:da}=Ma,ga=i(Ma,si);const{skew:qa}=ii[sa],Ka=pa.subtract(new ot$1(ha,ca)).divide(new ot$1(oa.scaleX,oa.scaleY))[sa],il=oa[qa],cl=ga[qa],wl=Math.tan(xt$1(cl)),al=sa==="y"?oa._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:oa._getTransformedDimensions({scaleX:1,scaleY:1}).y,vl=2*Ka*da/Math.max(al,1)+wl,ml=Ct$1(Math.atan(vl));oa.set(qa,ml);const ol=il!==oa[qa];if(ol&&sa==="y"){const{skewX:el,scaleX:dl}=oa,xl=oa._getTransformedDimensions({skewY:il}),Ja=oa._getTransformedDimensions(),yl=el!==0?xl.x/Ja.x:1;yl!==1&&oa.set(H,yl*dl)}return ol}(qe,na,new ot$1(ta,ia))))(f,s(s({},ze),{},{[ln]:Jo,skewingSide:ys}),Ke,Qe)}const ai=(qe,f,ze,Ke)=>oi("x",qe,f,ze,Ke),hi=(qe,f,ze,Ke)=>oi("y",qe,f,ze,Ke);function ci(qe,f){return qe[f.canvas.altActionKey]}const li$1=(qe,f,ze)=>{const Ke=ci(qe,ze);return f.x===0?Ke?U:N$1:f.y===0?Ke?q:H:""},ui=(qe,f,ze)=>ci(qe,ze)?ni(0,f,ze):Qs(qe,f,ze),di=(qe,f,ze,Ke)=>ci(qe,f.target)?hi(qe,f,ze,Ke):ti(qe,f,ze,Ke),gi=(qe,f,ze,Ke)=>ci(qe,f.target)?ai(qe,f,ze,Ke):ei(qe,f,ze,Ke),fi=()=>({ml:new Hs({x:-.5,y:0,cursorStyleHandler:ui,actionHandler:di,getActionName:li$1}),mr:new Hs({x:.5,y:0,cursorStyleHandler:ui,actionHandler:di,getActionName:li$1}),mb:new Hs({x:0,y:.5,cursorStyleHandler:ui,actionHandler:gi,getActionName:li$1}),mt:new Hs({x:0,y:-.5,cursorStyleHandler:ui,actionHandler:gi,getActionName:li$1}),tl:new Hs({x:-.5,y:-.5,cursorStyleHandler:Qs,actionHandler:$s}),tr:new Hs({x:.5,y:-.5,cursorStyleHandler:Qs,actionHandler:$s}),bl:new Hs({x:-.5,y:.5,cursorStyleHandler:Qs,actionHandler:$s}),br:new Hs({x:.5,y:.5,cursorStyleHandler:Qs,actionHandler:$s}),mtr:new Hs({x:0,y:-.5,actionHandler:Us,cursorStyleHandler:Ns,offsetY:-40,withConnection:!0,actionName:B$1})}),pi=()=>({mr:new Hs({x:.5,y:0,actionHandler:Vs,cursorStyleHandler:ui,actionName:Y$1}),ml:new Hs({x:-.5,y:0,actionHandler:Vs,cursorStyleHandler:ui,actionName:Y$1})}),mi=()=>s(s({},fi()),pi());class vi extends Xs{static getDefaults(){return s(s({},super.getDefaults()),vi.ownDefaults)}constructor(f){super(),Object.assign(this,this.constructor.createControls(),vi.ownDefaults),this.setOptions(f)}static createControls(){return{controls:fi()}}_updateCacheCanvas(){const f=this.canvas;if(this.noScaleCache&&f&&f._currentTransform){const ze=f._currentTransform,Ke=ze.target,Qe=ze.action;if(this===Ke&&Qe&&Qe.startsWith(G$1))return!1}return super._updateCacheCanvas()}getActiveControl(){const f=this.__corner;return f?{key:f,control:this.controls[f],coord:this.oCoords[f]}:void 0}findControl(f){let ze=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;const Ke=Object.entries(this.oCoords);for(let Qe=Ke.length-1;Qe>=0;Qe--){const[Pi,nn]=Ke[Qe],ln=this.controls[Pi];if(ln.shouldActivate(Pi,this,f,ze?nn.touchCorner:nn.corner))return this.__corner=Pi,{key:Pi,control:ln,coord:this.oCoords[Pi]}}}calcOCoords(){const f=this.getViewportTransform(),ze=this.getCenterPoint(),Ke=Mt$1(ze.x,ze.y),Qe=Pt$1({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),Pi=Tt$1(Ke,Qe),nn=Tt$1(f,Pi),ln=Tt$1(nn,[1/f[0],0,0,1/f[3],0,0]),cn=this.group?Dt$1(this.calcTransformMatrix()):void 0;cn&&(cn.scaleX=Math.abs(cn.scaleX),cn.scaleY=Math.abs(cn.scaleY));const hn=this._calculateCurrentDimensions(cn),un={};return this.forEachControl((xs,zn)=>{const Xn=xs.positionHandler(hn,ln,this,xs);un[zn]=Object.assign(Xn,this._calcCornerCoords(xs,Xn))}),un}_calcCornerCoords(f,ze){const Ke=this.getTotalAngle();return{corner:f.calcCornerCoords(Ke,this.cornerSize,ze.x,ze.y,!1,this),touchCorner:f.calcCornerCoords(Ke,this.touchCornerSize,ze.x,ze.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(f){for(const ze in this.controls)f(this.controls[ze],ze,this)}drawSelectionBackground(f){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;f.save();const ze=this.getRelativeCenterPoint(),Ke=this._calculateCurrentDimensions(),Qe=this.getViewportTransform();f.translate(ze.x,ze.y),f.scale(1/Qe[0],1/Qe[3]),f.rotate(xt$1(this.angle)),f.fillStyle=this.selectionBackgroundColor,f.fillRect(-Ke.x/2,-Ke.y/2,Ke.x,Ke.y),f.restore()}strokeBorders(f,ze){f.strokeRect(-ze.x/2,-ze.y/2,ze.x,ze.y)}_drawBorders(f,ze){let Ke=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const Qe=s({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},Ke);f.save(),f.strokeStyle=Qe.borderColor,this._setLineDash(f,Qe.borderDashArray),this.strokeBorders(f,ze),Qe.hasControls&&this.drawControlsConnectingLines(f,ze),f.restore()}_renderControls(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{hasBorders:Ke,hasControls:Qe}=this,Pi=s({hasBorders:Ke,hasControls:Qe},ze),nn=this.getViewportTransform(),ln=Pi.hasBorders,cn=Pi.hasControls,hn=Tt$1(nn,this.calcTransformMatrix()),un=Dt$1(hn);f.save(),f.translate(un.translateX,un.translateY),f.lineWidth=this.borderScaleFactor,this.group===this.parent&&(f.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(un.angle-=180),f.rotate(xt$1(this.group?un.angle:this.angle)),ln&&this.drawBorders(f,un,ze),cn&&this.drawControls(f,ze),f.restore()}drawBorders(f,ze,Ke){let Qe;if(Ke&&Ke.forActiveSelection||this.group){const Pi=ge$1(this.width,this.height,Lt$1(ze)),nn=this.isStrokeAccountedForInDimensions()?at$1:(this.strokeUniform?new ot$1().scalarAdd(this.canvas?this.canvas.getZoom():1):new ot$1(ze.scaleX,ze.scaleY)).scalarMultiply(this.strokeWidth);Qe=Pi.add(nn).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else Qe=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(f,Qe,Ke)}drawControlsConnectingLines(f,ze){let Ke=!1;f.beginPath(),this.forEachControl((Qe,Pi)=>{Qe.withConnection&&Qe.getVisibility(this,Pi)&&(Ke=!0,f.moveTo(Qe.x*ze.x,Qe.y*ze.y),f.lineTo(Qe.x*ze.x+Qe.offsetX,Qe.y*ze.y+Qe.offsetY))}),Ke&&f.stroke()}drawControls(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};f.save();const Ke=this.getCanvasRetinaScaling(),{cornerStrokeColor:Qe,cornerDashArray:Pi,cornerColor:nn}=this,ln=s({cornerStrokeColor:Qe,cornerDashArray:Pi,cornerColor:nn},ze);f.setTransform(Ke,0,0,Ke,0,0),f.strokeStyle=f.fillStyle=ln.cornerColor,this.transparentCorners||(f.strokeStyle=ln.cornerStrokeColor),this._setLineDash(f,ln.cornerDashArray),this.forEachControl((cn,hn)=>{if(cn.getVisibility(this,hn)){const un=this.oCoords[hn];cn.render(f,un.x,un.y,ln,this)}}),f.restore()}isControlVisible(f){return this.controls[f]&&this.controls[f].getVisibility(this,f)}setControlVisible(f,ze){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[f]=ze}setControlsVisibility(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.entries(f).forEach(ze=>{let[Ke,Qe]=ze;return this.setControlVisible(Ke,Qe)})}clearContextTop(f){if(!this.canvas)return;const ze=this.canvas.contextTop;if(!ze)return;const Ke=this.canvas.viewportTransform;ze.save(),ze.transform(Ke[0],Ke[1],Ke[2],Ke[3],Ke[4],Ke[5]),this.transform(ze);const Qe=this.width+4,Pi=this.height+4;return ze.clearRect(-Qe/2,-Pi/2,Qe,Pi),f||ze.restore(),ze}onDeselect(f){return!1}onSelect(f){return!1}shouldStartDragging(f){return!1}onDragStart(f){return!1}canDrop(f){return!1}renderDragSourceEffect(f){}renderDropTargetEffect(f){}}function yi(qe,f){return f.forEach(ze=>{Object.getOwnPropertyNames(ze.prototype).forEach(Ke=>{Ke!=="constructor"&&Object.defineProperty(qe.prototype,Ke,Object.getOwnPropertyDescriptor(ze.prototype,Ke)||Object.create(null))})}),qe}t(vi,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class _i extends vi{}yi(_i,[Xe]),tt.setClass(_i),tt.setClass(_i,"object");const xi=(qe,f,ze,Ke)=>{const Qe=2*(Ke=Math.round(Ke))+1,{data:Pi}=qe.getImageData(f-Ke,ze-Ke,Qe,Qe);for(let nn=3;nn<Pi.length;nn+=4)if(Pi[nn]>0)return!1;return!0};class Ci{constructor(f){this.options=f,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new ot$1(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new ot$1(1/this.options.scaleX,1/this.options.scaleY):new ot$1(1,1)}createSideVector(f,ze){const Ke=es(f,ze);return this.options.strokeUniform?Ke.multiply(this.scale):Ke}projectOrthogonally(f,ze,Ke){return this.applySkew(f.add(this.calcOrthogonalProjection(f,ze,Ke)))}isSkewed(){return this.options.skewX!==0||this.options.skewY!==0}applySkew(f){const ze=new ot$1(f);return ze.y+=ze.x*Math.tan(xt$1(this.options.skewY)),ze.x+=ze.y*Math.tan(xt$1(this.options.skewX)),ze}scaleUnitVector(f,ze){return f.multiply(this.strokeUniformScalar).scalarMultiply(ze)}}const bi=new ot$1;class wi extends Ci{static getOrthogonalRotationFactor(f,ze){const Ke=ze?is(f,ze):rs(f);return Math.abs(Ke)<b?-1:1}constructor(f,ze,Ke,Qe){super(Qe),t(this,"AB",void 0),t(this,"AC",void 0),t(this,"alpha",void 0),t(this,"bisector",void 0),this.A=new ot$1(f),this.B=new ot$1(ze),this.C=new ot$1(Ke),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=is(this.AB,this.AC),this.bisector=ns(ts(this.AB.eq(bi)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(f,ze){let Ke=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const Qe=this.createSideVector(f,ze),Pi=os(Qe),nn=wi.getOrthogonalRotationFactor(Pi,this.bisector);return this.scaleUnitVector(Pi,Ke*nn)}projectBevel(){const f=[];return(this.alpha%w$1==0?[this.B]:[this.B,this.C]).forEach(ze=>{f.push(this.projectOrthogonally(this.A,ze)),f.push(this.projectOrthogonally(this.A,ze,-this.strokeProjectionMagnitude))}),f}projectMiter(){const f=[],ze=Math.abs(this.alpha),Ke=1/Math.sin(ze/2),Qe=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*Ke),Pi=this.options.strokeUniform?ss(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return ss(Qe)/this.strokeProjectionMagnitude<=Pi&&f.push(this.applySkew(this.A.add(Qe))),f.push(...this.projectBevel()),f}projectRoundNoSkew(f,ze){const Ke=[],Qe=new ot$1(wi.getOrthogonalRotationFactor(this.bisector),wi.getOrthogonalRotationFactor(new ot$1(this.bisector.y,this.bisector.x)));return[new ot$1(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(Qe),new ot$1(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(Qe)].forEach(Pi=>{cs(Pi,f,ze)&&Ke.push(this.A.add(Pi))}),Ke}projectRoundWithSkew(f,ze){const Ke=[],{skewX:Qe,skewY:Pi,scaleX:nn,scaleY:ln,strokeUniform:cn}=this.options,hn=new ot$1(Math.tan(xt$1(Qe)),Math.tan(xt$1(Pi))),un=this.strokeProjectionMagnitude,xs=cn?un/ln/Math.sqrt(1/ln**2+1/nn**2*hn.y**2):un/Math.sqrt(1+hn.y**2),zn=new ot$1(Math.sqrt(Math.max(un**2-xs**2,0)),xs),Xn=cn?un/Math.sqrt(1+hn.x**2*(1/ln)**2/(1/nn+1/nn*hn.x*hn.y)**2):un/Math.sqrt(1+hn.x**2/(1+hn.x*hn.y)**2),ys=new ot$1(Xn,Math.sqrt(Math.max(un**2-Xn**2,0)));return[ys,ys.scalarMultiply(-1),zn,zn.scalarMultiply(-1)].map(Jo=>this.applySkew(cn?Jo.multiply(this.strokeUniformScalar):Jo)).forEach(Jo=>{cs(Jo,f,ze)&&Ke.push(this.applySkew(this.A).add(Jo))}),Ke}projectRound(){const f=[];f.push(...this.projectBevel());const ze=this.alpha%w$1==0,Ke=this.applySkew(this.A),Qe=f[ze?0:2].subtract(Ke),Pi=f[ze?1:0].subtract(Ke),nn=ze?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)),ln=as(Qe,nn)>0,cn=ln?Qe:Pi,hn=ln?Pi:Qe;return this.isSkewed()?f.push(...this.projectRoundWithSkew(cn,hn)):f.push(...this.projectRoundNoSkew(cn,hn)),f}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map(f=>({originPoint:this.A,projectedPoint:f,angle:this.alpha,bisector:this.bisector}))}}class Si extends Ci{constructor(f,ze,Ke){super(Ke),this.A=new ot$1(f),this.T=new ot$1(ze)}calcOrthogonalProjection(f,ze){let Ke=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const Qe=this.createSideVector(f,ze);return this.scaleUnitVector(os(Qe),Ke)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){const f=[];if(!this.isSkewed()&&this.A.eq(this.T)){const ze=new ot$1(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);f.push(this.applySkew(this.A.add(ze)),this.applySkew(this.A.subtract(ze)))}else f.push(...new wi(this.A,this.T,this.T,this.options).projectRound());return f}projectSquare(){const f=[];if(this.A.eq(this.T)){const ze=new ot$1(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);f.push(this.A.add(ze),this.A.subtract(ze))}else{const ze=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),Ke=this.scaleUnitVector(ns(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),Qe=this.A.add(Ke);f.push(Qe.add(ze),Qe.subtract(ze))}return f.map(ze=>this.applySkew(ze))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map(f=>({originPoint:this.A,projectedPoint:f}))}}const Ti=function(qe,f){let ze=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const Ke=[];if(qe.length===0)return Ke;const Qe=qe.reduce((Pi,nn)=>(Pi[Pi.length-1].eq(nn)||Pi.push(new ot$1(nn)),Pi),[new ot$1(qe[0])]);if(Qe.length===1)ze=!0;else if(!ze){const Pi=Qe[0],nn=((ln,cn)=>{for(let hn=ln.length-1;hn>=0;hn--)if(cn(ln[hn],hn,ln))return hn;return-1})(Qe,ln=>!ln.eq(Pi));Qe.splice(nn+1)}return Qe.forEach((Pi,nn,ln)=>{let cn,hn;nn===0?(hn=ln[1],cn=ze?Pi:ln[ln.length-1]):nn===ln.length-1?(cn=ln[nn-1],hn=ze?Pi:ln[0]):(cn=ln[nn-1],hn=ln[nn+1]),ze&&ln.length===1?Ke.push(...new Si(Pi,Pi,f).project()):!ze||nn!==0&&nn!==ln.length-1?Ke.push(...new wi(Pi,cn,hn,f).project()):Ke.push(...new Si(Pi,nn===0?hn:cn,f).project())}),Ke},Oi=qe=>{const f={};return Object.keys(qe).forEach(ze=>{f[ze]={},Object.keys(qe[ze]).forEach(Ke=>{f[ze][Ke]=s({},qe[ze][Ke])})}),f},ki=qe=>qe.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),Di=qe=>{const f=[];for(let ze,Ke=0;Ke<qe.length;Ke++)(ze=Mi(qe,Ke))!==!1&&f.push(ze);return f},Mi=(qe,f)=>{const ze=qe.charCodeAt(f);if(isNaN(ze))return"";if(ze<55296||ze>57343)return qe.charAt(f);if(55296<=ze&&ze<=56319){if(qe.length<=f+1)throw"High surrogate without following low surrogate";const Qe=qe.charCodeAt(f+1);if(56320>Qe||Qe>57343)throw"High surrogate without following low surrogate";return qe.charAt(f)+qe.charAt(f+1)}if(f===0)throw"Low surrogate without preceding high surrogate";const Ke=qe.charCodeAt(f-1);if(55296>Ke||Ke>56319)throw"Low surrogate without preceding high surrogate";return!1},Ei=function(qe,f){let ze=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return qe.fill!==f.fill||qe.stroke!==f.stroke||qe.strokeWidth!==f.strokeWidth||qe.fontSize!==f.fontSize||qe.fontFamily!==f.fontFamily||qe.fontWeight!==f.fontWeight||qe.fontStyle!==f.fontStyle||qe.textBackgroundColor!==f.textBackgroundColor||qe.deltaY!==f.deltaY||ze&&(qe.overline!==f.overline||qe.underline!==f.underline||qe.linethrough!==f.linethrough)},Ai=(qe,f)=>{const ze=f.split(`
`),Ke=[];let Qe=-1,Pi={};qe=Oi(qe);for(let nn=0;nn<ze.length;nn++){const ln=Di(ze[nn]);if(qe[nn])for(let cn=0;cn<ln.length;cn++){Qe++;const hn=qe[nn][cn];hn&&Object.keys(hn).length>0&&(Ei(Pi,hn,!0)?Ke.push({start:Qe,end:Qe+1,style:hn}):Ke[Ke.length-1].end++),Pi=hn||{}}else Qe+=ln.length,Pi={}}return Ke},ji=(qe,f)=>{if(!Array.isArray(qe))return Oi(qe);const ze=f.split(F$1),Ke={};let Qe=-1,Pi=0;for(let nn=0;nn<ze.length;nn++){const ln=Di(ze[nn]);for(let cn=0;cn<ln.length;cn++)Qe++,qe[Pi]&&qe[Pi].start<=Qe&&Qe<qe[Pi].end&&(Ke[nn]=Ke[nn]||{},Ke[nn][cn]=s({},qe[Pi].style),Qe===qe[Pi].end-1&&Pi++)}return Ke},Fi=["display","transform",K$1,"fill-opacity","fill-rule","opacity",J,"stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function Li(qe,f){const ze=qe.nodeName,Ke=qe.getAttribute("class"),Qe=qe.getAttribute("id"),Pi="(?![a-zA-Z\\-]+)";let nn;if(nn=new RegExp("^"+ze,"i"),f=f.replace(nn,""),Qe&&f.length&&(nn=new RegExp("#"+Qe+Pi,"i"),f=f.replace(nn,"")),Ke&&f.length){const ln=Ke.split(" ");for(let cn=ln.length;cn--;)nn=new RegExp("\\."+ln[cn]+Pi,"i"),f=f.replace(nn,"")}return f.length===0}function Ri(qe,f){let ze=!0;const Ke=Li(qe,f.pop());return Ke&&f.length&&(ze=function(Qe,Pi){let nn,ln=!0;for(;Qe.parentElement&&Qe.parentElement.nodeType===1&&Pi.length;)ln&&(nn=Pi.pop()),ln=Li(Qe=Qe.parentElement,nn);return Pi.length===0}(qe,f)),Ke&&ze&&f.length===0}const Ii=qe=>{var f;return(f=He$1[qe])!==null&&f!==void 0?f:qe},Bi=new RegExp("(".concat(Ve$1,")"),"gi"),Xi=qe=>qe.replace(Bi," $1 ").replace(/,/gi," ").replace(/\s+/gi," ");var Yi,Wi,Vi,zi,Gi,Hi,Ni;const Ui="(".concat(Ve$1,")"),qi=String.raw(Yi||(Yi=r(["(skewX)(",")"],["(skewX)\\(","\\)"])),Ui),Ki=String.raw(Wi||(Wi=r(["(skewY)(",")"],["(skewY)\\(","\\)"])),Ui),Ji=String.raw(Vi||(Vi=r(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),Ui,Ui,Ui),Qi=String.raw(zi||(zi=r(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),Ui,Ui),Zi=String.raw(Gi||(Gi=r(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),Ui,Ui),$i=String.raw(Hi||(Hi=r(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),Ui,Ui,Ui,Ui,Ui,Ui),tr="(?:".concat($i,"|").concat(Zi,"|").concat(Ji,"|").concat(Qi,"|").concat(qi,"|").concat(Ki,")"),er="(?:".concat(tr,"*)"),sr=String.raw(Ni||(Ni=r(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),er),ir=new RegExp(sr),rr=new RegExp(tr),nr=new RegExp(tr,"g");function or(qe){const f=[];if(!(qe=Xi(qe).replace(/\s*([()])\s*/gi,"$1"))||qe&&!ir.test(qe))return[...T];for(const ze of qe.matchAll(nr)){const Ke=rr.exec(ze[0]);if(!Ke)continue;let Qe=T;const Pi=Ke.filter(ys=>!!ys),[,nn,...ln]=Pi,[cn,hn,un,xs,zn,Xn]=ln.map(ys=>parseFloat(ys));switch(nn){case"translate":Qe=Mt$1(cn,hn);break;case B$1:Qe=Pt$1({angle:cn},{x:hn,y:un});break;case G$1:Qe=Et$1(cn,hn);break;case U:Qe=jt$1(cn);break;case q:Qe=Ft$1(cn);break;case"matrix":Qe=[cn,hn,un,xs,zn,Xn]}f.push(Qe)}return Ot$1(f)}function ar(qe,f,ze,Ke){const Qe=Array.isArray(f);let Pi,nn=f;if(qe!==K$1&&qe!==J||f!==j$1){if(qe==="strokeUniform")return f==="non-scaling-stroke";if(qe==="strokeDashArray")nn=f===j$1?null:f.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(qe==="transformMatrix")nn=ze&&ze.transformMatrix?Tt$1(ze.transformMatrix,or(f)):or(f);else if(qe==="visible")nn=f!==j$1&&f!=="hidden",ze&&ze.visible===!1&&(nn=!1);else if(qe==="opacity")nn=parseFloat(f),ze&&ze.opacity!==void 0&&(nn*=ze.opacity);else if(qe==="textAnchor")nn=f==="start"?M$1:f==="end"?A:D$1;else if(qe==="charSpacing")Pi=Re$1(f,Ke)/Ke*1e3;else if(qe==="paintFirst"){const ln=f.indexOf(K$1),cn=f.indexOf(J);nn=K$1,(ln>-1&&cn>-1&&cn<ln||ln===-1&&cn>-1)&&(nn=J)}else{if(qe==="href"||qe==="xlink:href"||qe==="font"||qe==="id")return f;if(qe==="imageSmoothing")return f==="optimizeQuality";Pi=Qe?f.map(Re$1):Re$1(f,Ke)}}else nn="";return!Qe&&isNaN(Pi)?nn:Pi}function hr(qe,f){const ze=qe.match(Ge);if(!ze)return;const Ke=ze[1],Qe=ze[3],Pi=ze[4],nn=ze[5],ln=ze[6];Ke&&(f.fontStyle=Ke),Qe&&(f.fontWeight=isNaN(parseFloat(Qe))?Qe:parseFloat(Qe)),Pi&&(f.fontSize=Re$1(Pi)),ln&&(f.fontFamily=ln),nn&&(f.lineHeight=nn==="normal"?1:nn)}function cr(qe,f){qe.replace(/;\s*$/,"").split(";").forEach(ze=>{if(!ze)return;const[Ke,Qe]=ze.split(":");f[Ke.trim().toLowerCase()]=Qe.trim()})}function lr(qe){const f={},ze=qe.getAttribute("style");return ze&&(typeof ze=="string"?cr(ze,f):function(Ke,Qe){Object.entries(Ke).forEach(Pi=>{let[nn,ln]=Pi;ln!==void 0&&(Qe[nn.toLowerCase()]=ln)})}(ze,f)),f}const ur={stroke:"strokeOpacity",fill:"fillOpacity"};function dr(qe,f,ze){if(!qe)return{};let Ke,Qe={},Pi=O$1;qe.parentNode&&Je.test(qe.parentNode.nodeName)&&(Qe=dr(qe.parentElement,f,ze),Qe.fontSize&&(Ke=Pi=Re$1(Qe.fontSize)));const nn=s(s(s({},f.reduce((hn,un)=>{const xs=qe.getAttribute(un);return xs&&(hn[un]=xs),hn},{})),function(hn){let un=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},xs={};for(const zn in un)Ri(hn,zn.split(" "))&&(xs=s(s({},xs),un[zn]));return xs}(qe,ze)),lr(qe));nn[Ue]&&qe.setAttribute(Ue,nn[Ue]),nn[Ne$1]&&(Ke=Re$1(nn[Ne$1],Pi),nn[Ne$1]="".concat(Ke));const ln={};for(const hn in nn){const un=Ii(hn),xs=ar(un,nn[hn],Qe,Ke);ln[un]=xs}ln&&ln.font&&hr(ln.font,ln);const cn=s(s({},Qe),ln);return Je.test(qe.nodeName)?cn:function(hn){const un=_i.getDefaults();return Object.entries(ur).forEach(xs=>{let[zn,Xn]=xs;if(hn[Xn]===void 0||hn[zn]==="")return;if(hn[zn]===void 0){if(!un[zn])return;hn[zn]=un[zn]}if(hn[zn].indexOf("url(")===0)return;const ys=new Le$1(hn[zn]);hn[zn]=ys.setAlpha(Vt$1(ys.getAlpha()*hn[Xn],2)).toRgba()}),hn}(cn)}const gr=["left","top","width","height","visible"],fr=["rx","ry"];class pr extends _i{static getDefaults(){return s(s({},super.getDefaults()),pr.ownDefaults)}constructor(f){super(),Object.assign(this,pr.ownDefaults),this.setOptions(f),this._initRxRy()}_initRxRy(){const{rx:f,ry:ze}=this;f&&!ze?this.ry=f:ze&&!f&&(this.rx=ze)}_render(f){const{width:ze,height:Ke}=this,Qe=-ze/2,Pi=-Ke/2,nn=this.rx?Math.min(this.rx,ze/2):0,ln=this.ry?Math.min(this.ry,Ke/2):0,cn=nn!==0||ln!==0;f.beginPath(),f.moveTo(Qe+nn,Pi),f.lineTo(Qe+ze-nn,Pi),cn&&f.bezierCurveTo(Qe+ze-k$1*nn,Pi,Qe+ze,Pi+k$1*ln,Qe+ze,Pi+ln),f.lineTo(Qe+ze,Pi+Ke-ln),cn&&f.bezierCurveTo(Qe+ze,Pi+Ke-k$1*ln,Qe+ze-k$1*nn,Pi+Ke,Qe+ze-nn,Pi+Ke),f.lineTo(Qe+nn,Pi+Ke),cn&&f.bezierCurveTo(Qe+k$1*nn,Pi+Ke,Qe,Pi+Ke-k$1*ln,Qe,Pi+Ke-ln),f.lineTo(Qe,Pi+ln),cn&&f.bezierCurveTo(Qe,Pi+k$1*ln,Qe+k$1*nn,Pi,Qe+nn,Pi),f.closePath(),this._renderPaintInOrder(f)}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...fr,...f])}_toSVG(){const{width:f,height:ze,rx:Ke,ry:Qe}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-f/2,'" y="').concat(-ze/2,'" rx="').concat(Ke,'" ry="').concat(Qe,'" width="').concat(f,'" height="').concat(ze,`" />
`)]}static async fromElement(f,ze,Ke){const Qe=dr(f,this.ATTRIBUTE_NAMES,Ke),{left:Pi=0,top:nn=0,width:ln=0,height:cn=0,visible:hn=!0}=Qe,un=i(Qe,gr);return new this(s(s(s({},ze),un),{},{left:Pi,top:nn,width:ln,height:cn,visible:!!(hn&&ln&&cn)}))}}t(pr,"type","Rect"),t(pr,"cacheProperties",[...ps,...fr]),t(pr,"ownDefaults",{rx:0,ry:0}),t(pr,"ATTRIBUTE_NAMES",[...Fi,"x","y","rx","ry","width","height"]),tt.setClass(pr),tt.setSVGClass(pr);const mr="initialization",vr="added",yr="removed",_r="imperative",xr=(qe,f)=>{const{strokeUniform:ze,strokeWidth:Ke,width:Qe,height:Pi,group:nn}=f,ln=nn&&nn!==qe?fe$1(nn.calcTransformMatrix(),qe.calcTransformMatrix()):null,cn=ln?f.getRelativeCenterPoint().transform(ln):f.getRelativeCenterPoint(),hn=!f.isStrokeAccountedForInDimensions(),un=ze&&hn?me$1(new ot$1(Ke,Ke),void 0,qe.calcTransformMatrix()):at$1,xs=!ze&&hn?Ke:0,zn=ge$1(Qe+xs,Pi+xs,Ot$1([ln,f.calcOwnMatrix()],!0)).add(un).scalarDivide(2);return[cn.subtract(zn),cn.add(zn)]};class Cr{calcLayoutResult(f,ze){if(this.shouldPerformLayout(f))return this.calcBoundingBox(ze,f)}shouldPerformLayout(f){let{type:ze,prevStrategy:Ke,strategy:Qe}=f;return ze===mr||ze===_r||!!Ke&&Qe!==Ke}shouldLayoutClipPath(f){let{type:ze,target:{clipPath:Ke}}=f;return ze!==mr&&Ke&&!Ke.absolutePositioned}getInitialSize(f,ze){return ze.size}calcBoundingBox(f,ze){const{type:Ke,target:Qe}=ze;if(Ke===_r&&ze.overrides)return ze.overrides;if(f.length===0)return;const{left:Pi,top:nn,width:ln,height:cn}=ae$1(f.map(xs=>xr(Qe,xs)).reduce((xs,zn)=>xs.concat(zn),[])),hn=new ot$1(ln,cn),un=new ot$1(Pi,nn).add(hn.scalarDivide(2));if(Ke===mr){const xs=this.getInitialSize(ze,{size:hn,center:un});return{center:un,relativeCorrection:new ot$1(0,0),size:xs}}return{center:un.transform(Qe.calcOwnMatrix()),size:hn}}}t(Cr,"type","strategy");class br extends Cr{shouldPerformLayout(f){return!0}}t(br,"type","fit-content"),tt.setClass(br);const wr=["strategy"],Sr=["target","strategy","bubbles","prevStrategy"],Tr="layoutManager";class Or{constructor(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new br;t(this,"strategy",void 0),this.strategy=f,this._subscriptions=new Map}performLayout(f){const ze=s(s({bubbles:!0,strategy:this.strategy},f),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}});this.onBeforeLayout(ze);const Ke=this.getLayoutResult(ze);Ke&&this.commitLayout(ze,Ke),this.onAfterLayout(ze,Ke),this._prevLayoutStrategy=ze.strategy}attachHandlers(f,ze){const{target:Ke}=ze;return[Q$1,L,Y$1,I,R,X,z,W$1,V].map(Qe=>f.on(Qe,Pi=>this.performLayout(Qe===Q$1?{type:"object_modified",trigger:Qe,e:Pi,target:Ke}:{type:"object_modifying",trigger:Qe,e:Pi,target:Ke})))}subscribe(f,ze){this.unsubscribe(f,ze);const Ke=this.attachHandlers(f,ze);this._subscriptions.set(f,Ke)}unsubscribe(f,ze){(this._subscriptions.get(f)||[]).forEach(Ke=>Ke()),this._subscriptions.delete(f)}unsubscribeTargets(f){f.targets.forEach(ze=>this.unsubscribe(ze,f))}subscribeTargets(f){f.targets.forEach(ze=>this.subscribe(ze,f))}onBeforeLayout(f){const{target:ze,type:Ke}=f,{canvas:Qe}=ze;if(Ke===mr||Ke===vr?this.subscribeTargets(f):Ke===yr&&this.unsubscribeTargets(f),ze.fire("layout:before",{context:f}),Qe&&Qe.fire("object:layout:before",{target:ze,context:f}),Ke===_r&&f.deep){const Pi=i(f,wr);ze.forEachObject(nn=>nn.layoutManager&&nn.layoutManager.performLayout(s(s({},Pi),{},{bubbles:!1,target:nn})))}}getLayoutResult(f){const{target:ze,strategy:Ke,type:Qe}=f,Pi=Ke.calcLayoutResult(f,ze.getObjects());if(!Pi)return;const nn=Qe===mr?new ot$1:ze.getRelativeCenterPoint(),{center:ln,correction:cn=new ot$1,relativeCorrection:hn=new ot$1}=Pi,un=nn.subtract(ln).add(cn).transform(Qe===mr?T:St$1(ze.calcOwnMatrix()),!0).add(hn);return{result:Pi,prevCenter:nn,nextCenter:ln,offset:un}}commitLayout(f,ze){const{target:Ke}=f,{result:{size:Qe},nextCenter:Pi}=ze;var nn,ln;Ke.set({width:Qe.x,height:Qe.y}),this.layoutObjects(f,ze),f.type===mr?Ke.set({left:(nn=f.x)!==null&&nn!==void 0?nn:Pi.x+Qe.x*xe$1(Ke.originX),top:(ln=f.y)!==null&&ln!==void 0?ln:Pi.y+Qe.y*xe$1(Ke.originY)}):(Ke.setPositionByOrigin(Pi,D$1,D$1),Ke.setCoords(),Ke.set("dirty",!0))}layoutObjects(f,ze){const{target:Ke}=f;Ke.forEachObject(Qe=>{Qe.group===Ke&&this.layoutObject(f,ze,Qe)}),f.strategy.shouldLayoutClipPath(f)&&this.layoutObject(f,ze,Ke.clipPath)}layoutObject(f,ze,Ke){let{offset:Qe}=ze;Ke.set({left:Ke.left+Qe.x,top:Ke.top+Qe.y})}onAfterLayout(f,ze){const{target:Ke,strategy:Qe,bubbles:Pi,prevStrategy:nn}=f,ln=i(f,Sr),{canvas:cn}=Ke;Ke.fire("layout:after",{context:f,result:ze}),cn&&cn.fire("object:layout:after",{context:f,result:ze,target:Ke});const hn=Ke.parent;Pi&&hn!=null&&hn.layoutManager&&((ln.path||(ln.path=[])).push(Ke),hn.layoutManager.performLayout(s(s({},ln),{},{target:hn}))),Ke.set("dirty",!0)}dispose(){const{_subscriptions:f}=this;f.forEach(ze=>ze.forEach(Ke=>Ke())),f.clear()}toObject(){return{type:Tr,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}}tt.setClass(Or,Tr);const kr=["type","objects","layoutManager"];class Dr extends Or{performLayout(){}}class Mr extends ct(_i){static getDefaults(){return s(s({},super.getDefaults()),Mr.ownDefaults)}constructor(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),t(this,"_activeObjects",[]),t(this,"__objectSelectionTracker",void 0),t(this,"__objectSelectionDisposer",void 0),Object.assign(this,Mr.ownDefaults),this.setOptions(ze),this.groupInit(f,ze)}groupInit(f,ze){var Ke;this._objects=[...f],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject(Qe=>{this.enterGroup(Qe,!1)}),this.layoutManager=(Ke=ze.layoutManager)!==null&&Ke!==void 0?Ke:new Or,this.layoutManager.performLayout({type:mr,target:this,targets:[...f],x:ze.left,y:ze.top})}canEnterGroup(f){return f===this||this.isDescendantOf(f)?(a("error","Group: circular object trees are not supported, this call has no effect"),!1):this._objects.indexOf(f)===-1||(a("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(f){return f.filter((ze,Ke,Qe)=>this.canEnterGroup(ze)&&Qe.indexOf(ze)===Ke)}add(){for(var f=arguments.length,ze=new Array(f),Ke=0;Ke<f;Ke++)ze[Ke]=arguments[Ke];const Qe=this._filterObjectsBeforeEnteringGroup(ze),Pi=super.add(...Qe);return this._onAfterObjectsChange(vr,Qe),Pi}insertAt(f){for(var ze=arguments.length,Ke=new Array(ze>1?ze-1:0),Qe=1;Qe<ze;Qe++)Ke[Qe-1]=arguments[Qe];const Pi=this._filterObjectsBeforeEnteringGroup(Ke),nn=super.insertAt(f,...Pi);return this._onAfterObjectsChange(vr,Pi),nn}remove(){const f=super.remove(...arguments);return this._onAfterObjectsChange(yr,f),f}_onObjectAdded(f){this.enterGroup(f,!0),this.fire("object:added",{target:f}),f.fire("added",{target:this})}_onObjectRemoved(f,ze){this.exitGroup(f,ze),this.fire("object:removed",{target:f}),f.fire("removed",{target:this})}_onAfterObjectsChange(f,ze){this.layoutManager.performLayout({type:f,targets:ze,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(f,ze){const Ke=this[f];return super._set(f,ze),f==="canvas"&&Ke!==ze&&(this._objects||[]).forEach(Qe=>{Qe._set(f,ze)}),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(f,ze){let{target:Ke}=ze;const Qe=this._activeObjects;if(f)Qe.push(Ke),this._set("dirty",!0);else if(Qe.length>0){const Pi=Qe.indexOf(Ke);Pi>-1&&(Qe.splice(Pi,1),this._set("dirty",!0))}}_watchObject(f,ze){f&&this._watchObject(!1,ze),f?(ze.on("selected",this.__objectSelectionTracker),ze.on("deselected",this.__objectSelectionDisposer)):(ze.off("selected",this.__objectSelectionTracker),ze.off("deselected",this.__objectSelectionDisposer))}enterGroup(f,ze){f.group&&f.group.remove(f),f._set("parent",this),this._enterGroup(f,ze)}_enterGroup(f,ze){ze&&le$1(f,Tt$1(St$1(this.calcTransformMatrix()),f.calcTransformMatrix())),this._shouldSetNestedCoords()&&f.setCoords(),f._set("group",this),f._set("canvas",this.canvas),this._watchObject(!0,f);const Ke=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();Ke&&(Ke===f||f.isDescendantOf(Ke))&&this._activeObjects.push(f)}exitGroup(f,ze){this._exitGroup(f,ze),f._set("parent",void 0),f._set("canvas",void 0)}_exitGroup(f,ze){f._set("group",void 0),ze||(le$1(f,Tt$1(this.calcTransformMatrix(),f.calcTransformMatrix())),f.setCoords()),this._watchObject(!1,f);const Ke=this._activeObjects.length>0?this._activeObjects.indexOf(f):-1;Ke>-1&&this._activeObjects.splice(Ke,1)}shouldCache(){const f=_i.prototype.shouldCache.call(this);if(f){for(let ze=0;ze<this._objects.length;ze++)if(this._objects[ze].willDrawShadow())return this.ownCaching=!1,!1}return f}willDrawShadow(){if(super.willDrawShadow())return!0;for(let f=0;f<this._objects.length;f++)if(this._objects[f].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(f,ze,Ke){this._renderBackground(f);for(let Pi=0;Pi<this._objects.length;Pi++){var Qe;const nn=this._objects[Pi];(Qe=this.canvas)!==null&&Qe!==void 0&&Qe.preserveObjectStacking&&nn.group!==this?(f.save(),f.transform(...St$1(this.calcTransformMatrix())),nn.render(f),f.restore()):nn.group===this&&nn.render(f)}this._drawClipPath(f,this.clipPath,Ke)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject(f=>f.setCoords())}triggerLayout(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.layoutManager.performLayout(s({target:this,type:_r},f))}render(f){this._transformDone=!0,super.render(f),this._transformDone=!1}__serializeObjects(f,ze){const Ke=this.includeDefaultValues;return this._objects.filter(function(Qe){return!Qe.excludeFromExport}).map(function(Qe){const Pi=Qe.includeDefaultValues;Qe.includeDefaultValues=Ke;const nn=Qe[f||"toObject"](ze);return Qe.includeDefaultValues=Pi,nn})}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const ze=this.layoutManager.toObject();return s(s(s({},super.toObject(["subTargetCheck","interactive",...f])),ze.strategy!=="fit-content"||this.includeDefaultValues?{layoutManager:ze}:{}),{},{objects:this.__serializeObjects("toObject",f)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject(f=>{this._watchObject(!1,f),f.dispose()}),super.dispose()}_createSVGBgRect(f){if(!this.backgroundColor)return"";const ze=pr.prototype._toSVG.call(this),Ke=ze.indexOf("COMMON_PARTS");ze[Ke]='for="group" ';const Qe=ze.join("");return f?f(Qe):Qe}_toSVG(f){const ze=["<g ","COMMON_PARTS",` >
`],Ke=this._createSVGBgRect(f);Ke&&ze.push("		",Ke);for(let Qe=0;Qe<this._objects.length;Qe++)ze.push("		",this._objects[Qe].toSVG(f));return ze.push(`</g>
`),ze}getSvgStyles(){const f=this.opacity!==void 0&&this.opacity!==1?"opacity: ".concat(this.opacity,";"):"",ze=this.visible?"":" visibility: hidden;";return[f,this.getSvgFilter(),ze].join("")}toClipPathSVG(f){const ze=[],Ke=this._createSVGBgRect(f);Ke&&ze.push("	",Ke);for(let Qe=0;Qe<this._objects.length;Qe++)ze.push("	",this._objects[Qe].toClipPathSVG(f));return this._createBaseClipPathSVGMarkup(ze,{reviver:f})}static fromObject(f,ze){let{type:Ke,objects:Qe=[],layoutManager:Pi}=f,nn=i(f,kr);return Promise.all([Bt$1(Qe,ze),Xt$1(nn,ze)]).then(ln=>{let[cn,hn]=ln;const un=new this(cn,s(s(s({},nn),hn),{},{layoutManager:new Dr}));if(Pi){const xs=tt.getClass(Pi.type),zn=tt.getClass(Pi.strategy);un.layoutManager=new xs(new zn)}else un.layoutManager=new Or;return un.layoutManager.subscribeTargets({type:mr,target:un,targets:un.getObjects()}),un.setCoords(),un})}}t(Mr,"type","Group"),t(Mr,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),tt.setClass(Mr);const Pr=(qe,f)=>Math.min(f.width/qe.width,f.height/qe.height),Er=(qe,f)=>Math.max(f.width/qe.width,f.height/qe.height),Ar="\\s*,?\\s*",jr="".concat(Ar,"(").concat(Ve$1,")"),Fr="".concat(jr).concat(jr).concat(jr).concat(Ar,"([01])").concat(Ar,"([01])").concat(jr).concat(jr),Lr={m:"l",M:"L"},Rr=(qe,f,ze,Ke,Qe,Pi,nn,ln,cn,hn,un)=>{const xs=rt$1(qe),zn=nt$1(qe),Xn=rt$1(f),ys=nt$1(f),Jo=ze*Qe*Xn-Ke*Pi*ys+nn,ea=Ke*Qe*Xn+ze*Pi*ys+ln;return["C",hn+cn*(-ze*Qe*zn-Ke*Pi*xs),un+cn*(-Ke*Qe*zn+ze*Pi*xs),Jo+cn*(ze*Qe*ys+Ke*Pi*Xn),ea+cn*(Ke*Qe*ys-ze*Pi*Xn),Jo,ea]},Ir=(qe,f,ze,Ke)=>{const Qe=Math.atan2(f,qe),Pi=Math.atan2(Ke,ze);return Pi>=Qe?Pi-Qe:2*Math.PI-(Qe-Pi)};function Br(qe,f,ze,Ke,Qe,Pi,nn,ln){let cn;if(o.cachesBoundsOfCurve&&(cn=[...arguments].join(),_.boundsOfCurveCache[cn]))return _.boundsOfCurveCache[cn];const hn=Math.sqrt,un=Math.abs,xs=[],zn=[[0,0],[0,0]];let Xn=6*qe-12*ze+6*Qe,ys=-3*qe+9*ze-9*Qe+3*nn,Jo=3*ze-3*qe;for(let ia=0;ia<2;++ia){if(ia>0&&(Xn=6*f-12*Ke+6*Pi,ys=-3*f+9*Ke-9*Pi+3*ln,Jo=3*Ke-3*f),un(ys)<1e-12){if(un(Xn)<1e-12)continue;const ha=-Jo/Xn;0<ha&&ha<1&&xs.push(ha);continue}const sa=Xn*Xn-4*Jo*ys;if(sa<0)continue;const Ma=hn(sa),pa=(-Xn+Ma)/(2*ys);0<pa&&pa<1&&xs.push(pa);const oa=(-Xn-Ma)/(2*ys);0<oa&&oa<1&&xs.push(oa)}let ea=xs.length;const ra=ea,na=Vr(qe,f,ze,Ke,Qe,Pi,nn,ln);for(;ea--;){const{x:ia,y:sa}=na(xs[ea]);zn[0][ea]=ia,zn[1][ea]=sa}zn[0][ra]=qe,zn[1][ra]=f,zn[0][ra+1]=nn,zn[1][ra+1]=ln;const ta=[new ot$1(Math.min(...zn[0]),Math.min(...zn[1])),new ot$1(Math.max(...zn[0]),Math.max(...zn[1]))];return o.cachesBoundsOfCurve&&(_.boundsOfCurveCache[cn]=ta),ta}const Xr=(qe,f,ze)=>{let[Ke,Qe,Pi,nn,ln,cn,hn,un]=ze;const xs=((zn,Xn,ys,Jo,ea,ra,na)=>{if(ys===0||Jo===0)return[];let ta=0,ia=0,sa=0;const Ma=Math.PI,pa=na*S$1,oa=nt$1(pa),ha=rt$1(pa),ca=.5*(-ha*zn-oa*Xn),da=.5*(-ha*Xn+oa*zn),ga=ys**2,qa=Jo**2,Ka=da**2,il=ca**2,cl=ga*qa-ga*Ka-qa*il;let wl=Math.abs(ys),al=Math.abs(Jo);if(cl<0){const Al=Math.sqrt(1-cl/(ga*qa));wl*=Al,al*=Al}else sa=(ea===ra?-1:1)*Math.sqrt(cl/(ga*Ka+qa*il));const vl=sa*wl*da/al,ml=-sa*al*ca/wl,ol=ha*vl-oa*ml+.5*zn,el=oa*vl+ha*ml+.5*Xn;let dl=Ir(1,0,(ca-vl)/wl,(da-ml)/al),xl=Ir((ca-vl)/wl,(da-ml)/al,(-ca-vl)/wl,(-da-ml)/al);ra===0&&xl>0?xl-=2*Ma:ra===1&&xl<0&&(xl+=2*Ma);const Ja=Math.ceil(Math.abs(xl/Ma*2)),yl=[],Ol=xl/Ja,Il=8/3*Math.sin(Ol/4)*Math.sin(Ol/4)/Math.sin(Ol/2);let Rl=dl+Ol;for(let Al=0;Al<Ja;Al++)yl[Al]=Rr(dl,Rl,ha,oa,wl,al,ol,el,Il,ta,ia),ta=yl[Al][5],ia=yl[Al][6],dl=Rl,Rl+=Ol;return yl})(hn-qe,un-f,Qe,Pi,ln,cn,nn);for(let zn=0,Xn=xs.length;zn<Xn;zn++)xs[zn][1]+=qe,xs[zn][2]+=f,xs[zn][3]+=qe,xs[zn][4]+=f,xs[zn][5]+=qe,xs[zn][6]+=f;return xs},Yr=qe=>{let f=0,ze=0,Ke=0,Qe=0;const Pi=[];let nn,ln=0,cn=0;for(const hn of qe){const un=[...hn];let xs;switch(un[0]){case"l":un[1]+=f,un[2]+=ze;case"L":f=un[1],ze=un[2],xs=["L",f,ze];break;case"h":un[1]+=f;case"H":f=un[1],xs=["L",f,ze];break;case"v":un[1]+=ze;case"V":ze=un[1],xs=["L",f,ze];break;case"m":un[1]+=f,un[2]+=ze;case"M":f=un[1],ze=un[2],Ke=un[1],Qe=un[2],xs=["M",f,ze];break;case"c":un[1]+=f,un[2]+=ze,un[3]+=f,un[4]+=ze,un[5]+=f,un[6]+=ze;case"C":ln=un[3],cn=un[4],f=un[5],ze=un[6],xs=["C",un[1],un[2],ln,cn,f,ze];break;case"s":un[1]+=f,un[2]+=ze,un[3]+=f,un[4]+=ze;case"S":nn==="C"?(ln=2*f-ln,cn=2*ze-cn):(ln=f,cn=ze),f=un[3],ze=un[4],xs=["C",ln,cn,un[1],un[2],f,ze],ln=xs[3],cn=xs[4];break;case"q":un[1]+=f,un[2]+=ze,un[3]+=f,un[4]+=ze;case"Q":ln=un[1],cn=un[2],f=un[3],ze=un[4],xs=["Q",ln,cn,f,ze];break;case"t":un[1]+=f,un[2]+=ze;case"T":nn==="Q"?(ln=2*f-ln,cn=2*ze-cn):(ln=f,cn=ze),f=un[1],ze=un[2],xs=["Q",ln,cn,f,ze];break;case"a":un[6]+=f,un[7]+=ze;case"A":Xr(f,ze,un).forEach(zn=>Pi.push(zn)),f=un[6],ze=un[7];break;case"z":case"Z":f=Ke,ze=Qe,xs=["Z"]}xs?(Pi.push(xs),nn=xs[0]):nn=""}return Pi},Wr=(qe,f,ze,Ke)=>Math.sqrt((ze-qe)**2+(Ke-f)**2),Vr=(qe,f,ze,Ke,Qe,Pi,nn,ln)=>cn=>{const hn=cn**3,un=(Xn=>3*Xn**2*(1-Xn))(cn),xs=(Xn=>3*Xn*(1-Xn)**2)(cn),zn=(Xn=>(1-Xn)**3)(cn);return new ot$1(nn*hn+Qe*un+ze*xs+qe*zn,ln*hn+Pi*un+Ke*xs+f*zn)},zr=qe=>qe**2,Gr=qe=>2*qe*(1-qe),Hr=qe=>(1-qe)**2,Nr=(qe,f,ze,Ke,Qe,Pi,nn,ln)=>cn=>{const hn=zr(cn),un=Gr(cn),xs=Hr(cn),zn=3*(xs*(ze-qe)+un*(Qe-ze)+hn*(nn-Qe)),Xn=3*(xs*(Ke-f)+un*(Pi-Ke)+hn*(ln-Pi));return Math.atan2(Xn,zn)},Ur=(qe,f,ze,Ke,Qe,Pi)=>nn=>{const ln=zr(nn),cn=Gr(nn),hn=Hr(nn);return new ot$1(Qe*ln+ze*cn+qe*hn,Pi*ln+Ke*cn+f*hn)},qr=(qe,f,ze,Ke,Qe,Pi)=>nn=>{const ln=1-nn,cn=2*(ln*(ze-qe)+nn*(Qe-ze)),hn=2*(ln*(Ke-f)+nn*(Pi-Ke));return Math.atan2(hn,cn)},Kr=(qe,f,ze)=>{let Ke=new ot$1(f,ze),Qe=0;for(let Pi=1;Pi<=100;Pi+=1){const nn=qe(Pi/100);Qe+=Wr(Ke.x,Ke.y,nn.x,nn.y),Ke=nn}return Qe},Jr=(qe,f)=>{let ze,Ke=0,Qe=0,Pi={x:qe.x,y:qe.y},nn=s({},Pi),ln=.01,cn=0;const hn=qe.iterator,un=qe.angleFinder;for(;Qe<f&&ln>1e-4;)nn=hn(Ke),cn=Ke,ze=Wr(Pi.x,Pi.y,nn.x,nn.y),ze+Qe>f?(Ke-=ln,ln/=2):(Pi=nn,Ke+=ln,Qe+=ze);return s(s({},nn),{},{angle:un(cn)})},Qr=qe=>{let f,ze,Ke=0,Qe=0,Pi=0,nn=0,ln=0;const cn=[];for(const hn of qe){const un={x:Qe,y:Pi,command:hn[0],length:0};switch(hn[0]){case"M":ze=un,ze.x=nn=Qe=hn[1],ze.y=ln=Pi=hn[2];break;case"L":ze=un,ze.length=Wr(Qe,Pi,hn[1],hn[2]),Qe=hn[1],Pi=hn[2];break;case"C":f=Vr(Qe,Pi,hn[1],hn[2],hn[3],hn[4],hn[5],hn[6]),ze=un,ze.iterator=f,ze.angleFinder=Nr(Qe,Pi,hn[1],hn[2],hn[3],hn[4],hn[5],hn[6]),ze.length=Kr(f,Qe,Pi),Qe=hn[5],Pi=hn[6];break;case"Q":f=Ur(Qe,Pi,hn[1],hn[2],hn[3],hn[4]),ze=un,ze.iterator=f,ze.angleFinder=qr(Qe,Pi,hn[1],hn[2],hn[3],hn[4]),ze.length=Kr(f,Qe,Pi),Qe=hn[3],Pi=hn[4];break;case"Z":ze=un,ze.destX=nn,ze.destY=ln,ze.length=Wr(Qe,Pi,nn,ln),Qe=nn,Pi=ln}Ke+=ze.length,cn.push(ze)}return cn.push({length:Ke,x:Qe,y:Pi}),cn},Zr=function(qe,f){let ze=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Qr(qe),Ke=0;for(;f-ze[Ke].length>0&&Ke<ze.length-2;)f-=ze[Ke].length,Ke++;const Qe=ze[Ke],Pi=f/Qe.length,nn=qe[Ke];switch(Qe.command){case"M":return{x:Qe.x,y:Qe.y,angle:0};case"Z":return s(s({},new ot$1(Qe.x,Qe.y).lerp(new ot$1(Qe.destX,Qe.destY),Pi)),{},{angle:Math.atan2(Qe.destY-Qe.y,Qe.destX-Qe.x)});case"L":return s(s({},new ot$1(Qe.x,Qe.y).lerp(new ot$1(nn[1],nn[2]),Pi)),{},{angle:Math.atan2(nn[2]-Qe.y,nn[1]-Qe.x)});case"C":case"Q":return Jr(Qe,f)}},$r=new RegExp("[mzlhvcsqta][^mzlhvcsqta]*","gi"),tn=new RegExp(Fr,"g"),en=new RegExp(Ve$1,"gi"),sn={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},rn=qe=>{var f;const ze=[],Ke=(f=qe.match($r))!==null&&f!==void 0?f:[];for(const Qe of Ke){const Pi=Qe[0];if(Pi==="z"||Pi==="Z"){ze.push([Pi]);continue}const nn=sn[Pi.toLowerCase()];let ln=[];if(Pi==="a"||Pi==="A"){tn.lastIndex=0;for(let cn=null;cn=tn.exec(Qe);)ln.push(...cn.slice(1))}else ln=Qe.match(en)||[];for(let cn=0;cn<ln.length;cn+=nn){const hn=new Array(nn),un=Lr[Pi];hn[0]=cn>0&&un?un:Pi;for(let xs=0;xs<nn;xs++)hn[xs+1]=parseFloat(ln[cn+xs]);ze.push(hn)}}return ze},on=(qe,f)=>qe.map(ze=>ze.map((Ke,Qe)=>Qe===0||f===void 0?Ke:Vt$1(Ke,f)).join(" ")).join(" ");function an(qe,f){const ze=qe.style;ze&&f&&(typeof f=="string"?ze.cssText+=";"+f:Object.entries(f).forEach(Ke=>{let[Qe,Pi]=Ke;return ze.setProperty(Qe,Pi)}))}class dn extends te$1{constructor(f){let{allowTouchScrolling:ze=!1,containerClass:Ke=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(f),t(this,"upper",void 0),t(this,"container",void 0);const{el:Qe}=this.lower,Pi=this.createUpperCanvas();this.upper={el:Pi,ctx:Pi.getContext("2d")},this.applyCanvasStyle(Qe,{allowTouchScrolling:ze}),this.applyCanvasStyle(Pi,{allowTouchScrolling:ze,styles:{position:"absolute",left:"0",top:"0"}});const nn=this.createContainerElement();nn.classList.add(Ke),Qe.parentNode&&Qe.parentNode.replaceChild(nn,Qe),nn.append(Qe,Pi),this.container=nn}createUpperCanvas(){const{el:f}=this.lower,ze=pt$1();return ze.className=f.className,ze.classList.remove("lower-canvas"),ze.classList.add("upper-canvas"),ze.setAttribute("data-fabric","top"),ze.style.cssText=f.style.cssText,ze.setAttribute("draggable","true"),ze}createContainerElement(){const f=m().createElement("div");return f.setAttribute("data-fabric","wrapper"),an(f,{position:"relative"}),$t$1(f),f}applyCanvasStyle(f,ze){const{styles:Ke,allowTouchScrolling:Qe}=ze;an(f,s(s({},Ke),{},{"touch-action":Qe?"manipulation":j$1})),$t$1(f)}setDimensions(f,ze){super.setDimensions(f,ze);const{el:Ke,ctx:Qe}=this.upper;Qt$1(Ke,Qe,f,ze)}setCSSDimensions(f){super.setCSSDimensions(f),Zt$1(this.upper.el,f),Zt$1(this.container,f)}cleanupDOM(f){const ze=this.container,{el:Ke}=this.lower,{el:Qe}=this.upper;super.cleanupDOM(f),ze.removeChild(Qe),ze.removeChild(Ke),ze.parentNode&&ze.parentNode.replaceChild(Ke,ze)}dispose(){super.dispose(),p$1().dispose(this.upper.el),delete this.upper,delete this.container}}class gn extends se$1{constructor(){super(...arguments),t(this,"targets",[]),t(this,"_hoveredTargets",[]),t(this,"_objectsToRender",void 0),t(this,"_currentTransform",null),t(this,"_groupSelector",null),t(this,"contextTopDirty",!1)}static getDefaults(){return s(s({},super.getDefaults()),gn.ownDefaults)}get upperCanvasEl(){var f;return(f=this.elements.upper)===null||f===void 0?void 0:f.el}get contextTop(){var f;return(f=this.elements.upper)===null||f===void 0?void 0:f.ctx}get wrapperEl(){return this.elements.container}initElements(f){this.elements=new dn(f,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(f){this._objectsToRender=void 0,super._onObjectAdded(f)}_onObjectRemoved(f){this._objectsToRender=void 0,f===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[f]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[f]}),f.fire("deselected",{target:f})),f===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(f)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){const f=this._activeObject;return!this.preserveObjectStacking&&f?this._objects.filter(ze=>!ze.group&&ze!==f).concat(f):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(f){f.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(f),this.contextTopDirty=!0),f.restore()}renderTop(){const f=this.contextTop;this.clearContext(f),this.renderTopLayer(f),this.fire("after:render",{ctx:f})}setTargetFindTolerance(f){f=Math.round(f),this.targetFindTolerance=f;const ze=this.getRetinaScaling(),Ke=Math.ceil((2*f+1)*ze);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=Ke,this.pixelFindContext.scale(ze,ze)}isTargetTransparent(f,ze,Ke){const Qe=this.targetFindTolerance,Pi=this.pixelFindContext;this.clearContext(Pi),Pi.save(),Pi.translate(-ze+Qe,-Ke+Qe),Pi.transform(...this.viewportTransform);const nn=f.selectionBackgroundColor;f.selectionBackgroundColor="",f.render(Pi),f.selectionBackgroundColor=nn,Pi.restore();const ln=Math.round(Qe*this.getRetinaScaling());return xi(Pi,ln,ln,ln)}_isSelectionKeyPressed(f){const ze=this.selectionKey;return!!ze&&(Array.isArray(ze)?!!ze.find(Ke=>!!Ke&&f[Ke]===!0):f[ze])}_shouldClearSelection(f,ze){const Ke=this.getActiveObjects(),Qe=this._activeObject;return!!(!ze||ze&&Qe&&Ke.length>1&&Ke.indexOf(ze)===-1&&Qe!==ze&&!this._isSelectionKeyPressed(f)||ze&&!ze.evented||ze&&!ze.selectable&&Qe&&Qe!==ze)}_shouldCenterTransform(f,ze,Ke){if(!f)return;let Qe;return ze===G$1||ze===H||ze===N$1||ze===Y$1?Qe=this.centeredScaling||f.centeredScaling:ze===B$1&&(Qe=this.centeredRotation||f.centeredRotation),Qe?!Ke:Ke}_getOriginFromCorner(f,ze){const Ke={x:f.originX,y:f.originY};return ze&&(["ml","tl","bl"].includes(ze)?Ke.x=A:["mr","tr","br"].includes(ze)&&(Ke.x=M$1),["tl","mt","tr"].includes(ze)?Ke.y=E$1:["bl","mb","br"].includes(ze)&&(Ke.y=P)),Ke}_setupCurrentTransform(f,ze,Ke){var Qe;const Pi=ze.group?pe$1(this.getScenePoint(f),void 0,ze.group.calcTransformMatrix()):this.getScenePoint(f),{key:nn="",control:ln}=ze.getActiveControl()||{},cn=Ke&&ln?(Qe=ln.getActionHandler(f,ze,ln))===null||Qe===void 0?void 0:Qe.bind(ln):De$1,hn=((Xn,ys,Jo,ea)=>{if(!ys||!Xn)return"drag";const ra=ea.controls[ys];return ra.getActionName(Jo,ra,ea)})(Ke,nn,f,ze),un=f[this.centeredKey],xs=this._shouldCenterTransform(ze,hn,un)?{x:D$1,y:D$1}:this._getOriginFromCorner(ze,nn),zn={target:ze,action:hn,actionHandler:cn,actionPerformed:!1,corner:nn,scaleX:ze.scaleX,scaleY:ze.scaleY,skewX:ze.skewX,skewY:ze.skewY,offsetX:Pi.x-ze.left,offsetY:Pi.y-ze.top,originX:xs.x,originY:xs.y,ex:Pi.x,ey:Pi.y,lastX:Pi.x,lastY:Pi.y,theta:xt$1(ze.angle),width:ze.width,height:ze.height,shiftKey:f.shiftKey,altKey:un,original:s(s({},de$1(ze)),{},{originX:xs.x,originY:xs.y})};this._currentTransform=zn,this.fire("before:transform",{e:f,transform:zn})}setCursor(f){this.upperCanvasEl.style.cursor=f}_drawSelection(f){const{x:ze,y:Ke,deltaX:Qe,deltaY:Pi}=this._groupSelector,nn=new ot$1(ze,Ke).transform(this.viewportTransform),ln=new ot$1(ze+Qe,Ke+Pi).transform(this.viewportTransform),cn=this.selectionLineWidth/2;let hn=Math.min(nn.x,ln.x),un=Math.min(nn.y,ln.y),xs=Math.max(nn.x,ln.x),zn=Math.max(nn.y,ln.y);this.selectionColor&&(f.fillStyle=this.selectionColor,f.fillRect(hn,un,xs-hn,zn-un)),this.selectionLineWidth&&this.selectionBorderColor&&(f.lineWidth=this.selectionLineWidth,f.strokeStyle=this.selectionBorderColor,hn+=cn,un+=cn,xs-=cn,zn-=cn,_i.prototype._setLineDash.call(this,f,this.selectionDashArray),f.strokeRect(hn,un,xs-hn,zn-un))}findTarget(f){if(this.skipTargetFind)return;const ze=this.getViewportPoint(f),Ke=this._activeObject,Qe=this.getActiveObjects();if(this.targets=[],Ke&&Qe.length>=1){if(Ke.findControl(ze,ne$1(f))||Qe.length>1&&this.searchPossibleTargets([Ke],ze))return Ke;if(Ke===this.searchPossibleTargets([Ke],ze)){if(this.preserveObjectStacking){const Pi=this.targets;this.targets=[];const nn=this.searchPossibleTargets(this._objects,ze);return f[this.altSelectionKey]&&nn&&nn!==Ke?(this.targets=Pi,Ke):nn}return Ke}}return this.searchPossibleTargets(this._objects,ze)}_pointIsInObjectSelectionArea(f,ze){let Ke=f.getCoords();const Qe=this.getZoom(),Pi=f.padding/Qe;if(Pi){const[nn,ln,cn,hn]=Ke,un=Math.atan2(ln.y-nn.y,ln.x-nn.x),xs=rt$1(un)*Pi,zn=nt$1(un)*Pi,Xn=xs+zn,ys=xs-zn;Ke=[new ot$1(nn.x-ys,nn.y-Xn),new ot$1(ln.x+Xn,ln.y-ys),new ot$1(cn.x+ys,cn.y+Xn),new ot$1(hn.x-Xn,hn.y+ys)]}return Ls.isPointInPolygon(ze,Ke)}_checkTarget(f,ze){return!!(f&&f.visible&&f.evented&&this._pointIsInObjectSelectionArea(f,pe$1(ze,void 0,this.viewportTransform))&&(!this.perPixelTargetFind&&!f.perPixelTargetFind||f.isEditing||!this.isTargetTransparent(f,ze.x,ze.y)))}_searchPossibleTargets(f,ze){let Ke=f.length;for(;Ke--;){const Qe=f[Ke];if(this._checkTarget(Qe,ze)){if(ht$1(Qe)&&Qe.subTargetCheck){const Pi=this._searchPossibleTargets(Qe._objects,ze);Pi&&this.targets.push(Pi)}return Qe}}}searchPossibleTargets(f,ze){const Ke=this._searchPossibleTargets(f,ze);if(Ke&&ht$1(Ke)&&Ke.interactive&&this.targets[0]){const Qe=this.targets;for(let Pi=Qe.length-1;Pi>0;Pi--){const nn=Qe[Pi];if(!ht$1(nn)||!nn.interactive)return nn}return Qe[0]}return Ke}getViewportPoint(f){return this._pointer?this._pointer:this.getPointer(f,!0)}getScenePoint(f){return this._absolutePointer?this._absolutePointer:this.getPointer(f)}getPointer(f){let ze=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const Ke=this.upperCanvasEl,Qe=Ke.getBoundingClientRect();let Pi=re$1(f),nn=Qe.width||0,ln=Qe.height||0;nn&&ln||(P in Qe&&E$1 in Qe&&(ln=Math.abs(Qe.top-Qe.bottom)),A in Qe&&M$1 in Qe&&(nn=Math.abs(Qe.right-Qe.left))),this.calcOffset(),Pi.x=Pi.x-this._offset.left,Pi.y=Pi.y-this._offset.top,ze||(Pi=pe$1(Pi,void 0,this.viewportTransform));const cn=this.getRetinaScaling();cn!==1&&(Pi.x/=cn,Pi.y/=cn);const hn=nn===0||ln===0?new ot$1(1,1):new ot$1(Ke.width/nn,Ke.height/ln);return Pi.multiply(hn)}_setDimensionsImpl(f,ze){this._resetTransformEventData(),super._setDimensionsImpl(f,ze),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=pt$1(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){const f=this._activeObject;return Ut$1(f)?f.getObjects():f?[f]:[]}_fireSelectionEvents(f,ze){let Ke=!1,Qe=!1;const Pi=this.getActiveObjects(),nn=[],ln=[];f.forEach(cn=>{Pi.includes(cn)||(Ke=!0,cn.fire("deselected",{e:ze,target:cn}),ln.push(cn))}),Pi.forEach(cn=>{f.includes(cn)||(Ke=!0,cn.fire("selected",{e:ze,target:cn}),nn.push(cn))}),f.length>0&&Pi.length>0?(Qe=!0,Ke&&this.fire("selection:updated",{e:ze,selected:nn,deselected:ln})):Pi.length>0?(Qe=!0,this.fire("selection:created",{e:ze,selected:nn})):f.length>0&&(Qe=!0,this.fire("selection:cleared",{e:ze,deselected:ln})),Qe&&(this._objectsToRender=void 0)}setActiveObject(f,ze){const Ke=this.getActiveObjects(),Qe=this._setActiveObject(f,ze);return this._fireSelectionEvents(Ke,ze),Qe}_setActiveObject(f,ze){const Ke=this._activeObject;return Ke!==f&&!(!this._discardActiveObject(ze,f)&&this._activeObject)&&!f.onSelect({e:ze})&&(this._activeObject=f,Ut$1(f)&&Ke!==f&&f.set("canvas",this),f.setCoords(),!0)}_discardActiveObject(f,ze){const Ke=this._activeObject;return!!Ke&&!Ke.onDeselect({e:f,object:ze})&&(this._currentTransform&&this._currentTransform.target===Ke&&this.endCurrentTransform(f),Ut$1(Ke)&&Ke===this._hoveredTarget&&(this._hoveredTarget=void 0),this._activeObject=void 0,!0)}discardActiveObject(f){const ze=this.getActiveObjects(),Ke=this.getActiveObject();ze.length&&this.fire("before:selection:cleared",{e:f,deselected:[Ke]});const Qe=this._discardActiveObject(f);return this._fireSelectionEvents(ze,f),Qe}endCurrentTransform(f){const ze=this._currentTransform;this._finalizeCurrentTransform(f),ze&&ze.target&&(ze.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(f){const ze=this._currentTransform,Ke=ze.target,Qe={e:f,target:Ke,transform:ze,action:ze.action};Ke._scaling&&(Ke._scaling=!1),Ke.setCoords(),ze.actionPerformed&&(this.fire("object:modified",Qe),Ke.fire(Q$1,Qe))}setViewportTransform(f){super.setViewportTransform(f);const ze=this._activeObject;ze&&ze.setCoords()}destroy(){const f=this._activeObject;Ut$1(f)&&(f.removeAll(),f.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(f){const ze=this._activeObject;ze&&ze._renderControls(f)}_toObject(f,ze,Ke){const Qe=this._realizeGroupTransformOnObject(f),Pi=super._toObject(f,ze,Ke);return f.set(Qe),Pi}_realizeGroupTransformOnObject(f){const{group:ze}=f;if(ze&&Ut$1(ze)&&this._activeObject===ze){const Ke=Yt$1(f,["angle","flipX","flipY",M$1,H,N$1,U,q,P]);return ce$1(f,ze.calcOwnMatrix()),Ke}return{}}_setSVGObject(f,ze,Ke){const Qe=this._realizeGroupTransformOnObject(ze);super._setSVGObject(f,ze,Ke),ze.set(Qe)}}t(gn,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});class fn{constructor(f){t(this,"targets",[]),t(this,"__disposer",void 0);const ze=()=>{const{hiddenTextarea:Qe}=f.getActiveObject()||{};Qe&&Qe.focus()},Ke=f.upperCanvasEl;Ke.addEventListener("click",ze),this.__disposer=()=>Ke.removeEventListener("click",ze)}exitTextEditing(){this.target=void 0,this.targets.forEach(f=>{f.isEditing&&f.exitEditing()})}add(f){this.targets.push(f)}remove(f){this.unregister(f),it$1(this.targets,f)}register(f){this.target=f}unregister(f){f===this.target&&(this.target=void 0)}onMouseMove(f){var ze;!((ze=this.target)===null||ze===void 0)&&ze.isEditing&&this.target.updateSelectionOnMouseMove(f)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}const pn=["target","oldTarget","fireCanvas","e"],mn={passive:!1},vn=(qe,f)=>{const ze=qe.getViewportPoint(f),Ke=qe.getScenePoint(f);return{viewportPoint:ze,scenePoint:Ke,pointer:ze,absolutePointer:Ke}},yn=function(qe){for(var f=arguments.length,ze=new Array(f>1?f-1:0),Ke=1;Ke<f;Ke++)ze[Ke-1]=arguments[Ke];return qe.addEventListener(...ze)},_n=function(qe){for(var f=arguments.length,ze=new Array(f>1?f-1:0),Ke=1;Ke<f;Ke++)ze[Ke-1]=arguments[Ke];return qe.removeEventListener(...ze)},xn={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class Cn extends gn{constructor(f){super(f,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}),t(this,"_isClick",void 0),t(this,"textEditingManager",new fn(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach(ze=>{this[ze]=this[ze].bind(this)}),this.addOrRemove(yn,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(f,ze){const Ke=this.upperCanvasEl,Qe=this._getEventPrefix();f(Jt$1(Ke),"resize",this._onResize),f(Ke,Qe+"down",this._onMouseDown),f(Ke,"".concat(Qe,"move"),this._onMouseMove,mn),f(Ke,"".concat(Qe,"out"),this._onMouseOut),f(Ke,"".concat(Qe,"enter"),this._onMouseEnter),f(Ke,"wheel",this._onMouseWheel),f(Ke,"contextmenu",this._onContextMenu),f(Ke,"click",this._onClick),f(Ke,"dblclick",this._onClick),f(Ke,"dragstart",this._onDragStart),f(Ke,"dragend",this._onDragEnd),f(Ke,"dragover",this._onDragOver),f(Ke,"dragenter",this._onDragEnter),f(Ke,"dragleave",this._onDragLeave),f(Ke,"drop",this._onDrop),this.enablePointerEvents||f(Ke,"touchstart",this._onTouchStart,mn)}removeListeners(){this.addOrRemove(_n,"remove");const f=this._getEventPrefix(),ze=Kt$1(this.upperCanvasEl);_n(ze,"".concat(f,"up"),this._onMouseUp),_n(ze,"touchend",this._onTouchEnd,mn),_n(ze,"".concat(f,"move"),this._onMouseMove,mn),_n(ze,"touchmove",this._onMouseMove,mn),clearTimeout(this._willAddMouseDown)}_onMouseWheel(f){this.__onMouseWheel(f)}_onMouseOut(f){const ze=this._hoveredTarget,Ke=s({e:f},vn(this,f));this.fire("mouse:out",s(s({},Ke),{},{target:ze})),this._hoveredTarget=void 0,ze&&ze.fire("mouseout",s({},Ke)),this._hoveredTargets.forEach(Qe=>{this.fire("mouse:out",s(s({},Ke),{},{target:Qe})),Qe&&Qe.fire("mouseout",s({},Ke))}),this._hoveredTargets=[]}_onMouseEnter(f){this._currentTransform||this.findTarget(f)||(this.fire("mouse:over",s({e:f},vn(this,f))),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(f){this._isClick=!1;const ze=this.getActiveObject();if(ze&&ze.onDragStart(f)){this._dragSource=ze;const Ke={e:f,target:ze};return this.fire("dragstart",Ke),ze.fire("dragstart",Ke),void yn(this.upperCanvasEl,"drag",this._onDragProgress)}oe$1(f)}_renderDragEffects(f,ze,Ke){let Qe=!1;const Pi=this._dropTarget;Pi&&Pi!==ze&&Pi!==Ke&&(Pi.clearContextTop(),Qe=!0),ze==null||ze.clearContextTop(),Ke!==ze&&(Ke==null||Ke.clearContextTop());const nn=this.contextTop;nn.save(),nn.transform(...this.viewportTransform),ze&&(nn.save(),ze.transform(nn),ze.renderDragSourceEffect(f),nn.restore(),Qe=!0),Ke&&(nn.save(),Ke.transform(nn),Ke.renderDropTargetEffect(f),nn.restore(),Qe=!0),nn.restore(),Qe&&(this.contextTopDirty=!0)}_onDragEnd(f){const ze=!!f.dataTransfer&&f.dataTransfer.dropEffect!==j$1,Ke=ze?this._activeObject:void 0,Qe={e:f,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:ze,dropTarget:Ke};_n(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",Qe),this._dragSource&&this._dragSource.fire("dragend",Qe),delete this._dragSource,this._onMouseUp(f)}_onDragProgress(f){const ze={e:f,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",ze),this._dragSource&&this._dragSource.fire("drag",ze)}findDragTargets(f){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(f)),targets:[...this.targets]}}_onDragOver(f){const ze="dragover",{target:Ke,targets:Qe}=this.findDragTargets(f),Pi=this._dragSource,nn={e:f,target:Ke,subTargets:Qe,dragSource:Pi,canDrop:!1,dropTarget:void 0};let ln;this.fire(ze,nn),this._fireEnterLeaveEvents(Ke,nn),Ke&&(Ke.canDrop(f)&&(ln=Ke),Ke.fire(ze,nn));for(let cn=0;cn<Qe.length;cn++){const hn=Qe[cn];hn.canDrop(f)&&(ln=hn),hn.fire(ze,nn)}this._renderDragEffects(f,Pi,ln),this._dropTarget=ln}_onDragEnter(f){const{target:ze,targets:Ke}=this.findDragTargets(f),Qe={e:f,target:ze,subTargets:Ke,dragSource:this._dragSource};this.fire("dragenter",Qe),this._fireEnterLeaveEvents(ze,Qe)}_onDragLeave(f){const ze={e:f,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",ze),this._fireEnterLeaveEvents(void 0,ze),this._renderDragEffects(f,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(f){const{target:ze,targets:Ke}=this.findDragTargets(f),Qe=this._basicEventHandler("drop:before",s({e:f,target:ze,subTargets:Ke,dragSource:this._dragSource},vn(this,f)));Qe.didDrop=!1,Qe.dropTarget=void 0,this._basicEventHandler("drop",Qe),this.fire("drop:after",Qe)}_onContextMenu(f){const ze=this.findTarget(f),Ke=this.targets||[],Qe=this._basicEventHandler("contextmenu:before",{e:f,target:ze,subTargets:Ke});return this.stopContextMenu&&oe$1(f),this._basicEventHandler("contextmenu",Qe),!1}_onClick(f){const ze=f.detail;ze>3||ze<2||(this._cacheTransformEventData(f),ze==2&&f.type==="dblclick"&&this._handleEvent(f,"dblclick"),ze==3&&this._handleEvent(f,"tripleclick"),this._resetTransformEventData())}getPointerId(f){const ze=f.changedTouches;return ze?ze[0]&&ze[0].identifier:this.enablePointerEvents?f.pointerId:-1}_isMainEvent(f){return f.isPrimary===!0||f.isPrimary!==!1&&(f.type==="touchend"&&f.touches.length===0||!f.changedTouches||f.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(f){let ze=!this.allowTouchScrolling;const Ke=this._activeObject;this.mainTouchId===void 0&&(this.mainTouchId=this.getPointerId(f)),this.__onMouseDown(f),(this.isDrawingMode||Ke&&this._target===Ke)&&(ze=!0),ze&&f.preventDefault(),this._resetTransformEventData();const Qe=this.upperCanvasEl,Pi=this._getEventPrefix(),nn=Kt$1(Qe);yn(nn,"touchend",this._onTouchEnd,mn),ze&&yn(nn,"touchmove",this._onMouseMove,mn),_n(Qe,"".concat(Pi,"down"),this._onMouseDown)}_onMouseDown(f){this.__onMouseDown(f),this._resetTransformEventData();const ze=this.upperCanvasEl,Ke=this._getEventPrefix();_n(ze,"".concat(Ke,"move"),this._onMouseMove,mn);const Qe=Kt$1(ze);yn(Qe,"".concat(Ke,"up"),this._onMouseUp),yn(Qe,"".concat(Ke,"move"),this._onMouseMove,mn)}_onTouchEnd(f){if(f.touches.length>0)return;this.__onMouseUp(f),this._resetTransformEventData(),delete this.mainTouchId;const ze=this._getEventPrefix(),Ke=Kt$1(this.upperCanvasEl);_n(Ke,"touchend",this._onTouchEnd,mn),_n(Ke,"touchmove",this._onMouseMove,mn),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(()=>{yn(this.upperCanvasEl,"".concat(ze,"down"),this._onMouseDown),this._willAddMouseDown=0},400)}_onMouseUp(f){this.__onMouseUp(f),this._resetTransformEventData();const ze=this.upperCanvasEl,Ke=this._getEventPrefix();if(this._isMainEvent(f)){const Qe=Kt$1(this.upperCanvasEl);_n(Qe,"".concat(Ke,"up"),this._onMouseUp),_n(Qe,"".concat(Ke,"move"),this._onMouseMove,mn),yn(ze,"".concat(Ke,"move"),this._onMouseMove,mn)}}_onMouseMove(f){const ze=this.getActiveObject();!this.allowTouchScrolling&&(!ze||!ze.shouldStartDragging(f))&&f.preventDefault&&f.preventDefault(),this.__onMouseMove(f)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(f){const ze=this.getActiveObject();return!!ze!=!!f||ze&&f&&ze!==f}__onMouseUp(f){var ze;this._cacheTransformEventData(f),this._handleEvent(f,"up:before");const Ke=this._currentTransform,Qe=this._isClick,Pi=this._target,{button:nn}=f;if(nn)return(this.fireMiddleClick&&nn===1||this.fireRightClick&&nn===2)&&this._handleEvent(f,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(f);if(!this._isMainEvent(f))return;let ln,cn,hn=!1;if(Ke&&(this._finalizeCurrentTransform(f),hn=Ke.actionPerformed),!Qe){const un=Pi===this._activeObject;this.handleSelection(f),hn||(hn=this._shouldRender(Pi)||!un&&Pi===this._activeObject)}if(Pi){const un=Pi.findControl(this.getViewportPoint(f),ne$1(f)),{key:xs,control:zn}=un||{};if(cn=xs,Pi.selectable&&Pi!==this._activeObject&&Pi.activeOn==="up")this.setActiveObject(Pi,f),hn=!0;else if(zn){const Xn=zn.getMouseUpHandler(f,Pi,zn);Xn&&(ln=this.getScenePoint(f),Xn.call(zn,f,Ke,ln.x,ln.y))}Pi.isMoving=!1}if(Ke&&(Ke.target!==Pi||Ke.corner!==cn)){const un=Ke.target&&Ke.target.controls[Ke.corner],xs=un&&un.getMouseUpHandler(f,Ke.target,un);ln=ln||this.getScenePoint(f),xs&&xs.call(un,f,Ke,ln.x,ln.y)}this._setCursorFromEvent(f,Pi),this._handleEvent(f,"up"),this._groupSelector=null,this._currentTransform=null,Pi&&(Pi.__corner=void 0),hn?this.requestRenderAll():Qe||(ze=this._activeObject)!==null&&ze!==void 0&&ze.isEditing||this.renderTop()}_basicEventHandler(f,ze){const{target:Ke,subTargets:Qe=[]}=ze;this.fire(f,ze),Ke&&Ke.fire(f,ze);for(let Pi=0;Pi<Qe.length;Pi++)Qe[Pi]!==Ke&&Qe[Pi].fire(f,ze);return ze}_handleEvent(f,ze,Ke){const Qe=this._target,Pi=this.targets||[],nn=s(s(s({e:f,target:Qe,subTargets:Pi},vn(this,f)),{},{transform:this._currentTransform},ze==="up:before"||ze==="up"?{isClick:this._isClick,currentTarget:this.findTarget(f),currentSubTargets:this.targets}:{}),ze==="down:before"||ze==="down"?Ke:{});this.fire("mouse:".concat(ze),nn),Qe&&Qe.fire("mouse".concat(ze),nn);for(let ln=0;ln<Pi.length;ln++)Pi[ln]!==Qe&&Pi[ln].fire("mouse".concat(ze),nn)}_onMouseDownInDrawingMode(f){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(f),this.requestRenderAll());const ze=this.getScenePoint(f);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(ze,{e:f,pointer:ze}),this._handleEvent(f,"down",{alreadySelected:!1})}_onMouseMoveInDrawingMode(f){if(this._isCurrentlyDrawing){const ze=this.getScenePoint(f);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(ze,{e:f,pointer:ze})}this.setCursor(this.freeDrawingCursor),this._handleEvent(f,"move")}_onMouseUpInDrawingMode(f){const ze=this.getScenePoint(f);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:f,pointer:ze}):this._isCurrentlyDrawing=!1,this._handleEvent(f,"up")}__onMouseDown(f){this._isClick=!0,this._cacheTransformEventData(f),this._handleEvent(f,"down:before");let ze=this._target,Ke=!!ze&&ze===this._activeObject;const{button:Qe}=f;if(Qe)return(this.fireMiddleClick&&Qe===1||this.fireRightClick&&Qe===2)&&this._handleEvent(f,"down",{alreadySelected:Ke}),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(f);if(!this._isMainEvent(f)||this._currentTransform)return;let Pi=this._shouldRender(ze),nn=!1;if(this.handleMultiSelection(f,ze)?(ze=this._activeObject,nn=!0,Pi=!0):this._shouldClearSelection(f,ze)&&this.discardActiveObject(f),this.selection&&(!ze||!ze.selectable&&!ze.isEditing&&ze!==this._activeObject)){const ln=this.getScenePoint(f);this._groupSelector={x:ln.x,y:ln.y,deltaY:0,deltaX:0}}if(Ke=!!ze&&ze===this._activeObject,ze){ze.selectable&&ze.activeOn==="down"&&this.setActiveObject(ze,f);const ln=ze.findControl(this.getViewportPoint(f),ne$1(f));if(ze===this._activeObject&&(ln||!nn)){this._setupCurrentTransform(f,ze,Ke);const cn=ln?ln.control:void 0,hn=this.getScenePoint(f),un=cn&&cn.getMouseDownHandler(f,ze,cn);un&&un.call(cn,f,this._currentTransform,hn.x,hn.y)}}Pi&&(this._objectsToRender=void 0),this._handleEvent(f,"down",{alreadySelected:Ke}),Pi&&this.requestRenderAll()}_resetTransformEventData(){this._target=this._pointer=this._absolutePointer=void 0}_cacheTransformEventData(f){this._resetTransformEventData(),this._pointer=this.getViewportPoint(f),this._absolutePointer=pe$1(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(f)}__onMouseMove(f){if(this._isClick=!1,this._cacheTransformEventData(f),this._handleEvent(f,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(f);if(!this._isMainEvent(f))return;const ze=this._groupSelector;if(ze){const Ke=this.getScenePoint(f);ze.deltaX=Ke.x-ze.x,ze.deltaY=Ke.y-ze.y,this.renderTop()}else if(this._currentTransform)this._transformObject(f);else{const Ke=this.findTarget(f);this._setCursorFromEvent(f,Ke),this._fireOverOutEvents(f,Ke)}this.textEditingManager.onMouseMove(f),this._handleEvent(f,"move"),this._resetTransformEventData()}_fireOverOutEvents(f,ze){const Ke=this._hoveredTarget,Qe=this._hoveredTargets,Pi=this.targets,nn=Math.max(Qe.length,Pi.length);this.fireSyntheticInOutEvents("mouse",{e:f,target:ze,oldTarget:Ke,fireCanvas:!0});for(let ln=0;ln<nn;ln++)this.fireSyntheticInOutEvents("mouse",{e:f,target:Pi[ln],oldTarget:Qe[ln]});this._hoveredTarget=ze,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(f,ze){const Ke=this._draggedoverTarget,Qe=this._hoveredTargets,Pi=this.targets,nn=Math.max(Qe.length,Pi.length);this.fireSyntheticInOutEvents("drag",s(s({},ze),{},{target:f,oldTarget:Ke,fireCanvas:!0}));for(let ln=0;ln<nn;ln++)this.fireSyntheticInOutEvents("drag",s(s({},ze),{},{target:Pi[ln],oldTarget:Qe[ln]}));this._draggedoverTarget=f}fireSyntheticInOutEvents(f,ze){let{target:Ke,oldTarget:Qe,fireCanvas:Pi,e:nn}=ze,ln=i(ze,pn);const{targetIn:cn,targetOut:hn,canvasIn:un,canvasOut:xs}=xn[f],zn=Qe!==Ke;if(Qe&&zn){const Xn=s(s({},ln),{},{e:nn,target:Qe,nextTarget:Ke},vn(this,nn));Pi&&this.fire(xs,Xn),Qe.fire(hn,Xn)}if(Ke&&zn){const Xn=s(s({},ln),{},{e:nn,target:Ke,previousTarget:Qe},vn(this,nn));Pi&&this.fire(un,Xn),Ke.fire(cn,Xn)}}__onMouseWheel(f){this._cacheTransformEventData(f),this._handleEvent(f,"wheel"),this._resetTransformEventData()}_transformObject(f){const ze=this.getScenePoint(f),Ke=this._currentTransform,Qe=Ke.target,Pi=Qe.group?pe$1(ze,void 0,Qe.group.calcTransformMatrix()):ze;Ke.shiftKey=f.shiftKey,Ke.altKey=!!this.centeredKey&&f[this.centeredKey],this._performTransformAction(f,Ke,Pi),Ke.actionPerformed&&this.requestRenderAll()}_performTransformAction(f,ze,Ke){const{action:Qe,actionHandler:Pi,target:nn}=ze,ln=!!Pi&&Pi(f,ze,Ke.x,Ke.y);ln&&nn.setCoords(),Qe==="drag"&&ln&&(ze.target.isMoving=!0,this.setCursor(ze.target.moveCursor||this.moveCursor)),ze.actionPerformed=ze.actionPerformed||ln}_setCursorFromEvent(f,ze){if(!ze)return void this.setCursor(this.defaultCursor);let Ke=ze.hoverCursor||this.hoverCursor;const Qe=Ut$1(this._activeObject)?this._activeObject:null,Pi=(!Qe||ze.group!==Qe)&&ze.findControl(this.getViewportPoint(f));if(Pi){const nn=Pi.control;this.setCursor(nn.cursorStyleHandler(f,nn,ze))}else ze.subTargetCheck&&this.targets.concat().reverse().map(nn=>{Ke=nn.hoverCursor||Ke}),this.setCursor(Ke)}handleMultiSelection(f,ze){const Ke=this._activeObject,Qe=Ut$1(Ke);if(Ke&&this._isSelectionKeyPressed(f)&&this.selection&&ze&&ze.selectable&&(Ke!==ze||Qe)&&(Qe||!ze.isDescendantOf(Ke)&&!Ke.isDescendantOf(ze))&&!ze.onSelect({e:f})&&!Ke.getActiveControl()){if(Qe){const Pi=Ke.getObjects();if(ze===Ke){const nn=this.getViewportPoint(f);if(!(ze=this.searchPossibleTargets(Pi,nn)||this.searchPossibleTargets(this._objects,nn))||!ze.selectable)return!1}ze.group===Ke?(Ke.remove(ze),this._hoveredTarget=ze,this._hoveredTargets=[...this.targets],Ke.size()===1&&this._setActiveObject(Ke.item(0),f)):(Ke.multiSelectAdd(ze),this._hoveredTarget=Ke,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(Pi,f)}else{Ke.isEditing&&Ke.exitEditing();const Pi=new(tt.getClass("ActiveSelection"))([],{canvas:this});Pi.multiSelectAdd(Ke,ze),this._hoveredTarget=Pi,this._setActiveObject(Pi,f),this._fireSelectionEvents([Ke],f)}return!0}return!1}handleSelection(f){if(!this.selection||!this._groupSelector)return!1;const{x:ze,y:Ke,deltaX:Qe,deltaY:Pi}=this._groupSelector,nn=new ot$1(ze,Ke),ln=nn.add(new ot$1(Qe,Pi)),cn=nn.min(ln),hn=nn.max(ln).subtract(cn),un=this.collectObjects({left:cn.x,top:cn.y,width:hn.x,height:hn.y},{includeIntersecting:!this.selectionFullyContained}),xs=nn.eq(ln)?un[0]?[un[0]]:[]:un.length>1?un.filter(zn=>!zn.onSelect({e:f})).reverse():un;if(xs.length===1)this.setActiveObject(xs[0],f);else if(xs.length>1){const zn=tt.getClass("ActiveSelection");this.setActiveObject(new zn(xs,{canvas:this}),f)}return this._groupSelector=null,!0}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}const bn={x1:0,y1:0,x2:0,y2:0},wn=s(s({},bn),{},{r1:0,r2:0}),Sn=(qe,f)=>isNaN(qe)&&typeof f=="number"?f:qe,Tn=/^(\d+\.\d+)%|(\d+)%$/;function On(qe){return qe&&Tn.test(qe)}function kn(qe,f){const ze=typeof qe=="number"?qe:typeof qe=="string"?parseFloat(qe)/(On(qe)?100:1):NaN;return gs(0,Sn(ze,f),1)}const Dn=/\s*;\s*/,Mn=/\s*:\s*/;function Pn(qe,f){let ze,Ke;const Qe=qe.getAttribute("style");if(Qe){const nn=Qe.split(Dn);nn[nn.length-1]===""&&nn.pop();for(let ln=nn.length;ln--;){const[cn,hn]=nn[ln].split(Mn).map(un=>un.trim());cn==="stop-color"?ze=hn:cn==="stop-opacity"&&(Ke=hn)}}const Pi=new Le$1(ze||qe.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:kn(qe.getAttribute("offset"),0),color:Pi.toRgb(),opacity:Sn(parseFloat(Ke||qe.getAttribute("stop-opacity")||""),1)*Pi.getAlpha()*f}}function En(qe,f){const ze=[],Ke=qe.getElementsByTagName("stop"),Qe=kn(f,1);for(let Pi=Ke.length;Pi--;)ze.push(Pn(Ke[Pi],Qe));return ze}function An(qe){return qe.nodeName==="linearGradient"||qe.nodeName==="LINEARGRADIENT"?"linear":"radial"}function jn(qe){return qe.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage"}function Fn(qe,f){return qe.getAttribute(f)}function Ln(qe,f){return function(ze,Ke){let Qe,{width:Pi,height:nn,gradientUnits:ln}=Ke;return Object.keys(ze).reduce((cn,hn)=>{const un=ze[hn];return un==="Infinity"?Qe=1:un==="-Infinity"?Qe=0:(Qe=typeof un=="string"?parseFloat(un):un,typeof un=="string"&&On(un)&&(Qe*=.01,ln==="pixels"&&(hn!=="x1"&&hn!=="x2"&&hn!=="r2"||(Qe*=Pi),hn!=="y1"&&hn!=="y2"||(Qe*=nn)))),cn[hn]=Qe,cn},{})}(An(qe)==="linear"?function(ze){return{x1:Fn(ze,"x1")||0,y1:Fn(ze,"y1")||0,x2:Fn(ze,"x2")||"100%",y2:Fn(ze,"y2")||0}}(qe):function(ze){return{x1:Fn(ze,"fx")||Fn(ze,"cx")||"50%",y1:Fn(ze,"fy")||Fn(ze,"cy")||"50%",r1:0,x2:Fn(ze,"cx")||"50%",y2:Fn(ze,"cy")||"50%",r2:Fn(ze,"r")||"50%"}}(qe),s(s({},f),{},{gradientUnits:jn(qe)}))}class Rn{constructor(f){const{type:ze="linear",gradientUnits:Ke="pixels",coords:Qe={},colorStops:Pi=[],offsetX:nn=0,offsetY:ln=0,gradientTransform:cn,id:hn}=f||{};Object.assign(this,{type:ze,gradientUnits:Ke,coords:s(s({},ze==="radial"?wn:bn),Qe),colorStops:Pi,offsetX:nn,offsetY:ln,gradientTransform:cn,id:hn?"".concat(hn,"_").concat(ft$1()):ft$1()})}addColorStop(f){for(const ze in f){const Ke=new Le$1(f[ze]);this.colorStops.push({offset:parseFloat(ze),color:Ke.toRgb(),opacity:Ke.getAlpha()})}return this}toObject(f){return s(s({},Yt$1(this,f)),{},{type:this.type,coords:s({},this.coords),colorStops:this.colorStops.map(ze=>s({},ze)),offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0})}toSVG(f){let{additionalTransform:ze}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const Ke=[],Qe=this.gradientTransform?this.gradientTransform.concat():T.concat(),Pi=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox",nn=this.colorStops.map(xs=>s({},xs)).sort((xs,zn)=>xs.offset-zn.offset);let ln=-this.offsetX,cn=-this.offsetY;var hn;Pi==="objectBoundingBox"?(ln/=f.width,cn/=f.height):(ln+=f.width/2,cn+=f.height/2),(hn=f)&&typeof hn._renderPathCommands=="function"&&this.gradientUnits!=="percentage"&&(ln-=f.pathOffset.x,cn-=f.pathOffset.y),Qe[4]-=ln,Qe[5]-=cn;const un=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(Pi,'"'),'gradientTransform="'.concat(ze?ze+" ":"").concat(zt$1(Qe),'"'),""].join(" ");if(this.type==="linear"){const{x1:xs,y1:zn,x2:Xn,y2:ys}=this.coords;Ke.push("<linearGradient ",un,' x1="',xs,'" y1="',zn,'" x2="',Xn,'" y2="',ys,`">
`)}else if(this.type==="radial"){const{x1:xs,y1:zn,x2:Xn,y2:ys,r1:Jo,r2:ea}=this.coords,ra=Jo>ea;Ke.push("<radialGradient ",un,' cx="',ra?xs:Xn,'" cy="',ra?zn:ys,'" r="',ra?Jo:ea,'" fx="',ra?Xn:xs,'" fy="',ra?ys:zn,`">
`),ra&&(nn.reverse(),nn.forEach(ta=>{ta.offset=1-ta.offset}));const na=Math.min(Jo,ea);if(na>0){const ta=na/Math.max(Jo,ea);nn.forEach(ia=>{ia.offset+=ta*(1-ia.offset)})}}return nn.forEach(xs=>{let{color:zn,offset:Xn,opacity:ys}=xs;Ke.push("<stop ",'offset="',100*Xn+"%",'" style="stop-color:',zn,ys!==void 0?";stop-opacity: "+ys:";",`"/>
`)}),Ke.push(this.type==="linear"?"</linearGradient>":"</radialGradient>",`
`),Ke.join("")}toLive(f){const{x1:ze,y1:Ke,x2:Qe,y2:Pi,r1:nn,r2:ln}=this.coords,cn=this.type==="linear"?f.createLinearGradient(ze,Ke,Qe,Pi):f.createRadialGradient(ze,Ke,nn,Qe,Pi,ln);return this.colorStops.forEach(hn=>{let{color:un,opacity:xs,offset:zn}=hn;cn.addColorStop(zn,xs!==void 0?new Le$1(un).setAlpha(xs).toRgba():un)}),cn}static async fromObject(f){const{colorStops:ze,gradientTransform:Ke}=f;return new this(s(s({},f),{},{colorStops:ze?ze.map(Qe=>s({},Qe)):void 0,gradientTransform:Ke?[...Ke]:void 0}))}static fromElement(f,ze,Ke){const Qe=jn(f),Pi=ze._findCenterFromElement();return new this(s({id:f.getAttribute("id")||void 0,type:An(f),coords:Ln(f,{width:Ke.viewBoxWidth||Ke.width,height:Ke.viewBoxHeight||Ke.height}),colorStops:En(f,Ke.opacity),gradientUnits:Qe,gradientTransform:or(f.getAttribute("gradientTransform")||"")},Qe==="pixels"?{offsetX:ze.width/2-Pi.x,offsetY:ze.height/2-Pi.y}:{offsetX:0,offsetY:0}))}}t(Rn,"type","Gradient"),tt.setClass(Rn,"gradient"),tt.setClass(Rn,"linear"),tt.setClass(Rn,"radial");const In=["type","source","patternTransform"];class Bn{get type(){return"pattern"}set type(f){a("warn","Setting type has no effect",f)}constructor(f){t(this,"repeat","repeat"),t(this,"offsetX",0),t(this,"offsetY",0),t(this,"crossOrigin",""),this.id=ft$1(),Object.assign(this,f)}isImageSource(){return!!this.source&&typeof this.source.src=="string"}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(f){return this.source&&(!this.isImageSource()||this.source.complete&&this.source.naturalWidth!==0&&this.source.naturalHeight!==0)?f.createPattern(this.source,this.repeat):null}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const{repeat:ze,crossOrigin:Ke}=this;return s(s({},Yt$1(this,f)),{},{type:"pattern",source:this.sourceToString(),repeat:ze,crossOrigin:Ke,offsetX:Vt$1(this.offsetX,o.NUM_FRACTION_DIGITS),offsetY:Vt$1(this.offsetY,o.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(f){let{width:ze,height:Ke}=f;const{source:Qe,repeat:Pi,id:nn}=this,ln=Sn(this.offsetX/ze,0),cn=Sn(this.offsetY/Ke,0),hn=Pi==="repeat-y"||Pi==="no-repeat"?1+Math.abs(ln||0):Sn(Qe.width/ze,0),un=Pi==="repeat-x"||Pi==="no-repeat"?1+Math.abs(cn||0):Sn(Qe.height/Ke,0);return['<pattern id="SVGID_'.concat(nn,'" x="').concat(ln,'" y="').concat(cn,'" width="').concat(hn,'" height="').concat(un,'">'),'<image x="0" y="0" width="'.concat(Qe.width,'" height="').concat(Qe.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join(`
`)}static async fromObject(f,ze){let{type:Ke,source:Qe,patternTransform:Pi}=f,nn=i(f,In);const ln=await It$1(Qe,s(s({},ze),{},{crossOrigin:nn.crossOrigin}));return new this(s(s({},nn),{},{patternTransform:Pi&&Pi.slice(0),source:ln}))}}t(Bn,"type","Pattern"),tt.setClass(Bn),tt.setClass(Bn,"pattern");const Yn=["path","left","top"],Wn=["d"];class Vn extends _i{constructor(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{path:Ke,left:Qe,top:Pi}=ze,nn=i(ze,Yn);super(),Object.assign(this,Vn.ownDefaults),this.setOptions(nn),this._setPath(f||[],!0),typeof Qe=="number"&&this.set(M$1,Qe),typeof Pi=="number"&&this.set(P,Pi)}_setPath(f,ze){this.path=Yr(Array.isArray(f)?f:rn(f)),this.setBoundingBox(ze)}_findCenterFromElement(){const f=this._calcBoundsFromPath();return new ot$1(f.left+f.width/2,f.top+f.height/2)}_renderPathCommands(f){const ze=-this.pathOffset.x,Ke=-this.pathOffset.y;f.beginPath();for(const Qe of this.path)switch(Qe[0]){case"L":f.lineTo(Qe[1]+ze,Qe[2]+Ke);break;case"M":f.moveTo(Qe[1]+ze,Qe[2]+Ke);break;case"C":f.bezierCurveTo(Qe[1]+ze,Qe[2]+Ke,Qe[3]+ze,Qe[4]+Ke,Qe[5]+ze,Qe[6]+Ke);break;case"Q":f.quadraticCurveTo(Qe[1]+ze,Qe[2]+Ke,Qe[3]+ze,Qe[4]+Ke);break;case"Z":f.closePath()}}_render(f){this._renderPathCommands(f),this._renderPaintInOrder(f)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return s(s({},super.toObject(f)),{},{path:this.path.map(ze=>ze.slice())})}toDatalessObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const ze=this.toObject(f);return this.sourcePath&&(delete ze.path,ze.sourcePath=this.sourcePath),ze}_toSVG(){const f=on(this.path,o.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(f,`" stroke-linecap="round" />
`)]}_getOffsetTransform(){const f=o.NUM_FRACTION_DIGITS;return" translate(".concat(Vt$1(-this.pathOffset.x,f),", ").concat(Vt$1(-this.pathOffset.y,f),")")}toClipPathSVG(f){const ze=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:f,additionalTransform:ze})}toSVG(f){const ze=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:f,additionalTransform:ze})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(f){const{width:ze,height:Ke,pathOffset:Qe}=this._calcDimensions();this.set({width:ze,height:Ke,pathOffset:Qe}),f&&this.setPositionByOrigin(Qe,D$1,D$1)}_calcBoundsFromPath(){const f=[];let ze=0,Ke=0,Qe=0,Pi=0;for(const nn of this.path)switch(nn[0]){case"L":Qe=nn[1],Pi=nn[2],f.push({x:ze,y:Ke},{x:Qe,y:Pi});break;case"M":Qe=nn[1],Pi=nn[2],ze=Qe,Ke=Pi;break;case"C":f.push(...Br(Qe,Pi,nn[1],nn[2],nn[3],nn[4],nn[5],nn[6])),Qe=nn[5],Pi=nn[6];break;case"Q":f.push(...Br(Qe,Pi,nn[1],nn[2],nn[1],nn[2],nn[3],nn[4])),Qe=nn[3],Pi=nn[4];break;case"Z":Qe=ze,Pi=Ke}return ae$1(f)}_calcDimensions(){const f=this._calcBoundsFromPath();return s(s({},f),{},{pathOffset:new ot$1(f.left+f.width/2,f.top+f.height/2)})}static fromObject(f){return this._fromObject(f,{extraParam:"path"})}static async fromElement(f,ze,Ke){const Qe=dr(f,this.ATTRIBUTE_NAMES,Ke),{d:Pi}=Qe;return new this(Pi,s(s(s({},i(Qe,Wn)),ze),{},{left:void 0,top:void 0}))}}t(Vn,"type","Path"),t(Vn,"cacheProperties",[...ps,"path","fillRule"]),t(Vn,"ATTRIBUTE_NAMES",[...Fi,"d"]),tt.setClass(Vn),tt.setSVGClass(Vn);const Gn=["left","top","radius"],Hn=["radius","startAngle","endAngle","counterClockwise"];class Nn extends _i{static getDefaults(){return s(s({},super.getDefaults()),Nn.ownDefaults)}constructor(f){super(),Object.assign(this,Nn.ownDefaults),this.setOptions(f)}_set(f,ze){return super._set(f,ze),f==="radius"&&this.setRadius(ze),this}_render(f){f.beginPath(),f.arc(0,0,this.radius,xt$1(this.startAngle),xt$1(this.endAngle),this.counterClockwise),this._renderPaintInOrder(f)}getRadiusX(){return this.get("radius")*this.get(H)}getRadiusY(){return this.get("radius")*this.get(N$1)}setRadius(f){this.radius=f,this.set({width:2*f,height:2*f})}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...Hn,...f])}_toSVG(){const f=(this.endAngle-this.startAngle)%360;if(f===0)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),`" />
`];{const{radius:ze}=this,Ke=xt$1(this.startAngle),Qe=xt$1(this.endAngle),Pi=rt$1(Ke)*ze,nn=nt$1(Ke)*ze,ln=rt$1(Qe)*ze,cn=nt$1(Qe)*ze,hn=f>180?1:0,un=this.counterClockwise?0:1;return['<path d="M '.concat(Pi," ").concat(nn," A ").concat(ze," ").concat(ze," 0 ").concat(hn," ").concat(un," ").concat(ln," ").concat(cn,'" '),"COMMON_PARTS",` />
`]}}static async fromElement(f,ze,Ke){const Qe=dr(f,this.ATTRIBUTE_NAMES,Ke),{left:Pi=0,top:nn=0,radius:ln=0}=Qe;return new this(s(s({},i(Qe,Gn)),{},{radius:ln,left:Pi-ln,top:nn-ln}))}static fromObject(f){return super._fromObject(f)}}t(Nn,"type","Circle"),t(Nn,"cacheProperties",[...ps,...Hn]),t(Nn,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),t(Nn,"ATTRIBUTE_NAMES",["cx","cy","r",...Fi]),tt.setClass(Nn),tt.setSVGClass(Nn);const Jn=["x1","y1","x2","y2"],Qn=["x1","y1","x2","y2"],Zn=["x1","x2","y1","y2"];class $n extends _i{constructor(){let[f,ze,Ke,Qe]=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0,0],Pi=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,$n.ownDefaults),this.setOptions(Pi),this.x1=f,this.x2=Ke,this.y1=ze,this.y2=Qe,this._setWidthHeight();const{left:nn,top:ln}=Pi;typeof nn=="number"&&this.set(M$1,nn),typeof ln=="number"&&this.set(P,ln)}_setWidthHeight(){const{x1:f,y1:ze,x2:Ke,y2:Qe}=this;this.width=Math.abs(Ke-f),this.height=Math.abs(Qe-ze);const{left:Pi,top:nn,width:ln,height:cn}=ae$1([{x:f,y:ze},{x:Ke,y:Qe}]),hn=new ot$1(Pi+ln/2,nn+cn/2);this.setPositionByOrigin(hn,D$1,D$1)}_set(f,ze){return super._set(f,ze),Zn.includes(f)&&this._setWidthHeight(),this}_render(f){f.beginPath();const ze=this.calcLinePoints();f.moveTo(ze.x1,ze.y1),f.lineTo(ze.x2,ze.y2),f.lineWidth=this.strokeWidth;const Ke=f.strokeStyle;var Qe;Gt$1(this.stroke)?f.strokeStyle=this.stroke.toLive(f):f.strokeStyle=(Qe=this.stroke)!==null&&Qe!==void 0?Qe:f.fillStyle,this.stroke&&this._renderStroke(f),f.strokeStyle=Ke}_findCenterFromElement(){return new ot$1((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return s(s({},super.toObject(f)),this.calcLinePoints())}_getNonTransformedDimensions(){const f=super._getNonTransformedDimensions();return this.strokeLineCap==="butt"&&(this.width===0&&(f.y-=this.strokeWidth),this.height===0&&(f.x-=this.strokeWidth)),f}calcLinePoints(){const{x1:f,x2:ze,y1:Ke,y2:Qe,width:Pi,height:nn}=this,ln=f<=ze?-1:1,cn=Ke<=Qe?-1:1;return{x1:ln*Pi/2,x2:ln*-Pi/2,y1:cn*nn/2,y2:cn*-nn/2}}_toSVG(){const{x1:f,x2:ze,y1:Ke,y2:Qe}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(f,'" y1="').concat(Ke,'" x2="').concat(ze,'" y2="').concat(Qe,`" />
`)]}static async fromElement(f,ze,Ke){const Qe=dr(f,this.ATTRIBUTE_NAMES,Ke),{x1:Pi=0,y1:nn=0,x2:ln=0,y2:cn=0}=Qe;return new this([Pi,nn,ln,cn],i(Qe,Jn))}static fromObject(f){let{x1:ze,y1:Ke,x2:Qe,y2:Pi}=f,nn=i(f,Qn);return this._fromObject(s(s({},nn),{},{points:[ze,Ke,Qe,Pi]}),{extraParam:"points"})}}t($n,"type","Line"),t($n,"cacheProperties",[...ps,...Zn]),t($n,"ATTRIBUTE_NAMES",Fi.concat(Zn)),tt.setClass($n),tt.setSVGClass($n);class to extends _i{static getDefaults(){return s(s({},super.getDefaults()),to.ownDefaults)}constructor(f){super(),Object.assign(this,to.ownDefaults),this.setOptions(f)}_render(f){const ze=this.width/2,Ke=this.height/2;f.beginPath(),f.moveTo(-ze,Ke),f.lineTo(0,-Ke),f.lineTo(ze,Ke),f.closePath(),this._renderPaintInOrder(f)}_toSVG(){const f=this.width/2,ze=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-f," ").concat(ze,",0 ").concat(-ze,",").concat(f," ").concat(ze),'" />']}}t(to,"type","Triangle"),t(to,"ownDefaults",{width:100,height:100}),tt.setClass(to),tt.setSVGClass(to);const eo=["rx","ry"];class so extends _i{static getDefaults(){return s(s({},super.getDefaults()),so.ownDefaults)}constructor(f){super(),Object.assign(this,so.ownDefaults),this.setOptions(f)}_set(f,ze){switch(super._set(f,ze),f){case"rx":this.rx=ze,this.set("width",2*ze);break;case"ry":this.ry=ze,this.set("height",2*ze)}return this}getRx(){return this.get("rx")*this.get(H)}getRy(){return this.get("ry")*this.get(N$1)}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...eo,...f])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,`" />
`)]}_render(f){f.beginPath(),f.save(),f.transform(1,0,0,this.ry/this.rx,0,0),f.arc(0,0,this.rx,0,w$1,!1),f.restore(),this._renderPaintInOrder(f)}static async fromElement(f,ze,Ke){const Qe=dr(f,this.ATTRIBUTE_NAMES,Ke);return Qe.left=(Qe.left||0)-Qe.rx,Qe.top=(Qe.top||0)-Qe.ry,new this(Qe)}}function io(qe){if(!qe)return[];const f=qe.replace(/,/g," ").trim().split(/\s+/),ze=[];for(let Ke=0;Ke<f.length;Ke+=2)ze.push({x:parseFloat(f[Ke]),y:parseFloat(f[Ke+1])});return ze}t(so,"type","Ellipse"),t(so,"cacheProperties",[...ps,...eo]),t(so,"ownDefaults",{rx:0,ry:0}),t(so,"ATTRIBUTE_NAMES",[...Fi,"cx","cy","rx","ry"]),tt.setClass(so),tt.setSVGClass(so);const ro=["left","top"],no={exactBoundingBox:!1};class oo extends _i{static getDefaults(){return s(s({},super.getDefaults()),oo.ownDefaults)}constructor(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),t(this,"strokeDiff",void 0),Object.assign(this,oo.ownDefaults),this.setOptions(ze),this.points=f;const{left:Ke,top:Qe}=ze;this.initialized=!0,this.setBoundingBox(!0),typeof Ke=="number"&&this.set(M$1,Ke),typeof Qe=="number"&&this.set(P,Qe)}isOpen(){return!0}_projectStrokeOnPoints(f){return Ti(this.points,f,this.isOpen())}_calcDimensions(f){f=s({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},f||{});const ze=this.exactBoundingBox?this._projectStrokeOnPoints(f).map(hn=>hn.projectedPoint):this.points;if(ze.length===0)return{left:0,top:0,width:0,height:0,pathOffset:new ot$1,strokeOffset:new ot$1,strokeDiff:new ot$1};const Ke=ae$1(ze),Qe=Lt$1(s(s({},f),{},{scaleX:1,scaleY:1})),Pi=ae$1(this.points.map(hn=>wt$1(hn,Qe,!0))),nn=new ot$1(this.scaleX,this.scaleY);let ln=Ke.left+Ke.width/2,cn=Ke.top+Ke.height/2;return this.exactBoundingBox&&(ln-=cn*Math.tan(xt$1(this.skewX)),cn-=ln*Math.tan(xt$1(this.skewY))),s(s({},Ke),{},{pathOffset:new ot$1(ln,cn),strokeOffset:new ot$1(Pi.left,Pi.top).subtract(new ot$1(Ke.left,Ke.top)).multiply(nn),strokeDiff:new ot$1(Ke.width,Ke.height).subtract(new ot$1(Pi.width,Pi.height)).multiply(nn)})}_findCenterFromElement(){const f=ae$1(this.points);return new ot$1(f.left+f.width/2,f.top+f.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(f){const{left:ze,top:Ke,width:Qe,height:Pi,pathOffset:nn,strokeOffset:ln,strokeDiff:cn}=this._calcDimensions();this.set({width:Qe,height:Pi,pathOffset:nn,strokeOffset:ln,strokeDiff:cn}),f&&this.setPositionByOrigin(new ot$1(ze+Qe/2,Ke+Pi/2),D$1,D$1)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new ot$1(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.exactBoundingBox){let nn;if(Object.keys(f).some(ln=>this.strokeUniform||this.constructor.layoutProperties.includes(ln))){var ze,Ke;const{width:ln,height:cn}=this._calcDimensions(f);nn=new ot$1((ze=f.width)!==null&&ze!==void 0?ze:ln,(Ke=f.height)!==null&&Ke!==void 0?Ke:cn)}else{var Qe,Pi;nn=new ot$1((Qe=f.width)!==null&&Qe!==void 0?Qe:this.width,(Pi=f.height)!==null&&Pi!==void 0?Pi:this.height)}return nn.multiply(new ot$1(f.scaleX||this.scaleX,f.scaleY||this.scaleY))}return super._getTransformedDimensions(f)}_set(f,ze){const Ke=this.initialized&&this[f]!==ze,Qe=super._set(f,ze);return this.exactBoundingBox&&Ke&&((f===H||f===N$1)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(f))&&this.setDimensions(),Qe}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return s(s({},super.toObject(f)),{},{points:this.points.map(ze=>{let{x:Ke,y:Qe}=ze;return{x:Ke,y:Qe}})})}_toSVG(){const f=[],ze=this.pathOffset.x,Ke=this.pathOffset.y,Qe=o.NUM_FRACTION_DIGITS;for(let Pi=0,nn=this.points.length;Pi<nn;Pi++)f.push(Vt$1(this.points[Pi].x-ze,Qe),",",Vt$1(this.points[Pi].y-Ke,Qe)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(f.join(""),`" />
`)]}_render(f){const ze=this.points.length,Ke=this.pathOffset.x,Qe=this.pathOffset.y;if(ze&&!isNaN(this.points[ze-1].y)){f.beginPath(),f.moveTo(this.points[0].x-Ke,this.points[0].y-Qe);for(let Pi=0;Pi<ze;Pi++){const nn=this.points[Pi];f.lineTo(nn.x-Ke,nn.y-Qe)}!this.isOpen()&&f.closePath(),this._renderPaintInOrder(f)}}complexity(){return this.points.length}static async fromElement(f,ze,Ke){return new this(io(f.getAttribute("points")),s(s({},i(dr(f,this.ATTRIBUTE_NAMES,Ke),ro)),ze))}static fromObject(f){return this._fromObject(f,{extraParam:"points"})}}t(oo,"ownDefaults",no),t(oo,"type","Polyline"),t(oo,"layoutProperties",[U,q,"strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),t(oo,"cacheProperties",[...ps,"points"]),t(oo,"ATTRIBUTE_NAMES",[...Fi]),tt.setClass(oo),tt.setSVGClass(oo);class ao extends oo{isOpen(){return!1}}t(ao,"ownDefaults",no),t(ao,"type","Polygon"),tt.setClass(ao),tt.setSVGClass(ao);const ho=["fontSize","fontWeight","fontFamily","fontStyle"],co=["underline","overline","linethrough"],lo=[...ho,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],uo=[...lo,...co,"textBackgroundColor","direction"],go=[...ho,...co,J,"strokeWidth",K$1,"deltaY","textBackgroundColor"],fo={_reNewline:F$1,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:M$1,fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:M$1,pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2},po="justify",mo="justify-left",vo="justify-right",yo="justify-center";class _o extends _i{isEmptyStyles(f){if(!this.styles||f!==void 0&&!this.styles[f])return!0;const ze=f===void 0?this.styles:{line:this.styles[f]};for(const Ke in ze)for(const Qe in ze[Ke])for(const Pi in ze[Ke][Qe])return!1;return!0}styleHas(f,ze){if(!this.styles||ze!==void 0&&!this.styles[ze])return!1;const Ke=ze===void 0?this.styles:{0:this.styles[ze]};for(const Qe in Ke)for(const Pi in Ke[Qe])if(Ke[Qe][Pi][f]!==void 0)return!0;return!1}cleanStyle(f){if(!this.styles)return!1;const ze=this.styles;let Ke,Qe,Pi=0,nn=!0,ln=0;for(const cn in ze){Ke=0;for(const hn in ze[cn]){const un=ze[cn][hn]||{};Pi++,un[f]!==void 0?(Qe?un[f]!==Qe&&(nn=!1):Qe=un[f],un[f]===this[f]&&delete un[f]):nn=!1,Object.keys(un).length!==0?Ke++:delete ze[cn][hn]}Ke===0&&delete ze[cn]}for(let cn=0;cn<this._textLines.length;cn++)ln+=this._textLines[cn].length;nn&&Pi===ln&&(this[f]=Qe,this.removeStyle(f))}removeStyle(f){if(!this.styles)return;const ze=this.styles;let Ke,Qe,Pi;for(Qe in ze){for(Pi in Ke=ze[Qe],Ke)delete Ke[Pi][f],Object.keys(Ke[Pi]).length===0&&delete Ke[Pi];Object.keys(Ke).length===0&&delete ze[Qe]}}_extendStyles(f,ze){const{lineIndex:Ke,charIndex:Qe}=this.get2DCursorLocation(f);this._getLineStyle(Ke)||this._setLineStyle(Ke);const Pi=Wt$1(s(s({},this._getStyleDeclaration(Ke,Qe)),ze),nn=>nn!==void 0);this._setStyleDeclaration(Ke,Qe,Pi)}getSelectionStyles(f,ze,Ke){const Qe=[];for(let Pi=f;Pi<(ze||f);Pi++)Qe.push(this.getStyleAtPosition(Pi,Ke));return Qe}getStyleAtPosition(f,ze){const{lineIndex:Ke,charIndex:Qe}=this.get2DCursorLocation(f);return ze?this.getCompleteStyleDeclaration(Ke,Qe):this._getStyleDeclaration(Ke,Qe)}setSelectionStyles(f,ze,Ke){for(let Qe=ze;Qe<(Ke||ze);Qe++)this._extendStyles(Qe,f);this._forceClearCache=!0}_getStyleDeclaration(f,ze){var Ke;const Qe=this.styles&&this.styles[f];return Qe&&(Ke=Qe[ze])!==null&&Ke!==void 0?Ke:{}}getCompleteStyleDeclaration(f,ze){return s(s({},Yt$1(this,this.constructor._styleProperties)),this._getStyleDeclaration(f,ze))}_setStyleDeclaration(f,ze,Ke){this.styles[f][ze]=Ke}_deleteStyleDeclaration(f,ze){delete this.styles[f][ze]}_getLineStyle(f){return!!this.styles[f]}_setLineStyle(f){this.styles[f]={}}_deleteLineStyle(f){delete this.styles[f]}}t(_o,"_styleProperties",go);const xo=/  +/g,Co=/"/g;function bo(qe,f,ze,Ke,Qe){return"		".concat(function(Pi,nn){let{left:ln,top:cn,width:hn,height:un}=nn,xs=arguments.length>2&&arguments[2]!==void 0?arguments[2]:o.NUM_FRACTION_DIGITS;const zn=Be$1(K$1,Pi,!1),[Xn,ys,Jo,ea]=[ln,cn,hn,un].map(ra=>Vt$1(ra,xs));return"<rect ".concat(zn,' x="').concat(Xn,'" y="').concat(ys,'" width="').concat(Jo,'" height="').concat(ea,'"></rect>')}(qe,{left:f,top:ze,width:Ke,height:Qe}),`
`)}const wo=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];let So;class To extends _o{static getDefaults(){return s(s({},super.getDefaults()),To.ownDefaults)}constructor(f,ze){super(),t(this,"__charBounds",[]),Object.assign(this,To.ownDefaults),this.setOptions(ze),this.styles||(this.styles={}),this.text=f,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){const f=this.path;f&&(f.segmentsInfo=Qr(f.path))}_splitText(){const f=this._splitTextIntoLines(this.text);return this.textLines=f.lines,this._textLines=f.graphemeLines,this._unwrappedTextLines=f._unwrappedLines,this._text=f.graphemeText,f}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(po)&&this.enlargeSpaces()}enlargeSpaces(){let f,ze,Ke,Qe,Pi,nn,ln;for(let cn=0,hn=this._textLines.length;cn<hn;cn++)if((this.textAlign===po||cn!==hn-1&&!this.isEndOfWrapping(cn))&&(Qe=0,Pi=this._textLines[cn],ze=this.getLineWidth(cn),ze<this.width&&(ln=this.textLines[cn].match(this._reSpacesAndTabs)))){Ke=ln.length,f=(this.width-ze)/Ke;for(let un=0;un<=Pi.length;un++)nn=this.__charBounds[cn][un],this._reSpaceAndTab.test(Pi[un])?(nn.width+=f,nn.kernedWidth+=f,nn.left+=Qe,Qe+=f):nn.left+=Qe}}isEndOfWrapping(f){return f===this._textLines.length-1}missingNewlineOffset(f){return 1}get2DCursorLocation(f,ze){const Ke=ze?this._unwrappedTextLines:this._textLines;let Qe;for(Qe=0;Qe<Ke.length;Qe++){if(f<=Ke[Qe].length)return{lineIndex:Qe,charIndex:f};f-=Ke[Qe].length+this.missingNewlineOffset(Qe,ze)}return{lineIndex:Qe-1,charIndex:Ke[Qe-1].length<f?Ke[Qe-1].length:f}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){const f=super._getCacheCanvasDimensions(),ze=this.fontSize;return f.width+=ze*f.zoomX,f.height+=ze*f.zoomY,f}_render(f){const ze=this.path;ze&&!ze.isNotVisible()&&ze._render(f),this._setTextStyles(f),this._renderTextLinesBackground(f),this._renderTextDecoration(f,"underline"),this._renderText(f),this._renderTextDecoration(f,"overline"),this._renderTextDecoration(f,"linethrough")}_renderText(f){this.paintFirst===J?(this._renderTextStroke(f),this._renderTextFill(f)):(this._renderTextFill(f),this._renderTextStroke(f))}_setTextStyles(f,ze,Ke){if(f.textBaseline="alphabetic",this.path)switch(this.pathAlign){case D$1:f.textBaseline="middle";break;case"ascender":f.textBaseline=P;break;case"descender":f.textBaseline=E$1}f.font=this._getFontDeclaration(ze,Ke)}calcTextWidth(){let f=this.getLineWidth(0);for(let ze=1,Ke=this._textLines.length;ze<Ke;ze++){const Qe=this.getLineWidth(ze);Qe>f&&(f=Qe)}return f}_renderTextLine(f,ze,Ke,Qe,Pi,nn){this._renderChars(f,ze,Ke,Qe,Pi,nn)}_renderTextLinesBackground(f){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;const ze=f.fillStyle,Ke=this._getLeftOffset();let Qe=this._getTopOffset();for(let Pi=0,nn=this._textLines.length;Pi<nn;Pi++){const ln=this.getHeightOfLine(Pi);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",Pi)){Qe+=ln;continue}const cn=this._textLines[Pi].length,hn=this._getLineLeftOffset(Pi);let un,xs,zn=0,Xn=0,ys=this.getValueOfPropertyAt(Pi,0,"textBackgroundColor");for(let Jo=0;Jo<cn;Jo++){const ea=this.__charBounds[Pi][Jo];xs=this.getValueOfPropertyAt(Pi,Jo,"textBackgroundColor"),this.path?(f.save(),f.translate(ea.renderLeft,ea.renderTop),f.rotate(ea.angle),f.fillStyle=xs,xs&&f.fillRect(-ea.width/2,-ln/this.lineHeight*(1-this._fontSizeFraction),ea.width,ln/this.lineHeight),f.restore()):xs!==ys?(un=Ke+hn+Xn,this.direction==="rtl"&&(un=this.width-un-zn),f.fillStyle=ys,ys&&f.fillRect(un,Qe,zn,ln/this.lineHeight),Xn=ea.left,zn=ea.width,ys=xs):zn+=ea.kernedWidth}xs&&!this.path&&(un=Ke+hn+Xn,this.direction==="rtl"&&(un=this.width-un-zn),f.fillStyle=xs,f.fillRect(un,Qe,zn,ln/this.lineHeight)),Qe+=ln}f.fillStyle=ze,this._removeShadow(f)}_measureChar(f,ze,Ke,Qe){const Pi=_.getFontCache(ze),nn=this._getFontDeclaration(ze),ln=Ke+f,cn=Ke&&nn===this._getFontDeclaration(Qe),hn=ze.fontSize/this.CACHE_FONT_SIZE;let un,xs,zn,Xn;if(Ke&&Pi[Ke]!==void 0&&(zn=Pi[Ke]),Pi[f]!==void 0&&(Xn=un=Pi[f]),cn&&Pi[ln]!==void 0&&(xs=Pi[ln],Xn=xs-zn),un===void 0||zn===void 0||xs===void 0){const ys=function(){return So||(So=vt$1({width:0,height:0}).getContext("2d")),So}();this._setTextStyles(ys,ze,!0),un===void 0&&(Xn=un=ys.measureText(f).width,Pi[f]=un),zn===void 0&&cn&&Ke&&(zn=ys.measureText(Ke).width,Pi[Ke]=zn),cn&&xs===void 0&&(xs=ys.measureText(ln).width,Pi[ln]=xs,Xn=xs-zn)}return{width:un*hn,kernedWidth:Xn*hn}}getHeightOfChar(f,ze){return this.getValueOfPropertyAt(f,ze,"fontSize")}measureLine(f){const ze=this._measureLine(f);return this.charSpacing!==0&&(ze.width-=this._getWidthOfCharSpacing()),ze.width<0&&(ze.width=0),ze}_measureLine(f){let ze,Ke,Qe=0;const Pi=this.pathSide===A,nn=this.path,ln=this._textLines[f],cn=ln.length,hn=new Array(cn);this.__charBounds[f]=hn;for(let un=0;un<cn;un++){const xs=ln[un];Ke=this._getGraphemeBox(xs,f,un,ze),hn[un]=Ke,Qe+=Ke.kernedWidth,ze=xs}if(hn[cn]={left:Ke?Ke.left+Ke.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},nn&&nn.segmentsInfo){let un=0;const xs=nn.segmentsInfo[nn.segmentsInfo.length-1].length;switch(this.textAlign){case M$1:un=Pi?xs-Qe:0;break;case D$1:un=(xs-Qe)/2;break;case A:un=Pi?0:xs-Qe}un+=this.pathStartOffset*(Pi?-1:1);for(let zn=Pi?cn-1:0;Pi?zn>=0:zn<cn;Pi?zn--:zn++)Ke=hn[zn],un>xs?un%=xs:un<0&&(un+=xs),this._setGraphemeOnPath(un,Ke),un+=Ke.kernedWidth}return{width:Qe,numOfSpaces:0}}_setGraphemeOnPath(f,ze){const Ke=f+ze.kernedWidth/2,Qe=this.path,Pi=Zr(Qe.path,Ke,Qe.segmentsInfo);ze.renderLeft=Pi.x-Qe.pathOffset.x,ze.renderTop=Pi.y-Qe.pathOffset.y,ze.angle=Pi.angle+(this.pathSide===A?Math.PI:0)}_getGraphemeBox(f,ze,Ke,Qe,Pi){const nn=this.getCompleteStyleDeclaration(ze,Ke),ln=Qe?this.getCompleteStyleDeclaration(ze,Ke-1):{},cn=this._measureChar(f,nn,Qe,ln);let hn,un=cn.kernedWidth,xs=cn.width;this.charSpacing!==0&&(hn=this._getWidthOfCharSpacing(),xs+=hn,un+=hn);const zn={width:xs,left:0,height:nn.fontSize,kernedWidth:un,deltaY:nn.deltaY};if(Ke>0&&!Pi){const Xn=this.__charBounds[ze][Ke-1];zn.left=Xn.left+Xn.width+cn.kernedWidth-cn.width}return zn}getHeightOfLine(f){if(this.__lineHeights[f])return this.__lineHeights[f];let ze=this.getHeightOfChar(f,0);for(let Ke=1,Qe=this._textLines[f].length;Ke<Qe;Ke++)ze=Math.max(this.getHeightOfChar(f,Ke),ze);return this.__lineHeights[f]=ze*this.lineHeight*this._fontSizeMult}calcTextHeight(){let f,ze=0;for(let Ke=0,Qe=this._textLines.length;Ke<Qe;Ke++)f=this.getHeightOfLine(Ke),ze+=Ke===Qe-1?f/this.lineHeight:f;return ze}_getLeftOffset(){return this.direction==="ltr"?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(f,ze){f.save();let Ke=0;const Qe=this._getLeftOffset(),Pi=this._getTopOffset();for(let nn=0,ln=this._textLines.length;nn<ln;nn++){const cn=this.getHeightOfLine(nn),hn=cn/this.lineHeight,un=this._getLineLeftOffset(nn);this._renderTextLine(ze,f,this._textLines[nn],Qe+un,Pi+Ke+hn,nn),Ke+=cn}f.restore()}_renderTextFill(f){(this.fill||this.styleHas(K$1))&&this._renderTextCommon(f,"fillText")}_renderTextStroke(f){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(f),f.save(),this._setLineDash(f,this.strokeDashArray),f.beginPath(),this._renderTextCommon(f,"strokeText"),f.closePath(),f.restore())}_renderChars(f,ze,Ke,Qe,Pi,nn){const ln=this.getHeightOfLine(nn),cn=this.textAlign.includes(po),hn=this.path,un=!cn&&this.charSpacing===0&&this.isEmptyStyles(nn)&&!hn,xs=this.direction==="ltr",zn=this.direction==="ltr"?1:-1,Xn=ze.direction;let ys,Jo,ea,ra,na,ta="",ia=0;if(ze.save(),Xn!==this.direction&&(ze.canvas.setAttribute("dir",xs?"ltr":"rtl"),ze.direction=xs?"ltr":"rtl",ze.textAlign=xs?M$1:A),Pi-=ln*this._fontSizeFraction/this.lineHeight,un)return this._renderChar(f,ze,nn,0,Ke.join(""),Qe,Pi),void ze.restore();for(let sa=0,Ma=Ke.length-1;sa<=Ma;sa++)ra=sa===Ma||this.charSpacing||hn,ta+=Ke[sa],ea=this.__charBounds[nn][sa],ia===0?(Qe+=zn*(ea.kernedWidth-ea.width),ia+=ea.width):ia+=ea.kernedWidth,cn&&!ra&&this._reSpaceAndTab.test(Ke[sa])&&(ra=!0),ra||(ys=ys||this.getCompleteStyleDeclaration(nn,sa),Jo=this.getCompleteStyleDeclaration(nn,sa+1),ra=Ei(ys,Jo,!1)),ra&&(hn?(ze.save(),ze.translate(ea.renderLeft,ea.renderTop),ze.rotate(ea.angle),this._renderChar(f,ze,nn,sa,ta,-ia/2,0),ze.restore()):(na=Qe,this._renderChar(f,ze,nn,sa,ta,na,Pi)),ta="",ys=Jo,Qe+=zn*ia,ia=0);ze.restore()}_applyPatternGradientTransformText(f){const ze=this.width+this.strokeWidth,Ke=this.height+this.strokeWidth,Qe=vt$1({width:ze,height:Ke}),Pi=Qe.getContext("2d");return Qe.width=ze,Qe.height=Ke,Pi.beginPath(),Pi.moveTo(0,0),Pi.lineTo(ze,0),Pi.lineTo(ze,Ke),Pi.lineTo(0,Ke),Pi.closePath(),Pi.translate(ze/2,Ke/2),Pi.fillStyle=f.toLive(Pi),this._applyPatternGradientTransform(Pi,f),Pi.fill(),Pi.createPattern(Qe,"no-repeat")}handleFiller(f,ze,Ke){let Qe,Pi;return Gt$1(Ke)?Ke.gradientUnits==="percentage"||Ke.gradientTransform||Ke.patternTransform?(Qe=-this.width/2,Pi=-this.height/2,f.translate(Qe,Pi),f[ze]=this._applyPatternGradientTransformText(Ke),{offsetX:Qe,offsetY:Pi}):(f[ze]=Ke.toLive(f),this._applyPatternGradientTransform(f,Ke)):(f[ze]=Ke,{offsetX:0,offsetY:0})}_setStrokeStyles(f,ze){let{stroke:Ke,strokeWidth:Qe}=ze;return f.lineWidth=Qe,f.lineCap=this.strokeLineCap,f.lineDashOffset=this.strokeDashOffset,f.lineJoin=this.strokeLineJoin,f.miterLimit=this.strokeMiterLimit,this.handleFiller(f,"strokeStyle",Ke)}_setFillStyles(f,ze){let{fill:Ke}=ze;return this.handleFiller(f,"fillStyle",Ke)}_renderChar(f,ze,Ke,Qe,Pi,nn,ln){const cn=this._getStyleDeclaration(Ke,Qe),hn=this.getCompleteStyleDeclaration(Ke,Qe),un=f==="fillText"&&hn.fill,xs=f==="strokeText"&&hn.stroke&&hn.strokeWidth;if(xs||un){if(ze.save(),ze.font=this._getFontDeclaration(hn),cn.textBackgroundColor&&this._removeShadow(ze),cn.deltaY&&(ln+=cn.deltaY),un){const zn=this._setFillStyles(ze,hn);ze.fillText(Pi,nn-zn.offsetX,ln-zn.offsetY)}if(xs){const zn=this._setStrokeStyles(ze,hn);ze.strokeText(Pi,nn-zn.offsetX,ln-zn.offsetY)}ze.restore()}}setSuperscript(f,ze){this._setScript(f,ze,this.superscript)}setSubscript(f,ze){this._setScript(f,ze,this.subscript)}_setScript(f,ze,Ke){const Qe=this.get2DCursorLocation(f,!0),Pi=this.getValueOfPropertyAt(Qe.lineIndex,Qe.charIndex,"fontSize"),nn=this.getValueOfPropertyAt(Qe.lineIndex,Qe.charIndex,"deltaY"),ln={fontSize:Pi*Ke.size,deltaY:nn+Pi*Ke.baseline};this.setSelectionStyles(ln,f,ze)}_getLineLeftOffset(f){const ze=this.getLineWidth(f),Ke=this.width-ze,Qe=this.textAlign,Pi=this.direction,nn=this.isEndOfWrapping(f);let ln=0;return Qe===po||Qe===yo&&!nn||Qe===vo&&!nn||Qe===mo&&!nn?0:(Qe===D$1&&(ln=Ke/2),Qe===A&&(ln=Ke),Qe===yo&&(ln=Ke/2),Qe===vo&&(ln=Ke),Pi==="rtl"&&(Qe===A||Qe===po||Qe===vo?ln=0:Qe===M$1||Qe===mo?ln=-Ke:Qe!==D$1&&Qe!==yo||(ln=-Ke/2)),ln)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(f){if(this.__lineWidths[f]!==void 0)return this.__lineWidths[f];const{width:ze}=this.measureLine(f);return this.__lineWidths[f]=ze,ze}_getWidthOfCharSpacing(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(f,ze,Ke){var Qe;return(Qe=this._getStyleDeclaration(f,ze)[Ke])!==null&&Qe!==void 0?Qe:this[Ke]}_renderTextDecoration(f,ze){if(!this[ze]&&!this.styleHas(ze))return;let Ke=this._getTopOffset();const Qe=this._getLeftOffset(),Pi=this.path,nn=this._getWidthOfCharSpacing(),ln=this.offsets[ze];for(let cn=0,hn=this._textLines.length;cn<hn;cn++){const un=this.getHeightOfLine(cn);if(!this[ze]&&!this.styleHas(ze,cn)){Ke+=un;continue}const xs=this._textLines[cn],zn=un/this.lineHeight,Xn=this._getLineLeftOffset(cn);let ys,Jo,ea=0,ra=0,na=this.getValueOfPropertyAt(cn,0,ze),ta=this.getValueOfPropertyAt(cn,0,K$1);const ia=Ke+zn*(1-this._fontSizeFraction);let sa=this.getHeightOfChar(cn,0),Ma=this.getValueOfPropertyAt(cn,0,"deltaY");for(let oa=0,ha=xs.length;oa<ha;oa++){const ca=this.__charBounds[cn][oa];ys=this.getValueOfPropertyAt(cn,oa,ze),Jo=this.getValueOfPropertyAt(cn,oa,K$1);const da=this.getHeightOfChar(cn,oa),ga=this.getValueOfPropertyAt(cn,oa,"deltaY");if(Pi&&ys&&Jo)f.save(),f.fillStyle=ta,f.translate(ca.renderLeft,ca.renderTop),f.rotate(ca.angle),f.fillRect(-ca.kernedWidth/2,ln*da+ga,ca.kernedWidth,this.fontSize/15),f.restore();else if((ys!==na||Jo!==ta||da!==sa||ga!==Ma)&&ra>0){let qa=Qe+Xn+ea;this.direction==="rtl"&&(qa=this.width-qa-ra),na&&ta&&(f.fillStyle=ta,f.fillRect(qa,ia+ln*sa+Ma,ra,this.fontSize/15)),ea=ca.left,ra=ca.width,na=ys,ta=Jo,sa=da,Ma=ga}else ra+=ca.kernedWidth}let pa=Qe+Xn+ea;this.direction==="rtl"&&(pa=this.width-pa-ra),f.fillStyle=Jo,ys&&Jo&&f.fillRect(pa,ia+ln*sa+Ma,ra-nn,this.fontSize/15),Ke+=un}this._removeShadow(f)}_getFontDeclaration(){let{fontFamily:f=this.fontFamily,fontStyle:ze=this.fontStyle,fontWeight:Ke=this.fontWeight,fontSize:Qe=this.fontSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Pi=arguments.length>1?arguments[1]:void 0;const nn=f.includes("'")||f.includes('"')||f.includes(",")||To.genericFonts.includes(f.toLowerCase())?f:'"'.concat(f,'"');return[ze,Ke,"".concat(Pi?this.CACHE_FONT_SIZE:Qe,"px"),nn].join(" ")}render(f){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(f)))}graphemeSplit(f){return Di(f)}_splitTextIntoLines(f){const ze=f.split(this._reNewline),Ke=new Array(ze.length),Qe=[`
`];let Pi=[];for(let nn=0;nn<ze.length;nn++)Ke[nn]=this.graphemeSplit(ze[nn]),Pi=Pi.concat(Ke[nn],Qe);return Pi.pop(),{_unwrappedLines:Ke,lines:ze,graphemeText:Pi,graphemeLines:Ke}}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return s(s({},super.toObject([...uo,...f])),{},{styles:Ai(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(f,ze){const{textLayoutProperties:Ke}=this.constructor;super.set(f,ze);let Qe=!1,Pi=!1;if(typeof f=="object")for(const nn in f)nn==="path"&&this.setPathInfo(),Qe=Qe||Ke.includes(nn),Pi=Pi||nn==="path";else Qe=Ke.includes(f),Pi=f==="path";return Pi&&this.setPathInfo(),Qe&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(f,ze,Ke){const Qe=dr(f,To.ATTRIBUTE_NAMES,Ke),Pi=s(s({},ze),Qe),{textAnchor:nn=M$1,textDecoration:ln="",dx:cn=0,dy:hn=0,top:un=0,left:xs=0,fontSize:zn=O$1,strokeWidth:Xn=1}=Pi,ys=i(Pi,wo),Jo=new this((f.textContent||"").replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),s({left:xs+cn,top:un+hn,underline:ln.includes("underline"),overline:ln.includes("overline"),linethrough:ln.includes("line-through"),strokeWidth:0,fontSize:zn},ys)),ea=Jo.getScaledHeight()/Jo.height,ra=((Jo.height+Jo.strokeWidth)*Jo.lineHeight-Jo.height)*ea,na=Jo.getScaledHeight()+ra;let ta=0;return nn===D$1&&(ta=Jo.getScaledWidth()/2),nn===A&&(ta=Jo.getScaledWidth()),Jo.set({left:Jo.left-ta,top:Jo.top-(na-Jo.fontSize*(.07+Jo._fontSizeFraction))/Jo.lineHeight,strokeWidth:Xn}),Jo}static fromObject(f){return this._fromObject(s(s({},f),{},{styles:ji(f.styles||{},f.text)}),{extraParam:"text"})}}t(To,"textLayoutProperties",lo),t(To,"cacheProperties",[...ps,...uo]),t(To,"ownDefaults",fo),t(To,"type","Text"),t(To,"genericFonts",["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),t(To,"ATTRIBUTE_NAMES",Fi.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),yi(To,[class extends Xe{_toSVG(){const qe=this._getSVGLeftTopOffsets(),f=this._getSVGTextAndBg(qe.textTop,qe.textLeft);return this._wrapSVGTextAndBg(f)}toSVG(qe){const f=this._createBaseSVGMarkup(this._toSVG(),{reviver:qe,noStyle:!0,withShadow:!0}),ze=this.path;return ze?f+ze._createBaseSVGMarkup(ze._toSVG(),{reviver:qe,withShadow:!0,additionalTransform:zt$1(this.calcOwnMatrix())}):f}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(qe){let{textBgRects:f,textSpans:ze}=qe;const Ke=this.getSvgTextDecoration(this);return[f.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'.concat(this.fontFamily.replace(Co,"'"),'" '):"",this.fontSize?'font-size="'.concat(this.fontSize,'" '):"",this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",Ke?'text-decoration="'.concat(Ke,'" '):"",this.direction==="rtl"?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",ze.join(""),`</text>
`]}_getSVGTextAndBg(qe,f){const ze=[],Ke=[];let Qe,Pi=qe;this.backgroundColor&&Ke.push(...bo(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let nn=0,ln=this._textLines.length;nn<ln;nn++)Qe=this._getLineLeftOffset(nn),this.direction==="rtl"&&(Qe+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",nn))&&this._setSVGTextLineBg(Ke,nn,f+Qe,Pi),this._setSVGTextLineText(ze,nn,f+Qe,Pi),Pi+=this.getHeightOfLine(nn);return{textSpans:ze,textBgRects:Ke}}_createTextCharSpan(qe,f,ze,Ke,Qe){const Pi=o.NUM_FRACTION_DIGITS,nn=this.getSvgSpanStyles(f,qe!==qe.trim()||!!qe.match(xo)),ln=nn?'style="'.concat(nn,'"'):"",cn=f.deltaY,hn=cn?' dy="'.concat(Vt$1(cn,Pi),'" '):"",{angle:un,renderLeft:xs,renderTop:zn,width:Xn}=Qe;let ys="";if(xs!==void 0){const Jo=Xn/2;un&&(ys=' rotate="'.concat(Vt$1(Ct$1(un),Pi),'"'));const ea=Pt$1({angle:Ct$1(un)});ea[4]=xs,ea[5]=zn;const ra=new ot$1(-Jo,0).transform(ea);ze=ra.x,Ke=ra.y}return'<tspan x="'.concat(Vt$1(ze,Pi),'" y="').concat(Vt$1(Ke,Pi),'" ').concat(hn).concat(ys).concat(ln,">").concat(ki(qe),"</tspan>")}_setSVGTextLineText(qe,f,ze,Ke){const Qe=this.getHeightOfLine(f),Pi=this.textAlign.includes(po),nn=this._textLines[f];let ln,cn,hn,un,xs,zn="",Xn=0;Ke+=Qe*(1-this._fontSizeFraction)/this.lineHeight;for(let ys=0,Jo=nn.length-1;ys<=Jo;ys++)xs=ys===Jo||this.charSpacing||this.path,zn+=nn[ys],hn=this.__charBounds[f][ys],Xn===0?(ze+=hn.kernedWidth-hn.width,Xn+=hn.width):Xn+=hn.kernedWidth,Pi&&!xs&&this._reSpaceAndTab.test(nn[ys])&&(xs=!0),xs||(ln=ln||this.getCompleteStyleDeclaration(f,ys),cn=this.getCompleteStyleDeclaration(f,ys+1),xs=Ei(ln,cn,!0)),xs&&(un=this._getStyleDeclaration(f,ys),qe.push(this._createTextCharSpan(zn,un,ze,Ke,hn)),zn="",ln=cn,this.direction==="rtl"?ze-=Xn:ze+=Xn,Xn=0)}_setSVGTextLineBg(qe,f,ze,Ke){const Qe=this._textLines[f],Pi=this.getHeightOfLine(f)/this.lineHeight;let nn,ln=0,cn=0,hn=this.getValueOfPropertyAt(f,0,"textBackgroundColor");for(let un=0;un<Qe.length;un++){const{left:xs,width:zn,kernedWidth:Xn}=this.__charBounds[f][un];nn=this.getValueOfPropertyAt(f,un,"textBackgroundColor"),nn!==hn?(hn&&qe.push(...bo(hn,ze+cn,Ke,ln,Pi)),cn=xs,ln=zn,hn=nn):ln+=Xn}nn&&qe.push(...bo(hn,ze+cn,Ke,ln,Pi))}_getSVGLineTopOffset(qe){let f,ze=0;for(f=0;f<qe;f++)ze+=this.getHeightOfLine(f);const Ke=this.getHeightOfLine(f);return{lineTop:ze,offset:(this._fontSizeMult-this._fontSizeFraction)*Ke/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(qe){return"".concat(super.getSvgStyles(qe)," white-space: pre;")}getSvgSpanStyles(qe,f){const{fontFamily:ze,strokeWidth:Ke,stroke:Qe,fill:Pi,fontSize:nn,fontStyle:ln,fontWeight:cn,deltaY:hn}=qe,un=this.getSvgTextDecoration(qe);return[Qe?Be$1(J,Qe):"",Ke?"stroke-width: ".concat(Ke,"; "):"",ze?"font-family: ".concat(ze.includes("'")||ze.includes('"')?ze:"'".concat(ze,"'"),"; "):"",nn?"font-size: ".concat(nn,"px; "):"",ln?"font-style: ".concat(ln,"; "):"",cn?"font-weight: ".concat(cn,"; "):"",un&&"text-decoration: ".concat(un,"; "),Pi?Be$1(K$1,Pi):"",hn?"baseline-shift: ".concat(-hn,"; "):"",f?"white-space: pre; ":""].join("")}getSvgTextDecoration(qe){return["overline","underline","line-through"].filter(f=>qe[f.replace("-","")]).join(" ")}}]),tt.setClass(To),tt.setSVGClass(To);class Oo{constructor(f){t(this,"target",void 0),t(this,"__mouseDownInPlace",!1),t(this,"__dragStartFired",!1),t(this,"__isDraggingOver",!1),t(this,"__dragStartSelection",void 0),t(this,"__dragImageDisposer",void 0),t(this,"_dispose",void 0),this.target=f;const ze=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{ze.forEach(Ke=>Ke()),this._dispose=void 0}}isPointerOverSelection(f){const ze=this.target,Ke=ze.getSelectionStartFromPointer(f);return ze.isEditing&&Ke>=ze.selectionStart&&Ke<=ze.selectionEnd&&ze.selectionStart<ze.selectionEnd}start(f){return this.__mouseDownInPlace=this.isPointerOverSelection(f)}isActive(){return this.__mouseDownInPlace}end(f){const ze=this.isActive();return ze&&!this.__dragStartFired&&(this.target.setCursorByClick(f),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,ze}getDragStartSelection(){return this.__dragStartSelection}setDragImage(f,ze){var Ke;let{selectionStart:Qe,selectionEnd:Pi}=ze;const nn=this.target,ln=nn.canvas,cn=new ot$1(nn.flipX?-1:1,nn.flipY?-1:1),hn=nn._getCursorBoundaries(Qe),un=new ot$1(hn.left+hn.leftOffset,hn.top+hn.topOffset).multiply(cn).transform(nn.calcTransformMatrix()),xs=ln.getScenePoint(f).subtract(un),zn=nn.getCanvasRetinaScaling(),Xn=nn.getBoundingRect(),ys=un.subtract(new ot$1(Xn.left,Xn.top)),Jo=ln.viewportTransform,ea=ys.add(xs).transform(Jo,!0),ra=nn.backgroundColor,na=Oi(nn.styles);nn.backgroundColor="";const ta={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};nn.setSelectionStyles(ta,0,Qe),nn.setSelectionStyles(ta,Pi,nn.text.length),nn.dirty=!0;const ia=nn.toCanvasElement({enableRetinaScaling:ln.enableRetinaScaling,viewportTransform:!0});nn.backgroundColor=ra,nn.styles=na,nn.dirty=!0,an(ia,{position:"fixed",left:"".concat(-ia.width,"px"),border:j$1,width:"".concat(ia.width/zn,"px"),height:"".concat(ia.height/zn,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{ia.remove()},Kt$1(f.target||this.target.hiddenTextarea).body.appendChild(ia),(Ke=f.dataTransfer)===null||Ke===void 0||Ke.setDragImage(ia,ea.x,ea.y)}onDragStart(f){this.__dragStartFired=!0;const ze=this.target,Ke=this.isActive();if(Ke&&f.dataTransfer){const Qe=this.__dragStartSelection={selectionStart:ze.selectionStart,selectionEnd:ze.selectionEnd},Pi=ze._text.slice(Qe.selectionStart,Qe.selectionEnd).join(""),nn=s({text:ze.text,value:Pi},Qe);f.dataTransfer.setData("text/plain",Pi),f.dataTransfer.setData("application/fabric",JSON.stringify({value:Pi,styles:ze.getSelectionStyles(Qe.selectionStart,Qe.selectionEnd,!0)})),f.dataTransfer.effectAllowed="copyMove",this.setDragImage(f,nn)}return ze.abortCursorAnimation(),Ke}canDrop(f){if(this.target.editable&&!this.target.getActiveControl()&&!f.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){const ze=this.target.getSelectionStartFromPointer(f),Ke=this.__dragStartSelection;return ze<Ke.selectionStart||ze>Ke.selectionEnd}return!0}return!1}targetCanDrop(f){return this.target.canDrop(f)}dragEnterHandler(f){let{e:ze}=f;const Ke=this.targetCanDrop(ze);!this.__isDraggingOver&&Ke&&(this.__isDraggingOver=!0)}dragOverHandler(f){const{e:ze}=f,Ke=this.targetCanDrop(ze);!this.__isDraggingOver&&Ke?this.__isDraggingOver=!0:this.__isDraggingOver&&!Ke&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(ze.preventDefault(),f.canDrop=!0,f.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(f){var ze;const{e:Ke}=f,Qe=Ke.defaultPrevented;this.__isDraggingOver=!1,Ke.preventDefault();let Pi=(ze=Ke.dataTransfer)===null||ze===void 0?void 0:ze.getData("text/plain");if(Pi&&!Qe){const nn=this.target,ln=nn.canvas;let cn=nn.getSelectionStartFromPointer(Ke);const{styles:hn}=Ke.dataTransfer.types.includes("application/fabric")?JSON.parse(Ke.dataTransfer.getData("application/fabric")):{},un=Pi[Math.max(0,Pi.length-1)],xs=0;if(this.__dragStartSelection){const zn=this.__dragStartSelection.selectionStart,Xn=this.__dragStartSelection.selectionEnd;cn>zn&&cn<=Xn?cn=zn:cn>Xn&&(cn-=Xn-zn),nn.removeChars(zn,Xn),delete this.__dragStartSelection}nn._reNewline.test(un)&&(nn._reNewline.test(nn._text[cn])||cn===nn._text.length)&&(Pi=Pi.trimEnd()),f.didDrop=!0,f.dropTarget=nn,nn.insertChars(Pi,hn,cn),ln.setActiveObject(nn),nn.enterEditing(Ke),nn.selectionStart=Math.min(cn+xs,nn._text.length),nn.selectionEnd=Math.min(nn.selectionStart+Pi.length,nn._text.length),nn.hiddenTextarea.value=nn.text,nn._updateTextarea(),nn.hiddenTextarea.focus(),nn.fire(z,{index:cn+xs,action:"drop"}),ln.fire("text:changed",{target:nn}),ln.contextTopDirty=!0,ln.requestRenderAll()}}dragEndHandler(f){let{e:ze}=f;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var Ke;const Qe=this.target,Pi=this.target.canvas,{selectionStart:nn,selectionEnd:ln}=this.__dragStartSelection,cn=((Ke=ze.dataTransfer)===null||Ke===void 0?void 0:Ke.dropEffect)||j$1;cn===j$1?(Qe.selectionStart=nn,Qe.selectionEnd=ln,Qe._updateTextarea(),Qe.hiddenTextarea.focus()):(Qe.clearContextTop(),cn==="move"&&(Qe.removeChars(nn,ln),Qe.selectionStart=Qe.selectionEnd=nn,Qe.hiddenTextarea&&(Qe.hiddenTextarea.value=Qe.text),Qe._updateTextarea(),Qe.fire(z,{index:nn,action:"dragend"}),Pi.fire("text:changed",{target:Qe}),Pi.requestRenderAll()),Qe.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}const ko=/[ \n\.,;!\?\-]/;class Do extends To{constructor(){super(...arguments),t(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(f){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(f)}_animateCursor(f){let{toValue:ze,duration:Ke,delay:Qe,onComplete:Pi}=f;return js({startValue:this._currentCursorOpacity,endValue:ze,duration:Ke,delay:Qe,onComplete:Pi,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:nn=>{this._currentCursorOpacity=nn,this.renderCursorOrSelection()}})}_tick(f){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(f||0,100),onComplete:this._onTickComplete})}_onTickComplete(){var f;(f=this._currentTickCompleteState)===null||f===void 0||f.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick})}initDelayedCursor(f){this.abortCursorAnimation(),this._tick(f?0:this.cursorDelay)}abortCursorAnimation(){let f=!1;[this._currentTickState,this._currentTickCompleteState].forEach(ze=>{ze&&!ze.isDone()&&(f=!0,ze.abort())}),this._currentCursorOpacity=1,f&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some(f=>!f||f.isDone())&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}cmdAll(){this.selectAll(),this.renderCursorOrSelection()}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(f){let ze=0,Ke=f-1;if(this._reSpace.test(this._text[Ke]))for(;this._reSpace.test(this._text[Ke]);)ze++,Ke--;for(;/\S/.test(this._text[Ke])&&Ke>-1;)ze++,Ke--;return f-ze}findWordBoundaryRight(f){let ze=0,Ke=f;if(this._reSpace.test(this._text[Ke]))for(;this._reSpace.test(this._text[Ke]);)ze++,Ke++;for(;/\S/.test(this._text[Ke])&&Ke<this._text.length;)ze++,Ke++;return f+ze}findLineBoundaryLeft(f){let ze=0,Ke=f-1;for(;!/\n/.test(this._text[Ke])&&Ke>-1;)ze++,Ke--;return f-ze}findLineBoundaryRight(f){let ze=0,Ke=f;for(;!/\n/.test(this._text[Ke])&&Ke<this._text.length;)ze++,Ke++;return f+ze}searchWordBoundary(f,ze){const Ke=this._text;let Qe=f>0&&this._reSpace.test(Ke[f])&&(ze===-1||!F$1.test(Ke[f-1]))?f-1:f,Pi=Ke[Qe];for(;Qe>0&&Qe<Ke.length&&!ko.test(Pi);)Qe+=ze,Pi=Ke[Qe];return ze===-1&&ko.test(Pi)&&Qe++,Qe}selectWord(f){var ze;f=(ze=f)!==null&&ze!==void 0?ze:this.selectionStart;const Ke=this.searchWordBoundary(f,-1),Qe=Math.max(Ke,this.searchWordBoundary(f,1));this.selectionStart=Ke,this.selectionEnd=Qe,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(f){var ze;f=(ze=f)!==null&&ze!==void 0?ze:this.selectionStart;const Ke=this.findLineBoundaryLeft(f),Qe=this.findLineBoundaryRight(f);this.selectionStart=Ke,this.selectionEnd=Qe,this._fireSelectionChanged(),this._updateTextarea()}enterEditing(f){!this.isEditing&&this.editable&&(this.enterEditingImpl(),this.fire("editing:entered",f?{e:f}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e:f}),this.canvas.requestRenderAll()))}enterEditingImpl(){this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick()}updateSelectionOnMouseMove(f){if(this.getActiveControl())return;const ze=this.hiddenTextarea;Kt$1(ze).activeElement!==ze&&ze.focus();const Ke=this.getSelectionStartFromPointer(f),Qe=this.selectionStart,Pi=this.selectionEnd;(Ke===this.__selectionStartOnMouseDown&&Qe!==Pi||Qe!==Ke&&Pi!==Ke)&&(Ke>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=Ke):(this.selectionStart=Ke,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===Qe&&this.selectionEnd===Pi||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(f,ze,Ke){const Qe=Ke.slice(0,f),Pi=this.graphemeSplit(Qe).length;if(f===ze)return{selectionStart:Pi,selectionEnd:Pi};const nn=Ke.slice(f,ze);return{selectionStart:Pi,selectionEnd:Pi+this.graphemeSplit(nn).length}}fromGraphemeToStringSelection(f,ze,Ke){const Qe=Ke.slice(0,f).join("").length;return f===ze?{selectionStart:Qe,selectionEnd:Qe}:{selectionStart:Qe,selectionEnd:Qe+Ke.slice(f,ze).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){const f=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=f.selectionStart,this.hiddenTextarea.selectionEnd=f.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};const f=this.hiddenTextarea;this.text=f.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();const ze=this.fromStringToGraphemeSelection(f.selectionStart,f.selectionEnd,f.value);this.selectionEnd=this.selectionStart=ze.selectionEnd,this.inCompositionMode||(this.selectionStart=ze.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){const f=this._calcTextareaPosition();this.hiddenTextarea.style.left=f.left,this.hiddenTextarea.style.top=f.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};const f=this.inCompositionMode?this.compositionStart:this.selectionStart,ze=this._getCursorBoundaries(f),Ke=this.get2DCursorLocation(f),Qe=Ke.lineIndex,Pi=Ke.charIndex,nn=this.getValueOfPropertyAt(Qe,Pi,"fontSize")*this.lineHeight,ln=ze.leftOffset,cn=this.getCanvasRetinaScaling(),hn=this.canvas.upperCanvasEl,un=hn.width/cn,xs=hn.height/cn,zn=un-nn,Xn=xs-nn,ys=new ot$1(ze.left+ln,ze.top+ze.topOffset+nn).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new ot$1(hn.clientWidth/un,hn.clientHeight/xs));return ys.x<0&&(ys.x=0),ys.x>zn&&(ys.x=zn),ys.y<0&&(ys.y=0),ys.y>Xn&&(ys.y=Xn),ys.x+=this.canvas._offset.left,ys.y+=this.canvas._offset.top,{left:"".concat(ys.x,"px"),top:"".concat(ys.y,"px"),fontSize:"".concat(nn,"px"),charHeight:nn}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){const f=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,f&&(f.blur&&f.blur(),f.parentNode&&f.parentNode.removeChild(f)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop()}exitEditingImpl(){this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords())}exitEditing(){const f=this._textBeforeEdit!==this.text;return this.exitEditingImpl(),this.fire("editing:exited"),f&&this.fire(Q$1),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),f&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(const f in this.styles)this._textLines[f]||delete this.styles[f]}removeStyleFromTo(f,ze){const{lineIndex:Ke,charIndex:Qe}=this.get2DCursorLocation(f,!0),{lineIndex:Pi,charIndex:nn}=this.get2DCursorLocation(ze,!0);if(Ke!==Pi){if(this.styles[Ke])for(let ln=Qe;ln<this._unwrappedTextLines[Ke].length;ln++)delete this.styles[Ke][ln];if(this.styles[Pi])for(let ln=nn;ln<this._unwrappedTextLines[Pi].length;ln++){const cn=this.styles[Pi][ln];cn&&(this.styles[Ke]||(this.styles[Ke]={}),this.styles[Ke][Qe+ln-nn]=cn)}for(let ln=Ke+1;ln<=Pi;ln++)delete this.styles[ln];this.shiftLineStyles(Pi,Ke-Pi)}else if(this.styles[Ke]){const ln=this.styles[Ke],cn=nn-Qe;for(let hn=Qe;hn<nn;hn++)delete ln[hn];for(const hn in this.styles[Ke]){const un=parseInt(hn,10);un>=nn&&(ln[un-cn]=ln[hn],delete ln[hn])}}}shiftLineStyles(f,ze){const Ke=Object.assign({},this.styles);for(const Qe in this.styles){const Pi=parseInt(Qe,10);Pi>f&&(this.styles[Pi+ze]=Ke[Pi],Ke[Pi-ze]||delete this.styles[Pi])}}insertNewlineStyleObject(f,ze,Ke,Qe){const Pi={},nn=this._unwrappedTextLines[f].length,ln=nn===ze;let cn=!1;Ke||(Ke=1),this.shiftLineStyles(f,Ke);const hn=this.styles[f]?this.styles[f][ze===0?ze:ze-1]:void 0;for(const xs in this.styles[f]){const zn=parseInt(xs,10);zn>=ze&&(cn=!0,Pi[zn-ze]=this.styles[f][xs],ln&&ze===0||delete this.styles[f][xs])}let un=!1;for(cn&&!ln&&(this.styles[f+Ke]=Pi,un=!0),(un||nn>ze)&&Ke--;Ke>0;)Qe&&Qe[Ke-1]?this.styles[f+Ke]={0:s({},Qe[Ke-1])}:hn?this.styles[f+Ke]={0:s({},hn)}:delete this.styles[f+Ke],Ke--;this._forceClearCache=!0}insertCharStyleObject(f,ze,Ke,Qe){this.styles||(this.styles={});const Pi=this.styles[f],nn=Pi?s({},Pi):{};Ke||(Ke=1);for(const cn in nn){const hn=parseInt(cn,10);hn>=ze&&(Pi[hn+Ke]=nn[hn],nn[hn-Ke]||delete Pi[hn])}if(this._forceClearCache=!0,Qe){for(;Ke--;)Object.keys(Qe[Ke]).length&&(this.styles[f]||(this.styles[f]={}),this.styles[f][ze+Ke]=s({},Qe[Ke]));return}if(!Pi)return;const ln=Pi[ze?ze-1:1];for(;ln&&Ke--;)this.styles[f][ze+Ke]=s({},ln)}insertNewStyleBlock(f,ze,Ke){const Qe=this.get2DCursorLocation(ze,!0),Pi=[0];let nn,ln=0;for(let cn=0;cn<f.length;cn++)f[cn]===`
`?(ln++,Pi[ln]=0):Pi[ln]++;for(Pi[0]>0&&(this.insertCharStyleObject(Qe.lineIndex,Qe.charIndex,Pi[0],Ke),Ke=Ke&&Ke.slice(Pi[0]+1)),ln&&this.insertNewlineStyleObject(Qe.lineIndex,Qe.charIndex+Pi[0],ln),nn=1;nn<ln;nn++)Pi[nn]>0?this.insertCharStyleObject(Qe.lineIndex+nn,0,Pi[nn],Ke):Ke&&this.styles[Qe.lineIndex+nn]&&Ke[0]&&(this.styles[Qe.lineIndex+nn][0]=Ke[0]),Ke=Ke&&Ke.slice(Pi[nn]+1);Pi[nn]>0&&this.insertCharStyleObject(Qe.lineIndex+nn,0,Pi[nn],Ke)}removeChars(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:f+1;this.removeStyleFromTo(f,ze),this._text.splice(f,ze-f),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(f,ze,Ke){let Qe=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Ke;Qe>Ke&&this.removeStyleFromTo(Ke,Qe);const Pi=this.graphemeSplit(f);this.insertNewStyleBlock(Pi,Ke,ze),this._text=[...this._text.slice(0,Ke),...Pi,...this._text.slice(Qe)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(f,ze,Ke){Ke<=f?(ze===f?this._selectionDirection=M$1:this._selectionDirection===A&&(this._selectionDirection=M$1,this.selectionEnd=f),this.selectionStart=Ke):Ke>f&&Ke<ze?this._selectionDirection===A?this.selectionEnd=Ke:this.selectionStart=Ke:(ze===f?this._selectionDirection=A:this._selectionDirection===M$1&&(this._selectionDirection=A,this.selectionStart=ze),this.selectionEnd=Ke)}}class Mo extends Do{initHiddenTextarea(){const f=this.canvas&&Kt$1(this.canvas.getElement())||m(),ze=f.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off"}).map(nn=>{let[ln,cn]=nn;return ze.setAttribute(ln,cn)});const{top:Ke,left:Qe,fontSize:Pi}=this._calcTextareaPosition();ze.style.cssText="position: absolute; top: ".concat(Ke,"; left: ").concat(Qe,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(Pi,";"),(this.hiddenTextareaContainer||f.body).appendChild(ze),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map(nn=>{let[ln,cn]=nn;return ze.addEventListener(ln,this[cn].bind(this))}),this.hiddenTextarea=ze}blur(){this.abortCursorAnimation()}onKeyDown(f){if(!this.isEditing)return;const ze=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(f.keyCode in ze)this[ze[f.keyCode]](f);else{if(!(f.keyCode in this.ctrlKeysMapDown)||!f.ctrlKey&&!f.metaKey)return;this[this.ctrlKeysMapDown[f.keyCode]](f)}f.stopImmediatePropagation(),f.preventDefault(),f.keyCode>=33&&f.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(f){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:f.keyCode in this.ctrlKeysMapUp&&(f.ctrlKey||f.metaKey)&&(this[this.ctrlKeysMapUp[f.keyCode]](f),f.stopImmediatePropagation(),f.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(f){const ze=this.fromPaste,{value:Ke,selectionStart:Qe,selectionEnd:Pi}=this.hiddenTextarea;if(this.fromPaste=!1,f&&f.stopPropagation(),!this.isEditing)return;const nn=()=>{this.updateFromTextArea(),this.fire(z),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(this.hiddenTextarea.value==="")return this.styles={},void nn();const ln=this._splitTextIntoLines(Ke).graphemeText,cn=this._text.length,hn=ln.length,un=this.selectionStart,xs=this.selectionEnd,zn=un!==xs;let Xn,ys,Jo,ea,ra=hn-cn;const na=this.fromStringToGraphemeSelection(Qe,Pi,Ke),ta=un>na.selectionStart;zn?(ys=this._text.slice(un,xs),ra+=xs-un):hn<cn&&(ys=ta?this._text.slice(xs+ra,xs):this._text.slice(un,un-ra));const ia=ln.slice(na.selectionEnd-ra,na.selectionEnd);if(ys&&ys.length&&(ia.length&&(Xn=this.getSelectionStyles(un,un+1,!1),Xn=ia.map(()=>Xn[0])),zn?(Jo=un,ea=xs):ta?(Jo=xs-ys.length,ea=xs):(Jo=xs,ea=xs+ys.length),this.removeStyleFromTo(Jo,ea)),ia.length){const{copyPasteData:sa}=p$1();ze&&ia.join("")===sa.copiedText&&!o.disableStyleCopyPaste&&(Xn=sa.copiedTextStyle),this.insertNewStyleBlock(ia,un,Xn)}nn()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(f){let{target:ze}=f;const{selectionStart:Ke,selectionEnd:Qe}=ze;this.compositionStart=Ke,this.compositionEnd=Qe,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;const{copyPasteData:f}=p$1();f.copiedText=this.getSelectedText(),o.disableStyleCopyPaste?f.copiedTextStyle=void 0:f.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(f,ze){let Ke,Qe=this._getLineLeftOffset(f);return ze>0&&(Ke=this.__charBounds[f][ze-1],Qe+=Ke.left+Ke.width),Qe}getDownCursorOffset(f,ze){const Ke=this._getSelectionForOffset(f,ze),Qe=this.get2DCursorLocation(Ke),Pi=Qe.lineIndex;if(Pi===this._textLines.length-1||f.metaKey||f.keyCode===34)return this._text.length-Ke;const nn=Qe.charIndex,ln=this._getWidthBeforeCursor(Pi,nn),cn=this._getIndexOnLine(Pi+1,ln);return this._textLines[Pi].slice(nn).length+cn+1+this.missingNewlineOffset(Pi)}_getSelectionForOffset(f,ze){return f.shiftKey&&this.selectionStart!==this.selectionEnd&&ze?this.selectionEnd:this.selectionStart}getUpCursorOffset(f,ze){const Ke=this._getSelectionForOffset(f,ze),Qe=this.get2DCursorLocation(Ke),Pi=Qe.lineIndex;if(Pi===0||f.metaKey||f.keyCode===33)return-Ke;const nn=Qe.charIndex,ln=this._getWidthBeforeCursor(Pi,nn),cn=this._getIndexOnLine(Pi-1,ln),hn=this._textLines[Pi].slice(0,nn),un=this.missingNewlineOffset(Pi-1);return-this._textLines[Pi-1].length+cn-hn.length+(1-un)}_getIndexOnLine(f,ze){const Ke=this._textLines[f];let Qe,Pi,nn=this._getLineLeftOffset(f),ln=0;for(let cn=0,hn=Ke.length;cn<hn;cn++)if(Qe=this.__charBounds[f][cn].width,nn+=Qe,nn>ze){Pi=!0;const un=nn-Qe,xs=nn,zn=Math.abs(un-ze);ln=Math.abs(xs-ze)<zn?cn:cn-1;break}return Pi||(ln=Ke.length-1),ln}moveCursorDown(f){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",f)}moveCursorUp(f){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",f)}_moveCursorUpOrDown(f,ze){const Ke=this["get".concat(f,"CursorOffset")](ze,this._selectionDirection===A);if(ze.shiftKey?this.moveCursorWithShift(Ke):this.moveCursorWithoutShift(Ke),Ke!==0){const Qe=this.text.length;this.selectionStart=gs(0,this.selectionStart,Qe),this.selectionEnd=gs(0,this.selectionEnd,Qe),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(f){const ze=this._selectionDirection===M$1?this.selectionStart+f:this.selectionEnd+f;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,ze),f!==0}moveCursorWithoutShift(f){return f<0?(this.selectionStart+=f,this.selectionEnd=this.selectionStart):(this.selectionEnd+=f,this.selectionStart=this.selectionEnd),f!==0}moveCursorLeft(f){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",f)}_move(f,ze,Ke){let Qe;if(f.altKey)Qe=this["findWordBoundary".concat(Ke)](this[ze]);else{if(!f.metaKey&&f.keyCode!==35&&f.keyCode!==36)return this[ze]+=Ke==="Left"?-1:1,!0;Qe=this["findLineBoundary".concat(Ke)](this[ze])}return Qe!==void 0&&this[ze]!==Qe&&(this[ze]=Qe,!0)}_moveLeft(f,ze){return this._move(f,ze,"Left")}_moveRight(f,ze){return this._move(f,ze,"Right")}moveCursorLeftWithoutShift(f){let ze=!0;return this._selectionDirection=M$1,this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(ze=this._moveLeft(f,"selectionStart")),this.selectionEnd=this.selectionStart,ze}moveCursorLeftWithShift(f){return this._selectionDirection===A&&this.selectionStart!==this.selectionEnd?this._moveLeft(f,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection=M$1,this._moveLeft(f,"selectionStart")):void 0}moveCursorRight(f){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",f)}_moveCursorLeftOrRight(f,ze){const Ke="moveCursor".concat(f).concat(ze.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[Ke](ze)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(f){return this._selectionDirection===M$1&&this.selectionStart!==this.selectionEnd?this._moveRight(f,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=A,this._moveRight(f,"selectionEnd")):void 0}moveCursorRightWithoutShift(f){let ze=!0;return this._selectionDirection=A,this.selectionStart===this.selectionEnd?(ze=this._moveRight(f,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,ze}}const Po=qe=>!!qe.button;class Eo extends Mo{constructor(){super(...arguments),t(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("mousetripleclick",this.tripleClickHandler),this.draggableTextDelegate=new Oo(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(f){return this.draggableTextDelegate.onDragStart(f)}canDrop(f){return this.draggableTextDelegate.canDrop(f)}doubleClickHandler(f){this.isEditing&&(this.selectWord(this.getSelectionStartFromPointer(f.e)),this.renderCursorOrSelection())}tripleClickHandler(f){this.isEditing&&(this.selectLine(this.getSelectionStartFromPointer(f.e)),this.renderCursorOrSelection())}_mouseDownHandler(f){let{e:ze,alreadySelected:Ke}=f;this.canvas&&this.editable&&!Po(ze)&&!this.getActiveControl()&&(this.draggableTextDelegate.start(ze)||(this.canvas.textEditingManager.register(this),Ke&&(this.inCompositionMode=!1,this.setCursorByClick(ze)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()),this.selected||(this.selected=Ke||this.isEditing)))}mouseUpHandler(f){let{e:ze,transform:Ke}=f;const Qe=this.draggableTextDelegate.end(ze);if(this.canvas){this.canvas.textEditingManager.unregister(this);const Pi=this.canvas._activeObject;if(Pi&&Pi!==this)return}!this.editable||this.group&&!this.group.interactive||Ke&&Ke.actionPerformed||Po(ze)||Qe||this.selected&&!this.getActiveControl()&&(this.enterEditing(ze),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection())}setCursorByClick(f){const ze=this.getSelectionStartFromPointer(f),Ke=this.selectionStart,Qe=this.selectionEnd;f.shiftKey?this.setSelectionStartEndWithShift(Ke,Qe,ze):(this.selectionStart=ze,this.selectionEnd=ze),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(f){const ze=this.canvas.getScenePoint(f).transform(St$1(this.calcTransformMatrix())).add(new ot$1(-this._getLeftOffset(),-this._getTopOffset()));let Ke=0,Qe=0,Pi=0;for(let hn=0;hn<this._textLines.length&&Ke<=ze.y;hn++)Ke+=this.getHeightOfLine(hn),Pi=hn,hn>0&&(Qe+=this._textLines[hn-1].length+this.missingNewlineOffset(hn-1));let nn=Math.abs(this._getLineLeftOffset(Pi));const ln=this._textLines[Pi].length,cn=this.__charBounds[Pi];for(let hn=0;hn<ln;hn++){const un=nn+cn[hn].kernedWidth;if(ze.x<=un){Math.abs(ze.x-un)<=Math.abs(ze.x-nn)&&Qe++;break}nn=un,Qe++}return Math.min(this.flipX?ln-Qe:Qe,this._text.length)}}const Ao="moveCursorUp",jo="moveCursorDown",Fo="moveCursorLeft",Lo="moveCursorRight",Ro="exitEditing",Io=(qe,f)=>{const ze=f.getRetinaScaling();qe.setTransform(ze,0,0,ze,0,0);const Ke=f.viewportTransform;qe.transform(Ke[0],Ke[1],Ke[2],Ke[3],Ke[4],Ke[5])},Bo=s({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:Ro,27:Ro,33:Ao,34:jo,35:Lo,36:Fo,37:Fo,38:Ao,39:Lo,40:jo},keysMapRtl:{9:Ro,27:Ro,33:Ao,34:jo,35:Fo,36:Lo,37:Lo,38:Ao,39:Fo,40:jo},ctrlKeysMapDown:{65:"cmdAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1});class Xo extends Eo{static getDefaults(){return s(s({},super.getDefaults()),Xo.ownDefaults)}get type(){const f=super.type;return f==="itext"?"i-text":f}constructor(f,ze){super(f,s(s({},Xo.ownDefaults),ze)),this.initBehavior()}_set(f,ze){return this.isEditing&&this._savedProps&&f in this._savedProps?(this._savedProps[f]=ze,this):(f==="canvas"&&(this.canvas instanceof Cn&&this.canvas.textEditingManager.remove(this),ze instanceof Cn&&ze.textEditingManager.add(this)),super._set(f,ze))}setSelectionStart(f){f=Math.max(f,0),this._updateAndFire("selectionStart",f)}setSelectionEnd(f){f=Math.min(f,this.text.length),this._updateAndFire("selectionEnd",f)}_updateAndFire(f,ze){this[f]!==ze&&(this._fireSelectionChanged(),this[f]=ze),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart||0,ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionEnd,Ke=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(f,ze,Ke)}setSelectionStyles(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionStart||0,Ke=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.selectionEnd;return super.setSelectionStyles(f,ze,Ke)}get2DCursorLocation(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,ze=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(f,ze)}render(f){super.render(f),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(f){const ze=this.isEditing;this.isEditing=!1;const Ke=super.toCanvasElement(f);return this.isEditing=ze,Ke}renderCursorOrSelection(){if(!this.isEditing||!this.canvas)return;const f=this.clearContextTop(!0);if(!f)return;const ze=this._getCursorBoundaries(),Ke=this.findAncestorsWithClipPath(),Qe=Ke.length>0;let Pi,nn=f;if(Qe){Pi=vt$1(f.canvas),nn=Pi.getContext("2d"),Io(nn,this.canvas);const ln=this.calcTransformMatrix();nn.transform(ln[0],ln[1],ln[2],ln[3],ln[4],ln[5])}if(this.selectionStart!==this.selectionEnd||this.inCompositionMode?this.renderSelection(nn,ze):this.renderCursor(nn,ze),Qe)for(const ln of Ke){const cn=ln.clipPath,hn=vt$1(f.canvas),un=hn.getContext("2d");if(Io(un,this.canvas),!cn.absolutePositioned){const xs=ln.calcTransformMatrix();un.transform(xs[0],xs[1],xs[2],xs[3],xs[4],xs[5])}cn.transform(un),cn.drawObject(un,!0,{}),this.drawClipPathOnCache(nn,cn,hn)}Qe&&(f.setTransform(1,0,0,1,0,0),f.drawImage(Pi,0,0)),this.canvas.contextTopDirty=!0,f.restore()}findAncestorsWithClipPath(){const f=[];let ze=this;for(;ze;)ze.clipPath&&f.push(ze),ze=ze.parent;return f}_getCursorBoundaries(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,ze=arguments.length>1?arguments[1]:void 0;const Ke=this._getLeftOffset(),Qe=this._getTopOffset(),Pi=this._getCursorBoundariesOffsets(f,ze);return{left:Ke,top:Qe,leftOffset:Pi.left,topOffset:Pi.top}}_getCursorBoundariesOffsets(f,ze){return ze?this.__getCursorBoundariesOffsets(f):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(f)}__getCursorBoundariesOffsets(f){let ze=0,Ke=0;const{charIndex:Qe,lineIndex:Pi}=this.get2DCursorLocation(f);for(let hn=0;hn<Pi;hn++)ze+=this.getHeightOfLine(hn);const nn=this._getLineLeftOffset(Pi),ln=this.__charBounds[Pi][Qe];ln&&(Ke=ln.left),this.charSpacing!==0&&Qe===this._textLines[Pi].length&&(Ke-=this._getWidthOfCharSpacing());const cn={top:ze,left:nn+(Ke>0?Ke:0)};return this.direction==="rtl"&&(this.textAlign===A||this.textAlign===po||this.textAlign===vo?cn.left*=-1:this.textAlign===M$1||this.textAlign===mo?cn.left=nn-(Ke>0?Ke:0):this.textAlign!==D$1&&this.textAlign!==yo||(cn.left=nn-(Ke>0?Ke:0))),cn}renderCursorAt(f){this._renderCursor(this.canvas.contextTop,this._getCursorBoundaries(f,!0),f)}renderCursor(f,ze){this._renderCursor(f,ze,this.selectionStart)}getCursorRenderingData(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this._getCursorBoundaries(f);const Ke=this.get2DCursorLocation(f),Qe=Ke.lineIndex,Pi=Ke.charIndex>0?Ke.charIndex-1:0,nn=this.getValueOfPropertyAt(Qe,Pi,"fontSize"),ln=this.getObjectScaling().x*this.canvas.getZoom(),cn=this.cursorWidth/ln,hn=this.getValueOfPropertyAt(Qe,Pi,"deltaY"),un=ze.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(Qe)/this.lineHeight-nn*(1-this._fontSizeFraction);return{color:this.cursorColor||this.getValueOfPropertyAt(Qe,Pi,"fill"),opacity:this._currentCursorOpacity,left:ze.left+ze.leftOffset-cn/2,top:un+ze.top+hn,width:cn,height:nn}}_renderCursor(f,ze,Ke){const{color:Qe,opacity:Pi,left:nn,top:ln,width:cn,height:hn}=this.getCursorRenderingData(Ke,ze);f.fillStyle=Qe,f.globalAlpha=Pi,f.fillRect(nn,ln,cn,hn)}renderSelection(f,ze){const Ke={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(f,Ke,ze)}renderDragSourceEffect(){const f=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,f,this._getCursorBoundaries(f.selectionStart,!0))}renderDropTargetEffect(f){const ze=this.getSelectionStartFromPointer(f);this.renderCursorAt(ze)}_renderSelection(f,ze,Ke){const Qe=ze.selectionStart,Pi=ze.selectionEnd,nn=this.textAlign.includes(po),ln=this.get2DCursorLocation(Qe),cn=this.get2DCursorLocation(Pi),hn=ln.lineIndex,un=cn.lineIndex,xs=ln.charIndex<0?0:ln.charIndex,zn=cn.charIndex<0?0:cn.charIndex;for(let Xn=hn;Xn<=un;Xn++){const ys=this._getLineLeftOffset(Xn)||0;let Jo=this.getHeightOfLine(Xn),ea=0,ra=0,na=0;if(Xn===hn&&(ra=this.__charBounds[hn][xs].left),Xn>=hn&&Xn<un)na=nn&&!this.isEndOfWrapping(Xn)?this.width:this.getLineWidth(Xn)||5;else if(Xn===un)if(zn===0)na=this.__charBounds[un][zn].left;else{const pa=this._getWidthOfCharSpacing();na=this.__charBounds[un][zn-1].left+this.__charBounds[un][zn-1].width-pa}ea=Jo,(this.lineHeight<1||Xn===un&&this.lineHeight>1)&&(Jo/=this.lineHeight);let ta=Ke.left+ys+ra,ia=Jo,sa=0;const Ma=na-ra;this.inCompositionMode?(f.fillStyle=this.compositionColor||"black",ia=1,sa=Jo):f.fillStyle=this.selectionColor,this.direction==="rtl"&&(this.textAlign===A||this.textAlign===po||this.textAlign===vo?ta=this.width-ta-Ma:this.textAlign===M$1||this.textAlign===mo?ta=Ke.left+ys-na:this.textAlign!==D$1&&this.textAlign!==yo||(ta=Ke.left+ys-na)),f.fillRect(ta,Ke.top+Ke.topOffset+sa,Ma,ia),Ke.topOffset+=ea}}getCurrentCharFontSize(){const f=this._getCurrentCharIndex();return this.getValueOfPropertyAt(f.l,f.c,"fontSize")}getCurrentCharColor(){const f=this._getCurrentCharIndex();return this.getValueOfPropertyAt(f.l,f.c,K$1)}_getCurrentCharIndex(){const f=this.get2DCursorLocation(this.selectionStart,!0),ze=f.charIndex>0?f.charIndex-1:0;return{l:f.lineIndex,c:ze}}dispose(){this.exitEditingImpl(),this.draggableTextDelegate.dispose(),super.dispose()}}t(Xo,"ownDefaults",Bo),t(Xo,"type","IText"),tt.setClass(Xo),tt.setClass(Xo,"i-text");class Yo extends Xo{static getDefaults(){return s(s({},super.getDefaults()),Yo.ownDefaults)}constructor(f,ze){super(f,s(s({},Yo.ownDefaults),ze))}static createControls(){return{controls:mi()}}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(po)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(f){let ze=0,Ke=0,Qe=0;const Pi={};for(let nn=0;nn<f.graphemeLines.length;nn++)f.graphemeText[Qe]===`
`&&nn>0?(Ke=0,Qe++,ze++):!this.splitByGrapheme&&this._reSpaceAndTab.test(f.graphemeText[Qe])&&nn>0&&(Ke++,Qe++),Pi[nn]={line:ze,offset:Ke},Qe+=f.graphemeLines[nn].length,Ke+=f.graphemeLines[nn].length;return Pi}styleHas(f,ze){if(this._styleMap&&!this.isWrapping){const Ke=this._styleMap[ze];Ke&&(ze=Ke.line)}return super.styleHas(f,ze)}isEmptyStyles(f){if(!this.styles)return!0;let ze,Ke=0,Qe=f+1,Pi=!1;const nn=this._styleMap[f],ln=this._styleMap[f+1];nn&&(f=nn.line,Ke=nn.offset),ln&&(Qe=ln.line,Pi=Qe===f,ze=ln.offset);const cn=f===void 0?this.styles:{line:this.styles[f]};for(const hn in cn)for(const un in cn[hn]){const xs=parseInt(un,10);if(xs>=Ke&&(!Pi||xs<ze))for(const zn in cn[hn][un])return!1}return!0}_getStyleDeclaration(f,ze){if(this._styleMap&&!this.isWrapping){const Ke=this._styleMap[f];if(!Ke)return{};f=Ke.line,ze=Ke.offset+ze}return super._getStyleDeclaration(f,ze)}_setStyleDeclaration(f,ze,Ke){const Qe=this._styleMap[f];super._setStyleDeclaration(Qe.line,Qe.offset+ze,Ke)}_deleteStyleDeclaration(f,ze){const Ke=this._styleMap[f];super._deleteStyleDeclaration(Ke.line,Ke.offset+ze)}_getLineStyle(f){const ze=this._styleMap[f];return!!this.styles[ze.line]}_setLineStyle(f){const ze=this._styleMap[f];super._setLineStyle(ze.line)}_wrapText(f,ze){this.isWrapping=!0;const Ke=this.getGraphemeDataForRender(f),Qe=[];for(let Pi=0;Pi<Ke.wordsData.length;Pi++)Qe.push(...this._wrapLine(Pi,ze,Ke));return this.isWrapping=!1,Qe}getGraphemeDataForRender(f){const ze=this.splitByGrapheme,Ke=ze?"":" ";let Qe=0;return{wordsData:f.map((Pi,nn)=>{let ln=0;const cn=ze?this.graphemeSplit(Pi):this.wordSplit(Pi);return cn.length===0?[{word:[],width:0}]:cn.map(hn=>{const un=ze?[hn]:this.graphemeSplit(hn),xs=this._measureWord(un,nn,ln);return Qe=Math.max(xs,Qe),ln+=un.length+Ke.length,{word:un,width:xs}})}),largestWordWidth:Qe}}_measureWord(f,ze){let Ke,Qe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,Pi=0;for(let nn=0,ln=f.length;nn<ln;nn++)Pi+=this._getGraphemeBox(f[nn],ze,nn+Qe,Ke,!0).kernedWidth,Ke=f[nn];return Pi}wordSplit(f){return f.split(this._wordJoiners)}_wrapLine(f,ze,Ke){let{largestWordWidth:Qe,wordsData:Pi}=Ke,nn=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const ln=this._getWidthOfCharSpacing(),cn=this.splitByGrapheme,hn=[],un=cn?"":" ";let xs=0,zn=[],Xn=0,ys=0,Jo=!0;ze-=nn;const ea=Math.max(ze,Qe,this.dynamicMinWidth),ra=Pi[f];let na;for(Xn=0,na=0;na<ra.length;na++){const{word:ta,width:ia}=ra[na];Xn+=ta.length,xs+=ys+ia-ln,xs>ea&&!Jo?(hn.push(zn),zn=[],xs=ia,Jo=!0):xs+=ln,Jo||cn||zn.push(un),zn=zn.concat(ta),ys=cn?0:this._measureWord([un],f,Xn),Xn++,Jo=!1}return na&&hn.push(zn),Qe+nn>this.dynamicMinWidth&&(this.dynamicMinWidth=Qe-ln+nn),hn}isEndOfWrapping(f){return!this._styleMap[f+1]||this._styleMap[f+1].line!==this._styleMap[f].line}missingNewlineOffset(f,ze){return this.splitByGrapheme&&!ze?this.isEndOfWrapping(f)?1:0:1}_splitTextIntoLines(f){const ze=super._splitTextIntoLines(f),Ke=this._wrapText(ze.lines,this.width),Qe=new Array(Ke.length);for(let Pi=0;Pi<Ke.length;Pi++)Qe[Pi]=Ke[Pi].join("");return ze.lines=Qe,ze.graphemeLines=Ke,ze}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){const f=new Map;for(const ze in this._styleMap){const Ke=parseInt(ze,10);if(this._textLines[Ke]){const Qe=this._styleMap[ze].line;f.set("".concat(Qe),!0)}}for(const ze in this.styles)f.has(ze)||delete this.styles[ze]}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...f])}}t(Yo,"type","Textbox"),t(Yo,"textLayoutProperties",[...Xo.textLayoutProperties,"width"]),t(Yo,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),tt.setClass(Yo);class Wo extends Cr{shouldPerformLayout(f){return!!f.target.clipPath&&super.shouldPerformLayout(f)}shouldLayoutClipPath(){return!1}calcLayoutResult(f,ze){const{target:Ke}=f,{clipPath:Qe,group:Pi}=Ke;if(!Qe||!this.shouldPerformLayout(f))return;const{width:nn,height:ln}=ae$1(xr(Ke,Qe)),cn=new ot$1(nn,ln);if(Qe.absolutePositioned)return{center:pe$1(Qe.getRelativeCenterPoint(),void 0,Pi?Pi.calcTransformMatrix():void 0),size:cn};{const hn=Qe.getRelativeCenterPoint().transform(Ke.calcOwnMatrix(),!0);if(this.shouldPerformLayout(f)){const{center:un=new ot$1,correction:xs=new ot$1}=this.calcBoundingBox(ze,f)||{};return{center:un.add(hn),correction:xs.subtract(hn),size:cn}}return{center:Ke.getRelativeCenterPoint().add(hn),size:cn}}}}t(Wo,"type","clip-path"),tt.setClass(Wo);class Vo extends Cr{getInitialSize(f,ze){let{target:Ke}=f,{size:Qe}=ze;return new ot$1(Ke.width||Qe.x,Ke.height||Qe.y)}}t(Vo,"type","fixed"),tt.setClass(Vo);class zo extends Or{subscribeTargets(f){const ze=f.target;f.targets.reduce((Ke,Qe)=>(Qe.parent&&Ke.add(Qe.parent),Ke),new Set).forEach(Ke=>{Ke.layoutManager.subscribeTargets({target:Ke,targets:[ze]})})}unsubscribeTargets(f){const ze=f.target,Ke=ze.getObjects();f.targets.reduce((Qe,Pi)=>(Pi.parent&&Qe.add(Pi.parent),Qe),new Set).forEach(Qe=>{!Ke.some(Pi=>Pi.parent===Qe)&&Qe.layoutManager.unsubscribeTargets({target:Qe,targets:[ze]})})}}class Go extends Mr{static getDefaults(){return s(s({},super.getDefaults()),Go.ownDefaults)}constructor(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,Go.ownDefaults),this.setOptions(ze);const{left:Ke,top:Qe,layoutManager:Pi}=ze;this.groupInit(f,{left:Ke,top:Qe,layoutManager:Pi??new zo})}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var f=arguments.length,ze=new Array(f),Ke=0;Ke<f;Ke++)ze[Ke]=arguments[Ke];this.multiSelectionStacking==="selection-order"?this.add(...ze):ze.forEach(Qe=>{const Pi=this._objects.findIndex(ln=>ln.isInFrontOf(Qe)),nn=Pi===-1?this.size():Pi;this.insertAt(nn,Qe)})}canEnterGroup(f){return this.getObjects().some(ze=>ze.isDescendantOf(f)||f.isDescendantOf(ze))?(a("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(f)}enterGroup(f,ze){f.parent&&f.parent===f.group?f.parent._exitGroup(f):f.group&&f.parent!==f.group&&f.group.remove(f),this._enterGroup(f,ze)}exitGroup(f,ze){this._exitGroup(f,ze),f.parent&&f.parent._enterGroup(f,!0)}_onAfterObjectsChange(f,ze){super._onAfterObjectsChange(f,ze);const Ke=new Set;ze.forEach(Qe=>{const{parent:Pi}=Qe;Pi&&Ke.add(Pi)}),f===yr?Ke.forEach(Qe=>{Qe._onAfterObjectsChange(vr,ze)}):Ke.forEach(Qe=>{Qe._set("dirty",!0)})}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(f,ze,Ke){f.save(),f.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;const Qe=s(s({hasControls:!1},Ke),{},{forActiveSelection:!0});for(let Pi=0;Pi<this._objects.length;Pi++)this._objects[Pi]._renderControls(f,Qe);super._renderControls(f,ze),f.restore()}}t(Go,"type","ActiveSelection"),t(Go,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),tt.setClass(Go),tt.setClass(Go,"activeSelection");class Ho{constructor(){t(this,"resources",{})}applyFilters(f,ze,Ke,Qe,Pi){const nn=Pi.getContext("2d");if(!nn)return;nn.drawImage(ze,0,0,Ke,Qe);const ln={sourceWidth:Ke,sourceHeight:Qe,imageData:nn.getImageData(0,0,Ke,Qe),originalEl:ze,originalImageData:nn.getImageData(0,0,Ke,Qe),canvasEl:Pi,ctx:nn,filterBackend:this};f.forEach(hn=>{hn.applyTo(ln)});const{imageData:cn}=ln;return cn.width===Ke&&cn.height===Qe||(Pi.width=cn.width,Pi.height=cn.height),nn.putImageData(cn,0,0),ln}}class No{constructor(){let{tileSize:f=o.textureSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};t(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),t(this,"resources",{}),this.tileSize=f,this.setupGLContext(f,f),this.captureGPUInfo()}setupGLContext(f,ze){this.dispose(),this.createWebGLCanvas(f,ze)}createWebGLCanvas(f,ze){const Ke=vt$1({width:f,height:ze}),Qe=Ke.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});Qe&&(Qe.clearColor(0,0,0,0),this.canvas=Ke,this.gl=Qe)}applyFilters(f,ze,Ke,Qe,Pi,nn){const ln=this.gl,cn=Pi.getContext("2d");if(!ln||!cn)return;let hn;nn&&(hn=this.getCachedTexture(nn,ze));const un={originalWidth:ze.width||ze.naturalWidth||0,originalHeight:ze.height||ze.naturalHeight||0,sourceWidth:Ke,sourceHeight:Qe,destinationWidth:Ke,destinationHeight:Qe,context:ln,sourceTexture:this.createTexture(ln,Ke,Qe,hn?void 0:ze),targetTexture:this.createTexture(ln,Ke,Qe),originalTexture:hn||this.createTexture(ln,Ke,Qe,hn?void 0:ze),passes:f.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:Pi},xs=ln.createFramebuffer();return ln.bindFramebuffer(ln.FRAMEBUFFER,xs),f.forEach(zn=>{zn&&zn.applyTo(un)}),function(zn){const Xn=zn.targetCanvas,ys=Xn.width,Jo=Xn.height,ea=zn.destinationWidth,ra=zn.destinationHeight;ys===ea&&Jo===ra||(Xn.width=ea,Xn.height=ra)}(un),this.copyGLTo2D(ln,un),ln.bindTexture(ln.TEXTURE_2D,null),ln.deleteTexture(un.sourceTexture),ln.deleteTexture(un.targetTexture),ln.deleteFramebuffer(xs),cn.setTransform(1,0,0,1,0,0),un}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(f,ze,Ke,Qe,Pi){const{NEAREST:nn,TEXTURE_2D:ln,RGBA:cn,UNSIGNED_BYTE:hn,CLAMP_TO_EDGE:un,TEXTURE_MAG_FILTER:xs,TEXTURE_MIN_FILTER:zn,TEXTURE_WRAP_S:Xn,TEXTURE_WRAP_T:ys}=f,Jo=f.createTexture();return f.bindTexture(ln,Jo),f.texParameteri(ln,xs,Pi||nn),f.texParameteri(ln,zn,Pi||nn),f.texParameteri(ln,Xn,un),f.texParameteri(ln,ys,un),Qe?f.texImage2D(ln,0,cn,cn,hn,Qe):f.texImage2D(ln,0,cn,ze,Ke,0,cn,hn,null),Jo}getCachedTexture(f,ze,Ke){const{textureCache:Qe}=this;if(Qe[f])return Qe[f];{const Pi=this.createTexture(this.gl,ze.width,ze.height,ze,Ke);return Pi&&(Qe[f]=Pi),Pi}}evictCachesForKey(f){this.textureCache[f]&&(this.gl.deleteTexture(this.textureCache[f]),delete this.textureCache[f])}copyGLTo2D(f,ze){const Ke=f.canvas,Qe=ze.targetCanvas,Pi=Qe.getContext("2d");if(!Pi)return;Pi.translate(0,Qe.height),Pi.scale(1,-1);const nn=Ke.height-Qe.height;Pi.drawImage(Ke,0,nn,Qe.width,Qe.height,0,0,Qe.width,Qe.height)}copyGLTo2DPutImageData(f,ze){const Ke=ze.targetCanvas.getContext("2d"),Qe=ze.destinationWidth,Pi=ze.destinationHeight,nn=Qe*Pi*4;if(!Ke)return;const ln=new Uint8Array(this.imageBuffer,0,nn),cn=new Uint8ClampedArray(this.imageBuffer,0,nn);f.readPixels(0,0,Qe,Pi,f.RGBA,f.UNSIGNED_BYTE,ln);const hn=new ImageData(cn,Qe,Pi);Ke.putImageData(hn,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;const f=this.gl,ze={renderer:"",vendor:""};if(!f)return ze;const Ke=f.getExtension("WEBGL_debug_renderer_info");if(Ke){const Qe=f.getParameter(Ke.UNMASKED_RENDERER_WEBGL),Pi=f.getParameter(Ke.UNMASKED_VENDOR_WEBGL);Qe&&(ze.renderer=Qe.toLowerCase()),Pi&&(ze.vendor=Pi.toLowerCase())}return this.gpuInfo=ze,ze}}let Uo;function qo(){const{WebGLProbe:qe}=p$1();return qe.queryWebGL(pt$1()),o.enableGLFiltering&&qe.isSupported(o.textureSize)?new No({tileSize:o.textureSize}):new Ho}function Ko(){return!Uo&&(!(arguments.length>0&&arguments[0]!==void 0)||arguments[0])&&(Uo=qo()),Uo}const Qo=["filters","resizeFilter","src","crossOrigin","type"],Zo=["cropX","cropY"];class $o extends _i{static getDefaults(){return s(s({},super.getDefaults()),$o.ownDefaults)}constructor(f,ze){super(),t(this,"_lastScaleX",1),t(this,"_lastScaleY",1),t(this,"_filterScalingX",1),t(this,"_filterScalingY",1),this.filters=[],Object.assign(this,$o.ownDefaults),this.setOptions(ze),this.cacheKey="texture".concat(ft$1()),this.setElement(typeof f=="string"?(this.canvas&&Kt$1(this.canvas.getElement())||m()).getElementById(f):f,ze)}getElement(){return this._element}setElement(f){var ze;let Ke=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=f,this._originalElement=f,this._setWidthHeight(Ke),(ze=f.classList)===null||ze===void 0||ze.add($o.CSS_CANVAS),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(f){const ze=Ko(!1);ze instanceof No&&ze.evictCachesForKey(f)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(f=>{const ze=this[f];ze&&p$1().dispose(ze),this[f]=void 0})}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){const f=this.getElement();return f?{width:f.naturalWidth||f.width,height:f.naturalHeight||f.height}:{width:0,height:0}}_stroke(f){if(!this.stroke||this.strokeWidth===0)return;const ze=this.width/2,Ke=this.height/2;f.beginPath(),f.moveTo(-ze,-Ke),f.lineTo(ze,-Ke),f.lineTo(ze,Ke),f.lineTo(-ze,Ke),f.lineTo(-ze,-Ke),f.closePath()}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const ze=[];return this.filters.forEach(Ke=>{Ke&&ze.push(Ke.toObject())}),s(s({},super.toObject([...Zo,...f])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:ze},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){const f=[],ze=this._element,Ke=-this.width/2,Qe=-this.height/2;let Pi=[],nn=[],ln="",cn="";if(!ze)return[];if(this.hasCrop()){const hn=ft$1();Pi.push('<clipPath id="imageCrop_'+hn+`">
`,'	<rect x="'+Ke+'" y="'+Qe+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),ln=' clip-path="url(#imageCrop_'+hn+')" '}if(this.imageSmoothing||(cn=' image-rendering="optimizeSpeed"'),f.push("	<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(Ke-this.cropX,'" y="').concat(Qe-this.cropY,'" width="').concat(ze.width||ze.naturalWidth,'" height="').concat(ze.height||ze.naturalHeight,'"').concat(cn).concat(ln,`></image>
`)),this.stroke||this.strokeDashArray){const hn=this.fill;this.fill=null,nn=['	<rect x="'.concat(Ke,'" y="').concat(Qe,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),`" />
`)],this.fill=hn}return Pi=this.paintFirst!==K$1?Pi.concat(nn,f):Pi.concat(f,nn),Pi}getSrc(f){const ze=f?this._element:this._originalElement;return ze?ze.toDataURL?ze.toDataURL():this.srcFromAttribute?ze.getAttribute("src")||"":ze.src:this.src||""}getSvgSrc(f){return this.getSrc(f)}setSrc(f){let{crossOrigin:ze,signal:Ke}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return It$1(f,{crossOrigin:ze,signal:Ke}).then(Qe=>{ze!==void 0&&this.set({crossOrigin:ze}),this.setElement(Qe)})}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){const f=this.resizeFilter,ze=this.minimumScaleTrigger,Ke=this.getTotalObjectScaling(),Qe=Ke.x,Pi=Ke.y,nn=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!f||Qe>ze&&Pi>ze)return this._element=nn,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=Qe,void(this._lastScaleY=Pi);const ln=vt$1(nn),{width:cn,height:hn}=nn;this._element=ln,this._lastScaleX=f.scaleX=Qe,this._lastScaleY=f.scaleY=Pi,Ko().applyFilters([f],nn,cn,hn,this._element),this._filterScalingX=ln.width/this._originalElement.width,this._filterScalingY=ln.height/this._originalElement.height}applyFilters(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.filters||[];if(f=f.filter(Pi=>Pi&&!Pi.isNeutralState()),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),f.length===0)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);const ze=this._originalElement,Ke=ze.naturalWidth||ze.width,Qe=ze.naturalHeight||ze.height;if(this._element===this._originalElement){const Pi=vt$1({width:Ke,height:Qe});this._element=Pi,this._filteredEl=Pi}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,Ke,Qe),this._lastScaleX=1,this._lastScaleY=1);Ko().applyFilters(f,this._originalElement,Ke,Qe,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(f){f.imageSmoothingEnabled=this.imageSmoothing,this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(f),this._renderPaintInOrder(f)}drawCacheOnCanvas(f){f.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(f)}shouldCache(){return this.needsItsOwnCache()}_renderFill(f){const ze=this._element;if(!ze)return;const Ke=this._filterScalingX,Qe=this._filterScalingY,Pi=this.width,nn=this.height,ln=Math.max(this.cropX,0),cn=Math.max(this.cropY,0),hn=ze.naturalWidth||ze.width,un=ze.naturalHeight||ze.height,xs=ln*Ke,zn=cn*Qe,Xn=Math.min(Pi*Ke,hn-xs),ys=Math.min(nn*Qe,un-zn),Jo=-Pi/2,ea=-nn/2,ra=Math.min(Pi,hn/Ke-ln),na=Math.min(nn,un/Qe-cn);ze&&f.drawImage(ze,xs,zn,Xn,ys,Jo,ea,ra,na)}_needsResize(){const f=this.getTotalObjectScaling();return f.x!==this._lastScaleX||f.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:f,height:ze}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const Ke=this.getOriginalSize();this.width=f||Ke.width,this.height=ze||Ke.height}parsePreserveAspectRatioAttribute(){const f=Ie$1(this.preserveAspectRatio||""),ze=this.width,Ke=this.height,Qe={width:ze,height:Ke};let Pi,nn=this._element.width,ln=this._element.height,cn=1,hn=1,un=0,xs=0,zn=0,Xn=0;return!f||f.alignX===j$1&&f.alignY===j$1?(cn=ze/nn,hn=Ke/ln):(f.meetOrSlice==="meet"&&(cn=hn=Pr(this._element,Qe),Pi=(ze-nn*cn)/2,f.alignX==="Min"&&(un=-Pi),f.alignX==="Max"&&(un=Pi),Pi=(Ke-ln*hn)/2,f.alignY==="Min"&&(xs=-Pi),f.alignY==="Max"&&(xs=Pi)),f.meetOrSlice==="slice"&&(cn=hn=Er(this._element,Qe),Pi=nn-ze/cn,f.alignX==="Mid"&&(zn=Pi/2),f.alignX==="Max"&&(zn=Pi),Pi=ln-Ke/hn,f.alignY==="Mid"&&(Xn=Pi/2),f.alignY==="Max"&&(Xn=Pi),nn=ze/cn,ln=Ke/hn)),{width:nn,height:ln,scaleX:cn,scaleY:hn,offsetLeft:un,offsetTop:xs,cropX:zn,cropY:Xn}}static fromObject(f,ze){let{filters:Ke,resizeFilter:Qe,src:Pi,crossOrigin:nn,type:ln}=f,cn=i(f,Qo);return Promise.all([It$1(Pi,s(s({},ze),{},{crossOrigin:nn})),Ke&&Bt$1(Ke,ze),Qe&&Bt$1([Qe],ze),Xt$1(cn,ze)]).then(hn=>{let[un,xs=[],[zn]=[],Xn={}]=hn;return new this(un,s(s({},cn),{},{src:Pi,filters:xs,resizeFilter:zn},Xn))})}static fromURL(f){let{crossOrigin:ze=null,signal:Ke}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Qe=arguments.length>2?arguments[2]:void 0;return It$1(f,{crossOrigin:ze,signal:Ke}).then(Pi=>new this(Pi,Qe))}static async fromElement(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ke=arguments.length>2?arguments[2]:void 0;const Qe=dr(f,this.ATTRIBUTE_NAMES,Ke);return this.fromURL(Qe["xlink:href"]||Qe.href,ze,Qe).catch(Pi=>(a("log","Unable to parse Image",Pi),null))}}t($o,"type","Image"),t($o,"cacheProperties",[...ps,...Zo]),t($o,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),t($o,"CSS_CANVAS","canvas-img"),t($o,"ATTRIBUTE_NAMES",[...Fi,"x","y","width","height","preserveAspectRatio","xlink:href","href","crossOrigin","image-rendering"]),tt.setClass($o),tt.setSVGClass($o);Ye(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);const ma=W$1,va=qe=>function(f,ze,Ke){const{points:Qe,pathOffset:Pi}=Ke;return new ot$1(Qe[qe]).subtract(Pi).transform(Tt$1(Ke.getViewportTransform(),Ke.calcTransformMatrix()))},ya=(qe,f,ze,Ke)=>{const{target:Qe,pointIndex:Pi}=f,nn=Qe,ln=pe$1(new ot$1(ze,Ke),void 0,nn.calcOwnMatrix());return nn.points[Pi]=ln.add(nn.pathOffset),nn.setDimensions(),!0},_a=(qe,f)=>function(ze,Ke,Qe,Pi){const nn=Ke.target,ln=new ot$1(nn.points[(qe>0?qe:nn.points.length)-1]),cn=ln.subtract(nn.pathOffset).transform(nn.calcOwnMatrix()),hn=f(ze,s(s({},Ke),{},{pointIndex:qe}),Qe,Pi),un=ln.subtract(nn.pathOffset).transform(nn.calcOwnMatrix()).subtract(cn);return nn.left-=un.x,nn.top-=un.y,hn},xa=qe=>Ys(ma,_a(qe,ya)),Ca=(qe,f,ze)=>{const{path:Ke,pathOffset:Qe}=qe,Pi=Ke[f];return new ot$1(Pi[ze]-Qe.x,Pi[ze+1]-Qe.y).transform(Tt$1(qe.getViewportTransform(),qe.calcTransformMatrix()))};function ba(qe,f,ze){const{commandIndex:Ke,pointIndex:Qe}=this;return Ca(ze,Ke,Qe)}function wa(qe,f,ze,Ke){const{target:Qe}=f,{commandIndex:Pi,pointIndex:nn}=this,ln=((cn,hn,un,xs,zn)=>{const{path:Xn,pathOffset:ys}=cn,Jo=Xn[(xs>0?xs:Xn.length)-1],ea=new ot$1(Jo[zn],Jo[zn+1]),ra=ea.subtract(ys).transform(cn.calcOwnMatrix()),na=pe$1(new ot$1(hn,un),void 0,cn.calcOwnMatrix());Xn[xs][zn]=na.x+ys.x,Xn[xs][zn+1]=na.y+ys.y,cn.setDimensions();const ta=ea.subtract(cn.pathOffset).transform(cn.calcOwnMatrix()).subtract(ra);return cn.left-=ta.x,cn.top-=ta.y,cn.set("dirty",!0),!0})(Qe,ze,Ke,Pi,nn);return ye$1(this.actionName,s(s({},Te$1(qe,f,ze,Ke)),{},{commandIndex:Pi,pointIndex:nn})),ln}class Sa extends Hs{constructor(f){super(f)}render(f,ze,Ke,Qe,Pi){const nn=s(s({},Qe),{},{cornerColor:this.controlFill,cornerStrokeColor:this.controlStroke,transparentCorners:!this.controlFill});super.render(f,ze,Ke,nn,Pi)}}class Ta extends Sa{constructor(f){super(f)}render(f,ze,Ke,Qe,Pi){const{path:nn}=Pi,{commandIndex:ln,pointIndex:cn,connectToCommandIndex:hn,connectToPointIndex:un}=this;f.save(),f.strokeStyle=this.controlStroke,this.connectionDashArray&&f.setLineDash(this.connectionDashArray);const[xs]=nn[ln],zn=Ca(Pi,hn,un);if(xs==="Q"){const Xn=Ca(Pi,ln,cn+2);f.moveTo(Xn.x,Xn.y),f.lineTo(ze,Ke)}else f.moveTo(ze,Ke);f.lineTo(zn.x,zn.y),f.stroke(),f.restore(),super.render(f,ze,Ke,Qe,Pi)}}const Oa=(qe,f,ze,Ke,Qe,Pi)=>new(ze?Ta:Sa)(s(s({commandIndex:qe,pointIndex:f,actionName:"modifyPath",positionHandler:ba,actionHandler:wa,connectToCommandIndex:Qe,connectToPointIndex:Pi},Ke),ze?Ke.controlPointStyle:Ke.pointStyle));var ka=Object.freeze({__proto__:null,changeWidth:Vs,createObjectDefaultControls:fi,createPathControls:function(qe){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const ze={};let Ke="M";return qe.path.forEach((Qe,Pi)=>{const nn=Qe[0];switch(nn!=="Z"&&(ze["c_".concat(Pi,"_").concat(nn)]=Oa(Pi,Qe.length-2,!1,f)),nn){case"C":ze["c_".concat(Pi,"_C_CP_1")]=Oa(Pi,1,!0,f,Pi-1,(ln=>ln==="C"?5:ln==="Q"?3:1)(Ke)),ze["c_".concat(Pi,"_C_CP_2")]=Oa(Pi,3,!0,f,Pi,5);break;case"Q":ze["c_".concat(Pi,"_Q_CP_1")]=Oa(Pi,1,!0,f,Pi,3)}Ke=nn}),ze},createPolyActionHandler:xa,createPolyControls:function(qe){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const ze={};for(let Ke=0;Ke<(typeof qe=="number"?qe:qe.points.length);Ke++)ze["p".concat(Ke)]=new Hs(s({actionName:ma,positionHandler:va(Ke),actionHandler:xa(Ke)},f));return ze},createPolyPositionHandler:va,createResizeControls:pi,createTextboxDefaultControls:mi,dragHandler:De$1,factoryPolyActionHandler:_a,getLocalPoint:ke$1,polyActionHandler:ya,renderCircleControl:zs,renderSquareControl:Gs,rotationStyleHandler:Ns,rotationWithSnapping:Us,scaleCursorStyleHandler:Qs,scaleOrSkewActionName:li$1,scaleSkewCursorStyleHandler:ui,scalingEqually:$s,scalingX:ti,scalingXOrSkewingY:di,scalingY:ei,scalingYOrSkewingX:gi,skewCursorStyleHandler:ni,skewHandlerX:ai,skewHandlerY:hi,wrapWithFireEvent:Ys,wrapWithFixedAnchor:Ws});const Da=qe=>qe.webgl!==void 0,Pa="precision highp float",Ea=`
    `.concat(Pa,`;
    varying vec2 vTexCoord;
    uniform sampler2D uTexture;
    void main() {
      gl_FragColor = texture2D(uTexture, vTexCoord);
    }`),Aa=["type"],ja=["type"],Fa=new RegExp(Pa,"g");class La{get type(){return this.constructor.type}constructor(){let f=i(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Aa);Object.assign(this,this.constructor.defaults,f)}getFragmentSource(){return Ea}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    void main() {
      vTexCoord = aPosition;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }`}createProgram(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getFragmentSource(),Ke=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.getVertexSource();const{WebGLProbe:{GLPrecision:Qe="highp"}}=p$1();Qe!=="highp"&&(ze=ze.replace(Fa,Pa.replace("highp",Qe)));const Pi=f.createShader(f.VERTEX_SHADER),nn=f.createShader(f.FRAGMENT_SHADER),ln=f.createProgram();if(!Pi||!nn||!ln)throw new h("Vertex, fragment shader or program creation error");if(f.shaderSource(Pi,Ke),f.compileShader(Pi),!f.getShaderParameter(Pi,f.COMPILE_STATUS))throw new h("Vertex shader compile error for ".concat(this.type,": ").concat(f.getShaderInfoLog(Pi)));if(f.shaderSource(nn,ze),f.compileShader(nn),!f.getShaderParameter(nn,f.COMPILE_STATUS))throw new h("Fragment shader compile error for ".concat(this.type,": ").concat(f.getShaderInfoLog(nn)));if(f.attachShader(ln,Pi),f.attachShader(ln,nn),f.linkProgram(ln),!f.getProgramParameter(ln,f.LINK_STATUS))throw new h('Shader link error for "'.concat(this.type,'" ').concat(f.getProgramInfoLog(ln)));const cn=this.getUniformLocations(f,ln)||{};return cn.uStepW=f.getUniformLocation(ln,"uStepW"),cn.uStepH=f.getUniformLocation(ln,"uStepH"),{program:ln,attributeLocations:this.getAttributeLocations(f,ln),uniformLocations:cn}}getAttributeLocations(f,ze){return{aPosition:f.getAttribLocation(ze,"aPosition")}}getUniformLocations(f,ze){const Ke=this.constructor.uniformLocations,Qe={};for(let Pi=0;Pi<Ke.length;Pi++)Qe[Ke[Pi]]=f.getUniformLocation(ze,Ke[Pi]);return Qe}sendAttributeData(f,ze,Ke){const Qe=ze.aPosition,Pi=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,Pi),f.enableVertexAttribArray(Qe),f.vertexAttribPointer(Qe,2,f.FLOAT,!1,0,0),f.bufferData(f.ARRAY_BUFFER,Ke,f.STATIC_DRAW)}_setupFrameBuffer(f){const ze=f.context;if(f.passes>1){const Ke=f.destinationWidth,Qe=f.destinationHeight;f.sourceWidth===Ke&&f.sourceHeight===Qe||(ze.deleteTexture(f.targetTexture),f.targetTexture=f.filterBackend.createTexture(ze,Ke,Qe)),ze.framebufferTexture2D(ze.FRAMEBUFFER,ze.COLOR_ATTACHMENT0,ze.TEXTURE_2D,f.targetTexture,0)}else ze.bindFramebuffer(ze.FRAMEBUFFER,null),ze.finish()}_swapTextures(f){f.passes--,f.pass++;const ze=f.targetTexture;f.targetTexture=f.sourceTexture,f.sourceTexture=ze}isNeutralState(f){return!1}applyTo(f){Da(f)?(this._setupFrameBuffer(f),this.applyToWebGL(f),this._swapTextures(f)):this.applyTo2d(f)}applyTo2d(f){}getCacheKey(){return this.type}retrieveShader(f){const ze=this.getCacheKey();return f.programCache[ze]||(f.programCache[ze]=this.createProgram(f.context)),f.programCache[ze]}applyToWebGL(f){const ze=f.context,Ke=this.retrieveShader(f);f.pass===0&&f.originalTexture?ze.bindTexture(ze.TEXTURE_2D,f.originalTexture):ze.bindTexture(ze.TEXTURE_2D,f.sourceTexture),ze.useProgram(Ke.program),this.sendAttributeData(ze,Ke.attributeLocations,f.aPosition),ze.uniform1f(Ke.uniformLocations.uStepW,1/f.sourceWidth),ze.uniform1f(Ke.uniformLocations.uStepH,1/f.sourceHeight),this.sendUniformData(ze,Ke.uniformLocations),ze.viewport(0,0,f.destinationWidth,f.destinationHeight),ze.drawArrays(ze.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(f,ze,Ke){f.activeTexture(Ke),f.bindTexture(f.TEXTURE_2D,ze),f.activeTexture(f.TEXTURE0)}unbindAdditionalTexture(f,ze){f.activeTexture(ze),f.bindTexture(f.TEXTURE_2D,null),f.activeTexture(f.TEXTURE0)}sendUniformData(f,ze){}createHelpLayer(f){if(!f.helpLayer){const{sourceWidth:ze,sourceHeight:Ke}=f,Qe=vt$1({width:ze,height:Ke});f.helpLayer=Qe}}toObject(){const f=Object.keys(this.constructor.defaults||{});return s({type:this.type},f.reduce((ze,Ke)=>(ze[Ke]=this[Ke],ze),{}))}toJSON(){return this.toObject()}static async fromObject(f,ze){return new this(i(f,ja))}}t(La,"type","BaseFilter"),t(La,"uniformLocations",[]);const Ra={multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,difference:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`
    if (uColor.r < 0.5) {
      gl_FragColor.r *= 2.0 * uColor.r;
    } else {
      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
    }
    if (uColor.g < 0.5) {
      gl_FragColor.g *= 2.0 * uColor.g;
    } else {
      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
    }
    if (uColor.b < 0.5) {
      gl_FragColor.b *= 2.0 * uColor.b;
    } else {
      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
    }
    `,tint:`
    gl_FragColor.rgb *= (1.0 - uColor.a);
    gl_FragColor.rgb += uColor.rgb;
    `};class Ia extends La{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec4 uColor;
      varying vec2 vTexCoord;
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        gl_FragColor = color;
        if (color.a > 0.0) {
          `.concat(Ra[this.mode],`
        }
      }
      `)}applyTo2d(f){let{imageData:{data:ze}}=f;const Ke=new Le$1(this.color).getSource(),Qe=this.alpha,Pi=Ke[0]*Qe,nn=Ke[1]*Qe,ln=Ke[2]*Qe,cn=1-Qe;for(let hn=0;hn<ze.length;hn+=4){const un=ze[hn],xs=ze[hn+1],zn=ze[hn+2];let Xn,ys,Jo;switch(this.mode){case"multiply":Xn=un*Pi/255,ys=xs*nn/255,Jo=zn*ln/255;break;case"screen":Xn=255-(255-un)*(255-Pi)/255,ys=255-(255-xs)*(255-nn)/255,Jo=255-(255-zn)*(255-ln)/255;break;case"add":Xn=un+Pi,ys=xs+nn,Jo=zn+ln;break;case"difference":Xn=Math.abs(un-Pi),ys=Math.abs(xs-nn),Jo=Math.abs(zn-ln);break;case"subtract":Xn=un-Pi,ys=xs-nn,Jo=zn-ln;break;case"darken":Xn=Math.min(un,Pi),ys=Math.min(xs,nn),Jo=Math.min(zn,ln);break;case"lighten":Xn=Math.max(un,Pi),ys=Math.max(xs,nn),Jo=Math.max(zn,ln);break;case"overlay":Xn=Pi<128?2*un*Pi/255:255-2*(255-un)*(255-Pi)/255,ys=nn<128?2*xs*nn/255:255-2*(255-xs)*(255-nn)/255,Jo=ln<128?2*zn*ln/255:255-2*(255-zn)*(255-ln)/255;break;case"exclusion":Xn=Pi+un-2*Pi*un/255,ys=nn+xs-2*nn*xs/255,Jo=ln+zn-2*ln*zn/255;break;case"tint":Xn=Pi+un*cn,ys=nn+xs*cn,Jo=ln+zn*cn}ze[hn]=Xn,ze[hn+1]=ys,ze[hn+2]=Jo}}sendUniformData(f,ze){const Ke=new Le$1(this.color).getSource();Ke[0]=this.alpha*Ke[0]/255,Ke[1]=this.alpha*Ke[1]/255,Ke[2]=this.alpha*Ke[2]/255,Ke[3]=this.alpha,f.uniform4fv(ze.uColor,Ke)}}t(Ia,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),t(Ia,"type","BlendColor"),t(Ia,"uniformLocations",["uColor"]),tt.setClass(Ia);const Ba={multiply:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.rgba *= color2.rgba;
      gl_FragColor = color;
    }
    `,mask:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.a = color2.a;
      gl_FragColor = color;
    }
    `},Xa=["type","image"];class Ya extends La{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return Ba[this.mode]}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    uniform mat3 uTransformMatrix;
    void main() {
      vTexCoord = aPosition;
      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }
    `}applyToWebGL(f){const ze=f.context,Ke=this.createTexture(f.filterBackend,this.image);this.bindAdditionalTexture(ze,Ke,ze.TEXTURE1),super.applyToWebGL(f),this.unbindAdditionalTexture(ze,ze.TEXTURE1)}createTexture(f,ze){return f.getCachedTexture(ze.cacheKey,ze.getElement())}calculateMatrix(){const f=this.image,{width:ze,height:Ke}=f.getElement();return[1/f.scaleX,0,0,0,1/f.scaleY,0,-f.left/ze,-f.top/Ke,1]}applyTo2d(f){let{imageData:{data:ze,width:Ke,height:Qe},filterBackend:{resources:Pi}}=f;const nn=this.image;Pi.blendImage||(Pi.blendImage=pt$1());const ln=Pi.blendImage,cn=ln.getContext("2d");ln.width!==Ke||ln.height!==Qe?(ln.width=Ke,ln.height=Qe):cn.clearRect(0,0,Ke,Qe),cn.setTransform(nn.scaleX,0,0,nn.scaleY,nn.left,nn.top),cn.drawImage(nn.getElement(),0,0,Ke,Qe);const hn=cn.getImageData(0,0,Ke,Qe).data;for(let un=0;un<ze.length;un+=4){const xs=ze[un],zn=ze[un+1],Xn=ze[un+2],ys=ze[un+3],Jo=hn[un],ea=hn[un+1],ra=hn[un+2],na=hn[un+3];switch(this.mode){case"multiply":ze[un]=xs*Jo/255,ze[un+1]=zn*ea/255,ze[un+2]=Xn*ra/255,ze[un+3]=ys*na/255;break;case"mask":ze[un+3]=na}}}sendUniformData(f,ze){const Ke=this.calculateMatrix();f.uniform1i(ze.uImage,1),f.uniformMatrix3fv(ze.uTransformMatrix,!1,Ke)}toObject(){return s(s({},super.toObject()),{},{image:this.image&&this.image.toObject()})}static async fromObject(f,ze){let{type:Ke,image:Qe}=f,Pi=i(f,Xa);return $o.fromObject(Qe,ze).then(nn=>new this(s(s({},Pi),{},{image:nn})))}}t(Ya,"type","BlendImage"),t(Ya,"defaults",{mode:"multiply",alpha:1}),t(Ya,"uniformLocations",["uTransformMatrix","uImage"]),tt.setClass(Ya);class Wa extends La{getFragmentSource(){return`
    precision highp float;
    uniform sampler2D uTexture;
    uniform vec2 uDelta;
    varying vec2 vTexCoord;
    const float nSamples = 15.0;
    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
    float random(vec3 scale) {
      /* use the fragment position for a different seed per-pixel */
      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
    }
    void main() {
      vec4 color = vec4(0.0);
      float total = 0.0;
      float offset = random(v3offset);
      for (float t = -nSamples; t <= nSamples; t++) {
        float percent = (t + offset - 0.5) / nSamples;
        float weight = 1.0 - abs(percent);
        color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
        total += weight;
      }
      gl_FragColor = color / total;
    }
  `}applyTo(f){Da(f)?(this.aspectRatio=f.sourceWidth/f.sourceHeight,f.passes++,this._setupFrameBuffer(f),this.horizontal=!0,this.applyToWebGL(f),this._swapTextures(f),this._setupFrameBuffer(f),this.horizontal=!1,this.applyToWebGL(f),this._swapTextures(f)):this.applyTo2d(f)}applyTo2d(f){f.imageData=this.simpleBlur(f)}simpleBlur(f){let{ctx:ze,imageData:Ke,filterBackend:{resources:Qe}}=f;const{width:Pi,height:nn}=Ke;Qe.blurLayer1||(Qe.blurLayer1=pt$1(),Qe.blurLayer2=pt$1());const ln=Qe.blurLayer1,cn=Qe.blurLayer2;ln.width===Pi&&ln.height===nn||(cn.width=ln.width=Pi,cn.height=ln.height=nn);const hn=ln.getContext("2d"),un=cn.getContext("2d"),xs=15,zn=.06*this.blur*.5;let Xn,ys,Jo,ea;for(hn.putImageData(Ke,0,0),un.clearRect(0,0,Pi,nn),ea=-15;ea<=xs;ea++)Xn=(Math.random()-.5)/4,ys=ea/xs,Jo=zn*ys*Pi+Xn,un.globalAlpha=1-Math.abs(ys),un.drawImage(ln,Jo,Xn),hn.drawImage(cn,0,0),un.globalAlpha=1,un.clearRect(0,0,cn.width,cn.height);for(ea=-15;ea<=xs;ea++)Xn=(Math.random()-.5)/4,ys=ea/xs,Jo=zn*ys*nn+Xn,un.globalAlpha=1-Math.abs(ys),un.drawImage(ln,Xn,Jo),hn.drawImage(cn,0,0),un.globalAlpha=1,un.clearRect(0,0,cn.width,cn.height);ze.drawImage(ln,0,0);const ra=ze.getImageData(0,0,ln.width,ln.height);return hn.globalAlpha=1,hn.clearRect(0,0,ln.width,ln.height),ra}sendUniformData(f,ze){const Ke=this.chooseRightDelta();f.uniform2fv(ze.uDelta,Ke)}isNeutralState(){return this.blur===0}chooseRightDelta(){let f=1;const ze=[0,0];this.horizontal?this.aspectRatio>1&&(f=1/this.aspectRatio):this.aspectRatio<1&&(f=this.aspectRatio);const Ke=f*this.blur*.12;return this.horizontal?ze[0]=Ke:ze[1]=Ke,ze}}t(Wa,"type","Blur"),t(Wa,"defaults",{blur:0}),t(Wa,"uniformLocations",["uDelta"]),tt.setClass(Wa);class Va extends La{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBrightness;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += uBrightness;
    gl_FragColor = color;
  }
`}applyTo2d(f){let{imageData:{data:ze}}=f;const Ke=Math.round(255*this.brightness);for(let Qe=0;Qe<ze.length;Qe+=4)ze[Qe]+=Ke,ze[Qe+1]+=Ke,ze[Qe+2]+=Ke}isNeutralState(){return this.brightness===0}sendUniformData(f,ze){f.uniform1f(ze.uBrightness,this.brightness)}}t(Va,"type","Brightness"),t(Va,"defaults",{brightness:0}),t(Va,"uniformLocations",["uBrightness"]),tt.setClass(Va);const za={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],colorsOnly:!0};class Ga extends La{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  varying vec2 vTexCoord;
  uniform mat4 uColorMatrix;
  uniform vec4 uConstants;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color *= uColorMatrix;
    color += uConstants;
    gl_FragColor = color;
  }`}applyTo2d(f){const ze=f.imageData.data,Ke=this.matrix,Qe=this.colorsOnly;for(let Pi=0;Pi<ze.length;Pi+=4){const nn=ze[Pi],ln=ze[Pi+1],cn=ze[Pi+2];if(ze[Pi]=nn*Ke[0]+ln*Ke[1]+cn*Ke[2]+255*Ke[4],ze[Pi+1]=nn*Ke[5]+ln*Ke[6]+cn*Ke[7]+255*Ke[9],ze[Pi+2]=nn*Ke[10]+ln*Ke[11]+cn*Ke[12]+255*Ke[14],!Qe){const hn=ze[Pi+3];ze[Pi]+=hn*Ke[3],ze[Pi+1]+=hn*Ke[8],ze[Pi+2]+=hn*Ke[13],ze[Pi+3]=nn*Ke[15]+ln*Ke[16]+cn*Ke[17]+hn*Ke[18]+255*Ke[19]}}}sendUniformData(f,ze){const Ke=this.matrix,Qe=[Ke[0],Ke[1],Ke[2],Ke[3],Ke[5],Ke[6],Ke[7],Ke[8],Ke[10],Ke[11],Ke[12],Ke[13],Ke[15],Ke[16],Ke[17],Ke[18]],Pi=[Ke[4],Ke[9],Ke[14],Ke[19]];f.uniformMatrix4fv(ze.uColorMatrix,!1,Qe),f.uniform4fv(ze.uConstants,Pi)}toObject(){return s(s({},super.toObject()),{},{matrix:[...this.matrix]})}}function Ha(qe,f){var ze;const Ke=(t(ze=class extends Ga{toObject(){return{type:this.type,colorsOnly:this.colorsOnly}}},"type",qe),t(ze,"defaults",{colorsOnly:!1,matrix:f}),ze);return tt.setClass(Ke,qe),Ke}t(Ga,"type","ColorMatrix"),t(Ga,"defaults",za),t(Ga,"uniformLocations",["uColorMatrix","uConstants"]),tt.setClass(Ga);Ha("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]);Ha("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]);Ha("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]);Ha("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]);Ha("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]);Ha("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]);Ha("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);class $a extends La{constructor(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(f),this.subFilters=f.subFilters||[]}applyTo(f){Da(f)&&(f.passes+=this.subFilters.length-1),this.subFilters.forEach(ze=>{ze.applyTo(f)})}toObject(){return{type:this.type,subFilters:this.subFilters.map(f=>f.toObject())}}isNeutralState(){return!this.subFilters.some(f=>!f.isNeutralState())}static fromObject(f,ze){return Promise.all((f.subFilters||[]).map(Ke=>tt.getClass(Ke.type).fromObject(Ke,ze))).then(Ke=>new this({subFilters:Ke}))}}t($a,"type","Composed"),tt.setClass($a);class th extends La{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uContrast;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
    gl_FragColor = color;
  }`}isNeutralState(){return this.contrast===0}applyTo2d(f){let{imageData:{data:ze}}=f;const Ke=Math.floor(255*this.contrast),Qe=259*(Ke+255)/(255*(259-Ke));for(let Pi=0;Pi<ze.length;Pi+=4)ze[Pi]=Qe*(ze[Pi]-128)+128,ze[Pi+1]=Qe*(ze[Pi+1]-128)+128,ze[Pi+2]=Qe*(ze[Pi+2]-128)+128}sendUniformData(f,ze){f.uniform1f(ze.uContrast,this.contrast)}}t(th,"type","Contrast"),t(th,"defaults",{contrast:0}),t(th,"uniformLocations",["uContrast"]),tt.setClass(th);const eh={Convolute_3_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_3_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_5_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_5_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_7_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_7_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_9_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_9_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `};class sh extends La{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return eh[this.getCacheKey()]}applyTo2d(f){const ze=f.imageData,Ke=ze.data,Qe=this.matrix,Pi=Math.round(Math.sqrt(Qe.length)),nn=Math.floor(Pi/2),ln=ze.width,cn=ze.height,hn=f.ctx.createImageData(ln,cn),un=hn.data,xs=this.opaque?1:0;let zn,Xn,ys,Jo,ea,ra,na,ta,ia,sa,Ma,pa,oa;for(Ma=0;Ma<cn;Ma++)for(sa=0;sa<ln;sa++){for(ea=4*(Ma*ln+sa),zn=0,Xn=0,ys=0,Jo=0,oa=0;oa<Pi;oa++)for(pa=0;pa<Pi;pa++)na=Ma+oa-nn,ra=sa+pa-nn,na<0||na>=cn||ra<0||ra>=ln||(ta=4*(na*ln+ra),ia=Qe[oa*Pi+pa],zn+=Ke[ta]*ia,Xn+=Ke[ta+1]*ia,ys+=Ke[ta+2]*ia,xs||(Jo+=Ke[ta+3]*ia));un[ea]=zn,un[ea+1]=Xn,un[ea+2]=ys,un[ea+3]=xs?Ke[ea+3]:Jo}f.imageData=hn}sendUniformData(f,ze){f.uniform1fv(ze.uMatrix,this.matrix)}toObject(){return s(s({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}t(sh,"type","Convolute"),t(sh,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),t(sh,"uniformLocations",["uMatrix","uOpaque","uHalfSize","uSize"]),tt.setClass(sh);const ih="Gamma";class rh extends La{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform vec3 uGamma;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    vec3 correction = (1.0 / uGamma);
    color.r = pow(color.r, correction.r);
    color.g = pow(color.g, correction.g);
    color.b = pow(color.b, correction.b);
    gl_FragColor = color;
    gl_FragColor.rgb *= color.a;
  }
`}constructor(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(f),this.gamma=f.gamma||this.constructor.defaults.gamma.concat()}applyTo2d(f){let{imageData:{data:ze}}=f;const Ke=this.gamma,Qe=1/Ke[0],Pi=1/Ke[1],nn=1/Ke[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});const ln=this.rgbValues;for(let cn=0;cn<256;cn++)ln.r[cn]=255*Math.pow(cn/255,Qe),ln.g[cn]=255*Math.pow(cn/255,Pi),ln.b[cn]=255*Math.pow(cn/255,nn);for(let cn=0;cn<ze.length;cn+=4)ze[cn]=ln.r[ze[cn]],ze[cn+1]=ln.g[ze[cn+1]],ze[cn+2]=ln.b[ze[cn+2]]}sendUniformData(f,ze){f.uniform3fv(ze.uGamma,this.gamma)}isNeutralState(){const{gamma:f}=this;return f[0]===1&&f[1]===1&&f[2]===1}toObject(){return{type:ih,gamma:this.gamma.concat()}}}t(rh,"type",ih),t(rh,"defaults",{gamma:[1,1,1]}),t(rh,"uniformLocations",["uGamma"]),tt.setClass(rh);const nh={average:`
    precision highp float;
    uniform sampler2D uTexture;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      float average = (color.r + color.b + color.g) / 3.0;
      gl_FragColor = vec4(average, average, average, color.a);
    }
    `,lightness:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `,luminosity:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `};class oh extends La{applyTo2d(f){let{imageData:{data:ze}}=f;for(let Ke,Qe=0;Qe<ze.length;Qe+=4){const Pi=ze[Qe],nn=ze[Qe+1],ln=ze[Qe+2];switch(this.mode){case"average":Ke=(Pi+nn+ln)/3;break;case"lightness":Ke=(Math.min(Pi,nn,ln)+Math.max(Pi,nn,ln))/2;break;case"luminosity":Ke=.21*Pi+.72*nn+.07*ln}ze[Qe+2]=ze[Qe+1]=ze[Qe]=Ke}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return nh[this.mode]}sendUniformData(f,ze){f.uniform1i(ze.uMode,1)}isNeutralState(){return!1}}t(oh,"type","Grayscale"),t(oh,"defaults",{mode:"average"}),t(oh,"uniformLocations",["uMode"]),tt.setClass(oh);const ah=s(s({},za),{},{rotation:0});class hh extends Ga{calculateMatrix(){const f=this.rotation*Math.PI,ze=rt$1(f),Ke=nt$1(f),Qe=1/3,Pi=Math.sqrt(Qe)*Ke,nn=1-ze;this.matrix=[ze+nn/3,Qe*nn-Pi,Qe*nn+Pi,0,0,Qe*nn+Pi,ze+Qe*nn,Qe*nn-Pi,0,0,Qe*nn-Pi,Qe*nn+Pi,ze+Qe*nn,0,0,0,0,0,1,0]}isNeutralState(){return this.rotation===0}applyTo(f){this.calculateMatrix(),super.applyTo(f)}toObject(){return{type:this.type,rotation:this.rotation}}}t(hh,"type","HueRotation"),t(hh,"defaults",ah),tt.setClass(hh);class ch extends La{applyTo2d(f){let{imageData:{data:ze}}=f;for(let Ke=0;Ke<ze.length;Ke+=4)ze[Ke]=255-ze[Ke],ze[Ke+1]=255-ze[Ke+1],ze[Ke+2]=255-ze[Ke+2],this.alpha&&(ze[Ke+3]=255-ze[Ke+3])}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform int uInvert;
  uniform int uAlpha;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    if (uInvert == 1) {
      if (uAlpha == 1) {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);
      } else {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
      }
    } else {
      gl_FragColor = color;
    }
  }
`}isNeutralState(){return!this.invert}sendUniformData(f,ze){f.uniform1i(ze.uInvert,Number(this.invert)),f.uniform1i(ze.uAlpha,Number(this.alpha))}}t(ch,"type","Invert"),t(ch,"defaults",{alpha:!1,invert:!0}),t(ch,"uniformLocations",["uInvert","uAlpha"]),tt.setClass(ch);class lh extends La{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uStepH;
  uniform float uNoise;
  uniform float uSeed;
  varying vec2 vTexCoord;
  float rand(vec2 co, float seed, float vScale) {
    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
  }
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
    gl_FragColor = color;
  }
`}applyTo2d(f){let{imageData:{data:ze}}=f;const Ke=this.noise;for(let Qe=0;Qe<ze.length;Qe+=4){const Pi=(.5-Math.random())*Ke;ze[Qe]+=Pi,ze[Qe+1]+=Pi,ze[Qe+2]+=Pi}}sendUniformData(f,ze){f.uniform1f(ze.uNoise,this.noise/255),f.uniform1f(ze.uSeed,Math.random())}isNeutralState(){return this.noise===0}}t(lh,"type","Noise"),t(lh,"defaults",{noise:0}),t(lh,"uniformLocations",["uNoise","uSeed"]),tt.setClass(lh);class uh extends La{applyTo2d(f){let{imageData:{data:ze,width:Ke,height:Qe}}=f;for(let Pi=0;Pi<Qe;Pi+=this.blocksize)for(let nn=0;nn<Ke;nn+=this.blocksize){const ln=4*Pi*Ke+4*nn,cn=ze[ln],hn=ze[ln+1],un=ze[ln+2],xs=ze[ln+3];for(let zn=Pi;zn<Math.min(Pi+this.blocksize,Qe);zn++)for(let Xn=nn;Xn<Math.min(nn+this.blocksize,Ke);Xn++){const ys=4*zn*Ke+4*Xn;ze[ys]=cn,ze[ys+1]=hn,ze[ys+2]=un,ze[ys+3]=xs}}}isNeutralState(){return this.blocksize===1}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBlocksize;
  uniform float uStepW;
  uniform float uStepH;
  varying vec2 vTexCoord;
  void main() {
    float blockW = uBlocksize * uStepW;
    float blockH = uBlocksize * uStepH;
    int posX = int(vTexCoord.x / blockW);
    int posY = int(vTexCoord.y / blockH);
    float fposX = float(posX);
    float fposY = float(posY);
    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
    vec4 color = texture2D(uTexture, squareCoords);
    gl_FragColor = color;
  }
`}sendUniformData(f,ze){f.uniform1f(ze.uBlocksize,this.blocksize)}}t(uh,"type","Pixelate"),t(uh,"defaults",{blocksize:4}),t(uh,"uniformLocations",["uBlocksize"]),tt.setClass(uh);class dh extends La{getFragmentSource(){return`
precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
  gl_FragColor = texture2D(uTexture, vTexCoord);
  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
    gl_FragColor.a = 0.0;
  }
}
`}applyTo2d(f){let{imageData:{data:ze}}=f;const Ke=255*this.distance,Qe=new Le$1(this.color).getSource(),Pi=[Qe[0]-Ke,Qe[1]-Ke,Qe[2]-Ke],nn=[Qe[0]+Ke,Qe[1]+Ke,Qe[2]+Ke];for(let ln=0;ln<ze.length;ln+=4){const cn=ze[ln],hn=ze[ln+1],un=ze[ln+2];cn>Pi[0]&&hn>Pi[1]&&un>Pi[2]&&cn<nn[0]&&hn<nn[1]&&un<nn[2]&&(ze[ln+3]=0)}}sendUniformData(f,ze){const Ke=new Le$1(this.color).getSource(),Qe=this.distance,Pi=[0+Ke[0]/255-Qe,0+Ke[1]/255-Qe,0+Ke[2]/255-Qe,1],nn=[Ke[0]/255+Qe,Ke[1]/255+Qe,Ke[2]/255+Qe,1];f.uniform4fv(ze.uLow,Pi),f.uniform4fv(ze.uHigh,nn)}}t(dh,"type","RemoveColor"),t(dh,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),t(dh,"uniformLocations",["uLow","uHigh"]),tt.setClass(dh);class gh extends La{sendUniformData(f,ze){f.uniform2fv(ze.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),f.uniform1fv(ze.uTaps,this.taps)}getFilterWindow(){const f=this.tempScale;return Math.ceil(this.lanczosLobes/f)}getCacheKey(){const f=this.getFilterWindow();return"".concat(this.type,"_").concat(f)}getFragmentSource(){const f=this.getFilterWindow();return this.generateShader(f)}getTaps(){const f=this.lanczosCreate(this.lanczosLobes),ze=this.tempScale,Ke=this.getFilterWindow(),Qe=new Array(Ke);for(let Pi=1;Pi<=Ke;Pi++)Qe[Pi-1]=f(Pi*ze);return Qe}generateShader(f){const ze=new Array(f);for(let Ke=1;Ke<=f;Ke++)ze[Ke-1]="".concat(Ke,".0 * uDelta");return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec2 uDelta;
      varying vec2 vTexCoord;
      uniform float uTaps[`.concat(f,`];
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        float sum = 1.0;
        `).concat(ze.map((Ke,Qe)=>`
              color += texture2D(uTexture, vTexCoord + `.concat(Ke,") * uTaps[").concat(Qe,"] + texture2D(uTexture, vTexCoord - ").concat(Ke,") * uTaps[").concat(Qe,`];
              sum += 2.0 * uTaps[`).concat(Qe,`];
            `)).join(`
`),`
        gl_FragColor = color / sum;
      }
    `)}applyToForWebgl(f){f.passes++,this.width=f.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=f.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),f.destinationWidth=this.dW,super.applyTo(f),f.sourceWidth=f.destinationWidth,this.height=f.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),f.destinationHeight=this.dH,super.applyTo(f),f.sourceHeight=f.destinationHeight}applyTo(f){Da(f)?this.applyToForWebgl(f):this.applyTo2d(f)}isNeutralState(){return this.scaleX===1&&this.scaleY===1}lanczosCreate(f){return ze=>{if(ze>=f||ze<=-f)return 0;if(ze<11920929e-14&&ze>-11920929e-14)return 1;const Ke=(ze*=Math.PI)/f;return Math.sin(ze)/ze*Math.sin(Ke)/Ke}}applyTo2d(f){const ze=f.imageData,Ke=this.scaleX,Qe=this.scaleY;this.rcpScaleX=1/Ke,this.rcpScaleY=1/Qe;const Pi=ze.width,nn=ze.height,ln=Math.round(Pi*Ke),cn=Math.round(nn*Qe);let hn;hn=this.resizeType==="sliceHack"?this.sliceByTwo(f,Pi,nn,ln,cn):this.resizeType==="hermite"?this.hermiteFastResize(f,Pi,nn,ln,cn):this.resizeType==="bilinear"?this.bilinearFiltering(f,Pi,nn,ln,cn):this.resizeType==="lanczos"?this.lanczosResize(f,Pi,nn,ln,cn):new ImageData(ln,cn),f.imageData=hn}sliceByTwo(f,ze,Ke,Qe,Pi){const nn=f.imageData,ln=.5;let cn=!1,hn=!1,un=ze*ln,xs=Ke*ln;const zn=f.filterBackend.resources;let Xn=0,ys=0;const Jo=ze;let ea=0;zn.sliceByTwo||(zn.sliceByTwo=pt$1());const ra=zn.sliceByTwo;(ra.width<1.5*ze||ra.height<Ke)&&(ra.width=1.5*ze,ra.height=Ke);const na=ra.getContext("2d");for(na.clearRect(0,0,1.5*ze,Ke),na.putImageData(nn,0,0),Qe=Math.floor(Qe),Pi=Math.floor(Pi);!cn||!hn;)ze=un,Ke=xs,Qe<Math.floor(un*ln)?un=Math.floor(un*ln):(un=Qe,cn=!0),Pi<Math.floor(xs*ln)?xs=Math.floor(xs*ln):(xs=Pi,hn=!0),na.drawImage(ra,Xn,ys,ze,Ke,Jo,ea,un,xs),Xn=Jo,ys=ea,ea+=xs;return na.getImageData(Xn,ys,Qe,Pi)}lanczosResize(f,ze,Ke,Qe,Pi){const nn=f.imageData.data,ln=f.ctx.createImageData(Qe,Pi),cn=ln.data,hn=this.lanczosCreate(this.lanczosLobes),un=this.rcpScaleX,xs=this.rcpScaleY,zn=2/this.rcpScaleX,Xn=2/this.rcpScaleY,ys=Math.ceil(un*this.lanczosLobes/2),Jo=Math.ceil(xs*this.lanczosLobes/2),ea={},ra={x:0,y:0},na={x:0,y:0};return function ta(ia){let sa,Ma,pa,oa,ha,ca,da,ga,qa,Ka,il;for(ra.x=(ia+.5)*un,na.x=Math.floor(ra.x),sa=0;sa<Pi;sa++){for(ra.y=(sa+.5)*xs,na.y=Math.floor(ra.y),ha=0,ca=0,da=0,ga=0,qa=0,Ma=na.x-ys;Ma<=na.x+ys;Ma++)if(!(Ma<0||Ma>=ze)){Ka=Math.floor(1e3*Math.abs(Ma-ra.x)),ea[Ka]||(ea[Ka]={});for(let cl=na.y-Jo;cl<=na.y+Jo;cl++)cl<0||cl>=Ke||(il=Math.floor(1e3*Math.abs(cl-ra.y)),ea[Ka][il]||(ea[Ka][il]=hn(Math.sqrt(Math.pow(Ka*zn,2)+Math.pow(il*Xn,2))/1e3)),pa=ea[Ka][il],pa>0&&(oa=4*(cl*ze+Ma),ha+=pa,ca+=pa*nn[oa],da+=pa*nn[oa+1],ga+=pa*nn[oa+2],qa+=pa*nn[oa+3]))}oa=4*(sa*Qe+ia),cn[oa]=ca/ha,cn[oa+1]=da/ha,cn[oa+2]=ga/ha,cn[oa+3]=qa/ha}return++ia<Qe?ta(ia):ln}(0)}bilinearFiltering(f,ze,Ke,Qe,Pi){let nn,ln,cn,hn,un,xs,zn,Xn,ys,Jo,ea,ra,na,ta=0;const ia=this.rcpScaleX,sa=this.rcpScaleY,Ma=4*(ze-1),pa=f.imageData.data,oa=f.ctx.createImageData(Qe,Pi),ha=oa.data;for(zn=0;zn<Pi;zn++)for(Xn=0;Xn<Qe;Xn++)for(un=Math.floor(ia*Xn),xs=Math.floor(sa*zn),ys=ia*Xn-un,Jo=sa*zn-xs,na=4*(xs*ze+un),ea=0;ea<4;ea++)nn=pa[na+ea],ln=pa[na+4+ea],cn=pa[na+Ma+ea],hn=pa[na+Ma+4+ea],ra=nn*(1-ys)*(1-Jo)+ln*ys*(1-Jo)+cn*Jo*(1-ys)+hn*ys*Jo,ha[ta++]=ra;return oa}hermiteFastResize(f,ze,Ke,Qe,Pi){const nn=this.rcpScaleX,ln=this.rcpScaleY,cn=Math.ceil(nn/2),hn=Math.ceil(ln/2),un=f.imageData.data,xs=f.ctx.createImageData(Qe,Pi),zn=xs.data;for(let Xn=0;Xn<Pi;Xn++)for(let ys=0;ys<Qe;ys++){const Jo=4*(ys+Xn*Qe);let ea=0,ra=0,na=0,ta=0,ia=0,sa=0,Ma=0;const pa=(Xn+.5)*ln;for(let oa=Math.floor(Xn*ln);oa<(Xn+1)*ln;oa++){const ha=Math.abs(pa-(oa+.5))/hn,ca=(ys+.5)*nn,da=ha*ha;for(let ga=Math.floor(ys*nn);ga<(ys+1)*nn;ga++){let qa=Math.abs(ca-(ga+.5))/cn;const Ka=Math.sqrt(da+qa*qa);Ka>1&&Ka<-1||(ea=2*Ka*Ka*Ka-3*Ka*Ka+1,ea>0&&(qa=4*(ga+oa*ze),Ma+=ea*un[qa+3],na+=ea,un[qa+3]<255&&(ea=ea*un[qa+3]/250),ta+=ea*un[qa],ia+=ea*un[qa+1],sa+=ea*un[qa+2],ra+=ea))}}zn[Jo]=ta/ra,zn[Jo+1]=ia/ra,zn[Jo+2]=sa/ra,zn[Jo+3]=Ma/na}return xs}}t(gh,"type","Resize"),t(gh,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3}),t(gh,"uniformLocations",["uDelta","uTaps"]),tt.setClass(gh);class fh extends La{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uSaturation;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float rgMax = max(color.r, color.g);
    float rgbMax = max(rgMax, color.b);
    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(f){let{imageData:{data:ze}}=f;const Ke=-this.saturation;for(let Qe=0;Qe<ze.length;Qe+=4){const Pi=ze[Qe],nn=ze[Qe+1],ln=ze[Qe+2],cn=Math.max(Pi,nn,ln);ze[Qe]+=cn!==Pi?(cn-Pi)*Ke:0,ze[Qe+1]+=cn!==nn?(cn-nn)*Ke:0,ze[Qe+2]+=cn!==ln?(cn-ln)*Ke:0}}sendUniformData(f,ze){f.uniform1f(ze.uSaturation,-this.saturation)}isNeutralState(){return this.saturation===0}}t(fh,"type","Saturation"),t(fh,"defaults",{saturation:0}),t(fh,"uniformLocations",["uSaturation"]),tt.setClass(fh);class ph extends La{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uVibrance;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float max = max(color.r, max(color.g, color.b));
    float avg = (color.r + color.g + color.b) / 3.0;
    float amt = (abs(max - avg) * 2.0) * uVibrance;
    color.r += max != color.r ? (max - color.r) * amt : 0.00;
    color.g += max != color.g ? (max - color.g) * amt : 0.00;
    color.b += max != color.b ? (max - color.b) * amt : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(f){let{imageData:{data:ze}}=f;const Ke=-this.vibrance;for(let Qe=0;Qe<ze.length;Qe+=4){const Pi=ze[Qe],nn=ze[Qe+1],ln=ze[Qe+2],cn=Math.max(Pi,nn,ln),hn=(Pi+nn+ln)/3,un=2*Math.abs(cn-hn)/255*Ke;ze[Qe]+=cn!==Pi?(cn-Pi)*un:0,ze[Qe+1]+=cn!==nn?(cn-nn)*un:0,ze[Qe+2]+=cn!==ln?(cn-ln)*un:0}}sendUniformData(f,ze){f.uniform1f(ze.uVibrance,-this.vibrance)}isNeutralState(){return this.vibrance===0}}t(ph,"type","Vibrance"),t(ph,"defaults",{vibrance:0}),t(ph,"uniformLocations",["uVibrance"]),tt.setClass(ph);const bitMethods={getBit(qe){return this.data[getSlot(qe)]&1<<getShift(qe)?1:0},setBit(qe){this.data[getSlot(qe)]|=1<<getShift(qe)},clearBit(qe){this.data[getSlot(qe)]&=~(1<<getShift(qe))},toggleBit(qe){this.data[getSlot(qe)]^=1<<getShift(qe)},getBitXY(qe,f){return qe>=this.width||f>=this.height?0:this.getBit(f*this.width+qe)},setBitXY(qe,f){this.setBit(f*this.width+qe)},clearBitXY(qe,f){this.clearBit(f*this.width+qe)},toggleBitXY(qe,f){this.toggleBit(f*this.width+qe)}};function getSlot(qe){return qe>>3}function getShift(qe){return 7-(qe&7)}function setBitMethods(qe){for(const f in bitMethods)qe.prototype[f]=bitMethods[f]}function checkProcessable(qe,f={}){let{bitDepth:ze,alpha:Ke,colorModel:Qe,components:Pi,channels:nn}=f;if(typeof qe!="string"||qe.length===0)throw new TypeError("processName must be a string");if(ze&&(Array.isArray(ze)||(ze=[ze]),!ze.includes(this.bitDepth)))throw new TypeError(`The process: ${qe} can only be applied if bit depth is in: ${ze}`);if(Ke&&(Array.isArray(Ke)||(Ke=[Ke]),!Ke.includes(this.alpha)))throw new TypeError(`The process: ${qe} can only be applied if alpha is in: ${Ke}`);if(Qe&&(Array.isArray(Qe)||(Qe=[Qe]),!Qe.includes(this.colorModel)))throw new TypeError(`The process: ${qe} can only be applied if color model is in: ${Qe}`);if(Pi&&(Array.isArray(Pi)||(Pi=[Pi]),!Pi.includes(this.components))){let ln=`The process: ${qe} can only be applied if the number of components is in: ${Pi}`;throw Pi.length===1&&Pi[0]===1?new TypeError(`${ln}.\rYou should transform your image using "image.grey()" before applying the algorithm.`):new TypeError(ln)}if(nn&&(Array.isArray(nn)||(nn=[nn]),!nn.includes(this.channels)))throw new TypeError(`The process: ${qe} can only be applied if the number of channels is in: ${nn}`)}function createBlob(qe,f){qe=qe||[],f=f||{},typeof f=="string"&&(f={type:f});try{return new Blob(qe,f)}catch(Pi){if(Pi.name!=="TypeError")throw Pi;for(var ze=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,Ke=new ze,Qe=0;Qe<qe.length;Qe+=1)Ke.append(qe[Qe]);return Ke.getBlob(f.type)}}function dataURLToBlob(qe){var f=qe.match(/data:([^;]+)/)[1],ze=qe.replace(/^[^,]+,/,""),Ke=binaryStringToArrayBuffer(atob(ze));return createBlob([Ke],{type:f})}function canvasToBlob(qe,f,ze){return typeof qe.toBlob=="function"?new Promise(function(Ke){qe.toBlob(Ke,f,ze)}):Promise.resolve(dataURLToBlob(qe.toDataURL(f,ze)))}function binaryStringToArrayBuffer(qe){for(var f=qe.length,ze=new ArrayBuffer(f),Ke=new Uint8Array(ze),Qe=-1;++Qe<f;)Ke[Qe]=qe.charCodeAt(Qe);return ze}var src$5={};function decode$2(qe,f="utf8"){return new TextDecoder(f).decode(qe)}const encoder$1=new TextEncoder;function encode$1(qe){return encoder$1.encode(qe)}const defaultByteLength=1024*8,hostBigEndian=(()=>{const qe=new Uint8Array(4),f=new Uint32Array(qe.buffer);return!((f[0]=1)&qe[0])})(),typedArrays={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class IOBuffer{constructor(f=defaultByteLength,ze={}){yh(this,"buffer");yh(this,"byteLength");yh(this,"byteOffset");yh(this,"length");yh(this,"offset");yh(this,"lastWrittenByte");yh(this,"littleEndian");yh(this,"_data");yh(this,"_mark");yh(this,"_marks");let Ke=!1;typeof f=="number"?f=new ArrayBuffer(f):(Ke=!0,this.lastWrittenByte=f.byteLength);const Qe=ze.offset?ze.offset>>>0:0,Pi=f.byteLength-Qe;let nn=Qe;(ArrayBuffer.isView(f)||f instanceof IOBuffer)&&(f.byteLength!==f.buffer.byteLength&&(nn=f.byteOffset+Qe),f=f.buffer),Ke?this.lastWrittenByte=Pi:this.lastWrittenByte=0,this.buffer=f,this.length=Pi,this.byteLength=Pi,this.byteOffset=nn,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,nn,Pi),this._mark=0,this._marks=[]}available(f=1){return this.offset+f<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(f=1){return this.offset+=f,this}back(f=1){return this.offset-=f,this}seek(f){return this.offset=f,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const f=this._marks.pop();if(f===void 0)throw new Error("Mark stack empty");return this.seek(f),this}rewind(){return this.offset=0,this}ensureAvailable(f=1){if(!this.available(f)){const Ke=(this.offset+f)*2,Qe=new Uint8Array(Ke);Qe.set(new Uint8Array(this.buffer)),this.buffer=Qe.buffer,this.length=Ke,this.byteLength=Ke,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(f=1){return this.readArray(f,"uint8")}readArray(f,ze){const Ke=typedArrays[ze].BYTES_PER_ELEMENT*f,Qe=this.byteOffset+this.offset,Pi=this.buffer.slice(Qe,Qe+Ke);if(this.littleEndian===hostBigEndian&&ze!=="uint8"&&ze!=="int8"){const ln=new Uint8Array(this.buffer.slice(Qe,Qe+Ke));ln.reverse();const cn=new typedArrays[ze](ln.buffer);return this.offset+=Ke,cn.reverse(),cn}const nn=new typedArrays[ze](Pi);return this.offset+=Ke,nn}readInt16(){const f=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,f}readUint16(){const f=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,f}readInt32(){const f=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,f}readUint32(){const f=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,f}readFloat32(){const f=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,f}readFloat64(){const f=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,f}readBigInt64(){const f=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,f}readBigUint64(){const f=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,f}readChar(){return String.fromCharCode(this.readInt8())}readChars(f=1){let ze="";for(let Ke=0;Ke<f;Ke++)ze+=this.readChar();return ze}readUtf8(f=1){return decode$2(this.readBytes(f))}decodeText(f=1,ze="utf8"){return decode$2(this.readBytes(f),ze)}writeBoolean(f){return this.writeUint8(f?255:0),this}writeInt8(f){return this.ensureAvailable(1),this._data.setInt8(this.offset++,f),this._updateLastWrittenByte(),this}writeUint8(f){return this.ensureAvailable(1),this._data.setUint8(this.offset++,f),this._updateLastWrittenByte(),this}writeByte(f){return this.writeUint8(f)}writeBytes(f){this.ensureAvailable(f.length);for(let ze=0;ze<f.length;ze++)this._data.setUint8(this.offset++,f[ze]);return this._updateLastWrittenByte(),this}writeInt16(f){return this.ensureAvailable(2),this._data.setInt16(this.offset,f,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(f){return this.ensureAvailable(2),this._data.setUint16(this.offset,f,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(f){return this.ensureAvailable(4),this._data.setInt32(this.offset,f,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(f){return this.ensureAvailable(4),this._data.setUint32(this.offset,f,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(f){return this.ensureAvailable(4),this._data.setFloat32(this.offset,f,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(f){return this.ensureAvailable(8),this._data.setFloat64(this.offset,f,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(f){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,f,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(f){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,f,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(f){return this.writeUint8(f.charCodeAt(0))}writeChars(f){for(let ze=0;ze<f.length;ze++)this.writeUint8(f.charCodeAt(ze));return this}writeUtf8(f){return this.writeBytes(encode$1(f))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}const IOBuffer$1=Object.freeze(Object.defineProperty({__proto__:null,IOBuffer},Symbol.toStringTag,{value:"Module"})),require$$0$3=getAugmentedNamespace(IOBuffer$1);var constants,hasRequiredConstants;function requireConstants(){return hasRequiredConstants||(hasRequiredConstants=1,constants={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}}),constants}var BMPEncoder_1,hasRequiredBMPEncoder;function requireBMPEncoder(){if(hasRequiredBMPEncoder)return BMPEncoder_1;hasRequiredBMPEncoder=1;const{IOBuffer:qe}=require$$0$3,f=requireConstants(),ze=[];for(let Qe=0;Qe<=8;Qe++)ze.push(255<<Qe);class Ke extends qe{constructor(Pi){if(Pi.bitDepth!==1)throw new Error("Only bitDepth of 1 is supported");if(!Pi.height||!Pi.width)throw new Error("ImageData width and height are required");super(Pi.data),this.width=Pi.width,this.height=Pi.height,this.bitDepth=Pi.bitDepth,this.channels=Pi.channels,this.components=Pi.components}encode(){this.encoded=new qe,this.encoded.skip(14),this.writeBitmapV5Header(),this.writeColorTable();const Pi=this.encoded.offset;return this.writePixelArray(),this.encoded.rewind(),this.writeBitmapFileHeader(Pi),this.encoded.toArray()}writePixelArray(){let Pi=this.encoded;const nn=Math.floor((this.bitDepth*this.width+31)/32)*4,ln=Math.ceil(this.bitDepth*this.width/8),cn=nn-ln,hn=this.bitDepth*this.width%8,un=hn===0?0:8-hn,xs=nn*this.height;let zn,Xn,ys=0,Jo=0,ea=8;Pi.mark(),Xn=this.readUint8();for(let ra=this.height-1;ra>=0;ra--){const na=ra===0;Pi.reset(),Pi.skip(ra*nn);for(let ta=0;ta<ln;ta++){const ia=ta===ln-1;Jo<=un&&ia?(Pi.writeByte(Xn<<Jo),(un===0||un===Jo)&&!na&&(zn=Xn,Xn=this.readByte())):Jo===0?(zn=Xn,Xn=this.readUint8(),Pi.writeByte(zn)):(zn=Xn,Xn=this.readUint8(),Pi.writeByte(zn<<Jo&ze[Jo]|Xn>>ea)),ia&&(ys+=hn||0,Pi.skip(cn),Jo=ys%8,ea=8-Jo)}}nn>ln&&(Pi.reset(),Pi.skip(xs-1),Pi.writeUint8(0))}writeColorTable(){this.encoded.writeUint32(0).writeUint32(16777215)}writeBitmapFileHeader(Pi){this.encoded.writeChars("BM").writeInt32(this.encoded.lastWrittenByte).writeUint16(0).writeUint16(0).writeUint32(Pi)}writeBitmapV5Header(){const nn=Math.floor((this.bitDepth*this.width+31)/32)*4*this.height;this.encoded.writeUint32(124).writeInt32(this.width).writeInt32(this.height).writeUint16(1).writeUint16(this.bitDepth).writeUint32(f.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(nn).writeInt32(0).writeInt32(0).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(f.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(f.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}}return BMPEncoder_1=Ke,BMPEncoder_1}var hasRequiredSrc$5;function requireSrc$5(){if(hasRequiredSrc$5)return src$5;hasRequiredSrc$5=1;const qe=requireBMPEncoder();return src$5.encode=function(ze){return new qe(ze).encode()},src$5}var srcExports$3=requireSrc$5();/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(qe){let f=qe.length;for(;--f>=0;)qe[f]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(qe,f,ze,Ke,Qe){this.static_tree=qe,this.extra_bits=f,this.extra_base=ze,this.elems=Ke,this.max_length=Qe,this.has_stree=qe&&qe.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(qe,f){this.dyn_tree=qe,this.max_code=0,this.stat_desc=f}const d_code=qe=>qe<256?_dist_code[qe]:_dist_code[256+(qe>>>7)],put_short=(qe,f)=>{qe.pending_buf[qe.pending++]=f&255,qe.pending_buf[qe.pending++]=f>>>8&255},send_bits=(qe,f,ze)=>{qe.bi_valid>Buf_size-ze?(qe.bi_buf|=f<<qe.bi_valid&65535,put_short(qe,qe.bi_buf),qe.bi_buf=f>>Buf_size-qe.bi_valid,qe.bi_valid+=ze-Buf_size):(qe.bi_buf|=f<<qe.bi_valid&65535,qe.bi_valid+=ze)},send_code=(qe,f,ze)=>{send_bits(qe,ze[f*2],ze[f*2+1])},bi_reverse=(qe,f)=>{let ze=0;do ze|=qe&1,qe>>>=1,ze<<=1;while(--f>0);return ze>>>1},bi_flush=qe=>{qe.bi_valid===16?(put_short(qe,qe.bi_buf),qe.bi_buf=0,qe.bi_valid=0):qe.bi_valid>=8&&(qe.pending_buf[qe.pending++]=qe.bi_buf&255,qe.bi_buf>>=8,qe.bi_valid-=8)},gen_bitlen=(qe,f)=>{const ze=f.dyn_tree,Ke=f.max_code,Qe=f.stat_desc.static_tree,Pi=f.stat_desc.has_stree,nn=f.stat_desc.extra_bits,ln=f.stat_desc.extra_base,cn=f.stat_desc.max_length;let hn,un,xs,zn,Xn,ys,Jo=0;for(zn=0;zn<=MAX_BITS$1;zn++)qe.bl_count[zn]=0;for(ze[qe.heap[qe.heap_max]*2+1]=0,hn=qe.heap_max+1;hn<HEAP_SIZE$1;hn++)un=qe.heap[hn],zn=ze[ze[un*2+1]*2+1]+1,zn>cn&&(zn=cn,Jo++),ze[un*2+1]=zn,!(un>Ke)&&(qe.bl_count[zn]++,Xn=0,un>=ln&&(Xn=nn[un-ln]),ys=ze[un*2],qe.opt_len+=ys*(zn+Xn),Pi&&(qe.static_len+=ys*(Qe[un*2+1]+Xn)));if(Jo!==0){do{for(zn=cn-1;qe.bl_count[zn]===0;)zn--;qe.bl_count[zn]--,qe.bl_count[zn+1]+=2,qe.bl_count[cn]--,Jo-=2}while(Jo>0);for(zn=cn;zn!==0;zn--)for(un=qe.bl_count[zn];un!==0;)xs=qe.heap[--hn],!(xs>Ke)&&(ze[xs*2+1]!==zn&&(qe.opt_len+=(zn-ze[xs*2+1])*ze[xs*2],ze[xs*2+1]=zn),un--)}},gen_codes=(qe,f,ze)=>{const Ke=new Array(MAX_BITS$1+1);let Qe=0,Pi,nn;for(Pi=1;Pi<=MAX_BITS$1;Pi++)Qe=Qe+ze[Pi-1]<<1,Ke[Pi]=Qe;for(nn=0;nn<=f;nn++){let ln=qe[nn*2+1];ln!==0&&(qe[nn*2]=bi_reverse(Ke[ln]++,ln))}},tr_static_init=()=>{let qe,f,ze,Ke,Qe;const Pi=new Array(MAX_BITS$1+1);for(ze=0,Ke=0;Ke<LENGTH_CODES$1-1;Ke++)for(base_length[Ke]=ze,qe=0;qe<1<<extra_lbits[Ke];qe++)_length_code[ze++]=Ke;for(_length_code[ze-1]=Ke,Qe=0,Ke=0;Ke<16;Ke++)for(base_dist[Ke]=Qe,qe=0;qe<1<<extra_dbits[Ke];qe++)_dist_code[Qe++]=Ke;for(Qe>>=7;Ke<D_CODES$1;Ke++)for(base_dist[Ke]=Qe<<7,qe=0;qe<1<<extra_dbits[Ke]-7;qe++)_dist_code[256+Qe++]=Ke;for(f=0;f<=MAX_BITS$1;f++)Pi[f]=0;for(qe=0;qe<=143;)static_ltree[qe*2+1]=8,qe++,Pi[8]++;for(;qe<=255;)static_ltree[qe*2+1]=9,qe++,Pi[9]++;for(;qe<=279;)static_ltree[qe*2+1]=7,qe++,Pi[7]++;for(;qe<=287;)static_ltree[qe*2+1]=8,qe++,Pi[8]++;for(gen_codes(static_ltree,L_CODES$1+1,Pi),qe=0;qe<D_CODES$1;qe++)static_dtree[qe*2+1]=5,static_dtree[qe*2]=bi_reverse(qe,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=qe=>{let f;for(f=0;f<L_CODES$1;f++)qe.dyn_ltree[f*2]=0;for(f=0;f<D_CODES$1;f++)qe.dyn_dtree[f*2]=0;for(f=0;f<BL_CODES$1;f++)qe.bl_tree[f*2]=0;qe.dyn_ltree[END_BLOCK*2]=1,qe.opt_len=qe.static_len=0,qe.sym_next=qe.matches=0},bi_windup=qe=>{qe.bi_valid>8?put_short(qe,qe.bi_buf):qe.bi_valid>0&&(qe.pending_buf[qe.pending++]=qe.bi_buf),qe.bi_buf=0,qe.bi_valid=0},smaller=(qe,f,ze,Ke)=>{const Qe=f*2,Pi=ze*2;return qe[Qe]<qe[Pi]||qe[Qe]===qe[Pi]&&Ke[f]<=Ke[ze]},pqdownheap=(qe,f,ze)=>{const Ke=qe.heap[ze];let Qe=ze<<1;for(;Qe<=qe.heap_len&&(Qe<qe.heap_len&&smaller(f,qe.heap[Qe+1],qe.heap[Qe],qe.depth)&&Qe++,!smaller(f,Ke,qe.heap[Qe],qe.depth));)qe.heap[ze]=qe.heap[Qe],ze=Qe,Qe<<=1;qe.heap[ze]=Ke},compress_block=(qe,f,ze)=>{let Ke,Qe,Pi=0,nn,ln;if(qe.sym_next!==0)do Ke=qe.pending_buf[qe.sym_buf+Pi++]&255,Ke+=(qe.pending_buf[qe.sym_buf+Pi++]&255)<<8,Qe=qe.pending_buf[qe.sym_buf+Pi++],Ke===0?send_code(qe,Qe,f):(nn=_length_code[Qe],send_code(qe,nn+LITERALS$1+1,f),ln=extra_lbits[nn],ln!==0&&(Qe-=base_length[nn],send_bits(qe,Qe,ln)),Ke--,nn=d_code(Ke),send_code(qe,nn,ze),ln=extra_dbits[nn],ln!==0&&(Ke-=base_dist[nn],send_bits(qe,Ke,ln)));while(Pi<qe.sym_next);send_code(qe,END_BLOCK,f)},build_tree=(qe,f)=>{const ze=f.dyn_tree,Ke=f.stat_desc.static_tree,Qe=f.stat_desc.has_stree,Pi=f.stat_desc.elems;let nn,ln,cn=-1,hn;for(qe.heap_len=0,qe.heap_max=HEAP_SIZE$1,nn=0;nn<Pi;nn++)ze[nn*2]!==0?(qe.heap[++qe.heap_len]=cn=nn,qe.depth[nn]=0):ze[nn*2+1]=0;for(;qe.heap_len<2;)hn=qe.heap[++qe.heap_len]=cn<2?++cn:0,ze[hn*2]=1,qe.depth[hn]=0,qe.opt_len--,Qe&&(qe.static_len-=Ke[hn*2+1]);for(f.max_code=cn,nn=qe.heap_len>>1;nn>=1;nn--)pqdownheap(qe,ze,nn);hn=Pi;do nn=qe.heap[1],qe.heap[1]=qe.heap[qe.heap_len--],pqdownheap(qe,ze,1),ln=qe.heap[1],qe.heap[--qe.heap_max]=nn,qe.heap[--qe.heap_max]=ln,ze[hn*2]=ze[nn*2]+ze[ln*2],qe.depth[hn]=(qe.depth[nn]>=qe.depth[ln]?qe.depth[nn]:qe.depth[ln])+1,ze[nn*2+1]=ze[ln*2+1]=hn,qe.heap[1]=hn++,pqdownheap(qe,ze,1);while(qe.heap_len>=2);qe.heap[--qe.heap_max]=qe.heap[1],gen_bitlen(qe,f),gen_codes(ze,cn,qe.bl_count)},scan_tree=(qe,f,ze)=>{let Ke,Qe=-1,Pi,nn=f[0*2+1],ln=0,cn=7,hn=4;for(nn===0&&(cn=138,hn=3),f[(ze+1)*2+1]=65535,Ke=0;Ke<=ze;Ke++)Pi=nn,nn=f[(Ke+1)*2+1],!(++ln<cn&&Pi===nn)&&(ln<hn?qe.bl_tree[Pi*2]+=ln:Pi!==0?(Pi!==Qe&&qe.bl_tree[Pi*2]++,qe.bl_tree[REP_3_6*2]++):ln<=10?qe.bl_tree[REPZ_3_10*2]++:qe.bl_tree[REPZ_11_138*2]++,ln=0,Qe=Pi,nn===0?(cn=138,hn=3):Pi===nn?(cn=6,hn=3):(cn=7,hn=4))},send_tree=(qe,f,ze)=>{let Ke,Qe=-1,Pi,nn=f[0*2+1],ln=0,cn=7,hn=4;for(nn===0&&(cn=138,hn=3),Ke=0;Ke<=ze;Ke++)if(Pi=nn,nn=f[(Ke+1)*2+1],!(++ln<cn&&Pi===nn)){if(ln<hn)do send_code(qe,Pi,qe.bl_tree);while(--ln!==0);else Pi!==0?(Pi!==Qe&&(send_code(qe,Pi,qe.bl_tree),ln--),send_code(qe,REP_3_6,qe.bl_tree),send_bits(qe,ln-3,2)):ln<=10?(send_code(qe,REPZ_3_10,qe.bl_tree),send_bits(qe,ln-3,3)):(send_code(qe,REPZ_11_138,qe.bl_tree),send_bits(qe,ln-11,7));ln=0,Qe=Pi,nn===0?(cn=138,hn=3):Pi===nn?(cn=6,hn=3):(cn=7,hn=4)}},build_bl_tree=qe=>{let f;for(scan_tree(qe,qe.dyn_ltree,qe.l_desc.max_code),scan_tree(qe,qe.dyn_dtree,qe.d_desc.max_code),build_tree(qe,qe.bl_desc),f=BL_CODES$1-1;f>=3&&qe.bl_tree[bl_order[f]*2+1]===0;f--);return qe.opt_len+=3*(f+1)+5+5+4,f},send_all_trees=(qe,f,ze,Ke)=>{let Qe;for(send_bits(qe,f-257,5),send_bits(qe,ze-1,5),send_bits(qe,Ke-4,4),Qe=0;Qe<Ke;Qe++)send_bits(qe,qe.bl_tree[bl_order[Qe]*2+1],3);send_tree(qe,qe.dyn_ltree,f-1),send_tree(qe,qe.dyn_dtree,ze-1)},detect_data_type=qe=>{let f=4093624447,ze;for(ze=0;ze<=31;ze++,f>>>=1)if(f&1&&qe.dyn_ltree[ze*2]!==0)return Z_BINARY;if(qe.dyn_ltree[9*2]!==0||qe.dyn_ltree[10*2]!==0||qe.dyn_ltree[13*2]!==0)return Z_TEXT;for(ze=32;ze<LITERALS$1;ze++)if(qe.dyn_ltree[ze*2]!==0)return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=qe=>{static_init_done||(tr_static_init(),static_init_done=!0),qe.l_desc=new TreeDesc(qe.dyn_ltree,static_l_desc),qe.d_desc=new TreeDesc(qe.dyn_dtree,static_d_desc),qe.bl_desc=new TreeDesc(qe.bl_tree,static_bl_desc),qe.bi_buf=0,qe.bi_valid=0,init_block(qe)},_tr_stored_block$1=(qe,f,ze,Ke)=>{send_bits(qe,(STORED_BLOCK<<1)+(Ke?1:0),3),bi_windup(qe),put_short(qe,ze),put_short(qe,~ze),ze&&qe.pending_buf.set(qe.window.subarray(f,f+ze),qe.pending),qe.pending+=ze},_tr_align$1=qe=>{send_bits(qe,STATIC_TREES<<1,3),send_code(qe,END_BLOCK,static_ltree),bi_flush(qe)},_tr_flush_block$1=(qe,f,ze,Ke)=>{let Qe,Pi,nn=0;qe.level>0?(qe.strm.data_type===Z_UNKNOWN$1&&(qe.strm.data_type=detect_data_type(qe)),build_tree(qe,qe.l_desc),build_tree(qe,qe.d_desc),nn=build_bl_tree(qe),Qe=qe.opt_len+3+7>>>3,Pi=qe.static_len+3+7>>>3,Pi<=Qe&&(Qe=Pi)):Qe=Pi=ze+5,ze+4<=Qe&&f!==-1?_tr_stored_block$1(qe,f,ze,Ke):qe.strategy===Z_FIXED$1||Pi===Qe?(send_bits(qe,(STATIC_TREES<<1)+(Ke?1:0),3),compress_block(qe,static_ltree,static_dtree)):(send_bits(qe,(DYN_TREES<<1)+(Ke?1:0),3),send_all_trees(qe,qe.l_desc.max_code+1,qe.d_desc.max_code+1,nn+1),compress_block(qe,qe.dyn_ltree,qe.dyn_dtree)),init_block(qe),Ke&&bi_windup(qe)},_tr_tally$1=(qe,f,ze)=>(qe.pending_buf[qe.sym_buf+qe.sym_next++]=f,qe.pending_buf[qe.sym_buf+qe.sym_next++]=f>>8,qe.pending_buf[qe.sym_buf+qe.sym_next++]=ze,f===0?qe.dyn_ltree[ze*2]++:(qe.matches++,f--,qe.dyn_ltree[(_length_code[ze]+LITERALS$1+1)*2]++,qe.dyn_dtree[d_code(f)*2]++),qe.sym_next===qe.sym_end);var _tr_init_1=_tr_init$1,_tr_stored_block_1=_tr_stored_block$1,_tr_flush_block_1=_tr_flush_block$1,_tr_tally_1=_tr_tally$1,_tr_align_1=_tr_align$1,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};const adler32=(qe,f,ze,Ke)=>{let Qe=qe&65535|0,Pi=qe>>>16&65535|0,nn=0;for(;ze!==0;){nn=ze>2e3?2e3:ze,ze-=nn;do Qe=Qe+f[Ke++]|0,Pi=Pi+Qe|0;while(--nn);Qe%=65521,Pi%=65521}return Qe|Pi<<16|0};var adler32_1=adler32;const makeTable=()=>{let qe,f=[];for(var ze=0;ze<256;ze++){qe=ze;for(var Ke=0;Ke<8;Ke++)qe=qe&1?3988292384^qe>>>1:qe>>>1;f[ze]=qe}return f},crcTable$1=new Uint32Array(makeTable()),crc32=(qe,f,ze,Ke)=>{const Qe=crcTable$1,Pi=Ke+ze;qe^=-1;for(let nn=Ke;nn<Pi;nn++)qe=qe>>>8^Qe[(qe^f[nn])&255];return qe^-1};var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init,_tr_stored_block,_tr_flush_block,_tr_tally,_tr_align}=trees,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$2,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,GZIP_STATE=57,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(qe,f)=>(qe.msg=messages[f],f),rank=qe=>qe*2-(qe>4?9:0),zero=qe=>{let f=qe.length;for(;--f>=0;)qe[f]=0},slide_hash=qe=>{let f,ze,Ke,Qe=qe.w_size;f=qe.hash_size,Ke=f;do ze=qe.head[--Ke],qe.head[Ke]=ze>=Qe?ze-Qe:0;while(--f);f=Qe,Ke=f;do ze=qe.prev[--Ke],qe.prev[Ke]=ze>=Qe?ze-Qe:0;while(--f)};let HASH_ZLIB=(qe,f,ze)=>(f<<qe.hash_shift^ze)&qe.hash_mask,HASH=HASH_ZLIB;const flush_pending=qe=>{const f=qe.state;let ze=f.pending;ze>qe.avail_out&&(ze=qe.avail_out),ze!==0&&(qe.output.set(f.pending_buf.subarray(f.pending_out,f.pending_out+ze),qe.next_out),qe.next_out+=ze,f.pending_out+=ze,qe.total_out+=ze,qe.avail_out-=ze,f.pending-=ze,f.pending===0&&(f.pending_out=0))},flush_block_only=(qe,f)=>{_tr_flush_block(qe,qe.block_start>=0?qe.block_start:-1,qe.strstart-qe.block_start,f),qe.block_start=qe.strstart,flush_pending(qe.strm)},put_byte=(qe,f)=>{qe.pending_buf[qe.pending++]=f},putShortMSB=(qe,f)=>{qe.pending_buf[qe.pending++]=f>>>8&255,qe.pending_buf[qe.pending++]=f&255},read_buf=(qe,f,ze,Ke)=>{let Qe=qe.avail_in;return Qe>Ke&&(Qe=Ke),Qe===0?0:(qe.avail_in-=Qe,f.set(qe.input.subarray(qe.next_in,qe.next_in+Qe),ze),qe.state.wrap===1?qe.adler=adler32_1(qe.adler,f,Qe,ze):qe.state.wrap===2&&(qe.adler=crc32_1(qe.adler,f,Qe,ze)),qe.next_in+=Qe,qe.total_in+=Qe,Qe)},longest_match=(qe,f)=>{let ze=qe.max_chain_length,Ke=qe.strstart,Qe,Pi,nn=qe.prev_length,ln=qe.nice_match;const cn=qe.strstart>qe.w_size-MIN_LOOKAHEAD?qe.strstart-(qe.w_size-MIN_LOOKAHEAD):0,hn=qe.window,un=qe.w_mask,xs=qe.prev,zn=qe.strstart+MAX_MATCH;let Xn=hn[Ke+nn-1],ys=hn[Ke+nn];qe.prev_length>=qe.good_match&&(ze>>=2),ln>qe.lookahead&&(ln=qe.lookahead);do if(Qe=f,!(hn[Qe+nn]!==ys||hn[Qe+nn-1]!==Xn||hn[Qe]!==hn[Ke]||hn[++Qe]!==hn[Ke+1])){Ke+=2,Qe++;do;while(hn[++Ke]===hn[++Qe]&&hn[++Ke]===hn[++Qe]&&hn[++Ke]===hn[++Qe]&&hn[++Ke]===hn[++Qe]&&hn[++Ke]===hn[++Qe]&&hn[++Ke]===hn[++Qe]&&hn[++Ke]===hn[++Qe]&&hn[++Ke]===hn[++Qe]&&Ke<zn);if(Pi=MAX_MATCH-(zn-Ke),Ke=zn-MAX_MATCH,Pi>nn){if(qe.match_start=f,nn=Pi,Pi>=ln)break;Xn=hn[Ke+nn-1],ys=hn[Ke+nn]}}while((f=xs[f&un])>cn&&--ze!==0);return nn<=qe.lookahead?nn:qe.lookahead},fill_window=qe=>{const f=qe.w_size;let ze,Ke,Qe;do{if(Ke=qe.window_size-qe.lookahead-qe.strstart,qe.strstart>=f+(f-MIN_LOOKAHEAD)&&(qe.window.set(qe.window.subarray(f,f+f-Ke),0),qe.match_start-=f,qe.strstart-=f,qe.block_start-=f,qe.insert>qe.strstart&&(qe.insert=qe.strstart),slide_hash(qe),Ke+=f),qe.strm.avail_in===0)break;if(ze=read_buf(qe.strm,qe.window,qe.strstart+qe.lookahead,Ke),qe.lookahead+=ze,qe.lookahead+qe.insert>=MIN_MATCH)for(Qe=qe.strstart-qe.insert,qe.ins_h=qe.window[Qe],qe.ins_h=HASH(qe,qe.ins_h,qe.window[Qe+1]);qe.insert&&(qe.ins_h=HASH(qe,qe.ins_h,qe.window[Qe+MIN_MATCH-1]),qe.prev[Qe&qe.w_mask]=qe.head[qe.ins_h],qe.head[qe.ins_h]=Qe,Qe++,qe.insert--,!(qe.lookahead+qe.insert<MIN_MATCH)););}while(qe.lookahead<MIN_LOOKAHEAD&&qe.strm.avail_in!==0)},deflate_stored=(qe,f)=>{let ze=qe.pending_buf_size-5>qe.w_size?qe.w_size:qe.pending_buf_size-5,Ke,Qe,Pi,nn=0,ln=qe.strm.avail_in;do{if(Ke=65535,Pi=qe.bi_valid+42>>3,qe.strm.avail_out<Pi||(Pi=qe.strm.avail_out-Pi,Qe=qe.strstart-qe.block_start,Ke>Qe+qe.strm.avail_in&&(Ke=Qe+qe.strm.avail_in),Ke>Pi&&(Ke=Pi),Ke<ze&&(Ke===0&&f!==Z_FINISH$3||f===Z_NO_FLUSH$2||Ke!==Qe+qe.strm.avail_in)))break;nn=f===Z_FINISH$3&&Ke===Qe+qe.strm.avail_in?1:0,_tr_stored_block(qe,0,0,nn),qe.pending_buf[qe.pending-4]=Ke,qe.pending_buf[qe.pending-3]=Ke>>8,qe.pending_buf[qe.pending-2]=~Ke,qe.pending_buf[qe.pending-1]=~Ke>>8,flush_pending(qe.strm),Qe&&(Qe>Ke&&(Qe=Ke),qe.strm.output.set(qe.window.subarray(qe.block_start,qe.block_start+Qe),qe.strm.next_out),qe.strm.next_out+=Qe,qe.strm.avail_out-=Qe,qe.strm.total_out+=Qe,qe.block_start+=Qe,Ke-=Qe),Ke&&(read_buf(qe.strm,qe.strm.output,qe.strm.next_out,Ke),qe.strm.next_out+=Ke,qe.strm.avail_out-=Ke,qe.strm.total_out+=Ke)}while(nn===0);return ln-=qe.strm.avail_in,ln&&(ln>=qe.w_size?(qe.matches=2,qe.window.set(qe.strm.input.subarray(qe.strm.next_in-qe.w_size,qe.strm.next_in),0),qe.strstart=qe.w_size,qe.insert=qe.strstart):(qe.window_size-qe.strstart<=ln&&(qe.strstart-=qe.w_size,qe.window.set(qe.window.subarray(qe.w_size,qe.w_size+qe.strstart),0),qe.matches<2&&qe.matches++,qe.insert>qe.strstart&&(qe.insert=qe.strstart)),qe.window.set(qe.strm.input.subarray(qe.strm.next_in-ln,qe.strm.next_in),qe.strstart),qe.strstart+=ln,qe.insert+=ln>qe.w_size-qe.insert?qe.w_size-qe.insert:ln),qe.block_start=qe.strstart),qe.high_water<qe.strstart&&(qe.high_water=qe.strstart),nn?BS_FINISH_DONE:f!==Z_NO_FLUSH$2&&f!==Z_FINISH$3&&qe.strm.avail_in===0&&qe.strstart===qe.block_start?BS_BLOCK_DONE:(Pi=qe.window_size-qe.strstart,qe.strm.avail_in>Pi&&qe.block_start>=qe.w_size&&(qe.block_start-=qe.w_size,qe.strstart-=qe.w_size,qe.window.set(qe.window.subarray(qe.w_size,qe.w_size+qe.strstart),0),qe.matches<2&&qe.matches++,Pi+=qe.w_size,qe.insert>qe.strstart&&(qe.insert=qe.strstart)),Pi>qe.strm.avail_in&&(Pi=qe.strm.avail_in),Pi&&(read_buf(qe.strm,qe.window,qe.strstart,Pi),qe.strstart+=Pi,qe.insert+=Pi>qe.w_size-qe.insert?qe.w_size-qe.insert:Pi),qe.high_water<qe.strstart&&(qe.high_water=qe.strstart),Pi=qe.bi_valid+42>>3,Pi=qe.pending_buf_size-Pi>65535?65535:qe.pending_buf_size-Pi,ze=Pi>qe.w_size?qe.w_size:Pi,Qe=qe.strstart-qe.block_start,(Qe>=ze||(Qe||f===Z_FINISH$3)&&f!==Z_NO_FLUSH$2&&qe.strm.avail_in===0&&Qe<=Pi)&&(Ke=Qe>Pi?Pi:Qe,nn=f===Z_FINISH$3&&qe.strm.avail_in===0&&Ke===Qe?1:0,_tr_stored_block(qe,qe.block_start,Ke,nn),qe.block_start+=Ke,flush_pending(qe.strm)),nn?BS_FINISH_STARTED:BS_NEED_MORE)},deflate_fast=(qe,f)=>{let ze,Ke;for(;;){if(qe.lookahead<MIN_LOOKAHEAD){if(fill_window(qe),qe.lookahead<MIN_LOOKAHEAD&&f===Z_NO_FLUSH$2)return BS_NEED_MORE;if(qe.lookahead===0)break}if(ze=0,qe.lookahead>=MIN_MATCH&&(qe.ins_h=HASH(qe,qe.ins_h,qe.window[qe.strstart+MIN_MATCH-1]),ze=qe.prev[qe.strstart&qe.w_mask]=qe.head[qe.ins_h],qe.head[qe.ins_h]=qe.strstart),ze!==0&&qe.strstart-ze<=qe.w_size-MIN_LOOKAHEAD&&(qe.match_length=longest_match(qe,ze)),qe.match_length>=MIN_MATCH)if(Ke=_tr_tally(qe,qe.strstart-qe.match_start,qe.match_length-MIN_MATCH),qe.lookahead-=qe.match_length,qe.match_length<=qe.max_lazy_match&&qe.lookahead>=MIN_MATCH){qe.match_length--;do qe.strstart++,qe.ins_h=HASH(qe,qe.ins_h,qe.window[qe.strstart+MIN_MATCH-1]),ze=qe.prev[qe.strstart&qe.w_mask]=qe.head[qe.ins_h],qe.head[qe.ins_h]=qe.strstart;while(--qe.match_length!==0);qe.strstart++}else qe.strstart+=qe.match_length,qe.match_length=0,qe.ins_h=qe.window[qe.strstart],qe.ins_h=HASH(qe,qe.ins_h,qe.window[qe.strstart+1]);else Ke=_tr_tally(qe,0,qe.window[qe.strstart]),qe.lookahead--,qe.strstart++;if(Ke&&(flush_block_only(qe,!1),qe.strm.avail_out===0))return BS_NEED_MORE}return qe.insert=qe.strstart<MIN_MATCH-1?qe.strstart:MIN_MATCH-1,f===Z_FINISH$3?(flush_block_only(qe,!0),qe.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):qe.sym_next&&(flush_block_only(qe,!1),qe.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(qe,f)=>{let ze,Ke,Qe;for(;;){if(qe.lookahead<MIN_LOOKAHEAD){if(fill_window(qe),qe.lookahead<MIN_LOOKAHEAD&&f===Z_NO_FLUSH$2)return BS_NEED_MORE;if(qe.lookahead===0)break}if(ze=0,qe.lookahead>=MIN_MATCH&&(qe.ins_h=HASH(qe,qe.ins_h,qe.window[qe.strstart+MIN_MATCH-1]),ze=qe.prev[qe.strstart&qe.w_mask]=qe.head[qe.ins_h],qe.head[qe.ins_h]=qe.strstart),qe.prev_length=qe.match_length,qe.prev_match=qe.match_start,qe.match_length=MIN_MATCH-1,ze!==0&&qe.prev_length<qe.max_lazy_match&&qe.strstart-ze<=qe.w_size-MIN_LOOKAHEAD&&(qe.match_length=longest_match(qe,ze),qe.match_length<=5&&(qe.strategy===Z_FILTERED||qe.match_length===MIN_MATCH&&qe.strstart-qe.match_start>4096)&&(qe.match_length=MIN_MATCH-1)),qe.prev_length>=MIN_MATCH&&qe.match_length<=qe.prev_length){Qe=qe.strstart+qe.lookahead-MIN_MATCH,Ke=_tr_tally(qe,qe.strstart-1-qe.prev_match,qe.prev_length-MIN_MATCH),qe.lookahead-=qe.prev_length-1,qe.prev_length-=2;do++qe.strstart<=Qe&&(qe.ins_h=HASH(qe,qe.ins_h,qe.window[qe.strstart+MIN_MATCH-1]),ze=qe.prev[qe.strstart&qe.w_mask]=qe.head[qe.ins_h],qe.head[qe.ins_h]=qe.strstart);while(--qe.prev_length!==0);if(qe.match_available=0,qe.match_length=MIN_MATCH-1,qe.strstart++,Ke&&(flush_block_only(qe,!1),qe.strm.avail_out===0))return BS_NEED_MORE}else if(qe.match_available){if(Ke=_tr_tally(qe,0,qe.window[qe.strstart-1]),Ke&&flush_block_only(qe,!1),qe.strstart++,qe.lookahead--,qe.strm.avail_out===0)return BS_NEED_MORE}else qe.match_available=1,qe.strstart++,qe.lookahead--}return qe.match_available&&(Ke=_tr_tally(qe,0,qe.window[qe.strstart-1]),qe.match_available=0),qe.insert=qe.strstart<MIN_MATCH-1?qe.strstart:MIN_MATCH-1,f===Z_FINISH$3?(flush_block_only(qe,!0),qe.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):qe.sym_next&&(flush_block_only(qe,!1),qe.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(qe,f)=>{let ze,Ke,Qe,Pi;const nn=qe.window;for(;;){if(qe.lookahead<=MAX_MATCH){if(fill_window(qe),qe.lookahead<=MAX_MATCH&&f===Z_NO_FLUSH$2)return BS_NEED_MORE;if(qe.lookahead===0)break}if(qe.match_length=0,qe.lookahead>=MIN_MATCH&&qe.strstart>0&&(Qe=qe.strstart-1,Ke=nn[Qe],Ke===nn[++Qe]&&Ke===nn[++Qe]&&Ke===nn[++Qe])){Pi=qe.strstart+MAX_MATCH;do;while(Ke===nn[++Qe]&&Ke===nn[++Qe]&&Ke===nn[++Qe]&&Ke===nn[++Qe]&&Ke===nn[++Qe]&&Ke===nn[++Qe]&&Ke===nn[++Qe]&&Ke===nn[++Qe]&&Qe<Pi);qe.match_length=MAX_MATCH-(Pi-Qe),qe.match_length>qe.lookahead&&(qe.match_length=qe.lookahead)}if(qe.match_length>=MIN_MATCH?(ze=_tr_tally(qe,1,qe.match_length-MIN_MATCH),qe.lookahead-=qe.match_length,qe.strstart+=qe.match_length,qe.match_length=0):(ze=_tr_tally(qe,0,qe.window[qe.strstart]),qe.lookahead--,qe.strstart++),ze&&(flush_block_only(qe,!1),qe.strm.avail_out===0))return BS_NEED_MORE}return qe.insert=0,f===Z_FINISH$3?(flush_block_only(qe,!0),qe.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):qe.sym_next&&(flush_block_only(qe,!1),qe.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(qe,f)=>{let ze;for(;;){if(qe.lookahead===0&&(fill_window(qe),qe.lookahead===0)){if(f===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(qe.match_length=0,ze=_tr_tally(qe,0,qe.window[qe.strstart]),qe.lookahead--,qe.strstart++,ze&&(flush_block_only(qe,!1),qe.strm.avail_out===0))return BS_NEED_MORE}return qe.insert=0,f===Z_FINISH$3?(flush_block_only(qe,!0),qe.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):qe.sym_next&&(flush_block_only(qe,!1),qe.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(qe,f,ze,Ke,Qe){this.good_length=qe,this.max_lazy=f,this.nice_length=ze,this.max_chain=Ke,this.func=Qe}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=qe=>{qe.window_size=2*qe.w_size,zero(qe.head),qe.max_lazy_match=configuration_table[qe.level].max_lazy,qe.good_match=configuration_table[qe.level].good_length,qe.nice_match=configuration_table[qe.level].nice_length,qe.max_chain_length=configuration_table[qe.level].max_chain,qe.strstart=0,qe.block_start=0,qe.lookahead=0,qe.insert=0,qe.match_length=qe.prev_length=MIN_MATCH-1,qe.match_available=0,qe.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE*2),this.dyn_dtree=new Uint16Array((2*D_CODES+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateStateCheck=qe=>{if(!qe)return 1;const f=qe.state;return!f||f.strm!==qe||f.status!==INIT_STATE&&f.status!==GZIP_STATE&&f.status!==EXTRA_STATE&&f.status!==NAME_STATE&&f.status!==COMMENT_STATE&&f.status!==HCRC_STATE&&f.status!==BUSY_STATE&&f.status!==FINISH_STATE?1:0},deflateResetKeep=qe=>{if(deflateStateCheck(qe))return err(qe,Z_STREAM_ERROR$2);qe.total_in=qe.total_out=0,qe.data_type=Z_UNKNOWN;const f=qe.state;return f.pending=0,f.pending_out=0,f.wrap<0&&(f.wrap=-f.wrap),f.status=f.wrap===2?GZIP_STATE:f.wrap?INIT_STATE:BUSY_STATE,qe.adler=f.wrap===2?0:1,f.last_flush=-2,_tr_init(f),Z_OK$3},deflateReset=qe=>{const f=deflateResetKeep(qe);return f===Z_OK$3&&lm_init(qe.state),f},deflateSetHeader=(qe,f)=>deflateStateCheck(qe)||qe.state.wrap!==2?Z_STREAM_ERROR$2:(qe.state.gzhead=f,Z_OK$3),deflateInit2=(qe,f,ze,Ke,Qe,Pi)=>{if(!qe)return Z_STREAM_ERROR$2;let nn=1;if(f===Z_DEFAULT_COMPRESSION$1&&(f=6),Ke<0?(nn=0,Ke=-Ke):Ke>15&&(nn=2,Ke-=16),Qe<1||Qe>MAX_MEM_LEVEL||ze!==Z_DEFLATED$2||Ke<8||Ke>15||f<0||f>9||Pi<0||Pi>Z_FIXED||Ke===8&&nn!==1)return err(qe,Z_STREAM_ERROR$2);Ke===8&&(Ke=9);const ln=new DeflateState;return qe.state=ln,ln.strm=qe,ln.status=INIT_STATE,ln.wrap=nn,ln.gzhead=null,ln.w_bits=Ke,ln.w_size=1<<ln.w_bits,ln.w_mask=ln.w_size-1,ln.hash_bits=Qe+7,ln.hash_size=1<<ln.hash_bits,ln.hash_mask=ln.hash_size-1,ln.hash_shift=~~((ln.hash_bits+MIN_MATCH-1)/MIN_MATCH),ln.window=new Uint8Array(ln.w_size*2),ln.head=new Uint16Array(ln.hash_size),ln.prev=new Uint16Array(ln.w_size),ln.lit_bufsize=1<<Qe+6,ln.pending_buf_size=ln.lit_bufsize*4,ln.pending_buf=new Uint8Array(ln.pending_buf_size),ln.sym_buf=ln.lit_bufsize,ln.sym_end=(ln.lit_bufsize-1)*3,ln.level=f,ln.strategy=Pi,ln.method=ze,deflateReset(qe)},deflateInit=(qe,f)=>deflateInit2(qe,f,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(qe,f)=>{if(deflateStateCheck(qe)||f>Z_BLOCK$1||f<0)return qe?err(qe,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const ze=qe.state;if(!qe.output||qe.avail_in!==0&&!qe.input||ze.status===FINISH_STATE&&f!==Z_FINISH$3)return err(qe,qe.avail_out===0?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);const Ke=ze.last_flush;if(ze.last_flush=f,ze.pending!==0){if(flush_pending(qe),qe.avail_out===0)return ze.last_flush=-1,Z_OK$3}else if(qe.avail_in===0&&rank(f)<=rank(Ke)&&f!==Z_FINISH$3)return err(qe,Z_BUF_ERROR$1);if(ze.status===FINISH_STATE&&qe.avail_in!==0)return err(qe,Z_BUF_ERROR$1);if(ze.status===INIT_STATE&&ze.wrap===0&&(ze.status=BUSY_STATE),ze.status===INIT_STATE){let Qe=Z_DEFLATED$2+(ze.w_bits-8<<4)<<8,Pi=-1;if(ze.strategy>=Z_HUFFMAN_ONLY||ze.level<2?Pi=0:ze.level<6?Pi=1:ze.level===6?Pi=2:Pi=3,Qe|=Pi<<6,ze.strstart!==0&&(Qe|=PRESET_DICT),Qe+=31-Qe%31,putShortMSB(ze,Qe),ze.strstart!==0&&(putShortMSB(ze,qe.adler>>>16),putShortMSB(ze,qe.adler&65535)),qe.adler=1,ze.status=BUSY_STATE,flush_pending(qe),ze.pending!==0)return ze.last_flush=-1,Z_OK$3}if(ze.status===GZIP_STATE){if(qe.adler=0,put_byte(ze,31),put_byte(ze,139),put_byte(ze,8),ze.gzhead)put_byte(ze,(ze.gzhead.text?1:0)+(ze.gzhead.hcrc?2:0)+(ze.gzhead.extra?4:0)+(ze.gzhead.name?8:0)+(ze.gzhead.comment?16:0)),put_byte(ze,ze.gzhead.time&255),put_byte(ze,ze.gzhead.time>>8&255),put_byte(ze,ze.gzhead.time>>16&255),put_byte(ze,ze.gzhead.time>>24&255),put_byte(ze,ze.level===9?2:ze.strategy>=Z_HUFFMAN_ONLY||ze.level<2?4:0),put_byte(ze,ze.gzhead.os&255),ze.gzhead.extra&&ze.gzhead.extra.length&&(put_byte(ze,ze.gzhead.extra.length&255),put_byte(ze,ze.gzhead.extra.length>>8&255)),ze.gzhead.hcrc&&(qe.adler=crc32_1(qe.adler,ze.pending_buf,ze.pending,0)),ze.gzindex=0,ze.status=EXTRA_STATE;else if(put_byte(ze,0),put_byte(ze,0),put_byte(ze,0),put_byte(ze,0),put_byte(ze,0),put_byte(ze,ze.level===9?2:ze.strategy>=Z_HUFFMAN_ONLY||ze.level<2?4:0),put_byte(ze,OS_CODE),ze.status=BUSY_STATE,flush_pending(qe),ze.pending!==0)return ze.last_flush=-1,Z_OK$3}if(ze.status===EXTRA_STATE){if(ze.gzhead.extra){let Qe=ze.pending,Pi=(ze.gzhead.extra.length&65535)-ze.gzindex;for(;ze.pending+Pi>ze.pending_buf_size;){let ln=ze.pending_buf_size-ze.pending;if(ze.pending_buf.set(ze.gzhead.extra.subarray(ze.gzindex,ze.gzindex+ln),ze.pending),ze.pending=ze.pending_buf_size,ze.gzhead.hcrc&&ze.pending>Qe&&(qe.adler=crc32_1(qe.adler,ze.pending_buf,ze.pending-Qe,Qe)),ze.gzindex+=ln,flush_pending(qe),ze.pending!==0)return ze.last_flush=-1,Z_OK$3;Qe=0,Pi-=ln}let nn=new Uint8Array(ze.gzhead.extra);ze.pending_buf.set(nn.subarray(ze.gzindex,ze.gzindex+Pi),ze.pending),ze.pending+=Pi,ze.gzhead.hcrc&&ze.pending>Qe&&(qe.adler=crc32_1(qe.adler,ze.pending_buf,ze.pending-Qe,Qe)),ze.gzindex=0}ze.status=NAME_STATE}if(ze.status===NAME_STATE){if(ze.gzhead.name){let Qe=ze.pending,Pi;do{if(ze.pending===ze.pending_buf_size){if(ze.gzhead.hcrc&&ze.pending>Qe&&(qe.adler=crc32_1(qe.adler,ze.pending_buf,ze.pending-Qe,Qe)),flush_pending(qe),ze.pending!==0)return ze.last_flush=-1,Z_OK$3;Qe=0}ze.gzindex<ze.gzhead.name.length?Pi=ze.gzhead.name.charCodeAt(ze.gzindex++)&255:Pi=0,put_byte(ze,Pi)}while(Pi!==0);ze.gzhead.hcrc&&ze.pending>Qe&&(qe.adler=crc32_1(qe.adler,ze.pending_buf,ze.pending-Qe,Qe)),ze.gzindex=0}ze.status=COMMENT_STATE}if(ze.status===COMMENT_STATE){if(ze.gzhead.comment){let Qe=ze.pending,Pi;do{if(ze.pending===ze.pending_buf_size){if(ze.gzhead.hcrc&&ze.pending>Qe&&(qe.adler=crc32_1(qe.adler,ze.pending_buf,ze.pending-Qe,Qe)),flush_pending(qe),ze.pending!==0)return ze.last_flush=-1,Z_OK$3;Qe=0}ze.gzindex<ze.gzhead.comment.length?Pi=ze.gzhead.comment.charCodeAt(ze.gzindex++)&255:Pi=0,put_byte(ze,Pi)}while(Pi!==0);ze.gzhead.hcrc&&ze.pending>Qe&&(qe.adler=crc32_1(qe.adler,ze.pending_buf,ze.pending-Qe,Qe))}ze.status=HCRC_STATE}if(ze.status===HCRC_STATE){if(ze.gzhead.hcrc){if(ze.pending+2>ze.pending_buf_size&&(flush_pending(qe),ze.pending!==0))return ze.last_flush=-1,Z_OK$3;put_byte(ze,qe.adler&255),put_byte(ze,qe.adler>>8&255),qe.adler=0}if(ze.status=BUSY_STATE,flush_pending(qe),ze.pending!==0)return ze.last_flush=-1,Z_OK$3}if(qe.avail_in!==0||ze.lookahead!==0||f!==Z_NO_FLUSH$2&&ze.status!==FINISH_STATE){let Qe=ze.level===0?deflate_stored(ze,f):ze.strategy===Z_HUFFMAN_ONLY?deflate_huff(ze,f):ze.strategy===Z_RLE?deflate_rle(ze,f):configuration_table[ze.level].func(ze,f);if((Qe===BS_FINISH_STARTED||Qe===BS_FINISH_DONE)&&(ze.status=FINISH_STATE),Qe===BS_NEED_MORE||Qe===BS_FINISH_STARTED)return qe.avail_out===0&&(ze.last_flush=-1),Z_OK$3;if(Qe===BS_BLOCK_DONE&&(f===Z_PARTIAL_FLUSH?_tr_align(ze):f!==Z_BLOCK$1&&(_tr_stored_block(ze,0,0,!1),f===Z_FULL_FLUSH$1&&(zero(ze.head),ze.lookahead===0&&(ze.strstart=0,ze.block_start=0,ze.insert=0))),flush_pending(qe),qe.avail_out===0))return ze.last_flush=-1,Z_OK$3}return f!==Z_FINISH$3?Z_OK$3:ze.wrap<=0?Z_STREAM_END$3:(ze.wrap===2?(put_byte(ze,qe.adler&255),put_byte(ze,qe.adler>>8&255),put_byte(ze,qe.adler>>16&255),put_byte(ze,qe.adler>>24&255),put_byte(ze,qe.total_in&255),put_byte(ze,qe.total_in>>8&255),put_byte(ze,qe.total_in>>16&255),put_byte(ze,qe.total_in>>24&255)):(putShortMSB(ze,qe.adler>>>16),putShortMSB(ze,qe.adler&65535)),flush_pending(qe),ze.wrap>0&&(ze.wrap=-ze.wrap),ze.pending!==0?Z_OK$3:Z_STREAM_END$3)},deflateEnd=qe=>{if(deflateStateCheck(qe))return Z_STREAM_ERROR$2;const f=qe.state.status;return qe.state=null,f===BUSY_STATE?err(qe,Z_DATA_ERROR$2):Z_OK$3},deflateSetDictionary=(qe,f)=>{let ze=f.length;if(deflateStateCheck(qe))return Z_STREAM_ERROR$2;const Ke=qe.state,Qe=Ke.wrap;if(Qe===2||Qe===1&&Ke.status!==INIT_STATE||Ke.lookahead)return Z_STREAM_ERROR$2;if(Qe===1&&(qe.adler=adler32_1(qe.adler,f,ze,0)),Ke.wrap=0,ze>=Ke.w_size){Qe===0&&(zero(Ke.head),Ke.strstart=0,Ke.block_start=0,Ke.insert=0);let cn=new Uint8Array(Ke.w_size);cn.set(f.subarray(ze-Ke.w_size,ze),0),f=cn,ze=Ke.w_size}const Pi=qe.avail_in,nn=qe.next_in,ln=qe.input;for(qe.avail_in=ze,qe.next_in=0,qe.input=f,fill_window(Ke);Ke.lookahead>=MIN_MATCH;){let cn=Ke.strstart,hn=Ke.lookahead-(MIN_MATCH-1);do Ke.ins_h=HASH(Ke,Ke.ins_h,Ke.window[cn+MIN_MATCH-1]),Ke.prev[cn&Ke.w_mask]=Ke.head[Ke.ins_h],Ke.head[Ke.ins_h]=cn,cn++;while(--hn);Ke.strstart=cn,Ke.lookahead=MIN_MATCH-1,fill_window(Ke)}return Ke.strstart+=Ke.lookahead,Ke.block_start=Ke.strstart,Ke.insert=Ke.lookahead,Ke.lookahead=0,Ke.match_length=Ke.prev_length=MIN_MATCH-1,Ke.match_available=0,qe.next_in=nn,qe.input=ln,qe.avail_in=Pi,Ke.wrap=Qe,Z_OK$3};var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2$1=deflate$2,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1$2={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2$1,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo};const _has=(qe,f)=>Object.prototype.hasOwnProperty.call(qe,f);var assign=function(qe){const f=Array.prototype.slice.call(arguments,1);for(;f.length;){const ze=f.shift();if(ze){if(typeof ze!="object")throw new TypeError(ze+"must be non-object");for(const Ke in ze)_has(ze,Ke)&&(qe[Ke]=ze[Ke])}}return qe},flattenChunks=qe=>{let f=0;for(let Ke=0,Qe=qe.length;Ke<Qe;Ke++)f+=qe[Ke].length;const ze=new Uint8Array(f);for(let Ke=0,Qe=0,Pi=qe.length;Ke<Pi;Ke++){let nn=qe[Ke];ze.set(nn,Qe),Qe+=nn.length}return ze},common={assign,flattenChunks};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let qe=0;qe<256;qe++)_utf8len[qe]=qe>=252?6:qe>=248?5:qe>=240?4:qe>=224?3:qe>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=qe=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(qe);let f,ze,Ke,Qe,Pi,nn=qe.length,ln=0;for(Qe=0;Qe<nn;Qe++)ze=qe.charCodeAt(Qe),(ze&64512)===55296&&Qe+1<nn&&(Ke=qe.charCodeAt(Qe+1),(Ke&64512)===56320&&(ze=65536+(ze-55296<<10)+(Ke-56320),Qe++)),ln+=ze<128?1:ze<2048?2:ze<65536?3:4;for(f=new Uint8Array(ln),Pi=0,Qe=0;Pi<ln;Qe++)ze=qe.charCodeAt(Qe),(ze&64512)===55296&&Qe+1<nn&&(Ke=qe.charCodeAt(Qe+1),(Ke&64512)===56320&&(ze=65536+(ze-55296<<10)+(Ke-56320),Qe++)),ze<128?f[Pi++]=ze:ze<2048?(f[Pi++]=192|ze>>>6,f[Pi++]=128|ze&63):ze<65536?(f[Pi++]=224|ze>>>12,f[Pi++]=128|ze>>>6&63,f[Pi++]=128|ze&63):(f[Pi++]=240|ze>>>18,f[Pi++]=128|ze>>>12&63,f[Pi++]=128|ze>>>6&63,f[Pi++]=128|ze&63);return f};const buf2binstring=(qe,f)=>{if(f<65534&&qe.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,qe.length===f?qe:qe.subarray(0,f));let ze="";for(let Ke=0;Ke<f;Ke++)ze+=String.fromCharCode(qe[Ke]);return ze};var buf2string=(qe,f)=>{const ze=f||qe.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(qe.subarray(0,f));let Ke,Qe;const Pi=new Array(ze*2);for(Qe=0,Ke=0;Ke<ze;){let nn=qe[Ke++];if(nn<128){Pi[Qe++]=nn;continue}let ln=_utf8len[nn];if(ln>4){Pi[Qe++]=65533,Ke+=ln-1;continue}for(nn&=ln===2?31:ln===3?15:7;ln>1&&Ke<ze;)nn=nn<<6|qe[Ke++]&63,ln--;if(ln>1){Pi[Qe++]=65533;continue}nn<65536?Pi[Qe++]=nn:(nn-=65536,Pi[Qe++]=55296|nn>>10&1023,Pi[Qe++]=56320|nn&1023)}return buf2binstring(Pi,Qe)},utf8border=(qe,f)=>{f=f||qe.length,f>qe.length&&(f=qe.length);let ze=f-1;for(;ze>=0&&(qe[ze]&192)===128;)ze--;return ze<0||ze===0?f:ze+_utf8len[qe[ze]]>f?ze:f},strings={string2buf,buf2string,utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream;const toString$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$2;function Deflate$1(qe){this.options=common.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},qe||{});let f=this.options;f.raw&&f.windowBits>0?f.windowBits=-f.windowBits:f.gzip&&f.windowBits>0&&f.windowBits<16&&(f.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let ze=deflate_1$2.deflateInit2(this.strm,f.level,f.method,f.windowBits,f.memLevel,f.strategy);if(ze!==Z_OK$2)throw new Error(messages[ze]);if(f.header&&deflate_1$2.deflateSetHeader(this.strm,f.header),f.dictionary){let Ke;if(typeof f.dictionary=="string"?Ke=strings.string2buf(f.dictionary):toString$1.call(f.dictionary)==="[object ArrayBuffer]"?Ke=new Uint8Array(f.dictionary):Ke=f.dictionary,ze=deflate_1$2.deflateSetDictionary(this.strm,Ke),ze!==Z_OK$2)throw new Error(messages[ze]);this._dict_set=!0}}Deflate$1.prototype.push=function(qe,f){const ze=this.strm,Ke=this.options.chunkSize;let Qe,Pi;if(this.ended)return!1;for(f===~~f?Pi=f:Pi=f===!0?Z_FINISH$2:Z_NO_FLUSH$1,typeof qe=="string"?ze.input=strings.string2buf(qe):toString$1.call(qe)==="[object ArrayBuffer]"?ze.input=new Uint8Array(qe):ze.input=qe,ze.next_in=0,ze.avail_in=ze.input.length;;){if(ze.avail_out===0&&(ze.output=new Uint8Array(Ke),ze.next_out=0,ze.avail_out=Ke),(Pi===Z_SYNC_FLUSH||Pi===Z_FULL_FLUSH)&&ze.avail_out<=6){this.onData(ze.output.subarray(0,ze.next_out)),ze.avail_out=0;continue}if(Qe=deflate_1$2.deflate(ze,Pi),Qe===Z_STREAM_END$2)return ze.next_out>0&&this.onData(ze.output.subarray(0,ze.next_out)),Qe=deflate_1$2.deflateEnd(this.strm),this.onEnd(Qe),this.ended=!0,Qe===Z_OK$2;if(ze.avail_out===0){this.onData(ze.output);continue}if(Pi>0&&ze.next_out>0){this.onData(ze.output.subarray(0,ze.next_out)),ze.avail_out=0;continue}if(ze.avail_in===0)break}return!0};Deflate$1.prototype.onData=function(qe){this.chunks.push(qe)};Deflate$1.prototype.onEnd=function(qe){qe===Z_OK$2&&(this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=qe,this.msg=this.strm.msg};function deflate$1(qe,f){const ze=new Deflate$1(f);if(ze.push(qe,!0),ze.err)throw ze.msg||messages[ze.err];return ze.result}var deflate_2=deflate$1,deflate_1$1={deflate:deflate_2};const BAD$1=16209,TYPE$1=16191;var inffast=function(f,ze){let Ke,Qe,Pi,nn,ln,cn,hn,un,xs,zn,Xn,ys,Jo,ea,ra,na,ta,ia,sa,Ma,pa,oa,ha,ca;const da=f.state;Ke=f.next_in,ha=f.input,Qe=Ke+(f.avail_in-5),Pi=f.next_out,ca=f.output,nn=Pi-(ze-f.avail_out),ln=Pi+(f.avail_out-257),cn=da.dmax,hn=da.wsize,un=da.whave,xs=da.wnext,zn=da.window,Xn=da.hold,ys=da.bits,Jo=da.lencode,ea=da.distcode,ra=(1<<da.lenbits)-1,na=(1<<da.distbits)-1;e:do{ys<15&&(Xn+=ha[Ke++]<<ys,ys+=8,Xn+=ha[Ke++]<<ys,ys+=8),ta=Jo[Xn&ra];t:for(;;){if(ia=ta>>>24,Xn>>>=ia,ys-=ia,ia=ta>>>16&255,ia===0)ca[Pi++]=ta&65535;else if(ia&16){sa=ta&65535,ia&=15,ia&&(ys<ia&&(Xn+=ha[Ke++]<<ys,ys+=8),sa+=Xn&(1<<ia)-1,Xn>>>=ia,ys-=ia),ys<15&&(Xn+=ha[Ke++]<<ys,ys+=8,Xn+=ha[Ke++]<<ys,ys+=8),ta=ea[Xn&na];r:for(;;){if(ia=ta>>>24,Xn>>>=ia,ys-=ia,ia=ta>>>16&255,ia&16){if(Ma=ta&65535,ia&=15,ys<ia&&(Xn+=ha[Ke++]<<ys,ys+=8,ys<ia&&(Xn+=ha[Ke++]<<ys,ys+=8)),Ma+=Xn&(1<<ia)-1,Ma>cn){f.msg="invalid distance too far back",da.mode=BAD$1;break e}if(Xn>>>=ia,ys-=ia,ia=Pi-nn,Ma>ia){if(ia=Ma-ia,ia>un&&da.sane){f.msg="invalid distance too far back",da.mode=BAD$1;break e}if(pa=0,oa=zn,xs===0){if(pa+=hn-ia,ia<sa){sa-=ia;do ca[Pi++]=zn[pa++];while(--ia);pa=Pi-Ma,oa=ca}}else if(xs<ia){if(pa+=hn+xs-ia,ia-=xs,ia<sa){sa-=ia;do ca[Pi++]=zn[pa++];while(--ia);if(pa=0,xs<sa){ia=xs,sa-=ia;do ca[Pi++]=zn[pa++];while(--ia);pa=Pi-Ma,oa=ca}}}else if(pa+=xs-ia,ia<sa){sa-=ia;do ca[Pi++]=zn[pa++];while(--ia);pa=Pi-Ma,oa=ca}for(;sa>2;)ca[Pi++]=oa[pa++],ca[Pi++]=oa[pa++],ca[Pi++]=oa[pa++],sa-=3;sa&&(ca[Pi++]=oa[pa++],sa>1&&(ca[Pi++]=oa[pa++]))}else{pa=Pi-Ma;do ca[Pi++]=ca[pa++],ca[Pi++]=ca[pa++],ca[Pi++]=ca[pa++],sa-=3;while(sa>2);sa&&(ca[Pi++]=ca[pa++],sa>1&&(ca[Pi++]=ca[pa++]))}}else if((ia&64)===0){ta=ea[(ta&65535)+(Xn&(1<<ia)-1)];continue r}else{f.msg="invalid distance code",da.mode=BAD$1;break e}break}}else if((ia&64)===0){ta=Jo[(ta&65535)+(Xn&(1<<ia)-1)];continue t}else if(ia&32){da.mode=TYPE$1;break e}else{f.msg="invalid literal/length code",da.mode=BAD$1;break e}break}}while(Ke<Qe&&Pi<ln);sa=ys>>3,Ke-=sa,ys-=sa<<3,Xn&=(1<<ys)-1,f.next_in=Ke,f.next_out=Pi,f.avail_in=Ke<Qe?5+(Qe-Ke):5-(Ke-Qe),f.avail_out=Pi<ln?257+(ln-Pi):257-(Pi-ln),da.hold=Xn,da.bits=ys};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table=(qe,f,ze,Ke,Qe,Pi,nn,ln)=>{const cn=ln.bits;let hn=0,un=0,xs=0,zn=0,Xn=0,ys=0,Jo=0,ea=0,ra=0,na=0,ta,ia,sa,Ma,pa,oa=null,ha;const ca=new Uint16Array(MAXBITS+1),da=new Uint16Array(MAXBITS+1);let ga=null,qa,Ka,il;for(hn=0;hn<=MAXBITS;hn++)ca[hn]=0;for(un=0;un<Ke;un++)ca[f[ze+un]]++;for(Xn=cn,zn=MAXBITS;zn>=1&&ca[zn]===0;zn--);if(Xn>zn&&(Xn=zn),zn===0)return Qe[Pi++]=1<<24|64<<16|0,Qe[Pi++]=1<<24|64<<16|0,ln.bits=1,0;for(xs=1;xs<zn&&ca[xs]===0;xs++);for(Xn<xs&&(Xn=xs),ea=1,hn=1;hn<=MAXBITS;hn++)if(ea<<=1,ea-=ca[hn],ea<0)return-1;if(ea>0&&(qe===CODES$1||zn!==1))return-1;for(da[1]=0,hn=1;hn<MAXBITS;hn++)da[hn+1]=da[hn]+ca[hn];for(un=0;un<Ke;un++)f[ze+un]!==0&&(nn[da[f[ze+un]]++]=un);if(qe===CODES$1?(oa=ga=nn,ha=20):qe===LENS$1?(oa=lbase,ga=lext,ha=257):(oa=dbase,ga=dext,ha=0),na=0,un=0,hn=xs,pa=Pi,ys=Xn,Jo=0,sa=-1,ra=1<<Xn,Ma=ra-1,qe===LENS$1&&ra>ENOUGH_LENS$1||qe===DISTS$1&&ra>ENOUGH_DISTS$1)return 1;for(;;){qa=hn-Jo,nn[un]+1<ha?(Ka=0,il=nn[un]):nn[un]>=ha?(Ka=ga[nn[un]-ha],il=oa[nn[un]-ha]):(Ka=96,il=0),ta=1<<hn-Jo,ia=1<<ys,xs=ia;do ia-=ta,Qe[pa+(na>>Jo)+ia]=qa<<24|Ka<<16|il|0;while(ia!==0);for(ta=1<<hn-1;na&ta;)ta>>=1;if(ta!==0?(na&=ta-1,na+=ta):na=0,un++,--ca[hn]===0){if(hn===zn)break;hn=f[ze+nn[un]]}if(hn>Xn&&(na&Ma)!==sa){for(Jo===0&&(Jo=Xn),pa+=xs,ys=hn-Jo,ea=1<<ys;ys+Jo<zn&&(ea-=ca[ys+Jo],!(ea<=0));)ys++,ea<<=1;if(ra+=1<<ys,qe===LENS$1&&ra>ENOUGH_LENS$1||qe===DISTS$1&&ra>ENOUGH_DISTS$1)return 1;sa=na&Ma,Qe[sa]=Xn<<24|ys<<16|pa-Pi|0}}return na!==0&&(Qe[pa+na]=hn-Jo<<24|64<<16|0),ln.bits=Xn,0};var inftrees=inflate_table;const CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK,Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR,Z_DEFLATED}=constants$2,HEAD=16180,FLAGS=16181,TIME=16182,OS=16183,EXLEN=16184,EXTRA=16185,NAME=16186,COMMENT=16187,HCRC=16188,DICTID=16189,DICT=16190,TYPE=16191,TYPEDO=16192,STORED=16193,COPY_=16194,COPY=16195,TABLE=16196,LENLENS=16197,CODELENS=16198,LEN_=16199,LEN=16200,LENEXT=16201,DIST=16202,DISTEXT=16203,MATCH=16204,LIT=16205,CHECK=16206,LENGTH=16207,DONE=16208,BAD=16209,MEM=16210,SYNC=16211,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=qe=>(qe>>>24&255)+(qe>>>8&65280)+((qe&65280)<<8)+((qe&255)<<24);function InflateState(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateStateCheck=qe=>{if(!qe)return 1;const f=qe.state;return!f||f.strm!==qe||f.mode<HEAD||f.mode>SYNC?1:0},inflateResetKeep=qe=>{if(inflateStateCheck(qe))return Z_STREAM_ERROR$1;const f=qe.state;return qe.total_in=qe.total_out=f.total=0,qe.msg="",f.wrap&&(qe.adler=f.wrap&1),f.mode=HEAD,f.last=0,f.havedict=0,f.flags=-1,f.dmax=32768,f.head=null,f.hold=0,f.bits=0,f.lencode=f.lendyn=new Int32Array(ENOUGH_LENS),f.distcode=f.distdyn=new Int32Array(ENOUGH_DISTS),f.sane=1,f.back=-1,Z_OK$1},inflateReset=qe=>{if(inflateStateCheck(qe))return Z_STREAM_ERROR$1;const f=qe.state;return f.wsize=0,f.whave=0,f.wnext=0,inflateResetKeep(qe)},inflateReset2=(qe,f)=>{let ze;if(inflateStateCheck(qe))return Z_STREAM_ERROR$1;const Ke=qe.state;return f<0?(ze=0,f=-f):(ze=(f>>4)+5,f<48&&(f&=15)),f&&(f<8||f>15)?Z_STREAM_ERROR$1:(Ke.window!==null&&Ke.wbits!==f&&(Ke.window=null),Ke.wrap=ze,Ke.wbits=f,inflateReset(qe))},inflateInit2=(qe,f)=>{if(!qe)return Z_STREAM_ERROR$1;const ze=new InflateState;qe.state=ze,ze.strm=qe,ze.window=null,ze.mode=HEAD;const Ke=inflateReset2(qe,f);return Ke!==Z_OK$1&&(qe.state=null),Ke},inflateInit=qe=>inflateInit2(qe,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=qe=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let f=0;for(;f<144;)qe.lens[f++]=8;for(;f<256;)qe.lens[f++]=9;for(;f<280;)qe.lens[f++]=7;for(;f<288;)qe.lens[f++]=8;for(inftrees(LENS,qe.lens,0,288,lenfix,0,qe.work,{bits:9}),f=0;f<32;)qe.lens[f++]=5;inftrees(DISTS,qe.lens,0,32,distfix,0,qe.work,{bits:5}),virgin=!1}qe.lencode=lenfix,qe.lenbits=9,qe.distcode=distfix,qe.distbits=5},updatewindow=(qe,f,ze,Ke)=>{let Qe;const Pi=qe.state;return Pi.window===null&&(Pi.wsize=1<<Pi.wbits,Pi.wnext=0,Pi.whave=0,Pi.window=new Uint8Array(Pi.wsize)),Ke>=Pi.wsize?(Pi.window.set(f.subarray(ze-Pi.wsize,ze),0),Pi.wnext=0,Pi.whave=Pi.wsize):(Qe=Pi.wsize-Pi.wnext,Qe>Ke&&(Qe=Ke),Pi.window.set(f.subarray(ze-Ke,ze-Ke+Qe),Pi.wnext),Ke-=Qe,Ke?(Pi.window.set(f.subarray(ze-Ke,ze),0),Pi.wnext=Ke,Pi.whave=Pi.wsize):(Pi.wnext+=Qe,Pi.wnext===Pi.wsize&&(Pi.wnext=0),Pi.whave<Pi.wsize&&(Pi.whave+=Qe))),0},inflate$2=(qe,f)=>{let ze,Ke,Qe,Pi,nn,ln,cn,hn,un,xs,zn,Xn,ys,Jo,ea=0,ra,na,ta,ia,sa,Ma,pa,oa;const ha=new Uint8Array(4);let ca,da;const ga=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck(qe)||!qe.output||!qe.input&&qe.avail_in!==0)return Z_STREAM_ERROR$1;ze=qe.state,ze.mode===TYPE&&(ze.mode=TYPEDO),nn=qe.next_out,Qe=qe.output,cn=qe.avail_out,Pi=qe.next_in,Ke=qe.input,ln=qe.avail_in,hn=ze.hold,un=ze.bits,xs=ln,zn=cn,oa=Z_OK$1;e:for(;;)switch(ze.mode){case HEAD:if(ze.wrap===0){ze.mode=TYPEDO;break}for(;un<16;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}if(ze.wrap&2&&hn===35615){ze.wbits===0&&(ze.wbits=15),ze.check=0,ha[0]=hn&255,ha[1]=hn>>>8&255,ze.check=crc32_1(ze.check,ha,2,0),hn=0,un=0,ze.mode=FLAGS;break}if(ze.head&&(ze.head.done=!1),!(ze.wrap&1)||(((hn&255)<<8)+(hn>>8))%31){qe.msg="incorrect header check",ze.mode=BAD;break}if((hn&15)!==Z_DEFLATED){qe.msg="unknown compression method",ze.mode=BAD;break}if(hn>>>=4,un-=4,pa=(hn&15)+8,ze.wbits===0&&(ze.wbits=pa),pa>15||pa>ze.wbits){qe.msg="invalid window size",ze.mode=BAD;break}ze.dmax=1<<ze.wbits,ze.flags=0,qe.adler=ze.check=1,ze.mode=hn&512?DICTID:TYPE,hn=0,un=0;break;case FLAGS:for(;un<16;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}if(ze.flags=hn,(ze.flags&255)!==Z_DEFLATED){qe.msg="unknown compression method",ze.mode=BAD;break}if(ze.flags&57344){qe.msg="unknown header flags set",ze.mode=BAD;break}ze.head&&(ze.head.text=hn>>8&1),ze.flags&512&&ze.wrap&4&&(ha[0]=hn&255,ha[1]=hn>>>8&255,ze.check=crc32_1(ze.check,ha,2,0)),hn=0,un=0,ze.mode=TIME;case TIME:for(;un<32;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}ze.head&&(ze.head.time=hn),ze.flags&512&&ze.wrap&4&&(ha[0]=hn&255,ha[1]=hn>>>8&255,ha[2]=hn>>>16&255,ha[3]=hn>>>24&255,ze.check=crc32_1(ze.check,ha,4,0)),hn=0,un=0,ze.mode=OS;case OS:for(;un<16;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}ze.head&&(ze.head.xflags=hn&255,ze.head.os=hn>>8),ze.flags&512&&ze.wrap&4&&(ha[0]=hn&255,ha[1]=hn>>>8&255,ze.check=crc32_1(ze.check,ha,2,0)),hn=0,un=0,ze.mode=EXLEN;case EXLEN:if(ze.flags&1024){for(;un<16;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}ze.length=hn,ze.head&&(ze.head.extra_len=hn),ze.flags&512&&ze.wrap&4&&(ha[0]=hn&255,ha[1]=hn>>>8&255,ze.check=crc32_1(ze.check,ha,2,0)),hn=0,un=0}else ze.head&&(ze.head.extra=null);ze.mode=EXTRA;case EXTRA:if(ze.flags&1024&&(Xn=ze.length,Xn>ln&&(Xn=ln),Xn&&(ze.head&&(pa=ze.head.extra_len-ze.length,ze.head.extra||(ze.head.extra=new Uint8Array(ze.head.extra_len)),ze.head.extra.set(Ke.subarray(Pi,Pi+Xn),pa)),ze.flags&512&&ze.wrap&4&&(ze.check=crc32_1(ze.check,Ke,Xn,Pi)),ln-=Xn,Pi+=Xn,ze.length-=Xn),ze.length))break e;ze.length=0,ze.mode=NAME;case NAME:if(ze.flags&2048){if(ln===0)break e;Xn=0;do pa=Ke[Pi+Xn++],ze.head&&pa&&ze.length<65536&&(ze.head.name+=String.fromCharCode(pa));while(pa&&Xn<ln);if(ze.flags&512&&ze.wrap&4&&(ze.check=crc32_1(ze.check,Ke,Xn,Pi)),ln-=Xn,Pi+=Xn,pa)break e}else ze.head&&(ze.head.name=null);ze.length=0,ze.mode=COMMENT;case COMMENT:if(ze.flags&4096){if(ln===0)break e;Xn=0;do pa=Ke[Pi+Xn++],ze.head&&pa&&ze.length<65536&&(ze.head.comment+=String.fromCharCode(pa));while(pa&&Xn<ln);if(ze.flags&512&&ze.wrap&4&&(ze.check=crc32_1(ze.check,Ke,Xn,Pi)),ln-=Xn,Pi+=Xn,pa)break e}else ze.head&&(ze.head.comment=null);ze.mode=HCRC;case HCRC:if(ze.flags&512){for(;un<16;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}if(ze.wrap&4&&hn!==(ze.check&65535)){qe.msg="header crc mismatch",ze.mode=BAD;break}hn=0,un=0}ze.head&&(ze.head.hcrc=ze.flags>>9&1,ze.head.done=!0),qe.adler=ze.check=0,ze.mode=TYPE;break;case DICTID:for(;un<32;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}qe.adler=ze.check=zswap32(hn),hn=0,un=0,ze.mode=DICT;case DICT:if(ze.havedict===0)return qe.next_out=nn,qe.avail_out=cn,qe.next_in=Pi,qe.avail_in=ln,ze.hold=hn,ze.bits=un,Z_NEED_DICT$1;qe.adler=ze.check=1,ze.mode=TYPE;case TYPE:if(f===Z_BLOCK||f===Z_TREES)break e;case TYPEDO:if(ze.last){hn>>>=un&7,un-=un&7,ze.mode=CHECK;break}for(;un<3;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}switch(ze.last=hn&1,hn>>>=1,un-=1,hn&3){case 0:ze.mode=STORED;break;case 1:if(fixedtables(ze),ze.mode=LEN_,f===Z_TREES){hn>>>=2,un-=2;break e}break;case 2:ze.mode=TABLE;break;case 3:qe.msg="invalid block type",ze.mode=BAD}hn>>>=2,un-=2;break;case STORED:for(hn>>>=un&7,un-=un&7;un<32;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}if((hn&65535)!==(hn>>>16^65535)){qe.msg="invalid stored block lengths",ze.mode=BAD;break}if(ze.length=hn&65535,hn=0,un=0,ze.mode=COPY_,f===Z_TREES)break e;case COPY_:ze.mode=COPY;case COPY:if(Xn=ze.length,Xn){if(Xn>ln&&(Xn=ln),Xn>cn&&(Xn=cn),Xn===0)break e;Qe.set(Ke.subarray(Pi,Pi+Xn),nn),ln-=Xn,Pi+=Xn,cn-=Xn,nn+=Xn,ze.length-=Xn;break}ze.mode=TYPE;break;case TABLE:for(;un<14;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}if(ze.nlen=(hn&31)+257,hn>>>=5,un-=5,ze.ndist=(hn&31)+1,hn>>>=5,un-=5,ze.ncode=(hn&15)+4,hn>>>=4,un-=4,ze.nlen>286||ze.ndist>30){qe.msg="too many length or distance symbols",ze.mode=BAD;break}ze.have=0,ze.mode=LENLENS;case LENLENS:for(;ze.have<ze.ncode;){for(;un<3;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}ze.lens[ga[ze.have++]]=hn&7,hn>>>=3,un-=3}for(;ze.have<19;)ze.lens[ga[ze.have++]]=0;if(ze.lencode=ze.lendyn,ze.lenbits=7,ca={bits:ze.lenbits},oa=inftrees(CODES,ze.lens,0,19,ze.lencode,0,ze.work,ca),ze.lenbits=ca.bits,oa){qe.msg="invalid code lengths set",ze.mode=BAD;break}ze.have=0,ze.mode=CODELENS;case CODELENS:for(;ze.have<ze.nlen+ze.ndist;){for(;ea=ze.lencode[hn&(1<<ze.lenbits)-1],ra=ea>>>24,na=ea>>>16&255,ta=ea&65535,!(ra<=un);){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}if(ta<16)hn>>>=ra,un-=ra,ze.lens[ze.have++]=ta;else{if(ta===16){for(da=ra+2;un<da;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}if(hn>>>=ra,un-=ra,ze.have===0){qe.msg="invalid bit length repeat",ze.mode=BAD;break}pa=ze.lens[ze.have-1],Xn=3+(hn&3),hn>>>=2,un-=2}else if(ta===17){for(da=ra+3;un<da;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}hn>>>=ra,un-=ra,pa=0,Xn=3+(hn&7),hn>>>=3,un-=3}else{for(da=ra+7;un<da;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}hn>>>=ra,un-=ra,pa=0,Xn=11+(hn&127),hn>>>=7,un-=7}if(ze.have+Xn>ze.nlen+ze.ndist){qe.msg="invalid bit length repeat",ze.mode=BAD;break}for(;Xn--;)ze.lens[ze.have++]=pa}}if(ze.mode===BAD)break;if(ze.lens[256]===0){qe.msg="invalid code -- missing end-of-block",ze.mode=BAD;break}if(ze.lenbits=9,ca={bits:ze.lenbits},oa=inftrees(LENS,ze.lens,0,ze.nlen,ze.lencode,0,ze.work,ca),ze.lenbits=ca.bits,oa){qe.msg="invalid literal/lengths set",ze.mode=BAD;break}if(ze.distbits=6,ze.distcode=ze.distdyn,ca={bits:ze.distbits},oa=inftrees(DISTS,ze.lens,ze.nlen,ze.ndist,ze.distcode,0,ze.work,ca),ze.distbits=ca.bits,oa){qe.msg="invalid distances set",ze.mode=BAD;break}if(ze.mode=LEN_,f===Z_TREES)break e;case LEN_:ze.mode=LEN;case LEN:if(ln>=6&&cn>=258){qe.next_out=nn,qe.avail_out=cn,qe.next_in=Pi,qe.avail_in=ln,ze.hold=hn,ze.bits=un,inffast(qe,zn),nn=qe.next_out,Qe=qe.output,cn=qe.avail_out,Pi=qe.next_in,Ke=qe.input,ln=qe.avail_in,hn=ze.hold,un=ze.bits,ze.mode===TYPE&&(ze.back=-1);break}for(ze.back=0;ea=ze.lencode[hn&(1<<ze.lenbits)-1],ra=ea>>>24,na=ea>>>16&255,ta=ea&65535,!(ra<=un);){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}if(na&&(na&240)===0){for(ia=ra,sa=na,Ma=ta;ea=ze.lencode[Ma+((hn&(1<<ia+sa)-1)>>ia)],ra=ea>>>24,na=ea>>>16&255,ta=ea&65535,!(ia+ra<=un);){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}hn>>>=ia,un-=ia,ze.back+=ia}if(hn>>>=ra,un-=ra,ze.back+=ra,ze.length=ta,na===0){ze.mode=LIT;break}if(na&32){ze.back=-1,ze.mode=TYPE;break}if(na&64){qe.msg="invalid literal/length code",ze.mode=BAD;break}ze.extra=na&15,ze.mode=LENEXT;case LENEXT:if(ze.extra){for(da=ze.extra;un<da;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}ze.length+=hn&(1<<ze.extra)-1,hn>>>=ze.extra,un-=ze.extra,ze.back+=ze.extra}ze.was=ze.length,ze.mode=DIST;case DIST:for(;ea=ze.distcode[hn&(1<<ze.distbits)-1],ra=ea>>>24,na=ea>>>16&255,ta=ea&65535,!(ra<=un);){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}if((na&240)===0){for(ia=ra,sa=na,Ma=ta;ea=ze.distcode[Ma+((hn&(1<<ia+sa)-1)>>ia)],ra=ea>>>24,na=ea>>>16&255,ta=ea&65535,!(ia+ra<=un);){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}hn>>>=ia,un-=ia,ze.back+=ia}if(hn>>>=ra,un-=ra,ze.back+=ra,na&64){qe.msg="invalid distance code",ze.mode=BAD;break}ze.offset=ta,ze.extra=na&15,ze.mode=DISTEXT;case DISTEXT:if(ze.extra){for(da=ze.extra;un<da;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}ze.offset+=hn&(1<<ze.extra)-1,hn>>>=ze.extra,un-=ze.extra,ze.back+=ze.extra}if(ze.offset>ze.dmax){qe.msg="invalid distance too far back",ze.mode=BAD;break}ze.mode=MATCH;case MATCH:if(cn===0)break e;if(Xn=zn-cn,ze.offset>Xn){if(Xn=ze.offset-Xn,Xn>ze.whave&&ze.sane){qe.msg="invalid distance too far back",ze.mode=BAD;break}Xn>ze.wnext?(Xn-=ze.wnext,ys=ze.wsize-Xn):ys=ze.wnext-Xn,Xn>ze.length&&(Xn=ze.length),Jo=ze.window}else Jo=Qe,ys=nn-ze.offset,Xn=ze.length;Xn>cn&&(Xn=cn),cn-=Xn,ze.length-=Xn;do Qe[nn++]=Jo[ys++];while(--Xn);ze.length===0&&(ze.mode=LEN);break;case LIT:if(cn===0)break e;Qe[nn++]=ze.length,cn--,ze.mode=LEN;break;case CHECK:if(ze.wrap){for(;un<32;){if(ln===0)break e;ln--,hn|=Ke[Pi++]<<un,un+=8}if(zn-=cn,qe.total_out+=zn,ze.total+=zn,ze.wrap&4&&zn&&(qe.adler=ze.check=ze.flags?crc32_1(ze.check,Qe,zn,nn-zn):adler32_1(ze.check,Qe,zn,nn-zn)),zn=cn,ze.wrap&4&&(ze.flags?hn:zswap32(hn))!==ze.check){qe.msg="incorrect data check",ze.mode=BAD;break}hn=0,un=0}ze.mode=LENGTH;case LENGTH:if(ze.wrap&&ze.flags){for(;un<32;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}if(ze.wrap&4&&hn!==(ze.total&4294967295)){qe.msg="incorrect length check",ze.mode=BAD;break}hn=0,un=0}ze.mode=DONE;case DONE:oa=Z_STREAM_END$1;break e;case BAD:oa=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return qe.next_out=nn,qe.avail_out=cn,qe.next_in=Pi,qe.avail_in=ln,ze.hold=hn,ze.bits=un,(ze.wsize||zn!==qe.avail_out&&ze.mode<BAD&&(ze.mode<CHECK||f!==Z_FINISH$1))&&updatewindow(qe,qe.output,qe.next_out,zn-qe.avail_out),xs-=qe.avail_in,zn-=qe.avail_out,qe.total_in+=xs,qe.total_out+=zn,ze.total+=zn,ze.wrap&4&&zn&&(qe.adler=ze.check=ze.flags?crc32_1(ze.check,Qe,zn,qe.next_out-zn):adler32_1(ze.check,Qe,zn,qe.next_out-zn)),qe.data_type=ze.bits+(ze.last?64:0)+(ze.mode===TYPE?128:0)+(ze.mode===LEN_||ze.mode===COPY_?256:0),(xs===0&&zn===0||f===Z_FINISH$1)&&oa===Z_OK$1&&(oa=Z_BUF_ERROR),oa},inflateEnd=qe=>{if(inflateStateCheck(qe))return Z_STREAM_ERROR$1;let f=qe.state;return f.window&&(f.window=null),qe.state=null,Z_OK$1},inflateGetHeader=(qe,f)=>{if(inflateStateCheck(qe))return Z_STREAM_ERROR$1;const ze=qe.state;return(ze.wrap&2)===0?Z_STREAM_ERROR$1:(ze.head=f,f.done=!1,Z_OK$1)},inflateSetDictionary=(qe,f)=>{const ze=f.length;let Ke,Qe,Pi;return inflateStateCheck(qe)||(Ke=qe.state,Ke.wrap!==0&&Ke.mode!==DICT)?Z_STREAM_ERROR$1:Ke.mode===DICT&&(Qe=1,Qe=adler32_1(Qe,f,ze,0),Qe!==Ke.check)?Z_DATA_ERROR$1:(Pi=updatewindow(qe,f,ze,ze),Pi?(Ke.mode=MEM,Z_MEM_ERROR$1):(Ke.havedict=1,Z_OK$1))};var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2$1=inflate$2,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1$2={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2$1,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader;const toString$2=Object.prototype.toString,{Z_NO_FLUSH,Z_FINISH,Z_OK,Z_STREAM_END,Z_NEED_DICT,Z_STREAM_ERROR,Z_DATA_ERROR,Z_MEM_ERROR}=constants$2;function Inflate$1(qe){this.options=common.assign({chunkSize:1024*64,windowBits:15,to:""},qe||{});const f=this.options;f.raw&&f.windowBits>=0&&f.windowBits<16&&(f.windowBits=-f.windowBits,f.windowBits===0&&(f.windowBits=-15)),f.windowBits>=0&&f.windowBits<16&&!(qe&&qe.windowBits)&&(f.windowBits+=32),f.windowBits>15&&f.windowBits<48&&(f.windowBits&15)===0&&(f.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let ze=inflate_1$2.inflateInit2(this.strm,f.windowBits);if(ze!==Z_OK)throw new Error(messages[ze]);if(this.header=new gzheader,inflate_1$2.inflateGetHeader(this.strm,this.header),f.dictionary&&(typeof f.dictionary=="string"?f.dictionary=strings.string2buf(f.dictionary):toString$2.call(f.dictionary)==="[object ArrayBuffer]"&&(f.dictionary=new Uint8Array(f.dictionary)),f.raw&&(ze=inflate_1$2.inflateSetDictionary(this.strm,f.dictionary),ze!==Z_OK)))throw new Error(messages[ze])}Inflate$1.prototype.push=function(qe,f){const ze=this.strm,Ke=this.options.chunkSize,Qe=this.options.dictionary;let Pi,nn,ln;if(this.ended)return!1;for(f===~~f?nn=f:nn=f===!0?Z_FINISH:Z_NO_FLUSH,toString$2.call(qe)==="[object ArrayBuffer]"?ze.input=new Uint8Array(qe):ze.input=qe,ze.next_in=0,ze.avail_in=ze.input.length;;){for(ze.avail_out===0&&(ze.output=new Uint8Array(Ke),ze.next_out=0,ze.avail_out=Ke),Pi=inflate_1$2.inflate(ze,nn),Pi===Z_NEED_DICT&&Qe&&(Pi=inflate_1$2.inflateSetDictionary(ze,Qe),Pi===Z_OK?Pi=inflate_1$2.inflate(ze,nn):Pi===Z_DATA_ERROR&&(Pi=Z_NEED_DICT));ze.avail_in>0&&Pi===Z_STREAM_END&&ze.state.wrap>0&&qe[ze.next_in]!==0;)inflate_1$2.inflateReset(ze),Pi=inflate_1$2.inflate(ze,nn);switch(Pi){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(Pi),this.ended=!0,!1}if(ln=ze.avail_out,ze.next_out&&(ze.avail_out===0||Pi===Z_STREAM_END))if(this.options.to==="string"){let cn=strings.utf8border(ze.output,ze.next_out),hn=ze.next_out-cn,un=strings.buf2string(ze.output,cn);ze.next_out=hn,ze.avail_out=Ke-hn,hn&&ze.output.set(ze.output.subarray(cn,cn+hn),0),this.onData(un)}else this.onData(ze.output.length===ze.next_out?ze.output:ze.output.subarray(0,ze.next_out));if(!(Pi===Z_OK&&ln===0)){if(Pi===Z_STREAM_END)return Pi=inflate_1$2.inflateEnd(this.strm),this.onEnd(Pi),this.ended=!0,!0;if(ze.avail_in===0)break}}return!0};Inflate$1.prototype.onData=function(qe){this.chunks.push(qe)};Inflate$1.prototype.onEnd=function(qe){qe===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=qe,this.msg=this.strm.msg};function inflate$1(qe,f){const ze=new Inflate$1(f);if(ze.push(qe),ze.err)throw ze.msg||messages[ze.err];return ze.result}var Inflate_1$1=Inflate$1,inflate_2=inflate$1,inflate_1$1={Inflate:Inflate_1$1,inflate:inflate_2};const{deflate}=deflate_1$1,{Inflate,inflate}=inflate_1$1;var deflate_1=deflate,Inflate_1=Inflate,inflate_1=inflate;const crcTable=[];for(let qe=0;qe<256;qe++){let f=qe;for(let ze=0;ze<8;ze++)f&1?f=3988292384^f>>>1:f=f>>>1;crcTable[qe]=f}const initialCrc=4294967295;function updateCrc(qe,f,ze){let Ke=qe;for(let Qe=0;Qe<ze;Qe++)Ke=crcTable[(Ke^f[Qe])&255]^Ke>>>8;return Ke}function crc(qe,f){return(updateCrc(initialCrc,qe,f)^initialCrc)>>>0}function checkCrc(qe,f,ze){const Ke=qe.readUint32(),Qe=crc(new Uint8Array(qe.buffer,qe.byteOffset+qe.offset-f-4,f),f);if(Qe!==Ke)throw new Error(`CRC mismatch for chunk ${ze}. Expected ${Ke}, found ${Qe}`)}function writeCrc(qe,f){qe.writeUint32(crc(new Uint8Array(qe.buffer,qe.byteOffset+qe.offset-f,f),f))}function unfilterNone(qe,f,ze){for(let Ke=0;Ke<ze;Ke++)f[Ke]=qe[Ke]}function unfilterSub(qe,f,ze,Ke){let Qe=0;for(;Qe<Ke;Qe++)f[Qe]=qe[Qe];for(;Qe<ze;Qe++)f[Qe]=qe[Qe]+f[Qe-Ke]&255}function unfilterUp(qe,f,ze,Ke){let Qe=0;if(ze.length===0)for(;Qe<Ke;Qe++)f[Qe]=qe[Qe];else for(;Qe<Ke;Qe++)f[Qe]=qe[Qe]+ze[Qe]&255}function unfilterAverage(qe,f,ze,Ke,Qe){let Pi=0;if(ze.length===0){for(;Pi<Qe;Pi++)f[Pi]=qe[Pi];for(;Pi<Ke;Pi++)f[Pi]=qe[Pi]+(f[Pi-Qe]>>1)&255}else{for(;Pi<Qe;Pi++)f[Pi]=qe[Pi]+(ze[Pi]>>1)&255;for(;Pi<Ke;Pi++)f[Pi]=qe[Pi]+(f[Pi-Qe]+ze[Pi]>>1)&255}}function unfilterPaeth(qe,f,ze,Ke,Qe){let Pi=0;if(ze.length===0){for(;Pi<Qe;Pi++)f[Pi]=qe[Pi];for(;Pi<Ke;Pi++)f[Pi]=qe[Pi]+f[Pi-Qe]&255}else{for(;Pi<Qe;Pi++)f[Pi]=qe[Pi]+ze[Pi]&255;for(;Pi<Ke;Pi++)f[Pi]=qe[Pi]+paethPredictor(f[Pi-Qe],ze[Pi],ze[Pi-Qe])&255}}function paethPredictor(qe,f,ze){const Ke=qe+f-ze,Qe=Math.abs(Ke-qe),Pi=Math.abs(Ke-f),nn=Math.abs(Ke-ze);return Qe<=Pi&&Qe<=nn?qe:Pi<=nn?f:ze}const uint16=new Uint16Array([255]),uint8=new Uint8Array(uint16.buffer),osIsLittleEndian=uint8[0]===255,empty=new Uint8Array(0);function decodeInterlaceNull(qe){const{data:f,width:ze,height:Ke,channels:Qe,depth:Pi}=qe,nn=Qe*Pi/8,ln=ze*nn,cn=new Uint8Array(Ke*ln);let hn=empty,un=0,xs,zn;for(let Xn=0;Xn<Ke;Xn++){switch(xs=f.subarray(un+1,un+1+ln),zn=cn.subarray(Xn*ln,(Xn+1)*ln),f[un]){case 0:unfilterNone(xs,zn,ln);break;case 1:unfilterSub(xs,zn,ln,nn);break;case 2:unfilterUp(xs,zn,hn,ln);break;case 3:unfilterAverage(xs,zn,hn,ln,nn);break;case 4:unfilterPaeth(xs,zn,hn,ln,nn);break;default:throw new Error(`Unsupported filter: ${f[un]}`)}hn=zn,un+=ln+1}if(Pi===16){const Xn=new Uint16Array(cn.buffer);if(osIsLittleEndian)for(let ys=0;ys<Xn.length;ys++)Xn[ys]=swap16(Xn[ys]);return Xn}else return cn}function swap16(qe){return(qe&255)<<8|qe>>8&255}const pngSignature=Uint8Array.of(137,80,78,71,13,10,26,10);function writeSignature(qe){qe.writeBytes(pngSignature)}function checkSignature(qe){if(!hasPngSignature(qe.readBytes(pngSignature.length)))throw new Error("wrong PNG signature")}function hasPngSignature(qe){if(qe.length<pngSignature.length)return!1;for(let f=0;f<pngSignature.length;f++)if(qe[f]!==pngSignature[f])return!1;return!0}const textChunkName="tEXt",NULL=0,latin1Decoder=new TextDecoder("latin1");function validateKeyword(qe){if(validateLatin1(qe),qe.length===0||qe.length>79)throw new Error("keyword length must be between 1 and 79")}const latin1Regex=/^[\u0000-\u00FF]*$/;function validateLatin1(qe){if(!latin1Regex.test(qe))throw new Error("invalid latin1 text")}function decodetEXt(qe,f,ze){const Ke=readKeyword(f);qe[Ke]=readLatin1(f,ze-Ke.length-1)}function encodetEXt(qe,f,ze){validateKeyword(f),validateLatin1(ze);const Ke=f.length+1+ze.length;qe.writeUint32(Ke),qe.writeChars(textChunkName),qe.writeChars(f),qe.writeByte(NULL),qe.writeChars(ze),writeCrc(qe,Ke+4)}function readKeyword(qe){for(qe.mark();qe.readByte()!==NULL;);const f=qe.offset;qe.reset();const ze=latin1Decoder.decode(qe.readBytes(f-qe.offset-1));return qe.skip(1),validateKeyword(ze),ze}function readLatin1(qe,f){return latin1Decoder.decode(qe.readBytes(f))}const ColorType={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},CompressionMethod={UNKNOWN:-1,DEFLATE:0},FilterMethod={UNKNOWN:-1,ADAPTIVE:0},InterlaceMethod={UNKNOWN:-1,NO_INTERLACE:0};class PngDecoder extends IOBuffer{constructor(ze,Ke={}){super(ze);yh(this,"_checkCrc");yh(this,"_inflator");yh(this,"_png");yh(this,"_end");yh(this,"_hasPalette");yh(this,"_palette");yh(this,"_hasTransparency");yh(this,"_transparency");yh(this,"_compressionMethod");yh(this,"_filterMethod");yh(this,"_interlaceMethod");yh(this,"_colorType");const{checkCrc:Qe=!1}=Ke;this._checkCrc=Qe,this._inflator=new Inflate_1,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=CompressionMethod.UNKNOWN,this._filterMethod=FilterMethod.UNKNOWN,this._interlaceMethod=InterlaceMethod.UNKNOWN,this._colorType=ColorType.UNKNOWN,this.setBigEndian()}decode(){for(checkSignature(this);!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeChunk(){const ze=this.readUint32(),Ke=this.readChars(4),Qe=this.offset;switch(Ke){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(ze);break;case"IDAT":this.decodeIDAT(ze);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(ze);break;case"iCCP":this.decodeiCCP(ze);break;case textChunkName:decodetEXt(this._png.text,this,ze);break;case"pHYs":this.decodepHYs();break;default:this.skip(ze);break}if(this.offset-Qe!==ze)throw new Error(`Length mismatch while decoding chunk ${Ke}`);this._checkCrc?checkCrc(this,ze+4,Ke):this.skip(4)}decodeIHDR(){const ze=this._png;ze.width=this.readUint32(),ze.height=this.readUint32(),ze.depth=checkBitDepth(this.readUint8());const Ke=this.readUint8();this._colorType=Ke;let Qe;switch(Ke){case ColorType.GREYSCALE:Qe=1;break;case ColorType.TRUECOLOUR:Qe=3;break;case ColorType.INDEXED_COLOUR:Qe=1;break;case ColorType.GREYSCALE_ALPHA:Qe=2;break;case ColorType.TRUECOLOUR_ALPHA:Qe=4;break;case ColorType.UNKNOWN:default:throw new Error(`Unknown color type: ${Ke}`)}if(this._png.channels=Qe,this._compressionMethod=this.readUint8(),this._compressionMethod!==CompressionMethod.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(ze){if(ze%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${ze}`);const Ke=ze/3;this._hasPalette=!0;const Qe=[];this._palette=Qe;for(let Pi=0;Pi<Ke;Pi++)Qe.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(ze){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,ze)),this.skip(ze)}decodetRNS(ze){switch(this._colorType){case ColorType.GREYSCALE:case ColorType.TRUECOLOUR:{if(ze%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${ze}`);if(ze/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${ze/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(ze/2);for(let Ke=0;Ke<ze/2;Ke++)this._transparency[Ke]=this.readUint16();break}case ColorType.INDEXED_COLOUR:{if(ze>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${ze} vs ${this._palette.length})`);let Ke=0;for(;Ke<ze;Ke++){const Qe=this.readByte();this._palette[Ke].push(Qe)}for(;Ke<this._palette.length;Ke++)this._palette[Ke].push(255);break}case ColorType.UNKNOWN:case ColorType.GREYSCALE_ALPHA:case ColorType.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(ze){const Ke=readKeyword(this),Qe=this.readUint8();if(Qe!==CompressionMethod.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${Qe}`);const Pi=this.readBytes(ze-Ke.length-2);this._png.iccEmbeddedProfile={name:Ke,profile:inflate_1(Pi)}}decodepHYs(){const ze=this.readUint32(),Ke=this.readUint32(),Qe=this.readByte();this._png.resolution={x:ze,y:Ke,unit:Qe}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const ze=this._inflator.result;if(this._filterMethod!==FilterMethod.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===InterlaceMethod.NO_INTERLACE)this._png.data=decodeInterlaceNull({data:ze,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}}function checkBitDepth(qe){if(qe!==1&&qe!==2&&qe!==4&&qe!==8&&qe!==16)throw new Error(`invalid bit depth: ${qe}`);return qe}const defaultZlibOptions={level:3};class PngEncoder extends IOBuffer{constructor(ze,Ke={}){super();yh(this,"_png");yh(this,"_zlibOptions");yh(this,"_colorType");this._colorType=ColorType.UNKNOWN,this._zlibOptions={...defaultZlibOptions,...Ke.zlib},this._png=this._checkData(ze),this.setBigEndian()}encode(){if(writeSignature(this),this.encodeIHDR(),this.encodeData(),this._png.text)for(const[ze,Ke]of Object.entries(this._png.text))encodetEXt(this,ze,Ke);return this.encodeIEND(),this.toArray()}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(CompressionMethod.DEFLATE),this.writeByte(FilterMethod.ADAPTIVE),this.writeByte(InterlaceMethod.NO_INTERLACE),writeCrc(this,17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),writeCrc(this,4)}encodeIDAT(ze){this.writeUint32(ze.length),this.writeChars("IDAT"),this.writeBytes(ze),writeCrc(this,ze.length+4)}encodeData(){const{width:ze,height:Ke,channels:Qe,depth:Pi,data:nn}=this._png,ln=Qe*ze,cn=new IOBuffer().setBigEndian();let hn=0;for(let zn=0;zn<Ke;zn++)if(cn.writeByte(0),Pi===8)hn=writeDataBytes(nn,cn,ln,hn);else if(Pi===16)hn=writeDataUint16(nn,cn,ln,hn);else throw new Error("unreachable");const un=cn.toArray(),xs=deflate_1(un,this._zlibOptions);this.encodeIDAT(xs)}_checkData(ze){const{colorType:Ke,channels:Qe,depth:Pi}=getColorType(ze),nn={width:checkInteger(ze.width,"width"),height:checkInteger(ze.height,"height"),channels:Qe,data:ze.data,depth:Pi,text:ze.text};this._colorType=Ke;const ln=nn.width*nn.height*Qe;if(nn.data.length!==ln)throw new RangeError(`wrong data size. Found ${nn.data.length}, expected ${ln}`);return nn}}function checkInteger(qe,f){if(Number.isInteger(qe)&&qe>0)return qe;throw new TypeError(`${f} must be a positive integer`)}function getColorType(qe){const{channels:f=4,depth:ze=8}=qe;if(f!==4&&f!==3&&f!==2&&f!==1)throw new RangeError(`unsupported number of channels: ${f}`);if(ze!==8&&ze!==16)throw new RangeError(`unsupported bit depth: ${ze}`);const Ke={channels:f,depth:ze,colorType:ColorType.UNKNOWN};switch(f){case 4:Ke.colorType=ColorType.TRUECOLOUR_ALPHA;break;case 3:Ke.colorType=ColorType.TRUECOLOUR;break;case 1:Ke.colorType=ColorType.GREYSCALE;break;case 2:Ke.colorType=ColorType.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return Ke}function writeDataBytes(qe,f,ze,Ke){for(let Qe=0;Qe<ze;Qe++)f.writeByte(qe[Ke++]);return Ke}function writeDataUint16(qe,f,ze,Ke){for(let Qe=0;Qe<ze;Qe++)f.writeUint16(qe[Ke++]);return Ke}var ResolutionUnitSpecifier;(function(qe){qe[qe.UNKNOWN=0]="UNKNOWN",qe[qe.METRE=1]="METRE"})(ResolutionUnitSpecifier||(ResolutionUnitSpecifier={}));function decodePng(qe,f){return new PngDecoder(qe,f).decode()}function encodePng$1(qe,f){return new PngEncoder(qe,f).encode()}var encoder={exports:{}},hasRequiredEncoder;function requireEncoder(){return hasRequiredEncoder||(hasRequiredEncoder=1,function(qe){function f(Ke){var Qe=Math.floor,Pi=new Array(64),nn=new Array(64),ln=new Array(64),cn=new Array(64),hn,un,xs,zn,Xn=new Array(65535),ys=new Array(65535),Jo=new Array(64),ea=new Array(64),ra=[],na=0,ta=7,ia=new Array(64),sa=new Array(64),Ma=new Array(64),pa=new Array(256),oa=new Array(2048),ha,ca=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],da=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],ga=[0,1,2,3,4,5,6,7,8,9,10,11],qa=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],Ka=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],il=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],cl=[0,1,2,3,4,5,6,7,8,9,10,11],wl=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],al=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function vl(rl){for(var Pl=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],kl=0;kl<64;kl++){var Dl=Qe((Pl[kl]*rl+50)/100);Dl<1?Dl=1:Dl>255&&(Dl=255),Pi[ca[kl]]=Dl}for(var fl=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Gl=0;Gl<64;Gl++){var ql=Qe((fl[Gl]*rl+50)/100);ql<1?ql=1:ql>255&&(ql=255),nn[ca[Gl]]=ql}for(var Cl=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],El=0,Bl=0;Bl<8;Bl++)for(var Ml=0;Ml<8;Ml++)ln[El]=1/(Pi[ca[El]]*Cl[Bl]*Cl[Ml]*8),cn[El]=1/(nn[ca[El]]*Cl[Bl]*Cl[Ml]*8),El++}function ml(rl,Pl){for(var kl=0,Dl=0,fl=new Array,Gl=1;Gl<=16;Gl++){for(var ql=1;ql<=rl[Gl];ql++)fl[Pl[Dl]]=[],fl[Pl[Dl]][0]=kl,fl[Pl[Dl]][1]=Gl,Dl++,kl++;kl*=2}return fl}function ol(){hn=ml(da,ga),un=ml(il,cl),xs=ml(qa,Ka),zn=ml(wl,al)}function el(){for(var rl=1,Pl=2,kl=1;kl<=15;kl++){for(var Dl=rl;Dl<Pl;Dl++)ys[32767+Dl]=kl,Xn[32767+Dl]=[],Xn[32767+Dl][1]=kl,Xn[32767+Dl][0]=Dl;for(var fl=-(Pl-1);fl<=-rl;fl++)ys[32767+fl]=kl,Xn[32767+fl]=[],Xn[32767+fl][1]=kl,Xn[32767+fl][0]=Pl-1+fl;rl<<=1,Pl<<=1}}function dl(){for(var rl=0;rl<256;rl++)oa[rl]=19595*rl,oa[rl+256>>0]=38470*rl,oa[rl+512>>0]=7471*rl+32768,oa[rl+768>>0]=-11059*rl,oa[rl+1024>>0]=-21709*rl,oa[rl+1280>>0]=32768*rl+8421375,oa[rl+1536>>0]=-27439*rl,oa[rl+1792>>0]=-5329*rl}function xl(rl){for(var Pl=rl[0],kl=rl[1]-1;kl>=0;)Pl&1<<kl&&(na|=1<<ta),kl--,ta--,ta<0&&(na==255?(Ja(255),Ja(0)):Ja(na),ta=7,na=0)}function Ja(rl){ra.push(rl)}function yl(rl){Ja(rl>>8&255),Ja(rl&255)}function Ol(rl,Pl){var kl,Dl,fl,Gl,ql,Cl,El,Bl,Ml=0,Ul,Kl=8,Nl=64;for(Ul=0;Ul<Kl;++Ul){kl=rl[Ml],Dl=rl[Ml+1],fl=rl[Ml+2],Gl=rl[Ml+3],ql=rl[Ml+4],Cl=rl[Ml+5],El=rl[Ml+6],Bl=rl[Ml+7];var Zl=kl+Bl,Wl=kl-Bl,mh=Dl+El,Eh=Dl-El,_h=fl+Cl,Dh=fl-Cl,Vh=Gl+ql,zh=Gl-ql,Oh=Zl+Vh,Fh=Zl-Vh,Xh=mh+_h,Ih=mh-_h;rl[Ml]=Oh+Xh,rl[Ml+4]=Oh-Xh;var Sh=(Ih+Fh)*.707106781;rl[Ml+2]=Fh+Sh,rl[Ml+6]=Fh-Sh,Oh=zh+Dh,Xh=Dh+Eh,Ih=Eh+Wl;var Nh=(Oh-Ih)*.382683433,Cs=.5411961*Oh+Nh,Kn=1.306562965*Ih+Nh,qn=Xh*.707106781,Un=Wl+qn,vs=Wl-qn;rl[Ml+5]=vs+Cs,rl[Ml+3]=vs-Cs,rl[Ml+1]=Un+Kn,rl[Ml+7]=Un-Kn,Ml+=8}for(Ml=0,Ul=0;Ul<Kl;++Ul){kl=rl[Ml],Dl=rl[Ml+8],fl=rl[Ml+16],Gl=rl[Ml+24],ql=rl[Ml+32],Cl=rl[Ml+40],El=rl[Ml+48],Bl=rl[Ml+56];var bs=kl+Bl,aa=kl-Bl,la=Dl+El,ua=Dl-El,fa=fl+Cl,Qa=fl-Cl,Na=Gl+ql,nl=Gl-ql,ll=bs+Na,tl=bs-Na,sl=la+fa,bl=la-fa;rl[Ml]=ll+sl,rl[Ml+32]=ll-sl;var Ua=(bl+tl)*.707106781;rl[Ml+16]=tl+Ua,rl[Ml+48]=tl-Ua,ll=nl+Qa,sl=Qa+ua,bl=ua+aa;var ul=(ll-bl)*.382683433,_l=.5411961*ll+ul,jl=1.306562965*bl+ul,Yl=sl*.707106781,vh=aa+Yl,$l=aa-Yl;rl[Ml+40]=$l+_l,rl[Ml+24]=$l-_l,rl[Ml+8]=vh+jl,rl[Ml+56]=vh-jl,Ml++}var Fl;for(Ul=0;Ul<Nl;++Ul)Fl=rl[Ul]*Pl[Ul],Jo[Ul]=Fl>0?Fl+.5|0:Fl-.5|0;return Jo}function Il(){yl(65504),yl(16),Ja(74),Ja(70),Ja(73),Ja(70),Ja(0),Ja(1),Ja(1),Ja(0),yl(1),yl(1),Ja(0),Ja(0)}function Rl(rl){if(rl){yl(65505),rl[0]===69&&rl[1]===120&&rl[2]===105&&rl[3]===102?yl(rl.length+2):(yl(rl.length+5+2),Ja(69),Ja(120),Ja(105),Ja(102),Ja(0));for(var Pl=0;Pl<rl.length;Pl++)Ja(rl[Pl])}}function Al(rl,Pl){yl(65472),yl(17),Ja(8),yl(Pl),yl(rl),Ja(3),Ja(1),Ja(17),Ja(0),Ja(2),Ja(17),Ja(1),Ja(3),Ja(17),Ja(1)}function zl(){yl(65499),yl(132),Ja(0);for(var rl=0;rl<64;rl++)Ja(Pi[rl]);Ja(1);for(var Pl=0;Pl<64;Pl++)Ja(nn[Pl])}function Ql(){yl(65476),yl(418),Ja(0);for(var rl=0;rl<16;rl++)Ja(da[rl+1]);for(var Pl=0;Pl<=11;Pl++)Ja(ga[Pl]);Ja(16);for(var kl=0;kl<16;kl++)Ja(qa[kl+1]);for(var Dl=0;Dl<=161;Dl++)Ja(Ka[Dl]);Ja(1);for(var fl=0;fl<16;fl++)Ja(il[fl+1]);for(var Gl=0;Gl<=11;Gl++)Ja(cl[Gl]);Ja(17);for(var ql=0;ql<16;ql++)Ja(wl[ql+1]);for(var Cl=0;Cl<=161;Cl++)Ja(al[Cl])}function Xl(rl){typeof rl>"u"||rl.constructor!==Array||rl.forEach(Pl=>{if(typeof Pl=="string"){yl(65534);var kl=Pl.length;yl(kl+2);var Dl;for(Dl=0;Dl<kl;Dl++)Ja(Pl.charCodeAt(Dl))}})}function Tl(){yl(65498),yl(12),Ja(3),Ja(1),Ja(0),Ja(2),Ja(17),Ja(3),Ja(17),Ja(0),Ja(63),Ja(0)}function pl(rl,Pl,kl,Dl,fl){for(var Gl=fl[0],ql=fl[240],Cl,El=16,Bl=63,Ml=64,Ul=Ol(rl,Pl),Kl=0;Kl<Ml;++Kl)ea[ca[Kl]]=Ul[Kl];var Nl=ea[0]-kl;kl=ea[0],Nl==0?xl(Dl[0]):(Cl=32767+Nl,xl(Dl[ys[Cl]]),xl(Xn[Cl]));for(var Zl=63;Zl>0&&ea[Zl]==0;Zl--);if(Zl==0)return xl(Gl),kl;for(var Wl=1,mh;Wl<=Zl;){for(var Eh=Wl;ea[Wl]==0&&Wl<=Zl;++Wl);var _h=Wl-Eh;if(_h>=El){mh=_h>>4;for(var Dh=1;Dh<=mh;++Dh)xl(ql);_h=_h&15}Cl=32767+ea[Wl],xl(fl[(_h<<4)+ys[Cl]]),xl(Xn[Cl]),Wl++}return Zl!=Bl&&xl(Gl),kl}function Hl(){for(var rl=String.fromCharCode,Pl=0;Pl<256;Pl++)pa[Pl]=rl(Pl)}this.encode=function(rl,Pl){new Date().getTime(),Pl&&Ll(Pl),ra=new Array,na=0,ta=7,yl(65496),Il(),Xl(rl.comments),Rl(rl.exifBuffer),zl(),Al(rl.width,rl.height),Ql(),Tl();var kl=0,Dl=0,fl=0;na=0,ta=7,this.encode.displayName="_encode_";for(var Gl=rl.data,ql=rl.width,Cl=rl.height,El=ql*4,Bl,Ml=0,Ul,Kl,Nl,Zl,Wl,mh,Eh,_h;Ml<Cl;){for(Bl=0;Bl<El;){for(Zl=El*Ml+Bl,Wl=Zl,mh=-1,Eh=0,_h=0;_h<64;_h++)Eh=_h>>3,mh=(_h&7)*4,Wl=Zl+Eh*El+mh,Ml+Eh>=Cl&&(Wl-=El*(Ml+1+Eh-Cl)),Bl+mh>=El&&(Wl-=Bl+mh-El+4),Ul=Gl[Wl++],Kl=Gl[Wl++],Nl=Gl[Wl++],ia[_h]=(oa[Ul]+oa[Kl+256>>0]+oa[Nl+512>>0]>>16)-128,sa[_h]=(oa[Ul+768>>0]+oa[Kl+1024>>0]+oa[Nl+1280>>0]>>16)-128,Ma[_h]=(oa[Ul+1280>>0]+oa[Kl+1536>>0]+oa[Nl+1792>>0]>>16)-128;kl=pl(ia,ln,kl,hn,xs),Dl=pl(sa,cn,Dl,un,zn),fl=pl(Ma,cn,fl,un,zn),Bl+=32}Ml+=8}if(ta>=0){var Dh=[];Dh[1]=ta+1,Dh[0]=(1<<ta+1)-1,xl(Dh)}return yl(65497),Buffer.from(ra)};function Ll(rl){if(rl<=0&&(rl=1),rl>100&&(rl=100),ha!=rl){var Pl=0;rl<50?Pl=Math.floor(5e3/rl):Pl=Math.floor(200-rl*2),vl(Pl),ha=rl}}function Vl(){var rl=new Date().getTime();Ke||(Ke=50),Hl(),ol(),el(),dl(),Ll(Ke),new Date().getTime()-rl}Vl()}qe.exports=ze;function ze(Ke,Qe){typeof Qe>"u"&&(Qe=50);var Pi=new f(Qe),nn=Pi.encode(Ke,Qe);return{data:nn,width:Ke.width,height:Ke.height}}}(encoder)),encoder.exports}var decoder={exports:{}},hasRequiredDecoder;function requireDecoder(){return hasRequiredDecoder||(hasRequiredDecoder=1,function(qe){var f=function(){var Qe=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),Pi=4017,nn=799,ln=3406,cn=2276,hn=1567,un=3784,xs=5793,zn=2896;function Xn(){}function ys(sa,Ma){for(var pa=0,oa=[],ha,ca,da=16;da>0&&!sa[da-1];)da--;oa.push({children:[],index:0});var ga=oa[0],qa;for(ha=0;ha<da;ha++){for(ca=0;ca<sa[ha];ca++){for(ga=oa.pop(),ga.children[ga.index]=Ma[pa];ga.index>0;){if(oa.length===0)throw new Error("Could not recreate Huffman Table");ga=oa.pop()}for(ga.index++,oa.push(ga);oa.length<=ha;)oa.push(qa={children:[],index:0}),ga.children[ga.index]=qa.children,ga=qa;pa++}ha+1<da&&(oa.push(qa={children:[],index:0}),ga.children[ga.index]=qa.children,ga=qa)}return oa[0].children}function Jo(sa,Ma,pa,oa,ha,ca,da,ga,qa,Ka){pa.precision,pa.samplesPerLine,pa.scanLines;var il=pa.mcusPerLine,cl=pa.progressive;pa.maxH,pa.maxV;var wl=Ma,al=0,vl=0;function ml(){if(vl>0)return vl--,al>>vl&1;if(al=sa[Ma++],al==255){var Cl=sa[Ma++];if(Cl)throw new Error("unexpected marker: "+(al<<8|Cl).toString(16))}return vl=7,al>>>7}function ol(Cl){for(var El=Cl,Bl;(Bl=ml())!==null;){if(El=El[Bl],typeof El=="number")return El;if(typeof El!="object")throw new Error("invalid huffman sequence")}return null}function el(Cl){for(var El=0;Cl>0;){var Bl=ml();if(Bl===null)return;El=El<<1|Bl,Cl--}return El}function dl(Cl){var El=el(Cl);return El>=1<<Cl-1?El:El+(-1<<Cl)+1}function xl(Cl,El){var Bl=ol(Cl.huffmanTableDC),Ml=Bl===0?0:dl(Bl);El[0]=Cl.pred+=Ml;for(var Ul=1;Ul<64;){var Kl=ol(Cl.huffmanTableAC),Nl=Kl&15,Zl=Kl>>4;if(Nl===0){if(Zl<15)break;Ul+=16;continue}Ul+=Zl;var Wl=Qe[Ul];El[Wl]=dl(Nl),Ul++}}function Ja(Cl,El){var Bl=ol(Cl.huffmanTableDC),Ml=Bl===0?0:dl(Bl)<<qa;El[0]=Cl.pred+=Ml}function yl(Cl,El){El[0]|=ml()<<qa}var Ol=0;function Il(Cl,El){if(Ol>0){Ol--;return}for(var Bl=ca,Ml=da;Bl<=Ml;){var Ul=ol(Cl.huffmanTableAC),Kl=Ul&15,Nl=Ul>>4;if(Kl===0){if(Nl<15){Ol=el(Nl)+(1<<Nl)-1;break}Bl+=16;continue}Bl+=Nl;var Zl=Qe[Bl];El[Zl]=dl(Kl)*(1<<qa),Bl++}}var Rl=0,Al;function zl(Cl,El){for(var Bl=ca,Ml=da,Ul=0;Bl<=Ml;){var Kl=Qe[Bl],Nl=El[Kl]<0?-1:1;switch(Rl){case 0:var Zl=ol(Cl.huffmanTableAC),Wl=Zl&15,Ul=Zl>>4;if(Wl===0)Ul<15?(Ol=el(Ul)+(1<<Ul),Rl=4):(Ul=16,Rl=1);else{if(Wl!==1)throw new Error("invalid ACn encoding");Al=dl(Wl),Rl=Ul?2:3}continue;case 1:case 2:El[Kl]?El[Kl]+=(ml()<<qa)*Nl:(Ul--,Ul===0&&(Rl=Rl==2?3:0));break;case 3:El[Kl]?El[Kl]+=(ml()<<qa)*Nl:(El[Kl]=Al<<qa,Rl=0);break;case 4:El[Kl]&&(El[Kl]+=(ml()<<qa)*Nl);break}Bl++}Rl===4&&(Ol--,Ol===0&&(Rl=0))}function Ql(Cl,El,Bl,Ml,Ul){var Kl=Bl/il|0,Nl=Bl%il,Zl=Kl*Cl.v+Ml,Wl=Nl*Cl.h+Ul;Cl.blocks[Zl]===void 0&&Ka.tolerantDecoding||El(Cl,Cl.blocks[Zl][Wl])}function Xl(Cl,El,Bl){var Ml=Bl/Cl.blocksPerLine|0,Ul=Bl%Cl.blocksPerLine;Cl.blocks[Ml]===void 0&&Ka.tolerantDecoding||El(Cl,Cl.blocks[Ml][Ul])}var Tl=oa.length,pl,Hl,Ll,Vl,rl,Pl;cl?ca===0?Pl=ga===0?Ja:yl:Pl=ga===0?Il:zl:Pl=xl;var kl=0,Dl,fl;Tl==1?fl=oa[0].blocksPerLine*oa[0].blocksPerColumn:fl=il*pa.mcusPerColumn,ha||(ha=fl);for(var Gl,ql;kl<fl;){for(Hl=0;Hl<Tl;Hl++)oa[Hl].pred=0;if(Ol=0,Tl==1)for(pl=oa[0],rl=0;rl<ha;rl++)Xl(pl,Pl,kl),kl++;else for(rl=0;rl<ha;rl++){for(Hl=0;Hl<Tl;Hl++)for(pl=oa[Hl],Gl=pl.h,ql=pl.v,Ll=0;Ll<ql;Ll++)for(Vl=0;Vl<Gl;Vl++)Ql(pl,Pl,kl,Ll,Vl);if(kl++,kl===fl)break}if(kl===fl)do{if(sa[Ma]===255&&sa[Ma+1]!==0)break;Ma+=1}while(Ma<sa.length-2);if(vl=0,Dl=sa[Ma]<<8|sa[Ma+1],Dl<65280)throw new Error("marker was not found");if(Dl>=65488&&Dl<=65495)Ma+=2;else break}return Ma-wl}function ea(sa,Ma){var pa=[],oa=Ma.blocksPerLine,ha=Ma.blocksPerColumn,ca=oa<<3,da=new Int32Array(64),ga=new Uint8Array(64);function qa(el,dl,xl){var Ja=Ma.quantizationTable,yl,Ol,Il,Rl,Al,zl,Ql,Xl,Tl,pl=xl,Hl;for(Hl=0;Hl<64;Hl++)pl[Hl]=el[Hl]*Ja[Hl];for(Hl=0;Hl<8;++Hl){var Ll=8*Hl;if(pl[1+Ll]==0&&pl[2+Ll]==0&&pl[3+Ll]==0&&pl[4+Ll]==0&&pl[5+Ll]==0&&pl[6+Ll]==0&&pl[7+Ll]==0){Tl=xs*pl[0+Ll]+512>>10,pl[0+Ll]=Tl,pl[1+Ll]=Tl,pl[2+Ll]=Tl,pl[3+Ll]=Tl,pl[4+Ll]=Tl,pl[5+Ll]=Tl,pl[6+Ll]=Tl,pl[7+Ll]=Tl;continue}yl=xs*pl[0+Ll]+128>>8,Ol=xs*pl[4+Ll]+128>>8,Il=pl[2+Ll],Rl=pl[6+Ll],Al=zn*(pl[1+Ll]-pl[7+Ll])+128>>8,Xl=zn*(pl[1+Ll]+pl[7+Ll])+128>>8,zl=pl[3+Ll]<<4,Ql=pl[5+Ll]<<4,Tl=yl-Ol+1>>1,yl=yl+Ol+1>>1,Ol=Tl,Tl=Il*un+Rl*hn+128>>8,Il=Il*hn-Rl*un+128>>8,Rl=Tl,Tl=Al-Ql+1>>1,Al=Al+Ql+1>>1,Ql=Tl,Tl=Xl+zl+1>>1,zl=Xl-zl+1>>1,Xl=Tl,Tl=yl-Rl+1>>1,yl=yl+Rl+1>>1,Rl=Tl,Tl=Ol-Il+1>>1,Ol=Ol+Il+1>>1,Il=Tl,Tl=Al*cn+Xl*ln+2048>>12,Al=Al*ln-Xl*cn+2048>>12,Xl=Tl,Tl=zl*nn+Ql*Pi+2048>>12,zl=zl*Pi-Ql*nn+2048>>12,Ql=Tl,pl[0+Ll]=yl+Xl,pl[7+Ll]=yl-Xl,pl[1+Ll]=Ol+Ql,pl[6+Ll]=Ol-Ql,pl[2+Ll]=Il+zl,pl[5+Ll]=Il-zl,pl[3+Ll]=Rl+Al,pl[4+Ll]=Rl-Al}for(Hl=0;Hl<8;++Hl){var Vl=Hl;if(pl[8+Vl]==0&&pl[16+Vl]==0&&pl[24+Vl]==0&&pl[32+Vl]==0&&pl[40+Vl]==0&&pl[48+Vl]==0&&pl[56+Vl]==0){Tl=xs*xl[Hl+0]+8192>>14,pl[0+Vl]=Tl,pl[8+Vl]=Tl,pl[16+Vl]=Tl,pl[24+Vl]=Tl,pl[32+Vl]=Tl,pl[40+Vl]=Tl,pl[48+Vl]=Tl,pl[56+Vl]=Tl;continue}yl=xs*pl[0+Vl]+2048>>12,Ol=xs*pl[32+Vl]+2048>>12,Il=pl[16+Vl],Rl=pl[48+Vl],Al=zn*(pl[8+Vl]-pl[56+Vl])+2048>>12,Xl=zn*(pl[8+Vl]+pl[56+Vl])+2048>>12,zl=pl[24+Vl],Ql=pl[40+Vl],Tl=yl-Ol+1>>1,yl=yl+Ol+1>>1,Ol=Tl,Tl=Il*un+Rl*hn+2048>>12,Il=Il*hn-Rl*un+2048>>12,Rl=Tl,Tl=Al-Ql+1>>1,Al=Al+Ql+1>>1,Ql=Tl,Tl=Xl+zl+1>>1,zl=Xl-zl+1>>1,Xl=Tl,Tl=yl-Rl+1>>1,yl=yl+Rl+1>>1,Rl=Tl,Tl=Ol-Il+1>>1,Ol=Ol+Il+1>>1,Il=Tl,Tl=Al*cn+Xl*ln+2048>>12,Al=Al*ln-Xl*cn+2048>>12,Xl=Tl,Tl=zl*nn+Ql*Pi+2048>>12,zl=zl*Pi-Ql*nn+2048>>12,Ql=Tl,pl[0+Vl]=yl+Xl,pl[56+Vl]=yl-Xl,pl[8+Vl]=Ol+Ql,pl[48+Vl]=Ol-Ql,pl[16+Vl]=Il+zl,pl[40+Vl]=Il-zl,pl[24+Vl]=Rl+Al,pl[32+Vl]=Rl-Al}for(Hl=0;Hl<64;++Hl){var rl=128+(pl[Hl]+8>>4);dl[Hl]=rl<0?0:rl>255?255:rl}}ia(ca*ha*8);for(var Ka,il,cl=0;cl<ha;cl++){var wl=cl<<3;for(Ka=0;Ka<8;Ka++)pa.push(new Uint8Array(ca));for(var al=0;al<oa;al++){qa(Ma.blocks[cl][al],ga,da);var vl=0,ml=al<<3;for(il=0;il<8;il++){var ol=pa[wl+il];for(Ka=0;Ka<8;Ka++)ol[ml+Ka]=ga[vl++]}}}return pa}function ra(sa){return sa<0?0:sa>255?255:sa}Xn.prototype={load:function(Ma){var pa=new XMLHttpRequest;pa.open("GET",Ma,!0),pa.responseType="arraybuffer",pa.onload=(function(){var oa=new Uint8Array(pa.response||pa.mozResponseArrayBuffer);this.parse(oa),this.onload&&this.onload()}).bind(this),pa.send(null)},parse:function(Ma){var pa=this.opts.maxResolutionInMP*1e3*1e3,oa=0;Ma.length;function ha(){var Nl=Ma[oa]<<8|Ma[oa+1];return oa+=2,Nl}function ca(){var Nl=ha(),Zl=Ma.subarray(oa,oa+Nl-2);return oa+=Zl.length,Zl}function da(Nl){var Zl=1,Wl=1,mh,Eh;for(Eh in Nl.components)Nl.components.hasOwnProperty(Eh)&&(mh=Nl.components[Eh],Zl<mh.h&&(Zl=mh.h),Wl<mh.v&&(Wl=mh.v));var _h=Math.ceil(Nl.samplesPerLine/8/Zl),Dh=Math.ceil(Nl.scanLines/8/Wl);for(Eh in Nl.components)if(Nl.components.hasOwnProperty(Eh)){mh=Nl.components[Eh];var Vh=Math.ceil(Math.ceil(Nl.samplesPerLine/8)*mh.h/Zl),zh=Math.ceil(Math.ceil(Nl.scanLines/8)*mh.v/Wl),Oh=_h*mh.h,Fh=Dh*mh.v,Xh=Fh*Oh,Ih=[];ia(Xh*256);for(var Sh=0;Sh<Fh;Sh++){for(var Nh=[],Cs=0;Cs<Oh;Cs++)Nh.push(new Int32Array(64));Ih.push(Nh)}mh.blocksPerLine=Vh,mh.blocksPerColumn=zh,mh.blocks=Ih}Nl.maxH=Zl,Nl.maxV=Wl,Nl.mcusPerLine=_h,Nl.mcusPerColumn=Dh}var ga=null,qa=null,Ka,il,cl=[],wl=[],al=[],vl=[],ml=ha(),ol=-1;if(this.comments=[],ml!=65496)throw new Error("SOI not found");for(ml=ha();ml!=65497;){var el,dl;switch(ml){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var xl=ca();if(ml===65534){var Ja=String.fromCharCode.apply(null,xl);this.comments.push(Ja)}ml===65504&&xl[0]===74&&xl[1]===70&&xl[2]===73&&xl[3]===70&&xl[4]===0&&(ga={version:{major:xl[5],minor:xl[6]},densityUnits:xl[7],xDensity:xl[8]<<8|xl[9],yDensity:xl[10]<<8|xl[11],thumbWidth:xl[12],thumbHeight:xl[13],thumbData:xl.subarray(14,14+3*xl[12]*xl[13])}),ml===65505&&xl[0]===69&&xl[1]===120&&xl[2]===105&&xl[3]===102&&xl[4]===0&&(this.exifBuffer=xl.subarray(5,xl.length)),ml===65518&&xl[0]===65&&xl[1]===100&&xl[2]===111&&xl[3]===98&&xl[4]===101&&xl[5]===0&&(qa={version:xl[6],flags0:xl[7]<<8|xl[8],flags1:xl[9]<<8|xl[10],transformCode:xl[11]});break;case 65499:for(var yl=ha(),Ol=yl+oa-2;oa<Ol;){var Il=Ma[oa++];ia(256);var Rl=new Int32Array(64);if(Il>>4===0)for(dl=0;dl<64;dl++){var Al=Qe[dl];Rl[Al]=Ma[oa++]}else if(Il>>4===1)for(dl=0;dl<64;dl++){var Al=Qe[dl];Rl[Al]=ha()}else throw new Error("DQT: invalid table spec");cl[Il&15]=Rl}break;case 65472:case 65473:case 65474:ha(),Ka={},Ka.extended=ml===65473,Ka.progressive=ml===65474,Ka.precision=Ma[oa++],Ka.scanLines=ha(),Ka.samplesPerLine=ha(),Ka.components={},Ka.componentsOrder=[];var zl=Ka.scanLines*Ka.samplesPerLine;if(zl>pa){var Ql=Math.ceil((zl-pa)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${Ql}MP`)}var Xl=Ma[oa++],Tl;for(el=0;el<Xl;el++){Tl=Ma[oa];var pl=Ma[oa+1]>>4,Hl=Ma[oa+1]&15,Ll=Ma[oa+2];if(pl<=0||Hl<=0)throw new Error("Invalid sampling factor, expected values above 0");Ka.componentsOrder.push(Tl),Ka.components[Tl]={h:pl,v:Hl,quantizationIdx:Ll},oa+=3}da(Ka),wl.push(Ka);break;case 65476:var Vl=ha();for(el=2;el<Vl;){var rl=Ma[oa++],Pl=new Uint8Array(16),kl=0;for(dl=0;dl<16;dl++,oa++)kl+=Pl[dl]=Ma[oa];ia(16+kl);var Dl=new Uint8Array(kl);for(dl=0;dl<kl;dl++,oa++)Dl[dl]=Ma[oa];el+=17+kl,(rl>>4===0?vl:al)[rl&15]=ys(Pl,Dl)}break;case 65501:ha(),il=ha();break;case 65500:ha(),ha();break;case 65498:ha();var fl=Ma[oa++],Gl=[],ql;for(el=0;el<fl;el++){ql=Ka.components[Ma[oa++]];var Cl=Ma[oa++];ql.huffmanTableDC=vl[Cl>>4],ql.huffmanTableAC=al[Cl&15],Gl.push(ql)}var El=Ma[oa++],Bl=Ma[oa++],Ml=Ma[oa++],Ul=Jo(Ma,oa,Ka,Gl,il,El,Bl,Ml>>4,Ml&15,this.opts);oa+=Ul;break;case 65535:Ma[oa]!==255&&oa--;break;default:if(Ma[oa-3]==255&&Ma[oa-2]>=192&&Ma[oa-2]<=254){oa-=3;break}else if(ml===224||ml==225){if(ol!==-1)throw new Error(`first unknown JPEG marker at offset ${ol.toString(16)}, second unknown JPEG marker ${ml.toString(16)} at offset ${(oa-1).toString(16)}`);ol=oa-1;const Nl=ha();if(Ma[oa+Nl-2]===255){oa+=Nl-2;break}}throw new Error("unknown JPEG marker "+ml.toString(16))}ml=ha()}if(wl.length!=1)throw new Error("only single frame JPEGs supported");for(var el=0;el<wl.length;el++){var Kl=wl[el].components;for(var dl in Kl)Kl[dl].quantizationTable=cl[Kl[dl].quantizationIdx],delete Kl[dl].quantizationIdx}this.width=Ka.samplesPerLine,this.height=Ka.scanLines,this.jfif=ga,this.adobe=qa,this.components=[];for(var el=0;el<Ka.componentsOrder.length;el++){var ql=Ka.components[Ka.componentsOrder[el]];this.components.push({lines:ea(Ka,ql),scaleX:ql.h/Ka.maxH,scaleY:ql.v/Ka.maxV})}},getData:function(Ma,pa){var oa=this.width/Ma,ha=this.height/pa,ca,da,ga,qa,Ka,il,cl,wl,al,vl,ml=0,ol,el,dl,xl,Ja,yl,Ol,Il,Rl,Al,zl,Ql=Ma*pa*this.components.length;ia(Ql);var Xl=new Uint8Array(Ql);switch(this.components.length){case 1:for(ca=this.components[0],vl=0;vl<pa;vl++)for(Ka=ca.lines[0|vl*ca.scaleY*ha],al=0;al<Ma;al++)ol=Ka[0|al*ca.scaleX*oa],Xl[ml++]=ol;break;case 2:for(ca=this.components[0],da=this.components[1],vl=0;vl<pa;vl++)for(Ka=ca.lines[0|vl*ca.scaleY*ha],il=da.lines[0|vl*da.scaleY*ha],al=0;al<Ma;al++)ol=Ka[0|al*ca.scaleX*oa],Xl[ml++]=ol,ol=il[0|al*da.scaleX*oa],Xl[ml++]=ol;break;case 3:for(zl=!0,this.adobe&&this.adobe.transformCode?zl=!0:typeof this.opts.colorTransform<"u"&&(zl=!!this.opts.colorTransform),ca=this.components[0],da=this.components[1],ga=this.components[2],vl=0;vl<pa;vl++)for(Ka=ca.lines[0|vl*ca.scaleY*ha],il=da.lines[0|vl*da.scaleY*ha],cl=ga.lines[0|vl*ga.scaleY*ha],al=0;al<Ma;al++)zl?(ol=Ka[0|al*ca.scaleX*oa],el=il[0|al*da.scaleX*oa],dl=cl[0|al*ga.scaleX*oa],Il=ra(ol+1.402*(dl-128)),Rl=ra(ol-.3441363*(el-128)-.71413636*(dl-128)),Al=ra(ol+1.772*(el-128))):(Il=Ka[0|al*ca.scaleX*oa],Rl=il[0|al*da.scaleX*oa],Al=cl[0|al*ga.scaleX*oa]),Xl[ml++]=Il,Xl[ml++]=Rl,Xl[ml++]=Al;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(zl=!1,this.adobe&&this.adobe.transformCode?zl=!0:typeof this.opts.colorTransform<"u"&&(zl=!!this.opts.colorTransform),ca=this.components[0],da=this.components[1],ga=this.components[2],qa=this.components[3],vl=0;vl<pa;vl++)for(Ka=ca.lines[0|vl*ca.scaleY*ha],il=da.lines[0|vl*da.scaleY*ha],cl=ga.lines[0|vl*ga.scaleY*ha],wl=qa.lines[0|vl*qa.scaleY*ha],al=0;al<Ma;al++)zl?(ol=Ka[0|al*ca.scaleX*oa],el=il[0|al*da.scaleX*oa],dl=cl[0|al*ga.scaleX*oa],xl=wl[0|al*qa.scaleX*oa],Ja=255-ra(ol+1.402*(dl-128)),yl=255-ra(ol-.3441363*(el-128)-.71413636*(dl-128)),Ol=255-ra(ol+1.772*(el-128))):(Ja=Ka[0|al*ca.scaleX*oa],yl=il[0|al*da.scaleX*oa],Ol=cl[0|al*ga.scaleX*oa],xl=wl[0|al*qa.scaleX*oa]),Xl[ml++]=255-Ja,Xl[ml++]=255-yl,Xl[ml++]=255-Ol,Xl[ml++]=255-xl;break;default:throw new Error("Unsupported color mode")}return Xl},copyToImageData:function(Ma,pa){var oa=Ma.width,ha=Ma.height,ca=Ma.data,da=this.getData(oa,ha),ga=0,qa=0,Ka,il,cl,wl,al,vl,ml,ol,el;switch(this.components.length){case 1:for(il=0;il<ha;il++)for(Ka=0;Ka<oa;Ka++)cl=da[ga++],ca[qa++]=cl,ca[qa++]=cl,ca[qa++]=cl,pa&&(ca[qa++]=255);break;case 3:for(il=0;il<ha;il++)for(Ka=0;Ka<oa;Ka++)ml=da[ga++],ol=da[ga++],el=da[ga++],ca[qa++]=ml,ca[qa++]=ol,ca[qa++]=el,pa&&(ca[qa++]=255);break;case 4:for(il=0;il<ha;il++)for(Ka=0;Ka<oa;Ka++)al=da[ga++],vl=da[ga++],cl=da[ga++],wl=da[ga++],ml=255-ra(al*(1-wl/255)+wl),ol=255-ra(vl*(1-wl/255)+wl),el=255-ra(cl*(1-wl/255)+wl),ca[qa++]=ml,ca[qa++]=ol,ca[qa++]=el,pa&&(ca[qa++]=255);break;default:throw new Error("Unsupported color mode")}}};var na=0,ta=0;function ia(sa=0){var Ma=na+sa;if(Ma>ta){var pa=Math.ceil((Ma-ta)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${pa}MB`)}na=Ma}return Xn.resetMaxMemoryUsage=function(sa){na=0,ta=sa},Xn.getBytesAllocated=function(){return na},Xn.requestMemoryAllocation=ia,Xn}();qe.exports=ze;function ze(Ke,Qe={}){var Pi={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},nn={...Pi,...Qe},ln=new Uint8Array(Ke),cn=new f;cn.opts=nn,f.resetMaxMemoryUsage(nn.maxMemoryUsageInMB*1024*1024),cn.parse(ln);var hn=nn.formatAsRGBA?4:3,un=cn.width*cn.height*hn;try{f.requestMemoryAllocation(un);var xs={width:cn.width,height:cn.height,exifBuffer:cn.exifBuffer,data:nn.useTArray?new Uint8Array(un):Buffer.alloc(un)};cn.comments.length>0&&(xs.comments=cn.comments)}catch(zn){throw zn instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+un):zn instanceof ReferenceError&&zn.message==="Buffer is not defined"?new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true"):zn}return cn.copyToImageData(xs,nn.formatAsRGBA),xs}}(decoder)),decoder.exports}var jpegJs,hasRequiredJpegJs;function requireJpegJs(){if(hasRequiredJpegJs)return jpegJs;hasRequiredJpegJs=1;var qe=requireEncoder(),f=requireDecoder();return jpegJs={encode:qe,decode:f},jpegJs}var jpegJsExports=requireJpegJs();let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256);for(let qe=0;qe<chars.length;qe++)lookup[chars.charCodeAt(qe)]=qe;function encode(qe){let f,ze=qe.length,Ke="";for(f=0;f<ze;f+=3)Ke+=chars[qe[f]>>2],Ke+=chars[(qe[f]&3)<<4|qe[f+1]>>4],Ke+=chars[(qe[f+1]&15)<<2|qe[f+2]>>6],Ke+=chars[qe[f+2]&63];return ze%3===2?Ke=`${Ke.substring(0,Ke.length-1)}=`:ze%3===1&&(Ke=`${Ke.substring(0,Ke.length-2)}==`),Ke}function decode$1(qe){let f=qe.length*.75,ze=qe.length,Ke=0,Qe,Pi,nn,ln;qe[qe.length-1]==="="&&(f--,qe[qe.length-2]==="="&&f--);const cn=new Uint8Array(f);for(let hn=0;hn<ze;hn+=4)Qe=lookup[qe.charCodeAt(hn)],Pi=lookup[qe.charCodeAt(hn+1)],nn=lookup[qe.charCodeAt(hn+2)],ln=lookup[qe.charCodeAt(hn+3)],cn[Ke++]=Qe<<2|Pi>>4,cn[Ke++]=(Pi&15)<<4|nn>>2,cn[Ke++]=(nn&3)<<6|ln&63;return cn}function toBase64URL(qe,f){const ze=encode(qe);return`data:${f};base64,${ze}`}const ImageData$1=self.ImageData,DOMImage=self.Image;function createCanvas(qe,f){let ze=self.document.createElement("canvas");return ze.width=qe,ze.height=f,ze}function fetchBinary(qe,{withCredentials:f=!1}={}){return new Promise(function(ze,Ke){let Qe=new self.XMLHttpRequest;Qe.open("GET",qe,!0),Qe.responseType="arraybuffer",Qe.withCredentials=f,Qe.onload=function(Pi){this.status!==200?Ke(Pi):ze(this.response)},Qe.onerror=Ke,Qe.send()})}function createWriteStream(){throw new Error("createWriteStream does not exist in the browser")}function writeFile(){throw new Error("writeFile does not exist in the browser")}function getType(qe){return qe.includes("/")||(qe=`image/${qe}`),qe}function encodeJpeg(qe,f={}){const ze={width:qe.width,height:qe.height,data:qe.getRGBAData()};return jpegJsExports.encode(ze,f.quality).data}function encodePng(qe,f){const ze={width:qe.width,height:qe.height,channels:qe.channels,depth:qe.bitDepth,data:qe.data};return(ze.depth===1||ze.depth===32)&&(ze.depth=8,ze.channels=4,ze.data=qe.getRGBAData()),encodePng$1(ze,f)}const exportMethods={save(qe,f={}){const{useCanvas:ze=!1,encoder:Ke=void 0}=f;let{format:Qe}=f;if(!Qe){const Pi=/\.(?<format>[a-zA-Z]+)$/.exec(qe);Pi&&(Qe=Pi.groups.format.toLowerCase())}if(!Qe)throw new Error("file format not provided");return new Promise((Pi,nn)=>{let ln,cn;switch(Qe.toLowerCase()){case"png":{ze?ln=this.getCanvas().pngStream():cn=encodePng(this,Ke);break}case"jpg":case"jpeg":ze?ln=this.getCanvas().jpegStream():cn=encodeJpeg(this,Ke);break;case"bmp":cn=srcExports$3.encode(this,Ke);break;default:throw new RangeError(`invalid output format: ${Qe}`)}if(ln){let hn=createWriteStream();hn.on("finish",Pi),hn.on("error",nn),ln.pipe(hn)}else cn&&writeFile()})},toDataURL(qe="image/png",f={}){typeof qe=="object"&&(f=qe,qe="image/png");const{useCanvas:ze=!1,encoder:Ke=void 0}=f;qe=getType(qe);function Qe(Pi,nn){const ln=Pi(nn,Ke);return toBase64URL(ln,qe)}return qe==="image/bmp"?Qe(srcExports$3.encode,this):qe==="image/png"&&!ze?Qe(encodePng,this):qe==="image/jpeg"&&!ze?Qe(encodeJpeg,this):this.getCanvas().toDataURL(qe)},toBuffer(qe={}){const{format:f="png",encoder:ze=void 0}=qe;switch(f.toLowerCase()){case"png":return encodePng(this,ze);case"jpeg":case"jpg":return encodeJpeg(this,ze);case"bmp":return srcExports$3.encode(this,ze);default:throw new RangeError(`invalid output format: ${f}`)}},toBase64(qe="image/png",f={}){if(f.async)return this.toDataURL(qe,f).then(function(ze){return ze.substring(ze.indexOf(",")+1)});{const ze=this.toDataURL(qe,f);return ze.substring(ze.indexOf(",")+1)}},toBlob(qe="image/png",f=.8){return canvasToBlob(this.getCanvas(),qe,f)},getCanvas(){const qe=new ImageData$1(this.getRGBAData({clamped:!0}),this.width,this.height);let f=createCanvas(this.width,this.height);return f.getContext("2d").putImageData(qe,0,0),f}};function setExportMethods(qe){for(const f in exportMethods)qe.prototype[f]=exportMethods[f]}var hasOwn$1={exports:{}};const version="1.0.1",require$$0$2={version};var hasRequiredHasOwn;function requireHasOwn(){return hasRequiredHasOwn||(hasRequiredHasOwn=1,function(qe,f){var ze=Object.prototype.hasOwnProperty;qe.exports=f=function(Qe,Pi){return ze.call(Pi,Qe)},f.version=require$$0$2.version}(hasOwn$1,hasOwn$1.exports)),hasOwn$1.exports}var hasOwnExports=requireHasOwn();const hasOwn=getDefaultExportFromCjs(hasOwnExports);let computedPropertyDescriptor$1={configurable:!0,enumerable:!1,get:void 0};function extendMethod(qe,f,ze={}){let{inPlace:Ke=!1,returnThis:Qe=!0,partialArgs:Pi=[]}=ze;return Ke?Image$1.prototype[qe]=function(...nn){this.computed=null;let ln=f.apply(this,[...Pi,...nn]);return Qe?this:ln}:Image$1.prototype[qe]=function(...nn){return f.apply(this,[...Pi,...nn])},Image$1}function extendProperty(qe,f,ze={}){let{partialArgs:Ke=[]}=ze;return computedPropertyDescriptor$1.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(qe,this.computed))return this.computed[qe];let Qe=f.apply(this,Ke);return this.computed[qe]=Qe,Qe},Object.defineProperty(Image$1.prototype,qe,computedPropertyDescriptor$1),Image$1}const GREY$1="GREY",RGB$1="RGB",HSL="HSL",HSV="HSV",CMYK$1="CMYK",ColorModel=Object.freeze(Object.defineProperty({__proto__:null,CMYK:CMYK$1,GREY:GREY$1,HSL,HSV,RGB:RGB$1},Symbol.toStringTag,{value:"Module"}));function getRGBAData(qe={}){const{clamped:f}=qe;this.checkProcessable("getRGBAData",{components:[1,3],bitDepth:[1,8,16,32]});const ze=this.width*this.height*4;let Ke=f?new Uint8ClampedArray(ze):new Uint8Array(ze);return this.bitDepth===1?fillDataFromBinary(this,Ke):this.bitDepth===32?(this.checkProcessable("getRGBAData",{alpha:0}),this.components===1?fillDataFromGrey32(this,Ke):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB32(this,Ke))):this.components===1?fillDataFromGrey(this,Ke):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB(this,Ke)),this.alpha===1?(this.checkProcessable("getRGBAData",{bitDepth:[8,16]}),copyAlpha(this,Ke)):fillAlpha(this,Ke),Ke}function fillDataFromBinary(qe,f){for(let ze=0;ze<qe.size;ze++){const Ke=qe.getBit(ze);f[ze*4]=Ke*255,f[ze*4+1]=Ke*255,f[ze*4+2]=Ke*255}}function fillDataFromGrey32(qe,f){const ze=qe.min[0],Qe=qe.max[0]-ze;for(let Pi=0;Pi<qe.size;Pi++){const nn=Math.floor(255*(qe.data[Pi]-ze)/Qe);f[Pi*4]=nn,f[Pi*4+1]=nn,f[Pi*4+2]=nn}}function fillDataFromRGB32(qe,f){const ze=Math.min(...qe.min),Qe=Math.max(...qe.max)-ze;for(let Pi=0;Pi<qe.size;Pi++){const nn=Math.floor(255*(qe.data[Pi*3]-ze)/Qe),ln=Math.floor(255*(qe.data[Pi*3+1]-ze)/Qe),cn=Math.floor(255*(qe.data[Pi*3+2]-ze)/Qe);f[Pi*4]=nn,f[Pi*4+1]=ln,f[Pi*4+2]=cn}}function fillDataFromGrey(qe,f){for(let ze=0;ze<qe.size;ze++)f[ze*4]=qe.data[ze*qe.channels]>>>qe.bitDepth-8,f[ze*4+1]=qe.data[ze*qe.channels]>>>qe.bitDepth-8,f[ze*4+2]=qe.data[ze*qe.channels]>>>qe.bitDepth-8}function fillDataFromRGB(qe,f){for(let ze=0;ze<qe.size;ze++)f[ze*4]=qe.data[ze*qe.channels]>>>qe.bitDepth-8,f[ze*4+1]=qe.data[ze*qe.channels+1]>>>qe.bitDepth-8,f[ze*4+2]=qe.data[ze*qe.channels+2]>>>qe.bitDepth-8}function copyAlpha(qe,f){for(let ze=0;ze<qe.size;ze++)f[ze*4+3]=qe.data[ze*qe.channels+qe.components]>>qe.bitDepth-8}function fillAlpha(qe,f){for(let ze=0;ze<qe.size;ze++)f[ze*4+3]=255}const BINARY="BINARY",GREY="GREY",GREYA="GREYA",RGB="RGB",RGBA="RGBA",CMYK="CMYK",CMYKA="CMYKA",kinds={};kinds[BINARY]={components:1,alpha:0,bitDepth:1,colorModel:GREY$1};kinds[GREYA]={components:1,alpha:1,bitDepth:8,colorModel:GREY$1};kinds[GREY]={components:1,alpha:0,bitDepth:8,colorModel:GREY$1};kinds[RGBA]={components:3,alpha:1,bitDepth:8,colorModel:RGB$1};kinds[RGB]={components:3,alpha:0,bitDepth:8,colorModel:RGB$1};kinds[CMYK]={components:4,alpha:0,bitDepth:8,colorModel:CMYK$1};kinds[CMYKA]={components:4,alpha:1,bitDepth:8,colorModel:CMYK$1};function getKind(qe){const f=kinds[qe];if(!f)throw new RangeError(`invalid image kind: ${qe}`);return f}const validBitDepth=[1,8,16,32];function verifyKindDefinition(qe){const{components:f,alpha:ze,bitDepth:Ke,colorModel:Qe}=qe;if(!Number.isInteger(f)||f<=0)throw new RangeError(`invalid components: ${f}. Must be a positive integer`);if(ze!==0&&ze!==1&&typeof ze!="boolean")throw new TypeError(`invalid alpha: ${ze}: must be a boolean, 0 or 1`);if(!validBitDepth.includes(Ke))throw new RangeError(`invalid bitDepth: ${Ke}. Must be one of ${validBitDepth.join(", ")}`);if(!ColorModel[Qe])throw new RangeError(`invalid colorModel: ${Qe}. Must be one of ${Object.keys(ColorModel).join(", ")}`)}function getTheoreticalPixelArraySize(qe,f,ze){let Ke=f*qe;return ze===1&&(Ke=Math.ceil(Ke/8)),Ke}function createPixelArray(qe,f,ze,Ke,Qe,Pi){const nn=Ke*qe;let ln;switch(Qe){case 1:ln=new Uint8Array(Math.ceil(nn/8));break;case 8:ln=new Uint8Array(nn);break;case 16:ln=new Uint16Array(nn);break;case 32:ln=new Float32Array(nn);break;default:throw new Error(`Cannot create pixel array for bit depth ${Qe}`)}if(ze)for(let cn=f;cn<ln.length;cn+=Ke)ln[cn]=Pi;return ln}var src$4={},IOBuffer_1,hasRequiredIOBuffer;function requireIOBuffer(){if(hasRequiredIOBuffer)return IOBuffer_1;hasRequiredIOBuffer=1;const qe=1024*8,f=[];class ze{constructor(Qe,Pi){Pi=Pi||{},Qe===void 0&&(Qe=qe),typeof Qe=="number"&&(Qe=new ArrayBuffer(Qe));let nn=Qe.byteLength;const ln=Pi.offset?Pi.offset>>>0:0;Qe.buffer&&(nn=Qe.byteLength-ln,Qe.byteLength!==Qe.buffer.byteLength?Qe=Qe.buffer.slice(Qe.byteOffset+ln,Qe.byteOffset+Qe.byteLength):ln?Qe=Qe.buffer.slice(ln):Qe=Qe.buffer),this.buffer=Qe,this.length=nn,this.byteLength=nn,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=nn||qe,this._mark=0}available(Qe){return Qe===void 0&&(Qe=1),this.offset+Qe<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(Qe){Qe===void 0&&(Qe=1),this.offset+=Qe}seek(Qe){this.offset=Qe}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(Qe){if(Qe===void 0&&(Qe=1),!this.available(Qe)){const Pi=this._increment+this._increment;this._increment=Pi;const nn=this.length+Pi,ln=new Uint8Array(nn);ln.set(new Uint8Array(this.buffer)),this.buffer=ln.buffer,this.length=nn,this._data=new DataView(this.buffer)}}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(Qe){Qe===void 0&&(Qe=1);for(var Pi=new Uint8Array(Qe),nn=0;nn<Qe;nn++)Pi[nn]=this.readByte();return Pi}readInt16(){var Qe=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,Qe}readUint16(){var Qe=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,Qe}readInt32(){var Qe=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,Qe}readUint32(){var Qe=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,Qe}readFloat32(){var Qe=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,Qe}readFloat64(){var Qe=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,Qe}readChar(){return String.fromCharCode(this.readInt8())}readChars(Qe){Qe===void 0&&(Qe=1),f.length=Qe;for(var Pi=0;Pi<Qe;Pi++)f[Pi]=this.readChar();return f.join("")}writeBoolean(Qe){this.writeUint8(Qe?255:0)}writeInt8(Qe){this.ensureAvailable(1),this._data.setInt8(this.offset++,Qe)}writeUint8(Qe){this.ensureAvailable(1),this._data.setUint8(this.offset++,Qe)}writeByte(Qe){this.writeUint8(Qe)}writeBytes(Qe){this.ensureAvailable(Qe.length);for(var Pi=0;Pi<Qe.length;Pi++)this._data.setUint8(this.offset++,Qe[Pi])}writeInt16(Qe){this.ensureAvailable(2),this._data.setInt16(this.offset,Qe,this.littleEndian),this.offset+=2}writeUint16(Qe){this.ensureAvailable(2),this._data.setUint16(this.offset,Qe,this.littleEndian),this.offset+=2}writeInt32(Qe){this.ensureAvailable(4),this._data.setInt32(this.offset,Qe,this.littleEndian),this.offset+=4}writeUint32(Qe){this.ensureAvailable(4),this._data.setUint32(this.offset,Qe,this.littleEndian),this.offset+=4}writeFloat32(Qe){this.ensureAvailable(4),this._data.setFloat32(this.offset,Qe,this.littleEndian),this.offset+=4}writeFloat64(Qe){this.ensureAvailable(8),this._data.setFloat64(this.offset,Qe,this.littleEndian),this.offset+=8}writeChar(Qe){this.writeUint8(Qe.charCodeAt(0))}writeChars(Qe){for(var Pi=0;Pi<Qe.length;Pi++)this.writeUint8(Qe.charCodeAt(Pi))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}}return IOBuffer_1=ze,IOBuffer_1}var src$3={},standard$1,hasRequiredStandard;function requireStandard(){if(hasRequiredStandard)return standard$1;hasRequiredStandard=1;const qe={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},f={};for(var ze in qe)f[qe[ze]]=ze;return standard$1={tagsById:qe,tagsByName:f},standard$1}var exif$1,hasRequiredExif;function requireExif(){if(hasRequiredExif)return exif$1;hasRequiredExif=1;const qe={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},f={};for(var ze in qe)f[qe[ze]]=ze;return exif$1={tagsById:qe,tagsByName:f},exif$1}var gps$1,hasRequiredGps;function requireGps(){if(hasRequiredGps)return gps$1;hasRequiredGps=1;const qe={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},f={};for(var ze in qe)f[qe[ze]]=ze;return gps$1={tagsById:qe,tagsByName:f},gps$1}var ifd,hasRequiredIfd;function requireIfd(){if(hasRequiredIfd)return ifd;hasRequiredIfd=1;const qe={standard:requireStandard(),exif:requireExif(),gps:requireGps()};class f{constructor(Ke){if(!Ke)throw new Error("missing kind");this.data=null,this.fields=new Map,this.kind=Ke,this._map=null}get(Ke){if(typeof Ke=="number")return this.fields.get(Ke);if(typeof Ke=="string")return this.fields.get(qe[this.kind].tagsByName[Ke]);throw new Error("expected a number or string")}get map(){if(!this._map){this._map={};const Qe=qe[this.kind].tagsById;for(var Ke of this.fields.keys())Qe[Ke]&&(this._map[Qe[Ke]]=this.fields.get(Ke))}return this._map}}return ifd=f,ifd}var tiffIfd,hasRequiredTiffIfd;function requireTiffIfd(){if(hasRequiredTiffIfd)return tiffIfd;hasRequiredTiffIfd=1;const qe=requireIfd(),f=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class ze extends qe{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var Pi=new Date,nn=f.exec(this.dateTime);return Pi.setFullYear(nn[1],nn[2]-1,nn[3]),Pi.setHours(nn[4],nn[5],nn[6]),Pi}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return Ke(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return Ke(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}}function Ke(Qe){return typeof Qe=="number"?[Qe]:Qe}return tiffIfd=ze,tiffIfd}var ifdValue={},hasRequiredIfdValue;function requireIfdValue(){if(hasRequiredIfdValue)return ifdValue;hasRequiredIfdValue=1;var qe=new Map([[1,[1,f]],[2,[1,ze]],[3,[2,Ke]],[4,[4,Qe]],[5,[8,Pi]],[6,[1,nn]],[7,[1,f]],[8,[2,ln]],[9,[4,cn]],[10,[8,hn]],[11,[4,un]],[12,[8,xs]]]);ifdValue.getByteLength=function(zn,Xn){return qe.get(zn)[0]*Xn},ifdValue.readData=function(zn,Xn,ys){return qe.get(Xn)[1](zn,ys)};function f(zn,Xn){if(Xn===1)return zn.readUint8();for(var ys=new Uint8Array(Xn),Jo=0;Jo<Xn;Jo++)ys[Jo]=zn.readUint8();return ys}function ze(zn,Xn){for(var ys=[],Jo="",ea=0;ea<Xn;ea++){var ra=String.fromCharCode(zn.readUint8());ra==="\0"?(ys.push(Jo),Jo=""):Jo+=ra}return ys.length===1?ys[0]:ys}function Ke(zn,Xn){if(Xn===1)return zn.readUint16();for(var ys=new Uint16Array(Xn),Jo=0;Jo<Xn;Jo++)ys[Jo]=zn.readUint16();return ys}function Qe(zn,Xn){if(Xn===1)return zn.readUint32();for(var ys=new Uint32Array(Xn),Jo=0;Jo<Xn;Jo++)ys[Jo]=zn.readUint32();return ys}function Pi(zn,Xn){if(Xn===1)return zn.readUint32()/zn.readUint32();for(var ys=new Array(Xn),Jo=0;Jo<Xn;Jo++)ys[Jo]=zn.readUint32()/zn.readUint32();return ys}function nn(zn,Xn){if(Xn===1)return zn.readInt8();for(var ys=new Int8Array(Xn),Jo=0;Jo<Xn;Jo++)ys[Jo]=zn.readInt8();return ys}function ln(zn,Xn){if(Xn===1)return zn.readInt16();for(var ys=new Int16Array(Xn),Jo=0;Jo<Xn;Jo++)ys[Jo]=zn.readInt16();return ys}function cn(zn,Xn){if(Xn===1)return zn.readInt32();for(var ys=new Int32Array(Xn),Jo=0;Jo<Xn;Jo++)ys[Jo]=zn.readInt32();return ys}function hn(zn,Xn){if(Xn===1)return zn.readInt32()/zn.readInt32();for(var ys=new Array(Xn),Jo=0;Jo<Xn;Jo++)ys[Jo]=zn.readInt32()/zn.readInt32();return ys}function un(zn,Xn){if(Xn===1)return zn.readFloat32();for(var ys=new Float32Array(Xn),Jo=0;Jo<Xn;Jo++)ys[Jo]=zn.readFloat32();return ys}function xs(zn,Xn){if(Xn===1)return zn.readFloat64();for(var ys=new Float64Array(Xn),Jo=0;Jo<Xn;Jo++)ys[Jo]=zn.readFloat64();return ys}return ifdValue}var tiffDecoder,hasRequiredTiffDecoder;function requireTiffDecoder(){if(hasRequiredTiffDecoder)return tiffDecoder;hasRequiredTiffDecoder=1;const qe=requireIOBuffer(),f=requireIfd(),ze=requireTiffIfd(),Ke=requireIfdValue(),Qe={ignoreImageData:!1,onlyFirst:!1};class Pi extends qe{constructor(Xn,ys){super(Xn,ys),this._nextIFD=0}decode(Xn){Xn=Object.assign({},Qe,Xn);const ys=[];for(this.decodeHeader();this._nextIFD;)if(ys.push(this.decodeIFD(Xn)),Xn.onlyFirst)return ys[0];return ys}decodeHeader(){let Xn=this.readUint16();if(Xn===18761)this.setLittleEndian();else if(Xn===19789)this.setBigEndian();else throw new Error("invalid byte order: 0x"+Xn.toString(16));if(Xn=this.readUint16(),Xn!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(Xn){this.seek(this._nextIFD);var ys;Xn.kind?ys=new f(Xn.kind):ys=new ze;const Jo=this.readUint16();for(var ea=0;ea<Jo;ea++)this.decodeIFDEntry(ys);return Xn.ignoreImageData||this.decodeImageData(ys),this._nextIFD=this.readUint32(),ys}decodeIFDEntry(Xn){const ys=this.offset,Jo=this.readUint16(),ea=this.readUint16(),ra=this.readUint32();if(ea<1||ea>12){this.skip(4);return}Ke.getByteLength(ea,ra)>4&&this.seek(this.readUint32());const ta=Ke.readData(this,ea,ra);if(Xn.fields.set(Jo,ta),Jo===34665||Jo===34853){let ia=this.offset,sa;Jo===34665?sa="exif":Jo===34853&&(sa="gps"),this._nextIFD=ta,Xn[sa]=this.decodeIFD({kind:sa,ignoreImageData:!0}),this.offset=ia}this.seek(ys),this.skip(12)}decodeImageData(Xn){const ys=Xn.orientation;switch(ys&&ys!==1&&un("orientation",ys),Xn.type){case 1:case 2:this.readStripData(Xn);break;default:un("image type",Xn.type);break}}readStripData(Xn){const ys=Xn.width,Jo=Xn.height,ea=xs(Xn.bitsPerSample),ra=Xn.sampleFormat;let na=ys*Jo;const ta=nn(na,1,ea,ra),ia=Xn.compression,Ma=Xn.rowsPerStrip*ys,pa=Xn.stripOffsets,oa=Xn.stripByteCounts;for(var ha=0,ca=0;ca<pa.length;ca++){var da=this.getStripData(ia,pa[ca],oa[ca]),ga=na>Ma?Ma:na;na-=ga,ea===8?ha=ln(ta,da,ha,ga):ea===16?ha=cn(ta,da,ha,ga,this.isLittleEndian()):ea===32&&ra===3?ha=hn(ta,da,ha,ga,this.isLittleEndian()):un("bitDepth",ea)}Xn.data=ta}getStripData(Xn,ys,Jo){switch(Xn){case 1:return new DataView(this.buffer,ys,Jo);case 2:case 32773:return un("Compression",Xn);default:throw new Error("invalid compression: "+Xn)}}}tiffDecoder=Pi;function nn(zn,Xn,ys,Jo){return ys===8?new Uint8Array(zn*Xn):ys===16?new Uint16Array(zn*Xn):ys===32&&Jo===3?new Float32Array(zn*Xn):un("bit depth / sample format",ys+" / "+Jo)}function ln(zn,Xn,ys,Jo){for(var ea=0;ea<Jo;ea++)zn[ys++]=Xn.getUint8(ea);return ys}function cn(zn,Xn,ys,Jo,ea){for(var ra=0;ra<Jo*2;ra+=2)zn[ys++]=Xn.getUint16(ra,ea);return ys}function hn(zn,Xn,ys,Jo,ea){for(var ra=0;ra<Jo*4;ra+=4)zn[ys++]=Xn.getFloat32(ra,ea);return ys}function un(zn,Xn){throw new Error("Unsupported "+zn+": "+Xn)}function xs(zn){if(zn.length){const ys=zn;zn=ys[0];for(var Xn=0;Xn<ys.length;Xn++)ys[Xn]!==zn&&un("bit depth",ys)}return zn}return tiffDecoder}var decode,hasRequiredDecode$1;function requireDecode$1(){if(hasRequiredDecode$1)return decode;hasRequiredDecode$1=1;const qe=requireTiffDecoder();return decode=function(ze,Ke){return new qe(ze,Ke).decode(Ke)},decode}var hasRequiredSrc$4;function requireSrc$4(){return hasRequiredSrc$4||(hasRequiredSrc$4=1,src$3.decode=requireDecode$1()),src$3}var decode_1,hasRequiredDecode;function requireDecode(){if(hasRequiredDecode)return decode_1;hasRequiredDecode=1;const qe=requireIOBuffer(),f=requireSrc$4();function ze(Ke){const Qe=new qe(Ke),Pi={};if(Qe.setBigEndian(),Qe.readUint16()!==65496)throw new Error("SOI marker not found. Not a valid JPEG file");if(Qe.readUint16()===65505){Qe.readUint16();const cn=Qe.readBytes(6);if(cn[0]===69&&cn[1]===120&&cn[2]===105&&cn[3]===102&&cn[4]===0&&cn[5]===0){const hn=f.decode(Qe,{onlyFirst:!0,ignoreImageData:!0,offset:Qe.offset});Pi.exif=hn}}return Pi}return decode_1=ze,decode_1}var hasRequiredSrc$3;function requireSrc$3(){return hasRequiredSrc$3||(hasRequiredSrc$3=1,src$4.decode=requireDecode()),src$4}var srcExports$2=requireSrc$3(),imageType$1={exports:{}},fileType={exports:{}},hasRequiredFileType;function requireFileType(){return hasRequiredFileType||(hasRequiredFileType=1,function(module){const toBytes=qe=>[...qe].map(f=>f.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(qe,f=0){let ze=qe[f],Ke=1,Qe=0;for(;++Qe<8;)Ke*=256,ze+=qe[f+Qe]*Ke;return ze}const fileType=qe=>{if(!(qe instanceof Uint8Array||qe instanceof ArrayBuffer||Buffer.isBuffer(qe)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof qe}\``);const f=qe instanceof Uint8Array?qe:new Uint8Array(qe);if(!(f&&f.length>1))return null;const ze=(Qe,Pi)=>{Pi=Object.assign({offset:0},Pi);for(let nn=0;nn<Qe.length;nn++)if(Pi.mask){if(Qe[nn]!==(Pi.mask[nn]&f[nn+Pi.offset]))return!1}else if(Qe[nn]!==f[nn+Pi.offset])return!1;return!0},Ke=(Qe,Pi)=>ze(toBytes(Qe),Pi);if(ze([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(ze([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(ze([71,73,70]))return{ext:"gif",mime:"image/gif"};if(ze([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(ze([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((ze([73,73,42,0])||ze([77,77,0,42]))&&ze([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(ze([73,73,42,0])||ze([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(ze([66,77]))return{ext:"bmp",mime:"image/bmp"};if(ze([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(ze([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(ze([80,75,3,4])){if(ze([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(ze(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(Ke("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(Ke("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(Ke("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const Qe=(cn,hn=0)=>cn.findIndex((un,xs,zn)=>xs>=hn&&zn[xs]===80&&zn[xs+1]===75&&zn[xs+2]===3&&zn[xs+3]===4);let Pi=0,nn=!1,ln=null;do{const cn=Pi+30;if(nn||(nn=ze(oxmlContentTypes,{offset:cn})||ze(oxmlRels,{offset:cn})),ln||(Ke("word/",{offset:cn})?ln={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:Ke("ppt/",{offset:cn})?ln={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:Ke("xl/",{offset:cn})&&(ln={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),nn&&ln)return ln;Pi=Qe(f,cn)}while(Pi>=0);if(ln)return ln}if(ze([80,75])&&(f[2]===3||f[2]===5||f[2]===7)&&(f[3]===4||f[3]===6||f[3]===8))return{ext:"zip",mime:"application/zip"};if(ze([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(ze([82,97,114,33,26,7])&&(f[6]===0||f[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(ze([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(ze([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(ze([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(ze([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(ze([51,103,112,53])||ze([0,0,0])&&ze([102,116,121,112],{offset:4})&&(ze([109,112,52,49],{offset:8})||ze([109,112,52,50],{offset:8})||ze([105,115,111,109],{offset:8})||ze([105,115,111,50],{offset:8})||ze([109,109,112,52],{offset:8})||ze([77,52,86],{offset:8})||ze([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(ze([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(ze([26,69,223,163])){const Qe=f.subarray(4,4100),Pi=Qe.findIndex((nn,ln,cn)=>cn[ln]===66&&cn[ln+1]===130);if(Pi!==-1){const nn=Pi+3,ln=cn=>[...cn].every((hn,un)=>Qe[nn+un]===hn.charCodeAt(0));if(ln("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(ln("webm"))return{ext:"webm",mime:"video/webm"}}}if(ze([0,0,0,20,102,116,121,112,113,116,32,32])||ze([102,114,101,101],{offset:4})||ze([102,116,121,112,113,116,32,32],{offset:4})||ze([109,100,97,116],{offset:4})||ze([109,111,111,118],{offset:4})||ze([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(ze([82,73,70,70])){if(ze([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(ze([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(ze([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(ze([48,38,178,117,142,102,207,17,166,217])){let Qe=30;do{const Pi=readUInt64LE(f,Qe+16);if(ze([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:Qe})){if(ze([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:Qe+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(ze([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:Qe+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}Qe+=Pi}while(Qe+24<=f.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(ze([0,0,1,186])||ze([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(ze([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let Qe=0;Qe<2&&Qe<f.length-16;Qe++){if(ze([73,68,51],{offset:Qe})||ze([255,226],{offset:Qe,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(ze([255,228],{offset:Qe,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(ze([255,248],{offset:Qe,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(ze([255,240],{offset:Qe,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(ze([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(ze([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(ze([79,103,103,83]))return ze([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:ze([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:ze([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:ze([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:ze([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(ze([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(ze([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(ze([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(ze([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(ze([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(ze([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((f[0]===67||f[0]===70)&&ze([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(ze([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(ze([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(ze([119,79,70,70])&&(ze([0,1,0,0],{offset:4})||ze([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(ze([119,79,70,50])&&(ze([0,1,0,0],{offset:4})||ze([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(ze([76,80],{offset:34})&&(ze([0,0,1],{offset:8})||ze([1,0,2],{offset:8})||ze([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(ze([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(ze([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(ze([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(ze([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(ze([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(ze([37,33]))return{ext:"ps",mime:"application/postscript"};if(ze([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(ze([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(ze([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(ze([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(ze([77,83,67,70])||ze([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(ze([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(ze([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(ze([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(ze([31,160])||ze([31,157]))return{ext:"Z",mime:"application/x-compress"};if(ze([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(ze([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(ze([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(ze([71],{offset:4})&&(ze([71],{offset:192})||ze([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(ze([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(ze([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(ze([0,0,0,12,106,80,32,32,13,10,135,10])){if(ze([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(ze([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(ze([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(ze([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(ze([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(Ke("<?xml "))return{ext:"xml",mime:"application/xml"};if(ze([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(ze([102,116,121,112],{offset:4})){if(ze([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(ze([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(ze([104,101,105,99],{offset:8})||ze([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(ze([104,101,118,99],{offset:8})||ze([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return ze([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:ze([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:ze([77,80,43])?{ext:"mpc",mime:"audio/x-musepack"}:ze([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:ze([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:ze([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:ze([212,195,178,161])||ze([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",()=>{const qe=new stream.PassThrough,f=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{qe.fileType=fileType(f)}catch(ze){reject(ze)}readableStream.unshift(f),stream.pipeline?resolve(stream.pipeline(readableStream,qe,()=>{})):resolve(readableStream.pipe(qe))})})}(fileType)),fileType.exports}var hasRequiredImageType;function requireImageType(){if(hasRequiredImageType)return imageType$1.exports;hasRequiredImageType=1;const qe=requireFileType(),f=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),ze=Ke=>{const Qe=qe(Ke);return f.has(Qe&&Qe.ext)?Qe:null};return imageType$1.exports=ze,imageType$1.exports.default=ze,Object.defineProperty(ze,"minimumBytes",{value:qe.minimumBytes}),imageType$1.exports}var imageTypeExports=requireImageType();const imageType=getDefaultExportFromCjs(imageTypeExports);function guessStripByteCounts(qe){if(qe.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");const f=qe.rowsPerStrip*qe.width*qe.samplesPerPixel*(qe.bitsPerSample/8);return new Array(qe.stripOffsets.length).fill(f)}function applyHorizontalDifferencing8Bit(qe,f,ze){let Ke=0;for(;Ke<qe.length;){for(let Qe=ze;Qe<f*ze;Qe+=ze)for(let Pi=0;Pi<ze;Pi++)qe[Ke+Qe+Pi]=qe[Ke+Qe+Pi]+qe[Ke+Qe-(ze-Pi)]&255;Ke+=f*ze}}function applyHorizontalDifferencing16Bit(qe,f,ze){let Ke=0;for(;Ke<qe.length;){for(let Qe=ze;Qe<f*ze;Qe+=ze)for(let Pi=0;Pi<ze;Pi++)qe[Ke+Qe+Pi]=qe[Ke+Qe+Pi]+qe[Ke+Qe-(ze-Pi)]&65535;Ke+=f*ze}}const tagsById$2={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$2={};for(let qe in tagsById$2)tagsByName$2[tagsById$2[qe]]=Number(qe);const exif=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$2,tagsByName:tagsByName$2},Symbol.toStringTag,{value:"Module"})),tagsById$1={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$1={};for(let qe in tagsById$1)tagsByName$1[tagsById$1[qe]]=Number(qe);const gps=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$1,tagsByName:tagsByName$1},Symbol.toStringTag,{value:"Module"})),tagsById={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName={};for(let qe in tagsById)tagsByName[tagsById[qe]]=Number(qe);const standard=Object.freeze(Object.defineProperty({__proto__:null,tagsById,tagsByName},Symbol.toStringTag,{value:"Module"})),tags={standard,exif,gps};class IFD{constructor(f){if(!f)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=f,this._hasMap=!1,this._map={}}get(f){if(typeof f=="number")return this.fields.get(f);if(typeof f=="string")return this.fields.get(tags[this.kind].tagsByName[f]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const f=tags[this.kind].tagsById;for(let ze of this.fields.keys())f[ze]&&(this._map[f[ze]]=this.fields.get(ze));this._hasMap=!0}return this._map}}let types=new Map([[1,[1,readByte]],[2,[1,readASCII]],[3,[2,readShort]],[4,[4,readLong]],[5,[8,readRational]],[6,[1,readSByte]],[7,[1,readByte]],[8,[2,readSShort]],[9,[4,readSLong]],[10,[8,readSRational]],[11,[4,readFloat]],[12,[8,readDouble]]]);function getByteLength(qe,f){const ze=types.get(qe);if(!ze)throw new Error(`type not found: ${qe}`);return ze[0]*f}function readData(qe,f,ze){const Ke=types.get(f);if(!Ke)throw new Error(`type not found: ${f}`);return Ke[1](qe,ze)}function readByte(qe,f){if(f===1)return qe.readUint8();let ze=new Uint8Array(f);for(let Ke=0;Ke<f;Ke++)ze[Ke]=qe.readUint8();return ze}function readASCII(qe,f){let ze=[],Ke="";for(let Qe=0;Qe<f;Qe++){let Pi=String.fromCharCode(qe.readUint8());Pi==="\0"?(ze.push(Ke),Ke=""):Ke+=Pi}return ze.length===1?ze[0]:ze}function readShort(qe,f){if(f===1)return qe.readUint16();let ze=new Uint16Array(f);for(let Ke=0;Ke<f;Ke++)ze[Ke]=qe.readUint16();return ze}function readLong(qe,f){if(f===1)return qe.readUint32();let ze=new Uint32Array(f);for(let Ke=0;Ke<f;Ke++)ze[Ke]=qe.readUint32();return ze}function readRational(qe,f){if(f===1)return qe.readUint32()/qe.readUint32();let ze=new Array(f);for(let Ke=0;Ke<f;Ke++)ze[Ke]=qe.readUint32()/qe.readUint32();return ze}function readSByte(qe,f){if(f===1)return qe.readInt8();let ze=new Int8Array(f);for(let Ke=0;Ke<f;Ke++)ze[Ke]=qe.readInt8();return ze}function readSShort(qe,f){if(f===1)return qe.readInt16();let ze=new Int16Array(f);for(let Ke=0;Ke<f;Ke++)ze[Ke]=qe.readInt16();return ze}function readSLong(qe,f){if(f===1)return qe.readInt32();let ze=new Int32Array(f);for(let Ke=0;Ke<f;Ke++)ze[Ke]=qe.readInt32();return ze}function readSRational(qe,f){if(f===1)return qe.readInt32()/qe.readInt32();let ze=new Array(f);for(let Ke=0;Ke<f;Ke++)ze[Ke]=qe.readInt32()/qe.readInt32();return ze}function readFloat(qe,f){if(f===1)return qe.readFloat32();let ze=new Float32Array(f);for(let Ke=0;Ke<f;Ke++)ze[Ke]=qe.readFloat32();return ze}function readDouble(qe,f){if(f===1)return qe.readFloat64();let ze=new Float64Array(f);for(let Ke=0;Ke<f;Ke++)ze[Ke]=qe.readFloat64();return ze}const CLEAR_CODE=256,EOI_CODE=257,TABLE_START=258,MIN_BIT_LENGTH=9;let stringTable=[];function initializeStringTable(){if(stringTable.length===0){for(let f=0;f<256;f++)stringTable.push([f]);const qe=[];for(let f=256;f<4096;f++)stringTable.push(qe)}}const andTable=[511,1023,2047,4095],bitJumps=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class LzwDecoder{constructor(f){this.nextData=0,this.nextBits=0,this.bytePointer=0,this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH,this.stripArray=new Uint8Array(f.buffer,f.byteOffset,f.byteLength),this.outData=new IOBuffer(f.byteLength),this.initializeTable()}decode(){let f=0,ze=0;for(;(f=this.getNextCode())!==EOI_CODE;)if(f===CLEAR_CODE){if(this.initializeTable(),f=this.getNextCode(),f===EOI_CODE)break;this.writeString(this.stringFromCode(f)),ze=f}else if(this.isInTable(f))this.writeString(this.stringFromCode(f)),this.addStringToTable(this.stringFromCode(ze).concat(this.stringFromCode(f)[0])),ze=f;else{const Qe=this.stringFromCode(ze).concat(this.stringFromCode(ze)[0]);this.writeString(Qe),this.addStringToTable(Qe),ze=f}const Ke=this.outData.toArray();return new DataView(Ke.buffer,Ke.byteOffset,Ke.byteLength)}initializeTable(){initializeStringTable(),this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH}writeString(f){this.outData.writeBytes(f)}stringFromCode(f){return stringTable[f]}isInTable(f){return f<this.tableLength}addStringToTable(f){if(stringTable[this.tableLength++]=f,stringTable.length>4096)throw stringTable=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===bitJumps[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);const f=this.nextData>>this.nextBits-this.currentBitLength&andTable[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:f}}function decompressLzw(qe){return new LzwDecoder(qe).decode()}const dateTimeRegex=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd extends IFD{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let f=new Date,ze=dateTimeRegex.exec(this.dateTime);if(ze===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return f.setFullYear(Number(ze[1]),Number(ze[2])-1,Number(ze[3])),f.setHours(Number(ze[4]),Number(ze[5]),Number(ze[6])),f}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const f=this.get("BitsPerSample");return f&&typeof f!="number"?f[0]:f}get alpha(){const f=this.extraSamples;return f?f[0]!==0:!1}get associatedAlpha(){const f=this.extraSamples;return f?f[0]===1:!1}get extraSamples(){return alwaysArray(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return alwaysArray(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")}get stripByteCounts(){return alwaysArray(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return this.get("SampleFormat")||1}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const f=2**this.bitsPerSample,ze=this.get("ColorMap");if(!ze)return;if(ze.length!==3*f)throw new Error(`ColorMap size must be ${f}`);const Ke=[];for(let Qe=0;Qe<f;Qe++)Ke.push([ze[Qe],ze[Qe+f],ze[Qe+2*f]]);return Ke}}function alwaysArray(qe){return typeof qe=="number"?[qe]:qe}function decompressZlib(qe){const f=new Uint8Array(qe.buffer,qe.byteOffset,qe.byteLength),ze=inflate_1(f);return new DataView(ze.buffer,ze.byteOffset,ze.byteLength)}const defaultOptions$3={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder extends IOBuffer{constructor(f){super(f),this._nextIFD=0}get isMultiPage(){let f=0;for(this.decodeHeader();this._nextIFD;)if(f++,this.decodeIFD({ignoreImageData:!0},!0),f===2)return!0;if(f===1)return!1;throw unsupported("ifdCount",f)}get pageCount(){let f=0;for(this.decodeHeader();this._nextIFD;)f++,this.decodeIFD({ignoreImageData:!0},!0);if(f>0)return f;throw unsupported("ifdCount",f)}decode(f={}){f=Object.assign({},defaultOptions$3,f);const ze=[];for(this.decodeHeader();this._nextIFD;)if(ze.push(this.decodeIFD(f,!0)),f.onlyFirst)return[ze[0]];return ze}decodeHeader(){const f=this.readUint16();if(f===18761)this.setLittleEndian();else if(f===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${f.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(f,ze){this.seek(this._nextIFD);let Ke;if(ze)Ke=new TiffIfd;else{if(!f.kind)throw new Error("kind is missing");Ke=new IFD(f.kind)}const Qe=this.readUint16();for(let Pi=0;Pi<Qe;Pi++)this.decodeIFDEntry(Ke);if(!f.ignoreImageData){if(!(Ke instanceof TiffIfd))throw new Error("must be a tiff ifd");this.decodeImageData(Ke)}return this._nextIFD=this.readUint32(),Ke}decodeIFDEntry(f){const ze=this.offset,Ke=this.readUint16(),Qe=this.readUint16(),Pi=this.readUint32();if(Qe<1||Qe>12){this.skip(4);return}getByteLength(Qe,Pi)>4&&this.seek(this.readUint32());const ln=readData(this,Qe,Pi);if(f.fields.set(Ke,ln),Ke===34665||Ke===34853){let cn=this.offset,hn="exif";Ke===34665?hn="exif":Ke===34853&&(hn="gps"),this._nextIFD=ln,f[hn]=this.decodeIFD({kind:hn,ignoreImageData:!0},!1),this.offset=cn}this.seek(ze),this.skip(12)}decodeImageData(f){const ze=f.orientation;if(ze&&ze!==1)throw unsupported("orientation",ze);switch(f.type){case 0:case 1:case 2:case 3:this.readStripData(f);break;default:throw unsupported("image type",f.type)}if(this.applyPredictor(f),this.convertAlpha(f),f.type===0){const Ke=f.bitsPerSample,Qe=Math.pow(2,Ke)-1;for(let Pi=0;Pi<f.data.length;Pi++)f.data[Pi]=Qe-f.data[Pi]}}readStripData(f){const ze=f.width,Ke=f.height,Qe=f.bitsPerSample,Pi=f.sampleFormat,nn=ze*Ke*f.samplesPerPixel,ln=getDataArray(nn,Qe,Pi),hn=f.rowsPerStrip*ze*f.samplesPerPixel,un=f.stripOffsets,xs=f.stripByteCounts||guessStripByteCounts(f);let zn=nn,Xn=0;for(let ys=0;ys<un.length;ys++){let Jo=new DataView(this.buffer,this.byteOffset+un[ys],xs[ys]),ea=zn>hn?hn:zn;zn-=ea;let ra=Jo;switch(f.compression){case 1:break;case 5:{ra=decompressLzw(Jo);break}case 8:{ra=decompressZlib(Jo);break}case 2:throw unsupported("Compression","CCITT Group 3");case 32773:throw unsupported("Compression","PackBits");default:throw unsupported("Compression",f.compression)}Xn=this.fillUncompressed(Qe,Pi,ln,ra,Xn,ea)}f.data=ln}fillUncompressed(f,ze,Ke,Qe,Pi,nn){if(f===8)return fill8bit(Ke,Qe,Pi,nn);if(f===16)return fill16bit(Ke,Qe,Pi,nn,this.isLittleEndian());if(f===32&&ze===3)return fillFloat32(Ke,Qe,Pi,nn,this.isLittleEndian());throw unsupported("bitDepth",f)}applyPredictor(f){const ze=f.bitsPerSample;switch(f.predictor){case 1:break;case 2:{if(ze===8)applyHorizontalDifferencing8Bit(f.data,f.width,f.components);else if(ze===16)applyHorizontalDifferencing16Bit(f.data,f.width,f.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${ze}`);break}default:throw new Error(`invalid predictor: ${f.predictor}`)}}convertAlpha(f){if(f.alpha&&f.associatedAlpha){const{data:ze,components:Ke,maxSampleValue:Qe}=f;for(let Pi=0;Pi<ze.length;Pi+=Ke){const nn=ze[Pi+Ke-1];for(let ln=0;ln<Ke-1;ln++)ze[Pi+ln]=Math.round(ze[Pi+ln]*Qe/nn)}}}}function getDataArray(qe,f,ze){if(f===8)return new Uint8Array(qe);if(f===16)return new Uint16Array(qe);if(f===32&&ze===3)return new Float32Array(qe);throw unsupported("bit depth / sample format",`${f} / ${ze}`)}function fill8bit(qe,f,ze,Ke){for(let Qe=0;Qe<Ke;Qe++)qe[ze++]=f.getUint8(Qe);return ze}function fill16bit(qe,f,ze,Ke,Qe){for(let Pi=0;Pi<Ke*2;Pi+=2)qe[ze++]=f.getUint16(Pi,Qe);return ze}function fillFloat32(qe,f,ze,Ke,Qe){for(let Pi=0;Pi<Ke*4;Pi+=4)qe[ze++]=f.getFloat32(Pi,Qe);return ze}function unsupported(qe,f){return new Error(`Unsupported ${qe}: ${f}`)}function decodeTIFF(qe,f){return new TIFFDecoder(qe).decode(f)}function matchAndCrop(qe={}){let{algorithm:f="matchToPrevious",ignoreBorder:ze=[0,0]}=qe;this.checkProcessable("matchAndCrop",{bitDepth:[8,16]});let Ke=f==="matchToPrevious",Qe=this[0],Pi=[];Pi[0]={position:[0,0],image:this[0]};let nn=[0,0];for(let zn=1;zn<this.length;zn++){let Xn=Qe.getBestMatch(this[zn],{border:ze});Pi[zn]={position:[Xn[0]+nn[0],Xn[1]+nn[1]],image:this[zn]},Ke&&(nn[0]+=Xn[0],nn[1]+=Xn[1],Qe=this[zn])}let ln=0,cn=0,hn=0,un=0;for(let zn=0;zn<Pi.length;zn++){let Xn=Pi[zn];Xn.position[0]>ln&&(ln=Xn.position[0]),Xn.position[0]<cn&&(cn=Xn.position[0]),Xn.position[1]>hn&&(hn=Xn.position[1]),Xn.position[1]<un&&(un=Xn.position[1])}cn=0-cn,un=0-un;for(let zn=0;zn<Pi.length;zn++){let Xn=Pi[zn];Xn.crop=Xn.image.crop({x:ln-Xn.position[0],y:hn-Xn.position[1],width:Qe.width-cn-ln,height:Qe.height-un-hn})}let xs=[];for(let zn=0;zn<Pi.length;zn++)xs[zn]=Pi[zn].crop;return new Stack(xs)}function min$2(){this.checkProcessable("min",{bitDepth:[8,16]});let qe=this[0].min;for(let f=1;f<this.length;f++)for(let ze=0;ze<qe.length;ze++)qe[ze]=Math.min(qe[ze],this[f].min[ze]);return qe}function max$2(){this.checkProcessable("min",{bitDepth:[8,16]});let qe=this[0].max;for(let f=1;f<this.length;f++)for(let ze=0;ze<qe.length;ze++)qe[ze]=Math.max(qe[ze],this[f].max[ze]);return qe}function median$2(qe){let f=qe.reduce((nn,ln)=>nn+ln);if(f===0)throw new Error("unreachable");let ze=0,Ke=0,Qe=f/2,Pi;for(;;){if(qe[ze]>0){if(Pi!==void 0)return(Pi+ze)/2;if(Ke+=qe[ze],Ke>Qe)return ze;Ke===Qe&&(Pi=ze)}ze++}}function mean$2(qe){let f=0,ze=0;for(let Ke=0;Ke<qe.length;Ke++)f+=qe[Ke],ze+=qe[Ke]*Ke;return f===0?0:ze/f}function median$1(){this.checkProcessable("median",{bitDepth:[8,16]});let qe=this.getHistograms({maxSlots:this[0].maxValue+1}),f=new Array(qe.length);for(let ze=0;ze<qe.length;ze++){let Ke=qe[ze];f[ze]=median$2(Ke)}return f}function histogram(qe){this.checkProcessable("min",{bitDepth:[8,16]});let f=this[0].getHistogram(qe);for(let ze=1;ze<this.length;ze++){let Ke=this[ze].getHistogram(qe);for(let Qe=0;Qe<f.length;Qe++)f[Qe]+=Ke[Qe]}return f}function histograms(qe){this.checkProcessable("min",{bitDepth:[8,16]});let f=this[0].getHistograms(qe),ze=f[0].length;for(let Ke=1;Ke<this.length;Ke++){let Qe=this[Ke].getHistograms(qe);for(let Pi=0;Pi<f.length;Pi++)for(let nn=0;nn<ze;nn++)f[Pi][nn]+=Qe[Pi][nn]}return f}function averageImage(){this.checkProcessable("averageImage",{bitDepth:[8,16]});let qe=new Uint32Array(this[0].data.length);for(let Ke=0;Ke<this.length;Ke++){let Qe=this[Ke];for(let Pi=0;Pi<this[0].data.length;Pi++)qe[Pi]+=Qe.data[Pi]}let f=Image$1.createFrom(this[0]),ze=f.data;for(let Ke=0;Ke<this[0].data.length;Ke++)ze[Ke]=qe[Ke]/this.length;return f}function maxImage(){this.checkProcessable("max",{bitDepth:[8,16]});let qe=Image$1.createFrom(this[0]);qe.data.fill(0);for(const f of this)for(let ze=0;ze<qe.data.length;ze++)qe.data[ze]=Math.max(f.data[ze],qe.data[ze]);return qe}function minImage(){this.checkProcessable("max",{bitDepth:[8,16]});let qe=Image$1.createFrom(this[0]);qe.data.fill(qe.maxValue);for(const f of this)for(let ze=0;ze<qe.data.length;ze++)qe.data[ze]=Math.min(f.data[ze],qe.data[ze]);return qe}function extend$2(qe){qe.extendMethod("matchAndCrop",matchAndCrop),qe.extendMethod("getMin",min$2),qe.extendMethod("getMax",max$2),qe.extendMethod("getMedian",median$1),qe.extendMethod("getHistogram",histogram),qe.extendMethod("getHistograms",histograms),qe.extendMethod("getAverage",averageImage),qe.extendMethod("getAverageImage",averageImage),qe.extendMethod("getMaxImage",maxImage),qe.extendMethod("getMinImage",minImage)}let computedPropertyDescriptor={configurable:!0,enumerable:!1,get:void 0};class Stack extends Array{constructor(f){if(Array.isArray(f)){super(f.length);for(let ze=0;ze<f.length;ze++)this[ze]=f[ze]}else typeof f=="number"?super(f):super();this.computed=null}static load(f){return Promise.all(f.map(Image$1.load)).then(ze=>new Stack(ze))}static extendMethod(f,ze,Ke={}){let{inPlace:Qe=!1,returnThis:Pi=!0,partialArgs:nn=[]}=Ke;return Qe?Stack.prototype[f]=function(...ln){this.computed=null;let cn=ze.apply(this,[...nn,...ln]);return Pi?this:cn}:Stack.prototype[f]=function(...ln){return ze.apply(this,[...nn,...ln])},Stack}static extendProperty(f,ze,Ke={}){let{partialArgs:Qe=[]}=Ke;return computedPropertyDescriptor.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(f,this.computed))return this.computed[f];let Pi=ze.apply(this,Qe);return this.computed[f]=Pi,Pi},Object.defineProperty(Stack.prototype,f,computedPropertyDescriptor),Stack}checkProcessable(f,ze={}){if(typeof f!="string")throw new TypeError("checkProcessable requires as first parameter the processName (a string)");if(this.size===0)throw new TypeError(`The process: ${f} can not be applied on an empty stack`);this[0].checkProcessable(f,ze);for(let Ke=1;Ke<this.length;Ke++){if((ze.sameSize===void 0||ze.sameSize)&&this[0].width!==this[Ke].width)throw new TypeError(`The process: ${f} can not be applied if width is not identical in all images`);if((ze.sameSize===void 0||ze.sameSize)&&this[0].height!==this[Ke].height)throw new TypeError(`The process: ${f} can not be applied if height is not identical in all images`);if((ze.sameAlpha===void 0||ze.sameAlpha)&&this[0].alpha!==this[Ke].alpha)throw new TypeError(`The process: ${f} can not be applied if alpha is not identical in all images`);if((ze.sameBitDepth===void 0||ze.sameBitDepth)&&this[0].bitDepth!==this[Ke].bitDepth)throw new TypeError(`The process: ${f} can not be applied if bitDepth is not identical in all images`);if((ze.sameColorModel===void 0||ze.sameColorModel)&&this[0].colorModel!==this[Ke].colorModel)throw new TypeError(`The process: ${f} can not be applied if colorModel is not identical in all images`);if((ze.sameNumberChannels===void 0||ze.sameNumberChannels)&&this[0].channels!==this[Ke].channels)throw new TypeError(`The process: ${f} can not be applied if channels is not identical in all images`)}}}Array[Symbol.species]||(Stack.prototype.map=function(qe,f){if(typeof qe!="function")throw new TypeError(`${qe} is not a function`);let ze=new Stack(this.length);for(let Ke=0;Ke<this.length;Ke++)ze[Ke]=qe.call(f,this[Ke],Ke,this);return ze});extend$2(Stack);const isDataURL=/^data:[a-z]+\/(?:[a-z]+);base64,/;function load(qe,f){if(typeof qe=="string")return loadURL(qe,f);if(qe instanceof ArrayBuffer)return Promise.resolve(loadBinary(new Uint8Array(qe),void 0,f&&f.ignorePalette));if(qe.buffer)return Promise.resolve(loadBinary(qe,void 0,f&&f.ignorePalette));throw new Error('argument to "load" must be a string or buffer.')}function loadBinary(qe,f,ze){const Ke=imageType(qe);if(Ke)switch(Ke.mime){case"image/png":return loadPNG(qe);case"image/jpeg":return loadJPEG(qe);case"image/tiff":return loadTIFF(qe,ze);default:return loadGeneric(Qe(Ke.mime))}return loadGeneric(Qe("application/octet-stream"));function Qe(Pi){return f||toBase64URL(qe,Pi)}}function loadURL(qe,f){const ze=qe.slice(0,64).match(isDataURL);let Ke;return ze!==null?Ke=Promise.resolve(decode$1(qe.slice(ze[0].length))):Ke=fetchBinary(qe,f),Ke.then(Qe=>{const Pi=new Uint8Array(Qe);return loadBinary(Pi,ze?qe:void 0,f&&f.ignorePalette)})}function loadPNG(qe){const f=decodePng(qe);let ze=f.channels,Ke,Qe=0;return ze===2||ze===4?(Ke=ze-1,Qe=1):Ke=ze,f.palette?loadPNGFromPalette(f):new Image$1(f.width,f.height,f.data,{components:Ke,alpha:Qe,bitDepth:f.depth,meta:{text:f.text}})}function loadPNGFromPalette(qe){const f=qe.width*qe.height,ze=qe.palette[0].length,Ke=new Uint8Array(f*ze),Qe=8/qe.depth,Pi=qe.depth<8?Qe:1,nn=parseInt("1".repeat(qe.depth),2),ln=ze===4;let cn=0;for(let hn=0;hn<f;hn++){const un=Math.floor(hn/Pi);let xs=qe.data[un];qe.depth<8&&(xs=xs>>>qe.depth*(Qe-1-hn%Qe)&nn);const zn=qe.palette[xs];Ke[cn++]=zn[0],Ke[cn++]=zn[1],Ke[cn++]=zn[2],ln&&(Ke[cn++]=zn[3])}return new Image$1(qe.width,qe.height,Ke,{components:3,alpha:ln,bitDepth:8})}function loadJPEG(qe){const f=srcExports$2.decode(qe);let ze;f.exif&&(ze=getMetadata(f.exif));const Ke=jpegJsExports.decode(qe,{useTArray:!0,maxMemoryUsageInMB:1024});let Qe=new Image$1(Ke.width,Ke.height,Ke.data,{meta:ze});if(ze&&ze.tiff.tags.Orientation){const Pi=ze.tiff.tags.Orientation;Pi>2&&(Qe=Qe.rotate({3:180,4:180,5:90,6:90,7:270,8:270}[Pi])),[2,4,5,7].includes(Pi)&&(Qe=Qe.flipX())}return Qe}function loadTIFF(qe,f){let ze=decodeTIFF(qe);return ze.length===1?getImageFromIFD(ze[0],f):new Stack(ze.map(function(Ke){return getImageFromIFD(Ke,f)}))}function getMetadata(qe){const f={tiff:{fields:qe.fields,tags:qe.map}};return qe.exif&&(f.exif=qe.exif),qe.gps&&(f.gps=qe.gps),f}function getImageFromIFD(qe,f){if(!f&&qe.type===3){const ze=new Uint16Array(3*qe.width*qe.height),Ke=qe.palette;let Qe=0;for(let Pi=0;Pi<qe.data.length;Pi++){const nn=qe.data[Pi],ln=Ke[nn];ze[Qe++]=ln[0],ze[Qe++]=ln[1],ze[Qe++]=ln[2]}return new Image$1(qe.width,qe.height,ze,{components:3,alpha:qe.alpha,colorModel:RGB$1,bitDepth:16,meta:getMetadata(qe)})}else return new Image$1(qe.width,qe.height,qe.data,{components:qe.type===2?3:1,alpha:qe.alpha,colorModel:qe.type===2?RGB$1:GREY$1,bitDepth:qe.bitsPerSample.length?qe.bitsPerSample[0]:qe.bitsPerSample,meta:getMetadata(qe)})}function loadGeneric(qe,f){return f=f||{},new Promise(function(ze,Ke){let Qe=new DOMImage;Qe.onload=function(){let Pi=Qe.width,nn=Qe.height,cn=createCanvas(Pi,nn).getContext("2d");cn.drawImage(Qe,0,0,Pi,nn);let hn=cn.getImageData(0,0,Pi,nn).data;ze(new Image$1(Pi,nn,hn,f))},Qe.onerror=function(){Ke(new Error(`Could not load ${qe}`))},Qe.src=qe})}const valueMethods={getValueXY(qe,f,ze){return this.data[(f*this.width+qe)*this.channels+ze]},setValueXY(qe,f,ze,Ke){return this.data[(f*this.width+qe)*this.channels+ze]=Ke,this.computed=null,this},getValue(qe,f){return this.data[qe*this.channels+f]},setValue(qe,f,ze){return this.data[qe*this.channels+f]=ze,this.computed=null,this},getPixelXY(qe,f){return this.getPixel(f*this.width+qe)},setPixelXY(qe,f,ze){return this.setPixel(f*this.width+qe,ze)},getPixel(qe){const f=new Array(this.channels),ze=qe*this.channels;for(let Ke=0;Ke<this.channels;Ke++)f[Ke]=this.data[ze+Ke];return f},setPixel(qe,f){const ze=qe*this.channels;for(let Ke=0;Ke<f.length;Ke++)this.data[ze+Ke]=f[Ke];return this.computed=null,this}};function setValueMethods(qe){for(const f in valueMethods)qe.prototype[f]=valueMethods[f]}function getImageParameters(qe){return{width:qe.width,height:qe.height,components:qe.components,alpha:qe.alpha,colorModel:qe.colorModel,bitDepth:qe.bitDepth}}function getOutputImage(qe,f,ze,Ke={}){const{out:Qe}=f;if(Qe===void 0)return Ke.copy?qe.clone():Image$1.createFrom(qe,ze);{if(!Image$1.isImage(Qe))throw new TypeError("out must be an Image object");const Pi=Object.assign(getImageParameters(qe),ze);for(const nn in Pi)if(Qe[nn]!==Pi[nn])throw new RangeError(`cannot use out. Its ${nn} must be "${Pi[nn]}" (found "${Qe[nn]}")`);return Qe}}function getOutputImageOrInPlace(qe,f,ze){if(f.inPlace!==void 0&&typeof f.inPlace!="boolean")throw new TypeError("inPlace option must be a boolean");if(f.inPlace){if(f.out!==void 0)throw new TypeError("out option must not be set if inPlace option is true");return qe}return getOutputImage(qe,f,null,ze)}function abs(qe={}){this.checkProcessable("abs",{bitDepth:[32]});const f=getOutputImageOrInPlace(this,qe);return absolute(this,f),f}function absolute(qe,f){for(let ze=0;ze<qe.data.length;ze++)f.data[ze]=Math.abs(qe.data[ze])}function copyAlphaChannel(qe,f){if(qe.alpha===1&&f.alpha===1)for(let ze=0;ze<qe.size;ze++)f.data[ze*f.channels+f.components]=qe.data[ze*qe.channels+qe.components]}function invert(qe={}){this.checkProcessable("invert",{bitDepth:[1,8,16]});const f=getOutputImageOrInPlace(this,qe);return this.bitDepth===1?invertBinary(this,f):(invertColor(this,f),this!==f&&copyAlphaChannel(this,f)),f}function invertBinary(qe,f){for(let ze=0;ze<qe.data.length;ze++)f.data[ze]=~qe.data[ze]}function invertColor(qe,f){for(let ze=0;ze<qe.data.length;ze+=qe.channels)for(let Ke=0;Ke<qe.components;Ke++)f.data[ze+Ke]=qe.maxValue-qe.data[ze+Ke]}function flipX(){this.checkProcessable("flipX",{bitDepth:[8,16]});for(let qe=0;qe<this.height;qe++){let f=qe*this.width*this.channels;for(let ze=0;ze<Math.floor(this.width/2);ze++){let Ke=ze*this.channels+f,Qe=(this.width-ze-1)*this.channels+f;for(let Pi=0;Pi<this.channels;Pi++){let nn=this.data[Ke+Pi];this.data[Ke+Pi]=this.data[Qe+Pi],this.data[Qe+Pi]=nn}}}return this}function flipY(){this.checkProcessable("flipY",{bitDepth:[8,16]});for(let qe=0;qe<Math.floor(this.height/2);qe++)for(let f=0;f<this.width;f++){let ze=f*this.channels+qe*this.width*this.channels,Ke=f*this.channels+(this.height-1-qe)*this.channels*this.width;for(let Qe=0;Qe<this.channels;Qe++){let Pi=this.data[ze+Qe];this.data[ze+Qe]=this.data[Ke+Qe],this.data[Ke+Qe]=Pi}}return this}function blurFilter(qe={}){const{radius:f=1}=qe;if(f<1)throw new Error("radius must be greater than 1");const ze=2*f+1,Ke=new Array(ze);for(let Qe=0;Qe<ze;Qe++){Ke[Qe]=new Array(ze);for(let Pi=0;Pi<ze;Pi++)Ke[Qe][Pi]=1/(ze*ze)}return this.convolution(Ke)}var medianQuickselect_min={exports:{}},hasRequiredMedianQuickselect_min;function requireMedianQuickselect_min(){return hasRequiredMedianQuickselect_min||(hasRequiredMedianQuickselect_min=1,function(qe){(function(){function f(Qe){for(var Pi=0,nn=Qe.length-1,ln=void 0,cn=void 0,hn=void 0,un=Ke(Pi,nn);;){if(nn<=Pi)return Qe[un];if(nn==Pi+1)return Qe[Pi]>Qe[nn]&&ze(Qe,Pi,nn),Qe[un];for(ln=Ke(Pi,nn),Qe[ln]>Qe[nn]&&ze(Qe,ln,nn),Qe[Pi]>Qe[nn]&&ze(Qe,Pi,nn),Qe[ln]>Qe[Pi]&&ze(Qe,ln,Pi),ze(Qe,ln,Pi+1),cn=Pi+1,hn=nn;;){do cn++;while(Qe[Pi]>Qe[cn]);do hn--;while(Qe[hn]>Qe[Pi]);if(hn<cn)break;ze(Qe,cn,hn)}ze(Qe,Pi,hn),hn<=un&&(Pi=cn),hn>=un&&(nn=hn-1)}}var ze=function(Pi,nn,ln){var cn;return cn=[Pi[ln],Pi[nn]],Pi[nn]=cn[0],Pi[ln]=cn[1],cn},Ke=function(Pi,nn){return~~((Pi+nn)/2)};qe.exports?qe.exports=f:window.median=f})()}(medianQuickselect_min)),medianQuickselect_min.exports}var medianQuickselect_minExports=requireMedianQuickselect_min();const quickSelectMedian=getDefaultExportFromCjs(medianQuickselect_minExports);function validateArrayOfChannels(qe,f={}){let{channels:ze,allowAlpha:Ke,defaultAlpha:Qe}=f;return typeof Ke!="boolean"&&(Ke=!0),typeof ze>"u"?allChannels(qe,Qe):validateChannels(qe,ze,Ke)}function allChannels(qe,f){let ze=f?qe.channels:qe.components,Ke=new Array(ze);for(let Qe=0;Qe<ze;Qe++)Ke[Qe]=Qe;return Ke}function validateChannels(qe,f,ze){Array.isArray(f)||(f=[f]);for(let Ke=0;Ke<f.length;Ke++)f[Ke]=validateChannel(qe,f[Ke],ze);return f}function validateChannel(qe,f,ze=!0){if(f===void 0)throw new RangeError(`validateChannel : the channel has to be >=0 and <${qe.channels}`);if(typeof f=="string"){switch(qe.colorModel){case GREY$1:break;case RGB$1:if("rgb".includes(f))switch(f){case"r":f=0;break;case"g":f=1;break;case"b":f=2;break}break;case HSL:if("hsl".includes(f))switch(f){case"h":f=0;break;case"s":f=1;break;case"l":f=2;break}break;case HSV:if("hsv".includes(f))switch(f){case"h":f=0;break;case"s":f=1;break;case"v":f=2;break}break;case CMYK$1:if("cmyk".includes(f))switch(f){case"c":f=0;break;case"m":f=1;break;case"y":f=2;break;case"k":f=3;break}break;default:throw new Error(`Unexpected color model: ${qe.colorModel}`)}if(f==="a"){if(!qe.alpha)throw new Error("validateChannel : the image does not contain alpha channel");f=qe.components}if(typeof f=="string")throw new Error(`validateChannel : undefined channel: ${f}`)}if(f>=qe.channels)throw new RangeError(`validateChannel : the channel has to be >=0 and <${qe.channels}`);if(!ze&&f>=qe.components)throw new RangeError("validateChannel : alpha channel may not be selected");return f}function medianFilter(qe={}){let{radius:f=1,border:ze="copy",channels:Ke}=qe;if(this.checkProcessable("medianFilter",{bitDepth:[8,16]}),f<1)throw new Error("radius must be greater than 0");Ke=validateArrayOfChannels(this,Ke);let Qe=f,Pi=f,nn=Image$1.createFrom(this),ln=(Qe*2+1)*(Pi*2+1),cn=new Array(ln);for(let hn=0;hn<Ke.length;hn++){let un=Ke[hn];for(let xs=Pi;xs<this.height-Pi;xs++)for(let zn=Qe;zn<this.width-Qe;zn++){let Xn=0;for(let Jo=-Pi;Jo<=Pi;Jo++)for(let ea=-Qe;ea<=Qe;ea++){let ra=((xs+Jo)*this.width+zn+ea)*this.channels+un;cn[Xn++]=this.data[ra]}let ys=(xs*this.width+zn)*this.channels+un;nn.data[ys]=quickSelectMedian(cn)}}if(this.alpha&&!Ke.includes(this.channels))for(let hn=this.components;hn<this.data.length;hn=hn+this.channels)nn.data[hn]=this.data[hn];return nn.setBorder({size:[Qe,Pi],algorithm:ze}),nn}function gaussianFilter(qe={}){let{radius:f=1,sigma:ze,channels:Ke,border:Qe="copy"}=qe;this.checkProcessable("gaussian",{bitDepth:[8,16]});const Pi=getKernel(f,ze);return this.convolution([Pi,Pi],{border:Qe,channels:Ke,algorithm:"separable"})}function getKernel(qe,f){const ze=qe*2+1,Ke=new Array(ze),Qe=f||((ze-1)*.5-1)*.3+.8,Pi=-.5/(Qe*Qe);let nn=0;for(let ln=0;ln<ze;ln++){const cn=ln-qe,hn=Math.exp(Pi*cn*cn);Ke[ln]=hn,nn+=hn}for(let ln=0;ln<ze;ln++)Ke[ln]/=nn;return Ke}const SOBEL_X=[[-1,0,1],[-2,0,2],[-1,0,1]],SOBEL_Y=[[-1,-2,-1],[0,0,0],[1,2,1]],SCHARR_X=[[3,0,-3],[10,0,-10],[3,0,-3]],SCHARR_Y=[[3,10,3],[0,0,0],[-3,-10,-3]];var src$2={},fftlib={},hasRequiredFftlib;function requireFftlib(){return hasRequiredFftlib||(hasRequiredFftlib=1,function(qe){(function(){var f;f=qe;var ze={release:"0.3.0",date:"2013-03"};f.toString=function(){return"version "+ze.release+", released "+ze.date};for(var Ke=0,Qe=null,Pi=null,nn={init:function(hn){if(hn!==0&&(hn&hn-1)===0)Ke=hn,nn._initArray(),nn._makeBitReversalTable(),nn._makeCosSinTable();else throw new Error("init: radix-2 required")},fft1d:function(hn,un){nn.fft(hn,un,1)},ifft1d:function(hn,un){var xs=1/Ke;nn.fft(hn,un,-1);for(var zn=0;zn<Ke;zn++)hn[zn]*=xs,un[zn]*=xs},bt1d:function(hn,un){nn.fft(hn,un,-1)},fft2d:function(hn,un){for(var xs=[],zn=[],Xn=0,ys=0;ys<Ke;ys++){Xn=ys*Ke;for(var Jo=0;Jo<Ke;Jo++)xs[Jo]=hn[Jo+Xn],zn[Jo]=un[Jo+Xn];nn.fft1d(xs,zn);for(var ea=0;ea<Ke;ea++)hn[ea+Xn]=xs[ea],un[ea+Xn]=zn[ea]}for(var ra=0;ra<Ke;ra++){for(var na=0;na<Ke;na++)Xn=ra+na*Ke,xs[na]=hn[Xn],zn[na]=un[Xn];nn.fft1d(xs,zn);for(var ta=0;ta<Ke;ta++)Xn=ra+ta*Ke,hn[Xn]=xs[ta],un[Xn]=zn[ta]}},ifft2d:function(hn,un){for(var xs=[],zn=[],Xn=0,ys=0;ys<Ke;ys++){Xn=ys*Ke;for(var Jo=0;Jo<Ke;Jo++)xs[Jo]=hn[Jo+Xn],zn[Jo]=un[Jo+Xn];nn.ifft1d(xs,zn);for(var ea=0;ea<Ke;ea++)hn[ea+Xn]=xs[ea],un[ea+Xn]=zn[ea]}for(var ra=0;ra<Ke;ra++){for(var na=0;na<Ke;na++)Xn=ra+na*Ke,xs[na]=hn[Xn],zn[na]=un[Xn];nn.ifft1d(xs,zn);for(var ta=0;ta<Ke;ta++)Xn=ra+ta*Ke,hn[Xn]=xs[ta],un[Xn]=zn[ta]}},fft:function(hn,un,xs){for(var zn,Xn,ys,Jo,ea,ra,na,ta,ia,sa=Ke>>2,Ma=0;Ma<Ke;Ma++)Jo=Qe[Ma],Ma<Jo&&(ea=hn[Ma],hn[Ma]=hn[Jo],hn[Jo]=ea,ea=un[Ma],un[Ma]=un[Jo],un[Jo]=ea);for(var pa=1;pa<Ke;pa<<=1){Xn=0,zn=Ke/(pa<<1);for(var oa=0;oa<pa;oa++){ra=Pi[Xn+sa],na=xs*Pi[Xn];for(var ha=oa;ha<Ke;ha+=pa<<1)ys=ha+pa,ta=ra*hn[ys]+na*un[ys],ia=ra*un[ys]-na*hn[ys],hn[ys]=hn[ha]-ta,hn[ha]+=ta,un[ys]=un[ha]-ia,un[ha]+=ia;Xn+=zn}}},_initArray:function(){typeof Uint32Array<"u"?Qe=new Uint32Array(Ke):Qe=[],typeof Float64Array<"u"?Pi=new Float64Array(Ke*1.25):Pi=[]},_paddingZero:function(){},_makeBitReversalTable:function(){var hn=0,un=0,xs=0;for(Qe[0]=0;++hn<Ke;){for(xs=Ke>>1;xs<=un;)un-=xs,xs>>=1;un+=xs,Qe[hn]=un}},_makeCosSinTable:function(){var hn=Ke>>1,un=Ke>>2,xs=Ke>>3,zn=hn+un,Xn=Math.sin(Math.PI/Ke),ys=2*Xn*Xn,Jo=Math.sqrt(ys*(2-ys)),ea=Pi[un]=1,ra=Pi[0]=0;Xn=2*ys;for(var na=1;na<xs;na++)ea-=ys,ys+=Xn*ea,ra+=Jo,Jo-=Xn*ra,Pi[na]=ra,Pi[un-na]=ea;xs!==0&&(Pi[xs]=Math.sqrt(.5));for(var ta=0;ta<un;ta++)Pi[hn-ta]=Pi[ta];for(var ia=0;ia<zn;ia++)Pi[ia+hn]=-Pi[ia]}},ln=["init","fft1d","ifft1d","fft2d","ifft2d"],cn=0;cn<ln.length;cn++)f[ln[cn]]=nn[ln[cn]];return f.bt=nn.bt1d,f.fft=nn.fft1d,f.ifft=nn.ifft1d,f}).call(fftlib)}(fftlib)),fftlib}var FFTUtils_1,hasRequiredFFTUtils;function requireFFTUtils(){if(hasRequiredFFTUtils)return FFTUtils_1;hasRequiredFFTUtils=1;var qe=requireFftlib(),f={DEBUG:!1,ifft2DArray:function(ze,Ke,Qe){var Pi=new Array(Ke*Qe),nn=Ke/2,ln=(Qe-1)*2;qe.init(nn);for(var cn={re:new Array(nn),im:new Array(nn)},hn=0;hn<Qe;hn++){for(var un=nn-1;un>=0;un--)cn.re[un]=ze[un*2*Qe+hn],cn.im[un]=ze[(un*2+1)*Qe+hn];qe.bt(cn.re,cn.im);for(var un=nn-1;un>=0;un--)Pi[un*2*Qe+hn]=cn.re[un],Pi[(un*2+1)*Qe+hn]=cn.im[un]}var xs=new Array(nn*ln);qe.init(ln);for(var zn={re:new Array(ln),im:new Array(ln)},Xn=ln*nn,un=0;un<Ke;un+=2){zn.re[0]=Pi[un*Qe],zn.im[0]=Pi[(un+1)*Qe];for(var hn=1;hn<Qe;hn++)zn.re[hn]=Pi[un*Qe+hn],zn.im[hn]=Pi[(un+1)*Qe+hn],zn.re[ln-hn]=Pi[un*Qe+hn],zn.im[ln-hn]=-Pi[(un+1)*Qe+hn];qe.bt(zn.re,zn.im);for(var ys=un/2*ln,hn=ln-1;hn>=0;hn--)xs[ys+hn]=zn.re[hn]/Xn}return xs},fft2DArray:function(ze,Ke,Qe,Pi){Object.assign({},{inplace:!0});var nn=Qe/2+1,ln=Ke*2,cn=new Array(ln*nn);qe.init(Qe);for(var hn={re:new Array(Qe),im:new Array(Qe)},un={re:new Array(Qe),im:new Array(Qe)},xs={re:new Array(Qe),im:new Array(Qe)},zn,Xn,ys,Jo,ea,ra=0;ra<Ke/2;ra++){zn=ra*2*Qe,hn.re=ze.slice(zn,zn+Qe),zn=(ra*2+1)*Qe,hn.im=ze.slice(zn,zn+Qe),qe.fft1d(hn.re,hn.im),this.reconstructTwoRealFFT(hn,un,xs),Xn=ra*4*nn,ys=(ra*4+1)*nn,Jo=(ra*4+2)*nn,ea=(ra*4+3)*nn;for(var na=nn-1;na>=0;na--)cn[Xn+na]=un.re[na],cn[ys+na]=un.im[na],cn[Jo+na]=xs.re[na],cn[ea+na]=xs.im[na]}un=null,xs=null;var ta=new Array(ln*nn);qe.init(Ke);for(var ia={re:new Array(Ke),im:new Array(Ke)},sa=nn-1;sa>=0;sa--){for(var ra=Ke-1;ra>=0;ra--)ia.re[ra]=cn[ra*2*nn+sa],ia.im[ra]=cn[(ra*2+1)*nn+sa],isNaN(ia.re[ra])&&(ia.re[ra]=0),isNaN(ia.im[ra])&&(ia.im[ra]=0);qe.fft1d(ia.re,ia.im);for(var ra=Ke-1;ra>=0;ra--)ta[ra*2*nn+sa]=ia.re[ra],ta[(ra*2+1)*nn+sa]=ia.im[ra]}return ta},reconstructTwoRealFFT:function(ze,Ke,Qe){var Pi=ze.re.length;Ke.re[0]=ze.re[0],Ke.im[0]=0,Qe.re[0]=ze.im[0],Qe.im[0]=0;for(var nn,ln,cn,hn,un,xs=Pi/2;xs>0;xs--)un=Pi-xs,nn=.5*(ze.re[xs]-ze.re[un]),ln=.5*(ze.re[xs]+ze.re[un]),cn=.5*(ze.im[xs]-ze.im[un]),hn=.5*(ze.im[xs]+ze.im[un]),Ke.re[xs]=ln,Ke.im[xs]=cn,Ke.re[un]=ln,Ke.im[un]=-cn,Qe.re[xs]=hn,Qe.im[xs]=-nn,Qe.re[un]=hn,Qe.im[un]=nn},convolute2DI:function(ze,Ke,Qe,Pi){for(var nn,ln,cn=0;cn<Qe/2;cn++)for(var hn=0;hn<Pi;hn++)nn=ze[cn*2*Pi+hn]*Ke[cn*2*Pi+hn]-ze[(cn*2+1)*Pi+hn]*Ke[(cn*2+1)*Pi+hn],ln=ze[cn*2*Pi+hn]*Ke[(cn*2+1)*Pi+hn]+ze[(cn*2+1)*Pi+hn]*Ke[cn*2*Pi+hn],ze[cn*2*Pi+hn]=nn,ze[(cn*2+1)*Pi+hn]=ln},convolute:function(ze,Ke,Qe,Pi,nn){for(var ln=new Array(Pi*Qe),cn=0;cn<Qe*Pi;cn++)ln[cn]=ze[cn];ln=this.fft2DArray(ln,Qe,Pi);for(var hn=Ke.length,un=Ke[0].length,xs=new Array(Pi*Qe),cn=0;cn<Pi*Qe;cn++)xs[cn]=0;for(var zn,Xn,ys=Math.floor((hn-1)/2),Jo=Math.floor((un-1)/2),ea=0;ea<hn;ea++){zn=(ea-ys+Qe)%Qe;for(var ra=0;ra<un;ra++)Xn=(ra-Jo+Pi)%Pi,xs[zn*Pi+Xn]=Ke[ea][ra]}xs=this.fft2DArray(xs,Qe,Pi);var na=Qe*2,ta=Pi/2+1;return this.convolute2DI(ln,xs,na,ta),this.ifft2DArray(ln,na,ta)},toRadix2:function(ze,Ke,Qe){var Pi,nn,ln,cn,hn=Qe,un=Ke;if(!(Qe!==0&&(Qe&Qe-1)===0)){for(hn=0;Qe>>++hn!=0;);hn=1<<hn}if(!(Ke!==0&&(Ke&Ke-1)===0)){for(un=0;Ke>>++un!=0;);un=1<<un}if(un==Ke&&hn==Qe)return{data:ze,rows:Ke,cols:Qe};var xs=new Array(un*hn),zn=Math.floor((un-Ke)/2)-Ke,Xn=Math.floor((hn-Qe)/2)-Qe;for(Pi=0;Pi<un;Pi++)for(ln=Pi*hn,cn=(Pi-zn)%Ke*Qe,nn=0;nn<hn;nn++)xs[ln+nn]=ze[cn+(nn-Xn)%Qe];return{data:xs,rows:un,cols:hn}},crop:function(ze,Ke,Qe,Pi,nn,ln){if(Ke==Pi&&Qe==nn)return ze;Object.assign({},ln);var cn=new Array(nn*Pi),hn=Math.floor((Ke-Pi)/2),un=Math.floor((Qe-nn)/2),xs,zn,Xn,ys;for(Xn=0;Xn<Pi;Xn++)for(xs=Xn*nn,zn=(Xn+hn)*Qe,ys=0;ys<nn;ys++)cn[xs+ys]=ze[zn+(ys+un)];return cn}};return FFTUtils_1=f,FFTUtils_1}var hasRequiredSrc$2;function requireSrc$2(){return hasRequiredSrc$2||(hasRequiredSrc$2=1,src$2.FFTUtils=requireFFTUtils(),src$2.FFT=requireFftlib()),src$2}var src$1,hasRequiredSrc$1;function requireSrc$1(){if(hasRequiredSrc$1)return src$1;hasRequiredSrc$1=1;var qe=requireSrc$2().FFTUtils;function f(Pi,nn,ln){var cn=Qe(Pi),hn=cn.data,un=Object.assign({normalize:!1,divisor:1,rows:cn.rows,cols:cn.cols},ln),xs,zn;if(un.rows&&un.cols)xs=un.rows,zn=un.cols;else throw new Error("Invalid number of rows or columns "+xs+" "+zn);var Xn=un.divisor,ys,Jo,ea=nn.length,ra=nn[0].length;if(un.normalize)for(Xn=0,ys=0;ys<ea;ys++)for(Jo=0;Jo<ra;Jo++)Xn+=nn[ys][Jo];if(Xn===0)throw new RangeError("convolution: The divisor is equal to zero");var na=qe.toRadix2(hn,xs,zn),ta=qe.convolute(na.data,nn,na.rows,na.cols);if(ta=qe.crop(ta,na.rows,na.cols,xs,zn),Xn!=0&&Xn!=1)for(ys=0;ys<ta.length;ys++)ta[ys]/=Xn;return ta}function ze(Pi,nn,ln){var cn=Qe(Pi),hn=cn.data,un=Object.assign({normalize:!1,divisor:1,rows:cn.rows,cols:cn.cols},ln),xs,zn;if(un.rows&&un.cols)xs=un.rows,zn=un.cols;else throw new Error("Invalid number of rows or columns "+xs+" "+zn);var Xn=un.divisor,ys=nn.length,Jo=nn[0].length,ea,ra,na,ta,ia,sa,Ma,pa,oa;if(un.normalize)for(Xn=0,ea=0;ea<ys;ea++)for(ra=0;ra<Jo;ra++)Xn+=nn[ea][ra];if(Xn===0)throw new RangeError("convolution: The divisor is equal to zero");var ha=new Array(xs*zn),ca=Math.floor(ys/2),da=Math.floor(Jo/2);for(ta=0;ta<xs;ta++)for(na=0;na<zn;na++){for(sa=0,ra=0;ra<ys;ra++)for(ea=0;ea<Jo;ea++)Ma=nn[ys-ra-1][Jo-ea-1],pa=(ta+ra-ca+xs)%xs,oa=(na+ea-da+zn)%zn,ia=pa*zn+oa,sa+=hn[ia]*Ma;ia=ta*zn+na,ha[ia]=sa/Xn}return ha}function Ke(Pi,nn,ln){var cn=1e3;ln&&ln.factor&&(cn=ln.factor);var hn=new Array(nn),un,xs,zn,Xn;cn*=-1;var ys=(nn-1)/2,Jo=2*Pi*Pi;for(un=0;un<nn;un++)for(hn[un]=new Array(nn),Xn=(un-ys)*(un-ys),xs=0;xs<nn;xs++)zn=-((xs-ys)*(xs-ys)+Xn)/Jo,hn[un][xs]=Math.round(cn*(1+zn)*Math.exp(zn));return hn}function Qe(Pi){var nn=Pi,ln,cn;if(typeof Pi[0]!="number"){ln=Pi.length,cn=Pi[0].length,nn=new Array(ln*cn);for(var hn=0;hn<ln;hn++)for(var un=0;un<cn;un++)nn[hn*cn+un]=Pi[hn][un]}else{var xs=Math.sqrt(Pi.length);Number.isInteger(xs)&&(ln=xs,cn=xs)}return{data:nn,rows:ln,cols:cn}}return src$1={fft:f,direct:ze,kernelFactory:{LoG:Ke},matrix2Array:Qe},src$1}var srcExports$1=requireSrc$1(),_isFinite,hasRequired_isFinite;function require_isFinite(){return hasRequired_isFinite||(hasRequired_isFinite=1,_isFinite=Number.isFinite||function(qe){return!(typeof qe!="number"||qe!==qe||qe===1/0||qe===-1/0)}),_isFinite}var isInteger$1,hasRequiredIsInteger;function requireIsInteger(){if(hasRequiredIsInteger)return isInteger$1;hasRequiredIsInteger=1;var qe=require_isFinite();return isInteger$1=Number.isInteger||function(f){return typeof f=="number"&&qe(f)&&Math.floor(f)===f},isInteger$1}var isIntegerExports=requireIsInteger();const isInteger=getDefaultExportFromCjs(isIntegerExports);function validateKernel(qe){let f,ze;if(Array.isArray(qe))if(Array.isArray(qe[0])){if((qe.length&1)===0||(qe[0].length&1)===0)throw new RangeError("validateKernel: Kernel rows and columns should be odd numbers");f=Math.floor(qe.length/2),ze=Math.floor(qe[0].length/2)}else{let Ke=Math.sqrt(qe.length);if(isInteger(Ke))ze=f=Math.floor(Math.sqrt(qe.length)/2);else throw new RangeError("validateKernel: Kernel array should be a square");let Qe=new Array(Ke);for(let Pi=0;Pi<Ke;Pi++){Qe[Pi]=new Array(Ke);for(let nn=0;nn<Ke;nn++)Qe[Pi][nn]=qe[Pi*Ke+nn]}qe=Qe}else throw new Error(`validateKernel: Invalid Kernel: ${qe}`);return{kernel:qe,kWidth:ze,kHeight:f}}function clamp(qe,f){return Math.round(Math.min(Math.max(qe,0),f.maxValue))}function directConvolution(qe,f,ze){if(ze===void 0){const Pi=qe.length+f.length-1;ze=new Array(Pi)}fill(ze);for(var Ke=0;Ke<qe.length;Ke++)for(var Qe=0;Qe<f.length;Qe++)ze[Ke+Qe]+=qe[Ke]*f[Qe];return ze}function fill(qe){for(var f=0;f<qe.length;f++)qe[f]=0}var fft,hasRequiredFft;function requireFft(){if(hasRequiredFft)return fft;hasRequiredFft=1;function qe(f){if(this.size=f|0,this.size<=1||(this.size&this.size-1)!==0)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=f<<1;for(var ze=new Array(this.size*2),Ke=0;Ke<ze.length;Ke+=2){const hn=Math.PI*Ke/this.size;ze[Ke]=Math.cos(hn),ze[Ke+1]=-Math.sin(hn)}this.table=ze;for(var Qe=0,Pi=1;this.size>Pi;Pi<<=1)Qe++;this._width=Qe%2===0?Qe-1:Qe,this._bitrev=new Array(1<<this._width);for(var nn=0;nn<this._bitrev.length;nn++){this._bitrev[nn]=0;for(var ln=0;ln<this._width;ln+=2){var cn=this._width-ln-2;this._bitrev[nn]|=(nn>>>ln&3)<<cn}}this._out=null,this._data=null,this._inv=0}return fft=qe,qe.prototype.fromComplexArray=function(ze,Ke){for(var Qe=Ke||new Array(ze.length>>>1),Pi=0;Pi<ze.length;Pi+=2)Qe[Pi>>>1]=ze[Pi];return Qe},qe.prototype.createComplexArray=function(){const ze=new Array(this._csize);for(var Ke=0;Ke<ze.length;Ke++)ze[Ke]=0;return ze},qe.prototype.toComplexArray=function(ze,Ke){for(var Qe=Ke||this.createComplexArray(),Pi=0;Pi<Qe.length;Pi+=2)Qe[Pi]=ze[Pi>>>1],Qe[Pi+1]=0;return Qe},qe.prototype.completeSpectrum=function(ze){for(var Ke=this._csize,Qe=Ke>>>1,Pi=2;Pi<Qe;Pi+=2)ze[Ke-Pi]=ze[Pi],ze[Ke-Pi+1]=-ze[Pi+1]},qe.prototype.transform=function(ze,Ke){if(ze===Ke)throw new Error("Input and output buffers must be different");this._out=ze,this._data=Ke,this._inv=0,this._transform4(),this._out=null,this._data=null},qe.prototype.realTransform=function(ze,Ke){if(ze===Ke)throw new Error("Input and output buffers must be different");this._out=ze,this._data=Ke,this._inv=0,this._realTransform4(),this._out=null,this._data=null},qe.prototype.inverseTransform=function(ze,Ke){if(ze===Ke)throw new Error("Input and output buffers must be different");this._out=ze,this._data=Ke,this._inv=1,this._transform4();for(var Qe=0;Qe<ze.length;Qe++)ze[Qe]/=this.size;this._out=null,this._data=null},qe.prototype._transform4=function(){var ze=this._out,Ke=this._csize,Qe=this._width,Pi=1<<Qe,nn=Ke/Pi<<1,ln,cn,hn=this._bitrev;if(nn===4)for(ln=0,cn=0;ln<Ke;ln+=nn,cn++){const ea=hn[cn];this._singleTransform2(ln,ea,Pi)}else for(ln=0,cn=0;ln<Ke;ln+=nn,cn++){const ea=hn[cn];this._singleTransform4(ln,ea,Pi)}var un=this._inv?-1:1,xs=this.table;for(Pi>>=2;Pi>=2;Pi>>=2){nn=Ke/Pi<<1;var zn=nn>>>2;for(ln=0;ln<Ke;ln+=nn)for(var Xn=ln+zn,ys=ln,Jo=0;ys<Xn;ys+=2,Jo+=Pi){const ea=ys,ra=ea+zn,na=ra+zn,ta=na+zn,ia=ze[ea],sa=ze[ea+1],Ma=ze[ra],pa=ze[ra+1],oa=ze[na],ha=ze[na+1],ca=ze[ta],da=ze[ta+1],ga=ia,qa=sa,Ka=xs[Jo],il=un*xs[Jo+1],cl=Ma*Ka-pa*il,wl=Ma*il+pa*Ka,al=xs[2*Jo],vl=un*xs[2*Jo+1],ml=oa*al-ha*vl,ol=oa*vl+ha*al,el=xs[3*Jo],dl=un*xs[3*Jo+1],xl=ca*el-da*dl,Ja=ca*dl+da*el,yl=ga+ml,Ol=qa+ol,Il=ga-ml,Rl=qa-ol,Al=cl+xl,zl=wl+Ja,Ql=un*(cl-xl),Xl=un*(wl-Ja),Tl=yl+Al,pl=Ol+zl,Hl=yl-Al,Ll=Ol-zl,Vl=Il+Xl,rl=Rl-Ql,Pl=Il-Xl,kl=Rl+Ql;ze[ea]=Tl,ze[ea+1]=pl,ze[ra]=Vl,ze[ra+1]=rl,ze[na]=Hl,ze[na+1]=Ll,ze[ta]=Pl,ze[ta+1]=kl}}},qe.prototype._singleTransform2=function(ze,Ke,Qe){const Pi=this._out,nn=this._data,ln=nn[Ke],cn=nn[Ke+1],hn=nn[Ke+Qe],un=nn[Ke+Qe+1],xs=ln+hn,zn=cn+un,Xn=ln-hn,ys=cn-un;Pi[ze]=xs,Pi[ze+1]=zn,Pi[ze+2]=Xn,Pi[ze+3]=ys},qe.prototype._singleTransform4=function(ze,Ke,Qe){const Pi=this._out,nn=this._data,ln=this._inv?-1:1,cn=Qe*2,hn=Qe*3,un=nn[Ke],xs=nn[Ke+1],zn=nn[Ke+Qe],Xn=nn[Ke+Qe+1],ys=nn[Ke+cn],Jo=nn[Ke+cn+1],ea=nn[Ke+hn],ra=nn[Ke+hn+1],na=un+ys,ta=xs+Jo,ia=un-ys,sa=xs-Jo,Ma=zn+ea,pa=Xn+ra,oa=ln*(zn-ea),ha=ln*(Xn-ra),ca=na+Ma,da=ta+pa,ga=ia+ha,qa=sa-oa,Ka=na-Ma,il=ta-pa,cl=ia-ha,wl=sa+oa;Pi[ze]=ca,Pi[ze+1]=da,Pi[ze+2]=ga,Pi[ze+3]=qa,Pi[ze+4]=Ka,Pi[ze+5]=il,Pi[ze+6]=cl,Pi[ze+7]=wl},qe.prototype._realTransform4=function(){var ze=this._out,Ke=this._csize,Qe=this._width,Pi=1<<Qe,nn=Ke/Pi<<1,ln,cn,hn=this._bitrev;if(nn===4)for(ln=0,cn=0;ln<Ke;ln+=nn,cn++){const mh=hn[cn];this._singleRealTransform2(ln,mh>>>1,Pi>>>1)}else for(ln=0,cn=0;ln<Ke;ln+=nn,cn++){const mh=hn[cn];this._singleRealTransform4(ln,mh>>>1,Pi>>>1)}var un=this._inv?-1:1,xs=this.table;for(Pi>>=2;Pi>=2;Pi>>=2){nn=Ke/Pi<<1;var zn=nn>>>1,Xn=zn>>>1,ys=Xn>>>1;for(ln=0;ln<Ke;ln+=nn)for(var Jo=0,ea=0;Jo<=ys;Jo+=2,ea+=Pi){var ra=ln+Jo,na=ra+Xn,ta=na+Xn,ia=ta+Xn,sa=ze[ra],Ma=ze[ra+1],pa=ze[na],oa=ze[na+1],ha=ze[ta],ca=ze[ta+1],da=ze[ia],ga=ze[ia+1],qa=sa,Ka=Ma,il=xs[ea],cl=un*xs[ea+1],wl=pa*il-oa*cl,al=pa*cl+oa*il,vl=xs[2*ea],ml=un*xs[2*ea+1],ol=ha*vl-ca*ml,el=ha*ml+ca*vl,dl=xs[3*ea],xl=un*xs[3*ea+1],Ja=da*dl-ga*xl,yl=da*xl+ga*dl,Ol=qa+ol,Il=Ka+el,Rl=qa-ol,Al=Ka-el,zl=wl+Ja,Ql=al+yl,Xl=un*(wl-Ja),Tl=un*(al-yl),pl=Ol+zl,Hl=Il+Ql,Ll=Rl+Tl,Vl=Al-Xl;if(ze[ra]=pl,ze[ra+1]=Hl,ze[na]=Ll,ze[na+1]=Vl,Jo===0){var rl=Ol-zl,Pl=Il-Ql;ze[ta]=rl,ze[ta+1]=Pl;continue}if(Jo!==ys){var kl=Rl,Dl=-Al,fl=Ol,Gl=-Il,ql=-un*Tl,Cl=-un*Xl,El=-un*Ql,Bl=-un*zl,Ml=kl+ql,Ul=Dl+Cl,Kl=fl+Bl,Nl=Gl-El,Zl=ln+Xn-Jo,Wl=ln+zn-Jo;ze[Zl]=Ml,ze[Zl+1]=Ul,ze[Wl]=Kl,ze[Wl+1]=Nl}}}},qe.prototype._singleRealTransform2=function(ze,Ke,Qe){const Pi=this._out,nn=this._data,ln=nn[Ke],cn=nn[Ke+Qe],hn=ln+cn,un=ln-cn;Pi[ze]=hn,Pi[ze+1]=0,Pi[ze+2]=un,Pi[ze+3]=0},qe.prototype._singleRealTransform4=function(ze,Ke,Qe){const Pi=this._out,nn=this._data,ln=this._inv?-1:1,cn=Qe*2,hn=Qe*3,un=nn[Ke],xs=nn[Ke+Qe],zn=nn[Ke+cn],Xn=nn[Ke+hn],ys=un+zn,Jo=un-zn,ea=xs+Xn,ra=ln*(xs-Xn),na=ys+ea,ta=Jo,ia=-ra,sa=ys-ea,Ma=Jo,pa=ra;Pi[ze]=na,Pi[ze+1]=0,Pi[ze+2]=ta,Pi[ze+3]=ia,Pi[ze+4]=sa,Pi[ze+5]=0,Pi[ze+6]=Ma,Pi[ze+7]=pa},fft}requireFft();function convolutionSeparable(qe,f,ze,Ke){const Qe=new Array(qe.length);let Pi,nn,ln,cn;cn=f[1],ln=(cn.length-1)/2,nn=new Array(ze+cn.length-1),Pi=new Array(ze);for(let hn=0;hn<Ke;hn++){for(let un=0;un<ze;un++)Pi[un]=qe[hn*ze+un];directConvolution(Pi,cn,nn);for(let un=0;un<ze;un++)Qe[hn*ze+un]=nn[ln+un]}cn=f[0],ln=(cn.length-1)/2,nn=new Array(Ke+cn.length-1),Pi=new Array(Ke);for(let hn=0;hn<ze;hn++){for(let un=0;un<Ke;un++)Pi[un]=Qe[un*ze+hn];directConvolution(Pi,cn,nn);for(let un=0;un<Ke;un++)Qe[un*ze+hn]=nn[ln+un]}return Qe}var matrix$1={};const toString=Object.prototype.toString;function isAnyArray(qe){const f=toString.call(qe);return f.endsWith("Array]")&&!f.includes("Big")}const libEsm=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray},Symbol.toStringTag,{value:"Module"})),require$$0$1=getAugmentedNamespace(libEsm);function max$1(qe){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(qe))throw new TypeError("input must be an array");if(qe.length===0)throw new TypeError("input must not be empty");var ze=f.fromIndex,Ke=ze===void 0?0:ze,Qe=f.toIndex,Pi=Qe===void 0?qe.length:Qe;if(Ke<0||Ke>=qe.length||!Number.isInteger(Ke))throw new Error("fromIndex must be a positive integer smaller than length");if(Pi<=Ke||Pi>qe.length||!Number.isInteger(Pi))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var nn=qe[Ke],ln=Ke+1;ln<Pi;ln++)qe[ln]>nn&&(nn=qe[ln]);return nn}function min$1(qe){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(qe))throw new TypeError("input must be an array");if(qe.length===0)throw new TypeError("input must not be empty");var ze=f.fromIndex,Ke=ze===void 0?0:ze,Qe=f.toIndex,Pi=Qe===void 0?qe.length:Qe;if(Ke<0||Ke>=qe.length||!Number.isInteger(Ke))throw new Error("fromIndex must be a positive integer smaller than length");if(Pi<=Ke||Pi>qe.length||!Number.isInteger(Pi))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var nn=qe[Ke],ln=Ke+1;ln<Pi;ln++)qe[ln]<nn&&(nn=qe[ln]);return nn}function rescale(qe){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(isAnyArray(qe)){if(qe.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var ze;if(f.output!==void 0){if(!isAnyArray(f.output))throw new TypeError("output option must be an array if specified");ze=f.output}else ze=new Array(qe.length);var Ke=min$1(qe),Qe=max$1(qe);if(Ke===Qe)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var Pi=f.min,nn=Pi===void 0?f.autoMinMax?Ke:0:Pi,ln=f.max,cn=ln===void 0?f.autoMinMax?Qe:1:ln;if(nn>=cn)throw new RangeError("min option must be smaller than max option");for(var hn=(cn-nn)/(Qe-Ke),un=0;un<qe.length;un++)ze[un]=(qe[un]-Ke)*hn+nn;return ze}const libEs6=Object.freeze(Object.defineProperty({__proto__:null,default:rescale},Symbol.toStringTag,{value:"Module"})),require$$1=getAugmentedNamespace(libEs6);var hasRequiredMatrix;function requireMatrix(){var Fh,Jh,Sh;if(hasRequiredMatrix)return matrix$1;hasRequiredMatrix=1,Object.defineProperty(matrix$1,"__esModule",{value:!0});var qe=require$$0$1,f=require$$1;const ze=" ".repeat(2),Ke=" ".repeat(4);function Qe(){return Pi(this)}function Pi(Cs,Kn={}){const{maxRows:qn=15,maxColumns:Un=10,maxNumSize:vs=8,padMinus:bs="auto"}=Kn;return`${Cs.constructor.name} {
${ze}[
${Ke}${nn(Cs,qn,Un,vs,bs)}
${ze}]
${ze}rows: ${Cs.rows}
${ze}columns: ${Cs.columns}
}`}function nn(Cs,Kn,qn,Un,vs){const{rows:bs,columns:aa}=Cs,la=Math.min(bs,Kn),ua=Math.min(aa,qn),fa=[];if(vs==="auto"){vs=!1;e:for(let Qa=0;Qa<la;Qa++)for(let Na=0;Na<ua;Na++)if(Cs.get(Qa,Na)<0){vs=!0;break e}}for(let Qa=0;Qa<la;Qa++){let Na=[];for(let nl=0;nl<ua;nl++)Na.push(ln(Cs.get(Qa,nl),Un,vs));fa.push(`${Na.join(" ")}`)}return ua!==aa&&(fa[fa.length-1]+=` ... ${aa-qn} more columns`),la!==bs&&fa.push(`... ${bs-Kn} more rows`),fa.join(`
${Ke}`)}function ln(Cs,Kn,qn){return(Cs>=0&&qn?` ${cn(Cs,Kn-1)}`:cn(Cs,Kn)).padEnd(Kn)}function cn(Cs,Kn){let qn=Cs.toString();if(qn.length<=Kn)return qn;let Un=Cs.toFixed(Kn);if(Un.length>Kn&&(Un=Cs.toFixed(Math.max(0,Kn-(Un.length-Kn)))),Un.length<=Kn&&!Un.startsWith("0.000")&&!Un.startsWith("-0.000"))return Un;let vs=Cs.toExponential(Kn);return vs.length>Kn&&(vs=Cs.toExponential(Math.max(0,Kn-(vs.length-Kn)))),vs.slice(0)}function hn(Cs,Kn){Cs.prototype.add=function(Un){return typeof Un=="number"?this.addS(Un):this.addM(Un)},Cs.prototype.addS=function(Un){for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)+Un);return this},Cs.prototype.addM=function(Un){if(Un=Kn.checkMatrix(Un),this.rows!==Un.rows||this.columns!==Un.columns)throw new RangeError("Matrices dimensions must be equal");for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)+Un.get(vs,bs));return this},Cs.add=function(Un,vs){return new Kn(Un).add(vs)},Cs.prototype.sub=function(Un){return typeof Un=="number"?this.subS(Un):this.subM(Un)},Cs.prototype.subS=function(Un){for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)-Un);return this},Cs.prototype.subM=function(Un){if(Un=Kn.checkMatrix(Un),this.rows!==Un.rows||this.columns!==Un.columns)throw new RangeError("Matrices dimensions must be equal");for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)-Un.get(vs,bs));return this},Cs.sub=function(Un,vs){return new Kn(Un).sub(vs)},Cs.prototype.subtract=Cs.prototype.sub,Cs.prototype.subtractS=Cs.prototype.subS,Cs.prototype.subtractM=Cs.prototype.subM,Cs.subtract=Cs.sub,Cs.prototype.mul=function(Un){return typeof Un=="number"?this.mulS(Un):this.mulM(Un)},Cs.prototype.mulS=function(Un){for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)*Un);return this},Cs.prototype.mulM=function(Un){if(Un=Kn.checkMatrix(Un),this.rows!==Un.rows||this.columns!==Un.columns)throw new RangeError("Matrices dimensions must be equal");for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)*Un.get(vs,bs));return this},Cs.mul=function(Un,vs){return new Kn(Un).mul(vs)},Cs.prototype.multiply=Cs.prototype.mul,Cs.prototype.multiplyS=Cs.prototype.mulS,Cs.prototype.multiplyM=Cs.prototype.mulM,Cs.multiply=Cs.mul,Cs.prototype.div=function(Un){return typeof Un=="number"?this.divS(Un):this.divM(Un)},Cs.prototype.divS=function(Un){for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)/Un);return this},Cs.prototype.divM=function(Un){if(Un=Kn.checkMatrix(Un),this.rows!==Un.rows||this.columns!==Un.columns)throw new RangeError("Matrices dimensions must be equal");for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)/Un.get(vs,bs));return this},Cs.div=function(Un,vs){return new Kn(Un).div(vs)},Cs.prototype.divide=Cs.prototype.div,Cs.prototype.divideS=Cs.prototype.divS,Cs.prototype.divideM=Cs.prototype.divM,Cs.divide=Cs.div,Cs.prototype.mod=function(Un){return typeof Un=="number"?this.modS(Un):this.modM(Un)},Cs.prototype.modS=function(Un){for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)%Un);return this},Cs.prototype.modM=function(Un){if(Un=Kn.checkMatrix(Un),this.rows!==Un.rows||this.columns!==Un.columns)throw new RangeError("Matrices dimensions must be equal");for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)%Un.get(vs,bs));return this},Cs.mod=function(Un,vs){return new Kn(Un).mod(vs)},Cs.prototype.modulus=Cs.prototype.mod,Cs.prototype.modulusS=Cs.prototype.modS,Cs.prototype.modulusM=Cs.prototype.modM,Cs.modulus=Cs.mod,Cs.prototype.and=function(Un){return typeof Un=="number"?this.andS(Un):this.andM(Un)},Cs.prototype.andS=function(Un){for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)&Un);return this},Cs.prototype.andM=function(Un){if(Un=Kn.checkMatrix(Un),this.rows!==Un.rows||this.columns!==Un.columns)throw new RangeError("Matrices dimensions must be equal");for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)&Un.get(vs,bs));return this},Cs.and=function(Un,vs){return new Kn(Un).and(vs)},Cs.prototype.or=function(Un){return typeof Un=="number"?this.orS(Un):this.orM(Un)},Cs.prototype.orS=function(Un){for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)|Un);return this},Cs.prototype.orM=function(Un){if(Un=Kn.checkMatrix(Un),this.rows!==Un.rows||this.columns!==Un.columns)throw new RangeError("Matrices dimensions must be equal");for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)|Un.get(vs,bs));return this},Cs.or=function(Un,vs){return new Kn(Un).or(vs)},Cs.prototype.xor=function(Un){return typeof Un=="number"?this.xorS(Un):this.xorM(Un)},Cs.prototype.xorS=function(Un){for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)^Un);return this},Cs.prototype.xorM=function(Un){if(Un=Kn.checkMatrix(Un),this.rows!==Un.rows||this.columns!==Un.columns)throw new RangeError("Matrices dimensions must be equal");for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)^Un.get(vs,bs));return this},Cs.xor=function(Un,vs){return new Kn(Un).xor(vs)},Cs.prototype.leftShift=function(Un){return typeof Un=="number"?this.leftShiftS(Un):this.leftShiftM(Un)},Cs.prototype.leftShiftS=function(Un){for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)<<Un);return this},Cs.prototype.leftShiftM=function(Un){if(Un=Kn.checkMatrix(Un),this.rows!==Un.rows||this.columns!==Un.columns)throw new RangeError("Matrices dimensions must be equal");for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)<<Un.get(vs,bs));return this},Cs.leftShift=function(Un,vs){return new Kn(Un).leftShift(vs)},Cs.prototype.signPropagatingRightShift=function(Un){return typeof Un=="number"?this.signPropagatingRightShiftS(Un):this.signPropagatingRightShiftM(Un)},Cs.prototype.signPropagatingRightShiftS=function(Un){for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)>>Un);return this},Cs.prototype.signPropagatingRightShiftM=function(Un){if(Un=Kn.checkMatrix(Un),this.rows!==Un.rows||this.columns!==Un.columns)throw new RangeError("Matrices dimensions must be equal");for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)>>Un.get(vs,bs));return this},Cs.signPropagatingRightShift=function(Un,vs){return new Kn(Un).signPropagatingRightShift(vs)},Cs.prototype.rightShift=function(Un){return typeof Un=="number"?this.rightShiftS(Un):this.rightShiftM(Un)},Cs.prototype.rightShiftS=function(Un){for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)>>>Un);return this},Cs.prototype.rightShiftM=function(Un){if(Un=Kn.checkMatrix(Un),this.rows!==Un.rows||this.columns!==Un.columns)throw new RangeError("Matrices dimensions must be equal");for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)>>>Un.get(vs,bs));return this},Cs.rightShift=function(Un,vs){return new Kn(Un).rightShift(vs)},Cs.prototype.zeroFillRightShift=Cs.prototype.rightShift,Cs.prototype.zeroFillRightShiftS=Cs.prototype.rightShiftS,Cs.prototype.zeroFillRightShiftM=Cs.prototype.rightShiftM,Cs.zeroFillRightShift=Cs.rightShift,Cs.prototype.not=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,~this.get(Un,vs));return this},Cs.not=function(Un){return new Kn(Un).not()},Cs.prototype.abs=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.abs(this.get(Un,vs)));return this},Cs.abs=function(Un){return new Kn(Un).abs()},Cs.prototype.acos=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.acos(this.get(Un,vs)));return this},Cs.acos=function(Un){return new Kn(Un).acos()},Cs.prototype.acosh=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.acosh(this.get(Un,vs)));return this},Cs.acosh=function(Un){return new Kn(Un).acosh()},Cs.prototype.asin=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.asin(this.get(Un,vs)));return this},Cs.asin=function(Un){return new Kn(Un).asin()},Cs.prototype.asinh=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.asinh(this.get(Un,vs)));return this},Cs.asinh=function(Un){return new Kn(Un).asinh()},Cs.prototype.atan=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.atan(this.get(Un,vs)));return this},Cs.atan=function(Un){return new Kn(Un).atan()},Cs.prototype.atanh=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.atanh(this.get(Un,vs)));return this},Cs.atanh=function(Un){return new Kn(Un).atanh()},Cs.prototype.cbrt=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.cbrt(this.get(Un,vs)));return this},Cs.cbrt=function(Un){return new Kn(Un).cbrt()},Cs.prototype.ceil=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.ceil(this.get(Un,vs)));return this},Cs.ceil=function(Un){return new Kn(Un).ceil()},Cs.prototype.clz32=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.clz32(this.get(Un,vs)));return this},Cs.clz32=function(Un){return new Kn(Un).clz32()},Cs.prototype.cos=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.cos(this.get(Un,vs)));return this},Cs.cos=function(Un){return new Kn(Un).cos()},Cs.prototype.cosh=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.cosh(this.get(Un,vs)));return this},Cs.cosh=function(Un){return new Kn(Un).cosh()},Cs.prototype.exp=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.exp(this.get(Un,vs)));return this},Cs.exp=function(Un){return new Kn(Un).exp()},Cs.prototype.expm1=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.expm1(this.get(Un,vs)));return this},Cs.expm1=function(Un){return new Kn(Un).expm1()},Cs.prototype.floor=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.floor(this.get(Un,vs)));return this},Cs.floor=function(Un){return new Kn(Un).floor()},Cs.prototype.fround=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.fround(this.get(Un,vs)));return this},Cs.fround=function(Un){return new Kn(Un).fround()},Cs.prototype.log=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.log(this.get(Un,vs)));return this},Cs.log=function(Un){return new Kn(Un).log()},Cs.prototype.log1p=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.log1p(this.get(Un,vs)));return this},Cs.log1p=function(Un){return new Kn(Un).log1p()},Cs.prototype.log10=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.log10(this.get(Un,vs)));return this},Cs.log10=function(Un){return new Kn(Un).log10()},Cs.prototype.log2=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.log2(this.get(Un,vs)));return this},Cs.log2=function(Un){return new Kn(Un).log2()},Cs.prototype.round=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.round(this.get(Un,vs)));return this},Cs.round=function(Un){return new Kn(Un).round()},Cs.prototype.sign=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.sign(this.get(Un,vs)));return this},Cs.sign=function(Un){return new Kn(Un).sign()},Cs.prototype.sin=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.sin(this.get(Un,vs)));return this},Cs.sin=function(Un){return new Kn(Un).sin()},Cs.prototype.sinh=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.sinh(this.get(Un,vs)));return this},Cs.sinh=function(Un){return new Kn(Un).sinh()},Cs.prototype.sqrt=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.sqrt(this.get(Un,vs)));return this},Cs.sqrt=function(Un){return new Kn(Un).sqrt()},Cs.prototype.tan=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.tan(this.get(Un,vs)));return this},Cs.tan=function(Un){return new Kn(Un).tan()},Cs.prototype.tanh=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.tanh(this.get(Un,vs)));return this},Cs.tanh=function(Un){return new Kn(Un).tanh()},Cs.prototype.trunc=function(){for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.set(Un,vs,Math.trunc(this.get(Un,vs)));return this},Cs.trunc=function(Un){return new Kn(Un).trunc()},Cs.pow=function(Un,vs){return new Kn(Un).pow(vs)},Cs.prototype.pow=function(Un){return typeof Un=="number"?this.powS(Un):this.powM(Un)},Cs.prototype.powS=function(Un){for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)**Un);return this},Cs.prototype.powM=function(Un){if(Un=Kn.checkMatrix(Un),this.rows!==Un.rows||this.columns!==Un.columns)throw new RangeError("Matrices dimensions must be equal");for(let vs=0;vs<this.rows;vs++)for(let bs=0;bs<this.columns;bs++)this.set(vs,bs,this.get(vs,bs)**Un.get(vs,bs));return this}}function un(Cs,Kn,qn){let Un=qn?Cs.rows:Cs.rows-1;if(Kn<0||Kn>Un)throw new RangeError("Row index out of range")}function xs(Cs,Kn,qn){let Un=qn?Cs.columns:Cs.columns-1;if(Kn<0||Kn>Un)throw new RangeError("Column index out of range")}function zn(Cs,Kn){if(Kn.to1DArray&&(Kn=Kn.to1DArray()),Kn.length!==Cs.columns)throw new RangeError("vector size must be the same as the number of columns");return Kn}function Xn(Cs,Kn){if(Kn.to1DArray&&(Kn=Kn.to1DArray()),Kn.length!==Cs.rows)throw new RangeError("vector size must be the same as the number of rows");return Kn}function ys(Cs,Kn){if(!qe.isAnyArray(Kn))throw new TypeError("row indices must be an array");for(let qn=0;qn<Kn.length;qn++)if(Kn[qn]<0||Kn[qn]>=Cs.rows)throw new RangeError("row indices are out of range")}function Jo(Cs,Kn){if(!qe.isAnyArray(Kn))throw new TypeError("column indices must be an array");for(let qn=0;qn<Kn.length;qn++)if(Kn[qn]<0||Kn[qn]>=Cs.columns)throw new RangeError("column indices are out of range")}function ea(Cs,Kn,qn,Un,vs){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(na("startRow",Kn),na("endRow",qn),na("startColumn",Un),na("endColumn",vs),Kn>qn||Un>vs||Kn<0||Kn>=Cs.rows||qn<0||qn>=Cs.rows||Un<0||Un>=Cs.columns||vs<0||vs>=Cs.columns)throw new RangeError("Submatrix indices are out of range")}function ra(Cs,Kn=0){let qn=[];for(let Un=0;Un<Cs;Un++)qn.push(Kn);return qn}function na(Cs,Kn){if(typeof Kn!="number")throw new TypeError(`${Cs} must be a number`)}function ta(Cs){if(Cs.isEmpty())throw new Error("Empty matrix has no elements to index")}function ia(Cs){let Kn=ra(Cs.rows);for(let qn=0;qn<Cs.rows;++qn)for(let Un=0;Un<Cs.columns;++Un)Kn[qn]+=Cs.get(qn,Un);return Kn}function sa(Cs){let Kn=ra(Cs.columns);for(let qn=0;qn<Cs.rows;++qn)for(let Un=0;Un<Cs.columns;++Un)Kn[Un]+=Cs.get(qn,Un);return Kn}function Ma(Cs){let Kn=0;for(let qn=0;qn<Cs.rows;qn++)for(let Un=0;Un<Cs.columns;Un++)Kn+=Cs.get(qn,Un);return Kn}function pa(Cs){let Kn=ra(Cs.rows,1);for(let qn=0;qn<Cs.rows;++qn)for(let Un=0;Un<Cs.columns;++Un)Kn[qn]*=Cs.get(qn,Un);return Kn}function oa(Cs){let Kn=ra(Cs.columns,1);for(let qn=0;qn<Cs.rows;++qn)for(let Un=0;Un<Cs.columns;++Un)Kn[Un]*=Cs.get(qn,Un);return Kn}function ha(Cs){let Kn=1;for(let qn=0;qn<Cs.rows;qn++)for(let Un=0;Un<Cs.columns;Un++)Kn*=Cs.get(qn,Un);return Kn}function ca(Cs,Kn,qn){const Un=Cs.rows,vs=Cs.columns,bs=[];for(let aa=0;aa<Un;aa++){let la=0,ua=0,fa=0;for(let Qa=0;Qa<vs;Qa++)fa=Cs.get(aa,Qa)-qn[aa],la+=fa,ua+=fa*fa;Kn?bs.push((ua-la*la/vs)/(vs-1)):bs.push((ua-la*la/vs)/vs)}return bs}function da(Cs,Kn,qn){const Un=Cs.rows,vs=Cs.columns,bs=[];for(let aa=0;aa<vs;aa++){let la=0,ua=0,fa=0;for(let Qa=0;Qa<Un;Qa++)fa=Cs.get(Qa,aa)-qn[aa],la+=fa,ua+=fa*fa;Kn?bs.push((ua-la*la/Un)/(Un-1)):bs.push((ua-la*la/Un)/Un)}return bs}function ga(Cs,Kn,qn){const Un=Cs.rows,vs=Cs.columns,bs=Un*vs;let aa=0,la=0,ua=0;for(let fa=0;fa<Un;fa++)for(let Qa=0;Qa<vs;Qa++)ua=Cs.get(fa,Qa)-qn,aa+=ua,la+=ua*ua;return Kn?(la-aa*aa/bs)/(bs-1):(la-aa*aa/bs)/bs}function qa(Cs,Kn){for(let qn=0;qn<Cs.rows;qn++)for(let Un=0;Un<Cs.columns;Un++)Cs.set(qn,Un,Cs.get(qn,Un)-Kn[qn])}function Ka(Cs,Kn){for(let qn=0;qn<Cs.rows;qn++)for(let Un=0;Un<Cs.columns;Un++)Cs.set(qn,Un,Cs.get(qn,Un)-Kn[Un])}function il(Cs,Kn){for(let qn=0;qn<Cs.rows;qn++)for(let Un=0;Un<Cs.columns;Un++)Cs.set(qn,Un,Cs.get(qn,Un)-Kn)}function cl(Cs){const Kn=[];for(let qn=0;qn<Cs.rows;qn++){let Un=0;for(let vs=0;vs<Cs.columns;vs++)Un+=Cs.get(qn,vs)**2/(Cs.columns-1);Kn.push(Math.sqrt(Un))}return Kn}function wl(Cs,Kn){for(let qn=0;qn<Cs.rows;qn++)for(let Un=0;Un<Cs.columns;Un++)Cs.set(qn,Un,Cs.get(qn,Un)/Kn[qn])}function al(Cs){const Kn=[];for(let qn=0;qn<Cs.columns;qn++){let Un=0;for(let vs=0;vs<Cs.rows;vs++)Un+=Cs.get(vs,qn)**2/(Cs.rows-1);Kn.push(Math.sqrt(Un))}return Kn}function vl(Cs,Kn){for(let qn=0;qn<Cs.rows;qn++)for(let Un=0;Un<Cs.columns;Un++)Cs.set(qn,Un,Cs.get(qn,Un)/Kn[Un])}function ml(Cs){const Kn=Cs.size-1;let qn=0;for(let Un=0;Un<Cs.columns;Un++)for(let vs=0;vs<Cs.rows;vs++)qn+=Cs.get(vs,Un)**2/Kn;return Math.sqrt(qn)}function ol(Cs,Kn){for(let qn=0;qn<Cs.rows;qn++)for(let Un=0;Un<Cs.columns;Un++)Cs.set(qn,Un,Cs.get(qn,Un)/Kn)}class el{static from1DArray(Kn,qn,Un){if(Kn*qn!==Un.length)throw new RangeError("data length does not match given dimensions");let bs=new Ja(Kn,qn);for(let aa=0;aa<Kn;aa++)for(let la=0;la<qn;la++)bs.set(aa,la,Un[aa*qn+la]);return bs}static rowVector(Kn){let qn=new Ja(1,Kn.length);for(let Un=0;Un<Kn.length;Un++)qn.set(0,Un,Kn[Un]);return qn}static columnVector(Kn){let qn=new Ja(Kn.length,1);for(let Un=0;Un<Kn.length;Un++)qn.set(Un,0,Kn[Un]);return qn}static zeros(Kn,qn){return new Ja(Kn,qn)}static ones(Kn,qn){return new Ja(Kn,qn).fill(1)}static rand(Kn,qn,Un={}){if(typeof Un!="object")throw new TypeError("options must be an object");const{random:vs=Math.random}=Un;let bs=new Ja(Kn,qn);for(let aa=0;aa<Kn;aa++)for(let la=0;la<qn;la++)bs.set(aa,la,vs());return bs}static randInt(Kn,qn,Un={}){if(typeof Un!="object")throw new TypeError("options must be an object");const{min:vs=0,max:bs=1e3,random:aa=Math.random}=Un;if(!Number.isInteger(vs))throw new TypeError("min must be an integer");if(!Number.isInteger(bs))throw new TypeError("max must be an integer");if(vs>=bs)throw new RangeError("min must be smaller than max");let la=bs-vs,ua=new Ja(Kn,qn);for(let fa=0;fa<Kn;fa++)for(let Qa=0;Qa<qn;Qa++){let Na=vs+Math.round(aa()*la);ua.set(fa,Qa,Na)}return ua}static eye(Kn,qn,Un){qn===void 0&&(qn=Kn),Un===void 0&&(Un=1);let vs=Math.min(Kn,qn),bs=this.zeros(Kn,qn);for(let aa=0;aa<vs;aa++)bs.set(aa,aa,Un);return bs}static diag(Kn,qn,Un){let vs=Kn.length;qn===void 0&&(qn=vs),Un===void 0&&(Un=qn);let bs=Math.min(vs,qn,Un),aa=this.zeros(qn,Un);for(let la=0;la<bs;la++)aa.set(la,la,Kn[la]);return aa}static min(Kn,qn){Kn=this.checkMatrix(Kn),qn=this.checkMatrix(qn);let Un=Kn.rows,vs=Kn.columns,bs=new Ja(Un,vs);for(let aa=0;aa<Un;aa++)for(let la=0;la<vs;la++)bs.set(aa,la,Math.min(Kn.get(aa,la),qn.get(aa,la)));return bs}static max(Kn,qn){Kn=this.checkMatrix(Kn),qn=this.checkMatrix(qn);let Un=Kn.rows,vs=Kn.columns,bs=new this(Un,vs);for(let aa=0;aa<Un;aa++)for(let la=0;la<vs;la++)bs.set(aa,la,Math.max(Kn.get(aa,la),qn.get(aa,la)));return bs}static checkMatrix(Kn){return el.isMatrix(Kn)?Kn:new Ja(Kn)}static isMatrix(Kn){return Kn!=null&&Kn.klass==="Matrix"}get size(){return this.rows*this.columns}apply(Kn){if(typeof Kn!="function")throw new TypeError("callback must be a function");for(let qn=0;qn<this.rows;qn++)for(let Un=0;Un<this.columns;Un++)Kn.call(this,qn,Un);return this}to1DArray(){let Kn=[];for(let qn=0;qn<this.rows;qn++)for(let Un=0;Un<this.columns;Un++)Kn.push(this.get(qn,Un));return Kn}to2DArray(){let Kn=[];for(let qn=0;qn<this.rows;qn++){Kn.push([]);for(let Un=0;Un<this.columns;Un++)Kn[qn].push(this.get(qn,Un))}return Kn}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let Kn=0;Kn<this.rows;Kn++)for(let qn=0;qn<=Kn;qn++)if(this.get(Kn,qn)!==this.get(qn,Kn))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let Kn=0;Kn<this.rows;Kn++)if(this.get(Kn,Kn)!==0)return!1;return!0}isEchelonForm(){let Kn=0,qn=0,Un=-1,vs=!0,bs=!1;for(;Kn<this.rows&&vs;){for(qn=0,bs=!1;qn<this.columns&&bs===!1;)this.get(Kn,qn)===0?qn++:this.get(Kn,qn)===1&&qn>Un?(bs=!0,Un=qn):(vs=!1,bs=!0);Kn++}return vs}isReducedEchelonForm(){let Kn=0,qn=0,Un=-1,vs=!0,bs=!1;for(;Kn<this.rows&&vs;){for(qn=0,bs=!1;qn<this.columns&&bs===!1;)this.get(Kn,qn)===0?qn++:this.get(Kn,qn)===1&&qn>Un?(bs=!0,Un=qn):(vs=!1,bs=!0);for(let aa=qn+1;aa<this.rows;aa++)this.get(Kn,aa)!==0&&(vs=!1);Kn++}return vs}echelonForm(){let Kn=this.clone(),qn=0,Un=0;for(;qn<Kn.rows&&Un<Kn.columns;){let vs=qn;for(let bs=qn;bs<Kn.rows;bs++)Kn.get(bs,Un)>Kn.get(vs,Un)&&(vs=bs);if(Kn.get(vs,Un)===0)Un++;else{Kn.swapRows(qn,vs);let bs=Kn.get(qn,Un);for(let aa=Un;aa<Kn.columns;aa++)Kn.set(qn,aa,Kn.get(qn,aa)/bs);for(let aa=qn+1;aa<Kn.rows;aa++){let la=Kn.get(aa,Un)/Kn.get(qn,Un);Kn.set(aa,Un,0);for(let ua=Un+1;ua<Kn.columns;ua++)Kn.set(aa,ua,Kn.get(aa,ua)-Kn.get(qn,ua)*la)}qn++,Un++}}return Kn}reducedEchelonForm(){let Kn=this.echelonForm(),qn=Kn.columns,Un=Kn.rows,vs=Un-1;for(;vs>=0;)if(Kn.maxRow(vs)===0)vs--;else{let bs=0,aa=!1;for(;bs<Un&&aa===!1;)Kn.get(vs,bs)===1?aa=!0:bs++;for(let la=0;la<vs;la++){let ua=Kn.get(la,bs);for(let fa=bs;fa<qn;fa++){let Qa=Kn.get(la,fa)-ua*Kn.get(vs,fa);Kn.set(la,fa,Qa)}}vs--}return Kn}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(Kn={}){if(typeof Kn!="object")throw new TypeError("options must be an object");const{rows:qn=1,columns:Un=1}=Kn;if(!Number.isInteger(qn)||qn<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(Un)||Un<=0)throw new TypeError("columns must be a positive integer");let vs=new Ja(this.rows*qn,this.columns*Un);for(let bs=0;bs<qn;bs++)for(let aa=0;aa<Un;aa++)vs.setSubMatrix(this,this.rows*bs,this.columns*aa);return vs}fill(Kn){for(let qn=0;qn<this.rows;qn++)for(let Un=0;Un<this.columns;Un++)this.set(qn,Un,Kn);return this}neg(){return this.mulS(-1)}getRow(Kn){un(this,Kn);let qn=[];for(let Un=0;Un<this.columns;Un++)qn.push(this.get(Kn,Un));return qn}getRowVector(Kn){return Ja.rowVector(this.getRow(Kn))}setRow(Kn,qn){un(this,Kn),qn=zn(this,qn);for(let Un=0;Un<this.columns;Un++)this.set(Kn,Un,qn[Un]);return this}swapRows(Kn,qn){un(this,Kn),un(this,qn);for(let Un=0;Un<this.columns;Un++){let vs=this.get(Kn,Un);this.set(Kn,Un,this.get(qn,Un)),this.set(qn,Un,vs)}return this}getColumn(Kn){xs(this,Kn);let qn=[];for(let Un=0;Un<this.rows;Un++)qn.push(this.get(Un,Kn));return qn}getColumnVector(Kn){return Ja.columnVector(this.getColumn(Kn))}setColumn(Kn,qn){xs(this,Kn),qn=Xn(this,qn);for(let Un=0;Un<this.rows;Un++)this.set(Un,Kn,qn[Un]);return this}swapColumns(Kn,qn){xs(this,Kn),xs(this,qn);for(let Un=0;Un<this.rows;Un++){let vs=this.get(Un,Kn);this.set(Un,Kn,this.get(Un,qn)),this.set(Un,qn,vs)}return this}addRowVector(Kn){Kn=zn(this,Kn);for(let qn=0;qn<this.rows;qn++)for(let Un=0;Un<this.columns;Un++)this.set(qn,Un,this.get(qn,Un)+Kn[Un]);return this}subRowVector(Kn){Kn=zn(this,Kn);for(let qn=0;qn<this.rows;qn++)for(let Un=0;Un<this.columns;Un++)this.set(qn,Un,this.get(qn,Un)-Kn[Un]);return this}mulRowVector(Kn){Kn=zn(this,Kn);for(let qn=0;qn<this.rows;qn++)for(let Un=0;Un<this.columns;Un++)this.set(qn,Un,this.get(qn,Un)*Kn[Un]);return this}divRowVector(Kn){Kn=zn(this,Kn);for(let qn=0;qn<this.rows;qn++)for(let Un=0;Un<this.columns;Un++)this.set(qn,Un,this.get(qn,Un)/Kn[Un]);return this}addColumnVector(Kn){Kn=Xn(this,Kn);for(let qn=0;qn<this.rows;qn++)for(let Un=0;Un<this.columns;Un++)this.set(qn,Un,this.get(qn,Un)+Kn[qn]);return this}subColumnVector(Kn){Kn=Xn(this,Kn);for(let qn=0;qn<this.rows;qn++)for(let Un=0;Un<this.columns;Un++)this.set(qn,Un,this.get(qn,Un)-Kn[qn]);return this}mulColumnVector(Kn){Kn=Xn(this,Kn);for(let qn=0;qn<this.rows;qn++)for(let Un=0;Un<this.columns;Un++)this.set(qn,Un,this.get(qn,Un)*Kn[qn]);return this}divColumnVector(Kn){Kn=Xn(this,Kn);for(let qn=0;qn<this.rows;qn++)for(let Un=0;Un<this.columns;Un++)this.set(qn,Un,this.get(qn,Un)/Kn[qn]);return this}mulRow(Kn,qn){un(this,Kn);for(let Un=0;Un<this.columns;Un++)this.set(Kn,Un,this.get(Kn,Un)*qn);return this}mulColumn(Kn,qn){xs(this,Kn);for(let Un=0;Un<this.rows;Un++)this.set(Un,Kn,this.get(Un,Kn)*qn);return this}max(Kn){if(this.isEmpty())return NaN;switch(Kn){case"row":{const qn=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.get(Un,vs)>qn[Un]&&(qn[Un]=this.get(Un,vs));return qn}case"column":{const qn=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.get(Un,vs)>qn[vs]&&(qn[vs]=this.get(Un,vs));return qn}case void 0:{let qn=this.get(0,0);for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.get(Un,vs)>qn&&(qn=this.get(Un,vs));return qn}default:throw new Error(`invalid option: ${Kn}`)}}maxIndex(){ta(this);let Kn=this.get(0,0),qn=[0,0];for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.get(Un,vs)>Kn&&(Kn=this.get(Un,vs),qn[0]=Un,qn[1]=vs);return qn}min(Kn){if(this.isEmpty())return NaN;switch(Kn){case"row":{const qn=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.get(Un,vs)<qn[Un]&&(qn[Un]=this.get(Un,vs));return qn}case"column":{const qn=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.get(Un,vs)<qn[vs]&&(qn[vs]=this.get(Un,vs));return qn}case void 0:{let qn=this.get(0,0);for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.get(Un,vs)<qn&&(qn=this.get(Un,vs));return qn}default:throw new Error(`invalid option: ${Kn}`)}}minIndex(){ta(this);let Kn=this.get(0,0),qn=[0,0];for(let Un=0;Un<this.rows;Un++)for(let vs=0;vs<this.columns;vs++)this.get(Un,vs)<Kn&&(Kn=this.get(Un,vs),qn[0]=Un,qn[1]=vs);return qn}maxRow(Kn){if(un(this,Kn),this.isEmpty())return NaN;let qn=this.get(Kn,0);for(let Un=1;Un<this.columns;Un++)this.get(Kn,Un)>qn&&(qn=this.get(Kn,Un));return qn}maxRowIndex(Kn){un(this,Kn),ta(this);let qn=this.get(Kn,0),Un=[Kn,0];for(let vs=1;vs<this.columns;vs++)this.get(Kn,vs)>qn&&(qn=this.get(Kn,vs),Un[1]=vs);return Un}minRow(Kn){if(un(this,Kn),this.isEmpty())return NaN;let qn=this.get(Kn,0);for(let Un=1;Un<this.columns;Un++)this.get(Kn,Un)<qn&&(qn=this.get(Kn,Un));return qn}minRowIndex(Kn){un(this,Kn),ta(this);let qn=this.get(Kn,0),Un=[Kn,0];for(let vs=1;vs<this.columns;vs++)this.get(Kn,vs)<qn&&(qn=this.get(Kn,vs),Un[1]=vs);return Un}maxColumn(Kn){if(xs(this,Kn),this.isEmpty())return NaN;let qn=this.get(0,Kn);for(let Un=1;Un<this.rows;Un++)this.get(Un,Kn)>qn&&(qn=this.get(Un,Kn));return qn}maxColumnIndex(Kn){xs(this,Kn),ta(this);let qn=this.get(0,Kn),Un=[0,Kn];for(let vs=1;vs<this.rows;vs++)this.get(vs,Kn)>qn&&(qn=this.get(vs,Kn),Un[0]=vs);return Un}minColumn(Kn){if(xs(this,Kn),this.isEmpty())return NaN;let qn=this.get(0,Kn);for(let Un=1;Un<this.rows;Un++)this.get(Un,Kn)<qn&&(qn=this.get(Un,Kn));return qn}minColumnIndex(Kn){xs(this,Kn),ta(this);let qn=this.get(0,Kn),Un=[0,Kn];for(let vs=1;vs<this.rows;vs++)this.get(vs,Kn)<qn&&(qn=this.get(vs,Kn),Un[0]=vs);return Un}diag(){let Kn=Math.min(this.rows,this.columns),qn=[];for(let Un=0;Un<Kn;Un++)qn.push(this.get(Un,Un));return qn}norm(Kn="frobenius"){switch(Kn){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${Kn}`)}}cumulativeSum(){let Kn=0;for(let qn=0;qn<this.rows;qn++)for(let Un=0;Un<this.columns;Un++)Kn+=this.get(qn,Un),this.set(qn,Un,Kn);return this}dot(Kn){el.isMatrix(Kn)&&(Kn=Kn.to1DArray());let qn=this.to1DArray();if(qn.length!==Kn.length)throw new RangeError("vectors do not have the same size");let Un=0;for(let vs=0;vs<qn.length;vs++)Un+=qn[vs]*Kn[vs];return Un}mmul(Kn){Kn=Ja.checkMatrix(Kn);let qn=this.rows,Un=this.columns,vs=Kn.columns,bs=new Ja(qn,vs),aa=new Float64Array(Un);for(let la=0;la<vs;la++){for(let ua=0;ua<Un;ua++)aa[ua]=Kn.get(ua,la);for(let ua=0;ua<qn;ua++){let fa=0;for(let Qa=0;Qa<Un;Qa++)fa+=this.get(ua,Qa)*aa[Qa];bs.set(ua,la,fa)}}return bs}mpow(Kn){if(!this.isSquare())throw new RangeError("Matrix must be square");if(!Number.isInteger(Kn)||Kn<0)throw new RangeError("Exponent must be a non-negative integer");let qn=Ja.eye(this.rows),Un=this;for(let vs=Kn;vs>=1;vs/=2)(vs&1)!==0&&(qn=qn.mmul(Un)),Un=Un.mmul(Un);return qn}strassen2x2(Kn){Kn=Ja.checkMatrix(Kn);let qn=new Ja(2,2);const Un=this.get(0,0),vs=Kn.get(0,0),bs=this.get(0,1),aa=Kn.get(0,1),la=this.get(1,0),ua=Kn.get(1,0),fa=this.get(1,1),Qa=Kn.get(1,1),Na=(Un+fa)*(vs+Qa),nl=(la+fa)*vs,ll=Un*(aa-Qa),tl=fa*(ua-vs),sl=(Un+bs)*Qa,bl=(la-Un)*(vs+aa),Ua=(bs-fa)*(ua+Qa),ul=Na+tl-sl+Ua,_l=ll+sl,jl=nl+tl,Yl=Na-nl+ll+bl;return qn.set(0,0,ul),qn.set(0,1,_l),qn.set(1,0,jl),qn.set(1,1,Yl),qn}strassen3x3(Kn){Kn=Ja.checkMatrix(Kn);let qn=new Ja(3,3);const Un=this.get(0,0),vs=this.get(0,1),bs=this.get(0,2),aa=this.get(1,0),la=this.get(1,1),ua=this.get(1,2),fa=this.get(2,0),Qa=this.get(2,1),Na=this.get(2,2),nl=Kn.get(0,0),ll=Kn.get(0,1),tl=Kn.get(0,2),sl=Kn.get(1,0),bl=Kn.get(1,1),Ua=Kn.get(1,2),ul=Kn.get(2,0),_l=Kn.get(2,1),jl=Kn.get(2,2),Yl=(Un+vs+bs-aa-la-Qa-Na)*bl,vh=(Un-aa)*(-ll+bl),$l=la*(-nl+ll+sl-bl-Ua-ul+jl),Fl=(-Un+aa+la)*(nl-ll+bl),wh=(aa+la)*(-nl+ll),Za=Un*nl,hl=(-Un+fa+Qa)*(nl-tl+Ua),Sl=(-Un+fa)*(tl-Ua),gl=(fa+Qa)*(-nl+tl),Ch=(Un+vs+bs-la-ua-fa-Qa)*Ua,xh=Qa*(-nl+tl+sl-bl-Ua-ul+_l),bh=(-bs+Qa+Na)*(bl+ul-_l),Th=(bs-Na)*(bl-_l),Ah=bs*ul,jh=(Qa+Na)*(-ul+_l),Mh=(-bs+la+ua)*(Ua+ul-jl),Yh=(bs-ua)*(Ua-jl),Gh=(la+ua)*(-ul+jl),Jl=vs*sl,Ph=ua*_l,Bh=aa*tl,Lh=fa*ll,kh=Na*jl,ic=Za+Ah+Jl,nc=Yl+Fl+wh+Za+bh+Ah+jh,sc=Za+hl+gl+Ch+Ah+Mh+Gh,oc=vh+$l+Fl+Za+Ah+Mh+Yh,ac=vh+Fl+wh+Za+Ph,lc=Ah+Mh+Yh+Gh+Bh,hc=Za+hl+Sl+xh+bh+Th+Ah,cc=bh+Th+Ah+jh+Lh,uc=Za+hl+Sl+gl+kh;return qn.set(0,0,ic),qn.set(0,1,nc),qn.set(0,2,sc),qn.set(1,0,oc),qn.set(1,1,ac),qn.set(1,2,lc),qn.set(2,0,hc),qn.set(2,1,cc),qn.set(2,2,uc),qn}mmulStrassen(Kn){Kn=Ja.checkMatrix(Kn);let qn=this.clone(),Un=qn.rows,vs=qn.columns,bs=Kn.rows,aa=Kn.columns;vs!==bs&&console.warn(`Multiplying ${Un} x ${vs} and ${bs} x ${aa} matrix: dimensions do not match.`);function la(Na,nl,ll){let tl=Na.rows,sl=Na.columns;if(tl===nl&&sl===ll)return Na;{let bl=el.zeros(nl,ll);return bl=bl.setSubMatrix(Na,0,0),bl}}let ua=Math.max(Un,bs),fa=Math.max(vs,aa);qn=la(qn,ua,fa),Kn=la(Kn,ua,fa);function Qa(Na,nl,ll,tl){if(ll<=512||tl<=512)return Na.mmul(nl);ll%2===1&&tl%2===1?(Na=la(Na,ll+1,tl+1),nl=la(nl,ll+1,tl+1)):ll%2===1?(Na=la(Na,ll+1,tl),nl=la(nl,ll+1,tl)):tl%2===1&&(Na=la(Na,ll,tl+1),nl=la(nl,ll,tl+1));let sl=parseInt(Na.rows/2,10),bl=parseInt(Na.columns/2,10),Ua=Na.subMatrix(0,sl-1,0,bl-1),ul=nl.subMatrix(0,sl-1,0,bl-1),_l=Na.subMatrix(0,sl-1,bl,Na.columns-1),jl=nl.subMatrix(0,sl-1,bl,nl.columns-1),Yl=Na.subMatrix(sl,Na.rows-1,0,bl-1),vh=nl.subMatrix(sl,nl.rows-1,0,bl-1),$l=Na.subMatrix(sl,Na.rows-1,bl,Na.columns-1),Fl=nl.subMatrix(sl,nl.rows-1,bl,nl.columns-1),wh=Qa(el.add(Ua,$l),el.add(ul,Fl),sl,bl),Za=Qa(el.add(Yl,$l),ul,sl,bl),hl=Qa(Ua,el.sub(jl,Fl),sl,bl),Sl=Qa($l,el.sub(vh,ul),sl,bl),gl=Qa(el.add(Ua,_l),Fl,sl,bl),Ch=Qa(el.sub(Yl,Ua),el.add(ul,jl),sl,bl),xh=Qa(el.sub(_l,$l),el.add(vh,Fl),sl,bl),bh=el.add(wh,Sl);bh.sub(gl),bh.add(xh);let Th=el.add(hl,gl),Ah=el.add(Za,Sl),jh=el.sub(wh,Za);jh.add(hl),jh.add(Ch);let Mh=el.zeros(2*bh.rows,2*bh.columns);return Mh=Mh.setSubMatrix(bh,0,0),Mh=Mh.setSubMatrix(Th,bh.rows,0),Mh=Mh.setSubMatrix(Ah,0,bh.columns),Mh=Mh.setSubMatrix(jh,bh.rows,bh.columns),Mh.subMatrix(0,ll-1,0,tl-1)}return Qa(qn,Kn,ua,fa)}scaleRows(Kn={}){if(typeof Kn!="object")throw new TypeError("options must be an object");const{min:qn=0,max:Un=1}=Kn;if(!Number.isFinite(qn))throw new TypeError("min must be a number");if(!Number.isFinite(Un))throw new TypeError("max must be a number");if(qn>=Un)throw new RangeError("min must be smaller than max");let vs=new Ja(this.rows,this.columns);for(let bs=0;bs<this.rows;bs++){const aa=this.getRow(bs);aa.length>0&&f(aa,{min:qn,max:Un,output:aa}),vs.setRow(bs,aa)}return vs}scaleColumns(Kn={}){if(typeof Kn!="object")throw new TypeError("options must be an object");const{min:qn=0,max:Un=1}=Kn;if(!Number.isFinite(qn))throw new TypeError("min must be a number");if(!Number.isFinite(Un))throw new TypeError("max must be a number");if(qn>=Un)throw new RangeError("min must be smaller than max");let vs=new Ja(this.rows,this.columns);for(let bs=0;bs<this.columns;bs++){const aa=this.getColumn(bs);aa.length&&f(aa,{min:qn,max:Un,output:aa}),vs.setColumn(bs,aa)}return vs}flipRows(){const Kn=Math.ceil(this.columns/2);for(let qn=0;qn<this.rows;qn++)for(let Un=0;Un<Kn;Un++){let vs=this.get(qn,Un),bs=this.get(qn,this.columns-1-Un);this.set(qn,Un,bs),this.set(qn,this.columns-1-Un,vs)}return this}flipColumns(){const Kn=Math.ceil(this.rows/2);for(let qn=0;qn<this.columns;qn++)for(let Un=0;Un<Kn;Un++){let vs=this.get(Un,qn),bs=this.get(this.rows-1-Un,qn);this.set(Un,qn,bs),this.set(this.rows-1-Un,qn,vs)}return this}kroneckerProduct(Kn){Kn=Ja.checkMatrix(Kn);let qn=this.rows,Un=this.columns,vs=Kn.rows,bs=Kn.columns,aa=new Ja(qn*vs,Un*bs);for(let la=0;la<qn;la++)for(let ua=0;ua<Un;ua++)for(let fa=0;fa<vs;fa++)for(let Qa=0;Qa<bs;Qa++)aa.set(vs*la+fa,bs*ua+Qa,this.get(la,ua)*Kn.get(fa,Qa));return aa}kroneckerSum(Kn){if(Kn=Ja.checkMatrix(Kn),!this.isSquare()||!Kn.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let qn=this.rows,Un=Kn.rows,vs=this.kroneckerProduct(Ja.eye(Un,Un)),bs=Ja.eye(qn,qn).kroneckerProduct(Kn);return vs.add(bs)}transpose(){let Kn=new Ja(this.columns,this.rows);for(let qn=0;qn<this.rows;qn++)for(let Un=0;Un<this.columns;Un++)Kn.set(Un,qn,this.get(qn,Un));return Kn}sortRows(Kn=dl){for(let qn=0;qn<this.rows;qn++)this.setRow(qn,this.getRow(qn).sort(Kn));return this}sortColumns(Kn=dl){for(let qn=0;qn<this.columns;qn++)this.setColumn(qn,this.getColumn(qn).sort(Kn));return this}subMatrix(Kn,qn,Un,vs){ea(this,Kn,qn,Un,vs);let bs=new Ja(qn-Kn+1,vs-Un+1);for(let aa=Kn;aa<=qn;aa++)for(let la=Un;la<=vs;la++)bs.set(aa-Kn,la-Un,this.get(aa,la));return bs}subMatrixRow(Kn,qn,Un){if(qn===void 0&&(qn=0),Un===void 0&&(Un=this.columns-1),qn>Un||qn<0||qn>=this.columns||Un<0||Un>=this.columns)throw new RangeError("Argument out of range");let vs=new Ja(Kn.length,Un-qn+1);for(let bs=0;bs<Kn.length;bs++)for(let aa=qn;aa<=Un;aa++){if(Kn[bs]<0||Kn[bs]>=this.rows)throw new RangeError(`Row index out of range: ${Kn[bs]}`);vs.set(bs,aa-qn,this.get(Kn[bs],aa))}return vs}subMatrixColumn(Kn,qn,Un){if(qn===void 0&&(qn=0),Un===void 0&&(Un=this.rows-1),qn>Un||qn<0||qn>=this.rows||Un<0||Un>=this.rows)throw new RangeError("Argument out of range");let vs=new Ja(Un-qn+1,Kn.length);for(let bs=0;bs<Kn.length;bs++)for(let aa=qn;aa<=Un;aa++){if(Kn[bs]<0||Kn[bs]>=this.columns)throw new RangeError(`Column index out of range: ${Kn[bs]}`);vs.set(aa-qn,bs,this.get(aa,Kn[bs]))}return vs}setSubMatrix(Kn,qn,Un){if(Kn=Ja.checkMatrix(Kn),Kn.isEmpty())return this;let vs=qn+Kn.rows-1,bs=Un+Kn.columns-1;ea(this,qn,vs,Un,bs);for(let aa=0;aa<Kn.rows;aa++)for(let la=0;la<Kn.columns;la++)this.set(qn+aa,Un+la,Kn.get(aa,la));return this}selection(Kn,qn){ys(this,Kn),Jo(this,qn);let Un=new Ja(Kn.length,qn.length);for(let vs=0;vs<Kn.length;vs++){let bs=Kn[vs];for(let aa=0;aa<qn.length;aa++){let la=qn[aa];Un.set(vs,aa,this.get(bs,la))}}return Un}trace(){let Kn=Math.min(this.rows,this.columns),qn=0;for(let Un=0;Un<Kn;Un++)qn+=this.get(Un,Un);return qn}clone(){return this.constructor.copy(this,new Ja(this.rows,this.columns))}static copy(Kn,qn){for(const[Un,vs,bs]of Kn.entries())qn.set(Un,vs,bs);return qn}sum(Kn){switch(Kn){case"row":return ia(this);case"column":return sa(this);case void 0:return Ma(this);default:throw new Error(`invalid option: ${Kn}`)}}product(Kn){switch(Kn){case"row":return pa(this);case"column":return oa(this);case void 0:return ha(this);default:throw new Error(`invalid option: ${Kn}`)}}mean(Kn){const qn=this.sum(Kn);switch(Kn){case"row":{for(let Un=0;Un<this.rows;Un++)qn[Un]/=this.columns;return qn}case"column":{for(let Un=0;Un<this.columns;Un++)qn[Un]/=this.rows;return qn}case void 0:return qn/this.size;default:throw new Error(`invalid option: ${Kn}`)}}variance(Kn,qn={}){if(typeof Kn=="object"&&(qn=Kn,Kn=void 0),typeof qn!="object")throw new TypeError("options must be an object");const{unbiased:Un=!0,mean:vs=this.mean(Kn)}=qn;if(typeof Un!="boolean")throw new TypeError("unbiased must be a boolean");switch(Kn){case"row":{if(!qe.isAnyArray(vs))throw new TypeError("mean must be an array");return ca(this,Un,vs)}case"column":{if(!qe.isAnyArray(vs))throw new TypeError("mean must be an array");return da(this,Un,vs)}case void 0:{if(typeof vs!="number")throw new TypeError("mean must be a number");return ga(this,Un,vs)}default:throw new Error(`invalid option: ${Kn}`)}}standardDeviation(Kn,qn){typeof Kn=="object"&&(qn=Kn,Kn=void 0);const Un=this.variance(Kn,qn);if(Kn===void 0)return Math.sqrt(Un);for(let vs=0;vs<Un.length;vs++)Un[vs]=Math.sqrt(Un[vs]);return Un}center(Kn,qn={}){if(typeof Kn=="object"&&(qn=Kn,Kn=void 0),typeof qn!="object")throw new TypeError("options must be an object");const{center:Un=this.mean(Kn)}=qn;switch(Kn){case"row":{if(!qe.isAnyArray(Un))throw new TypeError("center must be an array");return qa(this,Un),this}case"column":{if(!qe.isAnyArray(Un))throw new TypeError("center must be an array");return Ka(this,Un),this}case void 0:{if(typeof Un!="number")throw new TypeError("center must be a number");return il(this,Un),this}default:throw new Error(`invalid option: ${Kn}`)}}scale(Kn,qn={}){if(typeof Kn=="object"&&(qn=Kn,Kn=void 0),typeof qn!="object")throw new TypeError("options must be an object");let Un=qn.scale;switch(Kn){case"row":{if(Un===void 0)Un=cl(this);else if(!qe.isAnyArray(Un))throw new TypeError("scale must be an array");return wl(this,Un),this}case"column":{if(Un===void 0)Un=al(this);else if(!qe.isAnyArray(Un))throw new TypeError("scale must be an array");return vl(this,Un),this}case void 0:{if(Un===void 0)Un=ml(this);else if(typeof Un!="number")throw new TypeError("scale must be a number");return ol(this,Un),this}default:throw new Error(`invalid option: ${Kn}`)}}toString(Kn){return Pi(this,Kn)}[Symbol.iterator](){return this.entries()}*entries(){for(let Kn=0;Kn<this.rows;Kn++)for(let qn=0;qn<this.columns;qn++)yield[Kn,qn,this.get(Kn,qn)]}*values(){for(let Kn=0;Kn<this.rows;Kn++)for(let qn=0;qn<this.columns;qn++)yield this.get(Kn,qn)}}el.prototype.klass="Matrix",typeof Symbol<"u"&&(el.prototype[Symbol.for("nodejs.util.inspect.custom")]=Qe);function dl(Cs,Kn){return Cs-Kn}function xl(Cs){return Cs.every(Kn=>typeof Kn=="number")}el.random=el.rand,el.randomInt=el.randInt,el.diagonal=el.diag,el.prototype.diagonal=el.prototype.diag,el.identity=el.eye,el.prototype.negate=el.prototype.neg,el.prototype.tensorProduct=el.prototype.kroneckerProduct;const Ih=class Ih extends el{constructor(qn,Un){super();Zh(this,Fh);yh(this,"data");if(Ih.isMatrix(qn))Qh(this,Fh,Jh).call(this,qn.rows,qn.columns),Ih.copy(qn,this);else if(Number.isInteger(qn)&&qn>=0)Qh(this,Fh,Jh).call(this,qn,Un);else if(qe.isAnyArray(qn)){const vs=qn;if(qn=vs.length,Un=qn?vs[0].length:0,typeof Un!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let bs=0;bs<qn;bs++){if(vs[bs].length!==Un)throw new RangeError("Inconsistent array dimensions");if(!xl(vs[bs]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(vs[bs]))}this.rows=qn,this.columns=Un}else throw new TypeError("First argument must be a positive number or an array")}set(qn,Un,vs){return this.data[qn][Un]=vs,this}get(qn,Un){return this.data[qn][Un]}removeRow(qn){return un(this,qn),this.data.splice(qn,1),this.rows-=1,this}addRow(qn,Un){return Un===void 0&&(Un=qn,qn=this.rows),un(this,qn,!0),Un=Float64Array.from(zn(this,Un)),this.data.splice(qn,0,Un),this.rows+=1,this}removeColumn(qn){xs(this,qn);for(let Un=0;Un<this.rows;Un++){const vs=new Float64Array(this.columns-1);for(let bs=0;bs<qn;bs++)vs[bs]=this.data[Un][bs];for(let bs=qn+1;bs<this.columns;bs++)vs[bs-1]=this.data[Un][bs];this.data[Un]=vs}return this.columns-=1,this}addColumn(qn,Un){typeof Un>"u"&&(Un=qn,qn=this.columns),xs(this,qn,!0),Un=Xn(this,Un);for(let vs=0;vs<this.rows;vs++){const bs=new Float64Array(this.columns+1);let aa=0;for(;aa<qn;aa++)bs[aa]=this.data[vs][aa];for(bs[aa++]=Un[vs];aa<this.columns+1;aa++)bs[aa]=this.data[vs][aa-1];this.data[vs]=bs}return this.columns+=1,this}};Fh=new WeakSet,Jh=function(qn,Un){if(this.data=[],Number.isInteger(Un)&&Un>=0)for(let vs=0;vs<qn;vs++)this.data.push(new Float64Array(Un));else throw new TypeError("nColumns must be a positive integer");this.rows=qn,this.columns=Un};let Ja=Ih;hn(el,Ja);const Nh=class Nh extends el{constructor(qn){super();Zh(this,Sh);if(Ja.isMatrix(qn)){if(!qn.isSymmetric())throw new TypeError("not symmetric data");Hh(this,Sh,Ja.copy(qn,new Ja(qn.rows,qn.rows)))}else if(Number.isInteger(qn)&&qn>=0)Hh(this,Sh,new Ja(qn,qn));else if(Hh(this,Sh,new Ja(qn)),!this.isSymmetric())throw new TypeError("not symmetric data")}get size(){return Uh(this,Sh).size}get rows(){return Uh(this,Sh).rows}get columns(){return Uh(this,Sh).columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(qn){return Ja.isMatrix(qn)&&qn.klassType==="SymmetricMatrix"}static zeros(qn){return new this(qn)}static ones(qn){return new this(qn).fill(1)}clone(){const qn=new Nh(this.diagonalSize);for(const[Un,vs,bs]of this.upperRightEntries())qn.set(Un,vs,bs);return qn}toMatrix(){return new Ja(this)}get(qn,Un){return Uh(this,Sh).get(qn,Un)}set(qn,Un,vs){return Uh(this,Sh).set(qn,Un,vs),Uh(this,Sh).set(Un,qn,vs),this}removeCross(qn){return Uh(this,Sh).removeRow(qn),Uh(this,Sh).removeColumn(qn),this}addCross(qn,Un){Un===void 0&&(Un=qn,qn=this.diagonalSize);const vs=Un.slice();return vs.splice(qn,1),Uh(this,Sh).addRow(qn,vs),Uh(this,Sh).addColumn(qn,Un),this}applyMask(qn){if(qn.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const Un=[];for(const[vs,bs]of qn.entries())bs||Un.push(vs);Un.reverse();for(const vs of Un)this.removeCross(vs);return this}toCompact(){const{diagonalSize:qn}=this,Un=new Array(qn*(qn+1)/2);for(let vs=0,bs=0,aa=0;aa<Un.length;aa++)Un[aa]=this.get(bs,vs),++vs>=qn&&(vs=++bs);return Un}static fromCompact(qn){const Un=qn.length,vs=(Math.sqrt(8*Un+1)-1)/2;if(!Number.isInteger(vs))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(qn)}`);const bs=new Nh(vs);for(let aa=0,la=0,ua=0;ua<Un;ua++)bs.set(aa,la,qn[ua]),++aa>=vs&&(aa=++la);return bs}*upperRightEntries(){for(let qn=0,Un=0;qn<this.diagonalSize;void 0){const vs=this.get(qn,Un);yield[qn,Un,vs],++Un>=this.diagonalSize&&(Un=++qn)}}*upperRightValues(){for(let qn=0,Un=0;qn<this.diagonalSize;void 0)yield this.get(qn,Un),++Un>=this.diagonalSize&&(Un=++qn)}};Sh=new WeakMap;let yl=Nh;yl.prototype.klassType="SymmetricMatrix";class Ol extends yl{static isDistanceMatrix(Kn){return yl.isSymmetricMatrix(Kn)&&Kn.klassSubType==="DistanceMatrix"}constructor(Kn){if(super(Kn),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(Kn,qn,Un){return Kn===qn&&(Un=0),super.set(Kn,qn,Un)}addCross(Kn,qn){return qn===void 0&&(qn=Kn,Kn=this.diagonalSize),qn=qn.slice(),qn[Kn]=0,super.addCross(Kn,qn)}toSymmetricMatrix(){return new yl(this)}clone(){const Kn=new Ol(this.diagonalSize);for(const[qn,Un,vs]of this.upperRightEntries())qn!==Un&&Kn.set(qn,Un,vs);return Kn}toCompact(){const{diagonalSize:Kn}=this,qn=(Kn-1)*Kn/2,Un=new Array(qn);for(let vs=1,bs=0,aa=0;aa<Un.length;aa++)Un[aa]=this.get(bs,vs),++vs>=Kn&&(vs=++bs+1);return Un}static fromCompact(Kn){const qn=Kn.length;if(qn===0)return new this(0);const Un=(Math.sqrt(8*qn+1)+1)/2;if(!Number.isInteger(Un))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(Kn)}`);const vs=new this(Un);for(let bs=1,aa=0,la=0;la<qn;la++)vs.set(bs,aa,Kn[la]),++bs>=Un&&(bs=++aa+1);return vs}}Ol.prototype.klassSubType="DistanceMatrix";class Il extends el{constructor(Kn,qn,Un){super(),this.matrix=Kn,this.rows=qn,this.columns=Un}}class Rl extends Il{constructor(Kn,qn){xs(Kn,qn),super(Kn,Kn.rows,1),this.column=qn}set(Kn,qn,Un){return this.matrix.set(Kn,this.column,Un),this}get(Kn){return this.matrix.get(Kn,this.column)}}class Al extends Il{constructor(Kn,qn){Jo(Kn,qn),super(Kn,Kn.rows,qn.length),this.columnIndices=qn}set(Kn,qn,Un){return this.matrix.set(Kn,this.columnIndices[qn],Un),this}get(Kn,qn){return this.matrix.get(Kn,this.columnIndices[qn])}}class zl extends Il{constructor(Kn){super(Kn,Kn.rows,Kn.columns)}set(Kn,qn,Un){return this.matrix.set(Kn,this.columns-qn-1,Un),this}get(Kn,qn){return this.matrix.get(Kn,this.columns-qn-1)}}class Ql extends Il{constructor(Kn){super(Kn,Kn.rows,Kn.columns)}set(Kn,qn,Un){return this.matrix.set(this.rows-Kn-1,qn,Un),this}get(Kn,qn){return this.matrix.get(this.rows-Kn-1,qn)}}class Xl extends Il{constructor(Kn,qn){un(Kn,qn),super(Kn,1,Kn.columns),this.row=qn}set(Kn,qn,Un){return this.matrix.set(this.row,qn,Un),this}get(Kn,qn){return this.matrix.get(this.row,qn)}}class Tl extends Il{constructor(Kn,qn){ys(Kn,qn),super(Kn,qn.length,Kn.columns),this.rowIndices=qn}set(Kn,qn,Un){return this.matrix.set(this.rowIndices[Kn],qn,Un),this}get(Kn,qn){return this.matrix.get(this.rowIndices[Kn],qn)}}class pl extends Il{constructor(Kn,qn,Un){ys(Kn,qn),Jo(Kn,Un),super(Kn,qn.length,Un.length),this.rowIndices=qn,this.columnIndices=Un}set(Kn,qn,Un){return this.matrix.set(this.rowIndices[Kn],this.columnIndices[qn],Un),this}get(Kn,qn){return this.matrix.get(this.rowIndices[Kn],this.columnIndices[qn])}}class Hl extends Il{constructor(Kn,qn,Un,vs,bs){ea(Kn,qn,Un,vs,bs),super(Kn,Un-qn+1,bs-vs+1),this.startRow=qn,this.startColumn=vs}set(Kn,qn,Un){return this.matrix.set(this.startRow+Kn,this.startColumn+qn,Un),this}get(Kn,qn){return this.matrix.get(this.startRow+Kn,this.startColumn+qn)}}class Ll extends Il{constructor(Kn){super(Kn,Kn.columns,Kn.rows)}set(Kn,qn,Un){return this.matrix.set(qn,Kn,Un),this}get(Kn,qn){return this.matrix.get(qn,Kn)}}class Vl extends el{constructor(Kn,qn={}){const{rows:Un=1}=qn;if(Kn.length%Un!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=Un,this.columns=Kn.length/Un,this.data=Kn}set(Kn,qn,Un){let vs=this._calculateIndex(Kn,qn);return this.data[vs]=Un,this}get(Kn,qn){let Un=this._calculateIndex(Kn,qn);return this.data[Un]}_calculateIndex(Kn,qn){return Kn*this.columns+qn}}class rl extends el{constructor(Kn){super(),this.data=Kn,this.rows=Kn.length,this.columns=Kn[0].length}set(Kn,qn,Un){return this.data[Kn][qn]=Un,this}get(Kn,qn){return this.data[Kn][qn]}}function Pl(Cs,Kn){if(qe.isAnyArray(Cs))return Cs[0]&&qe.isAnyArray(Cs[0])?new rl(Cs):new Vl(Cs,Kn);throw new Error("the argument is not an array")}class kl{constructor(Kn){Kn=rl.checkMatrix(Kn);let qn=Kn.clone(),Un=qn.rows,vs=qn.columns,bs=new Float64Array(Un),aa=1,la,ua,fa,Qa,Na,nl,ll,tl,sl;for(la=0;la<Un;la++)bs[la]=la;for(tl=new Float64Array(Un),ua=0;ua<vs;ua++){for(la=0;la<Un;la++)tl[la]=qn.get(la,ua);for(la=0;la<Un;la++){for(sl=Math.min(la,ua),Na=0,fa=0;fa<sl;fa++)Na+=qn.get(la,fa)*tl[fa];tl[la]-=Na,qn.set(la,ua,tl[la])}for(Qa=ua,la=ua+1;la<Un;la++)Math.abs(tl[la])>Math.abs(tl[Qa])&&(Qa=la);if(Qa!==ua){for(fa=0;fa<vs;fa++)nl=qn.get(Qa,fa),qn.set(Qa,fa,qn.get(ua,fa)),qn.set(ua,fa,nl);ll=bs[Qa],bs[Qa]=bs[ua],bs[ua]=ll,aa=-aa}if(ua<Un&&qn.get(ua,ua)!==0)for(la=ua+1;la<Un;la++)qn.set(la,ua,qn.get(la,ua)/qn.get(ua,ua))}this.LU=qn,this.pivotVector=bs,this.pivotSign=aa}isSingular(){let Kn=this.LU,qn=Kn.columns;for(let Un=0;Un<qn;Un++)if(Kn.get(Un,Un)===0)return!0;return!1}solve(Kn){Kn=Ja.checkMatrix(Kn);let qn=this.LU;if(qn.rows!==Kn.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let vs=Kn.columns,bs=Kn.subMatrixRow(this.pivotVector,0,vs-1),aa=qn.columns,la,ua,fa;for(fa=0;fa<aa;fa++)for(la=fa+1;la<aa;la++)for(ua=0;ua<vs;ua++)bs.set(la,ua,bs.get(la,ua)-bs.get(fa,ua)*qn.get(la,fa));for(fa=aa-1;fa>=0;fa--){for(ua=0;ua<vs;ua++)bs.set(fa,ua,bs.get(fa,ua)/qn.get(fa,fa));for(la=0;la<fa;la++)for(ua=0;ua<vs;ua++)bs.set(la,ua,bs.get(la,ua)-bs.get(fa,ua)*qn.get(la,fa))}return bs}get determinant(){let Kn=this.LU;if(!Kn.isSquare())throw new Error("Matrix must be square");let qn=this.pivotSign,Un=Kn.columns;for(let vs=0;vs<Un;vs++)qn*=Kn.get(vs,vs);return qn}get lowerTriangularMatrix(){let Kn=this.LU,qn=Kn.rows,Un=Kn.columns,vs=new Ja(qn,Un);for(let bs=0;bs<qn;bs++)for(let aa=0;aa<Un;aa++)bs>aa?vs.set(bs,aa,Kn.get(bs,aa)):bs===aa?vs.set(bs,aa,1):vs.set(bs,aa,0);return vs}get upperTriangularMatrix(){let Kn=this.LU,qn=Kn.rows,Un=Kn.columns,vs=new Ja(qn,Un);for(let bs=0;bs<qn;bs++)for(let aa=0;aa<Un;aa++)bs<=aa?vs.set(bs,aa,Kn.get(bs,aa)):vs.set(bs,aa,0);return vs}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function Dl(Cs,Kn){let qn=0;return Math.abs(Cs)>Math.abs(Kn)?(qn=Kn/Cs,Math.abs(Cs)*Math.sqrt(1+qn*qn)):Kn!==0?(qn=Cs/Kn,Math.abs(Kn)*Math.sqrt(1+qn*qn)):0}class fl{constructor(Kn){Kn=rl.checkMatrix(Kn);let qn=Kn.clone(),Un=Kn.rows,vs=Kn.columns,bs=new Float64Array(vs),aa,la,ua,fa;for(ua=0;ua<vs;ua++){let Qa=0;for(aa=ua;aa<Un;aa++)Qa=Dl(Qa,qn.get(aa,ua));if(Qa!==0){for(qn.get(ua,ua)<0&&(Qa=-Qa),aa=ua;aa<Un;aa++)qn.set(aa,ua,qn.get(aa,ua)/Qa);for(qn.set(ua,ua,qn.get(ua,ua)+1),la=ua+1;la<vs;la++){for(fa=0,aa=ua;aa<Un;aa++)fa+=qn.get(aa,ua)*qn.get(aa,la);for(fa=-fa/qn.get(ua,ua),aa=ua;aa<Un;aa++)qn.set(aa,la,qn.get(aa,la)+fa*qn.get(aa,ua))}}bs[ua]=-Qa}this.QR=qn,this.Rdiag=bs}solve(Kn){Kn=Ja.checkMatrix(Kn);let qn=this.QR,Un=qn.rows;if(Kn.rows!==Un)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let vs=Kn.columns,bs=Kn.clone(),aa=qn.columns,la,ua,fa,Qa;for(fa=0;fa<aa;fa++)for(ua=0;ua<vs;ua++){for(Qa=0,la=fa;la<Un;la++)Qa+=qn.get(la,fa)*bs.get(la,ua);for(Qa=-Qa/qn.get(fa,fa),la=fa;la<Un;la++)bs.set(la,ua,bs.get(la,ua)+Qa*qn.get(la,fa))}for(fa=aa-1;fa>=0;fa--){for(ua=0;ua<vs;ua++)bs.set(fa,ua,bs.get(fa,ua)/this.Rdiag[fa]);for(la=0;la<fa;la++)for(ua=0;ua<vs;ua++)bs.set(la,ua,bs.get(la,ua)-bs.get(fa,ua)*qn.get(la,fa))}return bs.subMatrix(0,aa-1,0,vs-1)}isFullRank(){let Kn=this.QR.columns;for(let qn=0;qn<Kn;qn++)if(this.Rdiag[qn]===0)return!1;return!0}get upperTriangularMatrix(){let Kn=this.QR,qn=Kn.columns,Un=new Ja(qn,qn),vs,bs;for(vs=0;vs<qn;vs++)for(bs=0;bs<qn;bs++)vs<bs?Un.set(vs,bs,Kn.get(vs,bs)):vs===bs?Un.set(vs,bs,this.Rdiag[vs]):Un.set(vs,bs,0);return Un}get orthogonalMatrix(){let Kn=this.QR,qn=Kn.rows,Un=Kn.columns,vs=new Ja(qn,Un),bs,aa,la,ua;for(la=Un-1;la>=0;la--){for(bs=0;bs<qn;bs++)vs.set(bs,la,0);for(vs.set(la,la,1),aa=la;aa<Un;aa++)if(Kn.get(la,la)!==0){for(ua=0,bs=la;bs<qn;bs++)ua+=Kn.get(bs,la)*vs.get(bs,aa);for(ua=-ua/Kn.get(la,la),bs=la;bs<qn;bs++)vs.set(bs,aa,vs.get(bs,aa)+ua*Kn.get(bs,la))}}return vs}}class Gl{constructor(Kn,qn={}){if(Kn=rl.checkMatrix(Kn),Kn.isEmpty())throw new Error("Matrix must be non-empty");let Un=Kn.rows,vs=Kn.columns;const{computeLeftSingularVectors:bs=!0,computeRightSingularVectors:aa=!0,autoTranspose:la=!1}=qn;let ua=!!bs,fa=!!aa,Qa=!1,Na;if(Un<vs)if(!la)Na=Kn.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{Na=Kn.transpose(),Un=Na.rows,vs=Na.columns,Qa=!0;let Za=ua;ua=fa,fa=Za}else Na=Kn.clone();let nl=Math.min(Un,vs),ll=Math.min(Un+1,vs),tl=new Float64Array(ll),sl=new Ja(Un,nl),bl=new Ja(vs,vs),Ua=new Float64Array(vs),ul=new Float64Array(Un),_l=new Float64Array(ll);for(let Za=0;Za<ll;Za++)_l[Za]=Za;let jl=Math.min(Un-1,vs),Yl=Math.max(0,Math.min(vs-2,Un)),vh=Math.max(jl,Yl);for(let Za=0;Za<vh;Za++){if(Za<jl){tl[Za]=0;for(let hl=Za;hl<Un;hl++)tl[Za]=Dl(tl[Za],Na.get(hl,Za));if(tl[Za]!==0){Na.get(Za,Za)<0&&(tl[Za]=-tl[Za]);for(let hl=Za;hl<Un;hl++)Na.set(hl,Za,Na.get(hl,Za)/tl[Za]);Na.set(Za,Za,Na.get(Za,Za)+1)}tl[Za]=-tl[Za]}for(let hl=Za+1;hl<vs;hl++){if(Za<jl&&tl[Za]!==0){let Sl=0;for(let gl=Za;gl<Un;gl++)Sl+=Na.get(gl,Za)*Na.get(gl,hl);Sl=-Sl/Na.get(Za,Za);for(let gl=Za;gl<Un;gl++)Na.set(gl,hl,Na.get(gl,hl)+Sl*Na.get(gl,Za))}Ua[hl]=Na.get(Za,hl)}if(ua&&Za<jl)for(let hl=Za;hl<Un;hl++)sl.set(hl,Za,Na.get(hl,Za));if(Za<Yl){Ua[Za]=0;for(let hl=Za+1;hl<vs;hl++)Ua[Za]=Dl(Ua[Za],Ua[hl]);if(Ua[Za]!==0){Ua[Za+1]<0&&(Ua[Za]=0-Ua[Za]);for(let hl=Za+1;hl<vs;hl++)Ua[hl]/=Ua[Za];Ua[Za+1]+=1}if(Ua[Za]=-Ua[Za],Za+1<Un&&Ua[Za]!==0){for(let hl=Za+1;hl<Un;hl++)ul[hl]=0;for(let hl=Za+1;hl<Un;hl++)for(let Sl=Za+1;Sl<vs;Sl++)ul[hl]+=Ua[Sl]*Na.get(hl,Sl);for(let hl=Za+1;hl<vs;hl++){let Sl=-Ua[hl]/Ua[Za+1];for(let gl=Za+1;gl<Un;gl++)Na.set(gl,hl,Na.get(gl,hl)+Sl*ul[gl])}}if(fa)for(let hl=Za+1;hl<vs;hl++)bl.set(hl,Za,Ua[hl])}}let $l=Math.min(vs,Un+1);if(jl<vs&&(tl[jl]=Na.get(jl,jl)),Un<$l&&(tl[$l-1]=0),Yl+1<$l&&(Ua[Yl]=Na.get(Yl,$l-1)),Ua[$l-1]=0,ua){for(let Za=jl;Za<nl;Za++){for(let hl=0;hl<Un;hl++)sl.set(hl,Za,0);sl.set(Za,Za,1)}for(let Za=jl-1;Za>=0;Za--)if(tl[Za]!==0){for(let hl=Za+1;hl<nl;hl++){let Sl=0;for(let gl=Za;gl<Un;gl++)Sl+=sl.get(gl,Za)*sl.get(gl,hl);Sl=-Sl/sl.get(Za,Za);for(let gl=Za;gl<Un;gl++)sl.set(gl,hl,sl.get(gl,hl)+Sl*sl.get(gl,Za))}for(let hl=Za;hl<Un;hl++)sl.set(hl,Za,-sl.get(hl,Za));sl.set(Za,Za,1+sl.get(Za,Za));for(let hl=0;hl<Za-1;hl++)sl.set(hl,Za,0)}else{for(let hl=0;hl<Un;hl++)sl.set(hl,Za,0);sl.set(Za,Za,1)}}if(fa)for(let Za=vs-1;Za>=0;Za--){if(Za<Yl&&Ua[Za]!==0)for(let hl=Za+1;hl<vs;hl++){let Sl=0;for(let gl=Za+1;gl<vs;gl++)Sl+=bl.get(gl,Za)*bl.get(gl,hl);Sl=-Sl/bl.get(Za+1,Za);for(let gl=Za+1;gl<vs;gl++)bl.set(gl,hl,bl.get(gl,hl)+Sl*bl.get(gl,Za))}for(let hl=0;hl<vs;hl++)bl.set(hl,Za,0);bl.set(Za,Za,1)}let Fl=$l-1,wh=Number.EPSILON;for(;$l>0;){let Za,hl;for(Za=$l-2;Za>=-1&&Za!==-1;Za--){const Sl=Number.MIN_VALUE+wh*Math.abs(tl[Za]+Math.abs(tl[Za+1]));if(Math.abs(Ua[Za])<=Sl||Number.isNaN(Ua[Za])){Ua[Za]=0;break}}if(Za===$l-2)hl=4;else{let Sl;for(Sl=$l-1;Sl>=Za&&Sl!==Za;Sl--){let gl=(Sl!==$l?Math.abs(Ua[Sl]):0)+(Sl!==Za+1?Math.abs(Ua[Sl-1]):0);if(Math.abs(tl[Sl])<=wh*gl){tl[Sl]=0;break}}Sl===Za?hl=3:Sl===$l-1?hl=1:(hl=2,Za=Sl)}switch(Za++,hl){case 1:{let Sl=Ua[$l-2];Ua[$l-2]=0;for(let gl=$l-2;gl>=Za;gl--){let Ch=Dl(tl[gl],Sl),xh=tl[gl]/Ch,bh=Sl/Ch;if(tl[gl]=Ch,gl!==Za&&(Sl=-bh*Ua[gl-1],Ua[gl-1]=xh*Ua[gl-1]),fa)for(let Th=0;Th<vs;Th++)Ch=xh*bl.get(Th,gl)+bh*bl.get(Th,$l-1),bl.set(Th,$l-1,-bh*bl.get(Th,gl)+xh*bl.get(Th,$l-1)),bl.set(Th,gl,Ch)}break}case 2:{let Sl=Ua[Za-1];Ua[Za-1]=0;for(let gl=Za;gl<$l;gl++){let Ch=Dl(tl[gl],Sl),xh=tl[gl]/Ch,bh=Sl/Ch;if(tl[gl]=Ch,Sl=-bh*Ua[gl],Ua[gl]=xh*Ua[gl],ua)for(let Th=0;Th<Un;Th++)Ch=xh*sl.get(Th,gl)+bh*sl.get(Th,Za-1),sl.set(Th,Za-1,-bh*sl.get(Th,gl)+xh*sl.get(Th,Za-1)),sl.set(Th,gl,Ch)}break}case 3:{const Sl=Math.max(Math.abs(tl[$l-1]),Math.abs(tl[$l-2]),Math.abs(Ua[$l-2]),Math.abs(tl[Za]),Math.abs(Ua[Za])),gl=tl[$l-1]/Sl,Ch=tl[$l-2]/Sl,xh=Ua[$l-2]/Sl,bh=tl[Za]/Sl,Th=Ua[Za]/Sl,Ah=((Ch+gl)*(Ch-gl)+xh*xh)/2,jh=gl*xh*(gl*xh);let Mh=0;(Ah!==0||jh!==0)&&(Ah<0?Mh=0-Math.sqrt(Ah*Ah+jh):Mh=Math.sqrt(Ah*Ah+jh),Mh=jh/(Ah+Mh));let Yh=(bh+gl)*(bh-gl)+Mh,Gh=bh*Th;for(let Jl=Za;Jl<$l-1;Jl++){let Ph=Dl(Yh,Gh);Ph===0&&(Ph=Number.MIN_VALUE);let Bh=Yh/Ph,Lh=Gh/Ph;if(Jl!==Za&&(Ua[Jl-1]=Ph),Yh=Bh*tl[Jl]+Lh*Ua[Jl],Ua[Jl]=Bh*Ua[Jl]-Lh*tl[Jl],Gh=Lh*tl[Jl+1],tl[Jl+1]=Bh*tl[Jl+1],fa)for(let kh=0;kh<vs;kh++)Ph=Bh*bl.get(kh,Jl)+Lh*bl.get(kh,Jl+1),bl.set(kh,Jl+1,-Lh*bl.get(kh,Jl)+Bh*bl.get(kh,Jl+1)),bl.set(kh,Jl,Ph);if(Ph=Dl(Yh,Gh),Ph===0&&(Ph=Number.MIN_VALUE),Bh=Yh/Ph,Lh=Gh/Ph,tl[Jl]=Ph,Yh=Bh*Ua[Jl]+Lh*tl[Jl+1],tl[Jl+1]=-Lh*Ua[Jl]+Bh*tl[Jl+1],Gh=Lh*Ua[Jl+1],Ua[Jl+1]=Bh*Ua[Jl+1],ua&&Jl<Un-1)for(let kh=0;kh<Un;kh++)Ph=Bh*sl.get(kh,Jl)+Lh*sl.get(kh,Jl+1),sl.set(kh,Jl+1,-Lh*sl.get(kh,Jl)+Bh*sl.get(kh,Jl+1)),sl.set(kh,Jl,Ph)}Ua[$l-2]=Yh;break}case 4:{if(tl[Za]<=0&&(tl[Za]=tl[Za]<0?-tl[Za]:0,fa))for(let Sl=0;Sl<=Fl;Sl++)bl.set(Sl,Za,-bl.get(Sl,Za));for(;Za<Fl&&!(tl[Za]>=tl[Za+1]);){let Sl=tl[Za];if(tl[Za]=tl[Za+1],tl[Za+1]=Sl,fa&&Za<vs-1)for(let gl=0;gl<vs;gl++)Sl=bl.get(gl,Za+1),bl.set(gl,Za+1,bl.get(gl,Za)),bl.set(gl,Za,Sl);if(ua&&Za<Un-1)for(let gl=0;gl<Un;gl++)Sl=sl.get(gl,Za+1),sl.set(gl,Za+1,sl.get(gl,Za)),sl.set(gl,Za,Sl);Za++}$l--;break}}}if(Qa){let Za=bl;bl=sl,sl=Za}this.m=Un,this.n=vs,this.s=tl,this.U=sl,this.V=bl}solve(Kn){let qn=Kn,Un=this.threshold,vs=this.s.length,bs=Ja.zeros(vs,vs);for(let nl=0;nl<vs;nl++)Math.abs(this.s[nl])<=Un?bs.set(nl,nl,0):bs.set(nl,nl,1/this.s[nl]);let aa=this.U,la=this.rightSingularVectors,ua=la.mmul(bs),fa=la.rows,Qa=aa.rows,Na=Ja.zeros(fa,Qa);for(let nl=0;nl<fa;nl++)for(let ll=0;ll<Qa;ll++){let tl=0;for(let sl=0;sl<vs;sl++)tl+=ua.get(nl,sl)*aa.get(ll,sl);Na.set(nl,ll,tl)}return Na.mmul(qn)}solveForDiagonal(Kn){return this.solve(Ja.diag(Kn))}inverse(){let Kn=this.V,qn=this.threshold,Un=Kn.rows,vs=Kn.columns,bs=new Ja(Un,this.s.length);for(let Qa=0;Qa<Un;Qa++)for(let Na=0;Na<vs;Na++)Math.abs(this.s[Na])>qn&&bs.set(Qa,Na,Kn.get(Qa,Na)/this.s[Na]);let aa=this.U,la=aa.rows,ua=aa.columns,fa=new Ja(Un,la);for(let Qa=0;Qa<Un;Qa++)for(let Na=0;Na<la;Na++){let nl=0;for(let ll=0;ll<ua;ll++)nl+=bs.get(Qa,ll)*aa.get(Na,ll);fa.set(Qa,Na,nl)}return fa}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let Kn=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,qn=0,Un=this.s;for(let vs=0,bs=Un.length;vs<bs;vs++)Un[vs]>Kn&&qn++;return qn}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return Ja.diag(this.s)}}function ql(Cs,Kn=!1){return Cs=rl.checkMatrix(Cs),Kn?new Gl(Cs).inverse():Cl(Cs,Ja.eye(Cs.rows))}function Cl(Cs,Kn,qn=!1){return Cs=rl.checkMatrix(Cs),Kn=rl.checkMatrix(Kn),qn?new Gl(Cs).solve(Kn):Cs.isSquare()?new kl(Cs).solve(Kn):new fl(Cs).solve(Kn)}function El(Cs){if(Cs=Ja.checkMatrix(Cs),Cs.isSquare()){if(Cs.columns===0)return 1;let Kn,qn,Un,vs;if(Cs.columns===2)return Kn=Cs.get(0,0),qn=Cs.get(0,1),Un=Cs.get(1,0),vs=Cs.get(1,1),Kn*vs-qn*Un;if(Cs.columns===3){let bs,aa,la;return bs=new pl(Cs,[1,2],[1,2]),aa=new pl(Cs,[1,2],[0,2]),la=new pl(Cs,[1,2],[0,1]),Kn=Cs.get(0,0),qn=Cs.get(0,1),Un=Cs.get(0,2),Kn*El(bs)-qn*El(aa)+Un*El(la)}else return new kl(Cs).determinant}else throw Error("determinant can only be calculated for a square matrix")}function Bl(Cs,Kn){let qn=[];for(let Un=0;Un<Cs;Un++)Un!==Kn&&qn.push(Un);return qn}function Ml(Cs,Kn,qn,Un=1e-9,vs=1e-9){if(Cs>vs)return new Array(Kn.rows+1).fill(0);{let bs=Kn.addRow(qn,[0]);for(let aa=0;aa<bs.rows;aa++)Math.abs(bs.get(aa,0))<Un&&bs.set(aa,0,0);return bs.to1DArray()}}function Ul(Cs,Kn={}){const{thresholdValue:qn=1e-9,thresholdError:Un=1e-9}=Kn;Cs=Ja.checkMatrix(Cs);let vs=Cs.rows,bs=new Ja(vs,vs);for(let aa=0;aa<vs;aa++){let la=Ja.columnVector(Cs.getRow(aa)),ua=Cs.subMatrixRow(Bl(vs,aa)).transpose(),Qa=new Gl(ua).solve(la),Na=Ja.sub(la,ua.mmul(Qa)).abs().max();bs.setRow(aa,Ml(Na,Qa,aa,qn,Un))}return bs}function Kl(Cs,Kn=Number.EPSILON){if(Cs=Ja.checkMatrix(Cs),Cs.isEmpty())return Cs.transpose();let qn=new Gl(Cs,{autoTranspose:!0}),Un=qn.leftSingularVectors,vs=qn.rightSingularVectors,bs=qn.diagonal;for(let aa=0;aa<bs.length;aa++)Math.abs(bs[aa])>Kn?bs[aa]=1/bs[aa]:bs[aa]=0;return vs.mmul(Ja.diag(bs).mmul(Un.transpose()))}function Nl(Cs,Kn=Cs,qn={}){Cs=new Ja(Cs);let Un=!1;if(typeof Kn=="object"&&!Ja.isMatrix(Kn)&&!qe.isAnyArray(Kn)?(qn=Kn,Kn=Cs,Un=!0):Kn=new Ja(Kn),Cs.rows!==Kn.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:vs=!0}=qn;vs&&(Cs=Cs.center("column"),Un||(Kn=Kn.center("column")));const bs=Cs.transpose().mmul(Kn);for(let aa=0;aa<bs.rows;aa++)for(let la=0;la<bs.columns;la++)bs.set(aa,la,bs.get(aa,la)*(1/(Cs.rows-1)));return bs}function Zl(Cs,Kn=Cs,qn={}){Cs=new Ja(Cs);let Un=!1;if(typeof Kn=="object"&&!Ja.isMatrix(Kn)&&!qe.isAnyArray(Kn)?(qn=Kn,Kn=Cs,Un=!0):Kn=new Ja(Kn),Cs.rows!==Kn.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:vs=!0,scale:bs=!0}=qn;vs&&(Cs.center("column"),Un||Kn.center("column")),bs&&(Cs.scale("column"),Un||Kn.scale("column"));const aa=Cs.standardDeviation("column",{unbiased:!0}),la=Un?aa:Kn.standardDeviation("column",{unbiased:!0}),ua=Cs.transpose().mmul(Kn);for(let fa=0;fa<ua.rows;fa++)for(let Qa=0;Qa<ua.columns;Qa++)ua.set(fa,Qa,ua.get(fa,Qa)*(1/(aa[fa]*la[Qa]))*(1/(Cs.rows-1)));return ua}class Wl{constructor(Kn,qn={}){const{assumeSymmetric:Un=!1}=qn;if(Kn=rl.checkMatrix(Kn),!Kn.isSquare())throw new Error("Matrix is not a square matrix");if(Kn.isEmpty())throw new Error("Matrix must be non-empty");let vs=Kn.columns,bs=new Ja(vs,vs),aa=new Float64Array(vs),la=new Float64Array(vs),ua=Kn,fa,Qa,Na=!1;if(Un?Na=!0:Na=Kn.isSymmetric(),Na){for(fa=0;fa<vs;fa++)for(Qa=0;Qa<vs;Qa++)bs.set(fa,Qa,ua.get(fa,Qa));mh(vs,la,aa,bs),Eh(vs,la,aa,bs)}else{let nl=new Ja(vs,vs),ll=new Float64Array(vs);for(Qa=0;Qa<vs;Qa++)for(fa=0;fa<vs;fa++)nl.set(fa,Qa,ua.get(fa,Qa));_h(vs,nl,ll,bs),Dh(vs,la,aa,bs,nl)}this.n=vs,this.e=la,this.d=aa,this.V=bs}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let Kn=this.n,qn=this.e,Un=this.d,vs=new Ja(Kn,Kn),bs,aa;for(bs=0;bs<Kn;bs++){for(aa=0;aa<Kn;aa++)vs.set(bs,aa,0);vs.set(bs,bs,Un[bs]),qn[bs]>0?vs.set(bs,bs+1,qn[bs]):qn[bs]<0&&vs.set(bs,bs-1,qn[bs])}return vs}}function mh(Cs,Kn,qn,Un){let vs,bs,aa,la,ua,fa,Qa,Na;for(ua=0;ua<Cs;ua++)qn[ua]=Un.get(Cs-1,ua);for(la=Cs-1;la>0;la--){for(Na=0,aa=0,fa=0;fa<la;fa++)Na=Na+Math.abs(qn[fa]);if(Na===0)for(Kn[la]=qn[la-1],ua=0;ua<la;ua++)qn[ua]=Un.get(la-1,ua),Un.set(la,ua,0),Un.set(ua,la,0);else{for(fa=0;fa<la;fa++)qn[fa]/=Na,aa+=qn[fa]*qn[fa];for(vs=qn[la-1],bs=Math.sqrt(aa),vs>0&&(bs=-bs),Kn[la]=Na*bs,aa=aa-vs*bs,qn[la-1]=vs-bs,ua=0;ua<la;ua++)Kn[ua]=0;for(ua=0;ua<la;ua++){for(vs=qn[ua],Un.set(ua,la,vs),bs=Kn[ua]+Un.get(ua,ua)*vs,fa=ua+1;fa<=la-1;fa++)bs+=Un.get(fa,ua)*qn[fa],Kn[fa]+=Un.get(fa,ua)*vs;Kn[ua]=bs}for(vs=0,ua=0;ua<la;ua++)Kn[ua]/=aa,vs+=Kn[ua]*qn[ua];for(Qa=vs/(aa+aa),ua=0;ua<la;ua++)Kn[ua]-=Qa*qn[ua];for(ua=0;ua<la;ua++){for(vs=qn[ua],bs=Kn[ua],fa=ua;fa<=la-1;fa++)Un.set(fa,ua,Un.get(fa,ua)-(vs*Kn[fa]+bs*qn[fa]));qn[ua]=Un.get(la-1,ua),Un.set(la,ua,0)}}qn[la]=aa}for(la=0;la<Cs-1;la++){if(Un.set(Cs-1,la,Un.get(la,la)),Un.set(la,la,1),aa=qn[la+1],aa!==0){for(fa=0;fa<=la;fa++)qn[fa]=Un.get(fa,la+1)/aa;for(ua=0;ua<=la;ua++){for(bs=0,fa=0;fa<=la;fa++)bs+=Un.get(fa,la+1)*Un.get(fa,ua);for(fa=0;fa<=la;fa++)Un.set(fa,ua,Un.get(fa,ua)-bs*qn[fa])}}for(fa=0;fa<=la;fa++)Un.set(fa,la+1,0)}for(ua=0;ua<Cs;ua++)qn[ua]=Un.get(Cs-1,ua),Un.set(Cs-1,ua,0);Un.set(Cs-1,Cs-1,1),Kn[0]=0}function Eh(Cs,Kn,qn,Un){let vs,bs,aa,la,ua,fa,Qa,Na,nl,ll,tl,sl,bl,Ua,ul,_l;for(aa=1;aa<Cs;aa++)Kn[aa-1]=Kn[aa];Kn[Cs-1]=0;let jl=0,Yl=0,vh=Number.EPSILON;for(fa=0;fa<Cs;fa++){for(Yl=Math.max(Yl,Math.abs(qn[fa])+Math.abs(Kn[fa])),Qa=fa;Qa<Cs&&!(Math.abs(Kn[Qa])<=vh*Yl);)Qa++;if(Qa>fa)do{for(vs=qn[fa],Na=(qn[fa+1]-vs)/(2*Kn[fa]),nl=Dl(Na,1),Na<0&&(nl=-nl),qn[fa]=Kn[fa]/(Na+nl),qn[fa+1]=Kn[fa]*(Na+nl),ll=qn[fa+1],bs=vs-qn[fa],aa=fa+2;aa<Cs;aa++)qn[aa]-=bs;for(jl=jl+bs,Na=qn[Qa],tl=1,sl=tl,bl=tl,Ua=Kn[fa+1],ul=0,_l=0,aa=Qa-1;aa>=fa;aa--)for(bl=sl,sl=tl,_l=ul,vs=tl*Kn[aa],bs=tl*Na,nl=Dl(Na,Kn[aa]),Kn[aa+1]=ul*nl,ul=Kn[aa]/nl,tl=Na/nl,Na=tl*qn[aa]-ul*vs,qn[aa+1]=bs+ul*(tl*vs+ul*qn[aa]),ua=0;ua<Cs;ua++)bs=Un.get(ua,aa+1),Un.set(ua,aa+1,ul*Un.get(ua,aa)+tl*bs),Un.set(ua,aa,tl*Un.get(ua,aa)-ul*bs);Na=-ul*_l*bl*Ua*Kn[fa]/ll,Kn[fa]=ul*Na,qn[fa]=tl*Na}while(Math.abs(Kn[fa])>vh*Yl);qn[fa]=qn[fa]+jl,Kn[fa]=0}for(aa=0;aa<Cs-1;aa++){for(ua=aa,Na=qn[aa],la=aa+1;la<Cs;la++)qn[la]<Na&&(ua=la,Na=qn[la]);if(ua!==aa)for(qn[ua]=qn[aa],qn[aa]=Na,la=0;la<Cs;la++)Na=Un.get(la,aa),Un.set(la,aa,Un.get(la,ua)),Un.set(la,ua,Na)}}function _h(Cs,Kn,qn,Un){let vs=0,bs=Cs-1,aa,la,ua,fa,Qa,Na,nl;for(Na=vs+1;Na<=bs-1;Na++){for(nl=0,fa=Na;fa<=bs;fa++)nl=nl+Math.abs(Kn.get(fa,Na-1));if(nl!==0){for(ua=0,fa=bs;fa>=Na;fa--)qn[fa]=Kn.get(fa,Na-1)/nl,ua+=qn[fa]*qn[fa];for(la=Math.sqrt(ua),qn[Na]>0&&(la=-la),ua=ua-qn[Na]*la,qn[Na]=qn[Na]-la,Qa=Na;Qa<Cs;Qa++){for(aa=0,fa=bs;fa>=Na;fa--)aa+=qn[fa]*Kn.get(fa,Qa);for(aa=aa/ua,fa=Na;fa<=bs;fa++)Kn.set(fa,Qa,Kn.get(fa,Qa)-aa*qn[fa])}for(fa=0;fa<=bs;fa++){for(aa=0,Qa=bs;Qa>=Na;Qa--)aa+=qn[Qa]*Kn.get(fa,Qa);for(aa=aa/ua,Qa=Na;Qa<=bs;Qa++)Kn.set(fa,Qa,Kn.get(fa,Qa)-aa*qn[Qa])}qn[Na]=nl*qn[Na],Kn.set(Na,Na-1,nl*la)}}for(fa=0;fa<Cs;fa++)for(Qa=0;Qa<Cs;Qa++)Un.set(fa,Qa,fa===Qa?1:0);for(Na=bs-1;Na>=vs+1;Na--)if(Kn.get(Na,Na-1)!==0){for(fa=Na+1;fa<=bs;fa++)qn[fa]=Kn.get(fa,Na-1);for(Qa=Na;Qa<=bs;Qa++){for(la=0,fa=Na;fa<=bs;fa++)la+=qn[fa]*Un.get(fa,Qa);for(la=la/qn[Na]/Kn.get(Na,Na-1),fa=Na;fa<=bs;fa++)Un.set(fa,Qa,Un.get(fa,Qa)+la*qn[fa])}}}function Dh(Cs,Kn,qn,Un,vs){let bs=Cs-1,aa=0,la=Cs-1,ua=Number.EPSILON,fa=0,Qa=0,Na=0,nl=0,ll=0,tl=0,sl=0,bl=0,Ua,ul,_l,jl,Yl,vh,$l,Fl,wh,Za,hl,Sl,gl,Ch,xh;for(Ua=0;Ua<Cs;Ua++)for((Ua<aa||Ua>la)&&(qn[Ua]=vs.get(Ua,Ua),Kn[Ua]=0),ul=Math.max(Ua-1,0);ul<Cs;ul++)Qa=Qa+Math.abs(vs.get(Ua,ul));for(;bs>=aa;){for(jl=bs;jl>aa&&(tl=Math.abs(vs.get(jl-1,jl-1))+Math.abs(vs.get(jl,jl)),tl===0&&(tl=Qa),!(Math.abs(vs.get(jl,jl-1))<ua*tl));)jl--;if(jl===bs)vs.set(bs,bs,vs.get(bs,bs)+fa),qn[bs]=vs.get(bs,bs),Kn[bs]=0,bs--,bl=0;else if(jl===bs-1){if($l=vs.get(bs,bs-1)*vs.get(bs-1,bs),Na=(vs.get(bs-1,bs-1)-vs.get(bs,bs))/2,nl=Na*Na+$l,sl=Math.sqrt(Math.abs(nl)),vs.set(bs,bs,vs.get(bs,bs)+fa),vs.set(bs-1,bs-1,vs.get(bs-1,bs-1)+fa),Fl=vs.get(bs,bs),nl>=0){for(sl=Na>=0?Na+sl:Na-sl,qn[bs-1]=Fl+sl,qn[bs]=qn[bs-1],sl!==0&&(qn[bs]=Fl-$l/sl),Kn[bs-1]=0,Kn[bs]=0,Fl=vs.get(bs,bs-1),tl=Math.abs(Fl)+Math.abs(sl),Na=Fl/tl,nl=sl/tl,ll=Math.sqrt(Na*Na+nl*nl),Na=Na/ll,nl=nl/ll,ul=bs-1;ul<Cs;ul++)sl=vs.get(bs-1,ul),vs.set(bs-1,ul,nl*sl+Na*vs.get(bs,ul)),vs.set(bs,ul,nl*vs.get(bs,ul)-Na*sl);for(Ua=0;Ua<=bs;Ua++)sl=vs.get(Ua,bs-1),vs.set(Ua,bs-1,nl*sl+Na*vs.get(Ua,bs)),vs.set(Ua,bs,nl*vs.get(Ua,bs)-Na*sl);for(Ua=aa;Ua<=la;Ua++)sl=Un.get(Ua,bs-1),Un.set(Ua,bs-1,nl*sl+Na*Un.get(Ua,bs)),Un.set(Ua,bs,nl*Un.get(Ua,bs)-Na*sl)}else qn[bs-1]=Fl+Na,qn[bs]=Fl+Na,Kn[bs-1]=sl,Kn[bs]=-sl;bs=bs-2,bl=0}else{if(Fl=vs.get(bs,bs),wh=0,$l=0,jl<bs&&(wh=vs.get(bs-1,bs-1),$l=vs.get(bs,bs-1)*vs.get(bs-1,bs)),bl===10){for(fa+=Fl,Ua=aa;Ua<=bs;Ua++)vs.set(Ua,Ua,vs.get(Ua,Ua)-Fl);tl=Math.abs(vs.get(bs,bs-1))+Math.abs(vs.get(bs-1,bs-2)),Fl=wh=.75*tl,$l=-.4375*tl*tl}if(bl===30&&(tl=(wh-Fl)/2,tl=tl*tl+$l,tl>0)){for(tl=Math.sqrt(tl),wh<Fl&&(tl=-tl),tl=Fl-$l/((wh-Fl)/2+tl),Ua=aa;Ua<=bs;Ua++)vs.set(Ua,Ua,vs.get(Ua,Ua)-tl);fa+=tl,Fl=wh=$l=.964}for(bl=bl+1,Yl=bs-2;Yl>=jl&&(sl=vs.get(Yl,Yl),ll=Fl-sl,tl=wh-sl,Na=(ll*tl-$l)/vs.get(Yl+1,Yl)+vs.get(Yl,Yl+1),nl=vs.get(Yl+1,Yl+1)-sl-ll-tl,ll=vs.get(Yl+2,Yl+1),tl=Math.abs(Na)+Math.abs(nl)+Math.abs(ll),Na=Na/tl,nl=nl/tl,ll=ll/tl,!(Yl===jl||Math.abs(vs.get(Yl,Yl-1))*(Math.abs(nl)+Math.abs(ll))<ua*(Math.abs(Na)*(Math.abs(vs.get(Yl-1,Yl-1))+Math.abs(sl)+Math.abs(vs.get(Yl+1,Yl+1))))));)Yl--;for(Ua=Yl+2;Ua<=bs;Ua++)vs.set(Ua,Ua-2,0),Ua>Yl+2&&vs.set(Ua,Ua-3,0);for(_l=Yl;_l<=bs-1&&(Ch=_l!==bs-1,_l!==Yl&&(Na=vs.get(_l,_l-1),nl=vs.get(_l+1,_l-1),ll=Ch?vs.get(_l+2,_l-1):0,Fl=Math.abs(Na)+Math.abs(nl)+Math.abs(ll),Fl!==0&&(Na=Na/Fl,nl=nl/Fl,ll=ll/Fl)),Fl!==0);_l++)if(tl=Math.sqrt(Na*Na+nl*nl+ll*ll),Na<0&&(tl=-tl),tl!==0){for(_l!==Yl?vs.set(_l,_l-1,-tl*Fl):jl!==Yl&&vs.set(_l,_l-1,-vs.get(_l,_l-1)),Na=Na+tl,Fl=Na/tl,wh=nl/tl,sl=ll/tl,nl=nl/Na,ll=ll/Na,ul=_l;ul<Cs;ul++)Na=vs.get(_l,ul)+nl*vs.get(_l+1,ul),Ch&&(Na=Na+ll*vs.get(_l+2,ul),vs.set(_l+2,ul,vs.get(_l+2,ul)-Na*sl)),vs.set(_l,ul,vs.get(_l,ul)-Na*Fl),vs.set(_l+1,ul,vs.get(_l+1,ul)-Na*wh);for(Ua=0;Ua<=Math.min(bs,_l+3);Ua++)Na=Fl*vs.get(Ua,_l)+wh*vs.get(Ua,_l+1),Ch&&(Na=Na+sl*vs.get(Ua,_l+2),vs.set(Ua,_l+2,vs.get(Ua,_l+2)-Na*ll)),vs.set(Ua,_l,vs.get(Ua,_l)-Na),vs.set(Ua,_l+1,vs.get(Ua,_l+1)-Na*nl);for(Ua=aa;Ua<=la;Ua++)Na=Fl*Un.get(Ua,_l)+wh*Un.get(Ua,_l+1),Ch&&(Na=Na+sl*Un.get(Ua,_l+2),Un.set(Ua,_l+2,Un.get(Ua,_l+2)-Na*ll)),Un.set(Ua,_l,Un.get(Ua,_l)-Na),Un.set(Ua,_l+1,Un.get(Ua,_l+1)-Na*nl)}}}if(Qa!==0){for(bs=Cs-1;bs>=0;bs--)if(Na=qn[bs],nl=Kn[bs],nl===0)for(jl=bs,vs.set(bs,bs,1),Ua=bs-1;Ua>=0;Ua--){for($l=vs.get(Ua,Ua)-Na,ll=0,ul=jl;ul<=bs;ul++)ll=ll+vs.get(Ua,ul)*vs.get(ul,bs);if(Kn[Ua]<0)sl=$l,tl=ll;else if(jl=Ua,Kn[Ua]===0?vs.set(Ua,bs,$l!==0?-ll/$l:-ll/(ua*Qa)):(Fl=vs.get(Ua,Ua+1),wh=vs.get(Ua+1,Ua),nl=(qn[Ua]-Na)*(qn[Ua]-Na)+Kn[Ua]*Kn[Ua],vh=(Fl*tl-sl*ll)/nl,vs.set(Ua,bs,vh),vs.set(Ua+1,bs,Math.abs(Fl)>Math.abs(sl)?(-ll-$l*vh)/Fl:(-tl-wh*vh)/sl)),vh=Math.abs(vs.get(Ua,bs)),ua*vh*vh>1)for(ul=Ua;ul<=bs;ul++)vs.set(ul,bs,vs.get(ul,bs)/vh)}else if(nl<0)for(jl=bs-1,Math.abs(vs.get(bs,bs-1))>Math.abs(vs.get(bs-1,bs))?(vs.set(bs-1,bs-1,nl/vs.get(bs,bs-1)),vs.set(bs-1,bs,-(vs.get(bs,bs)-Na)/vs.get(bs,bs-1))):(xh=Vh(0,-vs.get(bs-1,bs),vs.get(bs-1,bs-1)-Na,nl),vs.set(bs-1,bs-1,xh[0]),vs.set(bs-1,bs,xh[1])),vs.set(bs,bs-1,0),vs.set(bs,bs,1),Ua=bs-2;Ua>=0;Ua--){for(Za=0,hl=0,ul=jl;ul<=bs;ul++)Za=Za+vs.get(Ua,ul)*vs.get(ul,bs-1),hl=hl+vs.get(Ua,ul)*vs.get(ul,bs);if($l=vs.get(Ua,Ua)-Na,Kn[Ua]<0)sl=$l,ll=Za,tl=hl;else if(jl=Ua,Kn[Ua]===0?(xh=Vh(-Za,-hl,$l,nl),vs.set(Ua,bs-1,xh[0]),vs.set(Ua,bs,xh[1])):(Fl=vs.get(Ua,Ua+1),wh=vs.get(Ua+1,Ua),Sl=(qn[Ua]-Na)*(qn[Ua]-Na)+Kn[Ua]*Kn[Ua]-nl*nl,gl=(qn[Ua]-Na)*2*nl,Sl===0&&gl===0&&(Sl=ua*Qa*(Math.abs($l)+Math.abs(nl)+Math.abs(Fl)+Math.abs(wh)+Math.abs(sl))),xh=Vh(Fl*ll-sl*Za+nl*hl,Fl*tl-sl*hl-nl*Za,Sl,gl),vs.set(Ua,bs-1,xh[0]),vs.set(Ua,bs,xh[1]),Math.abs(Fl)>Math.abs(sl)+Math.abs(nl)?(vs.set(Ua+1,bs-1,(-Za-$l*vs.get(Ua,bs-1)+nl*vs.get(Ua,bs))/Fl),vs.set(Ua+1,bs,(-hl-$l*vs.get(Ua,bs)-nl*vs.get(Ua,bs-1))/Fl)):(xh=Vh(-ll-wh*vs.get(Ua,bs-1),-tl-wh*vs.get(Ua,bs),sl,nl),vs.set(Ua+1,bs-1,xh[0]),vs.set(Ua+1,bs,xh[1]))),vh=Math.max(Math.abs(vs.get(Ua,bs-1)),Math.abs(vs.get(Ua,bs))),ua*vh*vh>1)for(ul=Ua;ul<=bs;ul++)vs.set(ul,bs-1,vs.get(ul,bs-1)/vh),vs.set(ul,bs,vs.get(ul,bs)/vh)}for(Ua=0;Ua<Cs;Ua++)if(Ua<aa||Ua>la)for(ul=Ua;ul<Cs;ul++)Un.set(Ua,ul,vs.get(Ua,ul));for(ul=Cs-1;ul>=aa;ul--)for(Ua=aa;Ua<=la;Ua++){for(sl=0,_l=aa;_l<=Math.min(ul,la);_l++)sl=sl+Un.get(Ua,_l)*vs.get(_l,ul);Un.set(Ua,ul,sl)}}}function Vh(Cs,Kn,qn,Un){let vs,bs;return Math.abs(qn)>Math.abs(Un)?(vs=Un/qn,bs=qn+vs*Un,[(Cs+vs*Kn)/bs,(Kn-vs*Cs)/bs]):(vs=qn/Un,bs=Un+vs*qn,[(vs*Cs+Kn)/bs,(vs*Kn-Cs)/bs])}class zh{constructor(Kn){if(Kn=rl.checkMatrix(Kn),!Kn.isSymmetric())throw new Error("Matrix is not symmetric");let qn=Kn,Un=qn.rows,vs=new Ja(Un,Un),bs=!0,aa,la,ua;for(la=0;la<Un;la++){let fa=0;for(ua=0;ua<la;ua++){let Qa=0;for(aa=0;aa<ua;aa++)Qa+=vs.get(ua,aa)*vs.get(la,aa);Qa=(qn.get(la,ua)-Qa)/vs.get(ua,ua),vs.set(la,ua,Qa),fa=fa+Qa*Qa}for(fa=qn.get(la,la)-fa,bs&&(bs=fa>0),vs.set(la,la,Math.sqrt(Math.max(fa,0))),ua=la+1;ua<Un;ua++)vs.set(la,ua,0)}this.L=vs,this.positiveDefinite=bs}isPositiveDefinite(){return this.positiveDefinite}solve(Kn){Kn=rl.checkMatrix(Kn);let qn=this.L,Un=qn.rows;if(Kn.rows!==Un)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let vs=Kn.columns,bs=Kn.clone(),aa,la,ua;for(ua=0;ua<Un;ua++)for(la=0;la<vs;la++){for(aa=0;aa<ua;aa++)bs.set(ua,la,bs.get(ua,la)-bs.get(aa,la)*qn.get(ua,aa));bs.set(ua,la,bs.get(ua,la)/qn.get(ua,ua))}for(ua=Un-1;ua>=0;ua--)for(la=0;la<vs;la++){for(aa=ua+1;aa<Un;aa++)bs.set(ua,la,bs.get(ua,la)-bs.get(aa,la)*qn.get(aa,ua));bs.set(ua,la,bs.get(ua,la)/qn.get(ua,ua))}return bs}get lowerTriangularMatrix(){return this.L}}class Oh{constructor(Kn,qn={}){Kn=rl.checkMatrix(Kn);let{Y:Un}=qn;const{scaleScores:vs=!1,maxIterations:bs=1e3,terminationCriteria:aa=1e-10}=qn;let la;if(Un){if(qe.isAnyArray(Un)&&typeof Un[0]=="number"?Un=Ja.columnVector(Un):Un=rl.checkMatrix(Un),Un.rows!==Kn.rows)throw new Error("Y should have the same number of rows as X");la=Un.getColumnVector(0)}else la=Kn.getColumnVector(0);let ua=1,fa,Qa,Na,nl;for(let ll=0;ll<bs&&ua>aa;ll++)Na=Kn.transpose().mmul(la).div(la.transpose().mmul(la).get(0,0)),Na=Na.div(Na.norm()),fa=Kn.mmul(Na).div(Na.transpose().mmul(Na).get(0,0)),ll>0&&(ua=fa.clone().sub(nl).pow(2).sum()),nl=fa.clone(),Un?(Qa=Un.transpose().mmul(fa).div(fa.transpose().mmul(fa).get(0,0)),Qa=Qa.div(Qa.norm()),la=Un.mmul(Qa).div(Qa.transpose().mmul(Qa).get(0,0))):la=fa;if(Un){let ll=Kn.transpose().mmul(fa).div(fa.transpose().mmul(fa).get(0,0));ll=ll.div(ll.norm());let tl=Kn.clone().sub(fa.clone().mmul(ll.transpose())),sl=la.transpose().mmul(fa).div(fa.transpose().mmul(fa).get(0,0)),bl=Un.clone().sub(fa.clone().mulS(sl.get(0,0)).mmul(Qa.transpose()));this.t=fa,this.p=ll.transpose(),this.w=Na.transpose(),this.q=Qa,this.u=la,this.s=fa.transpose().mmul(fa),this.xResidual=tl,this.yResidual=bl,this.betas=sl}else this.w=Na.transpose(),this.s=fa.transpose().mmul(fa).sqrt(),vs?this.t=fa.clone().div(this.s.get(0,0)):this.t=fa,this.xResidual=Kn.sub(fa.mmul(Na.transpose()))}}return matrix$1.AbstractMatrix=el,matrix$1.CHO=zh,matrix$1.CholeskyDecomposition=zh,matrix$1.DistanceMatrix=Ol,matrix$1.EVD=Wl,matrix$1.EigenvalueDecomposition=Wl,matrix$1.LU=kl,matrix$1.LuDecomposition=kl,matrix$1.Matrix=Ja,matrix$1.MatrixColumnSelectionView=Al,matrix$1.MatrixColumnView=Rl,matrix$1.MatrixFlipColumnView=zl,matrix$1.MatrixFlipRowView=Ql,matrix$1.MatrixRowSelectionView=Tl,matrix$1.MatrixRowView=Xl,matrix$1.MatrixSelectionView=pl,matrix$1.MatrixSubView=Hl,matrix$1.MatrixTransposeView=Ll,matrix$1.NIPALS=Oh,matrix$1.Nipals=Oh,matrix$1.QR=fl,matrix$1.QrDecomposition=fl,matrix$1.SVD=Gl,matrix$1.SingularValueDecomposition=Gl,matrix$1.SymmetricMatrix=yl,matrix$1.WrapperMatrix1D=Vl,matrix$1.WrapperMatrix2D=rl,matrix$1.correlation=Zl,matrix$1.covariance=Nl,matrix$1.default=Ja,matrix$1.determinant=El,matrix$1.inverse=ql,matrix$1.linearDependencies=Ul,matrix$1.pseudoInverse=Kl,matrix$1.solve=Cl,matrix$1.wrap=Pl,matrix$1}var matrixExports=requireMatrix();const matrix=getDefaultExportFromCjs(matrixExports),Matrix$1=matrixExports.Matrix,SVD=matrixExports.SVD,SingularValueDecomposition=matrixExports.SingularValueDecomposition;matrix.Matrix?matrix.Matrix:matrixExports.Matrix;const inverse=matrixExports.inverse,solve=matrixExports.solve;function getSeparatedKernel(qe){const f=new SVD(qe,{autoTranspose:!0});if(f.rank!==1)return null;const ze=Math.sqrt(f.s[0]),Ke=f.U.to2DArray().map(Pi=>Pi[0]*ze),Qe=f.V.to2DArray().map(Pi=>Pi[0]*ze);return[Ke,Qe]}function convolution(qe,f={}){let{channels:ze,bitDepth:Ke,normalize:Qe=!1,divisor:Pi=1,border:nn="copy",algorithm:ln="auto"}=f,cn={};Ke&&(cn.bitDepth=Ke);let hn=Image$1.createFrom(this,cn);if(ze=validateArrayOfChannels(this,ze),ln!=="separable")({kernel:qe}=validateKernel(qe));else if(!Array.isArray(qe)||qe.length!==2)throw new RangeError("separable convolution requires two arrays of numbers to represent the kernel");if(ln==="auto"){let ia=getSeparatedKernel(qe);ia!==null?(ln="separable",qe=ia):(qe.length>9||qe[0].length>9)&&this.width<=4096&&this.height<=4096?ln="fft":ln="direct"}let un,xs;ln==="separable"?(un=Math.floor(qe[0].length/2),xs=Math.floor(qe[1].length/2)):(un=Math.floor(qe.length/2),xs=Math.floor(qe[0].length/2));let zn=hn.isClamped,Xn=new Array(this.height*this.width),ys,Jo,ea,ra,na,ta;for(ra=0;ra<ze.length;ra++){for(na=ze[ra],ea=0;ea<this.height;ea++)for(Jo=0;Jo<this.width;Jo++)ys=ea*this.width+Jo,Xn[ys]=this.data[ys*this.channels+na];if(ln==="direct")ta=srcExports$1.direct(Xn,qe,{rows:this.height,cols:this.width,normalize:Qe,divisor:Pi});else if(ln==="separable"){if(ta=convolutionSeparable(Xn,qe,this.width,this.height),Qe){Pi=0;for(let ia=0;ia<qe[0].length;ia++)for(let sa=0;sa<qe[1].length;sa++)Pi+=qe[0][ia]*qe[1][sa]}if(Pi!==1)for(let ia=0;ia<ta.length;ia++)ta[ia]/=Pi}else ta=srcExports$1.fft(Xn,qe,{rows:this.height,cols:this.width,normalize:Qe,divisor:Pi});for(ea=0;ea<this.height;ea++)for(Jo=0;Jo<this.width;Jo++)ys=ea*this.width+Jo,zn?hn.data[ys*this.channels+na]=clamp(ta[ys],hn):hn.data[ys*this.channels+na]=ta[ys]}if(this.alpha&&!ze.includes(this.channels))for(Jo=this.components;Jo<this.data.length;Jo=Jo+this.channels)hn.data[Jo]=this.data[Jo];return nn!=="periodic"&&hn.setBorder({size:[xs,un],algorithm:nn}),hn}function gradientFilter(qe={}){let{direction:f="xy",border:ze="copy",kernelX:Ke,kernelY:Qe,channels:Pi,bitDepth:nn=this.bitDepth}=qe;switch(this.checkProcessable("gradientFilter",{bitDepth:[8,16]}),f){case"x":if(!Ke)throw new Error("kernelX option is missing");return convolution.call(this,Ke,{channels:Pi,border:ze,bitDepth:nn});case"y":if(!Qe)throw new Error("kernelY option is missing");return convolution.call(this,Qe,{channels:Pi,border:ze,bitDepth:nn});case"xy":{if(!Ke)throw new Error("kernelX option is missing");if(!Qe)throw new Error("kernelY option is missing");const ln=convolution.call(this,Ke,{channels:Pi,border:ze,bitDepth:32}),cn=convolution.call(this,Qe,{channels:Pi,border:ze,bitDepth:32});return ln.hypotenuse(cn,{bitDepth:nn,channels:Pi})}default:throw new Error(`Unknown parameter direction: ${f}`)}}function sobelFilter(qe){return gradientFilter.call(this,Object.assign({},qe,{kernelX:SOBEL_X,kernelY:SOBEL_Y}))}function scharrFilter(qe){return gradientFilter.call(this,Object.assign({},qe,{kernelX:SCHARR_X,kernelY:SCHARR_Y}))}var newArray_1,hasRequiredNewArray;function requireNewArray(){if(hasRequiredNewArray)return newArray_1;hasRequiredNewArray=1,newArray_1=qe;function qe(f,ze){f=f||0;for(var Ke=new Array(f),Qe=0;Qe<f;Qe++)Ke[Qe]=ze;return Ke}return newArray_1}var newArrayExports=requireNewArray();const newArray=getDefaultExportFromCjs(newArrayExports);function level(qe={}){let{algorithm:f="range",channels:ze,min:Ke=this.min,max:Qe=this.max}=qe;switch(this.checkProcessable("level",{bitDepth:[8,16,32]}),ze=validateArrayOfChannels(this,{channels:ze}),ze.length!==this.channel&&(Array.isArray(Ke)&&Ke.length===this.channels&&(Ke=Ke.filter((Pi,nn)=>ze.includes(nn))),Array.isArray(Qe)&&Qe.length===this.channels&&(Qe=Qe.filter((Pi,nn)=>ze.includes(nn)))),f){case"range":Ke<0&&(Ke=0),Qe>this.maxValue&&(Qe=this.maxValue),Array.isArray(Ke)||(Ke=newArray(ze.length,Ke)),Array.isArray(Qe)||(Qe=newArray(ze.length,Qe)),processImage(this,Ke,Qe,ze);break;default:throw new Error(`level: algorithm not implement: ${f}`)}return this}function processImage(qe,f,ze,Ke){let Qe=1e-5,Pi=new Array(Ke.length);for(let nn=0;nn<Ke.length;nn++)f[nn]===0&&ze[nn]===qe.maxValue||ze[nn]===f[nn]?Pi[nn]=0:Pi[nn]=(qe.maxValue+1-Qe)/(ze[nn]-f[nn]),f[nn]+=(.5-Qe/2)/Pi[nn];for(let nn=0;nn<Ke.length;nn++){let ln=Ke[nn];if(Pi[nn]!==0)for(let cn=0;cn<qe.data.length;cn+=qe.channels)qe.data[cn+ln]=Math.min(Math.max(0,(qe.data[cn+ln]-f[nn])*Pi[nn]+.5|0),qe.maxValue)}}var isArrayType,hasRequiredIsArrayType;function requireIsArrayType(){if(hasRequiredIsArrayType)return isArrayType;hasRequiredIsArrayType=1;var qe=Object.prototype.toString;return isArrayType=function(ze){return qe.call(ze).substr(-6,5)==="Array"},isArrayType}var isArrayTypeExports=requireIsArrayType();const isArray=getDefaultExportFromCjs(isArrayTypeExports);function checkNumberArray(qe){if(isNaN(qe)){if(qe instanceof Image$1)return qe.data;if(!isArray(qe))throw new Error("checkNumberArray: the value should be either a number, array or Image");return qe}else{if(qe<=0)throw new Error("checkNumberArray: the value must be greater than 0");return qe}}function add(qe,f={}){let{channels:ze}=f;if(this.checkProcessable("add",{bitDepth:[8,16]}),ze=validateArrayOfChannels(this,{channels:ze}),qe=checkNumberArray(qe),isNaN(qe)){if(this.data.length!==qe.length)throw new Error("add: the data size is different");for(let Ke=0;Ke<ze.length;Ke++){let Qe=ze[Ke];for(let Pi=0;Pi<this.data.length;Pi+=this.channels)this.data[Pi+Qe]=Math.max(0,Math.min(this.maxValue,this.data[Pi+Qe]+qe[Pi+Qe]>>0))}}else for(let Ke=0;Ke<ze.length;Ke++){let Qe=ze[Ke];for(let Pi=0;Pi<this.data.length;Pi+=this.channels)this.data[Pi+Qe]=Math.min(this.maxValue,this.data[Pi+Qe]+qe>>0)}return this}function subtract(qe,f={}){let{channels:ze}=f;if(this.checkProcessable("subtract",{bitDepth:[8,16]}),ze=validateArrayOfChannels(this,{channels:ze}),qe=checkNumberArray(qe),isNaN(qe)){if(this.data.length!==qe.length)throw new Error("subtract: the data size is different");for(let Ke=0;Ke<ze.length;Ke++){let Qe=ze[Ke];for(let Pi=0;Pi<this.data.length;Pi+=this.channels)this.data[Pi+Qe]=Math.max(0,Math.min(this.maxValue,this.data[Pi+Qe]-qe[Pi+Qe]>>0))}}else for(let Ke=0;Ke<ze.length;Ke++){let Qe=ze[Ke];for(let Pi=0;Pi<this.data.length;Pi+=this.channels)this.data[Pi+Qe]=Math.max(0,this.data[Pi+Qe]-qe>>0)}return this}function subtractImage(qe,f={}){let{channels:ze,absolute:Ke=!1}=f;if(this.checkProcessable("subtractImage",{bitDepth:[8,16]}),this.width!==qe.width||this.height!==qe.height)throw new Error("subtractImage: both images must have the same size");if(this.alpha!==qe.alpha||this.bitDepth!==qe.bitDepth)throw new Error("subtractImage: both images must have the same alpha and bitDepth");if(this.channels!==qe.channels)throw new Error("subtractImage: both images must have the same number of channels");let Qe=this.clone();ze=validateArrayOfChannels(this,{channels:ze});for(let Pi=0;Pi<ze.length;Pi++){let nn=ze[Pi];for(let ln=nn;ln<this.data.length;ln+=this.channels){let cn=this.data[ln]-qe.data[ln];Ke?Qe.data[ln]=Math.abs(cn):Qe.data[ln]=Math.max(cn,0)}}return Qe}function hypotenuse(qe,f={}){let{bitDepth:ze=this.bitDepth,channels:Ke}=f;if(this.checkProcessable("hypotenuse",{bitDepth:[8,16,32]}),this.width!==qe.width||this.height!==qe.height)throw new Error("hypotenuse: both images must have the same size");if(this.alpha!==qe.alpha||this.bitDepth!==qe.bitDepth)throw new Error("hypotenuse: both images must have the same alpha and bitDepth");if(this.channels!==qe.channels)throw new Error("hypotenuse: both images must have the same number of channels");let Qe=Image$1.createFrom(this,{bitDepth:ze});Ke=validateArrayOfChannels(this,{channels:Ke});let Pi=Qe.isClamped;for(let nn=0;nn<Ke.length;nn++){let ln=Ke[nn];for(let cn=ln;cn<this.data.length;cn+=this.channels){let hn=Math.hypot(this.data[cn],qe.data[cn]);Pi?Qe.data[cn]=Math.min(Math.max(Math.round(hn),0),Qe.maxValue):Qe.data[cn]=hn}}return Qe}function multiply(qe,f={}){let{channels:ze}=f;if(this.checkProcessable("multiply",{bitDepth:[8,16]}),qe<=0)throw new Error("multiply: the value must be greater than 0");if(ze=validateArrayOfChannels(this,{channels:ze}),qe=checkNumberArray(qe),isNaN(qe)){if(this.data.length!==qe.length)throw new Error("multiply: the data size is different");for(let Ke=0;Ke<ze.length;Ke++){let Qe=ze[Ke];for(let Pi=0;Pi<this.data.length;Pi+=this.channels)this.data[Pi+Qe]=Math.max(0,Math.min(this.maxValue,this.data[Pi+Qe]*qe[Pi+Qe]>>0))}}else for(let Ke=0;Ke<ze.length;Ke++){let Qe=ze[Ke];for(let Pi=0;Pi<this.data.length;Pi+=this.channels)this.data[Pi+Qe]=Math.min(this.maxValue,this.data[Pi+Qe]*qe>>0)}return this}function divide(qe,f={}){let{channels:ze}=f;if(this.checkProcessable("divide",{bitDepth:[8,16]}),ze=validateArrayOfChannels(this,{channels:ze}),qe=checkNumberArray(qe),isNaN(qe)){if(this.data.length!==qe.length)throw new Error("divide: the: the data size is different");for(let Ke=0;Ke<ze.length;Ke++){let Qe=ze[Ke];for(let Pi=0;Pi<this.data.length;Pi+=this.channels)this.data[Pi+Qe]=Math.max(0,Math.min(this.maxValue,this.data[Pi+Qe]/qe[Pi+Qe]>>0))}}else for(let Ke=0;Ke<ze.length;Ke++){let Qe=ze[Ke];for(let Pi=0;Pi<this.data.length;Pi+=this.channels)this.data[Pi+Qe]=Math.min(this.maxValue,this.data[Pi+Qe]/qe>>0)}return this}class BaseRegression{constructor(){if(new.target===BaseRegression)throw new Error("BaseRegression must be subclassed")}predict(f){if(typeof f=="number")return this._predict(f);if(isAnyArray(f)){const ze=[];for(let Ke=0;Ke<f.length;Ke++)ze.push(this._predict(f[Ke]));return ze}else throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(f,ze){if(!isAnyArray(f)||!isAnyArray(ze)||f.length!==ze.length)throw new Error("x and y must be arrays of the same length");const Ke=f.length,Qe=new Array(Ke);for(let Xn=0;Xn<Ke;Xn++)Qe[Xn]=this._predict(f[Xn]);let Pi=0,nn=0,ln=0,cn=0,hn=0,un=0,xs=0;for(let Xn=0;Xn<Ke;Xn++)Pi+=Qe[Xn],nn+=ze[Xn],hn+=Qe[Xn]*Qe[Xn],un+=ze[Xn]*ze[Xn],xs+=Qe[Xn]*ze[Xn],ze[Xn]!==0&&(ln+=(ze[Xn]-Qe[Xn])*(ze[Xn]-Qe[Xn])/ze[Xn]),cn+=(ze[Xn]-Qe[Xn])*(ze[Xn]-Qe[Xn]);const zn=(Ke*xs-Pi*nn)/Math.sqrt((Ke*hn-Pi*Pi)*(Ke*un-nn*nn));return{r:zn,r2:zn*zn,chi2:ln,rmsd:Math.sqrt(cn/Ke)}}}function squaredEuclidean(qe,f){let ze=0;for(let Ke=0;Ke<qe.length;Ke++)ze+=(qe[Ke]-f[Ke])*(qe[Ke]-f[Ke]);return ze}function euclidean(qe,f){return Math.sqrt(squaredEuclidean(qe,f))}const euclidean$1=Object.freeze(Object.defineProperty({__proto__:null,euclidean,squaredEuclidean},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(euclidean$1);var gaussianKernel,hasRequiredGaussianKernel;function requireGaussianKernel(){if(hasRequiredGaussianKernel)return gaussianKernel;hasRequiredGaussianKernel=1;const{squaredEuclidean:qe}=require$$0,f={sigma:1};class ze{constructor(Qe){Qe=Object.assign({},f,Qe),this.sigma=Qe.sigma,this.divisor=2*Qe.sigma*Qe.sigma}compute(Qe,Pi){const nn=qe(Qe,Pi);return Math.exp(-nn/this.divisor)}}return gaussianKernel=ze,gaussianKernel}var polynomialKernel,hasRequiredPolynomialKernel;function requirePolynomialKernel(){if(hasRequiredPolynomialKernel)return polynomialKernel;hasRequiredPolynomialKernel=1;const qe={degree:1,constant:1,scale:1};class f{constructor(Ke){Ke=Object.assign({},qe,Ke),this.degree=Ke.degree,this.constant=Ke.constant,this.scale=Ke.scale}compute(Ke,Qe){for(var Pi=0,nn=0;nn<Ke.length;nn++)Pi+=Ke[nn]*Qe[nn];return Math.pow(this.scale*Pi+this.constant,this.degree)}}return polynomialKernel=f,polynomialKernel}var sigmoidKernel,hasRequiredSigmoidKernel;function requireSigmoidKernel(){if(hasRequiredSigmoidKernel)return sigmoidKernel;hasRequiredSigmoidKernel=1;const qe={alpha:.01,constant:-Math.E};class f{constructor(Ke){Ke=Object.assign({},qe,Ke),this.alpha=Ke.alpha,this.constant=Ke.constant}compute(Ke,Qe){for(var Pi=0,nn=0;nn<Ke.length;nn++)Pi+=Ke[nn]*Qe[nn];return Math.tanh(this.alpha*Pi+this.constant)}}return sigmoidKernel=f,sigmoidKernel}var anovaKernel,hasRequiredAnovaKernel;function requireAnovaKernel(){if(hasRequiredAnovaKernel)return anovaKernel;hasRequiredAnovaKernel=1;const qe={sigma:1,degree:1};class f{constructor(Ke){Ke=Object.assign({},qe,Ke),this.sigma=Ke.sigma,this.degree=Ke.degree}compute(Ke,Qe){for(var Pi=0,nn=Math.min(Ke.length,Qe.length),ln=1;ln<=nn;++ln)Pi+=Math.pow(Math.exp(-this.sigma*Math.pow(Math.pow(Ke[ln-1],ln)-Math.pow(Qe[ln-1],ln),2)),this.degree);return Pi}}return anovaKernel=f,anovaKernel}var cauchyKernel,hasRequiredCauchyKernel;function requireCauchyKernel(){if(hasRequiredCauchyKernel)return cauchyKernel;hasRequiredCauchyKernel=1;const{squaredEuclidean:qe}=require$$0,f={sigma:1};class ze{constructor(Qe){Qe=Object.assign({},f,Qe),this.sigma=Qe.sigma}compute(Qe,Pi){return 1/(1+qe(Qe,Pi)/(this.sigma*this.sigma))}}return cauchyKernel=ze,cauchyKernel}var exponentialKernel,hasRequiredExponentialKernel;function requireExponentialKernel(){if(hasRequiredExponentialKernel)return exponentialKernel;hasRequiredExponentialKernel=1;const{euclidean:qe}=require$$0,f={sigma:1};class ze{constructor(Qe){Qe=Object.assign({},f,Qe),this.sigma=Qe.sigma,this.divisor=2*Qe.sigma*Qe.sigma}compute(Qe,Pi){const nn=qe(Qe,Pi);return Math.exp(-nn/this.divisor)}}return exponentialKernel=ze,exponentialKernel}var histogramIntersectionKernel,hasRequiredHistogramIntersectionKernel;function requireHistogramIntersectionKernel(){if(hasRequiredHistogramIntersectionKernel)return histogramIntersectionKernel;hasRequiredHistogramIntersectionKernel=1;class qe{compute(ze,Ke){for(var Qe=Math.min(ze.length,Ke.length),Pi=0,nn=0;nn<Qe;++nn)Pi+=Math.min(ze[nn],Ke[nn]);return Pi}}return histogramIntersectionKernel=qe,histogramIntersectionKernel}var laplacianKernel,hasRequiredLaplacianKernel;function requireLaplacianKernel(){if(hasRequiredLaplacianKernel)return laplacianKernel;hasRequiredLaplacianKernel=1;const{euclidean:qe}=require$$0,f={sigma:1};class ze{constructor(Qe){Qe=Object.assign({},f,Qe),this.sigma=Qe.sigma}compute(Qe,Pi){const nn=qe(Qe,Pi);return Math.exp(-nn/this.sigma)}}return laplacianKernel=ze,laplacianKernel}var multiquadraticKernel,hasRequiredMultiquadraticKernel;function requireMultiquadraticKernel(){if(hasRequiredMultiquadraticKernel)return multiquadraticKernel;hasRequiredMultiquadraticKernel=1;const{squaredEuclidean:qe}=require$$0,f={constant:1};class ze{constructor(Qe){Qe=Object.assign({},f,Qe),this.constant=Qe.constant}compute(Qe,Pi){return Math.sqrt(qe(Qe,Pi)+this.constant*this.constant)}}return multiquadraticKernel=ze,multiquadraticKernel}var rationalQuadraticKernel,hasRequiredRationalQuadraticKernel;function requireRationalQuadraticKernel(){if(hasRequiredRationalQuadraticKernel)return rationalQuadraticKernel;hasRequiredRationalQuadraticKernel=1;const{squaredEuclidean:qe}=require$$0,f={constant:1};class ze{constructor(Qe){Qe=Object.assign({},f,Qe),this.constant=Qe.constant}compute(Qe,Pi){const nn=qe(Qe,Pi);return 1-nn/(nn+this.constant)}}return rationalQuadraticKernel=ze,rationalQuadraticKernel}var kernel,hasRequiredKernel;function requireKernel(){if(hasRequiredKernel)return kernel;hasRequiredKernel=1;const{Matrix:qe,MatrixTransposeView:f}=requireMatrix(),ze=requireGaussianKernel(),Ke=requirePolynomialKernel(),Qe=requireSigmoidKernel(),Pi=requireAnovaKernel(),nn=requireCauchyKernel(),ln=requireExponentialKernel(),cn=requireHistogramIntersectionKernel(),hn=requireLaplacianKernel(),un=requireMultiquadraticKernel(),xs=requireRationalQuadraticKernel(),zn={gaussian:ze,rbf:ze,polynomial:Ke,poly:Ke,anova:Pi,cauchy:nn,exponential:ln,histogram:cn,min:cn,laplacian:hn,multiquadratic:un,rational:xs,sigmoid:Qe,mlp:Qe};class Xn{constructor(Jo,ea){if(this.kernelType=Jo,Jo!=="linear")if(typeof Jo=="string"){Jo=Jo.toLowerCase();var ra=zn[Jo];if(ra)this.kernelFunction=new ra(ea);else throw new Error(`unsupported kernel type: ${Jo}`)}else if(typeof Jo=="object"&&typeof Jo.compute=="function")this.kernelFunction=Jo;else throw new TypeError("first argument must be a valid kernel type or instance")}compute(Jo,ea){if(Jo=qe.checkMatrix(Jo),ea===void 0?ea=Jo:ea=qe.checkMatrix(ea),this.kernelType==="linear")return Jo.mmul(new f(ea));const ra=new qe(Jo.rows,ea.rows);if(Jo===ea)for(let na=0;na<Jo.rows;na++)for(let ta=na;ta<Jo.rows;ta++){const ia=this.kernelFunction.compute(Jo.getRow(na),Jo.getRow(ta));ra.set(na,ta,ia),ra.set(ta,na,ia)}else for(let na=0;na<Jo.rows;na++)for(let ta=0;ta<ea.rows;ta++)ra.set(na,ta,this.kernelFunction.compute(Jo.getRow(na),ea.getRow(ta)));return ra}}return kernel=Xn,kernel}var kernelExports=requireKernel();const Kernel=getDefaultExportFromCjs(kernelExports),defaultOptions$2={lambda:.1,kernelType:"gaussian",kernelOptions:{},computeCoefficient:!1};class KernelRidgeRegression extends BaseRegression{constructor(f,ze,Ke){if(super(),f===!0)this.alpha=ze.alpha,this.inputs=ze.inputs,this.kernelType=ze.kernelType,this.kernelOptions=ze.kernelOptions,this.kernel=new Kernel(ze.kernelType,ze.kernelOptions);else{f=Matrix$1.checkMatrix(f),Ke=Object.assign({},defaultOptions$2,Ke);const Qe=new Kernel(Ke.kernelType,Ke.kernelOptions),Pi=Qe.compute(f),nn=f.rows;Pi.add(Matrix$1.eye(nn,nn).mul(Ke.lambda)),this.alpha=solve(Pi,ze),this.inputs=f,this.kernelType=Ke.kernelType,this.kernelOptions=Ke.kernelOptions,this.kernel=Qe}}_predict(f){return this.kernel.compute([f],this.inputs).mmul(this.alpha).getRow(0)}toJSON(){return{name:"kernelRidgeRegression",alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions}}static load(f){if(f.name!=="kernelRidgeRegression")throw new TypeError("not a KRR model");return new KernelRidgeRegression(!0,f)}}function background$1(qe,f,ze){const Ke=new KernelRidgeRegression(qe,f,ze),Qe=new Array(this.size);for(let ln=0;ln<this.width;ln++)for(let cn=0;cn<this.height;cn++)Qe[cn*this.width+ln]=[ln,cn];const Pi=Ke.predict(Qe),nn=Image$1.createFrom(this);for(let ln=0;ln<this.size;ln++)nn.data[ln]=Math.min(this.maxValue,Math.max(0,Pi[ln][0]));return nn}function dilate(qe={}){let{kernel:f=[[1,1,1],[1,1,1],[1,1,1]],iterations:ze=1}=qe;if(this.checkProcessable("dilate",{bitDepth:[1,8,16],components:1,alpha:0}),f.columns%2===0||f.rows%2===0)throw new TypeError("dilate: The number of rows and columns of the kernel must be odd");let Ke=!0;e:for(const Pi of f)for(const nn of Pi)if(nn!==1){Ke=!1;break e}let Qe=this;for(let Pi=0;Pi<ze;Pi++)if(this.bitDepth===1)if(Ke){const nn=Qe.clone();Qe=dilateOnceBinaryOnlyOnes(Qe,nn,f.length,f[0].length)}else{const nn=Image$1.createFrom(Qe);Qe=dilateOnceBinary(Qe,nn,f)}else if(Ke){const nn=Image$1.createFrom(Qe);Qe=dilateOnceGreyOnlyOnes(Qe,nn,f.length,f[0].length)}else{const nn=Image$1.createFrom(Qe);Qe=dilateOnceGrey(Qe,nn,f)}return Qe}function dilateOnceGrey(qe,f,ze){const Ke=ze.length,Qe=ze[0].length;let Pi=(Ke-1)/2,nn=(Qe-1)/2;for(let ln=0;ln<qe.height;ln++)for(let cn=0;cn<qe.width;cn++){let hn=0;for(let un=0;un<Qe;un++)for(let xs=0;xs<Ke;xs++){if(ze[xs][un]!==1)continue;let zn=xs-Pi+cn,Xn=un-nn+ln;if(zn<0||Xn<0||zn>=qe.width||Xn>=qe.height)continue;const ys=qe.getValueXY(zn,Xn,0);ys>hn&&(hn=ys)}f.setValueXY(cn,ln,0,hn)}return f}function dilateOnceGreyOnlyOnes(qe,f,ze,Ke){const Qe=(ze-1)/2,Pi=(Ke-1)/2,nn=[];for(let ln=0;ln<qe.width;ln++)nn.push(0);for(let ln=0;ln<qe.height;ln++){for(let cn=0;cn<qe.width;cn++){let hn=0;for(let un=Math.max(0,ln-Pi);un<Math.min(qe.height,ln+Pi+1);un++){const xs=qe.getValueXY(cn,un,0);xs>hn&&(hn=xs)}nn[cn]=hn}for(let cn=0;cn<qe.width;cn++){let hn=0;for(let un=Math.max(0,cn-Qe);un<Math.min(qe.width,cn+Qe+1);un++)nn[un]>hn&&(hn=nn[un]);f.setValueXY(cn,ln,0,hn)}}return f}function dilateOnceBinary(qe,f,ze){const Ke=ze.length,Qe=ze[0].length;let Pi=(Ke-1)/2,nn=(Qe-1)/2;for(let ln=0;ln<qe.height;ln++)for(let cn=0;cn<qe.width;cn++){let hn=0;e:for(let un=0;un<Qe;un++)for(let xs=0;xs<Ke;xs++){if(ze[xs][un]!==1)continue;let zn=xs-Pi+cn,Xn=un-nn+ln;if(Xn<0||zn<0||zn>=qe.width||Xn>=qe.height)continue;if(qe.getBitXY(zn,Xn)===1){hn=1;break e}}hn===1&&f.setBitXY(cn,ln)}return f}function dilateOnceBinaryOnlyOnes(qe,f,ze,Ke){const Qe=(ze-1)/2,Pi=(Ke-1)/2,nn=[];for(let ln=0;ln<qe.width;ln++)nn.push(1);for(let ln=0;ln<qe.height;ln++){for(let cn=0;cn<qe.width;cn++){nn[cn]=0;for(let hn=Math.max(0,ln-Pi);hn<Math.min(qe.height,ln+Pi+1);hn++)if(qe.getBitXY(cn,hn)===1){nn[cn]=1;break}}for(let cn=0;cn<qe.width;cn++)if(f.getBitXY(cn,ln)!==1){for(let hn=Math.max(0,cn-Qe);hn<Math.min(qe.width,cn+Qe+1);hn++)if(nn[hn]===1){f.setBitXY(cn,ln);break}}}return f}function erode(qe={}){let{kernel:f=[[1,1,1],[1,1,1],[1,1,1]],iterations:ze=1}=qe;if(this.checkProcessable("erode",{bitDepth:[1,8,16],components:1,alpha:0}),f.columns%2===0||f.rows%2===0)throw new TypeError("erode: The number of rows and columns of the kernel must be odd");let Ke=!0;e:for(const Pi of f)for(const nn of Pi)if(nn!==1){Ke=!1;break e}let Qe=this;for(let Pi=0;Pi<ze;Pi++)if(this.bitDepth===1)if(Ke){const nn=Qe.clone();Qe=erodeOnceBinaryOnlyOnes(Qe,nn,f.length,f[0].length)}else{const nn=Image$1.createFrom(Qe);Qe=erodeOnceBinary(Qe,nn,f)}else if(Ke){const nn=Image$1.createFrom(Qe);Qe=erodeOnceGreyOnlyOnes(Qe,nn,f.length,f[0].length)}else{const nn=Image$1.createFrom(Qe);Qe=erodeOnceGrey(Qe,nn,f)}return Qe}function erodeOnceGrey(qe,f,ze){const Ke=ze.length,Qe=ze[0].length;let Pi=(Ke-1)/2,nn=(Qe-1)/2;for(let ln=0;ln<qe.height;ln++)for(let cn=0;cn<qe.width;cn++){let hn=qe.maxValue;for(let un=0;un<Qe;un++)for(let xs=0;xs<Ke;xs++){if(ze[xs][un]!==1)continue;let zn=xs-Pi+cn,Xn=un-nn+ln;if(zn<0||Xn<0||zn>=qe.width||Xn>=qe.height)continue;const ys=qe.getValueXY(zn,Xn,0);ys<hn&&(hn=ys)}f.setValueXY(cn,ln,0,hn)}return f}function erodeOnceGreyOnlyOnes(qe,f,ze,Ke){const Qe=(ze-1)/2,Pi=(Ke-1)/2,nn=[];for(let ln=0;ln<qe.width;ln++)nn.push(0);for(let ln=0;ln<qe.height;ln++){for(let cn=0;cn<qe.width;cn++){let hn=qe.maxValue;for(let un=Math.max(0,ln-Pi);un<Math.min(qe.height,ln+Pi+1);un++){const xs=qe.getValueXY(cn,un,0);xs<hn&&(hn=xs)}nn[cn]=hn}for(let cn=0;cn<qe.width;cn++){let hn=qe.maxValue;for(let un=Math.max(0,cn-Qe);un<Math.min(qe.width,cn+Qe+1);un++)nn[un]<hn&&(hn=nn[un]);f.setValueXY(cn,ln,0,hn)}}return f}function erodeOnceBinary(qe,f,ze){const Ke=ze.length,Qe=ze[0].length;let Pi=(Ke-1)/2,nn=(Qe-1)/2;for(let ln=0;ln<qe.height;ln++)for(let cn=0;cn<qe.width;cn++){let hn=1;e:for(let un=0;un<Qe;un++)for(let xs=0;xs<Ke;xs++){if(ze[xs][un]!==1)continue;let zn=xs-Pi+cn,Xn=un-nn+ln;if(Xn<0||zn<0||zn>=qe.width||Xn>=qe.height)continue;if(qe.getBitXY(zn,Xn)===0){hn=0;break e}}hn===1&&f.setBitXY(cn,ln)}return f}function erodeOnceBinaryOnlyOnes(qe,f,ze,Ke){const Qe=(ze-1)/2,Pi=(Ke-1)/2,nn=[];for(let ln=0;ln<qe.width;ln++)nn.push(0);for(let ln=0;ln<qe.height;ln++){for(let cn=0;cn<qe.width;cn++){nn[cn]=1;for(let hn=Math.max(0,ln-Pi);hn<Math.min(qe.height,ln+Pi+1);hn++)if(qe.getBitXY(cn,hn)===0){nn[cn]=0;break}}for(let cn=0;cn<qe.width;cn++)if(f.getBitXY(cn,ln)!==0){for(let hn=Math.max(0,cn-Qe);hn<Math.min(qe.width,cn+Qe+1);hn++)if(nn[hn]===0){f.clearBitXY(cn,ln);break}}}return f}function open(qe={}){let{kernel:f=[[1,1,1],[1,1,1],[1,1,1]],iterations:ze=1}=qe;if(this.checkProcessable("open",{bitDepth:[8,16],components:1,alpha:0}),f.columns%2===0||f.rows%2===0)throw new TypeError("open: The number of rows and columns of the kernel must be odd");let Ke=this;for(let Qe=0;Qe<ze;Qe++)Ke=Ke.erode({kernel:f}),Ke=Ke.dilate({kernel:f});return Ke}function close(qe={}){let{kernel:f=[[1,1,1],[1,1,1],[1,1,1]],iterations:ze=1}=qe;if(this.checkProcessable("close",{bitDepth:[1,8,16],components:1,alpha:0}),f.columns%2===0||f.rows%2===0)throw new TypeError("close: The number of rows and columns of the kernel must be odd");let Ke=this;for(let Qe=0;Qe<ze;Qe++)Ke=Ke.dilate({kernel:f}).erode({kernel:f});return Ke}function topHat(qe={}){let{kernel:f=[[1,1,1],[1,1,1],[1,1,1]],iterations:ze=1}=qe;if(this.checkProcessable("topHat",{bitDepth:[8,16],components:1,alpha:0}),f.length%2===0||f[0].length%2===0)throw new TypeError("topHat: The number of rows and columns of the kernel must be odd");let Ke=this;for(let Qe=0;Qe<ze;Qe++)Ke=Ke.open({kernel:f}).subtractImage(Ke,{absolute:!0});return Ke}function blackHat(qe={}){let{kernel:f=[[1,1,1],[1,1,1],[1,1,1]],iterations:ze=1}=qe;if(this.checkProcessable("blackHat",{bitDepth:[8,16],components:1,alpha:0}),f.columns%2===0||f.rows%2===0)throw new TypeError("blackHat: The number of rows and columns of the kernel must be odd");let Ke=this;for(let Qe=0;Qe<ze;Qe++)Ke=Ke.close({kernel:f}).subtractImage(Ke,{absolute:!0});return Ke}function morphologicalGradient(qe={}){let{kernel:f=[[1,1,1],[1,1,1],[1,1,1]],iterations:ze=1}=qe;if(this.checkProcessable("morphologicalGradient",{bitDepth:[8,16],components:1,alpha:0}),f.columns%2===0||f.rows%2===0)throw new TypeError("morphologicalGradient: The number of rows and columns of the kernel must be odd");let Ke=this;for(let Qe=0;Qe<ze;Qe++){let Pi=Ke.dilate({kernel:f}),nn=Ke.erode({kernel:f});Ke=Pi.subtractImage(nn,{absolute:!0})}return Ke}function order4Points(qe){let f=0,ze=0,Ke=0,Qe=0,Pi=qe[0][0],nn=0;for(let hn=1;hn<qe.length;hn++)qe[hn][0]<Pi&&(Pi=qe[hn][0],nn=hn);let ln=qe[(nn+1)%qe.length][0],cn=(nn+1)%qe.length;for(let hn=1;hn<qe.length;hn++)qe[hn][0]<ln&&hn!==nn&&(ln=qe[hn][0],cn=hn);return qe[cn][1]<qe[nn][1]?(f=qe[cn],Qe=qe[nn],nn!==(cn+1)%4?(ze=qe[(cn+1)%4],Ke=qe[(cn+2)%4]):(ze=qe[(cn+2)%4],Ke=qe[(cn+3)%4])):(Qe=qe[cn],f=qe[nn],cn!==(nn+1)%4?(ze=qe[(nn+1)%4],Ke=qe[(nn+2)%4]):(ze=qe[(nn+2)%4],Ke=qe[(nn+3)%4])),[f,ze,Ke,Qe]}function distance2Points(qe,f){return Math.sqrt(Math.pow(qe[0]-f[0],2)+Math.pow(qe[1]-f[1],2))}function crossVect(qe,f){return[qe[1]*f[2]-qe[2]*f[1],qe[2]*f[0]-qe[0]*f[2],qe[0]*f[1]-qe[1]*f[0]]}function dotVect(qe,f){return qe[0]*f[0]+qe[1]*f[1]+qe[2]*f[2]}function computeWidthAndHeigth(qe,f,ze,Ke,Qe,Pi){let nn=Math.max(distance2Points(qe,f),distance2Points(Ke,ze)),ln=Math.max(distance2Points(qe,Ke),distance2Points(f,ze)),cn=0,hn=0,un=Math.ceil(Qe/2),xs=Math.ceil(Pi/2),zn=nn/ln,Xn=[qe[0],qe[1],1],ys=[f[0],f[1],1],Jo=[Ke[0],Ke[1],1],ea=[ze[0],ze[1],1],ra=dotVect(crossVect(Xn,ea),Jo)/dotVect(crossVect(ys,ea),Jo),na=dotVect(crossVect(Xn,ea),ys)/dotVect(crossVect(Jo,ea),ys),ta=[ra*ys[0]-Xn[0],ra*ys[1]-Xn[1],ra*ys[2]-Xn[2]],ia=[na*Jo[0]-Xn[0],na*Jo[1]-Xn[1],na*Jo[2]-Xn[2]],sa=ta[0],Ma=ta[1],pa=ta[2],oa=ia[0],ha=ia[1],ca=ia[2],da=1/(pa*ca)*(sa*oa-(sa*ca+pa*oa)*un+pa*ca*un*un+(Ma*ha-(Ma*ca+pa*ha)*xs+pa*ca*xs*xs));da>=0?da=Math.sqrt(da):da=Math.sqrt(-da);let ga=new Matrix$1([[da,0,un],[0,da,xs],[0,0,1]]),qa=ga.transpose(),Ka=inverse(qa),il=inverse(ga),cl=Matrix$1.rowVector(ta),wl=Matrix$1.rowVector(ia),al=Math.sqrt(dotVect(cl.mmul(Ka).mmul(il).to1DArray(),ta)/dotVect(wl.mmul(Ka).mmul(il).to1DArray(),ia));return al===0||zn===0?(cn=Math.ceil(nn),hn=Math.ceil(ln)):al<zn?(cn=Math.ceil(nn),hn=Math.ceil(cn/al)):(hn=Math.ceil(ln),cn=Math.ceil(al*hn)),[cn,hn]}function projectionPoint(qe,f,ze,Ke,Qe,Pi,nn,ln,cn,hn,un,xs){let[zn,Xn]=[(ze*qe+Ke*f+Qe)/(cn*qe+hn*f+1),(Pi*qe+nn*f+ln)/(cn*qe+hn*f+1)];return un.getValueXY(Math.floor(zn),Math.floor(Xn),xs)}function warpingFourPoints(qe,f={}){let{calculateRatio:ze=!0}=f;if(qe.length!==4)throw new Error(`The array pts must have four elements, which are the four corners. Currently, pts have ${qe.length} elements`);let[Ke,Qe,Pi,nn]=qe,ln=[Ke,Qe,Pi,nn],[cn,hn,un,xs]=order4Points(ln),zn,Xn;ze?[zn,Xn]=computeWidthAndHeigth(cn,hn,un,xs,this.width,this.height):(zn=Math.ceil(Math.max(distance2Points(cn,hn),distance2Points(xs,un))),Xn=Math.ceil(Math.max(distance2Points(cn,xs),distance2Points(hn,un))));let ys=Image$1.createFrom(this,{width:zn,height:Xn}),[Jo,ea]=cn,[ra,na]=hn,[ta,ia]=un,[sa,Ma]=xs,[pa,oa]=[0,0],[ha,ca]=[0,zn-1],[da,ga]=[Xn-1,zn-1],[qa,Ka]=[Xn-1,0],il=new Matrix$1([[pa,oa,1,0,0,0,-pa*Jo,-oa*Jo],[ha,ca,1,0,0,0,-ha*ra,-ca*ra],[da,ga,1,0,0,0,-da*ta,-oa*ta],[qa,Ka,1,0,0,0,-qa*sa,-Ka*sa],[0,0,0,pa,oa,1,-pa*ea,-oa*ea],[0,0,0,ha,ca,1,-ha*na,-ca*na],[0,0,0,da,ga,1,-da*ia,-ga*ia],[0,0,0,qa,Ka,1,-qa*Ma,-Ka*Ma]]),cl=Matrix$1.columnVector([Jo,ra,ta,sa,ea,na,ia,Ma]),al=new SingularValueDecomposition(il).solve(cl),[vl,ml,ol,el,dl,xl,Ja,yl]=al.to1DArray(),Ol=new Matrix$1(Xn,zn);for(let Il=0;Il<this.channels;Il++){for(let Rl=0;Rl<Xn;Rl++)for(let Al=0;Al<zn;Al++)Ol.set(Rl,Al,projectionPoint(Rl,Al,vl,ml,ol,el,dl,xl,Ja,yl,this,Il));ys.setMatrix(Ol,{channel:Il})}return ys}function crop(qe={}){let{x:f=0,y:ze=0,width:Ke=this.width-f,height:Qe=this.height-ze}=qe;if(this.checkProcessable("crop",{bitDepth:[1,8,16]}),f=Math.round(f),ze=Math.round(ze),Ke=Math.round(Ke),Qe=Math.round(Qe),f>this.width-1||ze>this.height-1)throw new RangeError(`crop: origin (x:${f}, y:${ze}) out of range (${this.width-1}; ${this.height-1})`);if(Ke<=0||Qe<=0)throw new RangeError(`crop: width and height (width:${Ke}; height:${Qe}) must be positive numbers`);if(f<0||ze<0)throw new RangeError(`crop: x and y (x:${f}, y:${ze}) must be positive numbers`);if(Ke>this.width-f||Qe>this.height-ze)throw new RangeError(`crop: (x: ${f}, y:${ze}, width:${Ke}, height:${Qe}) size is out of range`);let Pi=this;if(this.bitDepth===1){const nn=new Image$1(Ke,Qe,{kind:"BINARY",parent:this});Pi=cropBinary(this,nn,f,ze,Ke,Qe)}else{const nn=Image$1.createFrom(this,{width:Ke,height:Qe,position:[f,ze]});Pi=cropDefault(this,nn,f,ze,Ke,Qe)}return Pi}function cropDefault(qe,f,ze,Ke,Qe,Pi){let nn=Qe*qe.channels,ln=Ke+Pi,cn=0,hn=ze*qe.channels;for(let un=Ke;un<ln;un++){let xs=un*qe.width*qe.channels+hn,zn=xs+nn;for(;xs<zn;xs++)f.data[cn++]=qe.data[xs]}return f}function cropBinary(qe,f,ze,Ke,Qe,Pi){let nn=Qe*qe.channels,ln=Ke+Pi,cn=0,hn=ze*qe.channels;for(let un=Ke;un<ln;un++){let xs=un*qe.width*qe.channels+hn,zn=xs+nn;for(;xs<zn;xs++)qe.getBit(xs)&&f.setBit(cn),++cn}return f}function cropAlpha(qe={}){this.checkProcessable("cropAlpha",{alpha:1});const{threshold:f=this.maxValue}=qe;let ze=findLeft(this,f,this.components);if(ze===-1)throw new Error("Could not find new dimensions. Threshold may be too high.");let Ke=findTop(this,f,this.components,ze),Qe=findBottom(this,f,this.components,ze),Pi=findRight(this,f,this.components,ze,Ke,Qe);return this.crop({x:ze,y:Ke,width:Pi-ze+1,height:Qe-Ke+1})}function findLeft(qe,f,ze){for(let Ke=0;Ke<qe.width;Ke++)for(let Qe=0;Qe<qe.height;Qe++)if(qe.getValueXY(Ke,Qe,ze)>=f)return Ke;return-1}function findTop(qe,f,ze,Ke){for(let Qe=0;Qe<qe.height;Qe++)for(let Pi=Ke;Pi<qe.width;Pi++)if(qe.getValueXY(Pi,Qe,ze)>=f)return Qe;return-1}function findBottom(qe,f,ze,Ke){for(let Qe=qe.height-1;Qe>=0;Qe--)for(let Pi=Ke;Pi<qe.width;Pi++)if(qe.getValueXY(Pi,Qe,ze)>=f)return Qe;return-1}function findRight(qe,f,ze,Ke,Qe,Pi){for(let nn=qe.width-1;nn>=Ke;nn--)for(let ln=Qe;ln<=Pi;ln++)if(qe.getValueXY(nn,ln,ze)>=f)return nn;return-1}function getFactor(qe){if(typeof qe=="string"){const f=qe[qe.length-1];qe=parseFloat(qe),f==="%"&&(qe/=100)}return qe}function getThreshold$1(qe,f){if(!f)throw Error("getThreshold : the maxValue should be specified");if(typeof qe=="string"){if(qe[qe.length-1]!=="%")throw Error("getThreshold : if the value is a string it must finish by %");return parseFloat(qe)/100*f}else{if(typeof qe=="number")return qe<1?qe*f:qe;throw Error("getThreshold : the value is not valid")}}function factorDimensions(qe,f,ze){qe=getFactor(qe);let Ke=Math.round(qe*f),Qe=Math.round(qe*ze);return Ke<=0&&(Ke=1),Qe<=0&&(Qe=1),{width:Ke,height:Qe}}function checkRow(qe,f){if(f<0||f>=qe.height)throw new RangeError(`row must be included between 0 and ${qe.height-1}. Current value: ${f}`)}function checkColumn(qe,f){if(f<0||f>=qe.width)throw new RangeError(`column must be included between 0 and ${qe.width-1}. Current value: ${f}`)}function checkChannel(qe,f){if(f<0||f>=qe.channels)throw new RangeError(`channel must be included between 0 and ${qe.channels-1}. Current value: ${f}`)}const validInterpolations={nearestneighbor:"nearestNeighbor",nearestneighbour:"nearestNeighbor",bilinear:"bilinear"};function checkInterpolation(qe){if(typeof qe!="string")throw new TypeError("interpolation must be a string");if(qe=qe.toLowerCase(),!validInterpolations[qe])throw new RangeError(`invalid interpolation algorithm: ${qe}`);return validInterpolations[qe]}function nearestNeighbor(qe,f,ze){const Ke=this.width/f,Qe=this.height/ze;if(this.bitDepth>1)for(let Pi=0;Pi<f;Pi++){const nn=Math.floor((Pi+.5)*Ke);for(let ln=0;ln<ze;ln++){const cn=Math.floor((ln+.5)*Qe);for(let hn=0;hn<this.channels;hn++)qe.setValueXY(Pi,ln,hn,this.getValueXY(nn,cn,hn))}}else for(let Pi=0;Pi<f;Pi++){const nn=Math.floor((Pi+.5)*Ke);for(let ln=0;ln<ze;ln++){const cn=Math.floor((ln+.5)*Qe);this.getBitXY(nn,cn)&&qe.setBitXY(Pi,ln)}}}function resize(qe={}){const{factor:f=1,interpolation:ze=validInterpolations.nearestneighbor,preserveAspectRatio:Ke=!0}=qe,Qe=checkInterpolation(ze);let Pi=qe.width,nn=qe.height;if(Pi||(nn&&Ke?Pi=Math.round(nn*(this.width/this.height)):Pi=this.width),nn||(Ke?nn=Math.round(Pi*(this.height/this.width)):nn=this.height),{width:Pi,height:nn}=factorDimensions(f,Pi,nn),Pi===this.width&&nn===this.height){const un=this.clone();return un.position=[0,0],un}let ln=Math.round((this.width-Pi)/2),cn=Math.round((this.height-nn)/2);const hn=Image$1.createFrom(this,{width:Pi,height:nn,position:[ln,cn]});switch(Qe){case validInterpolations.nearestneighbor:nearestNeighbor.call(this,hn,Pi,nn);break;default:throw new Error(`unsupported resize interpolation: ${Qe}`)}return hn}function hsv(){this.checkProcessable("hsv",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let qe=Image$1.createFrom(this,{colorModel:HSV}),f=0,ze=this.data;for(let Ke=0;Ke<ze.length;Ke+=this.channels){let Qe=ze[Ke],Pi=ze[Ke+1],nn=ze[Ke+2],ln=Math.min(Qe,Pi,nn),cn=Math.max(Qe,Pi,nn),hn=cn-ln,un=0,xs=cn===0?0:hn/cn,zn=cn;if(cn!==ln){switch(cn){case Qe:un=(Pi-nn)/hn+(Pi<nn?6:0);break;case Pi:un=(nn-Qe)/hn+2;break;case nn:un=(Qe-Pi)/hn+4;break;default:throw new Error("unreachable")}un/=6}qe.data[f++]=un*this.maxValue,qe.data[f++]=xs*this.maxValue,qe.data[f++]=zn,this.alpha&&(qe.data[f++]=ze[Ke+3])}return qe}function hsl$1(){this.checkProcessable("hsl",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let qe=Image$1.createFrom(this,{colorModel:HSL}),f=Math.floor(this.maxValue/2),ze=0,Ke=this.data;for(let Qe=0;Qe<Ke.length;Qe+=this.channels){let Pi=Ke[Qe],nn=Ke[Qe+1],ln=Ke[Qe+2],cn=Math.max(Pi,nn,ln),hn=Math.min(Pi,nn,ln),un=0,xs=0,zn=(cn+hn)/2;if(cn!==hn){let Xn=cn-hn;switch(xs=zn>f?Xn/(2-cn-hn):Xn/(cn+hn),cn){case Pi:un=(nn-ln)/Xn+(nn<ln?6:0);break;case nn:un=(ln-Pi)/Xn+2;break;case ln:un=(Pi-nn)/Xn+4;break;default:throw new Error("unreachable")}un/=6}qe.data[ze++]=un*this.maxValue,qe.data[ze++]=xs*this.maxValue,qe.data[ze++]=zn,this.alpha&&(qe.data[ze++]=Ke[Qe+3])}return qe}function cmyk(){this.checkProcessable("cmyk",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let qe=Image$1.createFrom(this,{components:4,colorModel:CMYK$1}),f=0,ze=this.data;for(let Ke=0;Ke<ze.length;Ke+=this.channels){let Qe=ze[Ke],Pi=ze[Ke+1],nn=ze[Ke+2],ln=Math.min(this.maxValue-Qe,this.maxValue-Pi,this.maxValue-nn),cn=(this.maxValue-Qe-ln)/(1-ln/this.maxValue),hn=(this.maxValue-Pi-ln)/(1-ln/this.maxValue),un=(this.maxValue-nn-ln)/(1-ln/this.maxValue);qe.data[f++]=Math.round(cn),qe.data[f++]=Math.round(hn),qe.data[f++]=Math.round(un),qe.data[f++]=Math.round(ln),this.alpha&&(qe.data[f++]=ze[Ke+3])}return qe}function rgba8(){return new Image$1(this.width,this.height,this.getRGBAData(),{kind:"RGBA",parent:this})}const methods$1={luma709(qe,f,ze){return qe*6966+f*23436+ze*2366>>15},luma601(qe,f,ze){return qe*9798+f*19235+ze*3735>>15},maximum(qe,f,ze){return Math.max(qe,f,ze)},minimum(qe,f,ze){return Math.min(qe,f,ze)},average(qe,f,ze){return(qe+f+ze)/3>>0},minmax(qe,f,ze){return(Math.max(qe,f,ze)+Math.min(qe,f,ze))/2},red(qe){return qe},green(qe,f){return f},blue(qe,f,ze){return ze},cyan(qe,f,ze,Ke){let Qe=methods$1.black(qe,f,ze,Ke);return(Ke.maxValue-qe-Qe)/(1-Qe/Ke.maxValue)>>0},magenta(qe,f,ze,Ke){let Qe=methods$1.black(qe,f,ze,Ke);return(Ke.maxValue-f-Qe)/(1-Qe/Ke.maxValue)>>0},yellow(qe,f,ze,Ke){let Qe=methods$1.black(qe,f,ze,Ke);return(Ke.maxValue-ze-Qe)/(1-Qe/Ke.maxValue)>>0},black(qe,f,ze,Ke){return Math.min(Ke.maxValue-qe,Ke.maxValue-f,Ke.maxValue-ze)},hue(qe,f,ze,Ke){let Qe=methods$1.min(qe,f,ze),Pi=methods$1.max(qe,f,ze);if(Pi===Qe)return 0;let nn=0,ln=Pi-Qe;switch(Pi){case qe:nn=(f-ze)/ln+(f<ze?6:0);break;case f:nn=(ze-qe)/ln+2;break;case ze:nn=(qe-f)/ln+4;break;default:throw new Error("unreachable")}return nn/6*Ke.maxValue>>0},saturation(qe,f,ze,Ke){let Qe=methods$1.min(qe,f,ze),Pi=methods$1.max(qe,f,ze),nn=Pi-Qe;return Pi===0?0:nn/Pi*Ke.maxValue},lightness(qe,f,ze){let Ke=methods$1.min(qe,f,ze);return(methods$1.max(qe,f,ze)+Ke)/2}};Object.defineProperty(methods$1,"luminosity",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"luminance",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"min",{enumerable:!1,value:methods$1.minimum});Object.defineProperty(methods$1,"max",{enumerable:!1,value:methods$1.maximum});Object.defineProperty(methods$1,"brightness",{enumerable:!1,value:methods$1.maximum});Object.keys(methods$1).forEach(qe=>{});function grey(qe={}){let{algorithm:f="luma709",keepAlpha:ze=!1,mergeAlpha:Ke=!0}=qe;if(typeof f!="string"&&typeof f!="function")throw new TypeError("algorithm must be a string or a function");this.checkProcessable("grey",{bitDepth:[8,16],alpha:[0,1]}),this.components===1&&(f="red"),ze&=this.alpha,Ke&=this.alpha,ze&&(Ke=!1);let Qe=getOutputImage(this,qe,{components:1,alpha:ze,colorModel:GREY$1}),Pi;if(typeof f=="function")Pi=f;else if(Pi=methods$1[f.toLowerCase()],!Pi)throw new Error(`unsupported grey algorithm: ${f}`);let nn=0;for(let ln=0;ln<this.data.length;ln+=this.channels)Ke?Qe.data[nn++]=clamp(Pi(this.data[ln],this.data[ln+1],this.data[ln+2],this)*this.data[ln+this.components]/this.maxValue,this):(Qe.data[nn++]=clamp(Pi(this.data[ln],this.data[ln+1],this.data[ln+2],this),this),Qe.alpha&&(Qe.data[nn++]=this.data[ln+this.components]));return Qe}function huang(qe){let f=0;for(let un=0;un<qe.length;un++)if(qe[un]!==0){f=un;break}let ze=qe.length-1;for(let un=qe.length-1;un>=f;un--)if(qe[un]!==0){ze=un;break}let Ke=1/(ze-f),Qe=new Array(qe.length),Pi=0,nn=0;for(let un=f;un<qe.length;un++)Pi+=un*qe[un],nn+=qe[un],Qe[un]=Pi/nn;let ln=new Array(qe.length);Pi=nn=0;for(let un=ze;un>0;un--)Pi+=un*qe[un],nn+=qe[un],ln[un-1]=Pi/nn;let cn=-1,hn=Number.MAX_VALUE;for(let un=0;un<qe.length;un++){let xs=0,zn;for(let Xn=0;Xn<=un;Xn++)zn=1/(1+Ke*Math.abs(Xn-Qe[un])),zn<1e-6||zn>.999999||(xs+=qe[Xn]*(-zn*Math.log(zn)-(1-zn)*Math.log(1-zn)));for(let Xn=un+1;Xn<qe.length;Xn++)zn=1/(1+Ke*Math.abs(Xn-ln[un])),zn<1e-6||zn>.999999||(xs+=qe[Xn]*(-zn*Math.log(zn)-(1-zn)*Math.log(1-zn)));xs<hn&&(hn=xs,cn=un)}return cn}function intermodes(qe){let f=qe.slice(),ze=0;for(;!bimodalTest$1(f);){let Qe=0,Pi=0,nn=f[0];for(let ln=0;ln<qe.length-1;ln++)Qe=Pi,Pi=nn,nn=f[ln+1],f[ln]=(Qe+Pi+nn)/3;if(f[qe.length-1]=(Pi+nn)/3,ze++,ze>1e4)throw new Error("Intermodes Threshold not found after 10000 iterations")}let Ke=0;for(let Qe=1;Qe<qe.length-1;Qe++)f[Qe-1]<f[Qe]&&f[Qe+1]<f[Qe]&&(Ke+=Qe);return Math.floor(Ke/2)}function bimodalTest$1(qe){let f=!1,ze=0;for(let Ke=1;Ke<qe.length-1;Ke++)if(qe[Ke-1]<qe[Ke]&&qe[Ke+1]<qe[Ke]&&(ze++,ze>2))return!1;return ze===2&&(f=!0),f}function isodata(qe){let f,ze,Ke,Qe,Pi=0;for(let nn=1;nn<qe.length;nn++)if(qe[nn]>0){Pi=nn+1;break}for(;;){f=0,Ke=0;for(let nn=0;nn<Pi;nn++)Ke=Ke+qe[nn],f=f+qe[nn]*nn;Qe=0,ze=0;for(let nn=Pi+1;nn<qe.length;nn++)ze+=qe[nn],Qe+=qe[nn]*nn;if(Ke>0&&ze>0&&(f/=Ke,Qe/=ze,Pi===Math.round((f+Qe)/2)))break;if(Pi++,Pi>qe.length-2)throw new Error("Threshold not found")}return Pi}function li(qe,f){let ze,Ke,Qe,Pi,nn,ln,cn,hn,un,xs,zn,Xn;zn=.5,xs=0;for(let ys=0;ys<qe.length;ys++)xs+=ys*qe[ys];xs/=f,cn=xs;do{ln=cn,ze=ln+.5|0,Ke=0,Pi=0;for(let ys=0;ys<=ze;ys++)Ke+=ys*qe[ys],Pi+=qe[ys];hn=Pi===0?0:Ke/Pi,Qe=0,nn=0;for(let ys=ze+1;ys<qe.length;ys++)Qe+=ys*qe[ys],nn+=qe[ys];un=nn===0?0:Qe/nn,Xn=(hn-un)/(Math.log(hn)-Math.log(un)),Xn<-Number.EPSILON?cn=Xn-.5|0:cn=Xn+.5|0}while(Math.abs(cn-ln)>zn);return ze}function maxEntropy(qe,f){let ze=new Array(qe.length);for(let zn=0;zn<qe.length;zn++)ze[zn]=qe[zn]/f;let Ke=new Array(qe.length),Qe=new Array(qe.length);Ke[0]=ze[0],Qe[0]=1-Ke[0];for(let zn=1;zn<qe.length;zn++)Ke[zn]=Ke[zn-1]+ze[zn],Qe[zn]=1-Ke[zn];let Pi=0;for(let zn=0;zn<qe.length;zn++)if(Math.abs(Ke[zn])>=Number.EPSILON){Pi=zn;break}let nn=qe.length-1;for(let zn=qe.length-1;zn>=Pi;zn--)if(Math.abs(Qe[zn])>=Number.EPSILON){nn=zn;break}let ln=-1,cn,hn=Number.MIN_VALUE,un,xs;for(let zn=Pi;zn<=nn;zn++){un=0;for(let Xn=0;Xn<=zn;Xn++)qe[Xn]!==0&&(un-=ze[Xn]/Ke[zn]*Math.log(ze[Xn]/Ke[zn]));xs=0;for(let Xn=zn+1;Xn<qe.length;Xn++)qe[Xn]!==0&&(xs-=ze[Xn]/Qe[zn]*Math.log(ze[Xn]/Qe[zn]));cn=un+xs,hn<cn&&(hn=cn,ln=zn)}return ln}function mean$1(qe,f){let ze=0;for(let Ke=0;Ke<qe.length;Ke++)ze+=Ke*qe[Ke];return Math.floor(ze/f)}function minError(qe,f){let ze,Ke=-2,Qe,Pi,nn,ln,cn,hn,un,xs,zn,Xn,ys,Jo=0;for(let ea=0;ea<qe.length;ea++)Jo+=ea*qe[ea];for(Jo/=f,ze=Jo;ze!==Ke;){let ea=sumA(qe,ze),ra=sumA(qe,qe.length-1),na=sumB(qe,ze),ta=sumB(qe,qe.length-1),ia=sumC(qe,ze),sa=sumC(qe,qe.length-1);if(Qe=na/ea,Pi=(ta-na)/(ra-ea),nn=ea/ra,ln=(ra-ea)/ra,cn=ia/ea-Qe*Qe,hn=(sa-ia)/(ra-ea)-Pi*Pi,un=1/cn-1/hn,xs=Qe/cn-Pi/hn,zn=Qe*Qe/cn-Pi*Pi/hn+Math.log10(cn*(ln*ln)/(hn*(nn*nn))),Xn=xs*xs-un*zn,Xn<0)return ze;Ke=ze,ys=(xs+Math.sqrt(Xn))/un,isNaN(ys)?ze=Ke:ze=Math.floor(ys)}return ze}function sumA(qe,f){let ze=0;for(let Ke=0;Ke<=f;Ke++)ze+=qe[Ke];return ze}function sumB(qe,f){let ze=0;for(let Ke=0;Ke<=f;Ke++)ze+=Ke*qe[Ke];return ze}function sumC(qe,f){let ze=0;for(let Ke=0;Ke<=f;Ke++)ze+=Ke*Ke*qe[Ke];return ze}function minimum(qe){if(qe.length<2)return 0;let f=0,ze=-1,Ke=-1,Qe=new Array(qe.length);for(let Pi=0;Pi<qe.length;Pi++)Qe[Pi]=qe[Pi],qe[Pi]>0&&(Ke=Pi);for(;!bimodalTest(Qe);)if(Qe=smoothed(Qe),f++,f>1e4)return ze;return ze=minimumBetweenPeeks(Qe,Ke),ze}function smoothed(qe){let f=new Array(qe.length);for(let ze=1;ze<qe.length-1;ze++)f[ze]=(qe[ze-1]+qe[ze]+qe[ze+1])/3;return f[0]=(qe[0]+qe[1])/3,f[qe.length-1]=(qe[qe.length-2]+qe[qe.length-1])/3,f}function minimumBetweenPeeks(qe,f){let ze;for(let Ke=1;Ke<f;Ke++)if(qe[Ke-1]>qe[Ke]&&qe[Ke+1]>=qe[Ke]){ze=Ke;break}return ze}function bimodalTest(qe){let f=qe.length,ze=!1,Ke=0;for(let Qe=1;Qe<f-1;Qe++)if(qe[Qe-1]<qe[Qe]&&qe[Qe+1]<qe[Qe]&&(Ke++,Ke>2))return!1;return Ke===2&&(ze=!0),ze}function moments(qe,f){let ze=1,Ke=0,Qe=0,Pi=0,nn=0,ln,cn,hn,un,xs,zn,Xn=-1,ys=qe.length,Jo=new Array(ys);for(let ea=0;ea<ys;ea++)Jo[ea]=qe[ea]/f;for(let ea=0;ea<ys;ea++)Ke+=ea*Jo[ea],Qe+=ea*ea*Jo[ea],Pi+=ea*ea*ea*Jo[ea];cn=ze*Qe-Ke*Ke,hn=(-Qe*Qe+Ke*Pi)/cn,un=(ze*-Pi+Qe*Ke)/cn,xs=.5*(-un-Math.sqrt(un*un-4*hn)),zn=.5*(-un+Math.sqrt(un*un-4*hn)),ln=(zn-Ke)/(zn-xs);for(let ea=0;ea<ys;ea++)if(nn+=Jo[ea],nn>ln){Xn=ea;break}return Xn}function otsu(qe,f){let ze=0,Ke=0,Qe=0,Pi=0,nn=0;for(let ln=0;ln<qe.length;ln++)nn+=ln*qe[ln];for(let ln=0;ln<qe.length;ln++){Ke=Ke+qe[ln];const cn=f-Ke;if(Ke===0||cn===0)continue;ze=ze+ln*qe[ln];const hn=(nn-ze)/cn,un=Ke*cn*(ze/Ke-hn)*(ze/Ke-hn);un>=Qe&&(Pi=ln,Qe=un)}return Pi}function percentile(qe){let f=-1,ze=.5,Ke=new Array(qe.length),Qe=partialSum(qe,qe.length-1),Pi=1;for(let nn=0;nn<qe.length;nn++)Ke[nn]=Math.abs(partialSum(qe,nn)/Qe-ze),Ke[nn]<Pi&&(Pi=Ke[nn],f=nn);return f}function partialSum(qe,f){let ze=0;for(let Ke=0;Ke<=f;Ke++)ze+=qe[Ke];return ze}function renyiEntropy(qe,f){let ze,Ke,Qe,Pi=new Array(qe.length),nn=new Array(qe.length),ln=new Array(qe.length),cn=0,hn=0,un=0,xs=0,zn=0,Xn=0,Jo=1/(1-.5),ra=1/(1-2);for(let sa=0;sa<qe.length;sa++)Pi[sa]=qe[sa]/f;nn[0]=Pi[0],ln[0]=1-nn[0];for(let sa=1;sa<qe.length;sa++)nn[sa]=nn[sa-1]+Pi[sa],ln[sa]=1-nn[sa];Ke=0;for(let sa=0;sa<qe.length;sa++)if(Math.abs(nn[sa])>=Number.EPSILON){Ke=sa;break}Qe=qe.length-1;for(let sa=qe.length-1;sa>=Ke;sa--)if(Math.abs(ln[sa])>=Number.EPSILON){Qe=sa;break}for(let sa=Ke;sa<=Qe;sa++){let Ma=0,pa=0,oa=0;for(let il=0;il<=sa;il++)qe[il]!==0&&(Ma-=Pi[il]/nn[sa]*Math.log(Pi[il]/nn[sa])),pa+=Math.sqrt(Pi[il]/nn[sa]),oa+=Pi[il]*Pi[il]/(nn[sa]*nn[sa]);let ha=0,ca=0,da=0;for(let il=sa+1;il<qe.length;il++)qe[il]!==0&&(ha-=Pi[il]/ln[sa]*Math.log(Pi[il]/ln[sa])),ca+=Math.sqrt(Pi[il]/ln[sa]),da+=Pi[il]*Pi[il]/(ln[sa]*ln[sa]);let ga=Ma+ha,qa=Jo*(pa*ca>0?Math.log(pa*ca):0),Ka=ra*(oa*da>0?Math.log(oa*da):0);ga>xs&&(xs=ga,cn=sa),qa>zn&&(zn=qa,hn=sa),Ka>Xn&&(Xn=Ka,un=sa)}let na=[cn,hn,un];na.sort((sa,Ma)=>sa-Ma);let ta;Math.abs(na[0]-na[1])<=5?Math.abs(na[1]-na[2])<=5?ta=[1,2,1]:ta=[0,1,3]:Math.abs(na[1]-na[2])<=5?ta=[3,1,0]:ta=[1,2,1];let ia=nn[na[2]]-nn[na[0]];return ze=Math.round(na[0]*(nn[na[0]]+.25*ia*ta[0])+.25*na[1]*ia*ta[1]+na[2]*(ln[na[2]]+.25*ia*ta[2])),ze}function shanbhag(qe,f){let ze=new Array(qe.length);for(let Xn=0;Xn<qe.length;Xn++)ze[Xn]=qe[Xn]/f;let Ke=new Array(qe.length),Qe=new Array(qe.length);Ke[0]=ze[0],Qe[0]=1-Ke[0];for(let Xn=1;Xn<qe.length;Xn++)Ke[Xn]=Ke[Xn-1]+ze[Xn],Qe[Xn]=1-Ke[Xn];let Pi=0;for(let Xn=0;Xn<qe.length;Xn++)if(Math.abs(Ke[Xn])>=Number.EPSILON){Pi=Xn;break}let nn=qe.length-1;for(let Xn=qe.length-1;Xn>=Pi;Xn--)if(Math.abs(Qe[Xn])>=Number.EPSILON){nn=Xn;break}let ln=-1,cn=Number.MAX_VALUE,hn,un,xs,zn;for(let Xn=Pi;Xn<=nn;Xn++){xs=0,hn=.5/Ke[Xn];for(let ys=1;ys<=Xn;ys++)xs-=ze[ys]*Math.log(1-hn*Ke[ys-1]);xs*=hn,zn=0,hn=.5/Qe[Xn];for(let ys=Xn+1;ys<qe.length;ys++)zn-=ze[ys]*Math.log(1-hn*Qe[ys]);zn*=hn,un=Math.abs(xs-zn),un<cn&&(cn=un,ln=Xn)}return ln}function triangle$1(qe){let f=0,ze=0,Ke=0,Qe=0;for(let xs=0;xs<qe.length;xs++)if(qe[xs]>0){f=xs;break}f>0&&f--;for(let xs=qe.length-1;xs>0;xs--)if(qe[xs]>0){Qe=xs;break}Qe<qe.length-1&&Qe++;for(let xs=0;xs<qe.length;xs++)qe[xs]>ze&&(Ke=xs,ze=qe[xs]);let Pi=!1;if(Ke-f<Qe-Ke){Pi=!0;let xs=0,zn=qe.length-1;for(;xs<zn;){let Xn=qe[xs];qe[xs]=qe[zn],qe[zn]=Xn,xs++,zn--}f=qe.length-1-Qe,Ke=qe.length-1-Ke}if(f===Ke)return f;let nn,ln,cn;nn=qe[Ke],ln=f-Ke,cn=Math.sqrt(nn*nn+ln*ln),nn/=cn,ln/=cn,cn=nn*f+ln*qe[f];let hn=f,un=0;for(let xs=f+1;xs<=Ke;xs++){let zn=nn*xs+ln*qe[xs]-cn;zn>un&&(hn=xs,un=zn)}if(hn--,Pi){let xs=0,zn=qe.length-1;for(;xs<zn;){let Xn=qe[xs];qe[xs]=qe[zn],qe[zn]=Xn,xs++,zn--}return qe.length-1-hn}else return hn}function yen(qe,f){let ze=new Array(qe.length);for(let hn=0;hn<qe.length;hn++)ze[hn]=qe[hn]/f;let Ke=new Array(qe.length);Ke[0]=ze[0];for(let hn=1;hn<qe.length;hn++)Ke[hn]=Ke[hn-1]+ze[hn];let Qe=new Array(qe.length);Qe[0]=ze[0]*ze[0];for(let hn=1;hn<qe.length;hn++)Qe[hn]=Qe[hn-1]+ze[hn]*ze[hn];let Pi=new Array(qe.length);Pi[qe.length-1]=0;for(let hn=qe.length-2;hn>=0;hn--)Pi[hn]=Pi[hn+1]+ze[hn+1]*ze[hn+1];let nn=-1,ln=Number.MIN_VALUE,cn;for(let hn=0;hn<qe.length;hn++)cn=-1*(Qe[hn]*Pi[hn]>0?Math.log(Qe[hn]*Pi[hn]):0)+2*(Ke[hn]*(1-Ke[hn])>0?Math.log(Ke[hn]*(1-Ke[hn])):0),cn>ln&&(ln=cn,nn=hn);return nn}const methods={huang,intermodes,isodata,li,maxentropy:maxEntropy,mean:mean$1,minerror:minError,minimum,moments,otsu,percentile,renyientropy:renyiEntropy,shanbhag,triangle:triangle$1,yen},names={};Object.keys(methods).forEach(qe=>{names[qe]=qe});function getThreshold(qe={}){let{algorithm:f=names.otsu}=qe;this.checkProcessable("getThreshold",{components:1,bitDepth:[8,16]});let ze=methods[f.toLowerCase()];if(ze){let Ke=this.getHistogram();return ze(Ke,this.size)}else throw new Error(`unknown thresholding algorithm: ${f}`)}const THRESHOLD="threshold";function mask(qe={}){let{algorithm:f=THRESHOLD,threshold:ze=.5,useAlpha:Ke=!0,invert:Qe=!1}=qe;this.checkProcessable("mask",{components:1,bitDepth:[8,16]}),f===THRESHOLD?ze=getThreshold$1(ze,this.maxValue):ze=getThreshold.call(this,qe);let Pi=new Image$1(this.width,this.height,{kind:"BINARY",parent:this}),nn=0;if(this.alpha&&Ke)for(let ln=0;ln<this.data.length;ln+=this.channels){let cn=this.data[ln]+(this.maxValue-this.data[ln])*(this.maxValue-this.data[ln+1])/this.maxValue;(Qe&&cn<=ze||!Qe&&cn>=ze)&&Pi.setBit(nn),nn++}else for(let ln=0;ln<this.data.length;ln+=this.channels)(Qe&&this.data[ln]<=ze||!Qe&&this.data[ln]>=ze)&&Pi.setBit(nn),nn++;return Pi}function copyImage(qe,f,ze,Ke){let Qe=qe.width,Pi=qe.height,nn=f.width,ln=qe.channels;for(let cn=0;cn<Qe;cn++)for(let hn=0;hn<Pi;hn++)for(let un=0;un<ln;un++){let xs=(hn*Qe+cn)*ln+un,zn=((Ke+hn)*nn+ze+cn)*ln+un;f.data[zn]=qe.data[xs]}}function pad(qe={}){let{size:f=0,algorithm:ze="copy",color:Ke}=qe;if(this.checkProcessable("pad",{bitDepth:[8,16]}),ze==="set"){if(Ke.length!==this.channels)throw new Error(`pad: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let cn=0;cn<Ke.length;cn++)Ke[cn]===0&&(Ke[cn]=.001)}else Ke=newArray(this.channels,null);Array.isArray(f)||(f=[f,f]);let Qe=this.width+f[0]*2,Pi=this.height+f[1]*2,nn=this.channels,ln=Image$1.createFrom(this,{width:Qe,height:Pi});copyImage(this,ln,f[0],f[1]);for(let cn=f[0];cn<Qe-f[0];cn++)for(let hn=0;hn<nn;hn++){let un=Ke[hn]||ln.data[(f[1]*Qe+cn)*nn+hn];for(let xs=0;xs<f[1];xs++)ln.data[(xs*Qe+cn)*nn+hn]=un;un=Ke[hn]||ln.data[((Pi-f[1]-1)*Qe+cn)*nn+hn];for(let xs=Pi-f[1];xs<Pi;xs++)ln.data[(xs*Qe+cn)*nn+hn]=un}for(let cn=0;cn<Pi;cn++)for(let hn=0;hn<nn;hn++){let un=Ke[hn]||ln.data[(cn*Qe+f[0])*nn+hn];for(let xs=0;xs<f[0];xs++)ln.data[(cn*Qe+xs)*nn+hn]=un;un=Ke[hn]||ln.data[(cn*Qe+Qe-f[0]-1)*nn+hn];for(let xs=Qe-f[0];xs<Qe;xs++)ln.data[(cn*Qe+xs)*nn+hn]=un}return ln}function colorDepth(qe=8){if(this.checkProcessable("colorDepth",{bitDepth:[1,8,16]}),![8,16].includes(qe))throw Error("You need to specify the new colorDepth as 8 or 16");if(this.bitDepth===qe)return this.clone();let f=Image$1.createFrom(this,{bitDepth:qe});switch(qe){case 8:if(this.bitDepth===1)for(let ze=0;ze<this.size;ze++)this.getBit(ze)&&(f.data[ze]=255);else for(let ze=0;ze<this.data.length;ze++)f.data[ze]=this.data[ze]>>8;break;case 16:if(this.bitDepth===1)for(let ze=0;ze<this.size;ze++)this.getBit(ze)&&(f.data[ze]=65535);else for(let ze=0;ze<this.data.length;ze++)f.data[ze]=this.data[ze]<<8|this.data[ze];break;default:throw new Error("colorDepth conversion unexpected case")}return f}function rotateFree(qe,f={}){const{interpolation:ze=validInterpolations.nearestneighbor,width:Ke=this.width,height:Qe=this.height}=f;if(typeof qe!="number")throw new TypeError("degrees must be a number");const Pi=checkInterpolation(ze),nn=qe*Math.PI/180,ln=Math.floor(Math.abs(Ke*Math.cos(nn))+Math.abs(Qe*Math.sin(nn))),cn=Math.floor(Math.abs(Qe*Math.cos(nn))+Math.abs(Ke*Math.sin(nn))),hn=Math.cos(-nn),un=Math.sin(-nn);let xs=ln/2,zn=cn/2;ln%2===0?(xs=xs-.5,cn%2===0?zn=zn-.5:zn=Math.floor(zn)):(xs=Math.floor(xs),cn%2===0?zn=zn-.5:zn=Math.floor(zn));const Xn=Math.floor(Ke/2-xs),ys=Math.floor(Qe/2-zn);if(this.bitDepth===1){const Jo=new Image$1(ln,cn,{kind:"BINARY",parent:this});switch(Pi){case validInterpolations.nearestneighbor:return rotateBinaryNearestNeighbor(this,Jo,Xn,ys,xs,zn,hn,un);case validInterpolations.bilinear:return rotateBinaryBilinear(this,Jo,Xn,ys,xs,zn,hn,un);default:throw new Error(`unsupported rotate interpolation: ${Pi}`)}}else{const Jo=Image$1.createFrom(this,{width:ln,height:cn});switch(Pi){case validInterpolations.nearestneighbor:return rotateNearestNeighbor(this,Jo,Xn,ys,xs,zn,hn,un);case validInterpolations.bilinear:return rotateBilinear(this,Jo,Xn,ys,xs,zn,hn,un);default:throw new Error(`unsupported rotate interpolation: ${Pi}`)}}}function rotateNearestNeighbor(qe,f,ze,Ke,Qe,Pi,nn,ln){for(let cn=0;cn<f.width;cn+=1)for(let hn=0;hn<f.height;hn+=1)for(let un=0;un<qe.channels;un++){let xs=Math.round((cn-Qe)*nn-(hn-Pi)*ln+Qe)+ze,zn=Math.round((hn-Pi)*nn+(cn-Qe)*ln+Pi)+Ke;xs<0||xs>=qe.width||zn<0||zn>=qe.height?qe.alpha===1&&un===qe.channels-1?f.setValueXY(cn,hn,un,0):f.setValueXY(cn,hn,un,qe.maxValue):f.setValueXY(cn,hn,un,qe.getValueXY(xs,zn,un))}return f}function rotateBinaryNearestNeighbor(qe,f,ze,Ke,Qe,Pi,nn,ln){for(let cn=0;cn<f.width;cn+=1)for(let hn=0;hn<f.height;hn+=1){let un=Math.round((cn-Qe)*nn-(hn-Pi)*ln+Qe)+ze,xs=Math.round((hn-Pi)*nn+(cn-Qe)*ln+Pi)+Ke;(un<0||un>=qe.width||xs<0||xs>=qe.height||qe.getBitXY(un,xs))&&f.setBitXY(cn,hn)}return f}function rotateBilinear(qe,f,ze,Ke,Qe,Pi,nn,ln){let cn=qe.width*qe.channels;for(let hn=0;hn<f.height;hn++)for(let un=0;un<f.width;un++){let xs=(un-Qe)*nn-(hn-Pi)*ln+Qe+ze,zn=(hn-Pi)*nn+(un-Qe)*ln+Pi+Ke,Xn=xs|0,ys=zn|0,Jo=xs-Xn,ea=zn-ys;for(let ra=0;ra<qe.channels;ra++)if(xs<0||xs>=qe.width||zn<0||zn>=qe.height)qe.alpha===1&&ra===qe.channels-1?f.setValueXY(un,hn,ra,0):f.setValueXY(un,hn,ra,qe.maxValue);else{let na=(ys*qe.width+Xn)*qe.channels+ra,ta=qe.data[na],ia=qe.data[na+qe.channels],sa=qe.data[na+cn],Ma=qe.data[na+cn+qe.channels],pa=ta+Jo*(ia-ta)+ea*(sa-ta)+Jo*ea*(ta-ia-sa+Ma)|0;f.setValueXY(un,hn,ra,pa)}}return f}function rotateBinaryBilinear(qe,f,ze,Ke,Qe,Pi,nn,ln){let cn=qe.width;for(let hn=0;hn<f.height;hn++)for(let un=0;un<f.width;un++){let xs=(un-Qe)*nn-(hn-Pi)*ln+Qe+ze,zn=(hn-Pi)*nn+(un-Qe)*ln+Pi+Ke,Xn=xs|0,ys=zn|0,Jo=xs-Xn,ea=zn-ys;if(xs<0||xs>=qe.width||zn<0||zn>=qe.height)f.setBitXY(un,hn);else{let ra=ys*qe.width+Xn,na=qe.getBit(ra),ta=qe.getBit(ra+1),ia=qe.getBit(ra+cn),sa=qe.getBit(ra+1+cn);(na|Jo&ta-na|ea&ia-na|Jo&ea&na-ta-ia+sa)>0&&f.setBitXY(un,hn)}}return f}function rotate$1(qe,f){if(this.checkProcessable("rotate",{bitDepth:[1,8,16]}),typeof qe!="number")throw new TypeError("angle must be a number");switch(qe<0&&(qe=Math.ceil(-qe/360)*360+qe),qe%360){case 0:return this.clone();case 90:return rotateRight.call(this);case 180:return rotate180.call(this);case 270:return rotateLeft.call(this);default:return rotateFree.call(this,qe,f)}}function rotateLeft(){if(this.bitDepth===1){const qe=new Image$1(this.height,this.width,{kind:"BINARY",parent:this}),f=qe.height-1;for(let ze=0;ze<this.height;ze++)for(let Ke=0;Ke<this.width;Ke++)this.getBitXY(Ke,ze)&&qe.setBitXY(ze,f-Ke);return qe}else{const qe=Image$1.createFrom(this,{width:this.height,height:this.width}),f=qe.height-1;for(let ze=0;ze<this.height;ze++)for(let Ke=0;Ke<this.width;Ke++)for(let Qe=0;Qe<this.channels;Qe++)qe.setValueXY(ze,f-Ke,Qe,this.getValueXY(Ke,ze,Qe));return qe}}function rotateRight(){if(this.bitDepth===1){const qe=new Image$1(this.height,this.width,{kind:"BINARY",parent:this}),f=qe.width-1;for(let ze=0;ze<this.height;ze++)for(let Ke=0;Ke<this.width;Ke++)this.getBitXY(Ke,ze)&&qe.setBitXY(f-ze,Ke);return qe}else{const qe=Image$1.createFrom(this,{width:this.height,height:this.width}),f=qe.width-1;for(let ze=0;ze<this.height;ze++)for(let Ke=0;Ke<this.width;Ke++)for(let Qe=0;Qe<this.channels;Qe++)qe.setValueXY(f-ze,Ke,Qe,this.getValueXY(Ke,ze,Qe));return qe}}function rotate180(){if(this.bitDepth===1){const qe=new Image$1(this.width,this.height,{kind:"BINARY",parent:this}),f=qe.width-1,ze=qe.height-1;for(let Ke=0;Ke<this.height;Ke++)for(let Qe=0;Qe<this.width;Qe++)this.getBitXY(Qe,Ke)&&qe.setBitXY(f-Qe,ze-Ke);return qe}else{const qe=Image$1.createFrom(this),f=qe.width-1,ze=qe.height-1;for(let Ke=0;Ke<this.height;Ke++)for(let Qe=0;Qe<this.width;Qe++)for(let Pi=0;Pi<this.channels;Pi++)qe.setValueXY(f-Qe,ze-Ke,Pi,this.getValueXY(Qe,Ke,Pi));return qe}}function insert(qe,f={}){const ze=getImageParameters(qe);this.checkProcessable("insert",ze);let{x:Ke=0,y:Qe=0}=f;const Pi=getOutputImageOrInPlace(this,f,{copy:!0}),nn=Math.min(Pi.height,Qe+qe.height),ln=Math.min(Pi.width,Ke+qe.width);if(Pi.bitDepth===1)for(let cn=Qe;cn<nn;cn++)for(let hn=Ke;hn<ln;hn++)qe.getBitXY(hn-Ke,cn-Qe)?Pi.setBitXY(hn,cn):Pi.clearBitXY(hn,cn);else for(let cn=Qe;cn<nn;cn++)for(let hn=Ke;hn<ln;hn++)Pi.setPixelXY(hn,cn,qe.getPixelXY(hn-Ke,cn-Qe));return Pi}function setBorder(qe={}){let{size:f=0,algorithm:ze="copy",color:Ke}=qe;if(this.checkProcessable("setBorder",{bitDepth:[8,16,32,64]}),ze==="set"){if(Ke.length!==this.channels)throw new Error(`setBorder: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let ln=0;ln<Ke.length;ln++)Ke[ln]===0&&(Ke[ln]=.001)}else Ke=newArray(this.channels,null);Array.isArray(f)||(f=[f,f]);let Qe=f[0],Pi=f[1],nn=this.channels;for(let ln=Qe;ln<this.width-Qe;ln++)for(let cn=0;cn<nn;cn++){let hn=Ke[cn]||this.data[(ln+this.width*Pi)*nn+cn];for(let un=0;un<Pi;un++)this.data[(un*this.width+ln)*nn+cn]=hn;hn=Ke[cn]||this.data[(ln+this.width*(this.height-Pi-1))*nn+cn];for(let un=this.height-Pi;un<this.height;un++)this.data[(un*this.width+ln)*nn+cn]=hn}for(let ln=0;ln<this.height;ln++)for(let cn=0;cn<nn;cn++){let hn=Ke[cn]||this.data[(ln*this.width+Qe)*nn+cn];for(let un=0;un<Qe;un++)this.data[(ln*this.width+un)*nn+cn]=hn;hn=Ke[cn]||this.data[(ln*this.width+this.width-Qe-1)*nn+cn];for(let un=this.width-Qe;un<this.width;un++)this.data[(ln*this.width+un)*nn+cn]=hn}return this}function split(qe={}){let{preserveAlpha:f=!0}=qe;if(this.checkProcessable("split",{bitDepth:[8,16]}),this.components===1)return new Stack([this.clone()]);let ze=new Stack,Ke=this.data;if(this.alpha&&f)for(let Qe=0;Qe<this.components;Qe++){let Pi=Image$1.createFrom(this,{components:1,alpha:!0,colorModel:GREY$1}),nn=0;for(let ln=0;ln<Ke.length;ln+=this.channels)Pi.data[nn++]=Ke[ln+Qe],Pi.data[nn++]=Ke[ln+this.components];ze.push(Pi)}else for(let Qe=0;Qe<this.channels;Qe++){let Pi=Image$1.createFrom(this,{components:1,alpha:!1,colorModel:GREY$1}),nn=0;for(let ln=0;ln<Ke.length;ln+=this.channels)Pi.data[nn++]=Ke[ln+Qe];ze.push(Pi)}return ze}function getChannel(qe,f={}){let{keepAlpha:ze=!1,mergeAlpha:Ke=!1}=f;ze&=this.alpha,Ke&=this.alpha,this.checkProcessable("getChannel",{bitDepth:[8,16]}),qe=validateChannel(this,qe);let Qe=Image$1.createFrom(this,{components:1,alpha:ze,colorModel:GREY$1}),Pi=0;for(let nn=0;nn<this.data.length;nn+=this.channels)Ke?Qe.data[Pi++]=this.data[nn+qe]*this.data[nn+this.components]/this.maxValue:(Qe.data[Pi++]=this.data[nn+qe],ze&&(Qe.data[Pi++]=this.data[nn+this.components]));return Qe}function combineChannels(qe=defaultCombineMethod,f={}){let{mergeAlpha:ze=!1,keepAlpha:Ke=!1}=f;ze&=this.alpha,Ke&=this.alpha,this.checkProcessable("combineChannels",{bitDepth:[8,16]});let Qe=Image$1.createFrom(this,{components:1,alpha:Ke,colorModel:GREY$1}),Pi=0;for(let nn=0;nn<this.size;nn++){let ln=qe(this.getPixel(nn));ze?Qe.data[Pi++]=ln*this.data[nn*this.channels+this.components]/this.maxValue:(Qe.data[Pi++]=ln,Ke&&(Qe.data[Pi++]=this.data[nn*this.channels+this.components]))}return Qe}function defaultCombineMethod(qe){return(qe[0]+qe[1]+qe[2])/3}function setChannel(qe,f){if(this.checkProcessable("setChannel",{bitDepth:[8,16]}),f.checkProcessable("setChannel (image parameter check)",{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),f.width!==this.width||f.height!==this.height)throw new Error("Images must have exactly the same width and height");qe=validateChannel(this,qe);let ze=qe;for(let Ke=0;Ke<f.data.length;Ke++)this.data[ze]=f.data[Ke],ze+=this.channels;return this}function getSimilarity(qe,f={}){let{shift:ze=[0,0],average:Ke,channels:Qe,defaultAlpha:Pi,normalize:nn,border:ln=[0,0]}=f;if(this.checkProcessable("getSimilarity",{bitDepth:[8,16]}),Array.isArray(ln)||(ln=[ln,ln]),Qe=validateArrayOfChannels(this,{channels:Qe,defaultAlpha:Pi}),this.bitDepth!==qe.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==qe.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==qe.colorModel)throw new Error("Both images must have the same colorModel");typeof Ke>"u"&&(Ke=!0);let cn=Math.max(ln[0],-ze[0]),hn=Math.min(this.width-ln[0],this.width-ze[0]),un=Math.max(ln[1],-ze[1]),xs=Math.min(this.height-ln[1],this.height-ze[1]),zn=newArray(Qe.length,0);for(let Xn=0;Xn<Qe.length;Xn++){let ys=Qe[Xn],Jo=nn?this.sum[ys]:Math.max(this.sum[ys],qe.sum[ys]),ea=nn?qe.sum[ys]:Math.max(this.sum[ys],qe.sum[ys]);if(Jo!==0&&ea!==0)for(let ra=cn;ra<hn;ra++)for(let na=un;na<xs;na++){let ta=ra*this.multiplierX+na*this.multiplierY+ys,ia=ta+ze[0]*this.multiplierX+ze[1]*this.multiplierY;zn[Xn]+=Math.min(this.data[ta]/Jo,qe.data[ia]/ea)}}return Ke?zn.reduce((Xn,ys)=>Xn+ys)/zn.length:zn}function getPixelsGrid(qe={}){let{sampling:f=[10,10],painted:ze=!1,mask:Ke}=qe;this.checkProcessable("getPixelsGrid",{bitDepth:[8,16],channels:1}),Array.isArray(f)||(f=[f,f]);const Qe=f[0],Pi=f[1],nn=[],ln=[],cn=this.width/Qe,hn=this.height/Pi;let un=Math.floor(cn/2);for(let zn=0;zn<Qe;zn++){let Xn=Math.floor(hn/2);for(let ys=0;ys<Pi;ys++){let Jo=Math.round(un),ea=Math.round(Xn);(!Ke||Ke.getBitXY(Jo,ea))&&(nn.push([Jo,ea]),ln.push(this.getPixelXY(Jo,ea))),Xn+=hn}un+=cn}const xs={xyS:nn,zS:ln};return ze&&(xs.painted=this.rgba8().paintPoints(nn)),xs}function Matrix(qe,f,ze){const Ke=new Array(qe);for(let Qe=0;Qe<qe;Qe++)Ke[Qe]=new Array(f);if(ze)for(let Qe=0;Qe<qe;Qe++)for(let Pi=0;Pi<f;Pi++)Ke[Qe][Pi]=ze;return Ke.width=qe,Ke.height=f,Object.setPrototypeOf(Ke,Matrix.prototype),Ke}Matrix.prototype.localMin=function(qe,f){let ze=this[qe][f],Ke=[qe,f];for(let Qe=Math.max(0,qe-1);Qe<Math.min(this.length,qe+2);Qe++)for(let Pi=Math.max(0,f-1);Pi<Math.min(this[0].length,f+2);Pi++)this[Qe][Pi]<ze&&(ze=this[Qe][Pi],Ke=[Qe,Pi]);return{position:Ke,value:ze}};Matrix.prototype.localMax=function(qe,f){let ze=this[qe][f],Ke=[qe,f];for(let Qe=Math.max(0,qe-1);Qe<Math.min(this.length,qe+2);Qe++)for(let Pi=Math.max(0,f-1);Pi<Math.min(this[0].length,f+2);Pi++)this[Qe][Pi]>ze&&(ze=this[Qe][Pi],Ke=[Qe,Pi]);return{position:Ke,value:ze}};Matrix.prototype.localSearch=function(qe,f,ze){let Ke=[];for(let Qe=Math.max(0,qe-1);Qe<Math.min(this.length,qe+2);Qe++)for(let Pi=Math.max(0,f-1);Pi<Math.min(this[0].length,f+2);Pi++)this[Qe][Pi]===ze&&Ke.push([Qe,Pi]);return Ke};function getBestMatch(qe,f={}){let{border:ze}=f;if(this.checkProcessable("getChannel",{bitDepth:[8,16]}),this.bitDepth!==qe.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==qe.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==qe.colorModel)throw new Error("Both images must have the same colorModel");let Ke=new Matrix(qe.width,qe.height,-1/0),Qe=Math.floor(qe.width/2),Pi=Math.floor(qe.height/2),nn=Qe,ln=Pi,cn=!1;for(;!cn;){let hn=Ke.localSearch(Qe,Pi,-1/0);for(let xs=0;xs<hn.length;xs++){let zn=hn[xs],Xn=this.getSimilarity(qe,{border:ze,shift:[nn-zn[0],ln-zn[1]]});Ke[zn[0]][zn[1]]=Xn}let un=Ke.localMax(Qe,Pi);un.position[0]!==Qe||un.position[1]!==Pi?(Qe=un.position[0],Pi=un.position[1]):cn=!0}return[Qe-nn,Pi-ln]}function getRow(qe,f=0){this.checkProcessable("getRow",{bitDepth:[8,16]}),checkRow(this,qe),checkChannel(this,f);let ze=new Array(this.width),Ke=0,Qe=qe*this.width*this.channels+f,Pi=Qe+this.width*this.channels;for(let nn=Qe;nn<Pi;nn+=this.channels)ze[Ke++]=this.data[nn];return ze}function getColumn(qe,f=0){this.checkProcessable("getColumn",{bitDepth:[8,16]}),checkColumn(this,qe),checkChannel(this,f);let ze=new Array(this.height),Ke=0,Qe=this.width*this.channels;for(let Pi=f+qe*this.channels;Pi<this.data.length;Pi+=Qe)ze[Ke++]=this.data[Pi];return ze}function getMatrix(qe={}){let{channel:f}=qe;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),f===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");f=0}let ze=new Matrix$1(this.height,this.width);for(let Ke=0;Ke<this.height;Ke++)for(let Qe=0;Qe<this.width;Qe++)ze.set(Ke,Qe,this.getValueXY(Qe,Ke,f));return ze}function setMatrix(qe,f={}){qe=new Matrix$1(qe);let{channel:ze}=f;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),ze===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");ze=0}if(this.width!==qe.columns||this.height!==qe.rows)throw new RangeError("The size of the matrix must be equal to the size of the image");for(let Ke=0;Ke<this.height;Ke++)for(let Qe=0;Qe<this.width;Qe++)this.setValueXY(Qe,Ke,ze,qe.get(Ke,Qe));return this}function getPixelsArray(){this.checkProcessable("getPixelsArray",{bitDepth:[8,16,32]});let qe=new Array(this.size),f=0;for(let ze=0;ze<this.data.length;ze+=this.channels){let Ke=new Array(this.components);for(let Qe=0;Qe<this.components;Qe++)Ke[Qe]=this.data[ze+Qe];qe[f++]=Ke}return qe}function getIntersection(qe){let f=this,ze=f.getClosestCommonParent(qe),Ke=f.getRelativePosition(ze,{defaultFurther:!0}),Qe=getRelativePositionForAllPixels(f,Ke),Pi=qe.getRelativePosition(ze,{defaultFurther:!0}),nn=getRelativePositionForAllPixels(qe,Pi),ln=getCommonSurface(Qe,nn),cn={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]};for(let hn=0;hn<ln.length;hn++){let un=ln[hn],xs=[un[0]-Ke[0],un[1]-Ke[1]],zn=[un[0]-Pi[0],un[1]-Pi[1]],Xn=f.getBitXY(xs[0],xs[1]),ys=qe.getBitXY(zn[0],zn[1]);Xn===1&&ys===1&&cn.commonWhitePixels.push(un)}for(let hn=0;hn<Qe.length;hn++){let un,xs;hn!==0&&(un=Math.floor(hn/f.width),xs=hn%f.width),f.getBitXY(un,xs)===1&&cn.whitePixelsMask1.push(Qe[hn])}for(let hn=0;hn<nn.length;hn++){let un=0,xs=0;hn!==0&&(un=Math.floor(hn/qe.width),xs=hn%qe.width),qe.getBitXY(un,xs)===1&&cn.whitePixelsMask2.push(nn[hn])}return cn}function getRelativePositionForAllPixels(qe,f){let ze=[];for(let Ke=0;Ke<qe.height;Ke++)for(let Qe=0;Qe<qe.width;Qe++){let Pi=[Ke,Qe];ze.push([Pi[0]+f[0],Pi[1]+f[1]])}return ze}function getCommonSurface(qe,f){let ze=0,Ke=0,Qe=[];for(;ze<qe.length&&Ke<f.length;)qe[ze][0]===f[Ke][0]&&qe[ze][1]===f[Ke][1]?(Qe.push(qe[ze]),ze++,Ke++):qe[ze][0]<f[Ke][0]||qe[ze][0]===f[Ke][0]&&qe[ze][1]<f[Ke][1]?ze++:Ke++;return Qe}function getClosestCommonParent(qe){let f=getDepth(this),ze=getDepth(qe),Ke;if(f>=ze?Ke=getFurthestParent(this,f):Ke=getFurthestParent(qe,ze),f===0||ze===0)return Ke;let Qe=this,Pi=qe;for(;f!==ze;)if(f>ze){if(Qe=Qe.parent,Qe===null)return Ke;f=f-1}else{if(Pi=Pi.parent,Pi===null)return Ke;ze=ze-1}for(;Qe!==Pi&&Qe!==null&&Pi!==null;)if(Qe=Qe.parent,Pi=Pi.parent,Qe===null||Pi===null)return Ke;return Qe!==Pi?Ke:Qe}function getDepth(qe){let f=0,ze=qe;for(;ze.parent!=null;)ze=ze.parent,f++;return f}function getFurthestParent(qe,f){let ze=qe;for(;f>0;)ze=ze.parent,f=f-1;return ze}const defaultOptions$1={lowThreshold:10,highThreshold:30,gaussianBlur:1.1},Gx=[[-1,0,1],[-2,0,2],[-1,0,1]],Gy=[[-1,-2,-1],[0,0,0],[1,2,1]],convOptions={bitDepth:32,mode:"periodic"};function cannyEdgeDetector(qe,f){qe.checkProcessable("Canny edge detector",{bitDepth:8,channels:1,components:1}),f=Object.assign({},defaultOptions$1,f);const ze=qe.width,Ke=qe.height,Qe=qe.maxValue,Pi={sigma:f.gaussianBlur,radius:3},nn=qe.gaussianFilter(Pi),ln=nn.convolution(Gy,convOptions),cn=nn.convolution(Gx,convOptions),hn=cn.hypotenuse(ln),un=qe.constructor,xs=new un(ze,Ke,{kind:"GREY",bitDepth:32}),zn=new un(ze,Ke,{kind:"GREY",bitDepth:32}),Xn=new un(ze,Ke,{kind:"GREY"});for(var ys=1;ys<ze-1;ys++)for(var Jo=1;Jo<Ke-1;Jo++){var ea=(Math.round(Math.atan2(cn.getValueXY(ys,Jo,0),ln.getValueXY(ys,Jo,0))*(5/Math.PI))+5)%5;ea===0&&(hn.getValueXY(ys,Jo,0)<=hn.getValueXY(ys,Jo-1,0)||hn.getValueXY(ys,Jo,0)<=hn.getValueXY(ys,Jo+1,0))||ea===1&&(hn.getValueXY(ys,Jo,0)<=hn.getValueXY(ys-1,Jo+1,0)||hn.getValueXY(ys,Jo,0)<=hn.getValueXY(ys+1,Jo-1,0))||ea===2&&(hn.getValueXY(ys,Jo,0)<=hn.getValueXY(ys-1,Jo,0)||hn.getValueXY(ys,Jo,0)<=hn.getValueXY(ys+1,Jo,0))||ea===3&&(hn.getValueXY(ys,Jo,0)<=hn.getValueXY(ys-1,Jo-1,0)||hn.getValueXY(ys,Jo,0)<=hn.getValueXY(ys+1,Jo+1,0))||xs.setValueXY(ys,Jo,0,hn.getValueXY(ys,Jo,0))}for(ys=0;ys<ze*Ke;++ys){var ra=xs.data[ys],na=0;ra>f.highThreshold&&(na++,Xn.data[ys]=Qe),ra>f.lowThreshold&&na++,zn.data[ys]=na}var ta=[];for(ys=1;ys<ze-1;++ys)for(Jo=1;Jo<Ke-1;++Jo)if(zn.getValueXY(ys,Jo,0)===1){e:for(var ia=ys-1;ia<ys+2;++ia)for(var sa=Jo-1;sa<Jo+2;++sa)if(zn.getValueXY(ia,sa,0)===2){ta.push([ys,Jo]),Xn.setValueXY(ys,Jo,0,Qe);break e}}for(;ta.length>0;){var Ma=[];for(ys=0;ys<ta.length;++ys)for(Jo=-1;Jo<2;++Jo)for(ia=-1;ia<2;++ia)if(!(Jo===0&&ia===0)){var pa=ta[ys][0]+Jo,oa=ta[ys][1]+ia;zn.getValueXY(pa,oa,0)===1&&Xn.getValueXY(pa,oa,0)===0&&(Ma.push([pa,oa]),Xn.setValueXY(pa,oa,0,Qe))}ta=Ma}return Xn}function cannyEdge(qe){return cannyEdgeDetector(this,qe)}function extract(qe,f={}){let{position:ze}=f;if(this.checkProcessable("extract",{bitDepth:[1,8,16]}),!ze&&(ze=qe.getRelativePosition(this),!ze))throw new Error("extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].");if(this.bitDepth>1){let Ke=Image$1.createFrom(this,{width:qe.width,height:qe.height,alpha:1,position:ze,parent:this});for(let Qe=0;Qe<qe.width;Qe++)for(let Pi=0;Pi<qe.height;Pi++){for(let nn=0;nn<this.channels;nn++){let ln=this.getValueXY(Qe+ze[0],Pi+ze[1],nn);Ke.setValueXY(Qe,Pi,nn,ln)}qe.getBitXY(Qe,Pi)||Ke.setValueXY(Qe,Pi,this.components,0)}return Ke}else{let Ke=Image$1.createFrom(this,{width:qe.width,height:qe.height,position:ze,parent:this});for(let Qe=0;Qe<qe.height;Qe++)for(let Pi=0;Pi<qe.width;Pi++)qe.getBitXY(Pi,Qe)&&this.getBitXY(Pi+ze[0],Qe+ze[1])&&Ke.setBitXY(Pi,Qe);return Ke}}var fastList={exports:{}},hasRequiredFastList;function requireFastList(){return hasRequiredFastList||(hasRequiredFastList=1,function(qe,f){(function(){function ze(Qe,Pi,nn){this.next=nn,nn&&(nn.prev=this),this.prev=Pi,Pi&&(Pi.next=this),this.data=Qe}function Ke(){if(!(this instanceof Ke))return new Ke;this._head=null,this._tail=null,this.length=0}Ke.prototype={push:function(Qe){this._tail=new ze(Qe,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(this.length!==0){var Qe=this._tail;return this._tail=Qe.prev,Qe.prev&&(Qe.prev=this._tail.next=null),this.length--,this.length===1?this._head=this._tail:this.length===0&&(this._head=this._tail=null),Qe.data}},unshift:function(Qe){this._head=new ze(Qe,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(this.length!==0){var Qe=this._head;return this._head=Qe.next,Qe.next&&(Qe.next=this._head.prev=null),this.length--,this.length===1?this._tail=this._head:this.length===0&&(this._head=this._tail=null),Qe.data}},item:function(Qe){Qe<0&&(Qe=this.length+Qe);for(var Pi=this._head;Qe-- >0&&Pi;)Pi=Pi.next;return Pi?Pi.data:void 0},slice:function(Qe,Pi){if(Qe||(Qe=0),Pi||(Pi=this.length),Pi<0&&(Pi=this.length+Pi),Qe<0&&(Qe=this.length+Qe),Pi===Qe)return[];if(Pi<Qe)throw new Error("invalid offset: "+Qe+","+Pi+" (length="+this.length+")");for(var nn=Pi-Qe,ln=new Array(nn),cn=0,hn=this._head;Qe-- >0&&hn;)hn=hn.next;for(;cn<nn&&hn;)ln[cn++]=hn.data,hn=hn.next;return ln},drop:function(){Ke.call(this)},forEach:function(Qe,Pi){for(var nn=this._head,ln=0,cn=this.length;ln<cn&&nn;)Qe.call(Pi||this,nn.data,ln,this),nn=nn.next,ln++},map:function(Qe,Pi){var nn=new Ke;return this.forEach(function(ln,cn,hn){nn.push(Qe.call(Pi||hn,ln,cn,hn))}),nn},filter:function(Qe,Pi){var nn=new Ke;return this.forEach(function(ln,cn,hn){Qe.call(Pi||hn,ln,cn,hn)&&nn.push(ln)}),nn},reduce:function(Qe,Pi,nn){var ln=0,cn=this._head,hn=this.length;for(Pi||(ln=1,Pi=cn&&cn.data,cn=cn&&cn.next);ln<hn&&cn;)Pi=Qe.call(nn||this,Pi,cn.data,this),ln++,cn=cn.next;return Pi}},qe.exports=Ke})()}(fastList)),fastList.exports}var fastListExports=requireFastList();const LinkedList=getDefaultExportFromCjs(fastListExports);function floodFill(qe={}){const{x:f=0,y:ze=0,inPlace:Ke=!0}=qe,Qe=Ke?this:Image$1.createFrom(this);if(this.checkProcessable("floodFill",{bitDepth:1}),this.getBitXY(f,ze))return Qe;const nn=new LinkedList;for(nn.push(new Node(f,ze));nn.length>0;){const ln=nn.shift();Qe.setBitXY(ln.x,ln.y);for(let cn=ln.x+1;cn<this.width&&(!Qe.getBitXY(cn,ln.y)&&!this.getBitXY(cn,ln.y));cn++)Qe.setBitXY(cn,ln.y),ln.y+1<this.height&&!this.getBitXY(cn,ln.y+1)&&nn.push(new Node(cn,ln.y+1)),ln.y-1>=0&&!this.getBitXY(cn,ln.y-1)&&nn.push(new Node(cn,ln.y-1));for(let cn=ln.x-1;cn>=0&&(!Qe.getBitXY(cn,ln.y)&&!this.getBitXY(cn,ln.y));cn++)Qe.setBitXY(cn,ln.y),ln.y+1<this.height&&!this.getBitXY(cn,ln.y+1)&&nn.push(new Node(cn,ln.y+1)),ln.y-1>=0&&!this.getBitXY(cn,ln.y-1)&&nn.push(new Node(cn,ln.y-1))}return Qe}function Node(qe,f){this.x=qe,this.y=f}function _extends(){return _extends=Object.assign?Object.assign.bind():function(qe){for(var f=1;f<arguments.length;f++){var ze=arguments[f];for(var Ke in ze)({}).hasOwnProperty.call(ze,Ke)&&(qe[Ke]=ze[Ke])}return qe},_extends.apply(null,arguments)}function hsv2rgb(qe,f,ze){f=f/100,ze=ze/100;var Ke=[],Qe=ze*f,Pi=qe/60,nn=Qe*(1-Math.abs(Pi%2-1)),ln=ze-Qe;return Pi>=0&&Pi<1?Ke=[Qe,nn,0]:Pi>=1&&Pi<2?Ke=[nn,Qe,0]:Pi>=2&&Pi<3?Ke=[0,Qe,nn]:qe>=3&&Pi<4?Ke=[0,nn,Qe]:qe>=4&&Pi<5?Ke=[nn,0,Qe]:qe>=5&&Pi<=6?Ke=[Qe,0,nn]:Ke=[0,0,0],{r:Math.round(255*(Ke[0]+ln)),g:Math.round(255*(Ke[1]+ln)),b:Math.round(255*(Ke[2]+ln))}}function hsl2hsv(qe,f,ze){return f*=(ze<50?ze:100-ze)/100,{h:qe,s:2*f/(ze+f)*100,v:ze+f}}function hsl2rgb$1(qe,f,ze){var Ke=hsl2hsv(qe,f,ze);return hsv2rgb(Ke.h,Ke.s,Ke.v)}var colors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]};function parse(qe){return named(qe)||hex3(qe)||hex6(qe)||rgb(qe)||rgba$1(qe)||hsl(qe)||hsla(qe)}function named(qe){var f=colors[qe.toLowerCase()];if(f)return{r:f[0],g:f[1],b:f[2],a:100}}function rgb(qe){var f=qe.match(/rgb\(([^)]+)\)/);if(f){var ze=f[1].split(/ *, */).map(Number);return{r:ze[0],g:ze[1],b:ze[2],a:100}}}function rgba$1(qe){var f=qe.match(/rgba\(([^)]+)\)/);if(f){var ze=f[1].split(/ *, */).map(Number);return{r:ze[0],g:ze[1],b:ze[2],a:ze[3]*100}}}function hex6(qe){if(qe[0]==="#"&&qe.length===7)return{r:parseInt(qe.slice(1,3),16),g:parseInt(qe.slice(3,5),16),b:parseInt(qe.slice(5,7),16),a:100}}function hex3(qe){if(qe[0]==="#"&&qe.length===4)return{r:parseInt(qe[1]+qe[1],16),g:parseInt(qe[2]+qe[2],16),b:parseInt(qe[3]+qe[3],16),a:100}}function hsl(qe){var f=qe.match(/hsl\(([^)]+)\)/);if(f){var ze=f[1].split(/ *, */),Ke=parseInt(ze[0],10),Qe=parseInt(ze[1],10),Pi=parseInt(ze[2],10),nn=hsl2rgb$1(Ke,Qe,Pi);return _extends({},nn,{a:100})}}function hsla(qe){var f=qe.match(/hsla\(([^)]+)\)/);if(f){var ze=f[1].split(/ *, */),Ke=parseInt(ze[0],10),Qe=parseInt(ze[1],10),Pi=parseInt(ze[2],10),nn=parseInt(parseFloat(ze[3])*100,10),ln=hsl2rgb$1(Ke,Qe,Pi);return _extends({},ln,{a:nn})}}function css2array(qe){let f=parse(qe);return[f.r,f.g,f.b,Math.round(f.a*255/100)]}function hue2rgb(qe,f,ze){return ze<0&&(ze+=1),ze>1&&(ze-=1),ze<1/6?qe+(f-qe)*6*ze:ze<1/2?f:ze<2/3?qe+(f-qe)*(2/3-ze)*6:qe}function hsl2rgb(qe,f,ze){let Ke,Qe,Pi,nn,ln,cn;return f/=100,ze/=100,f===0?nn=ln=cn=ze*255:(ze<=.5?Qe=ze*(f+1):Qe=ze+f-ze*f,Ke=ze*2-Qe,Pi=qe/360,nn=hue2rgb(Ke,Qe,Pi+1/3),ln=hue2rgb(Ke,Qe,Pi),cn=hue2rgb(Ke,Qe,Pi-1/3)),{r:nn,g:ln,b:cn}}function getDistinctColors(qe){let f=new Array(qe),ze=0;for(let Ke=0;Ke<360;Ke+=360/qe){ze++;let Qe=hsl2rgb(Ke,100,30+ze%4*15);f[ze-1]=[Math.round(Qe.r*255),Math.round(Qe.g*255),Math.round(Qe.b*255)]}return f}function getRandomColor(){return[Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)]}function getColors(qe){let{color:f,colors:ze,randomColors:Ke,numberColors:Qe=50}=qe;if(f&&!Array.isArray(f)&&(f=css2array(f)),f)return[f];if(ze)return ze=ze.map(function(Pi){return Array.isArray(Pi)?Pi:css2array(Pi)}),ze;if(Ke){ze=new Array(Qe);for(let Pi=0;Pi<Qe;Pi++)ze[Pi]=getRandomColor()}return getDistinctColors(Qe)}function paintLabels(qe,f,ze={}){let{color:Ke="blue",colors:Qe,font:Pi="12px Helvetica",rotate:nn=0}=ze;if(this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1}),!Array.isArray(qe))throw Error("paintLabels: labels must be an array");if(!Array.isArray(f))throw Error("paintLabels: positions must be an array");if(Ke&&!Array.isArray(Ke)&&(Ke=css2array(Ke)),Qe?Qe=Qe.map(function(hn){return Array.isArray(hn)?hn:css2array(hn)}):Qe=[Ke],qe.length!==f.length)throw Error("paintLabels: positions and labels must be arrays from the same size");Array.isArray(Pi)||(Pi=[Pi]),Array.isArray(nn)||(nn=[nn]);let cn=this.getCanvas().getContext("2d");for(let hn=0;hn<qe.length;hn++){cn.save();let un=Qe[hn%Qe.length];cn.fillStyle=`rgba(${un[0]},${un[1]},${un[2]},${un[3]/this.maxValue})`,cn.font=Pi[hn%Pi.length];let xs=f[hn];cn.translate(xs[0],xs[1]),cn.rotate(nn[hn%nn.length]/180*Math.PI),cn.fillText(qe[hn],0,0),cn.restore()}return this.data=Uint8Array.from(cn.getImageData(0,0,this.width,this.height).data),this}function paintMasks(qe,f={}){let{alpha:ze=255,labels:Ke=[],labelsPosition:Qe=[],labelColor:Pi="blue",labelFont:nn="12px Helvetica"}=f;this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1});let ln=getColors(Object.assign({},f,{numberColors:qe.length}));Array.isArray(qe)||(qe=[qe]);for(let cn=0;cn<qe.length;cn++){let hn=qe[cn],un=ln[cn%ln.length];for(let xs=0;xs<hn.width;xs++)for(let zn=0;zn<hn.height;zn++)if(hn.getBitXY(xs,zn))for(let Xn=0;Xn<Math.min(this.components,un.length);Xn++)if(ze===255)this.setValueXY(xs+hn.position[0],zn+hn.position[1],Xn,un[Xn]);else{let ys=this.getValueXY(xs+hn.position[0],zn+hn.position[1],Xn);ys=Math.round((ys*(255-ze)+un[Xn]*ze)/255),this.setValueXY(xs+hn.position[0],zn+hn.position[1],Xn,ys)}}if(Array.isArray(Ke)&&Ke.length>0){let hn=this.getCanvas().getContext("2d");hn.fillStyle=Pi,hn.font=nn;for(let un=0;un<Math.min(qe.length,Ke.length);un++){let xs=Qe[un]?Qe[un]:qe[un].position;hn.fillText(Ke[un],xs[0],xs[1])}this.data=Uint8Array.from(hn.getImageData(0,0,this.width,this.height).data)}return this}function zerosMatrix(qe,f){let ze=new Array(qe);for(let Ke=0;Ke<qe;Ke++)ze[Ke]=new Array(f).fill(0);return ze}const cross=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],smallCross=[[0,1,0],[1,1,1],[0,1,0]];class Shape{constructor(f={}){let{kind:ze="cross",shape:Ke,size:Qe,width:Pi,height:nn,filled:ln=!0}=f;if(Qe&&(Pi=Qe,nn=Qe),Ke)switch(Ke.toLowerCase()){case"square":case"rectangle":this.matrix=rectangle(Pi,nn,{filled:ln});break;case"circle":case"ellipse":this.matrix=ellipse(Pi,nn,{filled:ln});break;case"triangle":this.matrix=triangle(Pi,nn,{filled:ln});break;default:throw new Error(`Shape: unexpected shape: ${Ke}`)}else if(ze)switch(ze.toLowerCase()){case"cross":this.matrix=cross;break;case"smallcross":this.matrix=smallCross;break;default:throw new Error(`Shape: unexpected kind: ${ze}`)}else throw new Error("Shape: expected a kind or a shape option");this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){let f=this.matrix,ze=[];for(let Ke=0;Ke<f.length;Ke++)for(let Qe=0;Qe<f[0].length;Qe++)f[Ke][Qe]&&ze.push([Qe-this.halfWidth,Ke-this.halfHeight]);return ze}getMask(){let f=new Image$1(this.width,this.height,{kind:BINARY});for(let ze=0;ze<this.matrix.length;ze++)for(let Ke=0;Ke<this.matrix[0].length;Ke++)this.matrix[ze][Ke]&&f.setBitXY(Ke,ze);return f}}function rectangle(qe,f,ze){const Ke=zerosMatrix(f,qe);if(ze.filled)for(let Qe=0;Qe<f;Qe++)for(let Pi=0;Pi<qe;Pi++)Ke[Qe][Pi]=1;else{for(let Qe of[0,f-1])for(let Pi=0;Pi<qe;Pi++)Ke[Qe][Pi]=1;for(let Qe=0;Qe<f;Qe++)for(let Pi of[0,qe-1])Ke[Qe][Pi]=1}return Ke}function ellipse(qe,f,ze){const Ke=zerosMatrix(f,qe);let Qe=1-f%2,Pi=1-qe%2,nn=Math.floor((qe-1)/2),ln=Math.floor((f-1)/2),cn=nn*nn,hn=ln*ln;if(ze.filled)for(let un=0;un<=ln;un++){let xs=Math.floor(Math.sqrt(cn-cn*un*un/hn));for(let zn=nn-xs;zn<=nn;zn++)Ke[ln-un][zn]=1,Ke[ln+un+Qe][zn]=1,Ke[ln-un][qe-zn-1]=1,Ke[ln+un+Qe][qe-zn-1]=1}else{for(let un=0;un<=ln;un++){let xs=Math.floor(Math.sqrt(cn-cn*un*un/hn)),zn=nn-xs;Ke[ln-un][zn]=1,Ke[ln+un+Qe][zn]=1,Ke[ln-un][qe-zn-1]=1,Ke[ln+un+Qe][qe-zn-1]=1}for(let un=0;un<=nn;un++){let xs=Math.floor(Math.sqrt(hn-hn*un*un/cn)),zn=ln-xs;Ke[zn][nn-un]=1,Ke[zn][nn+un+Pi]=1,Ke[f-zn-1][nn-un]=1,Ke[f-zn-1][nn+un+Pi]=1}}return Ke}function triangle(qe,f,ze){if(!ze.filled)throw new Error("Non filled triangle is not implemented");const Ke=zerosMatrix(f,qe);for(let Qe=0;Qe<f;Qe++){let Pi=Math.floor((1-Qe/f)*qe/2);for(let nn=Pi;nn<qe-Pi;nn++)Ke[Qe][nn]=1}return Ke}function paintPoints(qe,f={}){let{shape:ze}=f;this.checkProcessable("paintPoints",{bitDepth:[8,16]});let Ke=getColors(Object.assign({},f,{numberColors:qe.length})),Qe=new Shape(ze).getPoints(),Pi=Math.min(this.channels,Ke[0].length);for(let nn=0;nn<qe.length;nn++){let ln=Ke[nn%Ke.length],cn=qe[nn][0],hn=qe[nn][1];for(let un=0;un<Qe.length;un++){let xs=Qe[un][0],zn=Qe[un][1];if(cn+xs>=0&&hn+zn>=0&&cn+xs<this.width&&hn+zn<this.height){let Xn=(cn+xs+(hn+zn)*this.width)*this.channels;for(let ys=0;ys<Pi;ys++)this.data[Xn+ys]=ln[ys]}}}return this}function paintPolyline(qe,f={}){let{color:ze=[this.maxValue,0,0],closed:Ke=!1}=f;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]});let Qe=Math.min(this.channels,ze.length);for(let Pi=0;Pi<qe.length-1+Ke;Pi++){let nn=qe[Pi],ln=qe[(Pi+1)%qe.length],cn=ln[0]-nn[0],hn=ln[1]-nn[1],un=Math.max(Math.abs(cn),Math.abs(hn)),xs=cn/un,zn=hn/un,Xn=nn[0],ys=nn[1];for(let Jo=0;Jo<=un;Jo++){let ea=Math.round(Xn),ra=Math.round(ys);if(ea>=0&&ra>=0&&ea<this.width&&ra<this.height)if(this.bitDepth===1)this.setBitXY(ea,ra);else{let na=(ea+ra*this.width)*this.channels;for(let ta=0;ta<Qe;ta++)this.data[na+ta]=ze[ta]}Xn=Xn+xs,ys=ys+zn}}return this}function paintPolylines(qe,f={}){let ze=Object.assign({},f);this.checkProcessable("paintPolylines",{bitDepth:[8,16]});let Ke=getColors(Object.assign({},f,{numberColors:qe.length}));for(let Qe=0;Qe<qe.length;Qe++)ze.color=Ke[Qe%Ke.length],this.paintPolyline(qe[Qe],ze);return this}function paintPolygon(qe,f={}){let{color:ze=[this.maxValue,0,0],filled:Ke=!1}=f;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]}),f.closed=!0;let Qe=deleteDouble(qe);if(Ke===!1)return this.paintPolyline(qe,f);{let Pi=Array(this.height);for(let nn=0;nn<this.height;nn++){Pi[nn]=[];for(let ln=0;ln<this.width;ln++)Pi[nn].push(0)}for(let nn=0;nn<Qe.length;nn++){const ln=lineBetweenTwoPoints(Qe[nn],Qe[(nn+1)%Qe.length]);for(let cn=0;cn<this.height;cn++)for(let hn=0;hn<this.width;hn++)isAtTheRightOfTheLine(hn,cn,ln,this.height)&&(Pi[cn][hn]=Pi[cn][hn]===0?1:0)}for(let nn=0;nn<this.height;nn++)for(let ln=0;ln<this.width;ln++)if(Pi[nn][ln]===1)if(this.bitDepth===1)this.setBitXY(ln,nn);else{let cn=Math.min(this.channels,ze.length),hn=(ln+nn*this.width)*this.channels;for(let un=0;un<cn;un++)this.data[hn+un]=ze[un]}return this.paintPolyline(qe,f)}}function deleteDouble(qe){let f=[];for(let ze=0;ze<qe.length;ze++)if(!(qe[ze][0]===qe[(ze+1)%qe.length][0]&&qe[ze][1]===qe[(ze+1)%qe.length][1])){if(qe[ze][0]===qe[(ze-1+qe.length)%qe.length][0]&&qe[ze][1]===qe[(ze-1+qe.length)%qe.length][1])continue;if(qe[(ze+1)%qe.length][0]===qe[(ze-1+qe.length)%qe.length][0]&&qe[(ze-1+qe.length)%qe.length][1]===qe[(ze+1)%qe.length][1])continue;f.push(qe[ze])}return f}function lineBetweenTwoPoints(qe,f){if(qe[0]===f[0])return{a:0,b:qe[0],vertical:!0};{const ze=(f[1]-qe[1])/(f[0]-qe[0]),Ke=qe[1]-ze*qe[0];return{a:ze,b:Ke,vertical:!1}}}function isAtTheRightOfTheLine(qe,f,ze,Ke){if(ze.vertical===!0)return ze.b<=qe;if(ze.a===0)return!1;{const Qe=(f-ze.b)/ze.a;return Qe<qe&&Qe>=0&&Qe<=Ke}}function paintPolygons(qe,f={}){let ze=Object.assign({},f);this.checkProcessable("paintPolygons",{bitDepth:[8,16]});let Ke=getColors(Object.assign({},f,{numberColors:qe.length}));for(let Qe=0;Qe<qe.length;Qe++)ze.color=Ke[Qe%Ke.length],this.paintPolygon(qe[Qe],ze);return this}function getHistogram(qe={}){let{maxSlots:f=256,channel:ze,useAlpha:Ke=!0}=qe;if(this.checkProcessable("getHistogram",{bitDepth:[1,8,16]}),ze===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");ze=0}return getChannelHistogram.call(this,ze,{useAlpha:Ke,maxSlots:f})}function getHistograms(qe={}){const{maxSlots:f=256,useAlpha:ze=!0}=qe;this.checkProcessable("getHistograms",{bitDepth:[8,16]});let Ke=new Array(ze?this.components:this.channels);for(let Qe=0;Qe<Ke.length;Qe++)Ke[Qe]=getChannelHistogram.call(this,Qe,{useAlpha:ze,maxSlots:f});return Ke}function getChannelHistogram(qe,f){let{useAlpha:ze,maxSlots:Ke}=f;if(this.bitDepth===1){let cn=[0,0];for(let hn=0;hn<this.height;hn++)for(let un=0;un<this.width;un++){let xs=this.getBitXY(hn,un);xs===0?cn[0]+=1:xs===1&&(cn[1]+=1)}return cn}let Qe=Math.log2(Ke);if(!isInteger(Qe))throw new RangeError("maxSlots must be a power of 2, for example: 64, 256, 1024");let Pi=0;this.bitDepth>Qe&&(Pi=this.bitDepth-Qe);let nn=this.data,ln=newArray(Math.pow(2,Math.min(this.bitDepth,Qe)),0);if(ze&&this.alpha){let cn=this.channels-qe-1;for(let hn=qe;hn<nn.length;hn+=this.channels)ln[nn[hn]>>Pi]+=nn[hn+cn]/this.maxValue}else for(let cn=qe;cn<nn.length;cn+=this.channels)ln[nn[cn]>>Pi]++;return ln}function getColorHistogram(qe={}){let{useAlpha:f=!0,nbSlots:ze=512}=qe;this.checkProcessable("getColorHistogram",{bitDepth:[8,16],components:[3]});let Ke=Math.log(ze)/Math.log(8);if(Ke!==Math.floor(Ke))throw new RangeError("nbSlots must be a power of 8. Usually 8, 64, 512 or 4096");let Qe=this.bitDepth-Ke,Pi=this.data,nn=newArray(Math.pow(8,Ke),0),ln=Math.pow(2,Ke*2),cn=Math.pow(2,Ke);for(let hn=0;hn<Pi.length;hn+=this.channels){let un=(Pi[hn]>>Qe)*ln+(Pi[hn+1]>>Qe)*cn+(Pi[hn+2]>>Qe);f&&this.alpha?nn[un]+=Pi[hn+this.channels-1]/this.maxValue:nn[un]++}return nn}function min(){this.checkProcessable("min",{bitDepth:[8,16,32]});let qe=newArray(this.channels,1/0);for(let f=0;f<this.data.length;f+=this.channels)for(let ze=0;ze<this.channels;ze++)this.data[f+ze]<qe[ze]&&(qe[ze]=this.data[f+ze]);return qe}function max(){this.checkProcessable("max",{bitDepth:[8,16,32]});let qe=newArray(this.channels,-1/0);for(let f=0;f<this.data.length;f+=this.channels)for(let ze=0;ze<this.channels;ze++)this.data[f+ze]>qe[ze]&&(qe[ze]=this.data[f+ze]);return qe}function sum(){this.checkProcessable("sum",{bitDepth:[8,16]});let qe=newArray(this.channels,0);for(let f=0;f<this.data.length;f+=this.channels)for(let ze=0;ze<this.channels;ze++)qe[ze]+=this.data[f+ze];return qe}function getMoment(qe=0,f=0){this.checkProcessable("getMoment",{bitDepth:[1]});let ze=0;for(let Ke=0;Ke<this.width;Ke++)for(let Qe=0;Qe<this.height;Qe++)this.getBitXY(Ke,Qe)===1&&(ze+=Ke**qe*Qe**f);return ze}function localMaxima(qe={}){let{mask:f,region:ze=3,removeClosePoints:Ke=0,invert:Qe=!1,maxEquals:Pi=2}=qe,nn=this;this.checkProcessable("localMaxima",{bitDepth:[8,16],components:1}),ze*=4;let ln=Qe?0:1,cn=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],hn=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],un=ze<=8?1:2,xs=[];for(let zn=un;zn<nn.height-un;zn++)for(let Xn=un;Xn<nn.width-un;Xn++){if(f&&f.getBitXY(Xn,zn)!==ln)continue;let ys=0,Jo=0,ea=nn.data[Xn+zn*nn.width];for(let ra=0;ra<ze;ra++)Qe?nn.data[Xn+cn[ra]+(zn+hn[ra])*nn.width]>ea&&ys++:nn.data[Xn+cn[ra]+(zn+hn[ra])*nn.width]<ea&&ys++,nn.data[Xn+cn[ra]+(zn+hn[ra])*nn.width]===ea&&Jo++;ys+Jo===ze&&Jo<=Pi&&xs.push([Xn,zn])}if(Ke>0)for(let zn=0;zn<xs.length;zn++)for(let Xn=zn+1;Xn<xs.length;Xn++)Math.sqrt(Math.pow(xs[zn][0]-xs[Xn][0],2)+Math.pow(xs[zn][1]-xs[Xn][1],2))<Ke&&(xs[zn][0]=xs[zn][0]+xs[Xn][0]>>1,xs[zn][1]=xs[zn][1]+xs[Xn][1]>>1,xs.splice(Xn,1),Xn--);return xs}function mean(){let qe=this.getHistograms({maxSlots:this.maxValue+1}),f=new Array(qe.length);for(let ze=0;ze<qe.length;ze++){let Ke=qe[ze];f[ze]=mean$2(Ke)}return f}function median(){let qe=this.getHistograms({maxSlots:this.maxValue+1}),f=new Array(qe.length);for(let ze=0;ze<qe.length;ze++){let Ke=qe[ze];f[ze]=median$2(Ke)}return f}function points(){this.checkProcessable("points",{bitDepth:[1]});const qe=[];for(let f=0;f<this.width;f++)for(let ze=0;ze<this.height;ze++)this.getBitXY(f,ze)===1&&qe.push([f,ze]);return qe}function extendedPoints(){this.checkProcessable("extendedPoints",{bitDepth:[1]});const qe=[];for(let f=0;f<this.height;f++)for(let ze=0;ze<this.width;ze++)if(this.getBitXY(ze,f)===1)for(qe.push([ze,f]),this.getBitXY(ze+1,f)!==1?(qe.push([ze+1,f]),qe.push([ze+1,f+1]),this.getBitXY(ze,f+1)!==1&&qe.push([ze,f+1])):this.getBitXY(ze,f+1)!==1&&(qe.push([ze,f+1]),qe.push([ze+1,f+1]));ze<this.width-2&&this.getBitXY(ze+1,f)===1&&this.getBitXY(ze+2,f)===1;)ze++;return qe}function getRelativePosition(qe,f={}){if(this===qe)return[0,0];let ze=[0,0],Ke=this;for(;Ke;){if(Ke===qe)return ze;Ke.position&&(ze[0]+=Ke.position[0],ze[1]+=Ke.position[1]),Ke=Ke.parent}return f.defaultFurther?ze:!1}function countAlphaPixels(qe={}){let{alpha:f=1}=qe;this.checkProcessable("countAlphaPixels",{bitDepth:[8,16],alpha:1});let ze=0;if(f!==void 0){for(let Ke=this.components;Ke<this.data.length;Ke+=this.channels)this.data[Ke]===f&&ze++;return ze}else return this.size}function monotoneChainConvexHull$1(qe,f={}){const{sorted:ze}=f;ze||(qe=qe.slice().sort(byXThenY));const Ke=qe.length,Qe=new Array(Ke*2);let Pi=0;for(let ln=0;ln<Ke;ln++){const cn=qe[ln];for(;Pi>=2&&cw(Qe[Pi-2],Qe[Pi-1],cn)<=0;)Pi--;Qe[Pi++]=cn}const nn=Pi+1;for(let ln=Ke-2;ln>=0;ln--){const cn=qe[ln];for(;Pi>=nn&&cw(Qe[Pi-2],Qe[Pi-1],cn)<=0;)Pi--;Qe[Pi++]=cn}return Qe.slice(0,Pi-1)}function cw(qe,f,ze){return(f[1]-qe[1])*(ze[0]-qe[0])-(f[0]-qe[0])*(ze[1]-qe[1])}function byXThenY(qe,f){return qe[0]===f[0]?qe[1]-f[1]:qe[0]-f[0]}function monotoneChainConvexHull(){return monotoneChainConvexHull$1(this.extendedPoints,{sorted:!1})}function round(qe){for(let f=0;f<qe.length;f++)qe[f][0]=Math.round(qe[f][0]),qe[f][1]=Math.round(qe[f][1]);return qe}function difference(qe,f){return[qe[0]-f[0],qe[1]-f[1]]}function normalize(qe){let f=Math.sqrt(qe[0]**2+qe[1]**2);return[qe[0]/f,qe[1]/f]}function rotate(qe,f,ze){ze===void 0&&(ze=new Array(f.length));let Ke=Math.cos(qe),Qe=Math.sin(qe);for(let Pi=0;Pi<ze.length;++Pi)ze[Pi]=[Ke*f[Pi][0]-Qe*f[Pi][1],Qe*f[Pi][0]+Ke*f[Pi][1]];return ze}function perimeter(qe){let f=0;for(let ze=0;ze<qe.length;ze++){let Ke=qe[ze][0],Qe=qe[ze][1],Pi=qe[ze===qe.length-1?0:ze+1][0],nn=qe[ze===qe.length-1?0:ze+1][1];f+=Math.sqrt((Pi-Ke)**2+(nn-Qe)**2)}return f}function surface(qe){let f=0;for(let ze=0;ze<qe.length;ze++){let Ke=qe[ze][0],Qe=qe[ze===qe.length-1?0:ze+1][1],Pi=qe[ze===qe.length-1?0:ze+1][0],nn=qe[ze][1];f+=Ke*Qe*.5,f-=Pi*nn*.5}return Math.abs(f)}function minMax(qe){let f=1/0,ze=1/0,Ke=-1/0,Qe=-1/0;for(let Pi=0;Pi<qe.length;Pi++)qe[Pi][0]<f&&(f=qe[Pi][0]),qe[Pi][0]>Ke&&(Ke=qe[Pi][0]),qe[Pi][1]<ze&&(ze=qe[Pi][1]),qe[Pi][1]>Qe&&(Qe=qe[Pi][1]);return[[f,ze],[Ke,Qe]]}function moveToZeroZero(qe,f){f===void 0&&(f=new Array(qe.length).fill(0).map(()=>[]));let ze=minMax(qe),Ke=ze[0][0],Qe=ze[0][1];for(let Pi=0;Pi<qe.length;Pi++)f[Pi][0]=qe[Pi][0]-Ke,f[Pi][1]=qe[Pi][1]-Qe;return f}function minimalBoundingRectangle(qe={}){const{originalPoints:f=monotoneChainConvexHull.call(this)}=qe;if(f.length===0)return[];if(f.length===1)return[f[0],f[0],f[0],f[0]];const ze=new Array(f.length);let Ke=1/0,Qe=0,Pi;for(let nn=0;nn<ze.length;nn++){let ln=getAngle$1(f[nn],f[(nn+1)%ze.length]);rotate(-ln,f,ze);let cn=ze[nn][0],hn=ze[nn][1],un=ze[(nn+1)%ze.length][0],xs=ze[(nn+1)%ze.length][1],zn=!0,Xn=0,ys=0,Jo=0;for(let ta=0;ta<ze.length;ta++){let ia=ze[ta][0],sa=ze[ta][1],Ma=(ia-cn)/(un-cn);zn===!0?(zn=!1,Xn=Ma,ys=Ma):(Ma<Xn&&(Xn=Ma),Ma>ys&&(ys=Ma));let pa=(-(un-cn)*sa+un*hn-xs*cn)/(un-cn);Math.abs(pa)>Math.abs(Jo)&&(Jo=pa)}let ea=[cn+Xn*(un-cn),hn],ra=[cn+ys*(un-cn),hn],na=Math.abs(Jo*(Xn-ys)*(un-cn));na<Ke&&(Qe=ln,Ke=na,Pi=[ea,ra,[ra[0],ra[1]-Jo],[ea[0],ea[1]-Jo]])}return rotate(Qe,Pi,Pi),Pi}function getAngle$1(qe,f){let ze=difference(f,qe),Ke=normalize(ze),Qe=Math.acos(Ke[0]);return Ke[1]<0?-Qe:Qe}function extend$1(qe){let f={inPlace:!0};qe.extendMethod("invert",invert),qe.extendMethod("abs",abs),qe.extendMethod("level",level,f),qe.extendMethod("add",add,f),qe.extendMethod("subtract",subtract,f),qe.extendMethod("subtractImage",subtractImage),qe.extendMethod("multiply",multiply,f),qe.extendMethod("divide",divide,f),qe.extendMethod("hypotenuse",hypotenuse),qe.extendMethod("background",background$1),qe.extendMethod("flipX",flipX),qe.extendMethod("flipY",flipY),qe.extendMethod("blurFilter",blurFilter),qe.extendMethod("medianFilter",medianFilter),qe.extendMethod("gaussianFilter",gaussianFilter),qe.extendMethod("sobelFilter",sobelFilter),qe.extendMethod("gradientFilter",gradientFilter),qe.extendMethod("scharrFilter",scharrFilter),qe.extendMethod("dilate",dilate),qe.extendMethod("erode",erode),qe.extendMethod("open",open),qe.extendMethod("close",close),qe.extendMethod("topHat",topHat),qe.extendMethod("blackHat",blackHat),qe.extendMethod("morphologicalGradient",morphologicalGradient),qe.extendMethod("warpingFourPoints",warpingFourPoints),qe.extendMethod("crop",crop),qe.extendMethod("cropAlpha",cropAlpha),qe.extendMethod("resize",resize).extendMethod("scale",resize),qe.extendMethod("hsv",hsv),qe.extendMethod("hsl",hsl$1),qe.extendMethod("cmyk",cmyk),qe.extendMethod("rgba8",rgba8),qe.extendMethod("grey",grey).extendMethod("gray",grey),qe.extendMethod("mask",mask),qe.extendMethod("pad",pad),qe.extendMethod("colorDepth",colorDepth),qe.extendMethod("setBorder",setBorder,f),qe.extendMethod("rotate",rotate$1),qe.extendMethod("rotateLeft",rotateLeft),qe.extendMethod("rotateRight",rotateRight),qe.extendMethod("insert",insert),qe.extendMethod("getRow",getRow),qe.extendMethod("getColumn",getColumn),qe.extendMethod("getMatrix",getMatrix),qe.extendMethod("setMatrix",setMatrix),qe.extendMethod("getPixelsArray",getPixelsArray),qe.extendMethod("getIntersection",getIntersection),qe.extendMethod("getClosestCommonParent",getClosestCommonParent),qe.extendMethod("getThreshold",getThreshold),qe.extendMethod("split",split),qe.extendMethod("getChannel",getChannel),qe.extendMethod("combineChannels",combineChannels),qe.extendMethod("setChannel",setChannel),qe.extendMethod("getSimilarity",getSimilarity),qe.extendMethod("getPixelsGrid",getPixelsGrid),qe.extendMethod("getBestMatch",getBestMatch),qe.extendMethod("cannyEdge",cannyEdge),qe.extendMethod("convolution",convolution),qe.extendMethod("extract",extract),qe.extendMethod("floodFill",floodFill),qe.extendMethod("paintLabels",paintLabels,f),qe.extendMethod("paintMasks",paintMasks,f),qe.extendMethod("paintPoints",paintPoints,f),qe.extendMethod("paintPolyline",paintPolyline,f),qe.extendMethod("paintPolylines",paintPolylines,f),qe.extendMethod("paintPolygon",paintPolygon,f),qe.extendMethod("paintPolygons",paintPolygons,f),qe.extendMethod("countAlphaPixels",countAlphaPixels),qe.extendMethod("monotoneChainConvexHull",monotoneChainConvexHull),qe.extendMethod("minimalBoundingRectangle",minimalBoundingRectangle),qe.extendMethod("getHistogram",getHistogram).extendProperty("histogram",getHistogram),qe.extendMethod("getHistograms",getHistograms).extendProperty("histograms",getHistograms),qe.extendMethod("getColorHistogram",getColorHistogram).extendProperty("colorHistogram",getColorHistogram),qe.extendMethod("getMin",min).extendProperty("min",min),qe.extendMethod("getMax",max).extendProperty("max",max),qe.extendMethod("getSum",sum).extendProperty("sum",sum),qe.extendMethod("getMoment",getMoment).extendProperty("moment",getMoment),qe.extendMethod("getLocalMaxima",localMaxima),qe.extendMethod("getMedian",median).extendProperty("median",median),qe.extendMethod("getMean",mean).extendProperty("mean",mean),qe.extendMethod("getPoints",points).extendProperty("points",points),qe.extendMethod("getExtendedPoints",extendedPoints).extendProperty("extendedPoints",extendedPoints),qe.extendMethod("getRelativePosition",getRelativePosition)}var quantities$1={exports:{}},quantities=quantities$1.exports,hasRequiredQuantities;function requireQuantities(){return hasRequiredQuantities||(hasRequiredQuantities=1,function(qe,f){(function(ze,Ke){qe.exports=Ke()})(quantities,function(){function ze(Cs){return typeof Cs=="string"||Cs instanceof String}var Ke=Number.isFinite||window.isFinite;function Qe(Cs){return Ke(Cs)}function Pi(Cs){return Cs}function nn(Cs){var Kn={};return Cs.filter(function(qn){return Kn.hasOwnProperty(qn)?!1:Kn[qn]=!0})}function ln(Cs,Kn){if(Kn.length!==Cs.length)return!1;for(var qn=0;qn<Cs.length;qn++)if(Kn[qn].compareArray&&!Kn[qn].compareArray(Cs[qn])||Kn[qn]!==Cs[qn])return!1;return!0}function cn(Cs,Kn){Object.keys(Kn).forEach(function(qn){Cs[qn]=Kn[qn]})}function hn(){for(var Cs=1,Kn=0,qn=0;qn<arguments.length;qn++){var Un=arguments[qn];Kn=Kn+zn(Un),Cs*=Un}return Kn!==0?xs(Cs,Kn):Cs}function un(Cs,Kn){if(Kn===0)throw new Error("Divide by zero");var qn=Math.pow(10,zn(Kn)),Un=qn/(qn*Kn);return hn(Cs,Un)}function xs(Cs,Kn){return Math.round(Cs*Math.pow(10,Kn))/Math.pow(10,Kn)}function zn(Cs){if(!isFinite(Cs))return 0;for(var Kn=0;Cs%1!==0;)Cs*=10,Kn++;return Kn}function Xn(){var Cs;if(!this)return Cs=Object.create(Xn.prototype),Xn.apply(Cs,arguments),Cs;Cs=Error.apply(this,arguments),this.name="QtyError",this.message=Cs.message,this.stack=Cs.stack}Xn.prototype=Object.create(Error.prototype,{constructor:{value:Xn}});function ys(Cs,Kn){throw new Xn("Incompatible units: "+Cs+" and "+Kn)}var Jo={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","μ","µ","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["t","tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oilbarrel","oilbarrels","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beerbarrel","beerbarrels","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beerbarrel-imp","beerbarrels-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<Gal>":[["Gal"],.01,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],3600*24,"time",["<second>"]],"<week>":[["wk","week","weeks"],7*3600*24,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"molar_concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"molar_concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","Ω","Ω"],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules","Joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<electronvolt>":[["eV","electronvolt","electronvolts"],1602176634e-28,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<arcminute>":[["arcmin","arcminute","arcminutes"],Math.PI/10800,"angle",["<radian>"]],"<arcsecond>":[["arcsec","arcsecond","arcseconds"],Math.PI/648e3,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppb>":[["ppb"],1e-9,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-12,"prefix_only",["<1>"]],"<ppq>":[["ppq"],1e-15,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},ea=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],ra="<1>",na=[ra];function ta(Cs,Kn){var qn=Kn[1],Un=Kn[3]||[],vs=Kn[4]||[];if(!Qe(qn))throw new Xn(Cs+": Invalid unit definition. 'scalar' must be a number");Un.forEach(function(bs){if(Jo[bs]===void 0)throw new Xn(Cs+": Invalid unit definition. Unit "+bs+" in 'numerator' is not recognized")}),vs.forEach(function(bs){if(Jo[bs]===void 0)throw new Xn(Cs+": Invalid unit definition. Unit "+bs+" in 'denominator' is not recognized")})}var ia={},sa={},Ma={},pa={},oa={};for(var ha in Jo)if(Jo.hasOwnProperty(ha)){var ca=Jo[ha];if(ca[2]==="prefix"){ia[ha]=ca[1];for(var da=0;da<ca[0].length;da++)sa[ca[0][da]]=ha}else{ta(ha,ca),Ma[ha]={scalar:ca[1],numerator:ca[3],denominator:ca[4]};for(var ga=0;ga<ca[0].length;ga++)pa[ca[0][ga]]=ha}oa[ha]=ca[0][0]}function qa(Cs){var Kn,qn=[],Un=Object.keys(Jo);if(typeof Cs>"u")for(Kn=0;Kn<Un.length;Kn++)["","prefix"].indexOf(Jo[Un[Kn]][2])===-1&&qn.push(Un[Kn].substr(1,Un[Kn].length-2));else{if(this.getKinds().indexOf(Cs)===-1)throw new Xn("Kind not recognized");for(Kn=0;Kn<Un.length;Kn++)Jo[Un[Kn]][2]===Cs&&qn.push(Un[Kn].substr(1,Un[Kn].length-2))}return qn.sort(function(vs,bs){return vs.toLowerCase()<bs.toLowerCase()?-1:vs.toLowerCase()>bs.toLowerCase()?1:0})}function Ka(Cs){if(!pa[Cs])throw new Xn("Unit not recognized");return Jo[pa[Cs]][0]}var il=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function cl(){if(this.signature)return this.signature;for(var Cs=wl.call(this),Kn=0;Kn<Cs.length;Kn++)Cs[Kn]*=Math.pow(20,Kn);return Cs.reduce(function(qn,Un){return qn+Un},0)}function wl(){if(!this.isBase())return wl.call(this.toBase());for(var Cs=new Array(il.length),Kn=0;Kn<Cs.length;Kn++)Cs[Kn]=0;for(var qn,Un,vs=0;vs<this.numerator.length;vs++)(qn=Jo[this.numerator[vs]])&&(Un=il.indexOf(qn[2]),Un>=0&&(Cs[Un]=Cs[Un]+1));for(var bs=0;bs<this.denominator.length;bs++)(qn=Jo[this.denominator[bs]])&&(Un=il.indexOf(qn[2]),Un>=0&&(Cs[Un]=Cs[Un]-1));return Cs}var al="[+-]",vl="\\d+",ml=al+"?"+vl,ol="\\."+vl,el="(?:"+vl+"(?:"+ol+")?)|(?:"+ol+")",dl="[Ee]"+ml,xl="(?:"+el+")(?:"+dl+")?",Ja=al+"?\\s*"+xl,yl="("+Ja+")?\\s*([^/]*)(?:/(.+))?",Ol=new RegExp("^"+yl+"$"),Il="\\^|\\*{2}",Rl="[01234]",Al=new RegExp("([^ \\*\\d]+?)(?:"+Il+")?(-?"+Rl+"(?![a-zA-Z]))"),zl=new RegExp("([^ \\*\\d]+?)(?:"+Il+")?("+Rl+"(?![a-zA-Z]))");function Ql(Cs){ze(Cs)||(Cs=Cs.toString()),Cs=Cs.trim();var Kn=Ol.exec(Cs);if(!Kn)throw new Xn(Cs+": Quantity not recognized");var qn=Kn[1];qn?(qn=qn.replace(/\s/g,""),this.scalar=parseFloat(qn)):this.scalar=1;for(var Un=Kn[2],vs=Kn[3],bs,aa,la;Kn=Al.exec(Un);){if(bs=parseFloat(Kn[2]),isNaN(bs))throw new Xn("Unit exponent is not a number");if(bs===0&&!Ll.test(Kn[1]))throw new Xn("Unit not recognized");aa=Kn[1]+" ",la="";for(var ua=0;ua<Math.abs(bs);ua++)la+=aa;bs>=0?Un=Un.replace(Kn[0],la):(vs=vs?vs+la:la,Un=Un.replace(Kn[0],""))}for(;Kn=zl.exec(vs);){if(bs=parseFloat(Kn[2]),isNaN(bs))throw new Xn("Unit exponent is not a number");if(bs===0&&!Ll.test(Kn[1]))throw new Xn("Unit not recognized");aa=Kn[1]+" ",la="";for(var fa=0;fa<bs;fa++)la+=aa;vs=vs.replace(Kn[0],la)}Un&&(this.numerator=Pl(Un.trim())),vs&&(this.denominator=Pl(vs.trim()))}var Xl=Object.keys(sa).sort(function(Cs,Kn){return Kn.length-Cs.length}).join("|"),Tl=Object.keys(pa).sort(function(Cs,Kn){return Kn.length-Cs.length}).join("|"),pl="\\b|$",Hl="("+Xl+")??("+Tl+")(?:"+pl+")",Ll=new RegExp("^\\s*("+Hl+"[\\s\\*]*)+$"),Vl=new RegExp(Hl,"g"),rl={};function Pl(Cs){var Kn=rl[Cs];if(Kn)return Kn;var qn,Un=[];if(!Ll.test(Cs))throw new Xn("Unit not recognized");for(;qn=Vl.exec(Cs);)Un.push(qn.slice(1));return Un=Un.map(function(vs){return sa[vs[0]]?[sa[vs[0]],pa[vs[1]]]:[pa[vs[1]]]}),Un=Un.reduce(function(vs,bs){return vs.concat(bs)},[]),Un=Un.filter(function(vs){return vs}),rl[Cs]=Un,Un}function kl(Cs){if(!ze(Cs))throw new Xn("Argument should be a string");try{return this(Cs)}catch{return null}}function Dl(Cs){return Cs instanceof fl}function fl(Cs,Kn){if(Gl.apply(null,arguments),!Dl(this))return new fl(Cs,Kn);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=na,this.denominator=na,ql(Cs)?(this.scalar=Cs.scalar,this.numerator=Cs.numerator&&Cs.numerator.length!==0?Cs.numerator:na,this.denominator=Cs.denominator&&Cs.denominator.length!==0?Cs.denominator:na):Kn?(Ql.call(this,Kn),this.scalar=Cs):Ql.call(this,Cs),this.denominator.join("*").indexOf("temp")>=0)throw new Xn("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new Xn("Cannot multiply by temperatures");if(!ln(this.denominator,na))throw new Xn("Cannot divide with temperatures")}if(this.initValue=Cs,Cl.call(this),this.isTemperature()&&this.baseScalar<0)throw new Xn("Temperatures must not be less than absolute zero")}fl.prototype={constructor:fl};function Gl(Cs,Kn){if(Kn){if(!(Qe(Cs)&&ze(Kn)))throw new Xn("Only number accepted as initialization value when units are explicitly provided")}else if(!(ze(Cs)||Qe(Cs)||Dl(Cs)||ql(Cs)))throw new Xn("Only string, number or quantity accepted as single initialization value")}function ql(Cs){return Cs&&typeof Cs=="object"&&Cs.hasOwnProperty("scalar")}function Cl(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=cl.call(this);else{var Cs=this.toBase();this.baseScalar=Cs.scalar,this.signature=Cs.signature}}var El={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber",0:"unitless",1:"length",2:"area",3:"volume",20:"time",400:"temperature",7941:"yank",7942:"power",7959:"pressure",7961:"force",7962:"energy",7979:"viscosity",7981:"momentum",7982:"angular_momentum",7997:"density",7998:"area_density",8e3:"mass",152020:"radiation_exposure",159999:"magnetism",16e4:"current",160020:"charge",312058:"conductance",312078:"capacitance",3199980:"activity",3199997:"molar_concentration",32e5:"substance",63999998:"illuminance",64e6:"luminous_power",128e7:"currency","25599999980":"information_rate","25600000000":"information","511999999980":"angular_velocity","512000000000":"angle"};function Bl(){return nn(Object.keys(El).map(function(Cs){return El[Cs]}))}fl.prototype.kind=function(){return El[this.signature.toString()]},cn(fl.prototype,{isDegrees:function(){return(this.signature===null||this.signature===400)&&this.numerator.length===1&&ln(this.denominator,na)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}});function Ml(Cs,Kn){var qn=Cs.units(),Un=Kn.to(qn),vs=fl(Nl(qn));return fl({scalar:Cs.scalar-Un.scalar,numerator:vs.numerator,denominator:vs.denominator})}function Ul(Cs,Kn){var qn=Kn.to(Nl(Cs.units()));return fl({scalar:Cs.scalar-qn.scalar,numerator:Cs.numerator,denominator:Cs.denominator})}function Kl(Cs,Kn){var qn=Kn.to(Nl(Cs.units()));return fl({scalar:Cs.scalar+qn.scalar,numerator:Cs.numerator,denominator:Cs.denominator})}function Nl(Cs){if(Cs==="tempK")return"degK";if(Cs==="tempC")return"degC";if(Cs==="tempF")return"degF";if(Cs==="tempR")return"degR";throw new Xn("Unknown type for temp conversion from: "+Cs)}function Zl(Cs,Kn){var qn=Wl(Cs),Un=Kn.units(),vs;if(Un==="degK")vs=qn.scalar;else if(Un==="degC")vs=qn.scalar;else if(Un==="degF")vs=qn.scalar*9/5;else if(Un==="degR")vs=qn.scalar*9/5;else throw new Xn("Unknown type for degree conversion to: "+Un);return fl({scalar:vs,numerator:Kn.numerator,denominator:Kn.denominator})}function Wl(Cs){var Kn=Cs.units(),qn;if(Kn.match(/(deg)[CFRK]/))qn=Cs.baseScalar;else if(Kn==="tempK")qn=Cs.scalar;else if(Kn==="tempC")qn=Cs.scalar;else if(Kn==="tempF")qn=Cs.scalar*5/9;else if(Kn==="tempR")qn=Cs.scalar*5/9;else throw new Xn("Unknown type for temp conversion from: "+Kn);return fl({scalar:qn,numerator:["<kelvin>"],denominator:na})}function mh(Cs,Kn){var qn=Kn.units(),Un;if(qn==="tempK")Un=Cs.baseScalar;else if(qn==="tempC")Un=Cs.baseScalar-273.15;else if(qn==="tempF")Un=Cs.baseScalar*9/5-459.67;else if(qn==="tempR")Un=Cs.baseScalar*9/5;else throw new Xn("Unknown type for temp conversion to: "+qn);return fl({scalar:Un,numerator:Kn.numerator,denominator:Kn.denominator})}function Eh(Cs){var Kn=Cs.units(),qn;if(Kn.match(/(deg)[CFRK]/))qn=Cs.baseScalar;else if(Kn==="tempK")qn=Cs.scalar;else if(Kn==="tempC")qn=Cs.scalar+273.15;else if(Kn==="tempF")qn=(Cs.scalar+459.67)*5/9;else if(Kn==="tempR")qn=Cs.scalar*5/9;else throw new Xn("Unknown type for temp conversion from: "+Kn);return fl({scalar:qn,numerator:["<temp-K>"],denominator:na})}cn(fl.prototype,{to:function(Cs){var Kn,qn;if(Cs==null)return this;if(!ze(Cs))return this.to(Cs.units());if(Kn=this._conversionCache[Cs],Kn)return Kn;if(qn=fl(Cs),qn.units()===this.units())return this;if(!this.isCompatible(qn))this.isInverse(qn)?qn=this.inverse().to(Cs):ys(this.units(),qn.units());else if(qn.isTemperature())qn=mh(this,qn);else if(qn.isDegrees())qn=Zl(this,qn);else{var Un=un(this.baseScalar,qn.baseScalar);qn=fl({scalar:Un,numerator:qn.numerator,denominator:qn.denominator})}return this._conversionCache[Cs]=qn,qn},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return Eh(this);var Cs=Dh[this.units()];return Cs||(Cs=Vh(this.numerator,this.denominator),Dh[this.units()]=Cs),Cs.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new Xn("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function(Cs){if(ze(Cs)&&(Cs=fl(Cs)),Qe(Cs)&&(Cs=fl(Cs+" "+this.units())),this.isUnitless()?Cs.isUnitless()||ys(this.units(),Cs.units()):Cs=Cs.to(this.units()),Cs.scalar===0)throw new Xn("Divide by zero");var Kn=hn(Math.round(this.scalar/Cs.scalar),Cs.scalar);return fl(Kn+this.units())}});function _h(Cs,Kn){var qn=fl(Cs),Un=fl(Kn);if(qn.eq(Un))return Pi;var vs;return qn.isTemperature()?vs=function(bs){return qn.mul(bs).to(Un).scalar}:vs=function(bs){return bs*qn.baseScalar/Un.baseScalar},function(aa){var la,ua,fa;if(Array.isArray(aa)){for(ua=aa.length,fa=[],la=0;la<ua;la++)fa.push(vs(aa[la]));return fa}else return vs(aa)}}var Dh={};function Vh(Cs,Kn){for(var qn=[],Un=[],vs=1,bs,aa=0;aa<Cs.length;aa++)bs=Cs[aa],ia[bs]?vs=hn(vs,ia[bs]):Ma[bs]&&(vs*=Ma[bs].scalar,Ma[bs].numerator&&qn.push(Ma[bs].numerator),Ma[bs].denominator&&Un.push(Ma[bs].denominator));for(var la=0;la<Kn.length;la++)bs=Kn[la],ia[bs]?vs/=ia[bs]:Ma[bs]&&(vs/=Ma[bs].scalar,Ma[bs].numerator&&Un.push(Ma[bs].numerator),Ma[bs].denominator&&qn.push(Ma[bs].denominator));return qn=qn.reduce(function(ua,fa){return ua.concat(fa)},[]),Un=Un.reduce(function(ua,fa){return ua.concat(fa)},[]),fl({scalar:vs,numerator:qn,denominator:Un})}fl.parse=kl,fl.getUnits=qa,fl.getAliases=Ka,fl.mulSafe=hn,fl.divSafe=un,fl.getKinds=Bl,fl.swiftConverter=_h,fl.Error=Xn,cn(fl.prototype,{add:function(Cs){if(ze(Cs)&&(Cs=fl(Cs)),this.isCompatible(Cs)||ys(this.units(),Cs.units()),this.isTemperature()&&Cs.isTemperature())throw new Xn("Cannot add two temperatures");return this.isTemperature()?Kl(this,Cs):Cs.isTemperature()?Kl(Cs,this):fl({scalar:this.scalar+Cs.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function(Cs){if(ze(Cs)&&(Cs=fl(Cs)),this.isCompatible(Cs)||ys(this.units(),Cs.units()),this.isTemperature()&&Cs.isTemperature())return Ml(this,Cs);if(this.isTemperature())return Ul(this,Cs);if(Cs.isTemperature())throw new Xn("Cannot subtract a temperature from a differential degree unit");return fl({scalar:this.scalar-Cs.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function(Cs){if(Qe(Cs))return fl({scalar:hn(this.scalar,Cs),numerator:this.numerator,denominator:this.denominator});if(ze(Cs)&&(Cs=fl(Cs)),(this.isTemperature()||Cs.isTemperature())&&!(this.isUnitless()||Cs.isUnitless()))throw new Xn("Cannot multiply by temperatures");var Kn=this,qn=Cs;Kn.isCompatible(qn)&&Kn.signature!==400&&(qn=qn.to(Kn));var Un=zh(Kn.numerator,Kn.denominator,qn.numerator,qn.denominator);return fl({scalar:hn(Kn.scalar,qn.scalar,Un[2]),numerator:Un[0],denominator:Un[1]})},div:function(Cs){if(Qe(Cs)){if(Cs===0)throw new Xn("Divide by zero");return fl({scalar:this.scalar/Cs,numerator:this.numerator,denominator:this.denominator})}else ze(Cs)&&(Cs=fl(Cs));if(Cs.scalar===0)throw new Xn("Divide by zero");if(Cs.isTemperature())throw new Xn("Cannot divide with temperatures");if(this.isTemperature()&&!Cs.isUnitless())throw new Xn("Cannot divide with temperatures");var Kn=this,qn=Cs;Kn.isCompatible(qn)&&Kn.signature!==400&&(qn=qn.to(Kn));var Un=zh(Kn.numerator,Kn.denominator,qn.denominator,qn.numerator);return fl({scalar:hn(Kn.scalar,Un[2])/qn.scalar,numerator:Un[0],denominator:Un[1]})},inverse:function(){if(this.isTemperature())throw new Xn("Cannot divide with temperatures");if(this.scalar===0)throw new Xn("Divide by zero");return fl({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}});function zh(Cs,Kn,qn,Un){function vs(ll){return ll!==ra}Cs=Cs.filter(vs),qn=qn.filter(vs),Kn=Kn.filter(vs),Un=Un.filter(vs);var bs={};function aa(ll,tl){for(var sl,bl,Ua,ul=0;ul<ll.length;ul++)if(ia[ll[ul]]?(sl=ll[ul+1],bl=ll[ul],Ua=ia[bl],ul++):(sl=ll[ul],bl=null,Ua=1),sl&&sl!==ra)if(bs[sl]){bs[sl][0]+=tl;var _l=bs[sl][2]?ia[bs[sl][2]]:1;bs[sl][tl===1?3:4]*=un(Ua,_l)}else bs[sl]=[tl,sl,bl,1,1]}aa(Cs,1),aa(Kn,-1),aa(qn,1),aa(Un,-1);var la=[],ua=[],fa=1;for(var Qa in bs)if(bs.hasOwnProperty(Qa)){var Na=bs[Qa],nl;if(Na[0]>0)for(nl=0;nl<Na[0];nl++)la.push(Na[2]===null?Na[1]:[Na[2],Na[1]]);else if(Na[0]<0)for(nl=0;nl<-Na[0];nl++)ua.push(Na[2]===null?Na[1]:[Na[2],Na[1]]);fa*=un(Na[3],Na[4])}return la.length===0&&(la=na),ua.length===0&&(ua=na),la=la.reduce(function(ll,tl){return ll.concat(tl)},[]),ua=ua.reduce(function(ll,tl){return ll.concat(tl)},[]),[la,ua,fa]}cn(fl.prototype,{eq:function(Cs){return this.compareTo(Cs)===0},lt:function(Cs){return this.compareTo(Cs)===-1},lte:function(Cs){return this.eq(Cs)||this.lt(Cs)},gt:function(Cs){return this.compareTo(Cs)===1},gte:function(Cs){return this.eq(Cs)||this.gt(Cs)},compareTo:function(Cs){if(ze(Cs))return this.compareTo(fl(Cs));if(this.isCompatible(Cs)||ys(this.units(),Cs.units()),this.baseScalar<Cs.baseScalar)return-1;if(this.baseScalar===Cs.baseScalar)return 0;if(this.baseScalar>Cs.baseScalar)return 1},same:function(Cs){return this.scalar===Cs.scalar&&this.units()===Cs.units()}}),cn(fl.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every(function(Cs){return ln(Cs,na)})},isCompatible:function(Cs){return ze(Cs)?this.isCompatible(fl(Cs)):Dl(Cs)&&Cs.signature!==void 0?this.signature===Cs.signature:!1},isInverse:function(Cs){return this.inverse().isCompatible(Cs)},isBase:function(){return this._isBase!==void 0?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach(function(Cs){Cs!==ra&&ea.indexOf(Cs)===-1&&(this._isBase=!1)},this),this._isBase===!1?this._isBase:(this._isBase=!0,this._isBase))}});function Oh(){}Oh.prototype.get=function(Cs){return arguments.length>1&&(Cs=Array.apply(null,arguments)),Cs.reduce(function(Kn,qn,Un){if(Kn){var vs=Kn[qn];return Un===Cs.length-1?vs?vs.data:void 0:vs}},this)},Oh.prototype.set=function(Cs,Kn){return arguments.length>2&&(Cs=Array.prototype.slice.call(arguments,0,-1),Kn=arguments[arguments.length-1]),Cs.reduce(function(qn,Un,vs){var bs=qn[Un];return bs===void 0&&(bs=qn[Un]={}),vs===Cs.length-1?(bs.data=Kn,Kn):bs},this)};function Fh(Cs,Kn){return(Cs+" "+Kn).trim()}fl.formatter=Fh,cn(fl.prototype,{units:function(){if(this._units!==void 0)return this._units;var Cs=ln(this.numerator,na),Kn=ln(this.denominator,na);if(Cs&&Kn)return this._units="",this._units;var qn=Ih(this.numerator),Un=Ih(this.denominator);return this._units=qn+(Kn?"":"/"+Un),this._units},toString:function(Cs,Kn){var qn;if(Qe(Cs))qn=this.units(),Kn=Cs;else if(ze(Cs))qn=Cs;else if(Dl(Cs))return this.toPrec(Cs).toString(Kn);var Un=this.to(qn),vs=Kn!==void 0?xs(Un.scalar,Kn):Un.scalar;return Un=(vs+" "+Un.units()).trim(),Un},format:function(Cs,Kn){arguments.length===1&&typeof Cs=="function"&&(Kn=Cs,Cs=void 0),Kn=Kn||fl.formatter;var qn=this.to(Cs);return Kn.call(this,qn.scalar,qn.units())}});var Xh=new Oh;function Ih(Cs){var Kn=Xh.get(Cs);if(Kn)return Kn;var qn=ln(Cs,na);return qn?Kn="1":Kn=Nh(Sh(Cs)).join("*"),Xh.set(Cs,Kn),Kn}function Sh(Cs){for(var Kn=[],qn,Un,vs=0;vs<Cs.length;vs++)qn=Cs[vs],Un=Cs[vs+1],ia[qn]?(Kn.push(oa[qn]+oa[Un]),vs++):Kn.push(oa[qn]);return Kn}function Nh(Cs){var Kn=Cs.reduce(function(qn,Un){var vs=qn[Un];return vs||qn.push(vs=qn[Un]=[Un,0]),vs[1]++,qn},[]);return Kn.map(function(qn){return qn[0]+(qn[1]>1?qn[1]:"")})}return fl.version="1.8.0",fl})}(quantities$1)),quantities$1.exports}var quantitiesExports=requireQuantities();const Qty=getDefaultExportFromCjs(quantitiesExports);function deepValue(qe,f=""){let ze=f.split(".");for(let Ke of ze){if(qe[Ke]===void 0)return;qe=qe[Ke]}return qe}var orientation={exports:{}},twoProduct_1,hasRequiredTwoProduct;function requireTwoProduct(){if(hasRequiredTwoProduct)return twoProduct_1;hasRequiredTwoProduct=1,twoProduct_1=f;var qe=+(Math.pow(2,27)+1);function f(ze,Ke,Qe){var Pi=ze*Ke,nn=qe*ze,ln=nn-ze,cn=nn-ln,hn=ze-cn,un=qe*Ke,xs=un-Ke,zn=un-xs,Xn=Ke-zn,ys=Pi-cn*zn,Jo=ys-hn*zn,ea=Jo-cn*Xn,ra=hn*Xn-ea;return Qe?(Qe[0]=ra,Qe[1]=Pi,Qe):[ra,Pi]}return twoProduct_1}var robustSum,hasRequiredRobustSum;function requireRobustSum(){if(hasRequiredRobustSum)return robustSum;hasRequiredRobustSum=1,robustSum=f;function qe(ze,Ke){var Qe=ze+Ke,Pi=Qe-ze,nn=Qe-Pi,ln=Ke-Pi,cn=ze-nn,hn=cn+ln;return hn?[hn,Qe]:[Qe]}function f(ze,Ke){var Qe=ze.length|0,Pi=Ke.length|0;if(Qe===1&&Pi===1)return qe(ze[0],Ke[0]);var nn=Qe+Pi,ln=new Array(nn),cn=0,hn=0,un=0,xs=Math.abs,zn=ze[hn],Xn=xs(zn),ys=Ke[un],Jo=xs(ys),ea,ra;Xn<Jo?(ra=zn,hn+=1,hn<Qe&&(zn=ze[hn],Xn=xs(zn))):(ra=ys,un+=1,un<Pi&&(ys=Ke[un],Jo=xs(ys))),hn<Qe&&Xn<Jo||un>=Pi?(ea=zn,hn+=1,hn<Qe&&(zn=ze[hn],Xn=xs(zn))):(ea=ys,un+=1,un<Pi&&(ys=Ke[un],Jo=xs(ys)));for(var na=ea+ra,ta=na-ea,ia=ra-ta,sa=ia,Ma=na,pa,oa,ha,ca,da;hn<Qe&&un<Pi;)Xn<Jo?(ea=zn,hn+=1,hn<Qe&&(zn=ze[hn],Xn=xs(zn))):(ea=ys,un+=1,un<Pi&&(ys=Ke[un],Jo=xs(ys))),ra=sa,na=ea+ra,ta=na-ea,ia=ra-ta,ia&&(ln[cn++]=ia),pa=Ma+na,oa=pa-Ma,ha=pa-oa,ca=na-oa,da=Ma-ha,sa=da+ca,Ma=pa;for(;hn<Qe;)ea=zn,ra=sa,na=ea+ra,ta=na-ea,ia=ra-ta,ia&&(ln[cn++]=ia),pa=Ma+na,oa=pa-Ma,ha=pa-oa,ca=na-oa,da=Ma-ha,sa=da+ca,Ma=pa,hn+=1,hn<Qe&&(zn=ze[hn]);for(;un<Pi;)ea=ys,ra=sa,na=ea+ra,ta=na-ea,ia=ra-ta,ia&&(ln[cn++]=ia),pa=Ma+na,oa=pa-Ma,ha=pa-oa,ca=na-oa,da=Ma-ha,sa=da+ca,Ma=pa,un+=1,un<Pi&&(ys=Ke[un]);return sa&&(ln[cn++]=sa),Ma&&(ln[cn++]=Ma),cn||(ln[cn++]=0),ln.length=cn,ln}return robustSum}var twoSum,hasRequiredTwoSum;function requireTwoSum(){if(hasRequiredTwoSum)return twoSum;hasRequiredTwoSum=1,twoSum=qe;function qe(f,ze,Ke){var Qe=f+ze,Pi=Qe-f,nn=Qe-Pi,ln=ze-Pi,cn=f-nn;return Ke?(Ke[0]=cn+ln,Ke[1]=Qe,Ke):[cn+ln,Qe]}return twoSum}var robustScale,hasRequiredRobustScale;function requireRobustScale(){if(hasRequiredRobustScale)return robustScale;hasRequiredRobustScale=1;var qe=requireTwoProduct(),f=requireTwoSum();robustScale=ze;function ze(Ke,Qe){var Pi=Ke.length;if(Pi===1){var nn=qe(Ke[0],Qe);return nn[0]?nn:[nn[1]]}var ln=new Array(2*Pi),cn=[.1,.1],hn=[.1,.1],un=0;qe(Ke[0],Qe,cn),cn[0]&&(ln[un++]=cn[0]);for(var xs=1;xs<Pi;++xs){qe(Ke[xs],Qe,hn);var zn=cn[1];f(zn,hn[0],cn),cn[0]&&(ln[un++]=cn[0]);var Xn=hn[1],ys=cn[1],Jo=Xn+ys,ea=Jo-Xn,ra=ys-ea;cn[1]=Jo,ra&&(ln[un++]=ra)}return cn[1]&&(ln[un++]=cn[1]),un===0&&(ln[un++]=0),ln.length=un,ln}return robustScale}var robustDiff,hasRequiredRobustDiff;function requireRobustDiff(){if(hasRequiredRobustDiff)return robustDiff;hasRequiredRobustDiff=1,robustDiff=f;function qe(ze,Ke){var Qe=ze+Ke,Pi=Qe-ze,nn=Qe-Pi,ln=Ke-Pi,cn=ze-nn,hn=cn+ln;return hn?[hn,Qe]:[Qe]}function f(ze,Ke){var Qe=ze.length|0,Pi=Ke.length|0;if(Qe===1&&Pi===1)return qe(ze[0],-Ke[0]);var nn=Qe+Pi,ln=new Array(nn),cn=0,hn=0,un=0,xs=Math.abs,zn=ze[hn],Xn=xs(zn),ys=-Ke[un],Jo=xs(ys),ea,ra;Xn<Jo?(ra=zn,hn+=1,hn<Qe&&(zn=ze[hn],Xn=xs(zn))):(ra=ys,un+=1,un<Pi&&(ys=-Ke[un],Jo=xs(ys))),hn<Qe&&Xn<Jo||un>=Pi?(ea=zn,hn+=1,hn<Qe&&(zn=ze[hn],Xn=xs(zn))):(ea=ys,un+=1,un<Pi&&(ys=-Ke[un],Jo=xs(ys)));for(var na=ea+ra,ta=na-ea,ia=ra-ta,sa=ia,Ma=na,pa,oa,ha,ca,da;hn<Qe&&un<Pi;)Xn<Jo?(ea=zn,hn+=1,hn<Qe&&(zn=ze[hn],Xn=xs(zn))):(ea=ys,un+=1,un<Pi&&(ys=-Ke[un],Jo=xs(ys))),ra=sa,na=ea+ra,ta=na-ea,ia=ra-ta,ia&&(ln[cn++]=ia),pa=Ma+na,oa=pa-Ma,ha=pa-oa,ca=na-oa,da=Ma-ha,sa=da+ca,Ma=pa;for(;hn<Qe;)ea=zn,ra=sa,na=ea+ra,ta=na-ea,ia=ra-ta,ia&&(ln[cn++]=ia),pa=Ma+na,oa=pa-Ma,ha=pa-oa,ca=na-oa,da=Ma-ha,sa=da+ca,Ma=pa,hn+=1,hn<Qe&&(zn=ze[hn]);for(;un<Pi;)ea=ys,ra=sa,na=ea+ra,ta=na-ea,ia=ra-ta,ia&&(ln[cn++]=ia),pa=Ma+na,oa=pa-Ma,ha=pa-oa,ca=na-oa,da=Ma-ha,sa=da+ca,Ma=pa,un+=1,un<Pi&&(ys=-Ke[un]);return sa&&(ln[cn++]=sa),Ma&&(ln[cn++]=Ma),cn||(ln[cn++]=0),ln.length=cn,ln}return robustDiff}var hasRequiredOrientation;function requireOrientation(){return hasRequiredOrientation||(hasRequiredOrientation=1,function(qe){var f=requireTwoProduct(),ze=requireRobustSum(),Ke=requireRobustScale(),Qe=requireRobustDiff(),Pi=5,nn=11102230246251565e-32,ln=(3+16*nn)*nn,cn=(7+56*nn)*nn;function hn(ta,ia,sa,Ma){return function(oa,ha,ca){var da=ta(ta(ia(ha[1],ca[0]),ia(-ca[1],ha[0])),ta(ia(oa[1],ha[0]),ia(-ha[1],oa[0]))),ga=ta(ia(oa[1],ca[0]),ia(-ca[1],oa[0])),qa=Ma(da,ga);return qa[qa.length-1]}}function un(ta,ia,sa,Ma){return function(oa,ha,ca,da){var ga=ta(ta(sa(ta(ia(ca[1],da[0]),ia(-da[1],ca[0])),ha[2]),ta(sa(ta(ia(ha[1],da[0]),ia(-da[1],ha[0])),-ca[2]),sa(ta(ia(ha[1],ca[0]),ia(-ca[1],ha[0])),da[2]))),ta(sa(ta(ia(ha[1],da[0]),ia(-da[1],ha[0])),oa[2]),ta(sa(ta(ia(oa[1],da[0]),ia(-da[1],oa[0])),-ha[2]),sa(ta(ia(oa[1],ha[0]),ia(-ha[1],oa[0])),da[2])))),qa=ta(ta(sa(ta(ia(ca[1],da[0]),ia(-da[1],ca[0])),oa[2]),ta(sa(ta(ia(oa[1],da[0]),ia(-da[1],oa[0])),-ca[2]),sa(ta(ia(oa[1],ca[0]),ia(-ca[1],oa[0])),da[2]))),ta(sa(ta(ia(ha[1],ca[0]),ia(-ca[1],ha[0])),oa[2]),ta(sa(ta(ia(oa[1],ca[0]),ia(-ca[1],oa[0])),-ha[2]),sa(ta(ia(oa[1],ha[0]),ia(-ha[1],oa[0])),ca[2])))),Ka=Ma(ga,qa);return Ka[Ka.length-1]}}function xs(ta,ia,sa,Ma){return function(oa,ha,ca,da,ga){var qa=ta(ta(ta(sa(ta(sa(ta(ia(da[1],ga[0]),ia(-ga[1],da[0])),ca[2]),ta(sa(ta(ia(ca[1],ga[0]),ia(-ga[1],ca[0])),-da[2]),sa(ta(ia(ca[1],da[0]),ia(-da[1],ca[0])),ga[2]))),ha[3]),ta(sa(ta(sa(ta(ia(da[1],ga[0]),ia(-ga[1],da[0])),ha[2]),ta(sa(ta(ia(ha[1],ga[0]),ia(-ga[1],ha[0])),-da[2]),sa(ta(ia(ha[1],da[0]),ia(-da[1],ha[0])),ga[2]))),-ca[3]),sa(ta(sa(ta(ia(ca[1],ga[0]),ia(-ga[1],ca[0])),ha[2]),ta(sa(ta(ia(ha[1],ga[0]),ia(-ga[1],ha[0])),-ca[2]),sa(ta(ia(ha[1],ca[0]),ia(-ca[1],ha[0])),ga[2]))),da[3]))),ta(sa(ta(sa(ta(ia(ca[1],da[0]),ia(-da[1],ca[0])),ha[2]),ta(sa(ta(ia(ha[1],da[0]),ia(-da[1],ha[0])),-ca[2]),sa(ta(ia(ha[1],ca[0]),ia(-ca[1],ha[0])),da[2]))),-ga[3]),ta(sa(ta(sa(ta(ia(da[1],ga[0]),ia(-ga[1],da[0])),ha[2]),ta(sa(ta(ia(ha[1],ga[0]),ia(-ga[1],ha[0])),-da[2]),sa(ta(ia(ha[1],da[0]),ia(-da[1],ha[0])),ga[2]))),oa[3]),sa(ta(sa(ta(ia(da[1],ga[0]),ia(-ga[1],da[0])),oa[2]),ta(sa(ta(ia(oa[1],ga[0]),ia(-ga[1],oa[0])),-da[2]),sa(ta(ia(oa[1],da[0]),ia(-da[1],oa[0])),ga[2]))),-ha[3])))),ta(ta(sa(ta(sa(ta(ia(ha[1],ga[0]),ia(-ga[1],ha[0])),oa[2]),ta(sa(ta(ia(oa[1],ga[0]),ia(-ga[1],oa[0])),-ha[2]),sa(ta(ia(oa[1],ha[0]),ia(-ha[1],oa[0])),ga[2]))),da[3]),ta(sa(ta(sa(ta(ia(ha[1],da[0]),ia(-da[1],ha[0])),oa[2]),ta(sa(ta(ia(oa[1],da[0]),ia(-da[1],oa[0])),-ha[2]),sa(ta(ia(oa[1],ha[0]),ia(-ha[1],oa[0])),da[2]))),-ga[3]),sa(ta(sa(ta(ia(ca[1],da[0]),ia(-da[1],ca[0])),ha[2]),ta(sa(ta(ia(ha[1],da[0]),ia(-da[1],ha[0])),-ca[2]),sa(ta(ia(ha[1],ca[0]),ia(-ca[1],ha[0])),da[2]))),oa[3]))),ta(sa(ta(sa(ta(ia(ca[1],da[0]),ia(-da[1],ca[0])),oa[2]),ta(sa(ta(ia(oa[1],da[0]),ia(-da[1],oa[0])),-ca[2]),sa(ta(ia(oa[1],ca[0]),ia(-ca[1],oa[0])),da[2]))),-ha[3]),ta(sa(ta(sa(ta(ia(ha[1],da[0]),ia(-da[1],ha[0])),oa[2]),ta(sa(ta(ia(oa[1],da[0]),ia(-da[1],oa[0])),-ha[2]),sa(ta(ia(oa[1],ha[0]),ia(-ha[1],oa[0])),da[2]))),ca[3]),sa(ta(sa(ta(ia(ha[1],ca[0]),ia(-ca[1],ha[0])),oa[2]),ta(sa(ta(ia(oa[1],ca[0]),ia(-ca[1],oa[0])),-ha[2]),sa(ta(ia(oa[1],ha[0]),ia(-ha[1],oa[0])),ca[2]))),-da[3]))))),Ka=ta(ta(ta(sa(ta(sa(ta(ia(da[1],ga[0]),ia(-ga[1],da[0])),ca[2]),ta(sa(ta(ia(ca[1],ga[0]),ia(-ga[1],ca[0])),-da[2]),sa(ta(ia(ca[1],da[0]),ia(-da[1],ca[0])),ga[2]))),oa[3]),sa(ta(sa(ta(ia(da[1],ga[0]),ia(-ga[1],da[0])),oa[2]),ta(sa(ta(ia(oa[1],ga[0]),ia(-ga[1],oa[0])),-da[2]),sa(ta(ia(oa[1],da[0]),ia(-da[1],oa[0])),ga[2]))),-ca[3])),ta(sa(ta(sa(ta(ia(ca[1],ga[0]),ia(-ga[1],ca[0])),oa[2]),ta(sa(ta(ia(oa[1],ga[0]),ia(-ga[1],oa[0])),-ca[2]),sa(ta(ia(oa[1],ca[0]),ia(-ca[1],oa[0])),ga[2]))),da[3]),sa(ta(sa(ta(ia(ca[1],da[0]),ia(-da[1],ca[0])),oa[2]),ta(sa(ta(ia(oa[1],da[0]),ia(-da[1],oa[0])),-ca[2]),sa(ta(ia(oa[1],ca[0]),ia(-ca[1],oa[0])),da[2]))),-ga[3]))),ta(ta(sa(ta(sa(ta(ia(ca[1],ga[0]),ia(-ga[1],ca[0])),ha[2]),ta(sa(ta(ia(ha[1],ga[0]),ia(-ga[1],ha[0])),-ca[2]),sa(ta(ia(ha[1],ca[0]),ia(-ca[1],ha[0])),ga[2]))),oa[3]),sa(ta(sa(ta(ia(ca[1],ga[0]),ia(-ga[1],ca[0])),oa[2]),ta(sa(ta(ia(oa[1],ga[0]),ia(-ga[1],oa[0])),-ca[2]),sa(ta(ia(oa[1],ca[0]),ia(-ca[1],oa[0])),ga[2]))),-ha[3])),ta(sa(ta(sa(ta(ia(ha[1],ga[0]),ia(-ga[1],ha[0])),oa[2]),ta(sa(ta(ia(oa[1],ga[0]),ia(-ga[1],oa[0])),-ha[2]),sa(ta(ia(oa[1],ha[0]),ia(-ha[1],oa[0])),ga[2]))),ca[3]),sa(ta(sa(ta(ia(ha[1],ca[0]),ia(-ca[1],ha[0])),oa[2]),ta(sa(ta(ia(oa[1],ca[0]),ia(-ca[1],oa[0])),-ha[2]),sa(ta(ia(oa[1],ha[0]),ia(-ha[1],oa[0])),ca[2]))),-ga[3])))),il=Ma(qa,Ka);return il[il.length-1]}}function zn(ta){var ia=ta===3?hn:ta===4?un:xs;return ia(ze,f,Ke,Qe)}var Xn=zn(3),ys=zn(4),Jo=[function(){return 0},function(){return 0},function(ia,sa){return sa[0]-ia[0]},function(ia,sa,Ma){var pa=(ia[1]-Ma[1])*(sa[0]-Ma[0]),oa=(ia[0]-Ma[0])*(sa[1]-Ma[1]),ha=pa-oa,ca;if(pa>0){if(oa<=0)return ha;ca=pa+oa}else if(pa<0){if(oa>=0)return ha;ca=-(pa+oa)}else return ha;var da=ln*ca;return ha>=da||ha<=-da?ha:Xn(ia,sa,Ma)},function(ia,sa,Ma,pa){var oa=ia[0]-pa[0],ha=sa[0]-pa[0],ca=Ma[0]-pa[0],da=ia[1]-pa[1],ga=sa[1]-pa[1],qa=Ma[1]-pa[1],Ka=ia[2]-pa[2],il=sa[2]-pa[2],cl=Ma[2]-pa[2],wl=ha*qa,al=ca*ga,vl=ca*da,ml=oa*qa,ol=oa*ga,el=ha*da,dl=Ka*(wl-al)+il*(vl-ml)+cl*(ol-el),xl=(Math.abs(wl)+Math.abs(al))*Math.abs(Ka)+(Math.abs(vl)+Math.abs(ml))*Math.abs(il)+(Math.abs(ol)+Math.abs(el))*Math.abs(cl),Ja=cn*xl;return dl>Ja||-dl>Ja?dl:ys(ia,sa,Ma,pa)}];function ea(ta){var ia=Jo[ta.length];return ia||(ia=Jo[ta.length]=zn(ta.length)),ia.apply(void 0,ta)}function ra(ta,ia,sa,Ma,pa,oa,ha){return function(da,ga,qa,Ka,il){switch(arguments.length){case 0:case 1:return 0;case 2:return Ma(da,ga);case 3:return pa(da,ga,qa);case 4:return oa(da,ga,qa,Ka);case 5:return ha(da,ga,qa,Ka,il)}for(var cl=new Array(arguments.length),wl=0;wl<arguments.length;++wl)cl[wl]=arguments[wl];return ta(cl)}}function na(){for(;Jo.length<=Pi;)Jo.push(zn(Jo.length));qe.exports=ra.apply(void 0,[ea].concat(Jo));for(var ta=0;ta<=Pi;++ta)qe.exports[ta]=Jo[ta]}na()}(orientation)),orientation.exports}var robustPnp,hasRequiredRobustPnp;function requireRobustPnp(){if(hasRequiredRobustPnp)return robustPnp;hasRequiredRobustPnp=1,robustPnp=f;var qe=requireOrientation();function f(ze,Ke){for(var Qe=Ke[0],Pi=Ke[1],nn=ze.length,ln=1,cn=nn,hn=0,un=nn-1;hn<cn;un=hn++){var xs=ze[hn],zn=ze[un],Xn=xs[1],ys=zn[1];if(ys<Xn){if(ys<Pi&&Pi<Xn){var Jo=qe(xs,zn,Ke);if(Jo===0)return 0;ln^=0<Jo|0}else if(Pi===Xn){var ea=ze[(hn+1)%nn],ra=ea[1];if(Xn<ra){var Jo=qe(xs,zn,Ke);if(Jo===0)return 0;ln^=0<Jo|0}}}else if(Xn<ys){if(Xn<Pi&&Pi<ys){var Jo=qe(xs,zn,Ke);if(Jo===0)return 0;ln^=Jo<0|0}else if(Pi===Xn){var ea=ze[(hn+1)%nn],ra=ea[1];if(ra<Xn){var Jo=qe(xs,zn,Ke);if(Jo===0)return 0;ln^=Jo<0|0}}}else if(Pi===Xn){var na=Math.min(xs[0],zn[0]),ta=Math.max(xs[0],zn[0]);if(hn===0){for(;un>0;){var ia=(un+nn-1)%nn,sa=ze[ia];if(sa[1]!==Pi)break;var Ma=sa[0];na=Math.min(na,Ma),ta=Math.max(ta,Ma),un=ia}if(un===0)return na<=Qe&&Qe<=ta?0:1;cn=un+1}for(var pa=ze[(un+nn-1)%nn][1];hn+1<cn;){var sa=ze[hn+1];if(sa[1]!==Pi)break;var Ma=sa[0];na=Math.min(na,Ma),ta=Math.max(ta,Ma),hn+=1}if(na<=Qe&&Qe<=ta)return 0;var oa=ze[(hn+1)%nn][1];Qe<na&&pa<Pi!=oa<Pi&&(ln^=1)}}return 2*ln-1}return robustPnp}var robustPnpExports=requireRobustPnp();const robustPointInPolygon=getDefaultExportFromCjs(robustPnpExports);function feretDiameters(qe={}){const{originalPoints:f=monotoneChainConvexHull.call(this)}=qe;if(f.length===0)return{min:0,max:0,minLine:[],maxLine:[],aspectRatio:1};if(f.length===1)return{min:1,max:1,minLine:[f[0],f[0]],maxLine:[f[0],f[0]],aspectRatio:1};const ze=new Array(f.length);let Ke=1/0,Qe=0,Pi=[];for(let hn=0;hn<f.length;hn++){let un=getAngle(f[hn],f[(hn+1)%f.length]);rotate(-un,f,ze);let xs=0,zn=[];for(let Xn=0;Xn<f.length;Xn++){let ys=Math.abs(ze[hn][1]-ze[Xn][1]);ys>xs&&(xs=ys,zn=[],zn.push([ze[Xn][0],ze[hn][1]],[ze[Xn][0],ze[Xn][1]]))}xs<Ke&&(Ke=xs,Qe=un,Pi=zn)}rotate(Qe,Pi,Pi);let nn=0,ln=[],cn=0;for(let hn=0;hn<f.length-1;hn++)for(let un=hn+1;un<f.length;un++){let xs=(f[hn][0]-f[un][0])**2+(f[hn][1]-f[un][1])**2;xs>cn&&(cn=xs,nn=Math.sqrt(xs),ln=[f[hn],f[un]])}return{min:Ke,minLine:Pi,max:nn,maxLine:ln,aspectRatio:Ke/nn}}function getAngle(qe,f){let ze=difference(f,qe),Ke=normalize(ze),Qe=Math.acos(Ke[0]);return Ke[1]<0?-Qe:Qe}class Roi{constructor(f,ze){this.map=f,this.id=ze,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(f={}){const{scale:ze=1,kind:Ke=""}=f;let Qe;switch(Ke){case"contour":Qe=this.contourMask;break;case"box":Qe=this.boxMask;break;case"filled":Qe=this.filledMask;break;case"center":Qe=this.centerMask;break;case"mbr":Qe=this.mbrFilledMask;break;case"hull":Qe=this.convexHullFilledMask;break;case"hullContour":Qe=this.convexHullMask;break;case"mbrContour":Qe=this.mbrMask;break;case"feret":Qe=this.feretMask;break;default:Qe=this.mask}return ze<1&&(Qe=Qe.resize({factor:ze}),Qe.parent=this.mask.parent,Qe.position[0]+=this.minX,Qe.position[1]+=this.minY),Qe}get mean(){throw new Error("Roi mean not implemented yet")}get center(){return this.computed.center||(this.computed.center=[this.width/2>>0,this.height/2>>0]),this.computed.center}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){let f=this.borderIDs,ze=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];let Ke=this.internalIDs;for(let Qe=0;Qe<f.length;Qe++)Ke.includes(f[Qe])||(this.computed.externalIDs.push(f[Qe]),this.computed.externalLengths.push(ze[Qe]))}get externalIDs(){return this.computed.externalIDs?this.computed.externalIDs:(this._computExternalIDs(),this.computed.externalIDs)}get externalLengths(){return this.computed.externalLengths?this.computed.externalLengths:(this._computExternalIDs(),this.computed.externalLengths)}_computeBorderIDs(){let f=getBorders(this);this.computed.borderIDs=f.ids,this.computed.borderLengths=f.lengths}get borderIDs(){return this.computed.borderIDs?this.computed.borderIDs:(this._computeBorderIDs(),this.computed.borderIDs)}get borderLengths(){return this.computed.borderLengths?this.computed.borderLengths:(this._computeBorderIDs(),this.computed.borderLengths)}get boxIDs(){return this.computed.boxIDs||(this.computed.boxIDs=getBoxIDs(this)),this.computed.boxIDs}get internalIDs(){return this.computed.internalIDs||(this.computed.internalIDs=getInternalIDs(this)),this.computed.internalIDs}get box(){return this.computed.box||(this.computed.box=getBox(this)),this.computed.box}get external(){return this.computed.external||(this.computed.external=getExternal(this)),this.computed.external}get holesInfo(){return this.computed.holesInfo||(this.computed.holesInfo=getHolesInfo(this)),this.computed.holesInfo}get border(){return this.computed.border||(this.computed.border=getBorder(this)),this.computed.border}get contourMask(){if(!this.computed.contourMask){let f=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let ze=0;ze<this.width;ze++)for(let Ke=0;Ke<this.height;Ke++)this.map.data[ze+this.minX+(Ke+this.minY)*this.map.width]===this.id&&(ze>0&&ze<this.width-1&&Ke>0&&Ke<this.height-1?(this.map.data[ze-1+this.minX+(Ke+this.minY)*this.map.width]!==this.id||this.map.data[ze+1+this.minX+(Ke+this.minY)*this.map.width]!==this.id||this.map.data[ze+this.minX+(Ke-1+this.minY)*this.map.width]!==this.id||this.map.data[ze+this.minX+(Ke+1+this.minY)*this.map.width]!==this.id)&&f.setBitXY(ze,Ke):f.setBitXY(ze,Ke));this.computed.contourMask=f}return this.computed.contourMask}get boxMask(){if(!this.computed.boxMask){let f=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let ze=0;ze<this.width;ze++)f.setBitXY(ze,0),f.setBitXY(ze,this.height-1);for(let ze=0;ze<this.height;ze++)f.setBitXY(0,ze),f.setBitXY(this.width-1,ze);this.computed.boxMask=f}return this.computed.boxMask}get mask(){if(!this.computed.mask){let f=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let ze=0;ze<this.width;ze++)for(let Ke=0;Ke<this.height;Ke++)this.map.data[ze+this.minX+(Ke+this.minY)*this.map.width]===this.id&&f.setBitXY(ze,Ke);this.computed.mask=f}return this.computed.mask}get filledMask(){if(!this.computed.filledMask){let f=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let ze=0;ze<this.width;ze++)for(let Ke=0;Ke<this.height;Ke++){let Qe=ze+this.minX+(Ke+this.minY)*this.map.width;this.internalIDs.includes(this.map.data[Qe])&&f.setBitXY(ze,Ke)}this.computed.filledMask=f}return this.computed.filledMask}get centerMask(){if(!this.computed.centerMask){let f=new Shape({kind:"smallCross"}).getMask();f.parent=this.map.parent,f.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=f}return this.computed.centerMask}get convexHull(){if(!this.computed.convexHull){const f=[];for(let Ke=0;Ke<this.width;Ke++)for(let Qe=0;Qe<this.height;Qe++)this.map.data[Ke+this.minX+(Qe+this.minY)*this.map.width]===this.id&&(Ke>0&&Ke<this.width-1&&Qe>0&&Qe<this.height-1?(this.map.data[Ke-1+this.minX+(Qe+this.minY)*this.map.width]!==this.id||this.map.data[Ke+1+this.minX+(Qe+this.minY)*this.map.width]!==this.id||this.map.data[Ke+this.minX+(Qe-1+this.minY)*this.map.width]!==this.id||this.map.data[Ke+this.minX+(Qe+1+this.minY)*this.map.width]!==this.id)&&(f.push([Ke,Qe]),f.push([Ke+1,Qe]),f.push([Ke,Qe+1]),f.push([Ke+1,Qe+1])):(f.push([Ke,Qe]),f.push([Ke+1,Qe]),f.push([Ke,Qe+1]),f.push([Ke+1,Qe+1])));const ze=monotoneChainConvexHull$1(f);this.computed.convexHull={polyline:ze,surface:surface(ze),perimeter:perimeter(ze)}}return this.computed.convexHull}get convexHullMask(){if(!this.computed.convexHullMask){const f=this.convexHull,ze=new Image$1(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});ze.paintPolyline(f.polyline,{closed:!0}),this.computed.convexHullMask=ze}return this.computed.convexHullMask}get convexHullFilledMask(){if(!this.computed.convexHullFilledMask){const f=this.convexHull,ze=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let Ke=0;Ke<this.width;Ke++)for(let Qe=0;Qe<this.height;Qe++)robustPointInPolygon(f.polyline,[Ke,Qe])!==1&&ze.setBitXY(Ke,Qe);this.computed.convexHullFilledMask=ze}return this.computed.convexHullFilledMask}get mbr(){if(!this.computed.mbr){let f=minimalBoundingRectangle({originalPoints:this.convexHull.polyline});if(f.length===0)this.computed.mbr={width:0,height:0,surface:0,perimeter:0,rectangle:f};else{let ze=f[0],Ke=f[1],Qe=f[2],Pi=Math.sqrt((ze[0]-Ke[0])**2+(ze[1]-Ke[1])**2),nn=Math.sqrt((Qe[0]-Ke[0])**2+(Qe[1]-Ke[1])**2);this.computed.mbr={width:Pi,height:nn,elongation:1-Pi/nn,aspectRatio:Pi/nn,surface:Pi*nn,perimeter:(Pi+nn)*2,rectangle:f}}}return this.computed.mbr}get filledSurface(){return this.surface+this.holesInfo.surface}get fillRatio(){return this.surface/(this.surface+this.holesInfo.surface)}get feretDiameters(){return this.computed.feretDiameters||(this.computed.feretDiameters=feretDiameters({originalPoints:this.convexHull.polyline})),this.computed.feretDiameters}get eqpc(){return this.computed.eqpc||(this.computed.eqpc=2*Math.sqrt(this.surface/Math.PI)),this.computed.eqpc}get perimeterInfo(){return this.computed.perimeterInfo||(this.computed.perimeterInfo=getPerimeterInfo(this)),this.computed.perimeterInfo}get perimeter(){let f=this.perimeterInfo,ze=2-Math.sqrt(2);return f.one+f.two*2+f.three*3+f.four*4-ze*(f.two+f.three*2+f.four)}get ped(){return this.computed.ped||(this.computed.ped=this.perimeter/Math.PI),this.computed.ped}get feretMask(){if(!this.computed.feretMask){const f=new Image$1(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});f.paintPolyline(this.feretDiameters.minLine),f.paintPolyline(this.feretDiameters.maxLine),this.computed.feretMask=f}return this.computed.feretMask}get mbrMask(){if(!this.computed.mbrMask){let f=round(this.mbr.rectangle);if(f.length>0){const ze=minMax(f),Ke=new Image$1(ze[1][0]-ze[0][0]+1,ze[1][1]-ze[0][1]+1,{kind:BINARY,position:[this.minX+ze[0][0],this.minY+ze[0][1]],parent:this.map.parent});f=moveToZeroZero(f),Ke.paintPolyline(f,{closed:!0}),this.computed.mbrMask=Ke}else this.computed.mbrMask=new Image$1(1,1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent})}return this.computed.mbrMask}get mbrFilledMask(){if(!this.computed.mbrFilledMask){const f=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),ze=this.mask.minimalBoundingRectangle();for(let Ke=0;Ke<this.width;Ke++)for(let Qe=0;Qe<this.height;Qe++)robustPointInPolygon(ze,[Ke,Qe])!==1&&f.setBitXY(Ke,Qe);this.computed.mbrFilledMask=f}return this.computed.mbrFilledMask}get points(){if(!this.computed.points){let f=[];for(let ze=0;ze<this.height;ze++)for(let Ke=0;Ke<this.width;Ke++){let Qe=(ze+this.minY)*this.map.width+Ke+this.minX;this.map.data[Qe]===this.id&&f.push([Ke,ze])}this.computed.points=f}return this.computed.points}get maxLengthPoints(){if(!this.computed.maxLengthPoints){let f=0,ze;const Ke=this.points;for(let Qe=0;Qe<Ke.length;Qe++)for(let Pi=Qe+1;Pi<Ke.length;Pi++){let nn=Math.pow(Ke[Qe][0]-Ke[Pi][0],2)+Math.pow(Ke[Qe][1]-Ke[Pi][1],2);nn>=f&&(f=nn,ze=[Ke[Qe],Ke[Pi]])}this.computed.maxLengthPoints=ze}return this.computed.maxLengthPoints}get maxLength(){if(!this.computed.maxLength){let f=Math.sqrt(Math.pow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+Math.pow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));this.computed.maxLength=f}return this.computed.maxLength}get roundness(){return 4*this.surface/(Math.PI*this.feretDiameters.max**2)}get sphericity(){return 2*Math.sqrt(this.surface*Math.PI)/this.perimeter}get solidity(){return this.surface/this.convexHull.surface}get angle(){if(!this.computed.angle){let f=this.maxLengthPoints,ze=-Math.atan2(f[0][1]-f[1][1],f[0][0]-f[1][0])*180/Math.PI;this.computed.angle=ze}return this.computed.angle}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,filledSurface:this.filledSurface,surface:this.surface,hullSurface:this.convexHull.surface,hullPerimeter:this.convexHull.perimeter,mbrWidth:this.mbr.width,mbrHeight:this.mbr.height,mbrSurface:this.mbr.surface,eqpc:this.eqpc,ped:this.ped,feretDiameterMin:this.feretDiameters.min,feretDiameterMax:this.feretDiameters.max,aspectRatio:this.feretDiameters.aspectRatio,fillRatio:this.fillRatio,sphericity:this.sphericity,roundness:this.roundness,solidity:this.solidity,perimeter:this.perimeter}}}function getBorders(qe){let f=qe.map,ze=f.data,Ke=new Set,Qe=new Map,Pi=new Set,nn=[1,0,-1,0],ln=[0,1,0,-1];for(let un=qe.minX;un<=qe.maxX;un++)for(let xs=qe.minY;xs<=qe.maxY;xs++){let zn=un+xs*f.width;if(ze[zn]===qe.id)for(let Xn=0;Xn<4;Xn++){let ys=un+nn[Xn],Jo=xs+ln[Xn];if(ys>=0&&Jo>=0&&ys<f.width&&Jo<f.height){let ea=ys+Jo*f.width;if(ze[ea]!==qe.id&&!Pi.has(ea)){Pi.add(ea),Ke.add(ze[ea]);let ra=Qe.get(ze[ea]);ra?Qe.set(ze[ea],++ra):Qe.set(ze[ea],1)}}}}let cn=Array.from(Ke),hn=cn.map(function(un){return Qe.get(un)});return{ids:cn,lengths:hn}}function getBoxIDs(qe){let f=new Set,ze=qe.map,Ke=ze.data;for(let Qe of[0,qe.height-1])for(let Pi=0;Pi<qe.width;Pi++){let nn=(Qe+qe.minY)*ze.width+Pi+qe.minX;if(Pi-qe.minX>0&&Ke[nn]===qe.id&&Ke[nn-1]!==qe.id){let ln=Ke[nn-1];f.add(ln)}if(ze.width-Pi-qe.minX>1&&Ke[nn]===qe.id&&Ke[nn+1]!==qe.id){let ln=Ke[nn+1];f.add(ln)}}for(let Qe of[0,qe.width-1])for(let Pi=0;Pi<qe.height;Pi++){let nn=(Pi+qe.minY)*ze.width+Qe+qe.minX;if(Pi-qe.minY>0&&Ke[nn]===qe.id&&Ke[nn-ze.width]!==qe.id){let ln=Ke[nn-ze.width];f.add(ln)}if(ze.height-Pi-qe.minY>1&&Ke[nn]===qe.id&&Ke[nn+ze.width]!==qe.id){let ln=Ke[nn+ze.width];f.add(ln)}}return Array.from(f)}function getBox(qe){let f=0,ze=qe.map,Ke=ze.data,Qe=[0];qe.height>1&&(Qe[1]=qe.height-1);for(let nn of Qe)for(let ln=1;ln<qe.width-1;ln++){let cn=(nn+qe.minY)*ze.width+ln+qe.minX;Ke[cn]===qe.id&&f++}let Pi=[0];qe.width>1&&(Pi[1]=qe.width-1);for(let nn of Pi)for(let ln=0;ln<qe.height;ln++){let cn=(ln+qe.minY)*ze.width+nn+qe.minX;Ke[cn]===qe.id&&f++}return f}function getBorder(qe){let f=0,ze=qe.map,Ke=ze.data;for(let Qe=1;Qe<qe.width-1;Qe++)for(let Pi=1;Pi<qe.height-1;Pi++){let nn=(Pi+qe.minY)*ze.width+Qe+qe.minX;Ke[nn]===qe.id&&(Ke[nn-1]!==qe.id||Ke[nn+1]!==qe.id||Ke[nn-ze.width]!==qe.id||Ke[nn+ze.width]!==qe.id)&&f++}return f+qe.box}function getPerimeterInfo(qe){let f=qe.map,ze=f.data,Ke=0,Qe=0,Pi=0,nn=0;for(let ln=0;ln<qe.width;ln++)for(let cn=0;cn<qe.height;cn++){let hn=(cn+qe.minY)*f.width+ln+qe.minX;if(ze[hn]===qe.id){let un=0;switch((ln===0||qe.externalIDs.includes(ze[hn-1]))&&un++,(ln===qe.width-1||qe.externalIDs.includes(ze[hn+1]))&&un++,(cn===0||qe.externalIDs.includes(ze[hn-f.width]))&&un++,(cn===qe.height-1||qe.externalIDs.includes(ze[hn+f.width]))&&un++,un){case 1:Ke++;break;case 2:Qe++;break;case 3:Pi++;break;case 4:nn++;break}}}return{one:Ke,two:Qe,three:Pi,four:nn}}function getExternal(qe){let f=0,ze=qe.map,Ke=ze.data;for(let Qe=1;Qe<qe.width-1;Qe++)for(let Pi=1;Pi<qe.height-1;Pi++){let nn=(Pi+qe.minY)*ze.width+Qe+qe.minX;Ke[nn]===qe.id&&(qe.externalIDs.includes(Ke[nn-1])||qe.externalIDs.includes(Ke[nn+1])||qe.externalIDs.includes(Ke[nn-ze.width])||qe.externalIDs.includes(Ke[nn+ze.width]))&&f++}return f+qe.box}function getHolesInfo(qe){let f=0,ze=qe.map.width,Ke=qe.map.data;for(let Qe=1;Qe<qe.width-1;Qe++)for(let Pi=1;Pi<qe.height-1;Pi++){let nn=(Pi+qe.minY)*ze+Qe+qe.minX;qe.internalIDs.includes(Ke[nn])&&Ke[nn]!==qe.id&&f++}return{number:qe.internalIDs.length-1,surface:f}}function getInternalIDs(qe){let f=[qe.id],ze=qe.map,Ke=ze.data;if(qe.height>2)for(let Pi=0;Pi<qe.width;Pi++){let nn=qe.minY*ze.width+Pi+qe.minX;if(f.includes(Ke[nn])){let ln=Ke[nn+ze.width];!f.includes(ln)&&!qe.boxIDs.includes(ln)&&f.push(ln)}}let Qe=new Array(4);for(let Pi=1;Pi<qe.width-1;Pi++)for(let nn=1;nn<qe.height-1;nn++){let ln=(nn+qe.minY)*ze.width+Pi+qe.minX;if(f.includes(Ke[ln])){Qe[0]=Ke[ln-1],Qe[1]=Ke[ln+1],Qe[2]=Ke[ln-ze.width],Qe[3]=Ke[ln+ze.width];for(let cn=0;cn<4;cn++){let hn=Qe[cn];!f.includes(hn)&&!qe.boxIDs.includes(hn)&&f.push(hn)}}}return f}class RoiLayer{constructor(f,ze){this.roiMap=f,this.options=ze,this.roi=this.createRoi()}createRoi(){let f=this.roiMap.data,ze={};this.roiMap.positive=0,this.roiMap.negative=0;for(let ln=0;ln<f.length;ln++)f[ln]&&!ze[f[ln]]&&(ze[f[ln]]=!0,f[ln]>0?this.roiMap.positive++:this.roiMap.negative++);let Ke={};for(let ln in ze)Ke[ln]=new Roi(this.roiMap,ln*1);let Qe=this.roiMap.width,Pi=this.roiMap.height;for(let ln=0;ln<Pi;ln++)for(let cn=0;cn<Qe;cn++){let hn=ln*Qe+cn;if(f[hn]!==0){const un=f[hn],xs=Ke[un];cn<xs.minX&&(xs.minX=cn),cn>xs.maxX&&(xs.maxX=cn),ln<xs.minY&&(xs.minY=ln),ln>xs.maxY&&(xs.maxY=ln),xs.meanX+=cn,xs.meanY+=ln,xs.surface++}}let nn=[];for(let ln in ze)Ke[ln].meanX/=Ke[ln].surface,Ke[ln].meanY/=Ke[ln].surface,nn.push(Ke[ln]);return nn}}function commonBorderLength(qe){let f=qe.data,ze=[1,0,-1,0],Ke=[0,1,0,-1],Qe=qe.minMax,Pi=-Qe.min,nn=Qe.max+Pi,ln=[];for(let hn=0;hn<=nn;hn++)ln.push(Object.create(null));for(let hn=0;hn<qe.width;hn++)for(let un=0;un<qe.height;un++){let xs=hn+un*qe.width,zn=f[xs];if(zn!==0){let Xn=Object.create(null),ys=!1;for(let Jo=0;Jo<4;Jo++){let ea=hn+ze[Jo],ra=un+Ke[Jo];if(ea>=0&&ra>=0&&ea<qe.width&&ra<qe.height){let na=f[ea+ra*qe.width];zn!==na&&(ys=!0,na!==0&&Xn[na]===void 0&&(Xn[na]=!0,ln[na+Pi][zn]?ln[na+Pi][zn]++:ln[na+Pi][zn]=1))}else ys=!0}ys&&(ln[zn+Pi][zn]?ln[zn+Pi][zn]++:ln[zn+Pi][zn]=1)}}let cn={};for(let hn=0;hn<ln.length;hn++)Object.keys(ln[hn]).length>0&&(cn[hn-Pi]=ln[hn]);return cn}function mergeRoi(qe={}){const{algorithm:f="commonBorderLength",minCommonBorderLength:ze=5,maxCommonBorderLength:Ke=100,minCommonBorderRatio:Qe=.3,maxCommonBorderRatio:Pi=1}=qe;let nn=function(ea,ra,na){return ea[na]>=ze&&ea[na]<=Ke};typeof f=="function"&&(nn=f),f.toLowerCase()==="commonborderratio"&&(nn=function(ea,ra,na){let ta=Math.min(ea[na]/ea[ra],1);return ta>=Qe&&ta<=Pi});const ln=this,cn=ln.commonBorderLength;let hn={},un={};for(let ea of Object.keys(cn)){let ra=cn[ea],na=Object.keys(ra);for(let ta of na)if(ta!==ea&&nn(ra,ea,ta)){let ia=ta;un[ta]&&(ia=un[ta]);let sa=ea;if(un[ea]&&(sa=un[ea]),Number(ia)!==sa){let Ma=Math.min(ia,sa),pa=Math.max(ia,sa);if(hn[Ma]||(hn[Ma]={}),hn[Ma][pa]=!0,un[pa]=Ma,hn[pa]){for(let oa of Object.keys(hn[pa]))hn[Ma][oa]=!0,un[oa]=Ma;delete hn[pa]}}}}let xs=ln.minMax,zn=-xs.min,Xn=xs.max+zn,ys=new Array(Xn+1).fill(0);for(let ea of Object.keys(un))ys[Number(ea)+zn]=un[ea];let Jo=ln.data;for(let ea=0;ea<Jo.length;ea++){let ra=Jo[ea];if(ra!==0){let na=ys[ra+zn];na!==0&&(Jo[ea]=na)}}return ln.computed={},ln}class RoiMap{constructor(f,ze){this.parent=f,this.width=f.width,this.height=f.height,this.data=ze,this.negative=0,this.positive=0}get total(){return this.negative+this.positive}get minMax(){let f=Number.MAX_SAFE_INTEGER,ze=Number.MIN_SAFE_INTEGER;for(let Ke=0;Ke<this.data.length;Ke++)this.data[Ke]<f&&(f=this.data[Ke]),this.data[Ke]>ze&&(ze=this.data[Ke]);return{min:f,max:ze}}get commonBorderLength(){return commonBorderLength(this)}mergeRoi(f={}){return mergeRoi.call(this,f)}mergeRois(f){const ze=f[0],Ke=f.slice(1);for(let Qe=0;Qe<this.data.length;Qe++)Ke.includes(this.data[Qe])&&(this.data[Qe]=ze)}rowsInfo(){let f=new Array(this.height),ze=0;for(let Ke=0;Ke<this.data.length;Ke+=this.width){let Qe={row:ze,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};f[ze++]=Qe;let Pi={},nn={},ln=[],cn=this.data[Ke],hn=0;for(let un=Ke;un<Ke+this.width;un++){let xs=this.data[un];cn!==xs&&(cn=xs,ln.push(hn),hn=0),hn++,xs>0?(Qe.positivePixel++,Pi[xs]||(Pi[xs]=!0)):xs<0?(Qe.negativePixel++,nn[xs]||(nn[xs]=!0)):Qe.zeroPixel++}ln.push(hn),Qe.medianChange=ln.sort((un,xs)=>un-xs)[Math.floor(ln.length/2)],Qe.positiveRoiIDs=Object.keys(Pi),Qe.negativeRoiIDs=Object.keys(nn),Qe.positiveRoi=Qe.positiveRoiIDs.length,Qe.negativeRoi=Qe.negativeRoiIDs.length}return f}colsInfo(){let f=new Array(this.width),ze=0;for(let Ke=0;Ke<this.width;Ke++){let Qe={col:ze,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};f[ze++]=Qe;let Pi={},nn={},ln=[],cn=this.data[Ke],hn=0;for(let un=Ke;un<Ke+this.data.length;un+=this.width){let xs=this.data[un];cn!==xs&&(cn=xs,ln.push(hn),hn=0),hn++,xs>0?(Qe.positivePixel++,Pi[xs]||(Pi[xs]=!0)):xs<0?(Qe.negativePixel++,nn[xs]||(nn[xs]=!0)):Qe.zeroPixel++}ln.push(hn),Qe.medianChange=ln.sort((un,xs)=>un-xs)[Math.floor(ln.length/2)],Qe.positiveRoiIDs=Object.keys(Pi),Qe.negativeRoiIDs=Object.keys(nn),Qe.positiveRoi=Qe.positiveRoiIDs.length,Qe.negativeRoi=Qe.negativeRoiIDs.length}return f}}function fromMask(qe,f={}){const{allowCorners:ze=!1}=f,Ke=65535;let Qe=new Int16Array(qe.size),Pi=0,nn=0,ln=new Uint16Array(Ke+1),cn=new Uint16Array(Ke+1);for(let un=0;un<qe.width;un++)for(let xs=0;xs<qe.height;xs++)Qe[xs*qe.width+un]===0&&hn(un,xs);function hn(un,xs){let zn=0,Xn=0,ys=qe.getBitXY(un,xs),Jo=ys?++Pi:--nn;if(Pi>32767||nn<-32768)throw new Error("Too many regions of interest");for(ln[0]=un,cn[0]=xs;zn<=Xn;){let ea=ln[zn&Ke],ra=cn[zn&Ke];if(Qe[ra*qe.width+ea]=Jo,ea>0&&Qe[ra*qe.width+ea-1]===0&&qe.getBitXY(ea-1,ra)===ys&&(Xn++,ln[Xn&Ke]=ea-1,cn[Xn&Ke]=ra,Qe[ra*qe.width+ea-1]=-32768),ra>0&&Qe[(ra-1)*qe.width+ea]===0&&qe.getBitXY(ea,ra-1)===ys&&(Xn++,ln[Xn&Ke]=ea,cn[Xn&Ke]=ra-1,Qe[(ra-1)*qe.width+ea]=-32768),ea<qe.width-1&&Qe[ra*qe.width+ea+1]===0&&qe.getBitXY(ea+1,ra)===ys&&(Xn++,ln[Xn&Ke]=ea+1,cn[Xn&Ke]=ra,Qe[ra*qe.width+ea+1]=-32768),ra<qe.height-1&&Qe[(ra+1)*qe.width+ea]===0&&qe.getBitXY(ea,ra+1)===ys&&(Xn++,ln[Xn&Ke]=ea,cn[Xn&Ke]=ra+1,Qe[(ra+1)*qe.width+ea]=-32768),ze&&(ea>0&&ra>0&&Qe[(ra-1)*qe.width+ea-1]===0&&qe.getBitXY(ea-1,ra-1)===ys&&(Xn++,ln[Xn&Ke]=ea-1,cn[Xn&Ke]=ra-1,Qe[(ra-1)*qe.width+ea-1]=-32768),ea<qe.width-1&&ra>0&&Qe[(ra-1)*qe.width+ea+1]===0&&qe.getBitXY(ea+1,ra-1)===ys&&(Xn++,ln[Xn&Ke]=ea+1,cn[Xn&Ke]=ra-1,Qe[(ra-1)*qe.width+ea+1]=-32768),ea>0&&ra<qe.height-1&&Qe[(ra+1)*qe.width+ea-1]===0&&qe.getBitXY(ea-1,ra+1)===ys&&(Xn++,ln[Xn&Ke]=ea-1,cn[Xn&Ke]=ra+1,Qe[(ra+1)*qe.width+ea-1]=-32768),ea<qe.width-1&&ra<qe.height-1&&Qe[(ra+1)*qe.width+ea+1]===0&&qe.getBitXY(ea+1,ra+1)===ys&&(Xn++,ln[Xn&Ke]=ea+1,cn[Xn&Ke]=ra+1,Qe[(ra+1)*qe.width+ea+1]=-32768)),zn++,Xn-zn>Ke)throw new Error("analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY")}}return new RoiMap(qe,Qe)}var DisjointSet_1,hasRequiredDisjointSet;function requireDisjointSet(){if(hasRequiredDisjointSet)return DisjointSet_1;hasRequiredDisjointSet=1;class qe{constructor(){this.nodes=new Map}add(Ke){var Qe=this.nodes.get(Ke);return Qe||(Qe=new f(Ke),this.nodes.set(Ke,Qe)),Qe}union(Ke,Qe){const Pi=this.find(Ke),nn=this.find(Qe);Pi!==nn&&(Pi.rank<nn.rank?Pi.parent=nn:Pi.rank>nn.rank?nn.parent=Pi:(nn.parent=Pi,Pi.rank++))}find(Ke){for(var Qe=Ke;Qe.parent!==null;)Qe=Qe.parent;for(var Pi=Ke;Pi.parent!==null;){var nn=Pi;Pi=Pi.parent,nn.parent=Qe}return Qe}connected(Ke,Qe){return this.find(Ke)===this.find(Qe)}}DisjointSet_1=qe;function f(ze){this.value=ze,this.parent=null,this.rank=0}return DisjointSet_1}var DisjointSetExports=requireDisjointSet();const DisjointSet=getDefaultExportFromCjs(DisjointSetExports),direction4X=[-1,0],direction4Y=[0,-1],neighbours4=[null,null],direction8X=[-1,-1,0,1],direction8Y=[0,-1,-1,-1],neighbours8=[null,null,null,null];function fromMaskConnectedComponentLabelingAlgorithm(qe,f={}){const{allowCorners:ze=!1}=f;let Ke=4;ze&&(Ke=8);let Qe,Pi,nn;if(Ke===8)Qe=direction8X,Pi=direction8Y,nn=neighbours8;else if(Ke===4)Qe=direction4X,Pi=direction4Y,nn=neighbours4;else throw new RangeError(`unsupported neighbours count: ${Ke}`);const ln=qe.size,cn=qe.width,hn=qe.height,un=new Array(ln),xs=new Uint32Array(ln),zn=new DisjointSet;let Xn=1;for(let ys=0;ys<hn;ys++)for(let Jo=0;Jo<cn;Jo++){const ea=Jo+ys*cn;if(qe.getBit(ea)){let ra=null;for(let na=0;na<nn.length;na++){const ta=Jo+Qe[na],ia=ys+Pi[na];if(ta>=0&&ia>=0&&ta<cn&&ia<hn){const sa=ta+ia*cn;let Ma=un[sa];Ma?(nn[na]=Ma,(!ra||nn[na].value<ra.value)&&(ra=nn[na])):nn[na]=null}}if(!ra)un[ea]=zn.add(Xn++);else{un[ea]=ra;for(let na=0;na<nn.length;na++)nn[na]&&nn[na]!==ra&&zn.union(ra,nn[na])}}}for(let ys=0;ys<hn;ys++)for(let Jo=0;Jo<cn;Jo++){const ea=Jo+ys*cn;qe.getBit(ea)&&(xs[ea]=zn.find(un[ea]).value)}return new RoiMap(qe,xs)}function fromMaxima(qe={}){let{allowCorner:f=!0,onlyTop:ze=!1,invert:Ke=!1}=qe,Qe=this;Qe.checkProcessable("fromMaxima",{components:[1]});const Pi=1,nn=2;let ln=0,cn=0,hn=new Int16Array(Qe.size),un=new Int8Array(Qe.size),xs=new Float32Array(Qe.size),zn=1048575,Xn=new Uint16Array(zn+1),ys=new Uint16Array(zn+1),Jo=0,ea=0,ra=new Uint16Array(zn+1),na=new Uint16Array(zn+1),ta=0,ia=0;for(sa(Qe);Jo<ea;){let oa=Xn[Jo&zn],ha=ys[Jo&zn];pa(oa,ha,nn),Jo++}return new RoiMap(Qe,hn);function sa({maxima:oa=!0}){for(let ha=1;ha<Qe.height-1;ha++)for(let ca=1;ca<Qe.width-1;ca++){let da=ca+ha*Qe.width;if(un[da]===0){let ga=oa?Qe.data[da]:-Qe.data[ca+ha*Qe.width];if(Qe.data[ha*Qe.width+ca-1]>ga||Qe.data[ha*Qe.width+ca+1]>ga||Qe.data[(ha-1)*Qe.width+ca]>ga||Qe.data[(ha+1)*Qe.width+ca]>ga||f&&(Qe.data[(ha-1)*Qe.width+ca-1]>ga||Qe.data[(ha-1)*Qe.width+ca+1]>ga||Qe.data[(ha+1)*Qe.width+ca-1]>ga||Qe.data[(ha+1)*Qe.width+ca+1]>ga))continue;hn[da]=oa?++ln:--cn,Ma(ca,ha)||(oa?--ln:++cn)}}}function Ma(oa,ha){let ca=ea;ta=0,ia=1,ra[0]=oa,na[0]=ha;let da=!0;for(;ta<ia;){let ga=ra[ta&zn],qa=na[ta&zn];da&=pa(ga,qa,Pi),ta++}if(!da){for(let ga=0;ga<ia;ga++){let qa=ra[ga&zn],il=na[ga&zn]*Qe.width+qa;hn[il]=0}ea=ca}return da}function pa(oa,ha,ca){let da=hn[ha*Qe.width+oa],ga=Qe.data[ha*Qe.width+oa];for(let qa=ha-1;qa<=ha+1;qa++)for(let Ka=oa-1;Ka<=oa+1;Ka++){let il=qa*Qe.width+Ka;if(un[il]===0)switch(un[il]=1,xs[il]=Qe.data[il]-ga,ca){case Pi:if(xs[il]===0){if(Ka===0||qa===0||Ka===Qe.width-1||qa===Qe.height-1)return!1;hn[il]=da,ra[ia&zn]=Ka,na[ia&zn]=qa,ia++}else{if(xs[il]>0)return!1;ze||(hn[il]=da,Xn[ea&zn]=Ka,ys[ea&zn]=qa,ea++)}break;case nn:xs[il]<=0&&(hn[il]=da,Xn[ea&zn]=Ka,ys[ea&zn]=qa,ea++);break;default:throw new Error("unreachable")}}return!0}}function fromPoints(qe,f={}){let ze=new Shape(f),Ke=new Int16Array(this.size),Qe=0,Pi=ze.getPoints();for(let nn=0;nn<qe.length;nn++){Qe++;let ln=qe[nn][0],cn=qe[nn][1];for(let hn=0;hn<Pi.length;hn++){let un=Pi[hn][0],xs=Pi[hn][1];ln+un>=0&&cn+xs>=0&&ln+un<this.width&&cn+xs<this.height&&(Ke[ln+un+(cn+xs)*this.width]=Qe)}}return new RoiMap(this,Ke)}function commonjsRequire(qe){throw new Error('Could not dynamically require "'+qe+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var priorityQueue={exports:{}},hasRequiredPriorityQueue;function requirePriorityQueue(){return hasRequiredPriorityQueue||(hasRequiredPriorityQueue=1,function(qe,f){(function(ze){qe.exports=ze()})(function(){return function ze(Ke,Qe,Pi){function nn(hn,un){if(!Qe[hn]){if(!Ke[hn]){var xs=typeof commonjsRequire=="function"&&commonjsRequire;if(!un&&xs)return xs(hn,!0);if(ln)return ln(hn,!0);var zn=new Error("Cannot find module '"+hn+"'");throw zn.code="MODULE_NOT_FOUND",zn}var Xn=Qe[hn]={exports:{}};Ke[hn][0].call(Xn.exports,function(ys){var Jo=Ke[hn][1][ys];return nn(Jo||ys)},Xn,Xn.exports,ze,Ke,Qe,Pi)}return Qe[hn].exports}for(var ln=typeof commonjsRequire=="function"&&commonjsRequire,cn=0;cn<Pi.length;cn++)nn(Pi[cn]);return nn}({1:[function(ze,Ke,Qe){var Pi,nn,ln,cn,hn,un=function(zn,Xn){for(var ys in Xn)xs.call(Xn,ys)&&(zn[ys]=Xn[ys]);function Jo(){this.constructor=zn}return Jo.prototype=Xn.prototype,zn.prototype=new Jo,zn.__super__=Xn.prototype,zn},xs={}.hasOwnProperty;Pi=ze("./PriorityQueue/AbstractPriorityQueue"),nn=ze("./PriorityQueue/ArrayStrategy"),cn=ze("./PriorityQueue/BinaryHeapStrategy"),ln=ze("./PriorityQueue/BHeapStrategy"),hn=function(zn){un(Xn,zn);function Xn(ys){ys||(ys={}),ys.strategy||(ys.strategy=cn),ys.comparator||(ys.comparator=function(Jo,ea){return(Jo||0)-(ea||0)}),Xn.__super__.constructor.call(this,ys)}return Xn}(Pi),hn.ArrayStrategy=nn,hn.BinaryHeapStrategy=cn,hn.BHeapStrategy=ln,Ke.exports=hn},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(ze,Ke,Qe){Ke.exports=function(){function Pi(nn){var ln;if((nn!=null?nn.strategy:void 0)==null)throw"Must pass options.strategy, a strategy";if((nn!=null?nn.comparator:void 0)==null)throw"Must pass options.comparator, a comparator";this.priv=new nn.strategy(nn),this.length=(nn!=null&&(ln=nn.initialValues)!=null?ln.length:void 0)||0}return Pi.prototype.queue=function(nn){this.length++,this.priv.queue(nn)},Pi.prototype.dequeue=function(nn){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},Pi.prototype.peek=function(nn){if(!this.length)throw"Empty queue";return this.priv.peek()},Pi.prototype.clear=function(){return this.length=0,this.priv.clear()},Pi}()},{}],3:[function(ze,Ke,Qe){var Pi;Pi=function(nn,ln,cn){var hn,un,xs;for(un=0,hn=nn.length;un<hn;)xs=un+hn>>>1,cn(nn[xs],ln)>=0?un=xs+1:hn=xs;return un},Ke.exports=function(){function nn(ln){var cn;this.options=ln,this.comparator=this.options.comparator,this.data=((cn=this.options.initialValues)!=null?cn.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return nn.prototype.queue=function(ln){var cn;cn=Pi(this.data,ln,this.comparator),this.data.splice(cn,0,ln)},nn.prototype.dequeue=function(){return this.data.pop()},nn.prototype.peek=function(){return this.data[this.data.length-1]},nn.prototype.clear=function(){this.data.length=0},nn}()},{}],4:[function(ze,Ke,Qe){Ke.exports=function(){function Pi(nn){var ln,cn,hn,un,xs,zn,Xn,ys;for(this.comparator=(nn!=null?nn.comparator:void 0)||function(Jo,ea){return Jo-ea},this.pageSize=(nn!=null?nn.pageSize:void 0)||512,this.length=0,Xn=0;1<<Xn<this.pageSize;)Xn+=1;if(1<<Xn!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=Xn,this._emptyMemoryPageTemplate=ln=[],cn=0,xs=this.pageSize;0<=xs?cn<xs:cn>xs;0<=xs?++cn:--cn)ln.push(null);if(this._memory=[],this._mask=this.pageSize-1,nn.initialValues)for(zn=nn.initialValues,hn=0,un=zn.length;hn<un;hn++)ys=zn[hn],this.queue(ys)}return Pi.prototype.queue=function(nn){this.length+=1,this._write(this.length,nn),this._bubbleUp(this.length,nn)},Pi.prototype.dequeue=function(){var nn,ln;return nn=this._read(1),ln=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,ln),this._bubbleDown(1,ln)),nn},Pi.prototype.peek=function(){return this._read(1)},Pi.prototype.clear=function(){this.length=0,this._memory.length=0},Pi.prototype._write=function(nn,ln){var cn;for(cn=nn>>this._shift;cn>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[cn][nn&this._mask]=ln},Pi.prototype._read=function(nn){return this._memory[nn>>this._shift][nn&this._mask]},Pi.prototype._bubbleUp=function(nn,ln){var cn,hn,un,xs;for(cn=this.comparator;nn>1&&(hn=nn&this._mask,nn<this.pageSize||hn>3?un=nn&~this._mask|hn>>1:hn<2?(un=nn-this.pageSize>>this._shift,un+=un&~(this._mask>>1),un|=this.pageSize>>1):un=nn-2,xs=this._read(un),!(cn(xs,ln)<0));)this._write(un,ln),this._write(nn,xs),nn=un},Pi.prototype._bubbleDown=function(nn,ln){var cn,hn,un,xs,zn;for(zn=this.comparator;nn<this.length;)if(nn>this._mask&&!(nn&this._mask-1)?cn=hn=nn+2:nn&this.pageSize>>1?(cn=(nn&~this._mask)>>1,cn|=nn&this._mask>>1,cn=cn+1<<this._shift,hn=cn+1):(cn=nn+(nn&this._mask),hn=cn+1),cn!==hn&&hn<=this.length)if(un=this._read(cn),xs=this._read(hn),zn(un,ln)<0&&zn(un,xs)<=0)this._write(cn,ln),this._write(nn,un),nn=cn;else if(zn(xs,ln)<0)this._write(hn,ln),this._write(nn,xs),nn=hn;else break;else if(cn<=this.length)if(un=this._read(cn),zn(un,ln)<0)this._write(cn,ln),this._write(nn,un),nn=cn;else break;else break},Pi}()},{}],5:[function(ze,Ke,Qe){Ke.exports=function(){function Pi(nn){var ln;this.comparator=(nn!=null?nn.comparator:void 0)||function(cn,hn){return cn-hn},this.length=0,this.data=((ln=nn.initialValues)!=null?ln.slice(0):void 0)||[],this._heapify()}return Pi.prototype._heapify=function(){var nn,ln,cn;if(this.data.length>0)for(nn=ln=1,cn=this.data.length;1<=cn?ln<cn:ln>cn;nn=1<=cn?++ln:--ln)this._bubbleUp(nn)},Pi.prototype.queue=function(nn){this.data.push(nn),this._bubbleUp(this.data.length-1)},Pi.prototype.dequeue=function(){var nn,ln;return ln=this.data[0],nn=this.data.pop(),this.data.length>0&&(this.data[0]=nn,this._bubbleDown(0)),ln},Pi.prototype.peek=function(){return this.data[0]},Pi.prototype.clear=function(){this.length=0,this.data.length=0},Pi.prototype._bubbleUp=function(nn){for(var ln,cn;nn>0&&(ln=nn-1>>>1,this.comparator(this.data[nn],this.data[ln])<0);)cn=this.data[ln],this.data[ln]=this.data[nn],this.data[nn]=cn,nn=ln},Pi.prototype._bubbleDown=function(nn){var ln,cn,hn,un,xs;for(ln=this.data.length-1;cn=(nn<<1)+1,un=cn+1,hn=nn,cn<=ln&&this.comparator(this.data[cn],this.data[hn])<0&&(hn=cn),un<=ln&&this.comparator(this.data[un],this.data[hn])<0&&(hn=un),hn!==nn;)xs=this.data[hn],this.data[hn]=this.data[nn],this.data[nn]=xs,nn=hn},Pi}()},{}]},{},[1])(1)})}(priorityQueue)),priorityQueue.exports}var priorityQueueExports=requirePriorityQueue();const PriorityQueue=getDefaultExportFromCjs(priorityQueueExports),dxs=[1,0,-1,0,1,1,-1,-1],dys=[0,1,0,-1,1,-1,1,-1];function fromWaterShed(qe={}){let{points:f,mask:ze,image:Ke,fillMaxValue:Qe=this.maxValue,invert:Pi=!1}=qe,nn=Ke||this;nn.checkProcessable("fromWaterShed",{bitDepth:[8,16],components:1}),Pi=!Pi,f||(f=nn.getLocalMaxima({invert:Pi,mask:ze}));let ln=Pi?0:1,cn=new Int16Array(nn.size),hn=nn.width,un=nn.height,xs=new PriorityQueue({comparator:(zn,Xn)=>zn[2]-Xn[2],strategy:PriorityQueue.BinaryHeapStrategy});for(let zn=0;zn<f.length;zn++){let Xn=f[zn][0]+f[zn][1]*hn;cn[Xn]=zn+1;let ys=nn.data[Xn];(Pi&&ys<=Qe||!Pi&&ys>=Qe)&&xs.queue([f[zn][0],f[zn][1],ys])}for(;xs.length>0;){let zn=xs.dequeue(),Xn=zn[0]+zn[1]*hn;for(let ys=0;ys<4;ys++){let Jo=zn[0]+dxs[ys],ea=zn[1]+dys[ys];if(Jo>=0&&ea>=0&&Jo<hn&&ea<un){let ra=Jo+ea*hn;if(!ze||ze.getBit(ra)===ln){let na=nn.data[ra];(Pi&&na<=Qe||!Pi&&na>=Qe)&&cn[ra]===0&&(cn[ra]=cn[Xn],xs.queue([zn[0]+dxs[ys],zn[1]+dys[ys],na]))}}}}return new RoiMap(nn,cn)}class RoiManager{constructor(f,ze={}){this._image=f,this._options=ze,this._options.label||(this._options.label="default"),this._layers={},this._painted=null}fromMaxima(f={}){let ze=Object.assign({},this._options,f),Ke=fromMaxima.call(this._image,f);this._layers[ze.label]=new RoiLayer(Ke,ze)}fromPoints(f,ze={}){let Ke=Object.assign({},this._options,ze),Qe=fromPoints.call(this._image,f,ze);return this._layers[Ke.label]=new RoiLayer(Qe,Ke),this}putMap(f,ze={}){let Ke=new RoiMap(this._image,f),Qe=Object.assign({},this._options,ze);return this._layers[Qe.label]=new RoiLayer(Ke,Qe),this}fromWaterShed(f={}){let ze=Object.assign({},this._options,f),Ke=fromWaterShed.call(this._image,f);this._layers[ze.label]=new RoiLayer(Ke,ze)}fromMask(f,ze={}){let Ke=Object.assign({},this._options,ze),Qe=fromMask.call(this._image,f,ze);return this._layers[Ke.label]=new RoiLayer(Qe,Ke),this}fromMaskConnectedComponentLabelingAlgorithm(f,ze={}){let Ke=Object.assign({},this._options,ze),Qe=fromMaskConnectedComponentLabelingAlgorithm.call(this._image,f,ze);return this._layers[Ke.label]=new RoiLayer(Qe,Ke),this}getMap(f={}){let ze=Object.assign({},this._options,f);return this._assertLayerWithLabel(ze.label),this._layers[ze.label].roiMap}rowsInfo(f={}){return this.getMap(f).rowsInfo()}colsInfo(f={}){return this.getMap(f).rowsInfo()}getRoiIds(f={}){let ze=this.getRois(f);if(ze){let Ke=new Array(ze.length);for(let Qe=0;Qe<ze.length;Qe++)Ke[Qe]=ze[Qe].id;return Ke}throw new Error("ROIs not found")}getRois(f={}){let{label:ze=this._options.label,positive:Ke=!0,negative:Qe=!0,minSurface:Pi=0,maxSurface:nn=Number.POSITIVE_INFINITY,minWidth:ln=0,maxWidth:cn=Number.POSITIVE_INFINITY,minHeight:hn=0,maxHeight:un=Number.POSITIVE_INFINITY,minRatio:xs=0,maxRatio:zn=Number.POSITIVE_INFINITY}=f;if(!this._layers[ze])throw new Error(`this Roi layer (${ze}) does not exist`);const Xn=this._layers[ze].roi,ys=[];for(const Jo of Xn)(Jo.id<0&&Qe||Jo.id>0&&Ke)&&Jo.surface>=Pi&&Jo.surface<=nn&&Jo.width>=ln&&Jo.width<=cn&&Jo.height>=hn&&Jo.height<=un&&Jo.ratio>=xs&&Jo.ratio<=zn&&ys.push(Jo);return ys}getRoi(f,ze={}){const{label:Ke=this._options.label}=ze;if(!this._layers[Ke])throw new Error(`this Roi layer (${Ke}) does not exist`);const Qe=this._layers[Ke].roi.find(Pi=>Pi.id===f);if(!Qe)throw new Error(`found no Roi with id ${f}`);return Qe}getMasks(f={}){let ze=this.getRois(f),Ke=new Array(ze.length);for(let Qe=0;Qe<ze.length;Qe++)Ke[Qe]=ze[Qe].getMask(f);return Ke}getAnalysisMasks(f={}){const{analysisProperty:ze}=f;let Ke=`${ze}Mask`,Qe=this.getRois(f);return Qe.length===0||!Qe[0][Ke]?[]:Qe.map(Pi=>Pi[Ke])}getData(f={}){let ze=Object.assign({},this._options,f);return this._assertLayerWithLabel(ze.label),this._layers[ze.label].roiMap.data}paint(f={}){let{labelProperty:ze,analysisProperty:Ke}=f;this._painted||(this._painted=this._image.rgba8());let Qe=this.getMasks(f);if(ze){const Pi=this.getRois(f);f.labels=Pi.map(hn=>deepValue(hn,ze));const nn=Math.max(...f.labels);let ln=!1,cn=!1;if(ze.includes("surface")?ln=!0:/(?:perimeter|min|max|external|width|height|length)/.test(ze)&&(cn=!0),isFinite(nn)){let hn="";if(f.unit!=="pixel"&&f.pixelSize&&(cn||ln)){hn=ln?`${f.unit}^2`:f.unit;let un=ln?"m^2":"m",xs=ln?f.pixelSize**2:f.pixelSize;const zn=Qty.swiftConverter(un,hn);f.labels=f.labels.map(Xn=>zn(xs*Xn))}nn>50?f.labels=f.labels.map(un=>Math.round(un)+hn):nn>10?f.labels=f.labels.map(un=>un.toFixed(1)+hn):f.labels=f.labels.map(un=>un.toFixed(2)+hn)}f.labelsPosition=Pi.map(hn=>[hn.meanX,hn.meanY])}if(this._painted.paintMasks(Qe,f),Ke){let Pi=this.getAnalysisMasks(f);this._painted.paintMasks(Pi,{color:f.analysisColor,alpha:f.analysisAlpha})}return this._painted}getMask(f={}){let ze=new Image$1(this._image.width,this._image.height,{kind:"BINARY"}),Ke=this.getMasks(f);for(let Qe=0;Qe<Ke.length;Qe++){let Pi=Ke[Qe];for(let nn=0;nn<Pi.width;nn++)for(let ln=0;ln<Pi.height;ln++)Pi.getBitXY(nn,ln)&&ze.setBitXY(nn+Pi.position[0],ln+Pi.position[1])}return ze}resetPainted(f={}){const{image:ze}=f;ze?this._painted=this.image.rgba8():this._painted=this._image.rgba8()}mergeRoi(f={}){const ze=this.getMap(f);return ze.mergeRoi(f),this.putMap(ze.data,f),this}mergeRois(f,ze={}){if(!Array.isArray(f)||f.some(Qe=>!Number.isInteger(Qe)))throw new Error("Roi ids must be an array of integers");if(f.length<2)throw new Error("Roi ids must have at least two elements");if(new Set(f).size!==f.length)throw new Error("Roi ids must be all different");f.forEach(Qe=>this.getRoi(Qe));const Ke=this.getMap(ze);return Ke.mergeRois(f),this.putMap(Ke.data,ze),this}findCorrespondingRoi(f,ze={}){let Ke=this.getRois(ze),Qe=[];for(let Pi=0;Pi<Ke.length;Pi++){let nn=Ke[Pi],ln=nn.minX,cn=nn.minY,hn=nn.points,un=Math.sign(nn.id),xs=correspondingRoisInformation(ln,cn,hn,f,un);Qe.push(xs)}return Qe}_assertLayerWithLabel(f){if(!this._layers[f])throw new Error(`no layer with label ${f}`)}}function correspondingRoisInformation(qe,f,ze,Ke,Qe){let Pi={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0};for(let nn=0;nn<ze.length;nn++){let ln=ze[nn],cn=ln[0],hn=ln[1],un=cn+qe+(hn+f)*Ke.width,xs=Ke.data[un];(xs>0||xs<0)&&(Pi.id.includes(xs)?Pi.surface[Pi.id.indexOf(xs)]+=1:(Pi.id.push(xs),Pi.surface.push(1)))}for(let nn=0;nn<Pi.id.length;nn++)Math.sign(Pi.id[nn])===Qe?Pi.same+=Pi.surface[nn]:Pi.opposite+=Pi.surface[nn],Pi.roiSurfaceCovered[nn]=Pi.surface[nn]/ze.length;return Pi.total=Pi.opposite+Pi.same,Pi}const objectToString=Object.prototype.toString;let Image$1=class Wh{constructor(f,ze,Ke,Qe){if(arguments.length===1?(Qe=f,{width:f,height:ze,data:Ke}=Qe):Ke&&!Ke.length&&(Qe=Ke,{data:Ke}=Qe),f===void 0&&(f=1),ze===void 0&&(ze=1),Qe===void 0&&(Qe={}),typeof Qe!="object"||Qe===null)throw new TypeError("options must be an object");if(!Number.isInteger(f)||f<=0)throw new RangeError("width must be a positive integer");if(!Number.isInteger(ze)||ze<=0)throw new RangeError("height must be a positive integer");const{kind:Pi=RGBA}=Qe;if(typeof Pi!="string")throw new TypeError("kind must be a string");const nn=getKind(Pi),ln=Object.assign({},Qe);for(const Jo in nn)ln[Jo]===void 0&&(ln[Jo]=nn[Jo]);verifyKindDefinition(ln);const{components:cn,bitDepth:hn,colorModel:un}=ln,xs=ln.alpha+0,zn=f*ze,Xn=cn+xs,ys=hn===32?Number.MAX_VALUE:2**hn-1;if(Ke===void 0)Ke=createPixelArray(zn,cn,xs,Xn,hn,ys);else{const Jo=getTheoreticalPixelArraySize(zn,Xn,hn);if(Ke.length!==Jo)throw new RangeError(`incorrect data size: ${Ke.length}. Should be ${Jo}`)}this.width=f,this.height=ze,this.data=Ke,this.size=zn,this.components=cn,this.alpha=xs,this.bitDepth=hn,this.maxValue=ys,this.colorModel=un,this.channels=Xn,this.meta=Qe.meta||{},Object.defineProperty(this,"parent",{enumerable:!1,writable:!0,configurable:!0,value:Qe.parent||null}),this.position=Qe.position||[0,0],this.computed=null,this.sizes=[this.width,this.height],this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=this.bitDepth<32,this.borderSizes=[0,0]}get[Symbol.toStringTag](){return"IJSImage"}static isImage(f){return objectToString.call(f)==="[object IJSImage]"}static fromCanvas(f){const Ke=f.getContext("2d").getImageData(0,0,f.width,f.height);return new Wh(Ke.width,Ke.height,Ke.data)}static createFrom(f,ze){const Ke=getImageParameters(f);return Object.assign(Ke,{parent:f,position:[0,0]},ze),new Wh(Ke)}getRoiManager(f){return new RoiManager(this,f)}clone(){const f=this.data.slice();return new Wh(this.width,this.height,f,this)}apply(f){for(let ze=0;ze<this.height;ze++)for(let Ke=0;Ke<this.width;Ke++){let Qe=(ze*this.width+Ke)*this.channels;f.call(this,Qe)}}};setValueMethods(Image$1);setBitMethods(Image$1);setExportMethods(Image$1);Image$1.prototype.checkProcessable=checkProcessable;Image$1.prototype.getRGBAData=getRGBAData;Image$1.load=load;Image$1.extendMethod=extendMethod;Image$1.extendProperty=extendProperty;extend$1(Image$1);var workerTemplate={},hasRequiredWorkerTemplate;function requireWorkerTemplate(){if(hasRequiredWorkerTemplate)return workerTemplate;hasRequiredWorkerTemplate=1;var qe=function(){self.window=self;function ze(){this._listeners={}}ze.prototype.on=function(Qe,Pi){if(this._listeners[Qe])throw new RangeError("there is already a listener for "+Qe);if(typeof Pi!="function")throw new TypeError("callback argument must be a function");this._listeners[Qe]=Pi},ze.prototype._send=function(Qe,Pi,nn){nn===void 0?nn=[]:Array.isArray(nn)||(nn=[nn]),self.postMessage({id:Qe,data:Pi},nn)},ze.prototype._trigger=function(Qe,Pi){if(!this._listeners[Qe])throw new Error("event "+Qe+" is not defined");this._listeners[Qe].apply(null,Pi)};var Ke=new ze;self.onmessage=function(Qe){switch(Qe.data.action){case"exec":Qe.data.args.unshift(function(Pi,nn){Ke._send(Qe.data.id,Pi,nn)}),Ke._trigger(Qe.data.event,Qe.data.args);break;case"ping":Ke._send(Qe.data.id,"pong");break;default:throw new Error("unexpected action: "+Qe.data.action)}}},f=qe.toString().split('"CODE";');return workerTemplate.newWorkerURL=function(Ke,Qe){var Pi=new Blob(["(",f[0],"importScripts.apply(self, "+JSON.stringify(Qe)+`);
`,"(",Ke,")();",f[1],")();"],{type:"application/javascript"});return URL.createObjectURL(Pi)},workerTemplate}var src,hasRequiredSrc;function requireSrc(){if(hasRequiredSrc)return src;hasRequiredSrc=1;var qe=requireWorkerTemplate(),f=navigator.hardwareConcurrency||1;function ze(Ke,Qe){if(typeof Ke!="string"&&typeof Ke!="function")throw new TypeError("func argument must be a function");if(Qe===void 0&&(Qe={}),typeof Qe!="object"||Qe===null)throw new TypeError("options argument must be an object");this._workerCode=Ke.toString(),Qe.maxWorkers===void 0||Qe.maxWorkers==="auto"?this._numWorkers=Math.min(f-1,1):Qe.maxWorkers>0?this._numWorkers=Math.min(Qe.maxWorkers,f):this._numWorkers=f,this._workers=new Map,this._timeout=Qe.timeout||0,this._terminateOnError=!!Qe.terminateOnError;var Pi=Qe.deps;typeof Pi=="string"&&(Pi=[Pi]),Array.isArray(Pi)||(Pi=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(Pi)}return ze.prototype._init=function(Ke){for(var Qe=qe.newWorkerURL(this._workerCode,Ke),Pi=0;Pi<this._numWorkers;Pi++){var nn=new Worker(Qe);nn.onmessage=this._onmessage.bind(this,nn),nn.onerror=this._onerror.bind(this,nn),nn.running=!1,nn.id=Pi,this._workers.set(nn,null)}URL.revokeObjectURL(Qe)},ze.prototype._onerror=function(Ke,Qe){if(!this._terminated){this._working--,Ke.running=!1;var Pi=this._workers.get(Ke);Pi&&Pi[1](Qe.message),this._workers.set(Ke,null),this._terminateOnError?this.terminate():this._exec()}},ze.prototype._onmessage=function(Ke,Qe){if(!this._terminated){this._working--,Ke.running=!1;var Pi=this._workers.get(Ke);Pi&&Pi[0](Qe.data.data),this._workers.set(Ke,null),this._exec()}},ze.prototype._exec=function(){for(var Ke of this._workers.keys()){if(this._working===this._numWorkers||this._waiting.length===0)return;if(!Ke.running)for(var Qe=0;Qe<this._waiting.length;Qe++){var Pi=this._waiting[Qe];if(!(typeof Pi[4]=="number"&&Pi[4]!==Ke.id)){this._waiting.splice(Qe,1),Ke.postMessage({action:"exec",event:Pi[0],args:Pi[1]},Pi[2]),Ke.running=!0,Ke.time=Date.now(),this._workers.set(Ke,Pi[3]),this._working++;break}}}},ze.prototype.terminate=function(){if(!this._terminated){for(var Ke of this._workers)Ke[0].terminate(),Ke[1]&&Ke[1][1](new Error("Terminated"));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}},ze.prototype.postAll=function(Ke,Qe){if(this._terminated)throw new Error("Cannot post (terminated)");var Pi=[];for(var nn of this._workers.keys())Pi.push(this.post(Ke,Qe,[],nn.id));return Promise.all(Pi)},ze.prototype.post=function(Ke,Qe,Pi,nn){Qe===void 0&&(Qe=[]),Pi===void 0&&(Pi=[]),Array.isArray(Qe)||(Qe=[Qe]),Array.isArray(Pi)||(Pi=[Pi]);var ln=this;return new Promise(function(cn,hn){if(ln._terminated)throw new Error("Cannot post (terminated)");ln._waiting.push([Ke,Qe,Pi,[cn,hn],nn]),ln._exec()})},src=ze,src}var srcExports=requireSrc();const WorkerManager=getDefaultExportFromCjs(srcExports),defaultOptions={regression:{kernelType:"polynomial",kernelOptions:{degree:2,constant:1}},threshold:.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]};function run(qe,f,ze){f=Object.assign({},defaultOptions,f);const Ke=this.manager;return Array.isArray(qe)?Promise.all(qe.map(function(Qe){const Pi=runOnce(Ke,Qe,f);return typeof ze=="function"&&Pi.then(ze),Pi})):runOnce(Ke,qe,f)}function runOnce(qe,f,ze){return qe.post("data",[f,ze]).then(function(Ke){for(let Qe in Ke)Ke[Qe]=new Image$1(Ke[Qe]);return Ke})}function work(){worker.on("data",function(qe,f,ze){f=new IJS(f);const Ke={},Qe=[],Pi=f.grey(),nn=Pi.sobelFilter();Xn("sobel",nn);const ln=nn.level().mask({threshold:ze.threshold});Xn("mask",ln);const cn=nn.getRoiManager();cn.fromMask(ln);const hn=cn.getMask(ze.roi);Xn("realMask",hn);const un=Pi.getPixelsGrid({sampling:ze.sampling,mask:hn}),xs=f.getBackground(un.xyS,un.zS,ze.regression);Xn("background",xs);const zn=f.subtract(xs);Ke.result=zn,Qe.push(zn.data.buffer),qe(Ke,Qe);function Xn(ys,Jo){ze.include.includes(ys)&&(Ke[ys]=Jo,Qe.push(Jo.data.buffer))}})}const background={run,work};function extend(qe){qe.extendMethod("background",background)}let Worker$1=class rc{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(this._url===null)throw new Error("image worker must be initialized with an URL")}get url(){return this._url}set url(f){if(typeof f!="string")throw new TypeError("worker URL must be a string");this._url=f,this._deps[0]=f}static extendMethod(f,ze){let Ke,Qe,Pi={};function nn(...ln){return Ke||(this.checkUrl(),Qe=this.url,Ke=new WorkerManager(ze.work,{deps:Qe}),Pi.manager=Ke),ze.run.call(Pi,...ln)}nn.reset=function(){Ke&&(Ke.terminate(),Ke=new WorkerManager(ze.work,{deps:Qe}),Pi.manager=Ke)},rc.prototype[f]=nn}};extend(Worker$1);/*! @alxcube/lens 2.0.1
© 2020-2023 Alexander Alexandrov <alxcube@gmail.com>
License: Apache-2.0 */class et{constructor(f){if(this.neighborsCount=f,![2,3,4].includes(this.neighborsCount))throw new RangeError(`Neighbors count must be 2, 3 or 4. ${this.neighborsCount} given`)}interpolate(f,ze,Ke){let Qe,Pi;const nn=this.neighborsCount;switch(nn){case 2:Qe=Math.floor(ze),Pi=Math.floor(Ke);break;case 3:Qe=Math.floor(ze+.5)-1,Pi=Math.floor(Ke+.5)-1;break;case 4:Qe=Math.floor(ze)-1,Pi=Math.floor(Ke)-1}const ln=Qe+nn,cn=Pi+nn,hn=[0,0,0,0];for(let xs=Pi;xs<cn;xs++)for(let zn=Qe;zn<ln;zn++){const Xn=f.getPixelColor(zn,xs);hn[0]+=Xn[0],hn[1]+=Xn[1],hn[2]+=Xn[2],hn[3]+=Xn[3]}const un=1/(nn*nn);return[Math.round(hn[0]*un),Math.round(hn[1]*un),Math.round(hn[2]*un),Math.round(hn[3]*un)]}}class At{interpolate(f){return f.getBackgroundColor()}}class Mt{interpolate(f,ze,Ke){return f.getPixelColor(Math.floor(ze),Math.floor(Ke))}}var w=(qe=>(qe[qe.AVERAGE=1]="AVERAGE",qe[qe.AVERAGE_9=2]="AVERAGE_9",qe[qe.AVERAGE_16=3]="AVERAGE_16",qe[qe.BACKGROUND=4]="BACKGROUND",qe[qe.INTEGER=8]="INTEGER",qe))(w||{});class Et{create(f){switch(f){case w.AVERAGE:return new et(2);case w.AVERAGE_9:return new et(3);case w.AVERAGE_16:return new et(4);case w.BACKGROUND:return new At;case w.INTEGER:return new Mt}throw new TypeError(`Unknown interpolation method: ${f}`)}}class Ft{constructor(f,ze){this.colorResamplerFactoriesPool=f,this.resampleFilterResolver=ze}resolve(f,ze,Ke={}){const{preferredResampler:Qe,filter:Pi,matteColor:nn,interpolationMethod:ln,virtualPixelMethod:cn}=Ke,hn=this.getColorResamplerFactory(Qe,Pi);let un;return Pi&&hn.supportsEwa&&(un=this.resampleFilterResolver.resolve(Pi,Ke)),hn.create(f,ze,{resampleFilter:un,matteColor:nn,interpolationMethod:ln,virtualPixelMethod:cn})}getColorResamplerFactory(f,ze){let Ke;if(f!==void 0){const Pi=this.colorResamplerFactoriesPool.get(f);if(Pi.requiresResampleFilter&&!ze)throw new TypeError(`Preferred color resampler "${f}" requires ResampleFilter`);return Pi}if(ze!==void 0&&(Ke=this.colorResamplerFactoriesPool.items().find(Pi=>Pi.supportsEwa),Ke))return Ke;const Qe=this.colorResamplerFactoriesPool.items().filter(Pi=>!Pi.requiresResampleFilter);if(!Qe.length)throw new Error("No color resampler factories in pool.");return Qe[0]}}function Vt(qe){return typeof qe=="object"&&qe!==null&&typeof qe.getResampledColor=="function"&&typeof qe.setScaling=="function"&&typeof qe.getScaling=="function"}class x{constructor(f){this.decorated=f,this.width=this.decorated.width,this.height=this.decorated.height,{x1:this.offsetX,y1:this.offsetY}=this.decorated.getViewport()}getPixelColor(f,ze){return f=Math.floor(f-this.offsetX),ze=Math.floor(ze-this.offsetY),f>=0&&f<this.width&&ze>=0&&ze<this.height?this.decorated.getPixelColor(f,ze):this.getVirtualPixelColor(f,ze)}setPixelColor(f,ze,Ke){f=Math.floor(f-this.offsetX),ze=Math.floor(ze-this.offsetY),f>=0&&f<this.width&&ze>=0&&ze<this.height&&this.decorated.setPixelColor(f,ze,Ke)}getQuantumRange(){return this.decorated.getQuantumRange()}getViewport(){return this.decorated.getViewport()}getAverageColor(){return this.decorated.getAverageColor()}getBackgroundColor(){return this.decorated.getBackgroundColor()}getDecorated(){return this.decorated}}class It extends x{getVirtualPixelColor(){return this.decorated.getBackgroundColor()}}class Q extends x{constructor(f,ze){super(f),this.color=ze}getVirtualPixelColor(){return this.color}}class Tt extends x{getVirtualPixelColor(f,ze){return this.decorated.getPixelColor(Math.max(0,Math.min(this.width-1,f)),Math.max(0,Math.min(this.height-1,ze)))}}class bt extends x{getVirtualPixelColor(f,ze){if(ze<0||ze>=this.height)return this.decorated.getPixelColor(Math.max(0,Math.min(this.width-1,f)),Math.max(0,Math.min(this.height-1,ze)));const Ke=f%this.width,Qe=ze%this.height;return this.decorated.getPixelColor(Ke<0?this.width+Ke:Ke,Qe<0?this.height+Qe:Qe)}}class Bt extends x{getVirtualPixelColor(f,ze){if(ze<0||ze>=this.height)return this.decorated.getBackgroundColor();const Ke=f%this.width,Qe=ze%this.height;return this.decorated.getPixelColor(Ke<0?this.width+Ke:Ke,Qe<0?this.height+Qe:Qe)}}class Lt extends x{getVirtualPixelColor(f,ze){const Ke=2*this.width,Qe=2*this.height,Pi=f%Ke,nn=ze%Qe;let ln=Pi<0?Ke+Pi:Pi,cn=nn<0?Qe+nn:nn;return ln>this.width-1&&(ln=this.width-(ln-this.width)-1),cn>this.height-1&&(cn=this.height-(cn-this.height)-1),this.decorated.getPixelColor(ln,cn)}}class St extends x{getVirtualPixelColor(){return this.decorated.getPixelColor(Math.floor(Math.random()*this.width),Math.floor(Math.random()*this.height))}}class Ot extends x{getVirtualPixelColor(f,ze){const Ke=f%this.width,Qe=ze%this.height;return this.decorated.getPixelColor(Ke<0?this.width+Ke:Ke,Qe<0?this.height+Qe:Qe)}}class Dt extends x{getVirtualPixelColor(f,ze){if(f<0||f>=this.width)return this.decorated.getPixelColor(Math.max(0,Math.min(this.width-1,f)),Math.max(0,Math.min(this.height-1,ze)));const Ke=f%this.width,Qe=ze%this.height;return this.decorated.getPixelColor(Ke<0?this.width+Ke:Ke,Qe<0?this.height+Qe:Qe)}}class kt extends x{getVirtualPixelColor(f,ze){if(f<0||f>=this.width)return this.decorated.getBackgroundColor();const Ke=f%this.width,Qe=ze%this.height;return this.decorated.getPixelColor(Ke<0?this.width+Ke:Ke,Qe<0?this.height+Qe:Qe)}}var p=(qe=>(qe[qe.BACKGROUND=1]="BACKGROUND",qe[qe.EDGE=3]="EDGE",qe[qe.MIRROR=4]="MIRROR",qe[qe.RANDOM=5]="RANDOM",qe[qe.TILE=6]="TILE",qe[qe.TRANSPARENT=7]="TRANSPARENT",qe[qe.BLACK=9]="BLACK",qe[qe.GRAY=10]="GRAY",qe[qe.WHITE=11]="WHITE",qe[qe.HORIZONTAL_TILE=12]="HORIZONTAL_TILE",qe[qe.VERTICAL_TILE=13]="VERTICAL_TILE",qe[qe.HORIZONTAL_TILE_EDGE=14]="HORIZONTAL_TILE_EDGE",qe[qe.VERTICAL_TILE_EDGE=15]="VERTICAL_TILE_EDGE",qe))(p||{});class Nt{decorate(f,ze){switch(ze){case p.BACKGROUND:return new It(f);case p.EDGE:return new Tt(f);case p.MIRROR:return new Lt(f);case p.RANDOM:return new St(f);case p.TILE:return new Ot(f);case p.TRANSPARENT:return new Q(f,[0,0,0,0]);case p.BLACK:return new Q(f,[0,0,0,f.getQuantumRange()]);case p.GRAY:return new Q(f,[Math.floor(f.getQuantumRange()/2),Math.floor(f.getQuantumRange()/2),Math.floor(f.getQuantumRange()/2),f.getQuantumRange()]);case p.WHITE:return new Q(f,[f.getQuantumRange(),f.getQuantumRange(),f.getQuantumRange(),f.getQuantumRange()]);case p.HORIZONTAL_TILE:return new Bt(f);case p.VERTICAL_TILE:return new kt(f);case p.HORIZONTAL_TILE_EDGE:return new bt(f);case p.VERTICAL_TILE_EDGE:return new Dt(f);default:throw new TypeError(`Unknown Virtual Pixel Method "${ze}" given.`)}}}function Gt(qe){return typeof qe=="object"&&qe!==null&&typeof qe.getAverageColor=="function"}function Wt(qe){return typeof qe=="object"&&qe!==null&&typeof qe.getBackgroundColor=="function"}function Ht(qe){return typeof qe=="object"&&qe!==null&&typeof qe.getPixelColor=="function"&&typeof qe.setPixelColor=="function"&&typeof qe.getQuantumRange=="function"}function _t(qe){return typeof Ht(qe)&&typeof qe.width=="number"&&typeof qe.height=="number"}class y{constructor(f,ze,Ke,Qe){this.x1=f,this.y1=ze,this.x2=Ke,this.y2=Qe}static fromLiteral(f){let ze,Ke,Qe,Pi;return"width"in f&&"height"in f?(ze=f.x||0,Ke=f.y||0,Qe=ze+f.width-1,Pi=Ke+f.height-1):(ze=f.x1,Ke=f.y1,Qe=f.x2,Pi=f.y2),new y(ze,Ke,Qe,Pi)}getWidth(){return this.x2-this.x1+1}getHeight(){return this.y2-this.y1+1}getArea(){return this.getWidth()*this.getHeight()}expand(f,ze){return this.x1=Math.min(this.x1,f),this.x2=Math.max(this.x2,f),this.y1=Math.min(this.y1,ze),this.y2=Math.max(this.y2,ze),this}clone(){return new y(this.x1,this.y1,this.x2,this.y2)}fixBounds(){return this.x1=Math.floor(this.x1-.5),this.y1=Math.floor(this.y1-.5),this.x2=Math.ceil(this.x2-.5),this.y2=Math.ceil(this.y2-.5),this}scale(f){const ze=this.getWidth()*f,Ke=this.getHeight()*f;return this.x1=this.x1*f,this.y1=this.y1*f,this.x2=this.x1+ze-1,this.y2=this.y1+Ke-1,this}reset(){const f=this.getWidth(),ze=this.getHeight();return this.x1=0,this.y1=0,this.x2=this.x1+f-1,this.y2=this.y1+ze-1,this}offset(f,ze){return this.x1+=f,this.y1+=ze,this.x2+=f,this.y2+=ze,this}}function j(qe){if(typeof qe!="object"||qe===null)return!1;const f=qe;return"x1"in f&&typeof f.x1=="number"&&"y1"in f&&typeof f.y1=="number"&&"x2"in f&&typeof f.x2=="number"&&"y2"in f&&typeof f.y2=="number"||"width"in f&&typeof f.width=="number"&&"height"in f&&typeof f.height=="number"&&(!("x"in f)||typeof f.x=="number")&&(!("y"in f)||typeof f.y=="number")}function qt(qe){return _t(qe)&&typeof qe.getViewport=="function"}function Ut(qe){return Vt(qe)&&typeof qe.getWeightLookupTable=="function"}const F=Number.EPSILON===void 0?Math.pow(2,-52):Number.EPSILON,Xt=Number.MAX_VALUE,D=Math.PI/2,k=2*Math.PI;function xt(qe,f,ze=.5){const Ke=1-ze,Qe=[0,0,0,0];for(let Pi=0;Pi<4;Pi++)Qe[Pi]=Math.round(qe[Pi]*ze+f[Pi]*Ke);return Qe}function Qt(){const qe={};return qe.promise=new Promise((f,ze)=>{qe.resolve=f,qe.reject=ze}),qe}function ut(qe){return Math.PI*qe/180}function st(qe){const f=qe<0?-1:1;return f*qe>=F?1/qe:f/F}function Yt(qe,f){(function(hn,un){const xs=hn.length;hn.forEach(zn=>{if(zn.length!==xs)throw new TypeError("Matrix must be square")}),un.forEach(zn=>{if(zn.length!==xs)throw new TypeError("Augment matrix vector length must be same as matrix rank")})})(qe,f),qe=gt(qe),f=gt(f);const ze=qe.length,Ke=f.length,Qe=new Array(ze).fill(0),Pi=new Array(ze).fill(0),nn=new Array(ze).fill(0);let ln=0,cn=0;for(let hn=0;hn<ze;hn++){let un=0;for(let zn=0;zn<ze;zn++)if(nn[zn]!==1)for(let Xn=0;Xn<ze;Xn++)nn[Xn]!==0?nn[Xn]>1&&pt():Math.abs(qe[zn][Xn])>=un&&(un=Math.abs(qe[zn][Xn]),cn=zn,ln=Xn);if(nn[ln]++,cn!==ln){for(let zn=0;zn<ze;zn++)rt(qe,cn,zn,ln,zn);for(let zn=0;zn<Ke;zn++)rt(f,zn,cn,zn,ln)}Pi[hn]=cn,Qe[hn]=ln,qe[ln][ln]===0&&pt();const xs=st(qe[ln][ln]);qe[ln][ln]=1;for(let zn=0;zn<ze;zn++)qe[ln][zn]*=xs;for(let zn=0;zn<Ke;zn++)f[zn][ln]*=xs;for(let zn=0;zn<ze;zn++)if(zn!==ln){const Xn=qe[zn][ln];qe[zn][ln]=0;for(let ys=0;ys<ze;ys++)qe[zn][ys]-=Xn*qe[ln][ys];for(let ys=0;ys<Ke;ys++)f[ys][zn]-=Xn*f[ys][ln]}}for(let hn=ze-1;hn>=0;hn--)if(Qe[hn]!==Pi[hn])for(let un=0;un<ze;un++)rt(qe,un,Pi[hn],un,Qe[hn]);return f}function rt(qe,f,ze,Ke,Qe){qe[f][ze]!==qe[Ke][Qe]&&(qe[f][ze]+=qe[Ke][Qe],qe[Ke][Qe]=qe[f][ze]-qe[Ke][Qe],qe[f][ze]-=qe[Ke][Qe])}function gt(qe){return qe.map(f=>f.slice())}function pt(){throw new TypeError("Can't solve given matrix using Gauss-Jordan method")}class ot{constructor(f,ze=1){this.coefficients=[],this.results=[];for(let Ke=0;Ke<f;Ke++)this.coefficients.push(new Array(f).fill(0));for(let Ke=0;Ke<ze;Ke++)this.results.push(new Array(f).fill(0))}addTerms(f,ze){const Ke=this.coefficients.length;for(let Qe=0;Qe<Ke;Qe++){for(let Pi=0;Pi<Ke;Pi++)this.coefficients[Pi][Qe]+=f[Pi]*f[Qe];for(let Pi=0;Pi<this.results.length;Pi++)this.results[Pi][Qe]+=ze[Pi]*f[Qe]}return this}solve(){return Yt(this.coefficients,this.results)}}function O(qe,f,ze=!1){if(ze){const Ke=document.createElement("canvas");return Ke.width=qe,Ke.height=f,Ke}return new OffscreenCanvas(qe,f)}function jt(qe,f=new Image){return new Promise((ze,Ke)=>{const Qe=()=>{f.onload=null,f.onerror=null};f.onload=()=>{Qe(),ze(f)},f.onerror=()=>{Qe(),Ke(new Error(`Couldn't load image "${qe}"`))},f.src=qe})}class $ extends Error{constructor(f){super(f),this.name="LensException",typeof Error.captureStackTrace=="function"?Error.captureStackTrace(this,this.constructor):this.stack=new Error(f).stack}}class $t extends ${constructor(f){super(f),this.name="AbortException"}}class B extends ${constructor(f){super(f),this.name="InvalidArgument"}}class at extends ${constructor(f){super(f),this.name="InvalidArgumentsLength"}}function Kt(qe,f,ze){return[ze[0]*qe+ze[1]*f+ze[2],ze[3]*qe+ze[4]*f+ze[5]]}function dt(qe){const f=st(qe[0]*qe[4]-qe[1]*qe[3]);if(!f)throw new B("Given matrix can't be inverted");return[f*qe[4],f*-qe[1],f*(qe[1]*qe[5]-qe[2]*qe[4]),f*-qe[3],f*qe[0],f*(qe[2]*qe[3]-qe[0]*qe[5])]}class G{constructor(f){this.matrix=f,this.isConstantPartialDerivatives=!0,this.forwardMatrix=dt(f)}static fromForwardMatrix(f){return new G(dt(f))}reverseMap(f,ze){return[this.matrix[0]*f+this.matrix[1]*ze+this.matrix[2],this.matrix[3]*f+this.matrix[4]*ze+this.matrix[5]]}getValidity(){return 1}getPartialDerivatives(){return[this.matrix[0],this.matrix[1],this.matrix[3],this.matrix[4]]}forwardMap(f,ze){return Kt(f,ze,this.forwardMatrix)}getBestFitViewport(f){const ze=f.x1,Ke=f.y1,Qe=f.x2+1,Pi=f.y2+1,[nn,ln]=this.forwardMap(ze,Ke),cn=new y(nn,ln,nn,ln);return[[Qe,Ke],[Qe,Pi],[ze,Pi]].forEach(hn=>cn.expand(...this.forwardMap(...hn))),cn.fixBounds(),cn}}class Zt{create(f){if(!f.length||f.length%4!=0)throw new at(`Number of arguments must be multiple of 4 and at least 4 arguments (1 control point) expected.${f.length} arguments given.`);if(f.length===4)return new G([1,0,f[0]-f[2],0,1,f[1]-f[3]]);{const ze=new ot(3,2);for(let Qe=0;Qe<f.length;Qe+=4){const[Pi,nn,ln,cn]=f.slice(Qe,Qe+4);ze.addTerms([ln,cn,1],[Pi,nn])}f.length===8&&ze.addTerms([f[2]-(f[7]-f[3]),f[3]+(f[6]-f[2]),1],[f[0]-f[5]+f[1],f[1]+f[4]-f[0]]);const Ke=ze.solve();return new G(Ke[0].concat(Ke[1]))}}}class zt{create(f){const[ze,Ke,Qe,Pi,nn,ln]=f;return G.fromForwardMatrix([ze,Qe,nn,Ke,Pi,ln])}}class Jt{constructor(f,ze,Ke,Qe,Pi,nn){this.isConstantPartialDerivatives=!1,this.forceBestFit=!0,this.viewport=f,this.c0=ze,this.c1=Ke,this.c2=Qe,this.c3=Pi,this.c4=nn,this.angleToWidth=k*this.viewport.getWidth()/this.c1,this.radiusToHeight=this.viewport.getHeight()/this.c3,this.viewportWidthX2=2*this.viewport.getWidth()}reverseMap(f,ze){let[Ke,Qe]=this.getUV(f,ze);return Ke=Ke*this.angleToWidth+this.c4+this.viewport.x1+.5,Qe=(this.c2-Qe)*this.radiusToHeight+this.viewport.y1,[Ke,Qe]}getValidity(){return 1}getPartialDerivatives(f,ze){const[,Ke]=this.getUV(f,ze);return Ke>F?[this.angleToWidth/(k*Ke),0,0,this.radiusToHeight]:[this.viewportWidthX2,0,0,this.radiusToHeight]}getBestFitViewport(f){let ze=this.c0-this.c1/2,Ke=Math.cos(ze),Qe=Math.sin(ze),Pi=this.c2*Ke,nn=this.c2*Qe;const ln=new y(Pi,nn,Pi,nn);for(Pi=(this.c2-this.c3)*Ke,nn=(this.c2-this.c3)*Qe,ln.expand(Pi,nn),ze=this.c0+this.c1/2,Ke=Math.cos(ze),Qe=Math.sin(ze),Pi=this.c2*Ke,nn=this.c2*Qe,ln.expand(Pi,nn),Pi=(this.c2-this.c3)*Ke,nn=(this.c2-this.c3)*Qe,ln.expand(Pi,nn),ze=Math.ceil((this.c0-this.c1/2)/D)*D;ze<this.c0+this.c1/2;ze+=D)Ke=Math.cos(ze),Qe=Math.sin(ze),Pi=this.c2*Ke,nn=this.c2*Qe,ln.expand(Pi,nn);return ln.fixBounds(),ln}getUV(f,ze){let Ke=(Math.atan2(ze,f)-this.c0)/k;return Ke-=Math.round(Ke),[Ke,Math.hypot(f,ze)]}}class te{create(f,ze){if(f.length>=1&&f[0]<F)throw new B("Angle too small");if(f.length>=3&&f[2]!==void 0&&f[2]<F)throw new B("Outer radius too small");let Ke,Qe,Pi,nn;Ke=-D,Qe=f.length>=1?ut(f[0]):D,f.length>=2&&f[1]!==void 0&&(Ke+=ut(f[1])),Ke/=k,Ke-=Math.round(Ke),Ke*=k,nn=ze.getHeight()-1,Pi=ze.getWidth()/Qe+nn/2,f.length>=3&&f[2]!==void 0&&f[3]!==void 0&&(f.length>=4?nn=f[2]-f[3]:nn*=f[2]/Pi,Pi=f[2]);const ln=(ze.getWidth()-1)/2;return new Jt(ze,Ke,Qe,Pi,nn,ln)}}function ft(qe){const f=st(qe[0]*qe[4]-qe[3]*qe[1]);if(!f)throw new B("Given matrix can't be inverted");return[f*(qe[4]-qe[7]*qe[5]),f*(qe[7]*qe[2]-qe[1]),f*(qe[1]*qe[5]-qe[4]*qe[2]),f*(qe[6]*qe[5]-qe[3]),f*(qe[0]-qe[6]*qe[2]),f*(qe[3]*qe[2]-qe[0]*qe[5]),f*(qe[3]*qe[7]-qe[6]*qe[4]),f*(qe[6]*qe[1]-qe[0]*qe[7])]}function ee(qe,f,ze){const Ke=ze[0]*qe+ze[1]*f+ze[2],Qe=ze[3]*qe+ze[4]*f+ze[5],Pi=ze[6]*qe+ze[7]*f+1;return[Ke/Pi,Qe/Pi]}class K{constructor(f,ze){this.isConstantPartialDerivatives=!1,this.matrix=f,this.denominator=ze,this.forwardMatrix=ft(f),this.absC6=Math.abs(f[6]),this.absC7=Math.abs(f[7])}static fromForwardMatrix(f){const ze=ft(f),Ke=ze[6]*f[2]+ze[7]*f[5]+1<0?-1:1;return new K(ze,Ke)}reverseMap(f,ze){const Ke=this.matrix[0]*f+this.matrix[1]*ze+this.matrix[2],Qe=this.matrix[3]*f+this.matrix[4]*ze+this.matrix[5],Pi=this.matrix[6]*f+this.matrix[7]*ze+1;return[Ke/Pi,Qe/Pi]}getValidity(f,ze,Ke){const Qe=this.matrix[6]*f+this.matrix[7]*ze+1;let Pi=Qe*this.denominator<0?0:1;const nn=2*Math.abs(Qe);return this.absC6>this.absC7?nn<this.absC6&&(Pi=.5-this.denominator*Qe/(this.matrix[6]*Ke)):nn<this.absC7&&(Pi=.5-this.denominator*Qe/(this.matrix[7]*Ke)),Pi}getPartialDerivatives(f,ze){const Ke=this.matrix[0]*f+this.matrix[1]*ze+this.matrix[2],Qe=this.matrix[3]*f+this.matrix[4]*ze+this.matrix[5],Pi=this.matrix[6]*f+this.matrix[7]*ze+1,nn=Math.pow(1/Pi,2);return[(Pi*this.matrix[0]-Ke*this.matrix[6])*nn,(Pi*this.matrix[1]-Ke*this.matrix[7])*nn,(Pi*this.matrix[3]-Qe*this.matrix[6])*nn,(Pi*this.matrix[4]-Qe*this.matrix[7])*nn]}forwardMap(f,ze){return ee(f,ze,this.forwardMatrix)}getBestFitViewport(f){const ze=f.x1,Ke=f.y1,Qe=f.x2+1,Pi=f.y2+1,[nn,ln]=this.forwardMap(ze,Ke),cn=new y(nn,ln,nn,ln);return[[Qe,Ke],[Qe,Pi],[ze,Pi]].forEach(hn=>cn.expand(...this.forwardMap(...hn))),cn.fixBounds(),cn}}class re{create(f){if(f.length<16||f.length%4!=0)throw new at(`Number of arguments must be multiple of 4 and at least 16 arguments (4 control points) expected. ${f.length} arguments given.`);const ze=new ot(8,1);for(let Pi=0;Pi<f.length;Pi+=4){const[nn,ln,cn,hn]=f.slice(Pi,Pi+4);ze.addTerms([cn,hn,1,0,0,0,-cn*nn,-hn*nn],[nn]).addTerms([0,0,0,cn,hn,1,-cn*ln,-hn*ln],[ln])}const Ke=ze.solve()[0],Qe=Ke[6]*f[2]+Ke[7]*f[3]+1<0?-1:1;return new K(Ke,Qe)}}class ie{create(f){return K.fromForwardMatrix(f)}}class se{constructor(f){this.coeffs=f,this.isConstantPartialDerivatives=!1}reverseMap(f,ze){const Ke=this.coeffs[1];let Qe=0,Pi=0;for(let nn=0;nn<Ke;nn++){const ln=vt(nn,f,ze);Qe+=ln*this.coeffs[2+nn],Pi+=ln*this.coeffs[2+nn+Ke]}return[Qe,Pi]}getValidity(){return 1}getPartialDerivatives(f,ze){const Ke=this.coeffs[1];let Qe=0,Pi=0,nn=0,ln=0;for(let cn=0;cn<Ke;cn++){const hn=yt(cn,f,ze),un=ae(cn,f,ze),xs=2+cn,zn=xs+Ke;Qe=hn*this.coeffs[xs],Pi=un*this.coeffs[xs],nn=hn*this.coeffs[zn],ln=un*this.coeffs[zn]}return[Qe,Pi,nn,ln]}}class oe{create(f){const ze=function(Qe){if(Qe<1||Qe>5||Qe!=Math.floor(Qe)&&Qe-1.5>F)throw new B(`Invalid polynomial order: ${Qe}`);return Math.floor((Qe+1)*(Qe+2)/2)}(f[0]);if(f.length<1+4*ze)throw new at(`Polynomial distortion of order ${f[0]} requires at least ${ze} control point pairs (1 + ${4*ze} arguments)`);const Ke=new ot(ze,2);for(let Qe=1;Qe<f.length;Qe+=4){const Pi=[];for(let nn=0;nn<ze;nn++)Pi[nn]=vt(nn,f[Qe+2],f[Qe+3]);Ke.addTerms(Pi,f.slice(Qe,Qe+2))}return new se([f[0],ze].concat(Ke.solve().flat()))}}function vt(qe,f,ze){switch(qe){case 0:return 1;case 1:return f;case 2:return ze;case 3:return f*ze;case 4:return f*f;case 5:return ze*ze;case 6:return f*f*f;case 7:return f*f*ze;case 8:return f*ze*ze;case 9:return ze*ze*ze;case 10:return f*f*f*f;case 11:return f*f*f*ze;case 12:return f*f*ze*ze;case 13:return f*ze*ze*ze;case 14:return ze*ze*ze*ze;case 15:return f*f*f*f*f;case 16:return f*f*f*f*ze;case 17:return f*f*f*ze*ze;case 18:return f*f*ze*ze*ze;case 19:return f*ze*ze*ze*ze;case 20:return ze*ze*ze*ze*ze}return 0}function yt(qe,f,ze){switch(qe){case 0:case 2:case 5:case 9:case 14:case 20:return 0;case 1:return 1;case 3:return ze;case 4:return f;case 6:return f*f;case 7:return f*ze;case 8:return ze*ze;case 10:return f*f*f;case 11:return f*f*ze;case 12:return f*ze*ze;case 13:return ze*ze*ze;case 15:return f*f*f*f;case 16:return f*f*f*ze;case 17:return f*f*ze*ze;case 18:return f*ze*ze*ze;case 19:return ze*ze*ze*ze}return 0}function ae(qe,f,ze){switch(qe){case 0:case 1:case 4:return 0;case 2:return 1;case 3:return f;case 5:return ze;default:return yt(qe-1,f,ze)}}class ne{constructor(f){this.reversePixelMapperFactoriesPool=f}resolve(f,ze,Ke){return this.reversePixelMapperFactoriesPool.get(f).create(ze,Ke)}}function nt(qe){return typeof qe=="object"&&qe!==null&&typeof qe.reverseMap=="function"&&typeof qe.getValidity=="function"}function mt(qe){return nt(qe)&&typeof qe.getBestFitViewport=="function"}var E=(qe=>(qe.AFFINE="Affine",qe.AFFINE_PROJECTION="AffineProjection",qe.PERSPECTIVE="Perspective",qe.PERSPECTIVE_PROJECTION="PerspectiveProjection",qe.ARC="Arc",qe.POLYNOMIAL="Polynomial",qe))(E||{});function he(qe){return nt(qe)&&typeof qe.getPartialDerivatives=="function"&&typeof qe.isConstantPartialDerivatives=="boolean"}function Y(qe,f){return Math.max(0,Math.min(f,qe))}class le{constructor(f,ze,Ke,Qe,Pi,nn,ln=[0,0,0,0],cn){if(!he(ze))throw new B("Pixel Mapper must implement ReversePixelMapperWithEwaSupport in order to use Elliptical Weighted Average re-sampling.");this.supportSq=Qe*Qe,this.matteColor=ln,this.weightLookupTable=Ke,this.weightLookupTableSize=Ke.length,this.image=f,this.pixelMapper=ze,this.imageViewport=this.image.getViewport(),this.imageArea=this.imageViewport.getArea(),this.imageVirtualPixelMethod=cn,this.imageAverageColor=null,this.A=0,this.B=0,this.C=0,this.F=0,this.uLimit=0,this.vLimit=0,this.uWidth=0,this.slope=0,this.ellipseIsSetUp=!1,this.limitReached=!1,this.scaling=1,this.quantumRange=f.getQuantumRange(),this.averageInterpolator=Pi,this.defaultInterpolator=nn}getWeightLookupTable(){return this.weightLookupTable}getScaling(){return this.scaling}setScaling(f){return this.scaling=f,this}getResampledColor(f,ze){f=(f+.5)*this.scaling,ze=(ze+.5)*this.scaling;const Ke=this.pixelMapper.getValidity(f,ze,this.scaling);if(Ke>0){const[Qe,Pi]=this.pixelMapper.reverseMap(f,ze);if(!this.pixelMapper.isConstantPartialDerivatives||!this.ellipseIsSetUp){const ln=this.pixelMapper.getPartialDerivatives(f,ze);this.setupEllipse(ln[0],ln[1],ln[2],ln[3]),this.ellipseIsSetUp=!0}const nn=this.getWeightedAverage(Qe-.5,Pi-.5);return Ke<1?xt(nn,this.matteColor,Ke):nn}return this.matteColor}setupEllipse(f,ze,Ke,Qe){this.limitReached=!1;const Pi=this.scaling;return this.initEllipse(f*Pi,ze*Pi,Ke*Pi,Qe*Pi).scaleEllipse()}initEllipse(f,ze,Ke,Qe){const[Pi,nn,ln,cn,hn,un]=function(xs,zn,Xn,ys){const Jo=xs*xs+zn*zn,ea=xs*Xn+zn*ys,ra=ea,na=Xn*Xn+ys*ys,ta=xs*ys-zn*Xn,ia=ta+ta,sa=Jo+na,Ma=(sa+ia)*(sa-ia),pa=Math.sqrt(Ma>0?Ma:0),oa=.5*(sa+pa),ha=.5*(sa-pa),ca=oa-Jo,da=oa-na,ga=ca*ca,qa=da*da,Ka=ga>=qa?ea:da,il=ga>=qa?ca:ra,cl=Math.sqrt(Ka*Ka+il*il),wl=cl>0?Ka/cl:1,al=cl>0?il/cl:0,vl=oa<=1?1:Math.sqrt(oa),ml=ha<=1?1:Math.sqrt(ha);return[wl*vl,al*vl,-al*ml,wl*ml,vl,ml]}(f,ze,Ke,Qe);return this.A=nn*nn+cn*cn,this.B=-2*(Pi*nn+ln*cn),this.C=Pi*Pi+ln*ln,this.F=hn*un,this.F*=this.F,this.limitReached=4*this.A*this.C-this.B*this.B>Xt,this}scaleEllipse(){if(!this.limitReached){if(this.F*=this.supportSq,this.uLimit=Math.sqrt(this.C*this.F/(this.A*this.C-.25*this.B*this.B)),this.vLimit=Math.sqrt(this.A*this.F/(this.A*this.C-.25*this.B*this.B)),this.uWidth=Math.sqrt(this.F/this.A),this.slope=-this.B/(2*this.A),this.uWidth*this.vLimit>4*this.imageArea)return this.limitReached=!0,this;const f=this.weightLookupTableSize/this.F;this.A*=f,this.B*=f,this.C*=f}return this}getWeightedAverage(f,ze){if(this.doesntNeedResampling(f,ze))return this.image.getPixelColor(f,ze);if(this.limitReached)switch(this.imageVirtualPixelMethod){case p.EDGE:case p.HORIZONTAL_TILE_EDGE:case p.VERTICAL_TILE_EDGE:return this.averageInterpolator.interpolate(this.image,f,ze);case p.HORIZONTAL_TILE:case p.VERTICAL_TILE:return this.image.getPixelColor(this.imageViewport.x1-1,this.imageViewport.y1-1);default:return this.getImageAverageColor()}let Ke=0,Qe=0,Pi=0,nn=0,ln=0,cn=0;const hn=Math.ceil(ze-this.vLimit),un=Math.floor(ze+this.vLimit);let xs=f+(hn-ze)*this.slope-this.uWidth;const zn=2*this.uWidth+1,Xn=this.A,ys=this.B,Jo=this.image,ea=this.weightLookupTable,ra=2*Xn;for(let na=hn;na<un;na++){const ta=Math.ceil(xs);xs+=this.slope;const ia=ta+zn,sa=ta-f,Ma=na-ze;let pa=(Xn*sa+ys*Ma)*sa+this.C*Ma*Ma,oa=Xn*(2*sa+1)+ys*Ma;for(let ha=ta;ha<ia;ha++){if(pa<this.weightLookupTableSize){let ca=ea[Math.floor(pa)];const[da,ga,qa,Ka]=Jo.getPixelColor(ha,na);cn+=ca*Ka,Ke+=ca,ca*=Ka/this.quantumRange,Pi+=da*ca,nn+=ga*ca,ln+=qa*ca,Qe+=ca}pa+=oa,oa+=ra}}return Qe&&Ke?[Y(Math.round(Pi/Qe),this.quantumRange),Y(Math.round(nn/Qe),this.quantumRange),Y(Math.round(ln/Qe),this.quantumRange),Y(Math.round(cn/Ke),this.quantumRange)]:this.defaultInterpolator.interpolate(this.image,f,ze)}doesntNeedResampling(f,ze){switch(this.imageVirtualPixelMethod){case p.TRANSPARENT:case p.BACKGROUND:case p.BLACK:case p.WHITE:case p.GRAY:return this.limitReached||this.outOfImageBounds(f,ze);case p.EDGE:return f+this.uLimit<this.imageViewport.x1&&ze+this.vLimit<this.imageViewport.y1||f+this.uLimit<this.imageViewport.x1&&ze-this.vLimit>this.imageViewport.y2||f-this.uLimit>this.imageViewport.x2&&ze+this.vLimit<this.imageViewport.y1||f-this.uLimit>this.imageViewport.x2&&ze-this.vLimit>this.imageViewport.y2;case p.HORIZONTAL_TILE:return ze+this.vLimit<this.imageViewport.y1||ze-this.vLimit>this.imageViewport.y2;case p.VERTICAL_TILE:return f+this.uLimit<this.imageViewport.x1||f-this.uLimit>this.imageViewport.x2;default:return!1}}getImageAverageColor(){return this.imageAverageColor===null&&(this.imageAverageColor=this.image.getAverageColor()),this.imageAverageColor}outOfImageBounds(f,ze){return f+this.uLimit<this.imageViewport.x1||f-this.uLimit>this.imageViewport.x2||ze+this.vLimit<this.imageViewport.y1||ze-this.vLimit>this.imageViewport.y2}}class ce{constructor(f){this.colorInterpolatorFactory=f,this.supportsEwa=!0,this.requiresResampleFilter=!0}create(f,ze,Ke={}){const{resampleFilter:Qe,matteColor:Pi=[0,0,0,0],interpolationMethod:nn=w.AVERAGE,virtualPixelMethod:ln=p.TRANSPARENT}=Ke;if(!Qe)throw new TypeError("EWA resampler requires ResampleFilter.");const cn=function(zn){const Xn=[],ys=zn.getWorkingSupport()*Math.sqrt(1/wt);for(let Jo=0;Jo<wt;Jo++)Xn[Jo]=zn.getWeight(Math.sqrt(Jo)*ys);return Xn}(Qe),hn=Qe.getWorkingSupport(),un=this.colorInterpolatorFactory.create(w.AVERAGE),xs=nn===w.AVERAGE?un:this.colorInterpolatorFactory.create(nn);return new le(f,ze,cn,hn,un,xs,Pi,ln)}}const wt=1024;class ue{constructor(f,ze,Ke,Qe=[0,0,0,0]){this.image=f,this.pixelMapper=ze,this.interpolator=Ke,this.matteColor=Qe,this.scaling=1}getScaling(){return this.scaling}setScaling(f){return this.scaling=f,this}getResampledColor(f,ze){f=(f+.5)*this.scaling,ze=(ze+.5)*this.scaling;const Ke=this.pixelMapper.getValidity(f,ze,this.scaling);if(Ke>0){const[Qe,Pi]=this.pixelMapper.reverseMap(f,ze),nn=this.interpolator.interpolate(this.image,Qe-.5,Pi-.5);return Ke<1?xt(nn,this.matteColor,Ke):nn}return this.matteColor}}class ge{constructor(f){this.colorInterpolatorFactory=f,this.supportsEwa=!1,this.requiresResampleFilter=!1}create(f,ze,Ke={}){const{matteColor:Qe=[0,0,0,0],interpolationMethod:Pi=w.AVERAGE}=Ke;return new ue(f,ze,this.colorInterpolatorFactory.create(Pi),Qe)}}class pe{constructor(f){this.parsersPool=f}parse(f,ze=255){for(const Ke of this.parsersPool.items()){const Qe=Ke.parse(f,ze);if(Qe)return Qe}}}class de{parse(f,ze=255){/^#[a-f\d]{3}$/i.test(f)&&(f="#"+f.slice(1).split("").map(Qe=>Qe.repeat(2)).join(""));const Ke=f.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i);if(Ke)return[Math.round(parseInt(Ke[1],16)/255*ze),Math.round(parseInt(Ke[2],16)/255*ze),Math.round(parseInt(Ke[3],16)/255*ze),Ke[4]?Math.round(parseInt(Ke[4],16)/255*ze):ze]}}function Rt(qe){return!!Array.isArray(qe)&&qe.length===4&&qe.every(f=>typeof f=="number")}function Ct(qe){return Array.isArray(qe)&&qe.length===2&&typeof qe[0]=="number"&&typeof qe[1]=="number"}class fe{parse(f,ze=255){if(!/^\s*rgba?/.test(f))return;const Ke=f.replace(/\s/g,"").match(/(\d+(\.\d+)?%?)|(\.\d+%?)/g);if(!Ke||Ke.length<3)return;Ke.length===3&&Ke.push("1");const Qe=Ke.map((Pi,nn)=>{const ln=parseFloat(Pi);return nn===3?Math.round(ln*ze):Pi.indexOf("%")!==-1?Math.round(ln/100*ze):Math.round(ln/255*ze)}).filter(Pi=>!isNaN(Pi));return Rt(Qe)?Qe:void 0}}class me{parse(f){if(f==="transparent")return[0,0,0,0]}}class we{constructor(f,ze){this.asyncTimeout=f,this.abortSignal=ze}async process(f,ze){const Ke=this.createProcessScope(f,ze);return this.doProcess(Ke,this.asyncTimeout),await Ke.deferred.promise,f.commit(),f}createProcessScope(f,ze){const Ke=f.getViewport(),Qe=Math.floor(Ke.x1),Pi=Math.floor(Ke.x2),nn=Math.floor(Ke.y2),ln=Qe,cn=Math.floor(Ke.y1);return{deferred:Qt(),image:f,resampler:ze,startX:Qe,endX:Pi,endY:nn,currentX:ln,currentY:cn}}doProcess(f,ze){if(this.abortSignal&&this.abortSignal.aborted)return void f.deferred.reject(this.abortSignal.reason instanceof Error?this.abortSignal.reason:new $t(String(this.abortSignal.reason)));const Ke=Date.now(),{image:Qe,resampler:Pi,startX:nn,endX:ln,endY:cn}=f;let{currentX:hn,currentY:un}=f;for(;un<=cn;){for(;hn<=ln;)if(Qe.setPixelColor(hn,un,Pi.getResampledColor(hn,un)),hn++,Date.now()-Ke>=ze)return f.currentX=hn,f.currentY=un,void setTimeout(this.doProcess.bind(this,f,ze),0);un++,hn=nn}f.deferred.resolve()}}class xe{constructor(f,ze){this.processor=f,this.superSamplingFactor=ze}async process(f,ze){this.superSamplingFactor!==1&&ze.setScaling(1/this.superSamplingFactor);const Ke=await this.processor.process(f,ze);return this.superSamplingFactor!==1?Ke.scale(1/this.superSamplingFactor):Ke}}class ve{constructor(f,ze){this.width=f,this.height=ze,this.viewport=new y(0,0,this.width-1,this.height-1),this.backgroundColor=[0,0,0,0],this.quantumRange=255}getViewport(){return this.viewport}setViewport(f){return this.viewport=f,this}getBackgroundColor(){return this.backgroundColor}setBackgroundColor(f){return this.backgroundColor=f,this}getQuantumRange(){return this.quantumRange}getBlank(f){const ze=this.prepareBlank(f.getWidth(),f.getHeight());return ze.setViewport(f),this.duplicateProps(ze)}scale(f){const ze=this.viewport.clone();ze.scale(f);const Ke=this.resize(ze.getWidth(),ze.getHeight());return Ke.setViewport(ze),this.duplicateProps(Ke)}duplicateProps(f){return f.setBackgroundColor(this.backgroundColor),f}}class ye{constructor(f){this.factoriesPool=f}resolve(f){const ze=this.factoriesPool.items().find(Qe=>Qe.match(f));if(ze)return ze.create(f);const Ke=Object.prototype.toString.call(f).slice(8,-1);throw new TypeError(`No matching image adapter factory for resource of type ${Ke}`)}}function S(qe){const f=qe.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("Couldn't get canvas context");return f}class N extends ve{constructor(f){super(f.width,f.height),this.canvas=f,this.imageData=S(f).getImageData(0,0,f.width,f.height),this.data=this.imageData.data}static createFromImage(f){const ze=O(f.width,f.height);return S(ze).drawImage(f,0,0),new N(ze)}static async createFromUrl(f){const ze=await jt(f);return this.createFromImage(ze)}static async createFromBlob(f){const ze=await createImageBitmap(f);return this.createFromImage(ze)}getPixelColor(f,ze){const Ke=4*(ze*this.width+f);return[this.data[Ke],this.data[Ke+1],this.data[Ke+2],this.data[Ke+3]]}setPixelColor(f,ze,Ke){const Qe=4*(ze*this.width+f);this.data[Qe]=Ke[0],this.data[Qe+1]=Ke[1],this.data[Qe+2]=Ke[2],this.data[Qe+3]=Ke[3]}getAverageColor(){const f=S(O(1,1));return f.drawImage(this.canvas,0,0,this.width,this.height,0,0,1,1),Array.prototype.slice.call(f.getImageData(0,0,1,1).data)}resize(f,ze){const Ke=O(f,ze,!this.isOffscreen());return S(Ke).drawImage(this.canvas,0,0,this.width,this.height,0,0,f,ze),new N(Ke)}getResource(){return this.canvas}prepareBlank(f,ze){return new N(O(f,ze,!this.isOffscreen()))}commit(){S(this.canvas).putImageData(this.imageData,0,0)}isOffscreen(){return typeof OffscreenCanvas!==void 0&&this.canvas instanceof OffscreenCanvas}}class Re{match(f){return typeof HTMLCanvasElement<"u"&&f instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&f instanceof OffscreenCanvas}create(f){return new N(f)}}function Ce(qe){return qt(qe)&&Gt(qe)&&Wt(qe)&&typeof qe.setViewport=="function"&&typeof qe.setBackgroundColor=="function"&&typeof qe.getBlank=="function"&&typeof qe.scale=="function"&&typeof qe.getResource=="function"&&typeof qe.commit=="function"}class W{constructor(f){this.adapter=f,{x1:this.offsetX,y1:this.offsetY}=f.getViewport(),{width:this.width,height:this.height}=f}getAdapter(){return this.adapter}getPixelColor(f,ze){return this.adapter.getPixelColor(Math.floor(f-this.offsetX),Math.floor(ze-this.offsetY))}setPixelColor(f,ze,Ke){this.adapter.setPixelColor(Math.floor(f-this.offsetX),Math.floor(ze-this.offsetY),Ke)}getViewport(){return this.adapter.getViewport()}setViewport(f){this.adapter.setViewport(f),{x1:this.offsetX,y1:this.offsetY}=f}getBackgroundColor(){return this.adapter.getBackgroundColor()}setBackgroundColor(f){this.adapter.setBackgroundColor(f)}getAverageColor(){return this.adapter.getAverageColor()}getQuantumRange(){return this.adapter.getQuantumRange()}getBlank(f){const ze=this.adapter.getBlank(f);return new W(ze)}scale(f){const ze=this.adapter.scale(f);return new W(ze)}getResource(){return this.adapter.getResource()}commit(){return this.adapter.commit()}}class Pe{constructor(f,ze){this.processor=f,this.repage=ze}async process(f,ze){const Ke=await this.processor.process(f,ze);return Ke.getViewport().reset(),Ct(this.repage)?Ke.getViewport().offset(...this.repage):j(this.repage)&&Ke.setViewport(y.fromLiteral(this.repage)),Ke}}class Ae{create(f={}){const{asyncTimeout:ze=50,outputScaling:Ke=1,repage:Qe=!1,abortSignal:Pi}=f;let nn=new we(ze,Pi);return Ke!==1&&(nn=new xe(nn,Ke)),Qe&&(nn=new Pe(nn,Ct(Qe)||j(Qe)?Qe:void 0)),nn}}class Me{constructor(f,ze){this.outputViewportResolver=f,this.distortionProcessorFactory=ze}async distort(f,ze,Ke,Qe={}){const{viewport:Pi=!1,outputScaling:nn=1,repage:ln,asyncTimeout:cn=50,abortSignal:hn}=Qe,un=this.createTargetImage(f,ze,Pi,nn),xs=new W(un),zn=this.distortionProcessorFactory.create({outputScaling:nn,repage:ln,asyncTimeout:cn,abortSignal:hn}),Xn=await zn.process(xs,Ke);return Xn instanceof W?Xn.getAdapter():Xn}createTargetImage(f,ze,Ke,Qe){const Pi=this.outputViewportResolver.resolve(f,ze,Ke);return Qe!==1&&Pi.scale(Qe),f.getBlank(Pi)}}class Ee{constructor(f,ze,Ke,Qe,Pi,nn){this.reversePixelMapperResolver=f,this.colorResamplerResolver=ze,this.distortionController=Ke,this.imageAdapterResolver=Qe,this.colorStringParser=Pi,this.virtualPixelDecoratorApplicator=nn}async distort(f,ze,Ke,Qe){const[Pi,nn,ln]=this.clarifyArguments(f,ze,Ke,Qe);this.setImageAdapterOptions(Pi,ln);const cn=this.getColorResampler(Pi,nn,ln),hn=Date.now(),un=await this.distortionController.distort(Pi,nn,cn,ln),xs=Date.now();return{image:un,distortion:nn,startTimestamp:hn,endTimestamp:xs,duration:xs-hn,weightLookupTable:Ut(cn)?cn.getWeightLookupTable():void 0}}resolveImageAdapter(f){return Ce(f)?f:this.imageAdapterResolver.resolve(f)}clarifyArguments(f,ze,Ke,Qe){const Pi=this.resolveImageAdapter(f);let nn,ln;if(nt(ze)){if(Array.isArray(Ke))throw new TypeError("Argument 3 should be options object or undefined when passing ReversePixelMapper as second argument");nn=ze,ln=Ke}else{if(!Array.isArray(Ke))throw new TypeError("Missing distortion arguments");nn=this.reversePixelMapperResolver.resolve(ze,Ke,Pi.getViewport()),ln=Qe}return[Pi,nn,ln||{}]}getColorResampler(f,ze,Ke){const{matteColor:Qe,filter:Pi="RobidouxSharp",preferredResampler:nn,virtualPixelMethod:ln=p.TRANSPARENT,interpolationMethod:cn=w.AVERAGE}=Ke,hn=this.resolveColor(Qe,f.getQuantumRange()),un=this.virtualPixelDecoratorApplicator.decorate(f,ln);return this.colorResamplerResolver.resolve(un,ze,{preferredResampler:nn,matteColor:hn,filter:Pi,interpolationMethod:cn,virtualPixelMethod:ln})}setImageAdapterOptions(f,ze){const{imageBackgroundColor:Ke,imageViewportOffset:Qe}=ze;f.setBackgroundColor(this.resolveColor(Ke,f.getQuantumRange())),Qe&&f.getViewport().offset(...Qe)}resolveColor(f,ze,Ke=[0,0,0,0]){return f===void 0?Ke:Rt(f)?f:this.colorStringParser.parse(f,ze)||Ke}}class Fe{constructor(f){this.outputViewportStrategiesPool=f}resolve(f,ze,Ke){const Qe=this.outputViewportStrategiesPool.items();Qe.sort((nn,ln)=>nn.priority-ln.priority);const Pi=Qe.find(nn=>nn.match(ze,Ke));if(!Pi)throw new Error("Couldn't find matching output viewport resolution strategy");return Pi.getOutputViewport(f,ze,Ke)}}class Ve{constructor(){this.priority=2}match(f,ze){return mt(f)&&(f.forceBestFit||ze==="bestFit"||ze===!0)}getOutputViewport(f,ze){if(mt(ze))return ze.getBestFitViewport(f.getViewport());throw new TypeError("Given ReversePixelMapper don't support best-fit output viewport")}}class Ie{constructor(){this.priority=3}getOutputViewport(f){return f.getViewport().clone()}match(){return!0}}class Te{constructor(){this.priority=1}match(f,ze){return j(ze)}getOutputViewport(f,ze,Ke){if(j(Ke))return y.fromLiteral(Ke);throw new TypeError("'viewport argument should be ViewportLiteral")}}class M{constructor(){this.storage=new Map}has(f){return this.storage.has(f)}get(f){const ze=this.storage.get(f);if(ze===void 0)throw new RangeError(`Item with key "${f}" was not found in pool.`);return ze}add(f,ze,Ke=!1){if(this.storage.has(f)&&!Ke)throw new TypeError(`Item with key "${f}" already exists in pool`);this.storage.set(f,ze)}remove(f){this.storage.delete(f)}keys(){return Array.from(this.storage.keys())}items(){return Array.from(this.storage.values())}}class be{constructor(f,ze,Ke,Qe,Pi=1,nn){this.filterFunction=f,this.windowingFunction=ze,this.support=Ke,this.scale=Qe,this.blur=Pi,this.windowSupport=nn!==void 0?nn:this.support}getWorkingSupport(){return this.support*this.blur}getWeight(f){const ze=f/this.blur;return(ze<F?1:this.window(this.scale*ze))*this.filter(ze)}filter(f){return this.filterFunction(f,this.support,this.windowSupport)}window(f){return this.windowingFunction(f,this.support,this.windowSupport)}}class Be{constructor(f){this.weightingFunctionFactoriesPool=f}create(f,ze,Ke,Qe,Pi,nn,ln=1,cn){const hn=this.weightingFunctionFactoriesPool.get(f).create(...ze),un=this.weightingFunctionFactoriesPool.get(Ke).create(...Qe);return new be(hn,un,Pi,nn,ln,cn)}}function Le(qe){return typeof qe=="object"&&qe!==null&&typeof qe.getWorkingSupport=="function"&&typeof qe.getWeight=="function"}function Se(qe){return typeof qe=="object"&&qe!==null&&typeof qe.filterFunctionFactory=="string"&&Array.isArray(qe.filterFunctionFactoryArgs)&&typeof qe.windowFunctionFactory=="string"&&Array.isArray(qe.windowFunctionFactoryArgs)&&typeof qe.support=="number"&&typeof qe.scale=="number"}class Oe{constructor(f,ze){this.filterPresetsPool=f,this.filterFactory=ze}resolve(f,ze={}){if(Le(f))return f;let Ke;Ke=Se(f)?f:this.filterPresetsPool.get(f);const{blur:Qe=1,windowSupport:Pi}=Ke,{filterBlur:nn=Qe,filterWindowSupport:ln=Pi}=ze;return this.filterFactory.create(Ke.filterFunctionFactory,Ke.filterFunctionFactoryArgs,Ke.windowFunctionFactory,Ke.windowFunctionFactoryArgs,Ke.support,Ke.scale,nn,ln)}}var De=(qe=>(qe.ROBIDOUX="Robidoux",qe.ROBIDOUX_SHARP="RobidouxSharp",qe.BOX="Box",qe))(De||{});class ht{constructor(){this.parent=null,this.services=new Map,this.backups=[]}register(f,ze){this.services.set(f,ze)}unregister(f){this.services.delete(f)}resolve(f){const ze=this.services.get(f);if(ze===void 0){if(this.parent)return this.parent.resolve(f);throw new RangeError(`Service "${f}" was not found in container.`)}return typeof ze=="function"?ze(this):ze}backup(){const f=new Map(this.services);this.backups.push(f)}restore(){const f=this.backups.pop();f&&(this.services.clear(),this.services=f)}createChild(){const f=new ht;return f.parent=this,f}}class ke{create(){return function(){return 1}}}class Ne{create(f,ze){const Ke=(6-2*f)/6,Qe=(12*f-18+6*ze)/6,Pi=(12-9*f-6*ze)/6,nn=(8*f+24*ze)/6,ln=(-12*f-48*ze)/6,cn=(6*f+30*ze)/6,hn=(-1*f-6*ze)/6;return function(un){if(typeof un=="number"){if(un<1)return Ke+un*(un*(Qe+un*Pi));if(un<2)return nn+un*(ln+un*(cn+un*hn))}return 0}}}var it=(qe=>(qe.BOX="Box",qe.CUBIC_BC="CubicBC",qe))(it||{});const Pt=function(qe=[]){const f=new ht;return qe.forEach(ze=>ze.register(f)),f}([{register(qe){let f=!1;qe.register("ColorResamplerResolver",ze=>{if(!f){const Ke=ze.resolve("ColorInterpolatorFactory"),Qe=new M;Qe.add("ewa",new ce(Ke)),Qe.add("point",new ge(Ke)),ze.register("ColorResamplerFactoriesPool",Qe),f=!0}return new Ft(ze.resolve("ColorResamplerFactoriesPool"),ze.resolve("ResampleFilterResolver"))})}},{register(qe){const f=new M;f.add("transparent",new me),f.add("hex",new de),f.add("rgba",new fe),qe.register("ColorStringParsersPool",f),qe.register("ColorStringParser",ze=>new pe(ze.resolve("ColorStringParsersPool")))}},{register(qe){qe.register("DistortionProcessorFactory",()=>new Ae),qe.register("DistortionController",f=>new Me(f.resolve("OutputViewportResolver"),f.resolve("DistortionProcessorFactory"))),qe.register("DistortionService",f=>new Ee(f.resolve("ReversePixelMapperResolver"),f.resolve("ColorResamplerResolver"),f.resolve("DistortionController"),f.resolve("ImageAdapterResolver"),f.resolve("ColorStringParser"),f.resolve("VirtualPixelDecoratorApplicator")))}},{register(qe){const f=new M;f.add("BrowserCanvas",new Re),qe.register("ImageAdapterFactoriesPool",f),qe.register("ImageAdapterResolver",ze=>new ye(ze.resolve("ImageAdapterFactoriesPool")))}},{register(qe){const f=new M;f.add("user-provided",new Te),f.add("best-fit",new Ve),f.add("source-image",new Ie),qe.register("OutputViewportStrategiesPool",f),qe.register("OutputViewportResolver",ze=>new Fe(ze.resolve("OutputViewportStrategiesPool")))}},{register(qe){const f=new M;f.add(E.ARC,new te),f.add(E.AFFINE,new Zt),f.add(E.AFFINE_PROJECTION,new zt),f.add(E.PERSPECTIVE,new re),f.add(E.PERSPECTIVE_PROJECTION,new ie),f.add(E.POLYNOMIAL,new oe),qe.register("ReversePixelMapperFactoriesPool",f),qe.register("ReversePixelMapperResolver",ze=>new ne(ze.resolve("ReversePixelMapperFactoriesPool")))}},{register(qe){const f=new M;f.add("Robidoux",{filterFunctionFactory:"CubicBC",filterFunctionFactoryArgs:[.3782157550939987,.3108921224530007],windowFunctionFactory:"Box",windowFunctionFactoryArgs:[],support:2,scale:1.1685777620836932}),f.add("RobidouxSharp",{filterFunctionFactory:"CubicBC",filterFunctionFactoryArgs:[.2620145123990142,.3689927438004929],windowFunctionFactory:"Box",windowFunctionFactoryArgs:[],support:2,scale:1.105822933719019}),f.add("Box",{filterFunctionFactory:"Box",filterFunctionFactoryArgs:[],windowFunctionFactory:"Box",windowFunctionFactoryArgs:[],support:.5,scale:.5}),qe.register("ResampleFilterPresetsPool",f),qe.register("ResampleFilterFactory",ze=>new Be(ze.resolve("WeightingFunctionFactoriesPool"))),qe.register("ResampleFilterResolver",ze=>new Oe(ze.resolve("ResampleFilterPresetsPool"),ze.resolve("ResampleFilterFactory")))}},{register(qe){const f=new M;f.add(it.BOX,new ke),f.add(it.CUBIC_BC,new Ne),qe.register("WeightingFunctionFactoriesPool",f)}},{register(qe){qe.register("ColorInterpolatorFactory",new Et)}},{register(qe){qe.register("VirtualPixelDecoratorApplicator",new Nt)}}]);function He(qe,f,ze,Ke){return Pt.resolve("DistortionService").distort(qe,f,ze,Ke)}const minkowskiDistance=(qe,f,ze=2)=>{const Ke=Math.min(qe.length,f.length);let Qe=0;for(let Pi=0;Pi<Ke;Pi++)Qe+=Math.pow(Math.abs(qe[Pi]-f[Pi]),ze);return Math.pow(Qe,1/ze)},limitDimensions=(qe,f,ze)=>{if(qe>ze||f>ze){const Ke=ze/f,Qe=ze/qe;let Pi,nn;return Ke>Qe?(Pi=ze,nn=f*Qe):(Pi=qe*Ke,nn=ze),{x:Pi,y:nn}}return{x:qe,y:f}},makeVAvatarProps=propsFactory({start:Boolean,end:Boolean,icon:IconValue,image:String,text:String,...makeBorderProps(),...makeComponentProps(),...makeDensityProps(),...makeRoundedProps(),...makeSizeProps(),...makeTagProps(),...makeThemeProps(),...makeVariantProps({variant:"flat"})},"VAvatar"),VAvatar=genericComponent()({name:"VAvatar",props:makeVAvatarProps(),setup(qe,f){let{slots:ze}=f;const{themeClasses:Ke}=provideTheme(qe),{borderClasses:Qe}=useBorder(qe),{colorClasses:Pi,colorStyles:nn,variantClasses:ln}=useVariant(qe),{densityClasses:cn}=useDensity(qe),{roundedClasses:hn}=useRounded(qe),{sizeClasses:un,sizeStyles:xs}=useSize(qe);return useRender(()=>createVNode(qe.tag,{class:["v-avatar",{"v-avatar--start":qe.start,"v-avatar--end":qe.end},Ke.value,Qe.value,Pi.value,cn.value,hn.value,un.value,ln.value,qe.class],style:[nn.value,xs.value,qe.style]},{default:()=>[ze.default?createVNode(VDefaultsProvider,{key:"content-defaults",defaults:{VImg:{cover:!0,src:qe.image},VIcon:{icon:qe.icon}}},{default:()=>[ze.default()]}):qe.image?createVNode(VImg,{key:"image",src:qe.image,alt:"",cover:!0},null):qe.icon?createVNode(VIcon,{key:"icon",icon:qe.icon},null):qe.text,genOverlays(!1,"v-avatar")]})),{}}});function calculateUpdatedTarget(qe){let{selectedElement:f,containerElement:ze,isRtl:Ke,isHorizontal:Qe}=qe;const Pi=getOffsetSize(Qe,ze),nn=getScrollPosition(Qe,Ke,ze),ln=getOffsetSize(Qe,f),cn=getOffsetPosition(Qe,f),hn=ln*.4;return nn>cn?cn-hn:nn+Pi<cn+ln?cn-Pi+ln+hn:nn}function calculateCenteredTarget(qe){let{selectedElement:f,containerElement:ze,isHorizontal:Ke}=qe;const Qe=getOffsetSize(Ke,ze),Pi=getOffsetPosition(Ke,f),nn=getOffsetSize(Ke,f);return Pi-Qe/2+nn/2}function getScrollSize(qe,f){const ze=qe?"scrollWidth":"scrollHeight";return(f==null?void 0:f[ze])||0}function getClientSize(qe,f){const ze=qe?"clientWidth":"clientHeight";return(f==null?void 0:f[ze])||0}function getScrollPosition(qe,f,ze){if(!ze)return 0;const{scrollLeft:Ke,offsetWidth:Qe,scrollWidth:Pi}=ze;return qe?f?Pi-Qe+Ke:Ke:ze.scrollTop}function getOffsetSize(qe,f){const ze=qe?"offsetWidth":"offsetHeight";return(f==null?void 0:f[ze])||0}function getOffsetPosition(qe,f){const ze=qe?"offsetLeft":"offsetTop";return(f==null?void 0:f[ze])||0}const VSlideGroupSymbol=Symbol.for("vuetify:v-slide-group"),makeVSlideGroupProps=propsFactory({centerActive:Boolean,direction:{type:String,default:"horizontal"},symbol:{type:null,default:VSlideGroupSymbol},nextIcon:{type:IconValue,default:"$next"},prevIcon:{type:IconValue,default:"$prev"},showArrows:{type:[Boolean,String],validator:qe=>typeof qe=="boolean"||["always","desktop","mobile"].includes(qe)},...makeComponentProps(),...makeDisplayProps({mobile:null}),...makeTagProps(),...makeGroupProps({selectedClass:"v-slide-group-item--active"})},"VSlideGroup"),VSlideGroup=genericComponent()({name:"VSlideGroup",props:makeVSlideGroupProps(),emits:{"update:modelValue":qe=>!0},setup(qe,f){let{slots:ze}=f;const{isRtl:Ke}=useRtl(),{displayClasses:Qe,mobile:Pi}=useDisplay(qe),nn=useGroup(qe,qe.symbol),ln=shallowRef(!1),cn=shallowRef(0),hn=shallowRef(0),un=shallowRef(0),xs=computed(()=>qe.direction==="horizontal"),{resizeRef:zn,contentRect:Xn}=useResizeObserver(),{resizeRef:ys,contentRect:Jo}=useResizeObserver(),ea=useGoTo(),ra=computed(()=>({container:zn.el,duration:200,easing:"easeOutQuart"})),na=computed(()=>nn.selected.value.length?nn.items.value.findIndex(ol=>ol.id===nn.selected.value[0]):-1),ta=computed(()=>nn.selected.value.length?nn.items.value.findIndex(ol=>ol.id===nn.selected.value[nn.selected.value.length-1]):-1);if(IN_BROWSER){let ol=-1;watch(()=>[nn.selected.value,Xn.value,Jo.value,xs.value],()=>{cancelAnimationFrame(ol),ol=requestAnimationFrame(()=>{if(Xn.value&&Jo.value){const el=xs.value?"width":"height";hn.value=Xn.value[el],un.value=Jo.value[el],ln.value=hn.value+1<un.value}if(na.value>=0&&ys.el){const el=ys.el.children[ta.value];sa(el,qe.centerActive)}})})}const ia=shallowRef(!1);function sa(ol,el){let dl=0;el?dl=calculateCenteredTarget({containerElement:zn.el,isHorizontal:xs.value,selectedElement:ol}):dl=calculateUpdatedTarget({containerElement:zn.el,isHorizontal:xs.value,isRtl:Ke.value,selectedElement:ol}),Ma(dl)}function Ma(ol){if(!IN_BROWSER||!zn.el)return;const el=getOffsetSize(xs.value,zn.el),dl=getScrollPosition(xs.value,Ke.value,zn.el);if(!(getScrollSize(xs.value,zn.el)<=el||Math.abs(ol-dl)<16)){if(xs.value&&Ke.value&&zn.el){const{scrollWidth:Ja,offsetWidth:yl}=zn.el;ol=Ja-yl-ol}xs.value?ea.horizontal(ol,ra.value):ea(ol,ra.value)}}function pa(ol){const{scrollTop:el,scrollLeft:dl}=ol.target;cn.value=xs.value?dl:el}function oa(ol){if(ia.value=!0,!(!ln.value||!ys.el)){for(const el of ol.composedPath())for(const dl of ys.el.children)if(dl===el){sa(dl);return}}}function ha(ol){ia.value=!1}let ca=!1;function da(ol){var el;!ca&&!ia.value&&!(ol.relatedTarget&&((el=ys.el)!=null&&el.contains(ol.relatedTarget)))&&il(),ca=!1}function ga(){ca=!0}function qa(ol){if(!ys.el)return;function el(dl){ol.preventDefault(),il(dl)}xs.value?ol.key==="ArrowRight"?el(Ke.value?"prev":"next"):ol.key==="ArrowLeft"&&el(Ke.value?"next":"prev"):ol.key==="ArrowDown"?el("next"):ol.key==="ArrowUp"&&el("prev"),ol.key==="Home"?el("first"):ol.key==="End"&&el("last")}function Ka(ol,el){if(!ol)return;let dl=ol;do dl=dl==null?void 0:dl[el==="next"?"nextElementSibling":"previousElementSibling"];while(dl!=null&&dl.hasAttribute("disabled"));return dl}function il(ol){if(!ys.el)return;let el;if(!ol)el=focusableChildren(ys.el)[0];else if(ol==="next"){if(el=Ka(ys.el.querySelector(":focus"),ol),!el)return il("first")}else if(ol==="prev"){if(el=Ka(ys.el.querySelector(":focus"),ol),!el)return il("last")}else ol==="first"?(el=ys.el.firstElementChild,el!=null&&el.hasAttribute("disabled")&&(el=Ka(el,"next"))):ol==="last"&&(el=ys.el.lastElementChild,el!=null&&el.hasAttribute("disabled")&&(el=Ka(el,"prev")));el&&el.focus({preventScroll:!0})}function cl(ol){const el=xs.value&&Ke.value?-1:1,dl=(ol==="prev"?-el:el)*hn.value;let xl=cn.value+dl;if(xs.value&&Ke.value&&zn.el){const{scrollWidth:Ja,offsetWidth:yl}=zn.el;xl+=Ja-yl}Ma(xl)}const wl=computed(()=>({next:nn.next,prev:nn.prev,select:nn.select,isSelected:nn.isSelected})),al=computed(()=>{switch(qe.showArrows){case"always":return!0;case"desktop":return!Pi.value;case!0:return ln.value||Math.abs(cn.value)>0;case"mobile":return Pi.value||ln.value||Math.abs(cn.value)>0;default:return!Pi.value&&(ln.value||Math.abs(cn.value)>0)}}),vl=computed(()=>Math.abs(cn.value)>1),ml=computed(()=>{if(!zn.value)return!1;const ol=getScrollSize(xs.value,zn.el),el=getClientSize(xs.value,zn.el);return ol-el-Math.abs(cn.value)>1});return useRender(()=>createVNode(qe.tag,{class:["v-slide-group",{"v-slide-group--vertical":!xs.value,"v-slide-group--has-affixes":al.value,"v-slide-group--is-overflowing":ln.value},Qe.value,qe.class],style:qe.style,tabindex:ia.value||nn.selected.value.length?-1:0,onFocus:da},{default:()=>{var ol,el,dl;return[al.value&&createVNode("div",{key:"prev",class:["v-slide-group__prev",{"v-slide-group__prev--disabled":!vl.value}],onMousedown:ga,onClick:()=>vl.value&&cl("prev")},[((ol=ze.prev)==null?void 0:ol.call(ze,wl.value))??createVNode(VFadeTransition,null,{default:()=>[createVNode(VIcon,{icon:Ke.value?qe.nextIcon:qe.prevIcon},null)]})]),createVNode("div",{key:"container",ref:zn,class:"v-slide-group__container",onScroll:pa},[createVNode("div",{ref:ys,class:"v-slide-group__content",onFocusin:oa,onFocusout:ha,onKeydown:qa},[(el=ze.default)==null?void 0:el.call(ze,wl.value)])]),al.value&&createVNode("div",{key:"next",class:["v-slide-group__next",{"v-slide-group__next--disabled":!ml.value}],onMousedown:ga,onClick:()=>ml.value&&cl("next")},[((dl=ze.next)==null?void 0:dl.call(ze,wl.value))??createVNode(VFadeTransition,null,{default:()=>[createVNode(VIcon,{icon:Ke.value?qe.prevIcon:qe.nextIcon},null)]})])]}})),{selected:nn.selected,scrollTo:cl,scrollOffset:cn,focus:il,hasPrev:vl,hasNext:ml}}}),VChipGroupSymbol=Symbol.for("vuetify:v-chip-group"),makeVChipGroupProps=propsFactory({baseColor:String,column:Boolean,filter:Boolean,valueComparator:{type:Function,default:deepEqual},...makeVSlideGroupProps(),...makeComponentProps(),...makeGroupProps({selectedClass:"v-chip--selected"}),...makeTagProps(),...makeThemeProps(),...makeVariantProps({variant:"tonal"})},"VChipGroup");genericComponent()({name:"VChipGroup",props:makeVChipGroupProps(),emits:{"update:modelValue":qe=>!0},setup(qe,f){let{slots:ze}=f;const{themeClasses:Ke}=provideTheme(qe),{isSelected:Qe,select:Pi,next:nn,prev:ln,selected:cn}=useGroup(qe,VChipGroupSymbol);return provideDefaults({VChip:{baseColor:toRef(()=>qe.baseColor),color:toRef(()=>qe.color),disabled:toRef(()=>qe.disabled),filter:toRef(()=>qe.filter),variant:toRef(()=>qe.variant)}}),useRender(()=>{const hn=VSlideGroup.filterProps(qe);return createVNode(VSlideGroup,mergeProps(hn,{class:["v-chip-group",{"v-chip-group--column":qe.column},Ke.value,qe.class],style:qe.style}),{default:()=>{var un;return[(un=ze.default)==null?void 0:un.call(ze,{isSelected:Qe,select:Pi,next:nn,prev:ln,selected:cn.value})]}})}),{}}});const makeVChipProps=propsFactory({activeClass:String,appendAvatar:String,appendIcon:IconValue,baseColor:String,closable:Boolean,closeIcon:{type:IconValue,default:"$delete"},closeLabel:{type:String,default:"$vuetify.close"},draggable:Boolean,filter:Boolean,filterIcon:{type:IconValue,default:"$complete"},label:Boolean,link:{type:Boolean,default:void 0},pill:Boolean,prependAvatar:String,prependIcon:IconValue,ripple:{type:[Boolean,Object],default:!0},text:{type:[String,Number,Boolean],default:void 0},modelValue:{type:Boolean,default:!0},onClick:EventProp(),onClickOnce:EventProp(),...makeBorderProps(),...makeComponentProps(),...makeDensityProps(),...makeElevationProps(),...makeGroupItemProps(),...makeRoundedProps(),...makeRouterProps(),...makeSizeProps(),...makeTagProps({tag:"span"}),...makeThemeProps(),...makeVariantProps({variant:"tonal"})},"VChip"),VChip=genericComponent()({name:"VChip",directives:{Ripple},props:makeVChipProps(),emits:{"click:close":qe=>!0,"update:modelValue":qe=>!0,"group:selected":qe=>!0,click:qe=>!0},setup(qe,f){let{attrs:ze,emit:Ke,slots:Qe}=f;const{t:Pi}=useLocale(),{borderClasses:nn}=useBorder(qe),{densityClasses:ln}=useDensity(qe),{elevationClasses:cn}=useElevation(qe),{roundedClasses:hn}=useRounded(qe),{sizeClasses:un}=useSize(qe),{themeClasses:xs}=provideTheme(qe),zn=useProxiedModel(qe,"modelValue"),Xn=useGroupItem(qe,VChipGroupSymbol,!1),ys=useLink(qe,ze),Jo=toRef(()=>qe.link!==!1&&ys.isLink.value),ea=computed(()=>!qe.disabled&&qe.link!==!1&&(!!Xn||qe.link||ys.isClickable.value)),ra=toRef(()=>({"aria-label":Pi(qe.closeLabel),onClick(pa){pa.preventDefault(),pa.stopPropagation(),zn.value=!1,Ke("click:close",pa)}})),{colorClasses:na,colorStyles:ta,variantClasses:ia}=useVariant(()=>({color:!Xn||Xn.isSelected.value?qe.color??qe.baseColor:qe.baseColor,variant:qe.variant}));function sa(pa){var oa;Ke("click",pa),ea.value&&((oa=ys.navigate)==null||oa.call(ys,pa),Xn==null||Xn.toggle())}function Ma(pa){(pa.key==="Enter"||pa.key===" ")&&(pa.preventDefault(),sa(pa))}return()=>{var Ka;const pa=ys.isLink.value?"a":qe.tag,oa=!!(qe.appendIcon||qe.appendAvatar),ha=!!(oa||Qe.append),ca=!!(Qe.close||qe.closable),da=!!(Qe.filter||qe.filter)&&Xn,ga=!!(qe.prependIcon||qe.prependAvatar),qa=!!(ga||Qe.prepend);return zn.value&&withDirectives(createVNode(pa,mergeProps({class:["v-chip",{"v-chip--disabled":qe.disabled,"v-chip--label":qe.label,"v-chip--link":ea.value,"v-chip--filter":da,"v-chip--pill":qe.pill,[`${qe.activeClass}`]:qe.activeClass&&((Ka=ys.isActive)==null?void 0:Ka.value)},xs.value,nn.value,na.value,ln.value,cn.value,hn.value,un.value,ia.value,Xn==null?void 0:Xn.selectedClass.value,qe.class],style:[ta.value,qe.style],disabled:qe.disabled||void 0,draggable:qe.draggable,tabindex:ea.value?0:void 0,onClick:sa,onKeydown:ea.value&&!Jo.value&&Ma},ys.linkProps),{default:()=>{var il;return[genOverlays(ea.value,"v-chip"),da&&createVNode(VExpandXTransition,{key:"filter"},{default:()=>[withDirectives(createVNode("div",{class:"v-chip__filter"},[Qe.filter?createVNode(VDefaultsProvider,{key:"filter-defaults",disabled:!qe.filterIcon,defaults:{VIcon:{icon:qe.filterIcon}}},Qe.filter):createVNode(VIcon,{key:"filter-icon",icon:qe.filterIcon},null)]),[[vShow,Xn.isSelected.value]])]}),qa&&createVNode("div",{key:"prepend",class:"v-chip__prepend"},[Qe.prepend?createVNode(VDefaultsProvider,{key:"prepend-defaults",disabled:!ga,defaults:{VAvatar:{image:qe.prependAvatar,start:!0},VIcon:{icon:qe.prependIcon,start:!0}}},Qe.prepend):createVNode(Fragment,null,[qe.prependIcon&&createVNode(VIcon,{key:"prepend-icon",icon:qe.prependIcon,start:!0},null),qe.prependAvatar&&createVNode(VAvatar,{key:"prepend-avatar",image:qe.prependAvatar,start:!0},null)])]),createVNode("div",{class:"v-chip__content","data-no-activator":""},[((il=Qe.default)==null?void 0:il.call(Qe,{isSelected:Xn==null?void 0:Xn.isSelected.value,selectedClass:Xn==null?void 0:Xn.selectedClass.value,select:Xn==null?void 0:Xn.select,toggle:Xn==null?void 0:Xn.toggle,value:Xn==null?void 0:Xn.value.value,disabled:qe.disabled}))??toDisplayString(qe.text)]),ha&&createVNode("div",{key:"append",class:"v-chip__append"},[Qe.append?createVNode(VDefaultsProvider,{key:"append-defaults",disabled:!oa,defaults:{VAvatar:{end:!0,image:qe.appendAvatar},VIcon:{end:!0,icon:qe.appendIcon}}},Qe.append):createVNode(Fragment,null,[qe.appendIcon&&createVNode(VIcon,{key:"append-icon",end:!0,icon:qe.appendIcon},null),qe.appendAvatar&&createVNode(VAvatar,{key:"append-avatar",end:!0,image:qe.appendAvatar},null)])]),ca&&createVNode("button",mergeProps({key:"close",class:"v-chip__close",type:"button","data-testid":"close-chip"},ra.value),[Qe.close?createVNode(VDefaultsProvider,{key:"close-defaults",defaults:{VIcon:{icon:qe.closeIcon,size:"x-small"}}},Qe.close):createVNode(VIcon,{key:"close-icon",icon:qe.closeIcon,size:"x-small"},null)])]}}),[[resolveDirective("ripple"),ea.value&&qe.ripple,null]])}}}),makeVCounterProps=propsFactory({active:Boolean,disabled:Boolean,max:[Number,String],value:{type:[Number,String],default:0},...makeComponentProps(),...makeTransitionProps({transition:{component:VSlideYTransition}})},"VCounter"),VCounter=genericComponent()({name:"VCounter",functional:!0,props:makeVCounterProps(),setup(qe,f){let{slots:ze}=f;const Ke=toRef(()=>qe.max?`${qe.value} / ${qe.max}`:String(qe.value));return useRender(()=>createVNode(MaybeTransition,{transition:qe.transition},{default:()=>[withDirectives(createVNode("div",{class:["v-counter",{"text-error":qe.max&&!qe.disabled&&parseFloat(qe.value)>parseFloat(qe.max)},qe.class],style:qe.style},[ze.default?ze.default({counter:Ke.value,max:qe.max,value:qe.value}):Ke.value]),[[vShow,qe.active]])]})),{}}}),makeVLabelProps=propsFactory({text:String,onClick:EventProp(),...makeComponentProps(),...makeThemeProps()},"VLabel"),VLabel=genericComponent()({name:"VLabel",props:makeVLabelProps(),setup(qe,f){let{slots:ze}=f;return useRender(()=>{var Ke;return createVNode("label",{class:["v-label",{"v-label--clickable":!!qe.onClick},qe.class],style:qe.style,onClick:qe.onClick},[qe.text,(Ke=ze.default)==null?void 0:Ke.call(ze)])}),{}}}),makeVFieldLabelProps=propsFactory({floating:Boolean,...makeComponentProps()},"VFieldLabel"),VFieldLabel=genericComponent()({name:"VFieldLabel",props:makeVFieldLabelProps(),setup(qe,f){let{slots:ze}=f;return useRender(()=>createVNode(VLabel,{class:["v-field-label",{"v-field-label--floating":qe.floating},qe.class],style:qe.style,"aria-hidden":qe.floating||void 0},ze)),{}}});function useInputIcon(qe){const{t:f}=useLocale();function ze(Ke){let{name:Qe,color:Pi}=Ke;const nn={prepend:"prependAction",prependInner:"prependAction",append:"appendAction",appendInner:"appendAction",clear:"clear"}[Qe],ln=qe[`onClick:${Qe}`];function cn(un){un.key!=="Enter"&&un.key!==" "||(un.preventDefault(),un.stopPropagation(),callEvent(ln,new PointerEvent("click",un)))}const hn=ln&&nn?f(`$vuetify.input.${nn}`,qe.label??""):void 0;return createVNode(VIcon,{icon:qe[`${Qe}Icon`],"aria-label":hn,onClick:ln,onKeydown:cn,color:Pi},null)}return{InputIcon:ze}}const makeFocusProps=propsFactory({focused:Boolean,"onUpdate:focused":EventProp()},"focus");function useFocus(qe){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:getCurrentInstanceName();const ze=useProxiedModel(qe,"focused"),Ke=toRef(()=>({[`${f}--focused`]:ze.value}));function Qe(){ze.value=!0}function Pi(){ze.value=!1}return{focusClasses:Ke,isFocused:ze,focus:Qe,blur:Pi}}const allowedVariants=["underlined","outlined","filled","solo","solo-inverted","solo-filled","plain"],makeVFieldProps=propsFactory({appendInnerIcon:IconValue,bgColor:String,clearable:Boolean,clearIcon:{type:IconValue,default:"$clear"},active:Boolean,centerAffix:{type:Boolean,default:void 0},color:String,baseColor:String,dirty:Boolean,disabled:{type:Boolean,default:null},glow:Boolean,error:Boolean,flat:Boolean,iconColor:[Boolean,String],label:String,persistentClear:Boolean,prependInnerIcon:IconValue,reverse:Boolean,singleLine:Boolean,variant:{type:String,default:"filled",validator:qe=>allowedVariants.includes(qe)},"onClick:clear":EventProp(),"onClick:appendInner":EventProp(),"onClick:prependInner":EventProp(),...makeComponentProps(),...makeLoaderProps(),...makeRoundedProps(),...makeThemeProps()},"VField"),VField=genericComponent()({name:"VField",inheritAttrs:!1,props:{id:String,...makeFocusProps(),...makeVFieldProps()},emits:{"update:focused":qe=>!0,"update:modelValue":qe=>!0},setup(qe,f){let{attrs:ze,emit:Ke,slots:Qe}=f;const{themeClasses:Pi}=provideTheme(qe),{loaderClasses:nn}=useLoader(qe),{focusClasses:ln,isFocused:cn,focus:hn,blur:un}=useFocus(qe),{InputIcon:xs}=useInputIcon(qe),{roundedClasses:zn}=useRounded(qe),{rtlClasses:Xn}=useRtl(),ys=toRef(()=>qe.dirty||qe.active),Jo=toRef(()=>!!(qe.label||Qe.label)),ea=toRef(()=>!qe.singleLine&&Jo.value),ra=useId(),na=computed(()=>qe.id||`input-${ra}`),ta=toRef(()=>`${na.value}-messages`),ia=ref(),sa=ref(),Ma=ref(),pa=computed(()=>["plain","underlined"].includes(qe.variant)),oa=computed(()=>qe.error||qe.disabled?void 0:ys.value&&cn.value?qe.color:qe.baseColor),ha=computed(()=>{if(!(!qe.iconColor||qe.glow&&!cn.value))return qe.iconColor===!0?oa.value:qe.iconColor}),{backgroundColorClasses:ca,backgroundColorStyles:da}=useBackgroundColor(()=>qe.bgColor),{textColorClasses:ga,textColorStyles:qa}=useTextColor(oa);watch(ys,cl=>{if(ea.value){const wl=ia.value.$el,al=sa.value.$el;requestAnimationFrame(()=>{const vl=nullifyTransforms(wl),ml=al.getBoundingClientRect(),ol=ml.x-vl.x,el=ml.y-vl.y-(vl.height/2-ml.height/2),dl=ml.width/.75,xl=Math.abs(dl-vl.width)>1?{maxWidth:convertToUnit(dl)}:void 0,Ja=getComputedStyle(wl),yl=getComputedStyle(al),Ol=parseFloat(Ja.transitionDuration)*1e3||150,Il=parseFloat(yl.getPropertyValue("--v-field-label-scale")),Rl=yl.getPropertyValue("color");wl.style.visibility="visible",al.style.visibility="hidden",animate(wl,{transform:`translate(${ol}px, ${el}px) scale(${Il})`,color:Rl,...xl},{duration:Ol,easing:standardEasing,direction:cl?"normal":"reverse"}).finished.then(()=>{wl.style.removeProperty("visibility"),al.style.removeProperty("visibility")})})}},{flush:"post"});const Ka=computed(()=>({isActive:ys,isFocused:cn,controlRef:Ma,blur:un,focus:hn}));function il(cl){cl.target!==document.activeElement&&cl.preventDefault()}return useRender(()=>{var ol,el,dl;const cl=qe.variant==="outlined",wl=!!(Qe["prepend-inner"]||qe.prependInnerIcon),al=!!(qe.clearable||Qe.clear)&&!qe.disabled,vl=!!(Qe["append-inner"]||qe.appendInnerIcon||al),ml=()=>Qe.label?Qe.label({...Ka.value,label:qe.label,props:{for:na.value}}):qe.label;return createVNode("div",mergeProps({class:["v-field",{"v-field--active":ys.value,"v-field--appended":vl,"v-field--center-affix":qe.centerAffix??!pa.value,"v-field--disabled":qe.disabled,"v-field--dirty":qe.dirty,"v-field--error":qe.error,"v-field--glow":qe.glow,"v-field--flat":qe.flat,"v-field--has-background":!!qe.bgColor,"v-field--persistent-clear":qe.persistentClear,"v-field--prepended":wl,"v-field--reverse":qe.reverse,"v-field--single-line":qe.singleLine,"v-field--no-label":!ml(),[`v-field--variant-${qe.variant}`]:!0},Pi.value,ca.value,ln.value,nn.value,zn.value,Xn.value,qe.class],style:[da.value,qe.style],onClick:il},ze),[createVNode("div",{class:"v-field__overlay"},null),createVNode(LoaderSlot,{name:"v-field",active:!!qe.loading,color:qe.error?"error":typeof qe.loading=="string"?qe.loading:qe.color},{default:Qe.loader}),wl&&createVNode("div",{key:"prepend",class:"v-field__prepend-inner"},[qe.prependInnerIcon&&createVNode(xs,{key:"prepend-icon",name:"prependInner",color:ha.value},null),(ol=Qe["prepend-inner"])==null?void 0:ol.call(Qe,Ka.value)]),createVNode("div",{class:"v-field__field","data-no-activator":""},[["filled","solo","solo-inverted","solo-filled"].includes(qe.variant)&&ea.value&&createVNode(VFieldLabel,{key:"floating-label",ref:sa,class:[ga.value],floating:!0,for:na.value,style:qa.value},{default:()=>[ml()]}),Jo.value&&createVNode(VFieldLabel,{key:"label",ref:ia,for:na.value},{default:()=>[ml()]}),((el=Qe.default)==null?void 0:el.call(Qe,{...Ka.value,props:{id:na.value,class:"v-field__input","aria-describedby":ta.value},focus:hn,blur:un}))??createVNode("div",{id:na.value,class:"v-field__input","aria-describedby":ta.value},null)]),al&&createVNode(VExpandXTransition,{key:"clear"},{default:()=>[withDirectives(createVNode("div",{class:"v-field__clearable",onMousedown:xl=>{xl.preventDefault(),xl.stopPropagation()}},[createVNode(VDefaultsProvider,{defaults:{VIcon:{icon:qe.clearIcon}}},{default:()=>[Qe.clear?Qe.clear({...Ka.value,props:{onFocus:hn,onBlur:un,onClick:qe["onClick:clear"]}}):createVNode(xs,{name:"clear",onFocus:hn,onBlur:un},null)]})]),[[vShow,qe.dirty]])]}),vl&&createVNode("div",{key:"append",class:"v-field__append-inner"},[(dl=Qe["append-inner"])==null?void 0:dl.call(Qe,Ka.value),qe.appendInnerIcon&&createVNode(xs,{key:"append-icon",name:"appendInner",color:ha.value},null)]),createVNode("div",{class:["v-field__outline",ga.value],style:qa.value},[cl&&createVNode(Fragment,null,[createVNode("div",{class:"v-field__outline__start"},null),ea.value&&createVNode("div",{class:"v-field__outline__notch"},[createVNode(VFieldLabel,{ref:sa,floating:!0,for:na.value},{default:()=>[ml()]})]),createVNode("div",{class:"v-field__outline__end"},null)]),pa.value&&ea.value&&createVNode(VFieldLabel,{ref:sa,floating:!0,for:na.value},{default:()=>[ml()]})])])}),{controlRef:Ma,fieldIconColor:ha}}}),makeVMessagesProps=propsFactory({active:Boolean,color:String,messages:{type:[Array,String],default:()=>[]},...makeComponentProps(),...makeTransitionProps({transition:{component:VSlideYTransition,leaveAbsolute:!0,group:!0}})},"VMessages"),VMessages=genericComponent()({name:"VMessages",props:makeVMessagesProps(),setup(qe,f){let{slots:ze}=f;const Ke=computed(()=>wrapInArray(qe.messages)),{textColorClasses:Qe,textColorStyles:Pi}=useTextColor(()=>qe.color);return useRender(()=>createVNode(MaybeTransition,{transition:qe.transition,tag:"div",class:["v-messages",Qe.value,qe.class],style:[Pi.value,qe.style]},{default:()=>[qe.active&&Ke.value.map((nn,ln)=>createVNode("div",{class:"v-messages__message",key:`${ln}-${Ke.value}`},[ze.message?ze.message({message:nn}):nn]))]})),{}}}),FormKey=Symbol.for("vuetify:form");function useForm(qe){const f=inject(FormKey,null);return{...f,isReadonly:computed(()=>!!((qe==null?void 0:qe.readonly)??(f==null?void 0:f.isReadonly.value))),isDisabled:computed(()=>!!((qe==null?void 0:qe.disabled)??(f==null?void 0:f.isDisabled.value)))}}const makeValidationProps=propsFactory({disabled:{type:Boolean,default:null},error:Boolean,errorMessages:{type:[Array,String],default:()=>[]},maxErrors:{type:[Number,String],default:1},name:String,label:String,readonly:{type:Boolean,default:null},rules:{type:Array,default:()=>[]},modelValue:null,validateOn:String,validationValue:null,...makeFocusProps()},"validation");function useValidation(qe){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:getCurrentInstanceName(),ze=arguments.length>2&&arguments[2]!==void 0?arguments[2]:useId();const Ke=useProxiedModel(qe,"modelValue"),Qe=computed(()=>qe.validationValue===void 0?Ke.value:qe.validationValue),Pi=useForm(qe),nn=ref([]),ln=shallowRef(!0),cn=computed(()=>!!(wrapInArray(Ke.value===""?null:Ke.value).length||wrapInArray(Qe.value===""?null:Qe.value).length)),hn=computed(()=>{var ta;return(ta=qe.errorMessages)!=null&&ta.length?wrapInArray(qe.errorMessages).concat(nn.value).slice(0,Math.max(0,Number(qe.maxErrors))):nn.value}),un=computed(()=>{var sa;let ta=(qe.validateOn??((sa=Pi.validateOn)==null?void 0:sa.value))||"input";ta==="lazy"&&(ta="input lazy"),ta==="eager"&&(ta="input eager");const ia=new Set((ta==null?void 0:ta.split(" "))??[]);return{input:ia.has("input"),blur:ia.has("blur")||ia.has("input")||ia.has("invalid-input"),invalidInput:ia.has("invalid-input"),lazy:ia.has("lazy"),eager:ia.has("eager")}}),xs=computed(()=>{var ta;return qe.error||(ta=qe.errorMessages)!=null&&ta.length?!1:qe.rules.length?ln.value?nn.value.length||un.value.lazy?null:!0:!nn.value.length:!0}),zn=shallowRef(!1),Xn=computed(()=>({[`${f}--error`]:xs.value===!1,[`${f}--dirty`]:cn.value,[`${f}--disabled`]:Pi.isDisabled.value,[`${f}--readonly`]:Pi.isReadonly.value})),ys=getCurrentInstance("validation"),Jo=computed(()=>qe.name??unref(ze));onBeforeMount(()=>{var ta;(ta=Pi.register)==null||ta.call(Pi,{id:Jo.value,vm:ys,validate:na,reset:ea,resetValidation:ra})}),onBeforeUnmount(()=>{var ta;(ta=Pi.unregister)==null||ta.call(Pi,Jo.value)}),onMounted(async()=>{var ta;un.value.lazy||await na(!un.value.eager),(ta=Pi.update)==null||ta.call(Pi,Jo.value,xs.value,hn.value)}),useToggleScope(()=>un.value.input||un.value.invalidInput&&xs.value===!1,()=>{watch(Qe,()=>{if(Qe.value!=null)na();else if(qe.focused){const ta=watch(()=>qe.focused,ia=>{ia||na(),ta()})}})}),useToggleScope(()=>un.value.blur,()=>{watch(()=>qe.focused,ta=>{ta||na()})}),watch([xs,hn],()=>{var ta;(ta=Pi.update)==null||ta.call(Pi,Jo.value,xs.value,hn.value)});async function ea(){Ke.value=null,await nextTick(),await ra()}async function ra(){ln.value=!0,un.value.lazy?nn.value=[]:await na(!un.value.eager)}async function na(){let ta=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;const ia=[];zn.value=!0;for(const sa of qe.rules){if(ia.length>=Number(qe.maxErrors??1))break;const pa=await(typeof sa=="function"?sa:()=>sa)(Qe.value);if(pa!==!0){if(pa!==!1&&typeof pa!="string"){console.warn(`${pa} is not a valid value. Rule functions must return boolean true or a string.`);continue}ia.push(pa||"")}}return nn.value=ia,zn.value=!1,ln.value=ta,nn.value}return{errorMessages:hn,isDirty:cn,isDisabled:Pi.isDisabled,isReadonly:Pi.isReadonly,isPristine:ln,isValid:xs,isValidating:zn,reset:ea,resetValidation:ra,validate:na,validationClasses:Xn}}const makeVInputProps=propsFactory({id:String,appendIcon:IconValue,baseColor:String,centerAffix:{type:Boolean,default:!0},color:String,glow:Boolean,iconColor:[Boolean,String],prependIcon:IconValue,hideDetails:[Boolean,String],hideSpinButtons:Boolean,hint:String,persistentHint:Boolean,messages:{type:[Array,String],default:()=>[]},direction:{type:String,default:"horizontal",validator:qe=>["horizontal","vertical"].includes(qe)},"onClick:prepend":EventProp(),"onClick:append":EventProp(),...makeComponentProps(),...makeDensityProps(),...pick(makeDimensionProps(),["maxWidth","minWidth","width"]),...makeThemeProps(),...makeValidationProps()},"VInput"),VInput=genericComponent()({name:"VInput",props:{...makeVInputProps()},emits:{"update:modelValue":qe=>!0},setup(qe,f){let{attrs:ze,slots:Ke,emit:Qe}=f;const{densityClasses:Pi}=useDensity(qe),{dimensionStyles:nn}=useDimension(qe),{themeClasses:ln}=provideTheme(qe),{rtlClasses:cn}=useRtl(),{InputIcon:hn}=useInputIcon(qe),un=useId(),xs=computed(()=>qe.id||`input-${un}`),zn=computed(()=>`${xs.value}-messages`),{errorMessages:Xn,isDirty:ys,isDisabled:Jo,isReadonly:ea,isPristine:ra,isValid:na,isValidating:ta,reset:ia,resetValidation:sa,validate:Ma,validationClasses:pa}=useValidation(qe,"v-input",xs),oa=computed(()=>({id:xs,messagesId:zn,isDirty:ys,isDisabled:Jo,isReadonly:ea,isPristine:ra,isValid:na,isValidating:ta,reset:ia,resetValidation:sa,validate:Ma})),ha=toRef(()=>qe.error||qe.disabled?void 0:qe.focused?qe.color:qe.baseColor),ca=toRef(()=>{if(qe.iconColor)return qe.iconColor===!0?ha.value:qe.iconColor}),da=computed(()=>{var ga;return(ga=qe.errorMessages)!=null&&ga.length||!ra.value&&Xn.value.length?Xn.value:qe.hint&&(qe.persistentHint||qe.focused)?qe.hint:qe.messages});return useRender(()=>{var cl,wl,al,vl;const ga=!!(Ke.prepend||qe.prependIcon),qa=!!(Ke.append||qe.appendIcon),Ka=da.value.length>0,il=!qe.hideDetails||qe.hideDetails==="auto"&&(Ka||!!Ke.details);return createVNode("div",{class:["v-input",`v-input--${qe.direction}`,{"v-input--center-affix":qe.centerAffix,"v-input--focused":qe.focused,"v-input--glow":qe.glow,"v-input--hide-spin-buttons":qe.hideSpinButtons},Pi.value,ln.value,cn.value,pa.value,qe.class],style:[nn.value,qe.style]},[ga&&createVNode("div",{key:"prepend",class:"v-input__prepend"},[(cl=Ke.prepend)==null?void 0:cl.call(Ke,oa.value),qe.prependIcon&&createVNode(hn,{key:"prepend-icon",name:"prepend",color:ca.value},null)]),Ke.default&&createVNode("div",{class:"v-input__control"},[(wl=Ke.default)==null?void 0:wl.call(Ke,oa.value)]),qa&&createVNode("div",{key:"append",class:"v-input__append"},[qe.appendIcon&&createVNode(hn,{key:"append-icon",name:"append",color:ca.value},null),(al=Ke.append)==null?void 0:al.call(Ke,oa.value)]),il&&createVNode("div",{id:zn.value,class:"v-input__details",role:"alert","aria-live":"polite"},[createVNode(VMessages,{active:Ka,messages:da.value},{message:Ke.message}),(vl=Ke.details)==null?void 0:vl.call(Ke,oa.value)])])}),{reset:ia,resetValidation:sa,validate:Ma,isValid:na,errorMessages:Xn}}}),Refs=Symbol("Forwarded refs");function getDescriptor(qe,f){let ze=qe;for(;ze;){const Ke=Reflect.getOwnPropertyDescriptor(ze,f);if(Ke)return Ke;ze=Object.getPrototypeOf(ze)}}function forwardRefs(qe){for(var f=arguments.length,ze=new Array(f>1?f-1:0),Ke=1;Ke<f;Ke++)ze[Ke-1]=arguments[Ke];return qe[Refs]=ze,new Proxy(qe,{get(Qe,Pi){if(Reflect.has(Qe,Pi))return Reflect.get(Qe,Pi);if(!(typeof Pi=="symbol"||Pi.startsWith("$")||Pi.startsWith("__"))){for(const nn of ze)if(nn.value&&Reflect.has(nn.value,Pi)){const ln=Reflect.get(nn.value,Pi);return typeof ln=="function"?ln.bind(nn.value):ln}}},has(Qe,Pi){if(Reflect.has(Qe,Pi))return!0;if(typeof Pi=="symbol"||Pi.startsWith("$")||Pi.startsWith("__"))return!1;for(const nn of ze)if(nn.value&&Reflect.has(nn.value,Pi))return!0;return!1},set(Qe,Pi,nn){if(Reflect.has(Qe,Pi))return Reflect.set(Qe,Pi,nn);if(typeof Pi=="symbol"||Pi.startsWith("$")||Pi.startsWith("__"))return!1;for(const ln of ze)if(ln.value&&Reflect.has(ln.value,Pi))return Reflect.set(ln.value,Pi,nn);return!1},getOwnPropertyDescriptor(Qe,Pi){var ln;const nn=Reflect.getOwnPropertyDescriptor(Qe,Pi);if(nn)return nn;if(!(typeof Pi=="symbol"||Pi.startsWith("$")||Pi.startsWith("__"))){for(const cn of ze){if(!cn.value)continue;const hn=getDescriptor(cn.value,Pi)??("_"in cn.value?getDescriptor((ln=cn.value._)==null?void 0:ln.setupState,Pi):void 0);if(hn)return hn}for(const cn of ze){const hn=cn.value&&cn.value[Refs];if(!hn)continue;const un=hn.slice();for(;un.length;){const xs=un.shift(),zn=getDescriptor(xs.value,Pi);if(zn)return zn;const Xn=xs.value&&xs.value[Refs];Xn&&un.push(...Xn)}}}}})}const makeVFileInputProps=propsFactory({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:qe=>typeof qe=="boolean"||[1e3,1024].includes(Number(qe))},...makeVInputProps({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:qe=>qe.multiple?[]:null,validator:qe=>wrapInArray(qe).every(f=>f!=null&&typeof f=="object")},...makeVFieldProps({clearable:!0})},"VFileInput"),VFileInput=genericComponent()({name:"VFileInput",inheritAttrs:!1,props:makeVFileInputProps(),emits:{"click:control":qe=>!0,"mousedown:control":qe=>!0,"update:focused":qe=>!0,"update:modelValue":qe=>!0},setup(qe,f){let{attrs:ze,emit:Ke,slots:Qe}=f;const{t:Pi}=useLocale(),nn=useProxiedModel(qe,"modelValue",qe.modelValue,qa=>wrapInArray(qa),qa=>!qe.multiple&&Array.isArray(qa)?qa[0]:qa),{isFocused:ln,focus:cn,blur:hn}=useFocus(qe),un=computed(()=>typeof qe.showSize!="boolean"?qe.showSize:void 0),xs=computed(()=>(nn.value??[]).reduce((qa,Ka)=>{let{size:il=0}=Ka;return qa+il},0)),zn=computed(()=>humanReadableFileSize(xs.value,un.value)),Xn=computed(()=>(nn.value??[]).map(qa=>{const{name:Ka="",size:il=0}=qa;return qe.showSize?`${Ka} (${humanReadableFileSize(il,un.value)})`:Ka})),ys=computed(()=>{var Ka;const qa=((Ka=nn.value)==null?void 0:Ka.length)??0;return qe.showSize?Pi(qe.counterSizeString,qa,zn.value):Pi(qe.counterString,qa)}),Jo=ref(),ea=ref(),ra=ref(),na=toRef(()=>ln.value||qe.active),ta=computed(()=>["plain","underlined"].includes(qe.variant)),ia=shallowRef(!1);function sa(){var qa;ra.value!==document.activeElement&&((qa=ra.value)==null||qa.focus()),ln.value||cn()}function Ma(qa){var Ka;(Ka=ra.value)==null||Ka.click()}function pa(qa){Ke("mousedown:control",qa)}function oa(qa){var Ka;(Ka=ra.value)==null||Ka.click(),Ke("click:control",qa)}function ha(qa){qa.stopPropagation(),sa(),nextTick(()=>{nn.value=[],callEvent(qe["onClick:clear"],qa)})}function ca(qa){qa.preventDefault(),qa.stopImmediatePropagation(),ia.value=!0}function da(qa){qa.preventDefault(),ia.value=!1}function ga(qa){var il,cl;if(qa.preventDefault(),qa.stopImmediatePropagation(),ia.value=!1,!((cl=(il=qa.dataTransfer)==null?void 0:il.files)!=null&&cl.length)||!ra.value)return;const Ka=new DataTransfer;for(const wl of qa.dataTransfer.files)Ka.items.add(wl);ra.value.files=Ka.files,ra.value.dispatchEvent(new Event("change",{bubbles:!0}))}return watch(nn,qa=>{(!Array.isArray(qa)||!qa.length)&&ra.value&&(ra.value.value="")}),useRender(()=>{const qa=!!(Qe.counter||qe.counter),Ka=!!(qa||Qe.details),[il,cl]=filterInputAttrs(ze),{modelValue:wl,...al}=VInput.filterProps(qe),vl=VField.filterProps(qe);return createVNode(VInput,mergeProps({ref:Jo,modelValue:qe.multiple?nn.value:nn.value[0],class:["v-file-input",{"v-file-input--chips":!!qe.chips,"v-file-input--dragging":ia.value,"v-file-input--hide":qe.hideInput,"v-input--plain-underlined":ta.value},qe.class],style:qe.style,"onClick:prepend":Ma},il,al,{centerAffix:!ta.value,focused:ln.value}),{...Qe,default:ml=>{let{id:ol,isDisabled:el,isDirty:dl,isReadonly:xl,isValid:Ja}=ml;return createVNode(VField,mergeProps({ref:ea,"prepend-icon":qe.prependIcon,onMousedown:pa,onClick:oa,"onClick:clear":ha,"onClick:prependInner":qe["onClick:prependInner"],"onClick:appendInner":qe["onClick:appendInner"]},vl,{id:ol.value,active:na.value||dl.value,dirty:dl.value||qe.dirty,disabled:el.value,focused:ln.value,error:Ja.value===!1,onDragover:ca,onDrop:ga}),{...Qe,default:yl=>{var Rl;let{props:{class:Ol,...Il}}=yl;return createVNode(Fragment,null,[createVNode("input",mergeProps({ref:ra,type:"file",readonly:xl.value,disabled:el.value,multiple:qe.multiple,name:qe.name,onClick:Al=>{Al.stopPropagation(),xl.value&&Al.preventDefault(),sa()},onChange:Al=>{if(!Al.target)return;const zl=Al.target;nn.value=[...zl.files??[]]},onDragleave:da,onFocus:sa,onBlur:hn},Il,cl),null),createVNode("div",{class:Ol},[!!((Rl=nn.value)!=null&&Rl.length)&&!qe.hideInput&&(Qe.selection?Qe.selection({fileNames:Xn.value,totalBytes:xs.value,totalBytesReadable:zn.value}):qe.chips?Xn.value.map(Al=>createVNode(VChip,{key:Al,size:"small",text:Al},null)):Xn.value.join(", "))])])}})},details:Ka?ml=>{var ol,el;return createVNode(Fragment,null,[(ol=Qe.details)==null?void 0:ol.call(Qe,ml),qa&&createVNode(Fragment,null,[createVNode("span",null,null),createVNode(VCounter,{active:!!((el=nn.value)!=null&&el.length),value:ys.value,disabled:qe.disabled},Qe.counter)])])}:void 0})}),forwardRefs({},Jo,ea,ra)}}),_hoisted_1={class:"outer-canvas-container"},_hoisted_2=["src"],_hoisted_3={key:2},_hoisted_4={slot:"first",class:"before"},_hoisted_5=["src"],_hoisted_6={slot:"second",class:"after"},_hoisted_7=["src"],p1=.95,p2=.95,p3=20,_sfc_main=defineComponent({__name:"index",setup(qe){const f=useTemplateRef("wrapper"),ze=useTemplateRef("polygonCanvas"),Ke=useTemplateRef("scaledImage"),Qe=ref(),Pi=ref(),nn=ref(),ln=ref(),cn=ref(),hn=ref(50),un=ref();let xs=1080,zn=1080,Xn,ys={x:0,y:0},Jo={x:0,y:0};const ea=new ResizeObserver(ta);let ra=0,na;function ta(){var ha,ca,da,ga;Qe.value&&((ha=f.value)!=null&&ha.clientWidth)&&ra!==((ca=f.value)==null?void 0:ca.clientWidth)&&(ra=(da=f.value)==null?void 0:da.clientWidth,Xn==null||Xn.dispose(),Xn=void 0,un.value=void 0,zn=((ga=f.value)==null?void 0:ga.clientWidth)||1080,ze.value&&(ze.value.width=0,ze.value.height=0),clearTimeout(na),na=setTimeout(()=>sa(),100))}watch(Qe,async ha=>{if(ha){cn.value=void 0,hn.value=50,nn.value=void 0,ln.value=void 0;const ca=new FileReader;ca.onload=da=>{Pi.value=da.target.result,nextTick(()=>pa())},ca.readAsDataURL(ha)}else Pi.value=void 0});function ia(){var ha;un.value&&(un.value.points=[{x:0,y:0},{x:Jo.x,y:0},{x:Jo.x,y:Jo.y},{x:0,y:Jo.y}],un.value.setCoords(),(ha=un.value.canvas)==null||ha.renderAll())}function sa(){if(ze.value&&Ke.value){if(!Xn){Jo=limitDimensions(Ke.value.clientWidth,Ke.value.clientHeight,xs),Xn=new Cn(ze.value);const ha=Math.min(zn,Jo.x),ca=ha*(Jo.y/Jo.x);Jo={x:ha,y:ca},Xn.setDimensions({width:ha,height:ca}),Xn.on("mouse:down",da=>{var ga;if(un.value&&un.value.points){let qa=-1,Ka=Number.MAX_VALUE;un.value.points.forEach((il,cl)=>{const wl=minkowskiDistance([il.x,il.y],[da.absolutePointer.x,da.absolutePointer.y]);wl<Ka&&(Ka=wl,qa=cl)}),qa!==-1&&(un.value.points[qa].x=da.absolutePointer.x,un.value.points[qa].y=da.absolutePointer.y,un.value.setCoords(),(ga=un.value.canvas)==null||ga.renderAll())}}),Xn.on("object:moving",da=>{const ga=da.target;ga.currentHeight>ga.canvas.height||ga.currentWidth>ga.canvas.width||(ga.setCoords(),(ga.getBoundingRect().top<0||ga.getBoundingRect().left<0)&&(ga.top=Math.max(ga.top,ga.top-ga.getBoundingRect().top),ga.left=Math.max(ga.left,ga.left-ga.getBoundingRect().left)),(ga.getBoundingRect().top+ga.getBoundingRect().height>ga.canvas.height||ga.getBoundingRect().left+ga.getBoundingRect().width>ga.canvas.width)&&(ga.top=Math.min(ga.top,ga.canvas.height-ga.getBoundingRect().height+ga.top-ga.getBoundingRect().top),ga.left=Math.min(ga.left,ga.canvas.width-ga.getBoundingRect().width+ga.left-ga.getBoundingRect().left)))})}un.value||(un.value=new ao([{x:0,y:0},{x:Jo.x,y:0},{x:Jo.x,y:Jo.y},{x:0,y:Jo.y}],{fill:"white",opacity:.25,strokeWidth:1,stroke:"white",objectCaching:!1,transparentCorners:!1,cornerSize:20,cornerColor:"#6E1E41",hasBorders:!1}),Xn.add(un.value),un.value.controls=ka.createPolyControls(un.value),Object.keys(un.value.controls).forEach(ha=>{if(un.value){const ca=un.value.controls[ha],da=ca.actionHandler;ca.actionHandler=(ga,qa,Ka,il)=>{const cl=qa.target.canvas;return da(ga,qa,Math.min(Math.max(Ka,0),(cl==null?void 0:cl.width)||0),Math.min(Math.max(il,0),(cl==null?void 0:cl.height)||0))}}}),Xn.setActiveObject(un.value))}}async function Ma(){var da;const ha=ys.x/Jo.x,ca=(((da=un.value)==null?void 0:da.points)||[]).concat().map(ga=>({x:ga.x*ha,y:ga.y*ha}));Pi.value&&fetch(Pi.value).then(ga=>ga.blob()).then(ga=>N.createFromBlob(ga)).then(ga=>He(ga,"Perspective",[ca[0].x,ca[0].y,0,0,ca[1].x,ca[1].y,ga.width,0,ca[3].x,ca[3].y,0,ga.height,ca[2].x,ca[2].y,ga.width,ga.height],{viewport:{width:ga.width,height:ga.height,x:0,y:0},virtualPixelMethod:p.TRANSPARENT})).then(ga=>ga.image.getResource().convertToBlob()).then(ga=>new Promise(qa=>{const Ka=new FileReader;Ka.onload=()=>{qa(Ka.result)},Ka.readAsDataURL(ga)})).then(ga=>{ga&&(nn.value=ga,nextTick(()=>oa()))})}async function pa(){if(Pi.value){let ha=await Image$1.load(Pi.value);(ha.width>xs||ha.height>xs)&&(ys=limitDimensions(ha.width,ha.height,xs),ha=ha.resize({width:ys.x,height:ys.y,preserveAspectRatio:!0}),Pi.value=ha.toDataURL()),nextTick(()=>sa())}}async function oa(){if(nn.value){const ha=await Image$1.load(nn.value),ca=ha.grey({algorithm:(ga,qa,Ka)=>ga/qa<p1&&Ka/qa<p2&&2*qa-ga-Ka>p3?255:0}),da=ca.open().close().mask();cn.value=ca.data.filter(ga=>ga!==0).length/ca.data.length,ln.value=ha.extract(da).toDataURL()}}return onMounted(()=>{var ha;f.value&&ea.observe(f.value),zn=((ha=f.value)==null?void 0:ha.clientWidth)||1080,xs=1080}),onBeforeUnmount(()=>{f.value&&ea.unobserve(f.value)}),(ha,ca)=>(openBlock(),createElementBlock("div",{ref_key:"wrapper",ref:f},[createVNode(VFileInput,{modelValue:unref(Qe),"onUpdate:modelValue":ca[0]||(ca[0]=da=>isRef(Qe)?Qe.value=da:null),accept:"image/*",label:"File input"},null,8,["modelValue"]),unref(un)?(openBlock(),createBlock(VBtn,{key:0,"prepend-icon":"mdi-overscan",onClick:ia},{default:withCtx(()=>ca[1]||(ca[1]=[createTextVNode(" Maximize selection ")])),_:1})):createCommentVNode("",!0),createBaseVNode("div",_hoisted_1,[createBaseVNode("img",{ref_key:"scaledImage",ref:Ke,class:"spriggles-img",src:unref(Pi)},null,8,_hoisted_2),createBaseVNode("canvas",{ref_key:"polygonCanvas",ref:ze,height:"0",width:"0"},null,512)]),unref(un)?(openBlock(),createBlock(VBtn,{key:1,class:"my-4","prepend-icon":"mdi-chevron-triple-down",onClick:Ma},{default:withCtx(()=>ca[2]||(ca[2]=[createTextVNode(" Extract vegetation ")])),_:1})):createCommentVNode("",!0),unref(cn)!==void 0?(openBlock(),createElementBlock("h2",_hoisted_3,"Vegetation ratio: "+toDisplayString((unref(cn)*100).toFixed(2))+"%",1)):createCommentVNode("",!0),createVNode(unref(ImgComparisonSlider),{value:unref(hn)},{default:withCtx(()=>[createBaseVNode("figure",_hoisted_4,[createBaseVNode("img",{class:"spriggles-img",src:unref(nn)},null,8,_hoisted_5),ca[3]||(ca[3]=createBaseVNode("figcaption",null,"Original",-1))]),createBaseVNode("figure",_hoisted_6,[createBaseVNode("img",{class:"spriggles-img",src:unref(ln)},null,8,_hoisted_7),ca[4]||(ca[4]=createBaseVNode("figcaption",null,"Extracted",-1))])]),_:1},8,["value"])],512))}});export{_sfc_main as default};
