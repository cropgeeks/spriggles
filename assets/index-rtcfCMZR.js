var Zc=Object.defineProperty;var Nc=qe=>{throw TypeError(qe)};var Jc=(qe,f,ze)=>f in qe?Zc(qe,f,{enumerable:!0,configurable:!0,writable:!0,value:ze}):qe[f]=ze;var hc=(qe,f,ze)=>Jc(qe,typeof f!="symbol"?f+"":f,ze),Pc=(qe,f,ze)=>f.has(qe)||Nc("Cannot "+ze);var kc=(qe,f,ze)=>(Pc(qe,f,"read from private field"),ze?ze.call(qe):f.get(qe)),Oc=(qe,f,ze)=>f.has(qe)?Nc("Cannot add the same private member more than once"):f instanceof WeakSet?f.add(qe):f.set(qe,ze),Mc=(qe,f,ze,Ke)=>(Pc(qe,f,"write to private field"),Ke?Ke.call(qe,ze):f.set(qe,ze),ze),Bc=(qe,f,ze)=>(Pc(qe,f,"access private method"),ze);import{g as genericComponent,p as propsFactory,a as createVNode,m as mergeProps,T as Transition,b as animate,e as acceleratedEasing,s as standardEasing,f as deceleratedEasing,h as getTargetBox,n as nullifyTransforms,d as defineComponent,i as h$1,j as getAugmentedNamespace,k as getDefaultExportFromCjs,l as coreStore,u as useTemplateRef,q as ref,t as watch,v as emitter,x as nextTick,y as onMounted,z as onBeforeUnmount,A as createElementBlock,o as openBlock,B as createCommentVNode,C as createBaseVNode,c as createBlock,D as VFileInput,E as unref,F as isRef,G as VBtn,w as withCtx,H as createTextVNode,I as VIcon,J as toDisplayString,K as withModifiers,L as makeComponentProps,M as provideDefaults,N as useRender,O as makeTagProps,P as createSimpleFunctional,Q as Fragment,R as VAvatar,S as VDefaultsProvider,U as makeDensityProps,W as IconValue,X as Ripple,Y as provideTheme,Z as useBorder,_ as useVariant,$ as useDensity,a0 as useDimension,a1 as useElevation,a2 as useLoader,a3 as useLocation,a4 as usePosition,a5 as useRounded,a6 as useLink,a7 as withDirectives,a8 as resolveDirective,a9 as genOverlays,aa as VImg,ab as LoaderSlot,ac as makeVariantProps,ad as makeThemeProps,ae as makeRouterProps,af as makeRoundedProps,ag as makePositionProps,ah as makeLocationProps,ai as makeLoaderProps,aj as makeElevationProps,ak as makeDimensionProps,al as makeBorderProps,am as useProxiedModel,an as useScopeId,ao as IN_BROWSER,ap as VOverlay,aq as forwardRefs,ar as makeVOverlayProps,as as focusableChildren,at as renderSlot,au as VSpacer,av as toRef,aw as useTextColor,ax as useLocale,ay as computed,az as convertToUnit,aA as createForm,aB as makeFormProps,aC as deepEqual,aD as useId,aE as provide,aF as onScopeDispose,aG as shallowRef,aH as filterInputAttrs,aI as VLabel,aJ as inject,aK as wrapInArray,aL as useBackgroundColor,aM as matchesSelector,aN as omit,aO as toRaw,aP as getCurrentInstance,aQ as toValue,aR as onBeforeMount,aS as useSsrBoot,aT as defineComponent$1,aU as MaybeTransition,aV as VExpandTransition,aW as vShow,aX as deprecate,aY as EventProp,aZ as watchEffect,a_ as isPrimitive,a$ as pick,b0 as getPropertyFromItem,b1 as focusChild,b2 as useRtl,b3 as VMenuSymbol,b4 as onDeactivated,b5 as getNextElement,b6 as isClickInsideElement,b7 as Intersect,b8 as useFocus,b9 as VInput,ba as VField,bb as VCounter,bc as cloneVNode,bd as makeVFieldProps,be as makeVInputProps,bf as callEvent,bg as useResizeObserver,bh as useDisplay,bi as debounce,bj as clamp$1,bk as useToggleScope,bl as getScrollParent,bm as useForm,bn as ensureValidVNode,bo as VChip,bp as makeTransitionProps,bq as checkPrintable,br as makeVBtnProps,bs as keys$1,bt as useGroup,bu as useGroupItem,bv as useLazy,bw as makeLazyProps,bx as makeGroupItemProps,by as VSlideGroup,bz as makeVSlideGroupProps,bA as isObject$1,bB as useTheme,bC as renderList,bD as VProgressLinear,bE as Teleport}from"./index-DR6JHjSf.js";import{V as VRow,a as VCol}from"./VRow-Cfcq6xqu.js";function t(qe,f,ze){return(f=function(Ke){var Qe=function(Pi,nn){if(typeof Pi!="object"||!Pi)return Pi;var ln=Pi[Symbol.toPrimitive];if(ln!==void 0){var cn=ln.call(Pi,nn);if(typeof cn!="object")return cn;throw new TypeError("@@toPrimitive must return a primitive value.")}return(nn==="string"?String:Number)(Pi)}(Ke,"string");return typeof Qe=="symbol"?Qe:Qe+""}(f))in qe?Object.defineProperty(qe,f,{value:ze,enumerable:!0,configurable:!0,writable:!0}):qe[f]=ze,qe}function e(qe,f){var ze=Object.keys(qe);if(Object.getOwnPropertySymbols){var Ke=Object.getOwnPropertySymbols(qe);f&&(Ke=Ke.filter(function(Qe){return Object.getOwnPropertyDescriptor(qe,Qe).enumerable})),ze.push.apply(ze,Ke)}return ze}function s(qe){for(var f=1;f<arguments.length;f++){var ze=arguments[f]!=null?arguments[f]:{};f%2?e(Object(ze),!0).forEach(function(Ke){t(qe,Ke,ze[Ke])}):Object.getOwnPropertyDescriptors?Object.defineProperties(qe,Object.getOwnPropertyDescriptors(ze)):e(Object(ze)).forEach(function(Ke){Object.defineProperty(qe,Ke,Object.getOwnPropertyDescriptor(ze,Ke))})}return qe}function i(qe,f){if(qe==null)return{};var ze,Ke,Qe=function(nn,ln){if(nn==null)return{};var cn={};for(var hn in nn)if({}.hasOwnProperty.call(nn,hn)){if(ln.indexOf(hn)>=0)continue;cn[hn]=nn[hn]}return cn}(qe,f);if(Object.getOwnPropertySymbols){var Pi=Object.getOwnPropertySymbols(qe);for(Ke=0;Ke<Pi.length;Ke++)ze=Pi[Ke],f.indexOf(ze)>=0||{}.propertyIsEnumerable.call(qe,ze)&&(Qe[ze]=qe[ze])}return Qe}function r(qe,f){return f||(f=qe.slice(0)),Object.freeze(Object.defineProperties(qe,{raw:{value:Object.freeze(f)}}))}class n{constructor(){t(this,"browserShadowBlurConstant",1),t(this,"DPI",96),t(this,"devicePixelRatio",typeof window<"u"?window.devicePixelRatio:1),t(this,"perfLimitSizeTotal",2097152),t(this,"maxCacheSideLimit",4096),t(this,"minCacheSideLimit",256),t(this,"disableStyleCopyPaste",!1),t(this,"enableGLFiltering",!0),t(this,"textureSize",4096),t(this,"forceGLPutImageData",!1),t(this,"cachesBoundsOfCurve",!1),t(this,"fontPaths",{}),t(this,"NUM_FRACTION_DIGITS",4)}}const o=new class extends n{constructor(qe){super(),this.configure(qe)}configure(){let qe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.assign(this,qe)}addFonts(){let qe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fontPaths=s(s({},this.fontPaths),qe)}removeFonts(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(qe=>{delete this.fontPaths[qe]})}clearFonts(){this.fontPaths={}}restoreDefaults(qe){const f=new n,ze=(qe==null?void 0:qe.reduce((Ke,Qe)=>(Ke[Qe]=f[Qe],Ke),{}))||f;this.configure(ze)}},a=function(qe){for(var f=arguments.length,ze=new Array(f>1?f-1:0),Ke=1;Ke<f;Ke++)ze[Ke-1]=arguments[Ke];return console[qe]("fabric",...ze)};class h extends Error{constructor(f,ze){super("fabric: ".concat(f),ze)}}class c extends h{constructor(f){super("".concat(f," 'options.signal' is in 'aborted' state"))}}class l{}class u extends l{testPrecision(f,ze){const Ke="precision ".concat(ze,` float;
void main(){}`),Qe=f.createShader(f.FRAGMENT_SHADER);return!!Qe&&(f.shaderSource(Qe,Ke),f.compileShader(Qe),!!f.getShaderParameter(Qe,f.COMPILE_STATUS))}queryWebGL(f){const ze=f.getContext("webgl");ze&&(this.maxTextureSize=ze.getParameter(ze.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find(Ke=>this.testPrecision(ze,Ke)),ze.getExtension("WEBGL_lose_context").loseContext(),a("log","WebGL: max texture size ".concat(this.maxTextureSize)))}isSupported(f){return!!this.maxTextureSize&&this.maxTextureSize>=f}}const d={};let g;const p$1=()=>g||(g={document,window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new u,dispose(){},copyPasteData:d}),m=()=>p$1().document,v=()=>p$1().window,y$1=()=>{var qe;return Math.max((qe=o.devicePixelRatio)!==null&&qe!==void 0?qe:v().devicePixelRatio,1)},_=new class{constructor(){t(this,"charWidthsCache",{}),t(this,"boundsOfCurveCache",{})}getFontCache(qe){let{fontFamily:f,fontStyle:ze,fontWeight:Ke}=qe;f=f.toLowerCase(),this.charWidthsCache[f]||(this.charWidthsCache[f]={});const Qe=this.charWidthsCache[f],Pi="".concat(ze.toLowerCase(),"_").concat((Ke+"").toLowerCase());return Qe[Pi]||(Qe[Pi]={}),Qe[Pi]}clearFontCache(qe){(qe=(qe||"").toLowerCase())?this.charWidthsCache[qe]&&delete this.charWidthsCache[qe]:this.charWidthsCache={}}limitDimsByArea(qe){const{perfLimitSizeTotal:f}=o,ze=Math.sqrt(f*qe);return[Math.floor(ze),Math.floor(f/ze)]}},x$1="6.6.4";function C(){}const b=Math.PI/2,w$1=2*Math.PI,S$1=Math.PI/180,T=Object.freeze([1,0,0,1,0,0]),O$1=16,k$1=.4477152502,D$1="center",M$1="left",P="top",E$1="bottom",A="right",j$1="none",F$1=/\r?\n/,L="moving",R="scaling",I="rotating",B$1="rotate",X="skewing",Y$1="resizing",W$1="modifyPoly",V="modifyPath",z="changed",G$1="scale",H="scaleX",N$1="scaleY",U="skewX",q="skewY",K$1="fill",J="stroke",Q$1="modified",Z="json",$$2="svg",tt=new class{constructor(){this[Z]=new Map,this[$$2]=new Map}has(qe){return this[Z].has(qe)}getClass(qe){const f=this[Z].get(qe);if(!f)throw new h("No class registered for ".concat(qe));return f}setClass(qe,f){f?this[Z].set(f,qe):(this[Z].set(qe.type,qe),this[Z].set(qe.type.toLowerCase(),qe))}getSVGClass(qe){return this[$$2].get(qe)}setSVGClass(qe,f){this[$$2].set(f??qe.type.toLowerCase(),qe)}},et$1=new class extends Array{remove(qe){const f=this.indexOf(qe);f>-1&&this.splice(f,1)}cancelAll(){const qe=this.splice(0);return qe.forEach(f=>f.abort()),qe}cancelByCanvas(qe){if(!qe)return[];const f=this.filter(ze=>{var Ke;return ze.target===qe||typeof ze.target=="object"&&((Ke=ze.target)===null||Ke===void 0?void 0:Ke.canvas)===qe});return f.forEach(ze=>ze.abort()),f}cancelByTarget(qe){if(!qe)return[];const f=this.filter(ze=>ze.target===qe);return f.forEach(ze=>ze.abort()),f}};let st$1=class{constructor(){t(this,"__eventListeners",{})}on(f,ze){if(this.__eventListeners||(this.__eventListeners={}),typeof f=="object")return Object.entries(f).forEach(Ke=>{let[Qe,Pi]=Ke;this.on(Qe,Pi)}),()=>this.off(f);if(ze){const Ke=f;return this.__eventListeners[Ke]||(this.__eventListeners[Ke]=[]),this.__eventListeners[Ke].push(ze),()=>this.off(Ke,ze)}return()=>!1}once(f,ze){if(typeof f=="object"){const Ke=[];return Object.entries(f).forEach(Qe=>{let[Pi,nn]=Qe;Ke.push(this.once(Pi,nn))}),()=>Ke.forEach(Qe=>Qe())}if(ze){const Ke=this.on(f,function(){for(var Qe=arguments.length,Pi=new Array(Qe),nn=0;nn<Qe;nn++)Pi[nn]=arguments[nn];ze.call(this,...Pi),Ke()});return Ke}return()=>!1}_removeEventListener(f,ze){if(this.__eventListeners[f])if(ze){const Ke=this.__eventListeners[f],Qe=Ke.indexOf(ze);Qe>-1&&Ke.splice(Qe,1)}else this.__eventListeners[f]=[]}off(f,ze){if(this.__eventListeners)if(f===void 0)for(const Ke in this.__eventListeners)this._removeEventListener(Ke);else typeof f=="object"?Object.entries(f).forEach(Ke=>{let[Qe,Pi]=Ke;this._removeEventListener(Qe,Pi)}):this._removeEventListener(f,ze)}fire(f,ze){var Ke;if(!this.__eventListeners)return;const Qe=(Ke=this.__eventListeners[f])===null||Ke===void 0?void 0:Ke.concat();if(Qe)for(let Pi=0;Pi<Qe.length;Pi++)Qe[Pi].call(this,ze||{})}};const it$1=(qe,f)=>{const ze=qe.indexOf(f);return ze!==-1&&qe.splice(ze,1),qe},rt$1=qe=>{if(qe===0)return 1;switch(Math.abs(qe)/b){case 1:case 3:return 0;case 2:return-1}return Math.cos(qe)},nt$1=qe=>{if(qe===0)return 0;const f=qe/b,ze=Math.sign(qe);switch(f){case 1:return ze;case 2:return 0;case 3:return-ze}return Math.sin(qe)};let ot$1=class vc{constructor(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;typeof f=="object"?(this.x=f.x,this.y=f.y):(this.x=f,this.y=ze)}add(f){return new vc(this.x+f.x,this.y+f.y)}addEquals(f){return this.x+=f.x,this.y+=f.y,this}scalarAdd(f){return new vc(this.x+f,this.y+f)}scalarAddEquals(f){return this.x+=f,this.y+=f,this}subtract(f){return new vc(this.x-f.x,this.y-f.y)}subtractEquals(f){return this.x-=f.x,this.y-=f.y,this}scalarSubtract(f){return new vc(this.x-f,this.y-f)}scalarSubtractEquals(f){return this.x-=f,this.y-=f,this}multiply(f){return new vc(this.x*f.x,this.y*f.y)}scalarMultiply(f){return new vc(this.x*f,this.y*f)}scalarMultiplyEquals(f){return this.x*=f,this.y*=f,this}divide(f){return new vc(this.x/f.x,this.y/f.y)}scalarDivide(f){return new vc(this.x/f,this.y/f)}scalarDivideEquals(f){return this.x/=f,this.y/=f,this}eq(f){return this.x===f.x&&this.y===f.y}lt(f){return this.x<f.x&&this.y<f.y}lte(f){return this.x<=f.x&&this.y<=f.y}gt(f){return this.x>f.x&&this.y>f.y}gte(f){return this.x>=f.x&&this.y>=f.y}lerp(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5;return ze=Math.max(Math.min(1,ze),0),new vc(this.x+(f.x-this.x)*ze,this.y+(f.y-this.y)*ze)}distanceFrom(f){const ze=this.x-f.x,Ke=this.y-f.y;return Math.sqrt(ze*ze+Ke*Ke)}midPointFrom(f){return this.lerp(f)}min(f){return new vc(Math.min(this.x,f.x),Math.min(this.y,f.y))}max(f){return new vc(Math.max(this.x,f.x),Math.max(this.y,f.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(f,ze){return this.x=f,this.y=ze,this}setX(f){return this.x=f,this}setY(f){return this.y=f,this}setFromPoint(f){return this.x=f.x,this.y=f.y,this}swap(f){const ze=this.x,Ke=this.y;this.x=f.x,this.y=f.y,f.x=ze,f.y=Ke}clone(){return new vc(this.x,this.y)}rotate(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:at$1;const Ke=nt$1(f),Qe=rt$1(f),Pi=this.subtract(ze);return new vc(Pi.x*Qe-Pi.y*Ke,Pi.x*Ke+Pi.y*Qe).add(ze)}transform(f){let ze=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new vc(f[0]*this.x+f[2]*this.y+(ze?0:f[4]),f[1]*this.x+f[3]*this.y+(ze?0:f[5]))}};const at$1=new ot$1(0,0),ht$1=qe=>!!qe&&Array.isArray(qe._objects);function ct(qe){class f extends qe{constructor(){super(...arguments),t(this,"_objects",[])}_onObjectAdded(Ke){}_onObjectRemoved(Ke){}_onStackOrderChanged(Ke){}add(){for(var Ke=arguments.length,Qe=new Array(Ke),Pi=0;Pi<Ke;Pi++)Qe[Pi]=arguments[Pi];const nn=this._objects.push(...Qe);return Qe.forEach(ln=>this._onObjectAdded(ln)),nn}insertAt(Ke){for(var Qe=arguments.length,Pi=new Array(Qe>1?Qe-1:0),nn=1;nn<Qe;nn++)Pi[nn-1]=arguments[nn];return this._objects.splice(Ke,0,...Pi),Pi.forEach(ln=>this._onObjectAdded(ln)),this._objects.length}remove(){const Ke=this._objects,Qe=[];for(var Pi=arguments.length,nn=new Array(Pi),ln=0;ln<Pi;ln++)nn[ln]=arguments[ln];return nn.forEach(cn=>{const hn=Ke.indexOf(cn);hn!==-1&&(Ke.splice(hn,1),Qe.push(cn),this._onObjectRemoved(cn))}),Qe}forEachObject(Ke){this.getObjects().forEach((Qe,Pi,nn)=>Ke(Qe,Pi,nn))}getObjects(){for(var Ke=arguments.length,Qe=new Array(Ke),Pi=0;Pi<Ke;Pi++)Qe[Pi]=arguments[Pi];return Qe.length===0?[...this._objects]:this._objects.filter(nn=>nn.isType(...Qe))}item(Ke){return this._objects[Ke]}isEmpty(){return this._objects.length===0}size(){return this._objects.length}contains(Ke,Qe){return!!this._objects.includes(Ke)||!!Qe&&this._objects.some(Pi=>Pi instanceof f&&Pi.contains(Ke,!0))}complexity(){return this._objects.reduce((Ke,Qe)=>Ke+=Qe.complexity?Qe.complexity():0,0)}sendObjectToBack(Ke){return!(!Ke||Ke===this._objects[0])&&(it$1(this._objects,Ke),this._objects.unshift(Ke),this._onStackOrderChanged(Ke),!0)}bringObjectToFront(Ke){return!(!Ke||Ke===this._objects[this._objects.length-1])&&(it$1(this._objects,Ke),this._objects.push(Ke),this._onStackOrderChanged(Ke),!0)}sendObjectBackwards(Ke,Qe){if(!Ke)return!1;const Pi=this._objects.indexOf(Ke);if(Pi!==0){const nn=this.findNewLowerIndex(Ke,Pi,Qe);return it$1(this._objects,Ke),this._objects.splice(nn,0,Ke),this._onStackOrderChanged(Ke),!0}return!1}bringObjectForward(Ke,Qe){if(!Ke)return!1;const Pi=this._objects.indexOf(Ke);if(Pi!==this._objects.length-1){const nn=this.findNewUpperIndex(Ke,Pi,Qe);return it$1(this._objects,Ke),this._objects.splice(nn,0,Ke),this._onStackOrderChanged(Ke),!0}return!1}moveObjectTo(Ke,Qe){return Ke!==this._objects[Qe]&&(it$1(this._objects,Ke),this._objects.splice(Qe,0,Ke),this._onStackOrderChanged(Ke),!0)}findNewLowerIndex(Ke,Qe,Pi){let nn;if(Pi){nn=Qe;for(let ln=Qe-1;ln>=0;--ln)if(Ke.isOverlapping(this._objects[ln])){nn=ln;break}}else nn=Qe-1;return nn}findNewUpperIndex(Ke,Qe,Pi){let nn;if(Pi){nn=Qe;for(let ln=Qe+1;ln<this._objects.length;++ln)if(Ke.isOverlapping(this._objects[ln])){nn=ln;break}}else nn=Qe+1;return nn}collectObjects(Ke){let{left:Qe,top:Pi,width:nn,height:ln}=Ke,{includeIntersecting:cn=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const hn=[],un=new ot$1(Qe,Pi),zn=un.add(new ot$1(nn,ln));for(let Xn=this._objects.length-1;Xn>=0;Xn--){const Un=this._objects[Xn];Un.selectable&&Un.visible&&(cn&&Un.intersectsWithRect(un,zn)||Un.isContainedWithinRect(un,zn)||cn&&Un.containsPoint(un)||cn&&Un.containsPoint(zn))&&hn.push(Un)}return hn}}return f}class lt extends st$1{_setOptions(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};for(const ze in f)this.set(ze,f[ze])}_setObject(f){for(const ze in f)this._set(ze,f[ze])}set(f,ze){return typeof f=="object"?this._setObject(f):this._set(f,ze),this}_set(f,ze){this[f]=ze}toggle(f){const ze=this.get(f);return typeof ze=="boolean"&&this.set(f,!ze),this}get(f){return this[f]}}function ut$1(qe){return v().requestAnimationFrame(qe)}function dt$1(qe){return v().cancelAnimationFrame(qe)}let gt$1=0;const ft$1=()=>gt$1++,pt$1=()=>{const qe=m().createElement("canvas");if(!qe||qe.getContext===void 0)throw new h("Failed to create `canvas` element");return qe},mt$1=()=>m().createElement("img"),vt$1=qe=>{const f=pt$1();return f.width=qe.width,f.height=qe.height,f},yt$1=(qe,f,ze)=>qe.toDataURL("image/".concat(f),ze),_t$1=(qe,f,ze)=>new Promise((Ke,Qe)=>{qe.toBlob(Ke,"image/".concat(f),ze)}),xt$1=qe=>qe*S$1,Ct$1=qe=>qe/S$1,bt$1=qe=>qe.every((f,ze)=>f===T[ze]),wt$1=(qe,f,ze)=>new ot$1(qe).transform(f,ze),St$1=qe=>{const f=1/(qe[0]*qe[3]-qe[1]*qe[2]),ze=[f*qe[3],-f*qe[1],-f*qe[2],f*qe[0],0,0],{x:Ke,y:Qe}=new ot$1(qe[4],qe[5]).transform(ze,!0);return ze[4]=-Ke,ze[5]=-Qe,ze},Tt$1=(qe,f,ze)=>[qe[0]*f[0]+qe[2]*f[1],qe[1]*f[0]+qe[3]*f[1],qe[0]*f[2]+qe[2]*f[3],qe[1]*f[2]+qe[3]*f[3],ze?0:qe[0]*f[4]+qe[2]*f[5]+qe[4],ze?0:qe[1]*f[4]+qe[3]*f[5]+qe[5]],Ot$1=(qe,f)=>qe.reduceRight((ze,Ke)=>Ke&&ze?Tt$1(Ke,ze,f):Ke||ze,void 0)||T.concat(),kt$1=qe=>{let[f,ze]=qe;return Math.atan2(ze,f)},Dt$1=qe=>{const f=kt$1(qe),ze=Math.pow(qe[0],2)+Math.pow(qe[1],2),Ke=Math.sqrt(ze),Qe=(qe[0]*qe[3]-qe[2]*qe[1])/Ke,Pi=Math.atan2(qe[0]*qe[2]+qe[1]*qe[3],ze);return{angle:Ct$1(f),scaleX:Ke,scaleY:Qe,skewX:Ct$1(Pi),skewY:0,translateX:qe[4]||0,translateY:qe[5]||0}},Mt$1=function(qe){return[1,0,0,1,qe,arguments.length>1&&arguments[1]!==void 0?arguments[1]:0]};function Pt$1(){let{angle:qe=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{x:f=0,y:ze=0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const Ke=xt$1(qe),Qe=rt$1(Ke),Pi=nt$1(Ke);return[Qe,Pi,-Pi,Qe,f?f-(Qe*f-Pi*ze):0,ze?ze-(Pi*f+Qe*ze):0]}const Et$1=function(qe){return[qe,0,0,arguments.length>1&&arguments[1]!==void 0?arguments[1]:qe,0,0]},At$1=qe=>Math.tan(xt$1(qe)),jt$1=qe=>[1,0,At$1(qe),1,0,0],Ft$1=qe=>[1,At$1(qe),0,1,0,0],Lt$1=qe=>{let{scaleX:f=1,scaleY:ze=1,flipX:Ke=!1,flipY:Qe=!1,skewX:Pi=0,skewY:nn=0}=qe,ln=Et$1(Ke?-f:f,Qe?-ze:ze);return Pi&&(ln=Tt$1(ln,jt$1(Pi),!0)),nn&&(ln=Tt$1(ln,Ft$1(nn),!0)),ln},Rt$1=qe=>{const{translateX:f=0,translateY:ze=0,angle:Ke=0}=qe;let Qe=Mt$1(f,ze);Ke&&(Qe=Tt$1(Qe,Pt$1({angle:Ke})));const Pi=Lt$1(qe);return bt$1(Pi)||(Qe=Tt$1(Qe,Pi)),Qe},It$1=function(qe){let{signal:f,crossOrigin:ze=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(function(Ke,Qe){if(f&&f.aborted)return Qe(new c("loadImage"));const Pi=mt$1();let nn;f&&(nn=function(cn){Pi.src="",Qe(cn)},f.addEventListener("abort",nn,{once:!0}));const ln=function(){Pi.onload=Pi.onerror=null,nn&&(f==null||f.removeEventListener("abort",nn)),Ke(Pi)};qe?(Pi.onload=ln,Pi.onerror=function(){nn&&(f==null||f.removeEventListener("abort",nn)),Qe(new h("Error loading ".concat(Pi.src)))},ze&&(Pi.crossOrigin=ze),Pi.src=qe):ln()})},Bt$1=function(qe){let{signal:f,reviver:ze=C}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((Ke,Qe)=>{const Pi=[];f&&f.addEventListener("abort",Qe,{once:!0}),Promise.all(qe.map(nn=>tt.getClass(nn.type).fromObject(nn,{signal:f}).then(ln=>(ze(nn,ln),Pi.push(ln),ln)))).then(Ke).catch(nn=>{Pi.forEach(ln=>{ln.dispose&&ln.dispose()}),Qe(nn)}).finally(()=>{f&&f.removeEventListener("abort",Qe)})})},Xt$1=function(qe){let{signal:f}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((ze,Ke)=>{const Qe=[];f&&f.addEventListener("abort",Ke,{once:!0});const Pi=Object.values(qe).map(ln=>ln&&ln.type&&tt.has(ln.type)?Bt$1([ln],{signal:f}).then(cn=>{let[hn]=cn;return Qe.push(hn),hn}):ln),nn=Object.keys(qe);Promise.all(Pi).then(ln=>ln.reduce((cn,hn,un)=>(cn[nn[un]]=hn,cn),{})).then(ze).catch(ln=>{Qe.forEach(cn=>{cn.dispose&&cn.dispose()}),Ke(ln)}).finally(()=>{f&&f.removeEventListener("abort",Ke)})})},Yt$1=function(qe){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:[]).reduce((f,ze)=>(ze in qe&&(f[ze]=qe[ze]),f),{})},Wt$1=(qe,f)=>Object.keys(qe).reduce((ze,Ke)=>(f(qe[Ke],Ke,qe)&&(ze[Ke]=qe[Ke]),ze),{}),Vt$1=(qe,f)=>parseFloat(Number(qe).toFixed(f)),zt$1=qe=>"matrix("+qe.map(f=>Vt$1(f,o.NUM_FRACTION_DIGITS)).join(" ")+")",Gt$1=qe=>!!qe&&qe.toLive!==void 0,Ht$1=qe=>!!qe&&typeof qe.toObject=="function",Nt$1=qe=>!!qe&&qe.offsetX!==void 0&&"source"in qe,Ut$1=qe=>!!qe&&"multiSelectionStacking"in qe;function qt$1(qe){const f=qe&&Kt$1(qe);let ze=0,Ke=0;if(!qe||!f)return{left:ze,top:Ke};let Qe=qe;const Pi=f.documentElement,nn=f.body||{scrollLeft:0,scrollTop:0};for(;Qe&&(Qe.parentNode||Qe.host)&&(Qe=Qe.parentNode||Qe.host,Qe===f?(ze=nn.scrollLeft||Pi.scrollLeft||0,Ke=nn.scrollTop||Pi.scrollTop||0):(ze+=Qe.scrollLeft||0,Ke+=Qe.scrollTop||0),Qe.nodeType!==1||Qe.style.position!=="fixed"););return{left:ze,top:Ke}}const Kt$1=qe=>qe.ownerDocument||null,Jt$1=qe=>{var f;return((f=qe.ownerDocument)===null||f===void 0?void 0:f.defaultView)||null},Qt$1=function(qe,f,ze){let{width:Ke,height:Qe}=ze,Pi=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;qe.width=Ke,qe.height=Qe,Pi>1&&(qe.setAttribute("width",(Ke*Pi).toString()),qe.setAttribute("height",(Qe*Pi).toString()),f.scale(Pi,Pi))},Zt$1=(qe,f)=>{let{width:ze,height:Ke}=f;ze&&(qe.style.width=typeof ze=="number"?"".concat(ze,"px"):ze),Ke&&(qe.style.height=typeof Ke=="number"?"".concat(Ke,"px"):Ke)};function $t$1(qe){return qe.onselectstart!==void 0&&(qe.onselectstart=()=>!1),qe.style.userSelect=j$1,qe}let te$1=class{constructor(f){t(this,"_originalCanvasStyle",void 0),t(this,"lower",void 0);const ze=this.createLowerCanvas(f);this.lower={el:ze,ctx:ze.getContext("2d")}}createLowerCanvas(f){const ze=(Ke=f)&&Ke.getContext!==void 0?f:f&&m().getElementById(f)||pt$1();var Ke;if(ze.hasAttribute("data-fabric"))throw new h("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=ze.style.cssText,ze.setAttribute("data-fabric","main"),ze.classList.add("lower-canvas"),ze}cleanupDOM(f){let{width:ze,height:Ke}=f;const{el:Qe}=this.lower;Qe.classList.remove("lower-canvas"),Qe.removeAttribute("data-fabric"),Qe.setAttribute("width","".concat(ze)),Qe.setAttribute("height","".concat(Ke)),Qe.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(f,ze){const{el:Ke,ctx:Qe}=this.lower;Qt$1(Ke,Qe,f,ze)}setCSSDimensions(f){Zt$1(this.lower.el,f)}calcOffset(){return function(f){var ze;const Ke=f&&Kt$1(f),Qe={left:0,top:0};if(!Ke)return Qe;const Pi=((ze=Jt$1(f))===null||ze===void 0?void 0:ze.getComputedStyle(f,null))||{};Qe.left+=parseInt(Pi.borderLeftWidth,10)||0,Qe.top+=parseInt(Pi.borderTopWidth,10)||0,Qe.left+=parseInt(Pi.paddingLeft,10)||0,Qe.top+=parseInt(Pi.paddingTop,10)||0;let nn={left:0,top:0};const ln=Ke.documentElement;f.getBoundingClientRect!==void 0&&(nn=f.getBoundingClientRect());const cn=qt$1(f);return{left:nn.left+cn.left-(ln.clientLeft||0)+Qe.left,top:nn.top+cn.top-(ln.clientTop||0)+Qe.top}}(this.lower.el)}dispose(){p$1().dispose(this.lower.el),delete this.lower}};const ee$1={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...T]};let se$1=class $c extends ct(lt){get lowerCanvasEl(){var f;return(f=this.elements.lower)===null||f===void 0?void 0:f.el}get contextContainer(){var f;return(f=this.elements.lower)===null||f===void 0?void 0:f.ctx}static getDefaults(){return $c.ownDefaults}constructor(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(ze),this.initElements(f),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(f){this.elements=new te$1(f)}add(){const f=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),f}insertAt(f){for(var ze=arguments.length,Ke=new Array(ze>1?ze-1:0),Qe=1;Qe<ze;Qe++)Ke[Qe-1]=arguments[Qe];const Pi=super.insertAt(f,...Ke);return Ke.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),Pi}remove(){const f=super.remove(...arguments);return f.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),f}_onObjectAdded(f){f.canvas&&f.canvas!==this&&(a("warn",`Canvas is trying to add an object that belongs to a different canvas.
Resulting to default behavior: removing object from previous canvas and adding to new canvas`),f.canvas.remove(f)),f._set("canvas",this),f.setCoords(),this.fire("object:added",{target:f}),f.fire("added",{target:this})}_onObjectRemoved(f){f._set("canvas",void 0),this.fire("object:removed",{target:f}),f.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?y$1():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(f,ze){return this.setDimensions({width:f},ze)}setHeight(f,ze){return this.setDimensions({height:f},ze)}_setDimensionsImpl(f){let{cssOnly:ze=!1,backstoreOnly:Ke=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ze){const Qe=s({width:this.width,height:this.height},f);this.elements.setDimensions(Qe,this.getRetinaScaling()),this.hasLostContext=!0,this.width=Qe.width,this.height=Qe.height}Ke||this.elements.setCSSDimensions(f),this.calcOffset()}setDimensions(f,ze){this._setDimensionsImpl(f,ze),ze&&ze.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(f){this.viewportTransform=f,this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(f,ze){const Ke=f,Qe=[...this.viewportTransform],Pi=wt$1(f,St$1(Qe));Qe[0]=ze,Qe[3]=ze;const nn=wt$1(Pi,Qe);Qe[4]+=Ke.x-nn.x,Qe[5]+=Ke.y-nn.y,this.setViewportTransform(Qe)}setZoom(f){this.zoomToPoint(new ot$1(0,0),f)}absolutePan(f){const ze=[...this.viewportTransform];return ze[4]=-f.x,ze[5]=-f.y,this.setViewportTransform(ze)}relativePan(f){return this.absolutePan(new ot$1(-f.x-this.viewportTransform[4],-f.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(f){f.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=ut$1(()=>this.renderAndReset()))}calcViewportBoundaries(){const f=this.width,ze=this.height,Ke=St$1(this.viewportTransform),Qe=wt$1({x:0,y:0},Ke),Pi=wt$1({x:f,y:ze},Ke),nn=Qe.min(Pi),ln=Qe.max(Pi);return this.vptCoords={tl:nn,tr:new ot$1(ln.x,nn.y),bl:new ot$1(nn.x,ln.y),br:ln}}cancelRequestedRender(){this.nextRenderHandle&&(dt$1(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(f){}renderCanvas(f,ze){if(this.destroyed)return;const Ke=this.viewportTransform,Qe=this.clipPath;this.calcViewportBoundaries(),this.clearContext(f),f.imageSmoothingEnabled=this.imageSmoothingEnabled,f.patternQuality="best",this.fire("before:render",{ctx:f}),this._renderBackground(f),f.save(),f.transform(Ke[0],Ke[1],Ke[2],Ke[3],Ke[4],Ke[5]),this._renderObjects(f,ze),f.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(f),Qe&&(Qe._set("canvas",this),Qe.shouldCache(),Qe._transformDone=!0,Qe.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(f,Qe)),this._renderOverlay(f),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(f),this.fire("after:render",{ctx:f}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(f,ze){const Ke=this.viewportTransform;f.save(),f.transform(...Ke),f.globalCompositeOperation="destination-in",ze.transform(f),f.scale(1/ze.zoomX,1/ze.zoomY),f.drawImage(ze._cacheCanvas,-ze.cacheTranslationX,-ze.cacheTranslationY),f.restore()}_renderObjects(f,ze){for(let Ke=0,Qe=ze.length;Ke<Qe;++Ke)ze[Ke]&&ze[Ke].render(f)}_renderBackgroundOrOverlay(f,ze){const Ke=this["".concat(ze,"Color")],Qe=this["".concat(ze,"Image")],Pi=this.viewportTransform,nn=this["".concat(ze,"Vpt")];if(!Ke&&!Qe)return;const ln=Gt$1(Ke);if(Ke){if(f.save(),f.beginPath(),f.moveTo(0,0),f.lineTo(this.width,0),f.lineTo(this.width,this.height),f.lineTo(0,this.height),f.closePath(),f.fillStyle=ln?Ke.toLive(f):Ke,nn&&f.transform(...Pi),ln){f.transform(1,0,0,1,Ke.offsetX||0,Ke.offsetY||0);const cn=Ke.gradientTransform||Ke.patternTransform;cn&&f.transform(...cn)}f.fill(),f.restore()}if(Qe){f.save();const{skipOffscreen:cn}=this;this.skipOffscreen=nn,nn&&f.transform(...Pi),Qe.render(f),this.skipOffscreen=cn,f.restore()}}_renderBackground(f){this._renderBackgroundOrOverlay(f,"background")}_renderOverlay(f){this._renderBackgroundOrOverlay(f,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new ot$1(this.width/2,this.height/2)}centerObjectH(f){return this._centerObject(f,new ot$1(this.getCenterPoint().x,f.getCenterPoint().y))}centerObjectV(f){return this._centerObject(f,new ot$1(f.getCenterPoint().x,this.getCenterPoint().y))}centerObject(f){return this._centerObject(f,this.getCenterPoint())}viewportCenterObject(f){return this._centerObject(f,this.getVpCenter())}viewportCenterObjectH(f){return this._centerObject(f,new ot$1(this.getVpCenter().x,f.getCenterPoint().y))}viewportCenterObjectV(f){return this._centerObject(f,new ot$1(f.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return wt$1(this.getCenterPoint(),St$1(this.viewportTransform))}_centerObject(f,ze){f.setXY(ze,D$1,D$1),f.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(f){return this.toDatalessObject(f)}toObject(f){return this._toObjectMethod("toObject",f)}toJSON(){return this.toObject()}toDatalessObject(f){return this._toObjectMethod("toDatalessObject",f)}_toObjectMethod(f,ze){const Ke=this.clipPath,Qe=Ke&&!Ke.excludeFromExport?this._toObject(Ke,f,ze):null;return s(s(s({version:x$1},Yt$1(this,ze)),{},{objects:this._objects.filter(Pi=>!Pi.excludeFromExport).map(Pi=>this._toObject(Pi,f,ze))},this.__serializeBgOverlay(f,ze)),Qe?{clipPath:Qe}:null)}_toObject(f,ze,Ke){let Qe;this.includeDefaultValues||(Qe=f.includeDefaultValues,f.includeDefaultValues=!1);const Pi=f[ze](Ke);return this.includeDefaultValues||(f.includeDefaultValues=!!Qe),Pi}__serializeBgOverlay(f,ze){const Ke={},Qe=this.backgroundImage,Pi=this.overlayImage,nn=this.backgroundColor,ln=this.overlayColor;return Gt$1(nn)?nn.excludeFromExport||(Ke.background=nn.toObject(ze)):nn&&(Ke.background=nn),Gt$1(ln)?ln.excludeFromExport||(Ke.overlay=ln.toObject(ze)):ln&&(Ke.overlay=ln),Qe&&!Qe.excludeFromExport&&(Ke.backgroundImage=this._toObject(Qe,f,ze)),Pi&&!Pi.excludeFromExport&&(Ke.overlayImage=this._toObject(Pi,f,ze)),Ke}toSVG(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ze=arguments.length>1?arguments[1]:void 0;f.reviver=ze;const Ke=[];return this._setSVGPreamble(Ke,f),this._setSVGHeader(Ke,f),this.clipPath&&Ke.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,`)" >
`)),this._setSVGBgOverlayColor(Ke,"background"),this._setSVGBgOverlayImage(Ke,"backgroundImage",ze),this._setSVGObjects(Ke,ze),this.clipPath&&Ke.push(`</g>
`),this._setSVGBgOverlayColor(Ke,"overlay"),this._setSVGBgOverlayImage(Ke,"overlayImage",ze),Ke.push("</svg>"),Ke.join("")}_setSVGPreamble(f,ze){ze.suppressPreamble||f.push('<?xml version="1.0" encoding="',ze.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)}_setSVGHeader(f,ze){const Ke=ze.width||"".concat(this.width),Qe=ze.height||"".concat(this.height),Pi=o.NUM_FRACTION_DIGITS,nn=ze.viewBox;let ln;if(nn)ln='viewBox="'.concat(nn.x," ").concat(nn.y," ").concat(nn.width," ").concat(nn.height,'" ');else if(this.svgViewportTransformation){const cn=this.viewportTransform;ln='viewBox="'.concat(Vt$1(-cn[4]/cn[0],Pi)," ").concat(Vt$1(-cn[5]/cn[3],Pi)," ").concat(Vt$1(this.width/cn[0],Pi)," ").concat(Vt$1(this.height/cn[3],Pi),'" ')}else ln='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');f.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',Ke,'" ','height="',Qe,'" ',ln,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",x$1,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(ze),`</defs>
`)}createSVGClipPathMarkup(f){const ze=this.clipPath;return ze?(ze.clipPathId="CLIPPATH_".concat(ft$1()),'<clipPath id="'.concat(ze.clipPathId,`" >
`).concat(ze.toClipPathSVG(f.reviver),`</clipPath>
`)):""}createSVGRefElementsMarkup(){return["background","overlay"].map(f=>{const ze=this["".concat(f,"Color")];if(Gt$1(ze)){const Ke=this["".concat(f,"Vpt")],Qe=this.viewportTransform,Pi={isType:()=>!1,width:this.width/(Ke?Qe[0]:1),height:this.height/(Ke?Qe[3]:1)};return ze.toSVG(Pi,{additionalTransform:Ke?zt$1(Qe):""})}}).join("")}createSVGFontFacesMarkup(){const f=[],ze={},Ke=o.fontPaths;this._objects.forEach(function Pi(nn){f.push(nn),ht$1(nn)&&nn._objects.forEach(Pi)}),f.forEach(Pi=>{if(!(nn=Pi)||typeof nn._renderText!="function")return;var nn;const{styles:ln,fontFamily:cn}=Pi;!ze[cn]&&Ke[cn]&&(ze[cn]=!0,ln&&Object.values(ln).forEach(hn=>{Object.values(hn).forEach(un=>{let{fontFamily:zn=""}=un;!ze[zn]&&Ke[zn]&&(ze[zn]=!0)})}))});const Qe=Object.keys(ze).map(Pi=>`		@font-face {
			font-family: '`.concat(Pi,`';
			src: url('`).concat(Ke[Pi],`');
		}
`)).join("");return Qe?`	<style type="text/css"><![CDATA[
`.concat(Qe,`]]></style>
`):""}_setSVGObjects(f,ze){this.forEachObject(Ke=>{Ke.excludeFromExport||this._setSVGObject(f,Ke,ze)})}_setSVGObject(f,ze,Ke){f.push(ze.toSVG(Ke))}_setSVGBgOverlayImage(f,ze,Ke){const Qe=this[ze];Qe&&!Qe.excludeFromExport&&Qe.toSVG&&f.push(Qe.toSVG(Ke))}_setSVGBgOverlayColor(f,ze){const Ke=this["".concat(ze,"Color")];if(Ke)if(Gt$1(Ke)){const Qe=Ke.repeat||"",Pi=this.width,nn=this.height,ln=this["".concat(ze,"Vpt")]?zt$1(St$1(this.viewportTransform)):"";f.push('<rect transform="'.concat(ln," translate(").concat(Pi/2,",").concat(nn/2,')" x="').concat(Ke.offsetX-Pi/2,'" y="').concat(Ke.offsetY-nn/2,'" width="').concat(Qe!=="repeat-y"&&Qe!=="no-repeat"||!Nt$1(Ke)?Pi:Ke.source.width,'" height="').concat(Qe!=="repeat-x"&&Qe!=="no-repeat"||!Nt$1(Ke)?nn:Ke.source.height,'" fill="url(#SVGID_').concat(Ke.id,`)"></rect>
`))}else f.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',Ke,'"',`></rect>
`)}loadFromJSON(f,ze){let{signal:Ke}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!f)return Promise.reject(new h("`json` is undefined"));const Qe=typeof f=="string"?JSON.parse(f):f,{objects:Pi=[],backgroundImage:nn,background:ln,overlayImage:cn,overlay:hn,clipPath:un}=Qe,zn=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([Bt$1(Pi,{reviver:ze,signal:Ke}),Xt$1({backgroundImage:nn,backgroundColor:ln,overlayImage:cn,overlayColor:hn,clipPath:un},{signal:Ke})]).then(Xn=>{let[Un,qn]=Xn;return this.clear(),this.add(...Un),this.set(Qe),this.set(qn),this.renderOnAddRemove=zn,this})}clone(f){const ze=this.toObject(f);return this.cloneWithoutData().loadFromJSON(ze)}cloneWithoutData(){const f=vt$1(this);return new this.constructor(f)}toDataURL(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:ze="png",quality:Ke=1,multiplier:Qe=1,enableRetinaScaling:Pi=!1}=f,nn=Qe*(Pi?this.getRetinaScaling():1);return yt$1(this.toCanvasElement(nn,f),ze,Ke)}toBlob(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:ze="png",quality:Ke=1,multiplier:Qe=1,enableRetinaScaling:Pi=!1}=f,nn=Qe*(Pi?this.getRetinaScaling():1);return _t$1(this.toCanvasElement(nn,f),ze,Ke)}toCanvasElement(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,{width:ze,height:Ke,left:Qe,top:Pi,filter:nn}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const ln=(ze||this.width)*f,cn=(Ke||this.height)*f,hn=this.getZoom(),un=this.width,zn=this.height,Xn=this.skipControlsDrawing,Un=hn*f,qn=this.viewportTransform,ys=[Un,0,0,Un,(qn[4]-(Qe||0))*f,(qn[5]-(Pi||0))*f],vs=this.enableRetinaScaling,ea=vt$1({width:ln,height:cn}),na=nn?this._objects.filter(ta=>nn(ta)):this._objects;return this.enableRetinaScaling=!1,this.viewportTransform=ys,this.width=ln,this.height=cn,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(ea.getContext("2d"),na),this.viewportTransform=qn,this.width=un,this.height=zn,this.calcViewportBoundaries(),this.enableRetinaScaling=vs,this.skipControlsDrawing=Xn,ea}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),et$1.cancelByCanvas(this),this.disposed=!0,new Promise((f,ze)=>{const Ke=()=>{this.destroy(),f(!0)};Ke.kill=ze,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?f(!1):this.nextRenderHandle?this.__cleanupTask=Ke:Ke()})}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject(f=>f.dispose()),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}};t(se$1,"ownDefaults",ee$1);const ie$1=["touchstart","touchmove","touchend"],re$1=qe=>{const f=qt$1(qe.target),ze=function(Ke){const Qe=Ke.changedTouches;return Qe&&Qe[0]?Qe[0]:Ke}(qe);return new ot$1(ze.clientX+f.left,ze.clientY+f.top)},ne$1=qe=>ie$1.includes(qe.type)||qe.pointerType==="touch",oe$1=qe=>{qe.preventDefault(),qe.stopPropagation()},ae$1=qe=>{let f=0,ze=0,Ke=0,Qe=0;for(let Pi=0,nn=qe.length;Pi<nn;Pi++){const{x:ln,y:cn}=qe[Pi];(ln>Ke||!Pi)&&(Ke=ln),(ln<f||!Pi)&&(f=ln),(cn>Qe||!Pi)&&(Qe=cn),(cn<ze||!Pi)&&(ze=cn)}return{left:f,top:ze,width:Ke-f,height:Qe-ze}},he$1=["translateX","translateY","scaleX","scaleY"],ce$1=(qe,f)=>le$1(qe,Tt$1(f,qe.calcOwnMatrix())),le$1=(qe,f)=>{const ze=Dt$1(f),{translateX:Ke,translateY:Qe,scaleX:Pi,scaleY:nn}=ze,ln=i(ze,he$1),cn=new ot$1(Ke,Qe);qe.flipX=!1,qe.flipY=!1,Object.assign(qe,ln),qe.set({scaleX:Pi,scaleY:nn}),qe.setPositionByOrigin(cn,D$1,D$1)},ue$1=qe=>{qe.scaleX=1,qe.scaleY=1,qe.skewX=0,qe.skewY=0,qe.flipX=!1,qe.flipY=!1,qe.rotate(0)},de$1=qe=>({scaleX:qe.scaleX,scaleY:qe.scaleY,skewX:qe.skewX,skewY:qe.skewY,angle:qe.angle,left:qe.left,flipX:qe.flipX,flipY:qe.flipY,top:qe.top}),ge$1=(qe,f,ze)=>{const Ke=qe/2,Qe=f/2,Pi=[new ot$1(-Ke,-Qe),new ot$1(Ke,-Qe),new ot$1(-Ke,Qe),new ot$1(Ke,Qe)].map(ln=>ln.transform(ze)),nn=ae$1(Pi);return new ot$1(nn.width,nn.height)},fe$1=function(){let qe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:T;return Tt$1(St$1(arguments.length>1&&arguments[1]!==void 0?arguments[1]:T),qe)},pe$1=function(qe){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:T,ze=arguments.length>2&&arguments[2]!==void 0?arguments[2]:T;return qe.transform(fe$1(f,ze))},me$1=function(qe){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:T,ze=arguments.length>2&&arguments[2]!==void 0?arguments[2]:T;return qe.transform(fe$1(f,ze),!0)},ve$1=(qe,f,ze)=>{const Ke=fe$1(f,ze);return le$1(qe,Tt$1(Ke,qe.calcOwnMatrix())),Ke},ye$1=(qe,f)=>{var ze;const{transform:{target:Ke}}=f;(ze=Ke.canvas)===null||ze===void 0||ze.fire("object:".concat(qe),s(s({},f),{},{target:Ke})),Ke.fire(qe,f)},_e={left:-.5,top:-.5,center:0,bottom:.5,right:.5},xe$1=qe=>typeof qe=="string"?_e[qe]:qe-.5,Ce$1="not-allowed";function be$1(qe){return xe$1(qe.originX)===xe$1(D$1)&&xe$1(qe.originY)===xe$1(D$1)}function we$1(qe){return .5-xe$1(qe)}const Se$1=(qe,f)=>qe[f],Te$1=(qe,f,ze,Ke)=>({e:qe,transform:f,pointer:new ot$1(ze,Ke)});function Oe$1(qe,f){const ze=qe.getTotalAngle()+Ct$1(Math.atan2(f.y,f.x))+360;return Math.round(ze%360/45)}function ke$1(qe,f,ze,Ke,Qe){var Pi;let{target:nn,corner:ln}=qe;const cn=nn.controls[ln],hn=((Pi=nn.canvas)===null||Pi===void 0?void 0:Pi.getZoom())||1,un=nn.padding/hn,zn=function(Xn,Un,qn,ys){const vs=Xn.getRelativeCenterPoint(),ea=qn!==void 0&&ys!==void 0?Xn.translateToGivenOrigin(vs,D$1,D$1,qn,ys):new ot$1(Xn.left,Xn.top);return(Xn.angle?Un.rotate(-xt$1(Xn.angle),vs):Un).subtract(ea)}(nn,new ot$1(Ke,Qe),f,ze);return zn.x>=un&&(zn.x-=un),zn.x<=-un&&(zn.x+=un),zn.y>=un&&(zn.y-=un),zn.y<=un&&(zn.y+=un),zn.x-=cn.offsetX,zn.y-=cn.offsetY,zn}const De$1=(qe,f,ze,Ke)=>{const{target:Qe,offsetX:Pi,offsetY:nn}=f,ln=ze-Pi,cn=Ke-nn,hn=!Se$1(Qe,"lockMovementX")&&Qe.left!==ln,un=!Se$1(Qe,"lockMovementY")&&Qe.top!==cn;return hn&&Qe.set(M$1,ln),un&&Qe.set(P,cn),(hn||un)&&ye$1(L,Te$1(qe,f,ze,Ke)),hn||un},Me$1={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},Pe$1=(qe,f,ze)=>(ze<0&&(ze+=1),ze>1&&(ze-=1),ze<1/6?qe+6*(f-qe)*ze:ze<.5?f:ze<2/3?qe+(f-qe)*(2/3-ze)*6:qe),Ee$1=(qe,f,ze,Ke)=>{qe/=255,f/=255,ze/=255;const Qe=Math.max(qe,f,ze),Pi=Math.min(qe,f,ze);let nn,ln;const cn=(Qe+Pi)/2;if(Qe===Pi)nn=ln=0;else{const hn=Qe-Pi;switch(ln=cn>.5?hn/(2-Qe-Pi):hn/(Qe+Pi),Qe){case qe:nn=(f-ze)/hn+(f<ze?6:0);break;case f:nn=(ze-qe)/hn+2;break;case ze:nn=(qe-f)/hn+4}nn/=6}return[Math.round(360*nn),Math.round(100*ln),Math.round(100*cn),Ke]},Ae$1=function(){let qe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"1";return parseFloat(qe)/(qe.endsWith("%")?100:1)},je=qe=>Math.min(Math.round(qe),255).toString(16).toUpperCase().padStart(2,"0"),Fe$1=qe=>{let[f,ze,Ke,Qe=1]=qe;const Pi=Math.round(.3*f+.59*ze+.11*Ke);return[Pi,Pi,Pi,Qe]};let Le$1=class wc{constructor(f){if(t(this,"isUnrecognised",!1),f)if(f instanceof wc)this.setSource([...f._source]);else if(Array.isArray(f)){const[ze,Ke,Qe,Pi=1]=f;this.setSource([ze,Ke,Qe,Pi])}else this.setSource(this._tryParsingColor(f));else this.setSource([0,0,0,1])}_tryParsingColor(f){return(f=f.toLowerCase())in Me$1&&(f=Me$1[f]),f==="transparent"?[255,255,255,0]:wc.sourceFromHex(f)||wc.sourceFromRgb(f)||wc.sourceFromHsl(f)||(this.isUnrecognised=!0)&&[0,0,0,1]}getSource(){return this._source}setSource(f){this._source=f}toRgb(){const[f,ze,Ke]=this.getSource();return"rgb(".concat(f,",").concat(ze,",").concat(Ke,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){const[f,ze,Ke]=Ee$1(...this.getSource());return"hsl(".concat(f,",").concat(ze,"%,").concat(Ke,"%)")}toHsla(){const[f,ze,Ke,Qe]=Ee$1(...this.getSource());return"hsla(".concat(f,",").concat(ze,"%,").concat(Ke,"%,").concat(Qe,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){const[f,ze,Ke,Qe]=this.getSource();return"".concat(je(f)).concat(je(ze)).concat(je(Ke)).concat(je(Math.round(255*Qe)))}getAlpha(){return this.getSource()[3]}setAlpha(f){return this._source[3]=f,this}toGrayscale(){return this.setSource(Fe$1(this.getSource())),this}toBlackWhite(f){const[ze,,,Ke]=Fe$1(this.getSource()),Qe=ze<(f||127)?0:255;return this.setSource([Qe,Qe,Qe,Ke]),this}overlayWith(f){f instanceof wc||(f=new wc(f));const ze=this.getSource(),Ke=f.getSource(),[Qe,Pi,nn]=ze.map((ln,cn)=>Math.round(.5*ln+.5*Ke[cn]));return this.setSource([Qe,Pi,nn,ze[3]]),this}static fromRgb(f){return wc.fromRgba(f)}static fromRgba(f){return new wc(wc.sourceFromRgb(f))}static sourceFromRgb(f){const ze=f.match(/^rgba?\(\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d{0,3}(?:\.\d+)?%?)\s*)?\)$/i);if(ze){const[Ke,Qe,Pi]=ze.slice(1,4).map(nn=>{const ln=parseFloat(nn);return nn.endsWith("%")?Math.round(2.55*ln):ln});return[Ke,Qe,Pi,Ae$1(ze[4])]}}static fromHsl(f){return wc.fromHsla(f)}static fromHsla(f){return new wc(wc.sourceFromHsl(f))}static sourceFromHsl(f){const ze=f.match(/^hsla?\(\s*([+-]?\d{0,3}(?:\.\d+)?(?:deg|turn|rad)?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d*(?:\.\d+)?%?)\s*)?\)$/i);if(!ze)return;const Ke=(wc.parseAngletoDegrees(ze[1])%360+360)%360/360,Qe=parseFloat(ze[2])/100,Pi=parseFloat(ze[3])/100;let nn,ln,cn;if(Qe===0)nn=ln=cn=Pi;else{const hn=Pi<=.5?Pi*(Qe+1):Pi+Qe-Pi*Qe,un=2*Pi-hn;nn=Pe$1(un,hn,Ke+1/3),ln=Pe$1(un,hn,Ke),cn=Pe$1(un,hn,Ke-1/3)}return[Math.round(255*nn),Math.round(255*ln),Math.round(255*cn),Ae$1(ze[4])]}static fromHex(f){return new wc(wc.sourceFromHex(f))}static sourceFromHex(f){if(f.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){const ze=f.slice(f.indexOf("#")+1);let Ke;Ke=ze.length<=4?ze.split("").map(cn=>cn+cn):ze.match(/.{2}/g);const[Qe,Pi,nn,ln=255]=Ke.map(cn=>parseInt(cn,16));return[Qe,Pi,nn,ln/255]}}static parseAngletoDegrees(f){const ze=f.toLowerCase(),Ke=parseFloat(ze);return ze.includes("rad")?Ct$1(Ke):ze.includes("turn")?360*Ke:Ke}};const Re$1=function(qe){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:O$1;const ze=/\D{0,2}$/.exec(qe),Ke=parseFloat(qe),Qe=o.DPI;switch(ze==null?void 0:ze[0]){case"mm":return Ke*Qe/25.4;case"cm":return Ke*Qe/2.54;case"in":return Ke*Qe;case"pt":return Ke*Qe/72;case"pc":return Ke*Qe/72*12;case"em":return Ke*f;default:return Ke}},Ie$1=qe=>{const[f,ze]=qe.trim().split(" "),[Ke,Qe]=(Pi=f)&&Pi!==j$1?[Pi.slice(1,4),Pi.slice(5,8)]:Pi===j$1?[Pi,Pi]:["Mid","Mid"];var Pi;return{meetOrSlice:ze||"meet",alignX:Ke,alignY:Qe}},Be$1=function(qe,f){let ze,Ke,Qe=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];if(f)if(f.toLive)ze="url(#SVGID_".concat(f.id,")");else{const Pi=new Le$1(f),nn=Pi.getAlpha();ze=Pi.toRgb(),nn!==1&&(Ke=nn.toString())}else ze="none";return Qe?"".concat(qe,": ").concat(ze,"; ").concat(Ke?"".concat(qe,"-opacity: ").concat(Ke,"; "):""):"".concat(qe,'="').concat(ze,'" ').concat(Ke?"".concat(qe,'-opacity="').concat(Ke,'" '):"")};class Xe{getSvgStyles(f){const ze=this.fillRule?this.fillRule:"nonzero",Ke=this.strokeWidth?this.strokeWidth:"0",Qe=this.strokeDashArray?this.strokeDashArray.join(" "):j$1,Pi=this.strokeDashOffset?this.strokeDashOffset:"0",nn=this.strokeLineCap?this.strokeLineCap:"butt",ln=this.strokeLineJoin?this.strokeLineJoin:"miter",cn=this.strokeMiterLimit?this.strokeMiterLimit:"4",hn=this.opacity!==void 0?this.opacity:"1",un=this.visible?"":" visibility: hidden;",zn=f?"":this.getSvgFilter(),Xn=Be$1(K$1,this.fill);return[Be$1(J,this.stroke),"stroke-width: ",Ke,"; ","stroke-dasharray: ",Qe,"; ","stroke-linecap: ",nn,"; ","stroke-dashoffset: ",Pi,"; ","stroke-linejoin: ",ln,"; ","stroke-miterlimit: ",cn,"; ",Xn,"fill-rule: ",ze,"; ","opacity: ",hn,";",zn,un].join("")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const Ke=f?this.calcTransformMatrix():this.calcOwnMatrix(),Qe='transform="'.concat(zt$1(Ke));return"".concat(Qe).concat(ze,'" ')}_toSVG(f){return[""]}toSVG(f){return this._createBaseSVGMarkup(this._toSVG(f),{reviver:f})}toClipPathSVG(f){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(f),{reviver:f})}_createBaseClipPathSVGMarkup(f){let{reviver:ze,additionalTransform:Ke=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const Qe=[this.getSvgTransform(!0,Ke),this.getSvgCommons()].join(""),Pi=f.indexOf("COMMON_PARTS");return f[Pi]=Qe,ze?ze(f.join("")):f.join("")}_createBaseSVGMarkup(f){let{noStyle:ze,reviver:Ke,withShadow:Qe,additionalTransform:Pi}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const nn=ze?"":'style="'.concat(this.getSvgStyles(),'" '),ln=Qe?'style="'.concat(this.getSvgFilter(),'" '):"",cn=this.clipPath,hn=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",un=cn&&cn.absolutePositioned,zn=this.stroke,Xn=this.fill,Un=this.shadow,qn=[],ys=f.indexOf("COMMON_PARTS");let vs;cn&&(cn.clipPathId="CLIPPATH_".concat(ft$1()),vs='<clipPath id="'.concat(cn.clipPathId,`" >
`).concat(cn.toClipPathSVG(Ke),`</clipPath>
`)),un&&qn.push("<g ",ln,this.getSvgCommons(),` >
`),qn.push("<g ",this.getSvgTransform(!1),un?"":ln+this.getSvgCommons(),` >
`);const ea=[nn,hn,ze?"":this.addPaintOrder()," ",Pi?'transform="'.concat(Pi,'" '):""].join("");return f[ys]=ea,Gt$1(Xn)&&qn.push(Xn.toSVG(this)),Gt$1(zn)&&qn.push(zn.toSVG(this)),Un&&qn.push(Un.toSVG(this)),cn&&qn.push(vs),qn.push(f.join("")),qn.push(`</g>
`),un&&qn.push(`</g>
`),Ke?Ke(qn.join("")):qn.join("")}addPaintOrder(){return this.paintFirst!==K$1?' paint-order="'.concat(this.paintFirst,'" '):""}}function Ye(qe){return new RegExp("^("+qe.join("|")+")\\b","i")}var We;const Ve$1=String.raw(We||(We=r(["(?:[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?)"],["(?:[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?)"]))),Ge=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+Ve$1+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+Ve$1+"))?\\s+(.*)"),He$1={cx:M$1,x:M$1,r:"radius",cy:P,y:P,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},Ne$1="font-size",Ue="clip-path";Ye(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]);Ye(["symbol","image","marker","pattern","view","svg"]);const Je=Ye(["symbol","g","a","svg","clipPath","defs"]),Ze=new ot$1(1,0),$e=new ot$1,ts=(qe,f)=>qe.rotate(f),es=(qe,f)=>new ot$1(f).subtract(qe),ss=qe=>qe.distanceFrom($e),is=(qe,f)=>Math.atan2(as(qe,f),hs(qe,f)),rs=qe=>is(Ze,qe),ns=qe=>qe.eq($e)?qe:qe.scalarDivide(ss(qe)),os=function(qe){let f=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return ns(new ot$1(-qe.y,qe.x).scalarMultiply(f?1:-1))},as=(qe,f)=>qe.x*f.y-qe.y*f.x,hs=(qe,f)=>qe.x*f.x+qe.y*f.y,cs=(qe,f,ze)=>{if(qe.eq(f)||qe.eq(ze))return!0;const Ke=as(f,ze),Qe=as(f,qe),Pi=as(ze,qe);return Ke>=0?Qe>=0&&Pi<=0:!(Qe<=0&&Pi>=0)},ls="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",us=new RegExp("(?:\\s|^)"+ls+ls+"("+Ve$1+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class ds{constructor(f){const ze=typeof f=="string"?ds.parseShadow(f):f;Object.assign(this,ds.ownDefaults,ze),this.id=ft$1()}static parseShadow(f){const ze=f.trim(),[,Ke=0,Qe=0,Pi=0]=(us.exec(ze)||[]).map(nn=>parseFloat(nn)||0);return{color:(ze.replace(us,"")||"rgb(0,0,0)").trim(),offsetX:Ke,offsetY:Qe,blur:Pi}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(f){const ze=ts(new ot$1(this.offsetX,this.offsetY),xt$1(-f.angle)),Ke=new Le$1(this.color);let Qe=40,Pi=40;return f.width&&f.height&&(Qe=100*Vt$1((Math.abs(ze.x)+this.blur)/f.width,o.NUM_FRACTION_DIGITS)+20,Pi=100*Vt$1((Math.abs(ze.y)+this.blur)/f.height,o.NUM_FRACTION_DIGITS)+20),f.flipX&&(ze.x*=-1),f.flipY&&(ze.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(Pi,'%" height="').concat(100+2*Pi,'%" x="-').concat(Qe,'%" width="').concat(100+2*Qe,`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`).concat(Vt$1(this.blur?this.blur/2:0,o.NUM_FRACTION_DIGITS),`"></feGaussianBlur>
	<feOffset dx="`).concat(Vt$1(ze.x,o.NUM_FRACTION_DIGITS),'" dy="').concat(Vt$1(ze.y,o.NUM_FRACTION_DIGITS),`" result="oBlur" ></feOffset>
	<feFlood flood-color="`).concat(Ke.toRgb(),'" flood-opacity="').concat(Ke.getAlpha(),`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`)}toObject(){const f={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},ze=ds.ownDefaults;return this.includeDefaultValues?f:Wt$1(f,(Ke,Qe)=>Ke!==ze[Qe])}static async fromObject(f){return new this(f)}}t(ds,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),t(ds,"type","shadow"),tt.setClass(ds,"shadow");const gs=(qe,f,ze)=>Math.max(qe,Math.min(f,ze)),fs=[P,M$1,H,N$1,"flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible",U,q],ps=[K$1,J,"strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],ms={top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:M$1,originY:P,strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:K$1,fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0},_s=(qe,f,ze,Ke)=>-ze*Math.cos(qe/Ke*b)+ze+f,ws=()=>!1;class Ss{constructor(f){let{startValue:ze,byValue:Ke,duration:Qe=500,delay:Pi=0,easing:nn=_s,onStart:ln=C,onChange:cn=C,onComplete:hn=C,abort:un=ws,target:zn}=f;t(this,"_state","pending"),t(this,"durationProgress",0),t(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=Qe,this.delay=Pi,this.easing=nn,this._onStart=ln,this._onChange=cn,this._onComplete=hn,this._abort=un,this.target=zn,this.startValue=ze,this.byValue=Ke,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return this._state==="aborted"||this._state==="completed"}start(){const f=ze=>{this._state==="pending"&&(this.startTime=ze||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout(()=>ut$1(f),this.delay):ut$1(f)}tick(f){const ze=(f||+new Date)-this.startTime,Ke=Math.min(ze,this.duration);this.durationProgress=Ke/this.duration;const{value:Qe,valueProgress:Pi}=this.calculate(Ke);this.value=Object.freeze(Qe),this.valueProgress=Pi,this._state!=="aborted"&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):ze>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),ut$1(this.tick)))}register(){et$1.push(this)}unregister(){et$1.remove(this)}abort(){this._state="aborted",this.unregister()}}const Ts=["startValue","endValue"];class Os extends Ss{constructor(f){let{startValue:ze=0,endValue:Ke=100}=f;super(s(s({},i(f,Ts)),{},{startValue:ze,byValue:Ke-ze}))}calculate(f){const ze=this.easing(f,this.startValue,this.byValue,this.duration);return{value:ze,valueProgress:Math.abs((ze-this.startValue)/this.byValue)}}}const ks=["startValue","endValue"];class Ds extends Ss{constructor(f){let{startValue:ze=[0],endValue:Ke=[100]}=f;super(s(s({},i(f,ks)),{},{startValue:ze,byValue:Ke.map((Qe,Pi)=>Qe-ze[Pi])}))}calculate(f){const ze=this.startValue.map((Ke,Qe)=>this.easing(f,Ke,this.byValue[Qe],this.duration,Qe));return{value:ze,valueProgress:Math.abs((ze[0]-this.startValue[0])/this.byValue[0])}}}const Ms=["startValue","endValue","easing","onChange","onComplete","abort"],Ps=(qe,f,ze,Ke)=>f+ze*(1-Math.cos(qe/Ke*b)),Es=qe=>qe&&((f,ze,Ke)=>qe(new Le$1(f).toRgba(),ze,Ke));class As extends Ss{constructor(f){let{startValue:ze,endValue:Ke,easing:Qe=Ps,onChange:Pi,onComplete:nn,abort:ln}=f,cn=i(f,Ms);const hn=new Le$1(ze).getSource(),un=new Le$1(Ke).getSource();super(s(s({},cn),{},{startValue:hn,byValue:un.map((zn,Xn)=>zn-hn[Xn]),easing:Qe,onChange:Es(Pi),onComplete:Es(nn),abort:Es(ln)}))}calculate(f){const[ze,Ke,Qe,Pi]=this.startValue.map((ln,cn)=>this.easing(f,ln,this.byValue[cn],this.duration,cn)),nn=[...[ze,Ke,Qe].map(Math.round),gs(0,Pi,1)];return{value:nn,valueProgress:nn.map((ln,cn)=>this.byValue[cn]!==0?Math.abs((ln-this.startValue[cn])/this.byValue[cn]):0).find(ln=>ln!==0)||0}}}function js(qe){const f=(ze=>Array.isArray(ze.startValue)||Array.isArray(ze.endValue))(qe)?new Ds(qe):new Os(qe);return f.start(),f}function Fs(qe){const f=new As(qe);return f.start(),f}class Ls{constructor(f){this.status=f,this.points=[]}includes(f){return this.points.some(ze=>ze.eq(f))}append(){for(var f=arguments.length,ze=new Array(f),Ke=0;Ke<f;Ke++)ze[Ke]=arguments[Ke];return this.points=this.points.concat(ze.filter(Qe=>!this.includes(Qe))),this}static isPointContained(f,ze,Ke){let Qe=arguments.length>3&&arguments[3]!==void 0&&arguments[3];if(ze.eq(Ke))return f.eq(ze);if(ze.x===Ke.x)return f.x===ze.x&&(Qe||f.y>=Math.min(ze.y,Ke.y)&&f.y<=Math.max(ze.y,Ke.y));if(ze.y===Ke.y)return f.y===ze.y&&(Qe||f.x>=Math.min(ze.x,Ke.x)&&f.x<=Math.max(ze.x,Ke.x));{const Pi=es(ze,Ke),nn=es(ze,f).divide(Pi);return Qe?Math.abs(nn.x)===Math.abs(nn.y):nn.x===nn.y&&nn.x>=0&&nn.x<=1}}static isPointInPolygon(f,ze){const Ke=new ot$1(f).setX(Math.min(f.x-1,...ze.map(Pi=>Pi.x)));let Qe=0;for(let Pi=0;Pi<ze.length;Pi++){const nn=this.intersectSegmentSegment(ze[Pi],ze[(Pi+1)%ze.length],f,Ke);if(nn.includes(f))return!0;Qe+=+(nn.status==="Intersection")}return Qe%2==1}static intersectLineLine(f,ze,Ke,Qe){let Pi=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4],nn=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5];const ln=ze.x-f.x,cn=ze.y-f.y,hn=Qe.x-Ke.x,un=Qe.y-Ke.y,zn=f.x-Ke.x,Xn=f.y-Ke.y,Un=hn*Xn-un*zn,qn=ln*Xn-cn*zn,ys=un*ln-hn*cn;if(ys!==0){const vs=Un/ys,ea=qn/ys;return(Pi||0<=vs&&vs<=1)&&(nn||0<=ea&&ea<=1)?new Ls("Intersection").append(new ot$1(f.x+vs*ln,f.y+vs*cn)):new Ls}if(Un===0||qn===0){const vs=Pi||nn||Ls.isPointContained(f,Ke,Qe)||Ls.isPointContained(ze,Ke,Qe)||Ls.isPointContained(Ke,f,ze)||Ls.isPointContained(Qe,f,ze);return new Ls(vs?"Coincident":void 0)}return new Ls("Parallel")}static intersectSegmentLine(f,ze,Ke,Qe){return Ls.intersectLineLine(f,ze,Ke,Qe,!1,!0)}static intersectSegmentSegment(f,ze,Ke,Qe){return Ls.intersectLineLine(f,ze,Ke,Qe,!1,!1)}static intersectLinePolygon(f,ze,Ke){let Qe=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];const Pi=new Ls,nn=Ke.length;for(let ln,cn,hn,un=0;un<nn;un++){if(ln=Ke[un],cn=Ke[(un+1)%nn],hn=Ls.intersectLineLine(f,ze,ln,cn,Qe,!1),hn.status==="Coincident")return hn;Pi.append(...hn.points)}return Pi.points.length>0&&(Pi.status="Intersection"),Pi}static intersectSegmentPolygon(f,ze,Ke){return Ls.intersectLinePolygon(f,ze,Ke,!1)}static intersectPolygonPolygon(f,ze){const Ke=new Ls,Qe=f.length,Pi=[];for(let nn=0;nn<Qe;nn++){const ln=f[nn],cn=f[(nn+1)%Qe],hn=Ls.intersectSegmentPolygon(ln,cn,ze);hn.status==="Coincident"?(Pi.push(hn),Ke.append(ln,cn)):Ke.append(...hn.points)}return Pi.length>0&&Pi.length===f.length?new Ls("Coincident"):(Ke.points.length>0&&(Ke.status="Intersection"),Ke)}static intersectPolygonRectangle(f,ze,Ke){const Qe=ze.min(Ke),Pi=ze.max(Ke),nn=new ot$1(Pi.x,Qe.y),ln=new ot$1(Qe.x,Pi.y);return Ls.intersectPolygonPolygon(f,[Qe,nn,Pi,ln])}}class Rs extends lt{getX(){return this.getXY().x}setX(f){this.setXY(this.getXY().setX(f))}getY(){return this.getXY().y}setY(f){this.setXY(this.getXY().setY(f))}getRelativeX(){return this.left}setRelativeX(f){this.left=f}getRelativeY(){return this.top}setRelativeY(f){this.top=f}getXY(){const f=this.getRelativeXY();return this.group?wt$1(f,this.group.calcTransformMatrix()):f}setXY(f,ze,Ke){this.group&&(f=wt$1(f,St$1(this.group.calcTransformMatrix()))),this.setRelativeXY(f,ze,Ke)}getRelativeXY(){return new ot$1(this.left,this.top)}setRelativeXY(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.originX,Ke=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.originY;this.setPositionByOrigin(f,ze,Ke)}isStrokeAccountedForInDimensions(){return!1}getCoords(){const{tl:f,tr:ze,br:Ke,bl:Qe}=this.aCoords||(this.aCoords=this.calcACoords()),Pi=[f,ze,Ke,Qe];if(this.group){const nn=this.group.calcTransformMatrix();return Pi.map(ln=>wt$1(ln,nn))}return Pi}intersectsWithRect(f,ze){return Ls.intersectPolygonRectangle(this.getCoords(),f,ze).status==="Intersection"}intersectsWithObject(f){const ze=Ls.intersectPolygonPolygon(this.getCoords(),f.getCoords());return ze.status==="Intersection"||ze.status==="Coincident"||f.isContainedWithinObject(this)||this.isContainedWithinObject(f)}isContainedWithinObject(f){return this.getCoords().every(ze=>f.containsPoint(ze))}isContainedWithinRect(f,ze){const{left:Ke,top:Qe,width:Pi,height:nn}=this.getBoundingRect();return Ke>=f.x&&Ke+Pi<=ze.x&&Qe>=f.y&&Qe+nn<=ze.y}isOverlapping(f){return this.intersectsWithObject(f)||this.isContainedWithinObject(f)||f.isContainedWithinObject(this)}containsPoint(f){return Ls.isPointInPolygon(f,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;const{tl:f,br:ze}=this.canvas.vptCoords;return!!this.getCoords().some(Ke=>Ke.x<=ze.x&&Ke.x>=f.x&&Ke.y<=ze.y&&Ke.y>=f.y)||!!this.intersectsWithRect(f,ze)||this.containsPoint(f.midPointFrom(ze))}isPartiallyOnScreen(){if(!this.canvas)return!1;const{tl:f,br:ze}=this.canvas.vptCoords;return this.intersectsWithRect(f,ze)?!0:this.getCoords().every(Ke=>(Ke.x>=ze.x||Ke.x<=f.x)&&(Ke.y>=ze.y||Ke.y<=f.y))&&this.containsPoint(f.midPointFrom(ze))}getBoundingRect(){return ae$1(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(f){this._set(H,f),this._set(N$1,f),this.setCoords()}scaleToWidth(f){const ze=this.getBoundingRect().width/this.getScaledWidth();return this.scale(f/this.width/ze)}scaleToHeight(f){const ze=this.getBoundingRect().height/this.getScaledHeight();return this.scale(f/this.height/ze)}getCanvasRetinaScaling(){var f;return((f=this.canvas)===null||f===void 0?void 0:f.getRetinaScaling())||1}getTotalAngle(){return this.group?Ct$1(kt$1(this.calcTransformMatrix())):this.angle}getViewportTransform(){var f;return((f=this.canvas)===null||f===void 0?void 0:f.viewportTransform)||T.concat()}calcACoords(){const f=Pt$1({angle:this.angle}),{x:ze,y:Ke}=this.getRelativeCenterPoint(),Qe=Mt$1(ze,Ke),Pi=Tt$1(Qe,f),nn=this._getTransformedDimensions(),ln=nn.x/2,cn=nn.y/2;return{tl:wt$1({x:-ln,y:-cn},Pi),tr:wt$1({x:ln,y:-cn},Pi),bl:wt$1({x:-ln,y:cn},Pi),br:wt$1({x:ln,y:cn},Pi)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let f=arguments.length>0&&arguments[0]!==void 0&&arguments[0],ze=[];return!f&&this.group&&(ze=this.group.transformMatrixKey(f)),ze.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,xe$1(this.originX),xe$1(this.originY)),ze}calcTransformMatrix(){let f=arguments.length>0&&arguments[0]!==void 0&&arguments[0],ze=this.calcOwnMatrix();if(f||!this.group)return ze;const Ke=this.transformMatrixKey(f),Qe=this.matrixCache;return Qe&&Qe.key.every((Pi,nn)=>Pi===Ke[nn])?Qe.value:(this.group&&(ze=Tt$1(this.group.calcTransformMatrix(!1),ze)),this.matrixCache={key:Ke,value:ze},ze)}calcOwnMatrix(){const f=this.transformMatrixKey(!0),ze=this.ownMatrixCache;if(ze&&ze.key===f)return ze.value;const Ke=this.getRelativeCenterPoint(),Qe={angle:this.angle,translateX:Ke.x,translateY:Ke.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},Pi=Rt$1(Qe);return this.ownMatrixCache={key:f,value:Pi},Pi}_getNonTransformedDimensions(){return new ot$1(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(f){return this._getTransformedDimensions(f).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}_getTransformedDimensions(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const ze=s({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},f),Ke=ze.strokeWidth;let Qe=Ke,Pi=0;this.strokeUniform&&(Qe=0,Pi=Ke);const nn=ze.width+Qe,ln=ze.height+Qe;let cn;return cn=ze.skewX===0&&ze.skewY===0?new ot$1(nn*ze.scaleX,ln*ze.scaleY):ge$1(nn,ln,Lt$1(ze)),cn.scalarAdd(Pi)}translateToGivenOrigin(f,ze,Ke,Qe,Pi){let nn=f.x,ln=f.y;const cn=xe$1(Qe)-xe$1(ze),hn=xe$1(Pi)-xe$1(Ke);if(cn||hn){const un=this._getTransformedDimensions();nn+=cn*un.x,ln+=hn*un.y}return new ot$1(nn,ln)}translateToCenterPoint(f,ze,Ke){if(ze===D$1&&Ke===D$1)return f;const Qe=this.translateToGivenOrigin(f,ze,Ke,D$1,D$1);return this.angle?Qe.rotate(xt$1(this.angle),f):Qe}translateToOriginPoint(f,ze,Ke){const Qe=this.translateToGivenOrigin(f,D$1,D$1,ze,Ke);return this.angle?Qe.rotate(xt$1(this.angle),f):Qe}getCenterPoint(){const f=this.getRelativeCenterPoint();return this.group?wt$1(f,this.group.calcTransformMatrix()):f}getRelativeCenterPoint(){return this.translateToCenterPoint(new ot$1(this.left,this.top),this.originX,this.originY)}getPointByOrigin(f,ze){return this.translateToOriginPoint(this.getRelativeCenterPoint(),f,ze)}setPositionByOrigin(f,ze,Ke){const Qe=this.translateToCenterPoint(f,ze,Ke),Pi=this.translateToOriginPoint(Qe,this.originX,this.originY);this.set({left:Pi.x,top:Pi.y})}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),M$1,P)}}const Is=["type"],Bs=["extraParam"];let Xs=class Rc extends Rs{static getDefaults(){return Rc.ownDefaults}get type(){const f=this.constructor.type;return f==="FabricObject"?"object":f.toLowerCase()}set type(f){a("warn","Setting type has no effect",f)}constructor(f){super(),t(this,"_cacheContext",null),Object.assign(this,Rc.ownDefaults),this.setOptions(f)}_createCacheCanvas(){this._cacheCanvas=pt$1(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(f){const ze=f.width,Ke=f.height,Qe=o.maxCacheSideLimit,Pi=o.minCacheSideLimit;if(ze<=Qe&&Ke<=Qe&&ze*Ke<=o.perfLimitSizeTotal)return ze<Pi&&(f.width=Pi),Ke<Pi&&(f.height=Pi),f;const nn=ze/Ke,[ln,cn]=_.limitDimsByArea(nn),hn=gs(Pi,ln,Qe),un=gs(Pi,cn,Qe);return ze>hn&&(f.zoomX/=ze/hn,f.width=hn,f.capped=!0),Ke>un&&(f.zoomY/=Ke/un,f.height=un,f.capped=!0),f}_getCacheCanvasDimensions(){const f=this.getTotalObjectScaling(),ze=this._getTransformedDimensions({skewX:0,skewY:0}),Ke=ze.x*f.x/this.scaleX,Qe=ze.y*f.y/this.scaleY;return{width:Math.ceil(Ke+2),height:Math.ceil(Qe+2),zoomX:f.x,zoomY:f.y,x:Ke,y:Qe}}_updateCacheCanvas(){const f=this._cacheCanvas,ze=this._cacheContext,{width:Ke,height:Qe,zoomX:Pi,zoomY:nn,x:ln,y:cn}=this._limitCacheSize(this._getCacheCanvasDimensions()),hn=Ke!==f.width||Qe!==f.height,un=this.zoomX!==Pi||this.zoomY!==nn;if(!f||!ze)return!1;if(hn||un){Ke!==f.width||Qe!==f.height?(f.width=Ke,f.height=Qe):(ze.setTransform(1,0,0,1,0,0),ze.clearRect(0,0,f.width,f.height));const zn=ln/2,Xn=cn/2;return this.cacheTranslationX=Math.round(f.width/2-zn)+zn,this.cacheTranslationY=Math.round(f.height/2-Xn)+Xn,ze.translate(this.cacheTranslationX,this.cacheTranslationY),ze.scale(Pi,nn),this.zoomX=Pi,this.zoomY=nn,!0}return!1}setOptions(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setOptions(f)}transform(f){const ze=this.group&&!this.group._transformDone||this.group&&this.canvas&&f===this.canvas.contextTop,Ke=this.calcTransformMatrix(!ze);f.transform(Ke[0],Ke[1],Ke[2],Ke[3],Ke[4],Ke[5])}getObjectScaling(){if(!this.group)return new ot$1(Math.abs(this.scaleX),Math.abs(this.scaleY));const f=Dt$1(this.calcTransformMatrix());return new ot$1(Math.abs(f.scaleX),Math.abs(f.scaleY))}getTotalObjectScaling(){const f=this.getObjectScaling();if(this.canvas){const ze=this.canvas.getZoom(),Ke=this.getCanvasRetinaScaling();return f.scalarMultiply(ze*Ke)}return f}getObjectOpacity(){let f=this.opacity;return this.group&&(f*=this.group.getObjectOpacity()),f}_constrainScale(f){return Math.abs(f)<this.minScaleLimit?f<0?-this.minScaleLimit:this.minScaleLimit:f===0?1e-4:f}_set(f,ze){f!==H&&f!==N$1||(ze=this._constrainScale(ze)),f===H&&ze<0?(this.flipX=!this.flipX,ze*=-1):f==="scaleY"&&ze<0?(this.flipY=!this.flipY,ze*=-1):f!=="shadow"||!ze||ze instanceof ds||(ze=new ds(ze));const Ke=this[f]!==ze;return this[f]=ze,Ke&&this.constructor.cacheProperties.includes(f)&&(this.dirty=!0),this.parent&&(this.dirty||Ke&&this.constructor.stateProperties.includes(f))&&this.parent._set("dirty",!0),this}isNotVisible(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible}render(f){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(f.save(),this._setupCompositeOperation(f),this.drawSelectionBackground(f),this.transform(f),this._setOpacity(f),this._setShadow(f),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(f)):(this._removeCacheCanvas(),this.drawObject(f,!1,{}),this.dirty=!1),f.restore())}drawSelectionBackground(f){}renderCache(f){if(f=f||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext){const{zoomX:ze,zoomY:Ke,cacheTranslationX:Qe,cacheTranslationY:Pi}=this,{width:nn,height:ln}=this._cacheCanvas;this.drawObject(this._cacheContext,f.forClipping,{zoomX:ze,zoomY:Ke,cacheTranslationX:Qe,cacheTranslationY:Pi,width:nn,height:ln,parentClipPaths:[]}),this.dirty=!1}}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null}hasStroke(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0}hasFill(){return this.fill&&this.fill!=="transparent"}needsItsOwnCache(){return!!(this.paintFirst===J&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.objectCaching&&(!this.parent||!this.parent.isOnACache())||this.needsItsOwnCache(),this.ownCaching}willDrawShadow(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)}drawClipPathOnCache(f,ze,Ke){f.save(),ze.inverted?f.globalCompositeOperation="destination-out":f.globalCompositeOperation="destination-in",f.setTransform(1,0,0,1,0,0),f.drawImage(Ke,0,0),f.restore()}drawObject(f,ze,Ke){const Qe=this.fill,Pi=this.stroke;ze?(this.fill="black",this.stroke="",this._setClippingProperties(f)):this._renderBackground(f),this._render(f),this._drawClipPath(f,this.clipPath,Ke),this.fill=Qe,this.stroke=Pi}createClipPathLayer(f,ze){const Ke=vt$1(ze),Qe=Ke.getContext("2d");if(Qe.translate(ze.cacheTranslationX,ze.cacheTranslationY),Qe.scale(ze.zoomX,ze.zoomY),f._cacheCanvas=Ke,ze.parentClipPaths.forEach(Pi=>{Pi.transform(Qe)}),ze.parentClipPaths.push(f),f.absolutePositioned){const Pi=St$1(this.calcTransformMatrix());Qe.transform(Pi[0],Pi[1],Pi[2],Pi[3],Pi[4],Pi[5])}return f.transform(Qe),f.drawObject(Qe,!0,ze),Ke}_drawClipPath(f,ze,Ke){if(!ze)return;ze._transformDone=!0;const Qe=this.createClipPathLayer(ze,Ke);this.drawClipPathOnCache(f,ze,Qe)}drawCacheOnCanvas(f){f.scale(1/this.zoomX,1/this.zoomY),f.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let f=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(this.isNotVisible())return!1;const ze=this._cacheCanvas,Ke=this._cacheContext;return!(!ze||!Ke||f||!this._updateCacheCanvas())||!!(this.dirty||this.clipPath&&this.clipPath.absolutePositioned)&&(ze&&Ke&&!f&&(Ke.save(),Ke.setTransform(1,0,0,1,0,0),Ke.clearRect(0,0,ze.width,ze.height),Ke.restore()),!0)}_renderBackground(f){if(!this.backgroundColor)return;const ze=this._getNonTransformedDimensions();f.fillStyle=this.backgroundColor,f.fillRect(-ze.x/2,-ze.y/2,ze.x,ze.y),this._removeShadow(f)}_setOpacity(f){this.group&&!this.group._transformDone?f.globalAlpha=this.getObjectOpacity():f.globalAlpha*=this.opacity}_setStrokeStyles(f,ze){const Ke=ze.stroke;Ke&&(f.lineWidth=ze.strokeWidth,f.lineCap=ze.strokeLineCap,f.lineDashOffset=ze.strokeDashOffset,f.lineJoin=ze.strokeLineJoin,f.miterLimit=ze.strokeMiterLimit,Gt$1(Ke)?Ke.gradientUnits==="percentage"||Ke.gradientTransform||Ke.patternTransform?this._applyPatternForTransformedGradient(f,Ke):(f.strokeStyle=Ke.toLive(f),this._applyPatternGradientTransform(f,Ke)):f.strokeStyle=ze.stroke)}_setFillStyles(f,ze){let{fill:Ke}=ze;Ke&&(Gt$1(Ke)?(f.fillStyle=Ke.toLive(f),this._applyPatternGradientTransform(f,Ke)):f.fillStyle=Ke)}_setClippingProperties(f){f.globalAlpha=1,f.strokeStyle="transparent",f.fillStyle="#000000"}_setLineDash(f,ze){ze&&ze.length!==0&&f.setLineDash(ze)}_setShadow(f){if(!this.shadow)return;const ze=this.shadow,Ke=this.canvas,Qe=this.getCanvasRetinaScaling(),[Pi,,,nn]=(Ke==null?void 0:Ke.viewportTransform)||T,ln=Pi*Qe,cn=nn*Qe,hn=ze.nonScaling?new ot$1(1,1):this.getObjectScaling();f.shadowColor=ze.color,f.shadowBlur=ze.blur*o.browserShadowBlurConstant*(ln+cn)*(hn.x+hn.y)/4,f.shadowOffsetX=ze.offsetX*ln*hn.x,f.shadowOffsetY=ze.offsetY*cn*hn.y}_removeShadow(f){this.shadow&&(f.shadowColor="",f.shadowBlur=f.shadowOffsetX=f.shadowOffsetY=0)}_applyPatternGradientTransform(f,ze){if(!Gt$1(ze))return{offsetX:0,offsetY:0};const Ke=ze.gradientTransform||ze.patternTransform,Qe=-this.width/2+ze.offsetX||0,Pi=-this.height/2+ze.offsetY||0;return ze.gradientUnits==="percentage"?f.transform(this.width,0,0,this.height,Qe,Pi):f.transform(1,0,0,1,Qe,Pi),Ke&&f.transform(Ke[0],Ke[1],Ke[2],Ke[3],Ke[4],Ke[5]),{offsetX:Qe,offsetY:Pi}}_renderPaintInOrder(f){this.paintFirst===J?(this._renderStroke(f),this._renderFill(f)):(this._renderFill(f),this._renderStroke(f))}_render(f){}_renderFill(f){this.fill&&(f.save(),this._setFillStyles(f,this),this.fillRule==="evenodd"?f.fill("evenodd"):f.fill(),f.restore())}_renderStroke(f){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(f),f.save(),this.strokeUniform){const ze=this.getObjectScaling();f.scale(1/ze.x,1/ze.y)}this._setLineDash(f,this.strokeDashArray),this._setStrokeStyles(f,this),f.stroke(),f.restore()}}_applyPatternForTransformedGradient(f,ze){var Ke;const Qe=this._limitCacheSize(this._getCacheCanvasDimensions()),Pi=this.getCanvasRetinaScaling(),nn=Qe.x/this.scaleX/Pi,ln=Qe.y/this.scaleY/Pi,cn=vt$1({width:Math.ceil(nn),height:Math.ceil(ln)}),hn=cn.getContext("2d");hn&&(hn.beginPath(),hn.moveTo(0,0),hn.lineTo(nn,0),hn.lineTo(nn,ln),hn.lineTo(0,ln),hn.closePath(),hn.translate(nn/2,ln/2),hn.scale(Qe.zoomX/this.scaleX/Pi,Qe.zoomY/this.scaleY/Pi),this._applyPatternGradientTransform(hn,ze),hn.fillStyle=ze.toLive(f),hn.fill(),f.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),f.scale(Pi*this.scaleX/Qe.zoomX,Pi*this.scaleY/Qe.zoomY),f.strokeStyle=(Ke=hn.createPattern(cn,"no-repeat"))!==null&&Ke!==void 0?Ke:"")}_findCenterFromElement(){return new ot$1(this.left+this.width/2,this.top+this.height/2)}clone(f){const ze=this.toObject(f);return this.constructor.fromObject(ze)}cloneAsImage(f){const ze=this.toCanvasElement(f);return new(tt.getClass("image"))(ze)}toCanvasElement(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const ze=de$1(this),Ke=this.group,Qe=this.shadow,Pi=Math.abs,nn=f.enableRetinaScaling?y$1():1,ln=(f.multiplier||1)*nn,cn=f.canvasProvider||(na=>new se$1(na,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,f.withoutTransform&&ue$1(this),f.withoutShadow&&(this.shadow=null),f.viewportTransform&&ve$1(this,this.getViewportTransform()),this.setCoords();const hn=pt$1(),un=this.getBoundingRect(),zn=this.shadow,Xn=new ot$1;if(zn){const na=zn.blur,ta=zn.nonScaling?new ot$1(1,1):this.getObjectScaling();Xn.x=2*Math.round(Pi(zn.offsetX)+na)*Pi(ta.x),Xn.y=2*Math.round(Pi(zn.offsetY)+na)*Pi(ta.y)}const Un=un.width+Xn.x,qn=un.height+Xn.y;hn.width=Math.ceil(Un),hn.height=Math.ceil(qn);const ys=cn(hn);f.format==="jpeg"&&(ys.backgroundColor="#fff"),this.setPositionByOrigin(new ot$1(ys.width/2,ys.height/2),D$1,D$1);const vs=this.canvas;ys._objects=[this],this.set("canvas",ys),this.setCoords();const ea=ys.toCanvasElement(ln||1,f);return this.set("canvas",vs),this.shadow=Qe,Ke&&(this.group=Ke),this.set(ze),this.setCoords(),ys._objects=[],ys.destroy(),ea}toDataURL(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return yt$1(this.toCanvasElement(f),f.format||"png",f.quality||1)}toBlob(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return _t$1(this.toCanvasElement(f),f.format||"png",f.quality||1)}isType(){for(var f=arguments.length,ze=new Array(f),Ke=0;Ke<f;Ke++)ze[Ke]=arguments[Ke];return ze.includes(this.constructor.type)||ze.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(f){const{centeredRotation:ze,originX:Ke,originY:Qe}=this;if(ze){const{x:Pi,y:nn}=this.getRelativeCenterPoint();this.originX=D$1,this.originY=D$1,this.left=Pi,this.top=nn}if(this.set("angle",f),ze){const{x:Pi,y:nn}=this.translateToOriginPoint(this.getRelativeCenterPoint(),Ke,Qe);this.left=Pi,this.top=nn,this.originX=Ke,this.originY=Qe}}setOnGroup(){}_setupCompositeOperation(f){this.globalCompositeOperation&&(f.globalCompositeOperation=this.globalCompositeOperation)}dispose(){et$1.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&p$1().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}animate(f,ze){return Object.entries(f).reduce((Ke,Qe)=>{let[Pi,nn]=Qe;return Ke[Pi]=this._animate(Pi,nn,ze),Ke},{})}_animate(f,ze){let Ke=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const Qe=f.split("."),Pi=this.constructor.colorProperties.includes(Qe[Qe.length-1]),{abort:nn,startValue:ln,onChange:cn,onComplete:hn}=Ke,un=s(s({},Ke),{},{target:this,startValue:ln??Qe.reduce((zn,Xn)=>zn[Xn],this),endValue:ze,abort:nn==null?void 0:nn.bind(this),onChange:(zn,Xn,Un)=>{Qe.reduce((qn,ys,vs)=>(vs===Qe.length-1&&(qn[ys]=zn),qn[ys]),this),cn&&cn(zn,Xn,Un)},onComplete:(zn,Xn,Un)=>{this.setCoords(),hn&&hn(zn,Xn,Un)}});return Pi?Fs(un):js(un)}isDescendantOf(f){const{parent:ze,group:Ke}=this;return ze===f||Ke===f||!!ze&&ze.isDescendantOf(f)||!!Ke&&Ke!==ze&&Ke.isDescendantOf(f)}getAncestors(){const f=[];let ze=this;do ze=ze.parent,ze&&f.push(ze);while(ze);return f}findCommonAncestors(f){if(this===f)return{fork:[],otherFork:[],common:[this,...this.getAncestors()]};const ze=this.getAncestors(),Ke=f.getAncestors();if(ze.length===0&&Ke.length>0&&this===Ke[Ke.length-1])return{fork:[],otherFork:[f,...Ke.slice(0,Ke.length-1)],common:[this]};for(let Qe,Pi=0;Pi<ze.length;Pi++){if(Qe=ze[Pi],Qe===f)return{fork:[this,...ze.slice(0,Pi)],otherFork:[],common:ze.slice(Pi)};for(let nn=0;nn<Ke.length;nn++){if(this===Ke[nn])return{fork:[],otherFork:[f,...Ke.slice(0,nn)],common:[this,...ze]};if(Qe===Ke[nn])return{fork:[this,...ze.slice(0,Pi)],otherFork:[f,...Ke.slice(0,nn)],common:ze.slice(Pi)}}}return{fork:[this,...ze],otherFork:[f,...Ke],common:[]}}hasCommonAncestors(f){const ze=this.findCommonAncestors(f);return ze&&!!ze.common.length}isInFrontOf(f){if(this===f)return;const ze=this.findCommonAncestors(f);if(ze.fork.includes(f))return!0;if(ze.otherFork.includes(this))return!1;const Ke=ze.common[0]||this.canvas;if(!Ke)return;const Qe=ze.fork.pop(),Pi=ze.otherFork.pop(),nn=Ke._objects.indexOf(Qe),ln=Ke._objects.indexOf(Pi);return nn>-1&&nn>ln}toObject(){const f=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).concat(Rc.customProperties,this.constructor.customProperties||[]);let ze;const Ke=o.NUM_FRACTION_DIGITS,{clipPath:Qe,fill:Pi,stroke:nn,shadow:ln,strokeDashArray:cn,left:hn,top:un,originX:zn,originY:Xn,width:Un,height:qn,strokeWidth:ys,strokeLineCap:vs,strokeDashOffset:ea,strokeLineJoin:na,strokeUniform:ta,strokeMiterLimit:ra,scaleX:oa,scaleY:fa,angle:ca,flipX:la,flipY:ua,opacity:ga,visible:da,backgroundColor:qa,fillRule:tl,paintFirst:ol,globalCompositeOperation:hl,skewX:wl,skewY:_l}=this;Qe&&!Qe.excludeFromExport&&(ze=Qe.toObject(f.concat("inverted","absolutePositioned")));const gl=sl=>Vt$1(sl,Ke),dl=s(s({},Yt$1(this,f)),{},{type:this.constructor.type,version:x$1,originX:zn,originY:Xn,left:gl(hn),top:gl(un),width:gl(Un),height:gl(qn),fill:Ht$1(Pi)?Pi.toObject():Pi,stroke:Ht$1(nn)?nn.toObject():nn,strokeWidth:gl(ys),strokeDashArray:cn&&cn.concat(),strokeLineCap:vs,strokeDashOffset:ea,strokeLineJoin:na,strokeUniform:ta,strokeMiterLimit:gl(ra),scaleX:gl(oa),scaleY:gl(fa),angle:gl(ca),flipX:la,flipY:ua,opacity:gl(ga),shadow:ln&&ln.toObject(),visible:da,backgroundColor:qa,fillRule:tl,paintFirst:ol,globalCompositeOperation:hl,skewX:gl(wl),skewY:gl(_l)},ze?{clipPath:ze}:null);return this.includeDefaultValues?dl:this._removeDefaultValues(dl)}toDatalessObject(f){return this.toObject(f)}_removeDefaultValues(f){const ze=this.constructor.getDefaults(),Ke=Object.keys(ze).length>0?ze:Object.getPrototypeOf(this);return Wt$1(f,(Qe,Pi)=>{if(Pi===M$1||Pi===P||Pi==="type")return!0;const nn=Ke[Pi];return Qe!==nn&&!(Array.isArray(Qe)&&Array.isArray(nn)&&Qe.length===0&&nn.length===0)})}toString(){return"#<".concat(this.constructor.type,">")}static _fromObject(f){let ze=i(f,Is),Ke=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{extraParam:Qe}=Ke,Pi=i(Ke,Bs);return Xt$1(ze,Pi).then(nn=>Qe?(delete nn[Qe],new this(ze[Qe],nn)):new this(nn))}static fromObject(f,ze){return this._fromObject(f,ze)}};t(Xs,"stateProperties",fs),t(Xs,"cacheProperties",ps),t(Xs,"ownDefaults",ms),t(Xs,"type","FabricObject"),t(Xs,"colorProperties",[K$1,J,"backgroundColor"]),t(Xs,"customProperties",[]),tt.setClass(Xs),tt.setClass(Xs,"object");const Ys=(qe,f,ze)=>(Ke,Qe,Pi,nn)=>{const ln=f(Ke,Qe,Pi,nn);return ln&&ye$1(qe,s(s({},Te$1(Ke,Qe,Pi,nn)),ze)),ln};function Ws(qe){return(f,ze,Ke,Qe)=>{const{target:Pi,originX:nn,originY:ln}=ze,cn=Pi.getRelativeCenterPoint(),hn=Pi.translateToOriginPoint(cn,nn,ln),un=qe(f,ze,Ke,Qe);return Pi.setPositionByOrigin(hn,ze.originX,ze.originY),un}}const Vs=Ys(Y$1,Ws((qe,f,ze,Ke)=>{const Qe=ke$1(f,f.originX,f.originY,ze,Ke);if(xe$1(f.originX)===xe$1(D$1)||xe$1(f.originX)===xe$1(A)&&Qe.x<0||xe$1(f.originX)===xe$1(M$1)&&Qe.x>0){const{target:Pi}=f,nn=Pi.strokeWidth/(Pi.strokeUniform?Pi.scaleX:1),ln=be$1(f)?2:1,cn=Pi.width,hn=Math.abs(Qe.x*ln/Pi.scaleX)-nn;return Pi.set("width",Math.max(hn,1)),cn!==Pi.width}return!1}));function zs(qe,f,ze,Ke,Qe){Ke=Ke||{};const Pi=this.sizeX||Ke.cornerSize||Qe.cornerSize,nn=this.sizeY||Ke.cornerSize||Qe.cornerSize,ln=Ke.transparentCorners!==void 0?Ke.transparentCorners:Qe.transparentCorners,cn=ln?J:K$1,hn=!ln&&(Ke.cornerStrokeColor||Qe.cornerStrokeColor);let un,zn=f,Xn=ze;qe.save(),qe.fillStyle=Ke.cornerColor||Qe.cornerColor||"",qe.strokeStyle=Ke.cornerStrokeColor||Qe.cornerStrokeColor||"",Pi>nn?(un=Pi,qe.scale(1,nn/Pi),Xn=ze*Pi/nn):nn>Pi?(un=nn,qe.scale(Pi/nn,1),zn=f*nn/Pi):un=Pi,qe.beginPath(),qe.arc(zn,Xn,un/2,0,w$1,!1),qe[cn](),hn&&qe.stroke(),qe.restore()}function Gs(qe,f,ze,Ke,Qe){Ke=Ke||{};const Pi=this.sizeX||Ke.cornerSize||Qe.cornerSize,nn=this.sizeY||Ke.cornerSize||Qe.cornerSize,ln=Ke.transparentCorners!==void 0?Ke.transparentCorners:Qe.transparentCorners,cn=ln?J:K$1,hn=!ln&&(Ke.cornerStrokeColor||Qe.cornerStrokeColor),un=Pi/2,zn=nn/2;qe.save(),qe.fillStyle=Ke.cornerColor||Qe.cornerColor||"",qe.strokeStyle=Ke.cornerStrokeColor||Qe.cornerStrokeColor||"",qe.translate(f,ze);const Xn=Qe.getTotalAngle();qe.rotate(xt$1(Xn)),qe["".concat(cn,"Rect")](-un,-zn,Pi,nn),hn&&qe.strokeRect(-un,-zn,Pi,nn),qe.restore()}class Hs{constructor(f){t(this,"visible",!0),t(this,"actionName",G$1),t(this,"angle",0),t(this,"x",0),t(this,"y",0),t(this,"offsetX",0),t(this,"offsetY",0),t(this,"sizeX",0),t(this,"sizeY",0),t(this,"touchSizeX",0),t(this,"touchSizeY",0),t(this,"cursorStyle","crosshair"),t(this,"withConnection",!1),Object.assign(this,f)}shouldActivate(f,ze,Ke,Qe){var Pi;let{tl:nn,tr:ln,br:cn,bl:hn}=Qe;return((Pi=ze.canvas)===null||Pi===void 0?void 0:Pi.getActiveObject())===ze&&ze.isControlVisible(f)&&Ls.isPointInPolygon(Ke,[nn,ln,cn,hn])}getActionHandler(f,ze,Ke){return this.actionHandler}getMouseDownHandler(f,ze,Ke){return this.mouseDownHandler}getMouseUpHandler(f,ze,Ke){return this.mouseUpHandler}cursorStyleHandler(f,ze,Ke){return ze.cursorStyle}getActionName(f,ze,Ke){return ze.actionName}getVisibility(f,ze){var Ke,Qe;return(Ke=(Qe=f._controlsVisibility)===null||Qe===void 0?void 0:Qe[ze])!==null&&Ke!==void 0?Ke:this.visible}setVisibility(f,ze,Ke){this.visible=f}positionHandler(f,ze,Ke,Qe){return new ot$1(this.x*f.x+this.offsetX,this.y*f.y+this.offsetY).transform(ze)}calcCornerCoords(f,ze,Ke,Qe,Pi,nn){const ln=Ot$1([Mt$1(Ke,Qe),Pt$1({angle:f}),Et$1((Pi?this.touchSizeX:this.sizeX)||ze,(Pi?this.touchSizeY:this.sizeY)||ze)]);return{tl:new ot$1(-.5,-.5).transform(ln),tr:new ot$1(.5,-.5).transform(ln),br:new ot$1(.5,.5).transform(ln),bl:new ot$1(-.5,.5).transform(ln)}}render(f,ze,Ke,Qe,Pi){((Qe=Qe||{}).cornerStyle||Pi.cornerStyle)==="circle"?zs.call(this,f,ze,Ke,Qe,Pi):Gs.call(this,f,ze,Ke,Qe,Pi)}}const Ns=(qe,f,ze)=>ze.lockRotation?Ce$1:f.cursorStyle,Us=Ys(I,Ws((qe,f,ze,Ke)=>{let{target:Qe,ex:Pi,ey:nn,theta:ln,originX:cn,originY:hn}=f;const un=Qe.translateToOriginPoint(Qe.getRelativeCenterPoint(),cn,hn);if(Se$1(Qe,"lockRotation"))return!1;const zn=Math.atan2(nn-un.y,Pi-un.x),Xn=Math.atan2(Ke-un.y,ze-un.x);let Un=Ct$1(Xn-zn+ln);if(Qe.snapAngle&&Qe.snapAngle>0){const ys=Qe.snapAngle,vs=Qe.snapThreshold||ys,ea=Math.ceil(Un/ys)*ys,na=Math.floor(Un/ys)*ys;Math.abs(Un-na)<vs?Un=na:Math.abs(Un-ea)<vs&&(Un=ea)}Un<0&&(Un=360+Un),Un%=360;const qn=Qe.angle!==Un;return Qe.angle=Un,qn}));function qs(qe,f){const ze=f.canvas,Ke=qe[ze.uniScaleKey];return ze.uniformScaling&&!Ke||!ze.uniformScaling&&Ke}function Ks(qe,f,ze){const Ke=Se$1(qe,"lockScalingX"),Qe=Se$1(qe,"lockScalingY");if(Ke&&Qe||!f&&(Ke||Qe)&&ze||Ke&&f==="x"||Qe&&f==="y")return!0;const{width:Pi,height:nn,strokeWidth:ln}=qe;return Pi===0&&ln===0&&f!=="y"||nn===0&&ln===0&&f!=="x"}const Js=["e","se","s","sw","w","nw","n","ne","e"],Qs=(qe,f,ze)=>{const Ke=qs(qe,ze);if(Ks(ze,f.x!==0&&f.y===0?"x":f.x===0&&f.y!==0?"y":"",Ke))return Ce$1;const Qe=Oe$1(ze,f);return"".concat(Js[Qe],"-resize")};function Zs(qe,f,ze,Ke){let Qe=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};const Pi=f.target,nn=Qe.by,ln=qs(qe,Pi);let cn,hn,un,zn,Xn,Un;if(Ks(Pi,nn,ln))return!1;if(f.gestureScale)hn=f.scaleX*f.gestureScale,un=f.scaleY*f.gestureScale;else{if(cn=ke$1(f,f.originX,f.originY,ze,Ke),Xn=nn!=="y"?Math.sign(cn.x||f.signX||1):1,Un=nn!=="x"?Math.sign(cn.y||f.signY||1):1,f.signX||(f.signX=Xn),f.signY||(f.signY=Un),Se$1(Pi,"lockScalingFlip")&&(f.signX!==Xn||f.signY!==Un))return!1;if(zn=Pi._getTransformedDimensions(),ln&&!nn){const vs=Math.abs(cn.x)+Math.abs(cn.y),{original:ea}=f,na=vs/(Math.abs(zn.x*ea.scaleX/Pi.scaleX)+Math.abs(zn.y*ea.scaleY/Pi.scaleY));hn=ea.scaleX*na,un=ea.scaleY*na}else hn=Math.abs(cn.x*Pi.scaleX/zn.x),un=Math.abs(cn.y*Pi.scaleY/zn.y);be$1(f)&&(hn*=2,un*=2),f.signX!==Xn&&nn!=="y"&&(f.originX=we$1(f.originX),hn*=-1,f.signX=Xn),f.signY!==Un&&nn!=="x"&&(f.originY=we$1(f.originY),un*=-1,f.signY=Un)}const qn=Pi.scaleX,ys=Pi.scaleY;return nn?(nn==="x"&&Pi.set(H,hn),nn==="y"&&Pi.set(N$1,un)):(!Se$1(Pi,"lockScalingX")&&Pi.set(H,hn),!Se$1(Pi,"lockScalingY")&&Pi.set(N$1,un)),qn!==Pi.scaleX||ys!==Pi.scaleY}const $s=Ys(R,Ws((qe,f,ze,Ke)=>Zs(qe,f,ze,Ke))),ti=Ys(R,Ws((qe,f,ze,Ke)=>Zs(qe,f,ze,Ke,{by:"x"}))),ei=Ys(R,Ws((qe,f,ze,Ke)=>Zs(qe,f,ze,Ke,{by:"y"}))),si=["target","ex","ey","skewingSide"],ii={x:{counterAxis:"y",scale:H,skew:U,lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:N$1,skew:q,lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},ri=["ns","nesw","ew","nwse"],ni=(qe,f,ze)=>{if(f.x!==0&&Se$1(ze,"lockSkewingY")||f.y!==0&&Se$1(ze,"lockSkewingX"))return Ce$1;const Ke=Oe$1(ze,f)%4;return"".concat(ri[Ke],"-resize")};function oi(qe,f,ze,Ke,Qe){const{target:Pi}=ze,{counterAxis:nn,origin:ln,lockSkewing:cn,skew:hn,flip:un}=ii[qe];if(Se$1(Pi,cn))return!1;const{origin:zn,flip:Xn}=ii[nn],Un=xe$1(ze[zn])*(Pi[Xn]?-1:1),qn=-Math.sign(Un)*(Pi[un]?-1:1),ys=.5*-((Pi[hn]===0&&ke$1(ze,D$1,D$1,Ke,Qe)[qe]>0||Pi[hn]>0?1:-1)*qn)+.5;return Ys(X,Ws((ea,na,ta,ra)=>function(oa,fa,ca){let{target:la,ex:ua,ey:ga,skewingSide:da}=fa,qa=i(fa,si);const{skew:tl}=ii[oa],ol=ca.subtract(new ot$1(ua,ga)).divide(new ot$1(la.scaleX,la.scaleY))[oa],hl=la[tl],wl=qa[tl],_l=Math.tan(xt$1(wl)),gl=oa==="y"?la._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:la._getTransformedDimensions({scaleX:1,scaleY:1}).y,dl=2*ol*da/Math.max(gl,1)+_l,sl=Ct$1(Math.atan(dl));la.set(tl,sl);const kl=hl!==la[tl];if(kl&&oa==="y"){const{skewX:pl,scaleX:Al}=la,xl=la._getTransformedDimensions({skewY:hl}),al=la._getTransformedDimensions(),Fl=pl!==0?xl.x/al.x:1;Fl!==1&&la.set(H,Fl*Al)}return kl}(qe,na,new ot$1(ta,ra))))(f,s(s({},ze),{},{[ln]:ys,skewingSide:qn}),Ke,Qe)}const ai=(qe,f,ze,Ke)=>oi("x",qe,f,ze,Ke),hi=(qe,f,ze,Ke)=>oi("y",qe,f,ze,Ke);function ci(qe,f){return qe[f.canvas.altActionKey]}const li$1=(qe,f,ze)=>{const Ke=ci(qe,ze);return f.x===0?Ke?U:N$1:f.y===0?Ke?q:H:""},ui=(qe,f,ze)=>ci(qe,ze)?ni(0,f,ze):Qs(qe,f,ze),di=(qe,f,ze,Ke)=>ci(qe,f.target)?hi(qe,f,ze,Ke):ti(qe,f,ze,Ke),gi=(qe,f,ze,Ke)=>ci(qe,f.target)?ai(qe,f,ze,Ke):ei(qe,f,ze,Ke),fi=()=>({ml:new Hs({x:-.5,y:0,cursorStyleHandler:ui,actionHandler:di,getActionName:li$1}),mr:new Hs({x:.5,y:0,cursorStyleHandler:ui,actionHandler:di,getActionName:li$1}),mb:new Hs({x:0,y:.5,cursorStyleHandler:ui,actionHandler:gi,getActionName:li$1}),mt:new Hs({x:0,y:-.5,cursorStyleHandler:ui,actionHandler:gi,getActionName:li$1}),tl:new Hs({x:-.5,y:-.5,cursorStyleHandler:Qs,actionHandler:$s}),tr:new Hs({x:.5,y:-.5,cursorStyleHandler:Qs,actionHandler:$s}),bl:new Hs({x:-.5,y:.5,cursorStyleHandler:Qs,actionHandler:$s}),br:new Hs({x:.5,y:.5,cursorStyleHandler:Qs,actionHandler:$s}),mtr:new Hs({x:0,y:-.5,actionHandler:Us,cursorStyleHandler:Ns,offsetY:-40,withConnection:!0,actionName:B$1})}),pi=()=>({mr:new Hs({x:.5,y:0,actionHandler:Vs,cursorStyleHandler:ui,actionName:Y$1}),ml:new Hs({x:-.5,y:0,actionHandler:Vs,cursorStyleHandler:ui,actionName:Y$1})}),mi=()=>s(s({},fi()),pi());class vi extends Xs{static getDefaults(){return s(s({},super.getDefaults()),vi.ownDefaults)}constructor(f){super(),Object.assign(this,this.constructor.createControls(),vi.ownDefaults),this.setOptions(f)}static createControls(){return{controls:fi()}}_updateCacheCanvas(){const f=this.canvas;if(this.noScaleCache&&f&&f._currentTransform){const ze=f._currentTransform,Ke=ze.target,Qe=ze.action;if(this===Ke&&Qe&&Qe.startsWith(G$1))return!1}return super._updateCacheCanvas()}getActiveControl(){const f=this.__corner;return f?{key:f,control:this.controls[f],coord:this.oCoords[f]}:void 0}findControl(f){let ze=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;const Ke=Object.entries(this.oCoords);for(let Qe=Ke.length-1;Qe>=0;Qe--){const[Pi,nn]=Ke[Qe],ln=this.controls[Pi];if(ln.shouldActivate(Pi,this,f,ze?nn.touchCorner:nn.corner))return this.__corner=Pi,{key:Pi,control:ln,coord:this.oCoords[Pi]}}}calcOCoords(){const f=this.getViewportTransform(),ze=this.getCenterPoint(),Ke=Mt$1(ze.x,ze.y),Qe=Pt$1({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),Pi=Tt$1(Ke,Qe),nn=Tt$1(f,Pi),ln=Tt$1(nn,[1/f[0],0,0,1/f[3],0,0]),cn=this.group?Dt$1(this.calcTransformMatrix()):void 0;cn&&(cn.scaleX=Math.abs(cn.scaleX),cn.scaleY=Math.abs(cn.scaleY));const hn=this._calculateCurrentDimensions(cn),un={};return this.forEachControl((zn,Xn)=>{const Un=zn.positionHandler(hn,ln,this,zn);un[Xn]=Object.assign(Un,this._calcCornerCoords(zn,Un))}),un}_calcCornerCoords(f,ze){const Ke=this.getTotalAngle();return{corner:f.calcCornerCoords(Ke,this.cornerSize,ze.x,ze.y,!1,this),touchCorner:f.calcCornerCoords(Ke,this.touchCornerSize,ze.x,ze.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(f){for(const ze in this.controls)f(this.controls[ze],ze,this)}drawSelectionBackground(f){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;f.save();const ze=this.getRelativeCenterPoint(),Ke=this._calculateCurrentDimensions(),Qe=this.getViewportTransform();f.translate(ze.x,ze.y),f.scale(1/Qe[0],1/Qe[3]),f.rotate(xt$1(this.angle)),f.fillStyle=this.selectionBackgroundColor,f.fillRect(-Ke.x/2,-Ke.y/2,Ke.x,Ke.y),f.restore()}strokeBorders(f,ze){f.strokeRect(-ze.x/2,-ze.y/2,ze.x,ze.y)}_drawBorders(f,ze){let Ke=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const Qe=s({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},Ke);f.save(),f.strokeStyle=Qe.borderColor,this._setLineDash(f,Qe.borderDashArray),this.strokeBorders(f,ze),Qe.hasControls&&this.drawControlsConnectingLines(f,ze),f.restore()}_renderControls(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{hasBorders:Ke,hasControls:Qe}=this,Pi=s({hasBorders:Ke,hasControls:Qe},ze),nn=this.getViewportTransform(),ln=Pi.hasBorders,cn=Pi.hasControls,hn=Tt$1(nn,this.calcTransformMatrix()),un=Dt$1(hn);f.save(),f.translate(un.translateX,un.translateY),f.lineWidth=this.borderScaleFactor,this.group===this.parent&&(f.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(un.angle-=180),f.rotate(xt$1(this.group?un.angle:this.angle)),ln&&this.drawBorders(f,un,ze),cn&&this.drawControls(f,ze),f.restore()}drawBorders(f,ze,Ke){let Qe;if(Ke&&Ke.forActiveSelection||this.group){const Pi=ge$1(this.width,this.height,Lt$1(ze)),nn=this.isStrokeAccountedForInDimensions()?at$1:(this.strokeUniform?new ot$1().scalarAdd(this.canvas?this.canvas.getZoom():1):new ot$1(ze.scaleX,ze.scaleY)).scalarMultiply(this.strokeWidth);Qe=Pi.add(nn).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else Qe=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(f,Qe,Ke)}drawControlsConnectingLines(f,ze){let Ke=!1;f.beginPath(),this.forEachControl((Qe,Pi)=>{Qe.withConnection&&Qe.getVisibility(this,Pi)&&(Ke=!0,f.moveTo(Qe.x*ze.x,Qe.y*ze.y),f.lineTo(Qe.x*ze.x+Qe.offsetX,Qe.y*ze.y+Qe.offsetY))}),Ke&&f.stroke()}drawControls(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};f.save();const Ke=this.getCanvasRetinaScaling(),{cornerStrokeColor:Qe,cornerDashArray:Pi,cornerColor:nn}=this,ln=s({cornerStrokeColor:Qe,cornerDashArray:Pi,cornerColor:nn},ze);f.setTransform(Ke,0,0,Ke,0,0),f.strokeStyle=f.fillStyle=ln.cornerColor,this.transparentCorners||(f.strokeStyle=ln.cornerStrokeColor),this._setLineDash(f,ln.cornerDashArray),this.forEachControl((cn,hn)=>{if(cn.getVisibility(this,hn)){const un=this.oCoords[hn];cn.render(f,un.x,un.y,ln,this)}}),f.restore()}isControlVisible(f){return this.controls[f]&&this.controls[f].getVisibility(this,f)}setControlVisible(f,ze){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[f]=ze}setControlsVisibility(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.entries(f).forEach(ze=>{let[Ke,Qe]=ze;return this.setControlVisible(Ke,Qe)})}clearContextTop(f){if(!this.canvas)return;const ze=this.canvas.contextTop;if(!ze)return;const Ke=this.canvas.viewportTransform;ze.save(),ze.transform(Ke[0],Ke[1],Ke[2],Ke[3],Ke[4],Ke[5]),this.transform(ze);const Qe=this.width+4,Pi=this.height+4;return ze.clearRect(-Qe/2,-Pi/2,Qe,Pi),f||ze.restore(),ze}onDeselect(f){return!1}onSelect(f){return!1}shouldStartDragging(f){return!1}onDragStart(f){return!1}canDrop(f){return!1}renderDragSourceEffect(f){}renderDropTargetEffect(f){}}function yi(qe,f){return f.forEach(ze=>{Object.getOwnPropertyNames(ze.prototype).forEach(Ke=>{Ke!=="constructor"&&Object.defineProperty(qe.prototype,Ke,Object.getOwnPropertyDescriptor(ze.prototype,Ke)||Object.create(null))})}),qe}t(vi,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class _i extends vi{}yi(_i,[Xe]),tt.setClass(_i),tt.setClass(_i,"object");const xi=(qe,f,ze,Ke)=>{const Qe=2*(Ke=Math.round(Ke))+1,{data:Pi}=qe.getImageData(f-Ke,ze-Ke,Qe,Qe);for(let nn=3;nn<Pi.length;nn+=4)if(Pi[nn]>0)return!1;return!0};class Ci{constructor(f){this.options=f,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new ot$1(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new ot$1(1/this.options.scaleX,1/this.options.scaleY):new ot$1(1,1)}createSideVector(f,ze){const Ke=es(f,ze);return this.options.strokeUniform?Ke.multiply(this.scale):Ke}projectOrthogonally(f,ze,Ke){return this.applySkew(f.add(this.calcOrthogonalProjection(f,ze,Ke)))}isSkewed(){return this.options.skewX!==0||this.options.skewY!==0}applySkew(f){const ze=new ot$1(f);return ze.y+=ze.x*Math.tan(xt$1(this.options.skewY)),ze.x+=ze.y*Math.tan(xt$1(this.options.skewX)),ze}scaleUnitVector(f,ze){return f.multiply(this.strokeUniformScalar).scalarMultiply(ze)}}const bi=new ot$1;class wi extends Ci{static getOrthogonalRotationFactor(f,ze){const Ke=ze?is(f,ze):rs(f);return Math.abs(Ke)<b?-1:1}constructor(f,ze,Ke,Qe){super(Qe),t(this,"AB",void 0),t(this,"AC",void 0),t(this,"alpha",void 0),t(this,"bisector",void 0),this.A=new ot$1(f),this.B=new ot$1(ze),this.C=new ot$1(Ke),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=is(this.AB,this.AC),this.bisector=ns(ts(this.AB.eq(bi)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(f,ze){let Ke=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const Qe=this.createSideVector(f,ze),Pi=os(Qe),nn=wi.getOrthogonalRotationFactor(Pi,this.bisector);return this.scaleUnitVector(Pi,Ke*nn)}projectBevel(){const f=[];return(this.alpha%w$1==0?[this.B]:[this.B,this.C]).forEach(ze=>{f.push(this.projectOrthogonally(this.A,ze)),f.push(this.projectOrthogonally(this.A,ze,-this.strokeProjectionMagnitude))}),f}projectMiter(){const f=[],ze=Math.abs(this.alpha),Ke=1/Math.sin(ze/2),Qe=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*Ke),Pi=this.options.strokeUniform?ss(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return ss(Qe)/this.strokeProjectionMagnitude<=Pi&&f.push(this.applySkew(this.A.add(Qe))),f.push(...this.projectBevel()),f}projectRoundNoSkew(f,ze){const Ke=[],Qe=new ot$1(wi.getOrthogonalRotationFactor(this.bisector),wi.getOrthogonalRotationFactor(new ot$1(this.bisector.y,this.bisector.x)));return[new ot$1(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(Qe),new ot$1(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(Qe)].forEach(Pi=>{cs(Pi,f,ze)&&Ke.push(this.A.add(Pi))}),Ke}projectRoundWithSkew(f,ze){const Ke=[],{skewX:Qe,skewY:Pi,scaleX:nn,scaleY:ln,strokeUniform:cn}=this.options,hn=new ot$1(Math.tan(xt$1(Qe)),Math.tan(xt$1(Pi))),un=this.strokeProjectionMagnitude,zn=cn?un/ln/Math.sqrt(1/ln**2+1/nn**2*hn.y**2):un/Math.sqrt(1+hn.y**2),Xn=new ot$1(Math.sqrt(Math.max(un**2-zn**2,0)),zn),Un=cn?un/Math.sqrt(1+hn.x**2*(1/ln)**2/(1/nn+1/nn*hn.x*hn.y)**2):un/Math.sqrt(1+hn.x**2/(1+hn.x*hn.y)**2),qn=new ot$1(Un,Math.sqrt(Math.max(un**2-Un**2,0)));return[qn,qn.scalarMultiply(-1),Xn,Xn.scalarMultiply(-1)].map(ys=>this.applySkew(cn?ys.multiply(this.strokeUniformScalar):ys)).forEach(ys=>{cs(ys,f,ze)&&Ke.push(this.applySkew(this.A).add(ys))}),Ke}projectRound(){const f=[];f.push(...this.projectBevel());const ze=this.alpha%w$1==0,Ke=this.applySkew(this.A),Qe=f[ze?0:2].subtract(Ke),Pi=f[ze?1:0].subtract(Ke),nn=ze?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)),ln=as(Qe,nn)>0,cn=ln?Qe:Pi,hn=ln?Pi:Qe;return this.isSkewed()?f.push(...this.projectRoundWithSkew(cn,hn)):f.push(...this.projectRoundNoSkew(cn,hn)),f}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map(f=>({originPoint:this.A,projectedPoint:f,angle:this.alpha,bisector:this.bisector}))}}class Si extends Ci{constructor(f,ze,Ke){super(Ke),this.A=new ot$1(f),this.T=new ot$1(ze)}calcOrthogonalProjection(f,ze){let Ke=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const Qe=this.createSideVector(f,ze);return this.scaleUnitVector(os(Qe),Ke)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){const f=[];if(!this.isSkewed()&&this.A.eq(this.T)){const ze=new ot$1(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);f.push(this.applySkew(this.A.add(ze)),this.applySkew(this.A.subtract(ze)))}else f.push(...new wi(this.A,this.T,this.T,this.options).projectRound());return f}projectSquare(){const f=[];if(this.A.eq(this.T)){const ze=new ot$1(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);f.push(this.A.add(ze),this.A.subtract(ze))}else{const ze=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),Ke=this.scaleUnitVector(ns(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),Qe=this.A.add(Ke);f.push(Qe.add(ze),Qe.subtract(ze))}return f.map(ze=>this.applySkew(ze))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map(f=>({originPoint:this.A,projectedPoint:f}))}}const Ti=function(qe,f){let ze=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const Ke=[];if(qe.length===0)return Ke;const Qe=qe.reduce((Pi,nn)=>(Pi[Pi.length-1].eq(nn)||Pi.push(new ot$1(nn)),Pi),[new ot$1(qe[0])]);if(Qe.length===1)ze=!0;else if(!ze){const Pi=Qe[0],nn=((ln,cn)=>{for(let hn=ln.length-1;hn>=0;hn--)if(cn(ln[hn],hn,ln))return hn;return-1})(Qe,ln=>!ln.eq(Pi));Qe.splice(nn+1)}return Qe.forEach((Pi,nn,ln)=>{let cn,hn;nn===0?(hn=ln[1],cn=ze?Pi:ln[ln.length-1]):nn===ln.length-1?(cn=ln[nn-1],hn=ze?Pi:ln[0]):(cn=ln[nn-1],hn=ln[nn+1]),ze&&ln.length===1?Ke.push(...new Si(Pi,Pi,f).project()):!ze||nn!==0&&nn!==ln.length-1?Ke.push(...new wi(Pi,cn,hn,f).project()):Ke.push(...new Si(Pi,nn===0?hn:cn,f).project())}),Ke},Oi=qe=>{const f={};return Object.keys(qe).forEach(ze=>{f[ze]={},Object.keys(qe[ze]).forEach(Ke=>{f[ze][Ke]=s({},qe[ze][Ke])})}),f},ki=qe=>qe.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),Di=qe=>{const f=[];for(let ze,Ke=0;Ke<qe.length;Ke++)(ze=Mi(qe,Ke))!==!1&&f.push(ze);return f},Mi=(qe,f)=>{const ze=qe.charCodeAt(f);if(isNaN(ze))return"";if(ze<55296||ze>57343)return qe.charAt(f);if(55296<=ze&&ze<=56319){if(qe.length<=f+1)throw"High surrogate without following low surrogate";const Qe=qe.charCodeAt(f+1);if(56320>Qe||Qe>57343)throw"High surrogate without following low surrogate";return qe.charAt(f)+qe.charAt(f+1)}if(f===0)throw"Low surrogate without preceding high surrogate";const Ke=qe.charCodeAt(f-1);if(55296>Ke||Ke>56319)throw"Low surrogate without preceding high surrogate";return!1},Ei=function(qe,f){let ze=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return qe.fill!==f.fill||qe.stroke!==f.stroke||qe.strokeWidth!==f.strokeWidth||qe.fontSize!==f.fontSize||qe.fontFamily!==f.fontFamily||qe.fontWeight!==f.fontWeight||qe.fontStyle!==f.fontStyle||qe.textBackgroundColor!==f.textBackgroundColor||qe.deltaY!==f.deltaY||ze&&(qe.overline!==f.overline||qe.underline!==f.underline||qe.linethrough!==f.linethrough)},Ai=(qe,f)=>{const ze=f.split(`
`),Ke=[];let Qe=-1,Pi={};qe=Oi(qe);for(let nn=0;nn<ze.length;nn++){const ln=Di(ze[nn]);if(qe[nn])for(let cn=0;cn<ln.length;cn++){Qe++;const hn=qe[nn][cn];hn&&Object.keys(hn).length>0&&(Ei(Pi,hn,!0)?Ke.push({start:Qe,end:Qe+1,style:hn}):Ke[Ke.length-1].end++),Pi=hn||{}}else Qe+=ln.length,Pi={}}return Ke},ji=(qe,f)=>{if(!Array.isArray(qe))return Oi(qe);const ze=f.split(F$1),Ke={};let Qe=-1,Pi=0;for(let nn=0;nn<ze.length;nn++){const ln=Di(ze[nn]);for(let cn=0;cn<ln.length;cn++)Qe++,qe[Pi]&&qe[Pi].start<=Qe&&Qe<qe[Pi].end&&(Ke[nn]=Ke[nn]||{},Ke[nn][cn]=s({},qe[Pi].style),Qe===qe[Pi].end-1&&Pi++)}return Ke},Fi=["display","transform",K$1,"fill-opacity","fill-rule","opacity",J,"stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function Li(qe,f){const ze=qe.nodeName,Ke=qe.getAttribute("class"),Qe=qe.getAttribute("id"),Pi="(?![a-zA-Z\\-]+)";let nn;if(nn=new RegExp("^"+ze,"i"),f=f.replace(nn,""),Qe&&f.length&&(nn=new RegExp("#"+Qe+Pi,"i"),f=f.replace(nn,"")),Ke&&f.length){const ln=Ke.split(" ");for(let cn=ln.length;cn--;)nn=new RegExp("\\."+ln[cn]+Pi,"i"),f=f.replace(nn,"")}return f.length===0}function Ri(qe,f){let ze=!0;const Ke=Li(qe,f.pop());return Ke&&f.length&&(ze=function(Qe,Pi){let nn,ln=!0;for(;Qe.parentElement&&Qe.parentElement.nodeType===1&&Pi.length;)ln&&(nn=Pi.pop()),ln=Li(Qe=Qe.parentElement,nn);return Pi.length===0}(qe,f)),Ke&&ze&&f.length===0}const Ii=qe=>{var f;return(f=He$1[qe])!==null&&f!==void 0?f:qe},Bi=new RegExp("(".concat(Ve$1,")"),"gi"),Xi=qe=>qe.replace(Bi," $1 ").replace(/,/gi," ").replace(/\s+/gi," ");var Yi,Wi,Vi,zi,Gi,Hi,Ni;const Ui="(".concat(Ve$1,")"),qi=String.raw(Yi||(Yi=r(["(skewX)(",")"],["(skewX)\\(","\\)"])),Ui),Ki=String.raw(Wi||(Wi=r(["(skewY)(",")"],["(skewY)\\(","\\)"])),Ui),Ji=String.raw(Vi||(Vi=r(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),Ui,Ui,Ui),Qi=String.raw(zi||(zi=r(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),Ui,Ui),Zi=String.raw(Gi||(Gi=r(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),Ui,Ui),$i=String.raw(Hi||(Hi=r(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),Ui,Ui,Ui,Ui,Ui,Ui),tr="(?:".concat($i,"|").concat(Zi,"|").concat(Ji,"|").concat(Qi,"|").concat(qi,"|").concat(Ki,")"),er="(?:".concat(tr,"*)"),sr=String.raw(Ni||(Ni=r(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),er),ir=new RegExp(sr),rr=new RegExp(tr),nr=new RegExp(tr,"g");function or(qe){const f=[];if(!(qe=Xi(qe).replace(/\s*([()])\s*/gi,"$1"))||qe&&!ir.test(qe))return[...T];for(const ze of qe.matchAll(nr)){const Ke=rr.exec(ze[0]);if(!Ke)continue;let Qe=T;const Pi=Ke.filter(qn=>!!qn),[,nn,...ln]=Pi,[cn,hn,un,zn,Xn,Un]=ln.map(qn=>parseFloat(qn));switch(nn){case"translate":Qe=Mt$1(cn,hn);break;case B$1:Qe=Pt$1({angle:cn},{x:hn,y:un});break;case G$1:Qe=Et$1(cn,hn);break;case U:Qe=jt$1(cn);break;case q:Qe=Ft$1(cn);break;case"matrix":Qe=[cn,hn,un,zn,Xn,Un]}f.push(Qe)}return Ot$1(f)}function ar(qe,f,ze,Ke){const Qe=Array.isArray(f);let Pi,nn=f;if(qe!==K$1&&qe!==J||f!==j$1){if(qe==="strokeUniform")return f==="non-scaling-stroke";if(qe==="strokeDashArray")nn=f===j$1?null:f.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(qe==="transformMatrix")nn=ze&&ze.transformMatrix?Tt$1(ze.transformMatrix,or(f)):or(f);else if(qe==="visible")nn=f!==j$1&&f!=="hidden",ze&&ze.visible===!1&&(nn=!1);else if(qe==="opacity")nn=parseFloat(f),ze&&ze.opacity!==void 0&&(nn*=ze.opacity);else if(qe==="textAnchor")nn=f==="start"?M$1:f==="end"?A:D$1;else if(qe==="charSpacing")Pi=Re$1(f,Ke)/Ke*1e3;else if(qe==="paintFirst"){const ln=f.indexOf(K$1),cn=f.indexOf(J);nn=K$1,(ln>-1&&cn>-1&&cn<ln||ln===-1&&cn>-1)&&(nn=J)}else{if(qe==="href"||qe==="xlink:href"||qe==="font"||qe==="id")return f;if(qe==="imageSmoothing")return f==="optimizeQuality";Pi=Qe?f.map(Re$1):Re$1(f,Ke)}}else nn="";return!Qe&&isNaN(Pi)?nn:Pi}function hr(qe,f){const ze=qe.match(Ge);if(!ze)return;const Ke=ze[1],Qe=ze[3],Pi=ze[4],nn=ze[5],ln=ze[6];Ke&&(f.fontStyle=Ke),Qe&&(f.fontWeight=isNaN(parseFloat(Qe))?Qe:parseFloat(Qe)),Pi&&(f.fontSize=Re$1(Pi)),ln&&(f.fontFamily=ln),nn&&(f.lineHeight=nn==="normal"?1:nn)}function cr(qe,f){qe.replace(/;\s*$/,"").split(";").forEach(ze=>{if(!ze)return;const[Ke,Qe]=ze.split(":");f[Ke.trim().toLowerCase()]=Qe.trim()})}function lr(qe){const f={},ze=qe.getAttribute("style");return ze&&(typeof ze=="string"?cr(ze,f):function(Ke,Qe){Object.entries(Ke).forEach(Pi=>{let[nn,ln]=Pi;ln!==void 0&&(Qe[nn.toLowerCase()]=ln)})}(ze,f)),f}const ur={stroke:"strokeOpacity",fill:"fillOpacity"};function dr(qe,f,ze){if(!qe)return{};let Ke,Qe={},Pi=O$1;qe.parentNode&&Je.test(qe.parentNode.nodeName)&&(Qe=dr(qe.parentElement,f,ze),Qe.fontSize&&(Ke=Pi=Re$1(Qe.fontSize)));const nn=s(s(s({},f.reduce((hn,un)=>{const zn=qe.getAttribute(un);return zn&&(hn[un]=zn),hn},{})),function(hn){let un=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},zn={};for(const Xn in un)Ri(hn,Xn.split(" "))&&(zn=s(s({},zn),un[Xn]));return zn}(qe,ze)),lr(qe));nn[Ue]&&qe.setAttribute(Ue,nn[Ue]),nn[Ne$1]&&(Ke=Re$1(nn[Ne$1],Pi),nn[Ne$1]="".concat(Ke));const ln={};for(const hn in nn){const un=Ii(hn),zn=ar(un,nn[hn],Qe,Ke);ln[un]=zn}ln&&ln.font&&hr(ln.font,ln);const cn=s(s({},Qe),ln);return Je.test(qe.nodeName)?cn:function(hn){const un=_i.getDefaults();return Object.entries(ur).forEach(zn=>{let[Xn,Un]=zn;if(hn[Un]===void 0||hn[Xn]==="")return;if(hn[Xn]===void 0){if(!un[Xn])return;hn[Xn]=un[Xn]}if(hn[Xn].indexOf("url(")===0)return;const qn=new Le$1(hn[Xn]);hn[Xn]=qn.setAlpha(Vt$1(qn.getAlpha()*hn[Un],2)).toRgba()}),hn}(cn)}const gr=["left","top","width","height","visible"],fr=["rx","ry"];class pr extends _i{static getDefaults(){return s(s({},super.getDefaults()),pr.ownDefaults)}constructor(f){super(),Object.assign(this,pr.ownDefaults),this.setOptions(f),this._initRxRy()}_initRxRy(){const{rx:f,ry:ze}=this;f&&!ze?this.ry=f:ze&&!f&&(this.rx=ze)}_render(f){const{width:ze,height:Ke}=this,Qe=-ze/2,Pi=-Ke/2,nn=this.rx?Math.min(this.rx,ze/2):0,ln=this.ry?Math.min(this.ry,Ke/2):0,cn=nn!==0||ln!==0;f.beginPath(),f.moveTo(Qe+nn,Pi),f.lineTo(Qe+ze-nn,Pi),cn&&f.bezierCurveTo(Qe+ze-k$1*nn,Pi,Qe+ze,Pi+k$1*ln,Qe+ze,Pi+ln),f.lineTo(Qe+ze,Pi+Ke-ln),cn&&f.bezierCurveTo(Qe+ze,Pi+Ke-k$1*ln,Qe+ze-k$1*nn,Pi+Ke,Qe+ze-nn,Pi+Ke),f.lineTo(Qe+nn,Pi+Ke),cn&&f.bezierCurveTo(Qe+k$1*nn,Pi+Ke,Qe,Pi+Ke-k$1*ln,Qe,Pi+Ke-ln),f.lineTo(Qe,Pi+ln),cn&&f.bezierCurveTo(Qe,Pi+k$1*ln,Qe+k$1*nn,Pi,Qe+nn,Pi),f.closePath(),this._renderPaintInOrder(f)}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...fr,...f])}_toSVG(){const{width:f,height:ze,rx:Ke,ry:Qe}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-f/2,'" y="').concat(-ze/2,'" rx="').concat(Ke,'" ry="').concat(Qe,'" width="').concat(f,'" height="').concat(ze,`" />
`)]}static async fromElement(f,ze,Ke){const Qe=dr(f,this.ATTRIBUTE_NAMES,Ke),{left:Pi=0,top:nn=0,width:ln=0,height:cn=0,visible:hn=!0}=Qe,un=i(Qe,gr);return new this(s(s(s({},ze),un),{},{left:Pi,top:nn,width:ln,height:cn,visible:!!(hn&&ln&&cn)}))}}t(pr,"type","Rect"),t(pr,"cacheProperties",[...ps,...fr]),t(pr,"ownDefaults",{rx:0,ry:0}),t(pr,"ATTRIBUTE_NAMES",[...Fi,"x","y","rx","ry","width","height"]),tt.setClass(pr),tt.setSVGClass(pr);const mr="initialization",vr="added",yr="removed",_r="imperative",xr=(qe,f)=>{const{strokeUniform:ze,strokeWidth:Ke,width:Qe,height:Pi,group:nn}=f,ln=nn&&nn!==qe?fe$1(nn.calcTransformMatrix(),qe.calcTransformMatrix()):null,cn=ln?f.getRelativeCenterPoint().transform(ln):f.getRelativeCenterPoint(),hn=!f.isStrokeAccountedForInDimensions(),un=ze&&hn?me$1(new ot$1(Ke,Ke),void 0,qe.calcTransformMatrix()):at$1,zn=!ze&&hn?Ke:0,Xn=ge$1(Qe+zn,Pi+zn,Ot$1([ln,f.calcOwnMatrix()],!0)).add(un).scalarDivide(2);return[cn.subtract(Xn),cn.add(Xn)]};class Cr{calcLayoutResult(f,ze){if(this.shouldPerformLayout(f))return this.calcBoundingBox(ze,f)}shouldPerformLayout(f){let{type:ze,prevStrategy:Ke,strategy:Qe}=f;return ze===mr||ze===_r||!!Ke&&Qe!==Ke}shouldLayoutClipPath(f){let{type:ze,target:{clipPath:Ke}}=f;return ze!==mr&&Ke&&!Ke.absolutePositioned}getInitialSize(f,ze){return ze.size}calcBoundingBox(f,ze){const{type:Ke,target:Qe}=ze;if(Ke===_r&&ze.overrides)return ze.overrides;if(f.length===0)return;const{left:Pi,top:nn,width:ln,height:cn}=ae$1(f.map(zn=>xr(Qe,zn)).reduce((zn,Xn)=>zn.concat(Xn),[])),hn=new ot$1(ln,cn),un=new ot$1(Pi,nn).add(hn.scalarDivide(2));if(Ke===mr){const zn=this.getInitialSize(ze,{size:hn,center:un});return{center:un,relativeCorrection:new ot$1(0,0),size:zn}}return{center:un.transform(Qe.calcOwnMatrix()),size:hn}}}t(Cr,"type","strategy");class br extends Cr{shouldPerformLayout(f){return!0}}t(br,"type","fit-content"),tt.setClass(br);const wr=["strategy"],Sr=["target","strategy","bubbles","prevStrategy"],Tr="layoutManager";class Or{constructor(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new br;t(this,"strategy",void 0),this.strategy=f,this._subscriptions=new Map}performLayout(f){const ze=s(s({bubbles:!0,strategy:this.strategy},f),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}});this.onBeforeLayout(ze);const Ke=this.getLayoutResult(ze);Ke&&this.commitLayout(ze,Ke),this.onAfterLayout(ze,Ke),this._prevLayoutStrategy=ze.strategy}attachHandlers(f,ze){const{target:Ke}=ze;return[Q$1,L,Y$1,I,R,X,z,W$1,V].map(Qe=>f.on(Qe,Pi=>this.performLayout(Qe===Q$1?{type:"object_modified",trigger:Qe,e:Pi,target:Ke}:{type:"object_modifying",trigger:Qe,e:Pi,target:Ke})))}subscribe(f,ze){this.unsubscribe(f,ze);const Ke=this.attachHandlers(f,ze);this._subscriptions.set(f,Ke)}unsubscribe(f,ze){(this._subscriptions.get(f)||[]).forEach(Ke=>Ke()),this._subscriptions.delete(f)}unsubscribeTargets(f){f.targets.forEach(ze=>this.unsubscribe(ze,f))}subscribeTargets(f){f.targets.forEach(ze=>this.subscribe(ze,f))}onBeforeLayout(f){const{target:ze,type:Ke}=f,{canvas:Qe}=ze;if(Ke===mr||Ke===vr?this.subscribeTargets(f):Ke===yr&&this.unsubscribeTargets(f),ze.fire("layout:before",{context:f}),Qe&&Qe.fire("object:layout:before",{target:ze,context:f}),Ke===_r&&f.deep){const Pi=i(f,wr);ze.forEachObject(nn=>nn.layoutManager&&nn.layoutManager.performLayout(s(s({},Pi),{},{bubbles:!1,target:nn})))}}getLayoutResult(f){const{target:ze,strategy:Ke,type:Qe}=f,Pi=Ke.calcLayoutResult(f,ze.getObjects());if(!Pi)return;const nn=Qe===mr?new ot$1:ze.getRelativeCenterPoint(),{center:ln,correction:cn=new ot$1,relativeCorrection:hn=new ot$1}=Pi,un=nn.subtract(ln).add(cn).transform(Qe===mr?T:St$1(ze.calcOwnMatrix()),!0).add(hn);return{result:Pi,prevCenter:nn,nextCenter:ln,offset:un}}commitLayout(f,ze){const{target:Ke}=f,{result:{size:Qe},nextCenter:Pi}=ze;var nn,ln;Ke.set({width:Qe.x,height:Qe.y}),this.layoutObjects(f,ze),f.type===mr?Ke.set({left:(nn=f.x)!==null&&nn!==void 0?nn:Pi.x+Qe.x*xe$1(Ke.originX),top:(ln=f.y)!==null&&ln!==void 0?ln:Pi.y+Qe.y*xe$1(Ke.originY)}):(Ke.setPositionByOrigin(Pi,D$1,D$1),Ke.setCoords(),Ke.set("dirty",!0))}layoutObjects(f,ze){const{target:Ke}=f;Ke.forEachObject(Qe=>{Qe.group===Ke&&this.layoutObject(f,ze,Qe)}),f.strategy.shouldLayoutClipPath(f)&&this.layoutObject(f,ze,Ke.clipPath)}layoutObject(f,ze,Ke){let{offset:Qe}=ze;Ke.set({left:Ke.left+Qe.x,top:Ke.top+Qe.y})}onAfterLayout(f,ze){const{target:Ke,strategy:Qe,bubbles:Pi,prevStrategy:nn}=f,ln=i(f,Sr),{canvas:cn}=Ke;Ke.fire("layout:after",{context:f,result:ze}),cn&&cn.fire("object:layout:after",{context:f,result:ze,target:Ke});const hn=Ke.parent;Pi&&hn!=null&&hn.layoutManager&&((ln.path||(ln.path=[])).push(Ke),hn.layoutManager.performLayout(s(s({},ln),{},{target:hn}))),Ke.set("dirty",!0)}dispose(){const{_subscriptions:f}=this;f.forEach(ze=>ze.forEach(Ke=>Ke())),f.clear()}toObject(){return{type:Tr,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}}tt.setClass(Or,Tr);const kr=["type","objects","layoutManager"];class Dr extends Or{performLayout(){}}class Mr extends ct(_i){static getDefaults(){return s(s({},super.getDefaults()),Mr.ownDefaults)}constructor(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),t(this,"_activeObjects",[]),t(this,"__objectSelectionTracker",void 0),t(this,"__objectSelectionDisposer",void 0),Object.assign(this,Mr.ownDefaults),this.setOptions(ze),this.groupInit(f,ze)}groupInit(f,ze){var Ke;this._objects=[...f],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject(Qe=>{this.enterGroup(Qe,!1)}),this.layoutManager=(Ke=ze.layoutManager)!==null&&Ke!==void 0?Ke:new Or,this.layoutManager.performLayout({type:mr,target:this,targets:[...f],x:ze.left,y:ze.top})}canEnterGroup(f){return f===this||this.isDescendantOf(f)?(a("error","Group: circular object trees are not supported, this call has no effect"),!1):this._objects.indexOf(f)===-1||(a("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(f){return f.filter((ze,Ke,Qe)=>this.canEnterGroup(ze)&&Qe.indexOf(ze)===Ke)}add(){for(var f=arguments.length,ze=new Array(f),Ke=0;Ke<f;Ke++)ze[Ke]=arguments[Ke];const Qe=this._filterObjectsBeforeEnteringGroup(ze),Pi=super.add(...Qe);return this._onAfterObjectsChange(vr,Qe),Pi}insertAt(f){for(var ze=arguments.length,Ke=new Array(ze>1?ze-1:0),Qe=1;Qe<ze;Qe++)Ke[Qe-1]=arguments[Qe];const Pi=this._filterObjectsBeforeEnteringGroup(Ke),nn=super.insertAt(f,...Pi);return this._onAfterObjectsChange(vr,Pi),nn}remove(){const f=super.remove(...arguments);return this._onAfterObjectsChange(yr,f),f}_onObjectAdded(f){this.enterGroup(f,!0),this.fire("object:added",{target:f}),f.fire("added",{target:this})}_onObjectRemoved(f,ze){this.exitGroup(f,ze),this.fire("object:removed",{target:f}),f.fire("removed",{target:this})}_onAfterObjectsChange(f,ze){this.layoutManager.performLayout({type:f,targets:ze,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(f,ze){const Ke=this[f];return super._set(f,ze),f==="canvas"&&Ke!==ze&&(this._objects||[]).forEach(Qe=>{Qe._set(f,ze)}),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(f,ze){let{target:Ke}=ze;const Qe=this._activeObjects;if(f)Qe.push(Ke),this._set("dirty",!0);else if(Qe.length>0){const Pi=Qe.indexOf(Ke);Pi>-1&&(Qe.splice(Pi,1),this._set("dirty",!0))}}_watchObject(f,ze){f&&this._watchObject(!1,ze),f?(ze.on("selected",this.__objectSelectionTracker),ze.on("deselected",this.__objectSelectionDisposer)):(ze.off("selected",this.__objectSelectionTracker),ze.off("deselected",this.__objectSelectionDisposer))}enterGroup(f,ze){f.group&&f.group.remove(f),f._set("parent",this),this._enterGroup(f,ze)}_enterGroup(f,ze){ze&&le$1(f,Tt$1(St$1(this.calcTransformMatrix()),f.calcTransformMatrix())),this._shouldSetNestedCoords()&&f.setCoords(),f._set("group",this),f._set("canvas",this.canvas),this._watchObject(!0,f);const Ke=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();Ke&&(Ke===f||f.isDescendantOf(Ke))&&this._activeObjects.push(f)}exitGroup(f,ze){this._exitGroup(f,ze),f._set("parent",void 0),f._set("canvas",void 0)}_exitGroup(f,ze){f._set("group",void 0),ze||(le$1(f,Tt$1(this.calcTransformMatrix(),f.calcTransformMatrix())),f.setCoords()),this._watchObject(!1,f);const Ke=this._activeObjects.length>0?this._activeObjects.indexOf(f):-1;Ke>-1&&this._activeObjects.splice(Ke,1)}shouldCache(){const f=_i.prototype.shouldCache.call(this);if(f){for(let ze=0;ze<this._objects.length;ze++)if(this._objects[ze].willDrawShadow())return this.ownCaching=!1,!1}return f}willDrawShadow(){if(super.willDrawShadow())return!0;for(let f=0;f<this._objects.length;f++)if(this._objects[f].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(f,ze,Ke){this._renderBackground(f);for(let Pi=0;Pi<this._objects.length;Pi++){var Qe;const nn=this._objects[Pi];(Qe=this.canvas)!==null&&Qe!==void 0&&Qe.preserveObjectStacking&&nn.group!==this?(f.save(),f.transform(...St$1(this.calcTransformMatrix())),nn.render(f),f.restore()):nn.group===this&&nn.render(f)}this._drawClipPath(f,this.clipPath,Ke)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject(f=>f.setCoords())}triggerLayout(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.layoutManager.performLayout(s({target:this,type:_r},f))}render(f){this._transformDone=!0,super.render(f),this._transformDone=!1}__serializeObjects(f,ze){const Ke=this.includeDefaultValues;return this._objects.filter(function(Qe){return!Qe.excludeFromExport}).map(function(Qe){const Pi=Qe.includeDefaultValues;Qe.includeDefaultValues=Ke;const nn=Qe[f||"toObject"](ze);return Qe.includeDefaultValues=Pi,nn})}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const ze=this.layoutManager.toObject();return s(s(s({},super.toObject(["subTargetCheck","interactive",...f])),ze.strategy!=="fit-content"||this.includeDefaultValues?{layoutManager:ze}:{}),{},{objects:this.__serializeObjects("toObject",f)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject(f=>{this._watchObject(!1,f),f.dispose()}),super.dispose()}_createSVGBgRect(f){if(!this.backgroundColor)return"";const ze=pr.prototype._toSVG.call(this),Ke=ze.indexOf("COMMON_PARTS");ze[Ke]='for="group" ';const Qe=ze.join("");return f?f(Qe):Qe}_toSVG(f){const ze=["<g ","COMMON_PARTS",` >
`],Ke=this._createSVGBgRect(f);Ke&&ze.push("		",Ke);for(let Qe=0;Qe<this._objects.length;Qe++)ze.push("		",this._objects[Qe].toSVG(f));return ze.push(`</g>
`),ze}getSvgStyles(){const f=this.opacity!==void 0&&this.opacity!==1?"opacity: ".concat(this.opacity,";"):"",ze=this.visible?"":" visibility: hidden;";return[f,this.getSvgFilter(),ze].join("")}toClipPathSVG(f){const ze=[],Ke=this._createSVGBgRect(f);Ke&&ze.push("	",Ke);for(let Qe=0;Qe<this._objects.length;Qe++)ze.push("	",this._objects[Qe].toClipPathSVG(f));return this._createBaseClipPathSVGMarkup(ze,{reviver:f})}static fromObject(f,ze){let{type:Ke,objects:Qe=[],layoutManager:Pi}=f,nn=i(f,kr);return Promise.all([Bt$1(Qe,ze),Xt$1(nn,ze)]).then(ln=>{let[cn,hn]=ln;const un=new this(cn,s(s(s({},nn),hn),{},{layoutManager:new Dr}));if(Pi){const zn=tt.getClass(Pi.type),Xn=tt.getClass(Pi.strategy);un.layoutManager=new zn(new Xn)}else un.layoutManager=new Or;return un.layoutManager.subscribeTargets({type:mr,target:un,targets:un.getObjects()}),un.setCoords(),un})}}t(Mr,"type","Group"),t(Mr,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),tt.setClass(Mr);const Pr=(qe,f)=>Math.min(f.width/qe.width,f.height/qe.height),Er=(qe,f)=>Math.max(f.width/qe.width,f.height/qe.height),Ar="\\s*,?\\s*",jr="".concat(Ar,"(").concat(Ve$1,")"),Fr="".concat(jr).concat(jr).concat(jr).concat(Ar,"([01])").concat(Ar,"([01])").concat(jr).concat(jr),Lr={m:"l",M:"L"},Rr=(qe,f,ze,Ke,Qe,Pi,nn,ln,cn,hn,un)=>{const zn=rt$1(qe),Xn=nt$1(qe),Un=rt$1(f),qn=nt$1(f),ys=ze*Qe*Un-Ke*Pi*qn+nn,vs=Ke*Qe*Un+ze*Pi*qn+ln;return["C",hn+cn*(-ze*Qe*Xn-Ke*Pi*zn),un+cn*(-Ke*Qe*Xn+ze*Pi*zn),ys+cn*(ze*Qe*qn+Ke*Pi*Un),vs+cn*(Ke*Qe*qn-ze*Pi*Un),ys,vs]},Ir=(qe,f,ze,Ke)=>{const Qe=Math.atan2(f,qe),Pi=Math.atan2(Ke,ze);return Pi>=Qe?Pi-Qe:2*Math.PI-(Qe-Pi)};function Br(qe,f,ze,Ke,Qe,Pi,nn,ln){let cn;if(o.cachesBoundsOfCurve&&(cn=[...arguments].join(),_.boundsOfCurveCache[cn]))return _.boundsOfCurveCache[cn];const hn=Math.sqrt,un=Math.abs,zn=[],Xn=[[0,0],[0,0]];let Un=6*qe-12*ze+6*Qe,qn=-3*qe+9*ze-9*Qe+3*nn,ys=3*ze-3*qe;for(let ra=0;ra<2;++ra){if(ra>0&&(Un=6*f-12*Ke+6*Pi,qn=-3*f+9*Ke-9*Pi+3*ln,ys=3*Ke-3*f),un(qn)<1e-12){if(un(Un)<1e-12)continue;const ua=-ys/Un;0<ua&&ua<1&&zn.push(ua);continue}const oa=Un*Un-4*ys*qn;if(oa<0)continue;const fa=hn(oa),ca=(-Un+fa)/(2*qn);0<ca&&ca<1&&zn.push(ca);const la=(-Un-fa)/(2*qn);0<la&&la<1&&zn.push(la)}let vs=zn.length;const ea=vs,na=Vr(qe,f,ze,Ke,Qe,Pi,nn,ln);for(;vs--;){const{x:ra,y:oa}=na(zn[vs]);Xn[0][vs]=ra,Xn[1][vs]=oa}Xn[0][ea]=qe,Xn[1][ea]=f,Xn[0][ea+1]=nn,Xn[1][ea+1]=ln;const ta=[new ot$1(Math.min(...Xn[0]),Math.min(...Xn[1])),new ot$1(Math.max(...Xn[0]),Math.max(...Xn[1]))];return o.cachesBoundsOfCurve&&(_.boundsOfCurveCache[cn]=ta),ta}const Xr=(qe,f,ze)=>{let[Ke,Qe,Pi,nn,ln,cn,hn,un]=ze;const zn=((Xn,Un,qn,ys,vs,ea,na)=>{if(qn===0||ys===0)return[];let ta=0,ra=0,oa=0;const fa=Math.PI,ca=na*S$1,la=nt$1(ca),ua=rt$1(ca),ga=.5*(-ua*Xn-la*Un),da=.5*(-ua*Un+la*Xn),qa=qn**2,tl=ys**2,ol=da**2,hl=ga**2,wl=qa*tl-qa*ol-tl*hl;let _l=Math.abs(qn),gl=Math.abs(ys);if(wl<0){const rl=Math.sqrt(1-wl/(qa*tl));_l*=rl,gl*=rl}else oa=(vs===ea?-1:1)*Math.sqrt(wl/(qa*ol+tl*hl));const dl=oa*_l*da/gl,sl=-oa*gl*ga/_l,kl=ua*dl-la*sl+.5*Xn,pl=la*dl+ua*sl+.5*Un;let Al=Ir(1,0,(ga-dl)/_l,(da-sl)/gl),xl=Ir((ga-dl)/_l,(da-sl)/gl,(-ga-dl)/_l,(-da-sl)/gl);ea===0&&xl>0?xl-=2*fa:ea===1&&xl<0&&(xl+=2*fa);const al=Math.ceil(Math.abs(xl/fa*2)),Fl=[],Ol=xl/al,Jo=8/3*Math.sin(Ol/4)*Math.sin(Ol/4)/Math.sin(Ol/2);let cl=Al+Ol;for(let rl=0;rl<al;rl++)Fl[rl]=Rr(Al,cl,ua,la,_l,gl,kl,pl,Jo,ta,ra),ta=Fl[rl][5],ra=Fl[rl][6],Al=cl,cl+=Ol;return Fl})(hn-qe,un-f,Qe,Pi,ln,cn,nn);for(let Xn=0,Un=zn.length;Xn<Un;Xn++)zn[Xn][1]+=qe,zn[Xn][2]+=f,zn[Xn][3]+=qe,zn[Xn][4]+=f,zn[Xn][5]+=qe,zn[Xn][6]+=f;return zn},Yr=qe=>{let f=0,ze=0,Ke=0,Qe=0;const Pi=[];let nn,ln=0,cn=0;for(const hn of qe){const un=[...hn];let zn;switch(un[0]){case"l":un[1]+=f,un[2]+=ze;case"L":f=un[1],ze=un[2],zn=["L",f,ze];break;case"h":un[1]+=f;case"H":f=un[1],zn=["L",f,ze];break;case"v":un[1]+=ze;case"V":ze=un[1],zn=["L",f,ze];break;case"m":un[1]+=f,un[2]+=ze;case"M":f=un[1],ze=un[2],Ke=un[1],Qe=un[2],zn=["M",f,ze];break;case"c":un[1]+=f,un[2]+=ze,un[3]+=f,un[4]+=ze,un[5]+=f,un[6]+=ze;case"C":ln=un[3],cn=un[4],f=un[5],ze=un[6],zn=["C",un[1],un[2],ln,cn,f,ze];break;case"s":un[1]+=f,un[2]+=ze,un[3]+=f,un[4]+=ze;case"S":nn==="C"?(ln=2*f-ln,cn=2*ze-cn):(ln=f,cn=ze),f=un[3],ze=un[4],zn=["C",ln,cn,un[1],un[2],f,ze],ln=zn[3],cn=zn[4];break;case"q":un[1]+=f,un[2]+=ze,un[3]+=f,un[4]+=ze;case"Q":ln=un[1],cn=un[2],f=un[3],ze=un[4],zn=["Q",ln,cn,f,ze];break;case"t":un[1]+=f,un[2]+=ze;case"T":nn==="Q"?(ln=2*f-ln,cn=2*ze-cn):(ln=f,cn=ze),f=un[1],ze=un[2],zn=["Q",ln,cn,f,ze];break;case"a":un[6]+=f,un[7]+=ze;case"A":Xr(f,ze,un).forEach(Xn=>Pi.push(Xn)),f=un[6],ze=un[7];break;case"z":case"Z":f=Ke,ze=Qe,zn=["Z"]}zn?(Pi.push(zn),nn=zn[0]):nn=""}return Pi},Wr=(qe,f,ze,Ke)=>Math.sqrt((ze-qe)**2+(Ke-f)**2),Vr=(qe,f,ze,Ke,Qe,Pi,nn,ln)=>cn=>{const hn=cn**3,un=(Un=>3*Un**2*(1-Un))(cn),zn=(Un=>3*Un*(1-Un)**2)(cn),Xn=(Un=>(1-Un)**3)(cn);return new ot$1(nn*hn+Qe*un+ze*zn+qe*Xn,ln*hn+Pi*un+Ke*zn+f*Xn)},zr=qe=>qe**2,Gr=qe=>2*qe*(1-qe),Hr=qe=>(1-qe)**2,Nr=(qe,f,ze,Ke,Qe,Pi,nn,ln)=>cn=>{const hn=zr(cn),un=Gr(cn),zn=Hr(cn),Xn=3*(zn*(ze-qe)+un*(Qe-ze)+hn*(nn-Qe)),Un=3*(zn*(Ke-f)+un*(Pi-Ke)+hn*(ln-Pi));return Math.atan2(Un,Xn)},Ur=(qe,f,ze,Ke,Qe,Pi)=>nn=>{const ln=zr(nn),cn=Gr(nn),hn=Hr(nn);return new ot$1(Qe*ln+ze*cn+qe*hn,Pi*ln+Ke*cn+f*hn)},qr=(qe,f,ze,Ke,Qe,Pi)=>nn=>{const ln=1-nn,cn=2*(ln*(ze-qe)+nn*(Qe-ze)),hn=2*(ln*(Ke-f)+nn*(Pi-Ke));return Math.atan2(hn,cn)},Kr=(qe,f,ze)=>{let Ke=new ot$1(f,ze),Qe=0;for(let Pi=1;Pi<=100;Pi+=1){const nn=qe(Pi/100);Qe+=Wr(Ke.x,Ke.y,nn.x,nn.y),Ke=nn}return Qe},Jr=(qe,f)=>{let ze,Ke=0,Qe=0,Pi={x:qe.x,y:qe.y},nn=s({},Pi),ln=.01,cn=0;const hn=qe.iterator,un=qe.angleFinder;for(;Qe<f&&ln>1e-4;)nn=hn(Ke),cn=Ke,ze=Wr(Pi.x,Pi.y,nn.x,nn.y),ze+Qe>f?(Ke-=ln,ln/=2):(Pi=nn,Ke+=ln,Qe+=ze);return s(s({},nn),{},{angle:un(cn)})},Qr=qe=>{let f,ze,Ke=0,Qe=0,Pi=0,nn=0,ln=0;const cn=[];for(const hn of qe){const un={x:Qe,y:Pi,command:hn[0],length:0};switch(hn[0]){case"M":ze=un,ze.x=nn=Qe=hn[1],ze.y=ln=Pi=hn[2];break;case"L":ze=un,ze.length=Wr(Qe,Pi,hn[1],hn[2]),Qe=hn[1],Pi=hn[2];break;case"C":f=Vr(Qe,Pi,hn[1],hn[2],hn[3],hn[4],hn[5],hn[6]),ze=un,ze.iterator=f,ze.angleFinder=Nr(Qe,Pi,hn[1],hn[2],hn[3],hn[4],hn[5],hn[6]),ze.length=Kr(f,Qe,Pi),Qe=hn[5],Pi=hn[6];break;case"Q":f=Ur(Qe,Pi,hn[1],hn[2],hn[3],hn[4]),ze=un,ze.iterator=f,ze.angleFinder=qr(Qe,Pi,hn[1],hn[2],hn[3],hn[4]),ze.length=Kr(f,Qe,Pi),Qe=hn[3],Pi=hn[4];break;case"Z":ze=un,ze.destX=nn,ze.destY=ln,ze.length=Wr(Qe,Pi,nn,ln),Qe=nn,Pi=ln}Ke+=ze.length,cn.push(ze)}return cn.push({length:Ke,x:Qe,y:Pi}),cn},Zr=function(qe,f){let ze=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Qr(qe),Ke=0;for(;f-ze[Ke].length>0&&Ke<ze.length-2;)f-=ze[Ke].length,Ke++;const Qe=ze[Ke],Pi=f/Qe.length,nn=qe[Ke];switch(Qe.command){case"M":return{x:Qe.x,y:Qe.y,angle:0};case"Z":return s(s({},new ot$1(Qe.x,Qe.y).lerp(new ot$1(Qe.destX,Qe.destY),Pi)),{},{angle:Math.atan2(Qe.destY-Qe.y,Qe.destX-Qe.x)});case"L":return s(s({},new ot$1(Qe.x,Qe.y).lerp(new ot$1(nn[1],nn[2]),Pi)),{},{angle:Math.atan2(nn[2]-Qe.y,nn[1]-Qe.x)});case"C":case"Q":return Jr(Qe,f)}},$r=new RegExp("[mzlhvcsqta][^mzlhvcsqta]*","gi"),tn=new RegExp(Fr,"g"),en=new RegExp(Ve$1,"gi"),sn={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},rn=qe=>{var f;const ze=[],Ke=(f=qe.match($r))!==null&&f!==void 0?f:[];for(const Qe of Ke){const Pi=Qe[0];if(Pi==="z"||Pi==="Z"){ze.push([Pi]);continue}const nn=sn[Pi.toLowerCase()];let ln=[];if(Pi==="a"||Pi==="A"){tn.lastIndex=0;for(let cn=null;cn=tn.exec(Qe);)ln.push(...cn.slice(1))}else ln=Qe.match(en)||[];for(let cn=0;cn<ln.length;cn+=nn){const hn=new Array(nn),un=Lr[Pi];hn[0]=cn>0&&un?un:Pi;for(let zn=0;zn<nn;zn++)hn[zn+1]=parseFloat(ln[cn+zn]);ze.push(hn)}}return ze},on=(qe,f)=>qe.map(ze=>ze.map((Ke,Qe)=>Qe===0||f===void 0?Ke:Vt$1(Ke,f)).join(" ")).join(" ");function an(qe,f){const ze=qe.style;ze&&f&&(typeof f=="string"?ze.cssText+=";"+f:Object.entries(f).forEach(Ke=>{let[Qe,Pi]=Ke;return ze.setProperty(Qe,Pi)}))}class dn extends te$1{constructor(f){let{allowTouchScrolling:ze=!1,containerClass:Ke=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(f),t(this,"upper",void 0),t(this,"container",void 0);const{el:Qe}=this.lower,Pi=this.createUpperCanvas();this.upper={el:Pi,ctx:Pi.getContext("2d")},this.applyCanvasStyle(Qe,{allowTouchScrolling:ze}),this.applyCanvasStyle(Pi,{allowTouchScrolling:ze,styles:{position:"absolute",left:"0",top:"0"}});const nn=this.createContainerElement();nn.classList.add(Ke),Qe.parentNode&&Qe.parentNode.replaceChild(nn,Qe),nn.append(Qe,Pi),this.container=nn}createUpperCanvas(){const{el:f}=this.lower,ze=pt$1();return ze.className=f.className,ze.classList.remove("lower-canvas"),ze.classList.add("upper-canvas"),ze.setAttribute("data-fabric","top"),ze.style.cssText=f.style.cssText,ze.setAttribute("draggable","true"),ze}createContainerElement(){const f=m().createElement("div");return f.setAttribute("data-fabric","wrapper"),an(f,{position:"relative"}),$t$1(f),f}applyCanvasStyle(f,ze){const{styles:Ke,allowTouchScrolling:Qe}=ze;an(f,s(s({},Ke),{},{"touch-action":Qe?"manipulation":j$1})),$t$1(f)}setDimensions(f,ze){super.setDimensions(f,ze);const{el:Ke,ctx:Qe}=this.upper;Qt$1(Ke,Qe,f,ze)}setCSSDimensions(f){super.setCSSDimensions(f),Zt$1(this.upper.el,f),Zt$1(this.container,f)}cleanupDOM(f){const ze=this.container,{el:Ke}=this.lower,{el:Qe}=this.upper;super.cleanupDOM(f),ze.removeChild(Qe),ze.removeChild(Ke),ze.parentNode&&ze.parentNode.replaceChild(Ke,ze)}dispose(){super.dispose(),p$1().dispose(this.upper.el),delete this.upper,delete this.container}}class gn extends se$1{constructor(){super(...arguments),t(this,"targets",[]),t(this,"_hoveredTargets",[]),t(this,"_objectsToRender",void 0),t(this,"_currentTransform",null),t(this,"_groupSelector",null),t(this,"contextTopDirty",!1)}static getDefaults(){return s(s({},super.getDefaults()),gn.ownDefaults)}get upperCanvasEl(){var f;return(f=this.elements.upper)===null||f===void 0?void 0:f.el}get contextTop(){var f;return(f=this.elements.upper)===null||f===void 0?void 0:f.ctx}get wrapperEl(){return this.elements.container}initElements(f){this.elements=new dn(f,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(f){this._objectsToRender=void 0,super._onObjectAdded(f)}_onObjectRemoved(f){this._objectsToRender=void 0,f===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[f]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[f]}),f.fire("deselected",{target:f})),f===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(f)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){const f=this._activeObject;return!this.preserveObjectStacking&&f?this._objects.filter(ze=>!ze.group&&ze!==f).concat(f):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(f){f.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(f),this.contextTopDirty=!0),f.restore()}renderTop(){const f=this.contextTop;this.clearContext(f),this.renderTopLayer(f),this.fire("after:render",{ctx:f})}setTargetFindTolerance(f){f=Math.round(f),this.targetFindTolerance=f;const ze=this.getRetinaScaling(),Ke=Math.ceil((2*f+1)*ze);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=Ke,this.pixelFindContext.scale(ze,ze)}isTargetTransparent(f,ze,Ke){const Qe=this.targetFindTolerance,Pi=this.pixelFindContext;this.clearContext(Pi),Pi.save(),Pi.translate(-ze+Qe,-Ke+Qe),Pi.transform(...this.viewportTransform);const nn=f.selectionBackgroundColor;f.selectionBackgroundColor="",f.render(Pi),f.selectionBackgroundColor=nn,Pi.restore();const ln=Math.round(Qe*this.getRetinaScaling());return xi(Pi,ln,ln,ln)}_isSelectionKeyPressed(f){const ze=this.selectionKey;return!!ze&&(Array.isArray(ze)?!!ze.find(Ke=>!!Ke&&f[Ke]===!0):f[ze])}_shouldClearSelection(f,ze){const Ke=this.getActiveObjects(),Qe=this._activeObject;return!!(!ze||ze&&Qe&&Ke.length>1&&Ke.indexOf(ze)===-1&&Qe!==ze&&!this._isSelectionKeyPressed(f)||ze&&!ze.evented||ze&&!ze.selectable&&Qe&&Qe!==ze)}_shouldCenterTransform(f,ze,Ke){if(!f)return;let Qe;return ze===G$1||ze===H||ze===N$1||ze===Y$1?Qe=this.centeredScaling||f.centeredScaling:ze===B$1&&(Qe=this.centeredRotation||f.centeredRotation),Qe?!Ke:Ke}_getOriginFromCorner(f,ze){const Ke={x:f.originX,y:f.originY};return ze&&(["ml","tl","bl"].includes(ze)?Ke.x=A:["mr","tr","br"].includes(ze)&&(Ke.x=M$1),["tl","mt","tr"].includes(ze)?Ke.y=E$1:["bl","mb","br"].includes(ze)&&(Ke.y=P)),Ke}_setupCurrentTransform(f,ze,Ke){var Qe;const Pi=ze.group?pe$1(this.getScenePoint(f),void 0,ze.group.calcTransformMatrix()):this.getScenePoint(f),{key:nn="",control:ln}=ze.getActiveControl()||{},cn=Ke&&ln?(Qe=ln.getActionHandler(f,ze,ln))===null||Qe===void 0?void 0:Qe.bind(ln):De$1,hn=((Un,qn,ys,vs)=>{if(!qn||!Un)return"drag";const ea=vs.controls[qn];return ea.getActionName(ys,ea,vs)})(Ke,nn,f,ze),un=f[this.centeredKey],zn=this._shouldCenterTransform(ze,hn,un)?{x:D$1,y:D$1}:this._getOriginFromCorner(ze,nn),Xn={target:ze,action:hn,actionHandler:cn,actionPerformed:!1,corner:nn,scaleX:ze.scaleX,scaleY:ze.scaleY,skewX:ze.skewX,skewY:ze.skewY,offsetX:Pi.x-ze.left,offsetY:Pi.y-ze.top,originX:zn.x,originY:zn.y,ex:Pi.x,ey:Pi.y,lastX:Pi.x,lastY:Pi.y,theta:xt$1(ze.angle),width:ze.width,height:ze.height,shiftKey:f.shiftKey,altKey:un,original:s(s({},de$1(ze)),{},{originX:zn.x,originY:zn.y})};this._currentTransform=Xn,this.fire("before:transform",{e:f,transform:Xn})}setCursor(f){this.upperCanvasEl.style.cursor=f}_drawSelection(f){const{x:ze,y:Ke,deltaX:Qe,deltaY:Pi}=this._groupSelector,nn=new ot$1(ze,Ke).transform(this.viewportTransform),ln=new ot$1(ze+Qe,Ke+Pi).transform(this.viewportTransform),cn=this.selectionLineWidth/2;let hn=Math.min(nn.x,ln.x),un=Math.min(nn.y,ln.y),zn=Math.max(nn.x,ln.x),Xn=Math.max(nn.y,ln.y);this.selectionColor&&(f.fillStyle=this.selectionColor,f.fillRect(hn,un,zn-hn,Xn-un)),this.selectionLineWidth&&this.selectionBorderColor&&(f.lineWidth=this.selectionLineWidth,f.strokeStyle=this.selectionBorderColor,hn+=cn,un+=cn,zn-=cn,Xn-=cn,_i.prototype._setLineDash.call(this,f,this.selectionDashArray),f.strokeRect(hn,un,zn-hn,Xn-un))}findTarget(f){if(this.skipTargetFind)return;const ze=this.getViewportPoint(f),Ke=this._activeObject,Qe=this.getActiveObjects();if(this.targets=[],Ke&&Qe.length>=1){if(Ke.findControl(ze,ne$1(f))||Qe.length>1&&this.searchPossibleTargets([Ke],ze))return Ke;if(Ke===this.searchPossibleTargets([Ke],ze)){if(this.preserveObjectStacking){const Pi=this.targets;this.targets=[];const nn=this.searchPossibleTargets(this._objects,ze);return f[this.altSelectionKey]&&nn&&nn!==Ke?(this.targets=Pi,Ke):nn}return Ke}}return this.searchPossibleTargets(this._objects,ze)}_pointIsInObjectSelectionArea(f,ze){let Ke=f.getCoords();const Qe=this.getZoom(),Pi=f.padding/Qe;if(Pi){const[nn,ln,cn,hn]=Ke,un=Math.atan2(ln.y-nn.y,ln.x-nn.x),zn=rt$1(un)*Pi,Xn=nt$1(un)*Pi,Un=zn+Xn,qn=zn-Xn;Ke=[new ot$1(nn.x-qn,nn.y-Un),new ot$1(ln.x+Un,ln.y-qn),new ot$1(cn.x+qn,cn.y+Un),new ot$1(hn.x-Un,hn.y+qn)]}return Ls.isPointInPolygon(ze,Ke)}_checkTarget(f,ze){return!!(f&&f.visible&&f.evented&&this._pointIsInObjectSelectionArea(f,pe$1(ze,void 0,this.viewportTransform))&&(!this.perPixelTargetFind&&!f.perPixelTargetFind||f.isEditing||!this.isTargetTransparent(f,ze.x,ze.y)))}_searchPossibleTargets(f,ze){let Ke=f.length;for(;Ke--;){const Qe=f[Ke];if(this._checkTarget(Qe,ze)){if(ht$1(Qe)&&Qe.subTargetCheck){const Pi=this._searchPossibleTargets(Qe._objects,ze);Pi&&this.targets.push(Pi)}return Qe}}}searchPossibleTargets(f,ze){const Ke=this._searchPossibleTargets(f,ze);if(Ke&&ht$1(Ke)&&Ke.interactive&&this.targets[0]){const Qe=this.targets;for(let Pi=Qe.length-1;Pi>0;Pi--){const nn=Qe[Pi];if(!ht$1(nn)||!nn.interactive)return nn}return Qe[0]}return Ke}getViewportPoint(f){return this._pointer?this._pointer:this.getPointer(f,!0)}getScenePoint(f){return this._absolutePointer?this._absolutePointer:this.getPointer(f)}getPointer(f){let ze=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const Ke=this.upperCanvasEl,Qe=Ke.getBoundingClientRect();let Pi=re$1(f),nn=Qe.width||0,ln=Qe.height||0;nn&&ln||(P in Qe&&E$1 in Qe&&(ln=Math.abs(Qe.top-Qe.bottom)),A in Qe&&M$1 in Qe&&(nn=Math.abs(Qe.right-Qe.left))),this.calcOffset(),Pi.x=Pi.x-this._offset.left,Pi.y=Pi.y-this._offset.top,ze||(Pi=pe$1(Pi,void 0,this.viewportTransform));const cn=this.getRetinaScaling();cn!==1&&(Pi.x/=cn,Pi.y/=cn);const hn=nn===0||ln===0?new ot$1(1,1):new ot$1(Ke.width/nn,Ke.height/ln);return Pi.multiply(hn)}_setDimensionsImpl(f,ze){this._resetTransformEventData(),super._setDimensionsImpl(f,ze),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=pt$1(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){const f=this._activeObject;return Ut$1(f)?f.getObjects():f?[f]:[]}_fireSelectionEvents(f,ze){let Ke=!1,Qe=!1;const Pi=this.getActiveObjects(),nn=[],ln=[];f.forEach(cn=>{Pi.includes(cn)||(Ke=!0,cn.fire("deselected",{e:ze,target:cn}),ln.push(cn))}),Pi.forEach(cn=>{f.includes(cn)||(Ke=!0,cn.fire("selected",{e:ze,target:cn}),nn.push(cn))}),f.length>0&&Pi.length>0?(Qe=!0,Ke&&this.fire("selection:updated",{e:ze,selected:nn,deselected:ln})):Pi.length>0?(Qe=!0,this.fire("selection:created",{e:ze,selected:nn})):f.length>0&&(Qe=!0,this.fire("selection:cleared",{e:ze,deselected:ln})),Qe&&(this._objectsToRender=void 0)}setActiveObject(f,ze){const Ke=this.getActiveObjects(),Qe=this._setActiveObject(f,ze);return this._fireSelectionEvents(Ke,ze),Qe}_setActiveObject(f,ze){const Ke=this._activeObject;return Ke!==f&&!(!this._discardActiveObject(ze,f)&&this._activeObject)&&!f.onSelect({e:ze})&&(this._activeObject=f,Ut$1(f)&&Ke!==f&&f.set("canvas",this),f.setCoords(),!0)}_discardActiveObject(f,ze){const Ke=this._activeObject;return!!Ke&&!Ke.onDeselect({e:f,object:ze})&&(this._currentTransform&&this._currentTransform.target===Ke&&this.endCurrentTransform(f),Ut$1(Ke)&&Ke===this._hoveredTarget&&(this._hoveredTarget=void 0),this._activeObject=void 0,!0)}discardActiveObject(f){const ze=this.getActiveObjects(),Ke=this.getActiveObject();ze.length&&this.fire("before:selection:cleared",{e:f,deselected:[Ke]});const Qe=this._discardActiveObject(f);return this._fireSelectionEvents(ze,f),Qe}endCurrentTransform(f){const ze=this._currentTransform;this._finalizeCurrentTransform(f),ze&&ze.target&&(ze.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(f){const ze=this._currentTransform,Ke=ze.target,Qe={e:f,target:Ke,transform:ze,action:ze.action};Ke._scaling&&(Ke._scaling=!1),Ke.setCoords(),ze.actionPerformed&&(this.fire("object:modified",Qe),Ke.fire(Q$1,Qe))}setViewportTransform(f){super.setViewportTransform(f);const ze=this._activeObject;ze&&ze.setCoords()}destroy(){const f=this._activeObject;Ut$1(f)&&(f.removeAll(),f.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(f){const ze=this._activeObject;ze&&ze._renderControls(f)}_toObject(f,ze,Ke){const Qe=this._realizeGroupTransformOnObject(f),Pi=super._toObject(f,ze,Ke);return f.set(Qe),Pi}_realizeGroupTransformOnObject(f){const{group:ze}=f;if(ze&&Ut$1(ze)&&this._activeObject===ze){const Ke=Yt$1(f,["angle","flipX","flipY",M$1,H,N$1,U,q,P]);return ce$1(f,ze.calcOwnMatrix()),Ke}return{}}_setSVGObject(f,ze,Ke){const Qe=this._realizeGroupTransformOnObject(ze);super._setSVGObject(f,ze,Ke),ze.set(Qe)}}t(gn,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});class fn{constructor(f){t(this,"targets",[]),t(this,"__disposer",void 0);const ze=()=>{const{hiddenTextarea:Qe}=f.getActiveObject()||{};Qe&&Qe.focus()},Ke=f.upperCanvasEl;Ke.addEventListener("click",ze),this.__disposer=()=>Ke.removeEventListener("click",ze)}exitTextEditing(){this.target=void 0,this.targets.forEach(f=>{f.isEditing&&f.exitEditing()})}add(f){this.targets.push(f)}remove(f){this.unregister(f),it$1(this.targets,f)}register(f){this.target=f}unregister(f){f===this.target&&(this.target=void 0)}onMouseMove(f){var ze;!((ze=this.target)===null||ze===void 0)&&ze.isEditing&&this.target.updateSelectionOnMouseMove(f)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}const pn=["target","oldTarget","fireCanvas","e"],mn={passive:!1},vn=(qe,f)=>{const ze=qe.getViewportPoint(f),Ke=qe.getScenePoint(f);return{viewportPoint:ze,scenePoint:Ke,pointer:ze,absolutePointer:Ke}},yn=function(qe){for(var f=arguments.length,ze=new Array(f>1?f-1:0),Ke=1;Ke<f;Ke++)ze[Ke-1]=arguments[Ke];return qe.addEventListener(...ze)},_n=function(qe){for(var f=arguments.length,ze=new Array(f>1?f-1:0),Ke=1;Ke<f;Ke++)ze[Ke-1]=arguments[Ke];return qe.removeEventListener(...ze)},xn={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class Cn extends gn{constructor(f){super(f,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}),t(this,"_isClick",void 0),t(this,"textEditingManager",new fn(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach(ze=>{this[ze]=this[ze].bind(this)}),this.addOrRemove(yn,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(f,ze){const Ke=this.upperCanvasEl,Qe=this._getEventPrefix();f(Jt$1(Ke),"resize",this._onResize),f(Ke,Qe+"down",this._onMouseDown),f(Ke,"".concat(Qe,"move"),this._onMouseMove,mn),f(Ke,"".concat(Qe,"out"),this._onMouseOut),f(Ke,"".concat(Qe,"enter"),this._onMouseEnter),f(Ke,"wheel",this._onMouseWheel),f(Ke,"contextmenu",this._onContextMenu),f(Ke,"click",this._onClick),f(Ke,"dblclick",this._onClick),f(Ke,"dragstart",this._onDragStart),f(Ke,"dragend",this._onDragEnd),f(Ke,"dragover",this._onDragOver),f(Ke,"dragenter",this._onDragEnter),f(Ke,"dragleave",this._onDragLeave),f(Ke,"drop",this._onDrop),this.enablePointerEvents||f(Ke,"touchstart",this._onTouchStart,mn)}removeListeners(){this.addOrRemove(_n,"remove");const f=this._getEventPrefix(),ze=Kt$1(this.upperCanvasEl);_n(ze,"".concat(f,"up"),this._onMouseUp),_n(ze,"touchend",this._onTouchEnd,mn),_n(ze,"".concat(f,"move"),this._onMouseMove,mn),_n(ze,"touchmove",this._onMouseMove,mn),clearTimeout(this._willAddMouseDown)}_onMouseWheel(f){this.__onMouseWheel(f)}_onMouseOut(f){const ze=this._hoveredTarget,Ke=s({e:f},vn(this,f));this.fire("mouse:out",s(s({},Ke),{},{target:ze})),this._hoveredTarget=void 0,ze&&ze.fire("mouseout",s({},Ke)),this._hoveredTargets.forEach(Qe=>{this.fire("mouse:out",s(s({},Ke),{},{target:Qe})),Qe&&Qe.fire("mouseout",s({},Ke))}),this._hoveredTargets=[]}_onMouseEnter(f){this._currentTransform||this.findTarget(f)||(this.fire("mouse:over",s({e:f},vn(this,f))),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(f){this._isClick=!1;const ze=this.getActiveObject();if(ze&&ze.onDragStart(f)){this._dragSource=ze;const Ke={e:f,target:ze};return this.fire("dragstart",Ke),ze.fire("dragstart",Ke),void yn(this.upperCanvasEl,"drag",this._onDragProgress)}oe$1(f)}_renderDragEffects(f,ze,Ke){let Qe=!1;const Pi=this._dropTarget;Pi&&Pi!==ze&&Pi!==Ke&&(Pi.clearContextTop(),Qe=!0),ze==null||ze.clearContextTop(),Ke!==ze&&(Ke==null||Ke.clearContextTop());const nn=this.contextTop;nn.save(),nn.transform(...this.viewportTransform),ze&&(nn.save(),ze.transform(nn),ze.renderDragSourceEffect(f),nn.restore(),Qe=!0),Ke&&(nn.save(),Ke.transform(nn),Ke.renderDropTargetEffect(f),nn.restore(),Qe=!0),nn.restore(),Qe&&(this.contextTopDirty=!0)}_onDragEnd(f){const ze=!!f.dataTransfer&&f.dataTransfer.dropEffect!==j$1,Ke=ze?this._activeObject:void 0,Qe={e:f,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:ze,dropTarget:Ke};_n(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",Qe),this._dragSource&&this._dragSource.fire("dragend",Qe),delete this._dragSource,this._onMouseUp(f)}_onDragProgress(f){const ze={e:f,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",ze),this._dragSource&&this._dragSource.fire("drag",ze)}findDragTargets(f){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(f)),targets:[...this.targets]}}_onDragOver(f){const ze="dragover",{target:Ke,targets:Qe}=this.findDragTargets(f),Pi=this._dragSource,nn={e:f,target:Ke,subTargets:Qe,dragSource:Pi,canDrop:!1,dropTarget:void 0};let ln;this.fire(ze,nn),this._fireEnterLeaveEvents(Ke,nn),Ke&&(Ke.canDrop(f)&&(ln=Ke),Ke.fire(ze,nn));for(let cn=0;cn<Qe.length;cn++){const hn=Qe[cn];hn.canDrop(f)&&(ln=hn),hn.fire(ze,nn)}this._renderDragEffects(f,Pi,ln),this._dropTarget=ln}_onDragEnter(f){const{target:ze,targets:Ke}=this.findDragTargets(f),Qe={e:f,target:ze,subTargets:Ke,dragSource:this._dragSource};this.fire("dragenter",Qe),this._fireEnterLeaveEvents(ze,Qe)}_onDragLeave(f){const ze={e:f,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",ze),this._fireEnterLeaveEvents(void 0,ze),this._renderDragEffects(f,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(f){const{target:ze,targets:Ke}=this.findDragTargets(f),Qe=this._basicEventHandler("drop:before",s({e:f,target:ze,subTargets:Ke,dragSource:this._dragSource},vn(this,f)));Qe.didDrop=!1,Qe.dropTarget=void 0,this._basicEventHandler("drop",Qe),this.fire("drop:after",Qe)}_onContextMenu(f){const ze=this.findTarget(f),Ke=this.targets||[],Qe=this._basicEventHandler("contextmenu:before",{e:f,target:ze,subTargets:Ke});return this.stopContextMenu&&oe$1(f),this._basicEventHandler("contextmenu",Qe),!1}_onClick(f){const ze=f.detail;ze>3||ze<2||(this._cacheTransformEventData(f),ze==2&&f.type==="dblclick"&&this._handleEvent(f,"dblclick"),ze==3&&this._handleEvent(f,"tripleclick"),this._resetTransformEventData())}getPointerId(f){const ze=f.changedTouches;return ze?ze[0]&&ze[0].identifier:this.enablePointerEvents?f.pointerId:-1}_isMainEvent(f){return f.isPrimary===!0||f.isPrimary!==!1&&(f.type==="touchend"&&f.touches.length===0||!f.changedTouches||f.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(f){let ze=!this.allowTouchScrolling;const Ke=this._activeObject;this.mainTouchId===void 0&&(this.mainTouchId=this.getPointerId(f)),this.__onMouseDown(f),(this.isDrawingMode||Ke&&this._target===Ke)&&(ze=!0),ze&&f.preventDefault(),this._resetTransformEventData();const Qe=this.upperCanvasEl,Pi=this._getEventPrefix(),nn=Kt$1(Qe);yn(nn,"touchend",this._onTouchEnd,mn),ze&&yn(nn,"touchmove",this._onMouseMove,mn),_n(Qe,"".concat(Pi,"down"),this._onMouseDown)}_onMouseDown(f){this.__onMouseDown(f),this._resetTransformEventData();const ze=this.upperCanvasEl,Ke=this._getEventPrefix();_n(ze,"".concat(Ke,"move"),this._onMouseMove,mn);const Qe=Kt$1(ze);yn(Qe,"".concat(Ke,"up"),this._onMouseUp),yn(Qe,"".concat(Ke,"move"),this._onMouseMove,mn)}_onTouchEnd(f){if(f.touches.length>0)return;this.__onMouseUp(f),this._resetTransformEventData(),delete this.mainTouchId;const ze=this._getEventPrefix(),Ke=Kt$1(this.upperCanvasEl);_n(Ke,"touchend",this._onTouchEnd,mn),_n(Ke,"touchmove",this._onMouseMove,mn),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(()=>{yn(this.upperCanvasEl,"".concat(ze,"down"),this._onMouseDown),this._willAddMouseDown=0},400)}_onMouseUp(f){this.__onMouseUp(f),this._resetTransformEventData();const ze=this.upperCanvasEl,Ke=this._getEventPrefix();if(this._isMainEvent(f)){const Qe=Kt$1(this.upperCanvasEl);_n(Qe,"".concat(Ke,"up"),this._onMouseUp),_n(Qe,"".concat(Ke,"move"),this._onMouseMove,mn),yn(ze,"".concat(Ke,"move"),this._onMouseMove,mn)}}_onMouseMove(f){const ze=this.getActiveObject();!this.allowTouchScrolling&&(!ze||!ze.shouldStartDragging(f))&&f.preventDefault&&f.preventDefault(),this.__onMouseMove(f)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(f){const ze=this.getActiveObject();return!!ze!=!!f||ze&&f&&ze!==f}__onMouseUp(f){var ze;this._cacheTransformEventData(f),this._handleEvent(f,"up:before");const Ke=this._currentTransform,Qe=this._isClick,Pi=this._target,{button:nn}=f;if(nn)return(this.fireMiddleClick&&nn===1||this.fireRightClick&&nn===2)&&this._handleEvent(f,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(f);if(!this._isMainEvent(f))return;let ln,cn,hn=!1;if(Ke&&(this._finalizeCurrentTransform(f),hn=Ke.actionPerformed),!Qe){const un=Pi===this._activeObject;this.handleSelection(f),hn||(hn=this._shouldRender(Pi)||!un&&Pi===this._activeObject)}if(Pi){const un=Pi.findControl(this.getViewportPoint(f),ne$1(f)),{key:zn,control:Xn}=un||{};if(cn=zn,Pi.selectable&&Pi!==this._activeObject&&Pi.activeOn==="up")this.setActiveObject(Pi,f),hn=!0;else if(Xn){const Un=Xn.getMouseUpHandler(f,Pi,Xn);Un&&(ln=this.getScenePoint(f),Un.call(Xn,f,Ke,ln.x,ln.y))}Pi.isMoving=!1}if(Ke&&(Ke.target!==Pi||Ke.corner!==cn)){const un=Ke.target&&Ke.target.controls[Ke.corner],zn=un&&un.getMouseUpHandler(f,Ke.target,un);ln=ln||this.getScenePoint(f),zn&&zn.call(un,f,Ke,ln.x,ln.y)}this._setCursorFromEvent(f,Pi),this._handleEvent(f,"up"),this._groupSelector=null,this._currentTransform=null,Pi&&(Pi.__corner=void 0),hn?this.requestRenderAll():Qe||(ze=this._activeObject)!==null&&ze!==void 0&&ze.isEditing||this.renderTop()}_basicEventHandler(f,ze){const{target:Ke,subTargets:Qe=[]}=ze;this.fire(f,ze),Ke&&Ke.fire(f,ze);for(let Pi=0;Pi<Qe.length;Pi++)Qe[Pi]!==Ke&&Qe[Pi].fire(f,ze);return ze}_handleEvent(f,ze,Ke){const Qe=this._target,Pi=this.targets||[],nn=s(s(s({e:f,target:Qe,subTargets:Pi},vn(this,f)),{},{transform:this._currentTransform},ze==="up:before"||ze==="up"?{isClick:this._isClick,currentTarget:this.findTarget(f),currentSubTargets:this.targets}:{}),ze==="down:before"||ze==="down"?Ke:{});this.fire("mouse:".concat(ze),nn),Qe&&Qe.fire("mouse".concat(ze),nn);for(let ln=0;ln<Pi.length;ln++)Pi[ln]!==Qe&&Pi[ln].fire("mouse".concat(ze),nn)}_onMouseDownInDrawingMode(f){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(f),this.requestRenderAll());const ze=this.getScenePoint(f);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(ze,{e:f,pointer:ze}),this._handleEvent(f,"down",{alreadySelected:!1})}_onMouseMoveInDrawingMode(f){if(this._isCurrentlyDrawing){const ze=this.getScenePoint(f);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(ze,{e:f,pointer:ze})}this.setCursor(this.freeDrawingCursor),this._handleEvent(f,"move")}_onMouseUpInDrawingMode(f){const ze=this.getScenePoint(f);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:f,pointer:ze}):this._isCurrentlyDrawing=!1,this._handleEvent(f,"up")}__onMouseDown(f){this._isClick=!0,this._cacheTransformEventData(f),this._handleEvent(f,"down:before");let ze=this._target,Ke=!!ze&&ze===this._activeObject;const{button:Qe}=f;if(Qe)return(this.fireMiddleClick&&Qe===1||this.fireRightClick&&Qe===2)&&this._handleEvent(f,"down",{alreadySelected:Ke}),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(f);if(!this._isMainEvent(f)||this._currentTransform)return;let Pi=this._shouldRender(ze),nn=!1;if(this.handleMultiSelection(f,ze)?(ze=this._activeObject,nn=!0,Pi=!0):this._shouldClearSelection(f,ze)&&this.discardActiveObject(f),this.selection&&(!ze||!ze.selectable&&!ze.isEditing&&ze!==this._activeObject)){const ln=this.getScenePoint(f);this._groupSelector={x:ln.x,y:ln.y,deltaY:0,deltaX:0}}if(Ke=!!ze&&ze===this._activeObject,ze){ze.selectable&&ze.activeOn==="down"&&this.setActiveObject(ze,f);const ln=ze.findControl(this.getViewportPoint(f),ne$1(f));if(ze===this._activeObject&&(ln||!nn)){this._setupCurrentTransform(f,ze,Ke);const cn=ln?ln.control:void 0,hn=this.getScenePoint(f),un=cn&&cn.getMouseDownHandler(f,ze,cn);un&&un.call(cn,f,this._currentTransform,hn.x,hn.y)}}Pi&&(this._objectsToRender=void 0),this._handleEvent(f,"down",{alreadySelected:Ke}),Pi&&this.requestRenderAll()}_resetTransformEventData(){this._target=this._pointer=this._absolutePointer=void 0}_cacheTransformEventData(f){this._resetTransformEventData(),this._pointer=this.getViewportPoint(f),this._absolutePointer=pe$1(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(f)}__onMouseMove(f){if(this._isClick=!1,this._cacheTransformEventData(f),this._handleEvent(f,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(f);if(!this._isMainEvent(f))return;const ze=this._groupSelector;if(ze){const Ke=this.getScenePoint(f);ze.deltaX=Ke.x-ze.x,ze.deltaY=Ke.y-ze.y,this.renderTop()}else if(this._currentTransform)this._transformObject(f);else{const Ke=this.findTarget(f);this._setCursorFromEvent(f,Ke),this._fireOverOutEvents(f,Ke)}this.textEditingManager.onMouseMove(f),this._handleEvent(f,"move"),this._resetTransformEventData()}_fireOverOutEvents(f,ze){const Ke=this._hoveredTarget,Qe=this._hoveredTargets,Pi=this.targets,nn=Math.max(Qe.length,Pi.length);this.fireSyntheticInOutEvents("mouse",{e:f,target:ze,oldTarget:Ke,fireCanvas:!0});for(let ln=0;ln<nn;ln++)this.fireSyntheticInOutEvents("mouse",{e:f,target:Pi[ln],oldTarget:Qe[ln]});this._hoveredTarget=ze,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(f,ze){const Ke=this._draggedoverTarget,Qe=this._hoveredTargets,Pi=this.targets,nn=Math.max(Qe.length,Pi.length);this.fireSyntheticInOutEvents("drag",s(s({},ze),{},{target:f,oldTarget:Ke,fireCanvas:!0}));for(let ln=0;ln<nn;ln++)this.fireSyntheticInOutEvents("drag",s(s({},ze),{},{target:Pi[ln],oldTarget:Qe[ln]}));this._draggedoverTarget=f}fireSyntheticInOutEvents(f,ze){let{target:Ke,oldTarget:Qe,fireCanvas:Pi,e:nn}=ze,ln=i(ze,pn);const{targetIn:cn,targetOut:hn,canvasIn:un,canvasOut:zn}=xn[f],Xn=Qe!==Ke;if(Qe&&Xn){const Un=s(s({},ln),{},{e:nn,target:Qe,nextTarget:Ke},vn(this,nn));Pi&&this.fire(zn,Un),Qe.fire(hn,Un)}if(Ke&&Xn){const Un=s(s({},ln),{},{e:nn,target:Ke,previousTarget:Qe},vn(this,nn));Pi&&this.fire(un,Un),Ke.fire(cn,Un)}}__onMouseWheel(f){this._cacheTransformEventData(f),this._handleEvent(f,"wheel"),this._resetTransformEventData()}_transformObject(f){const ze=this.getScenePoint(f),Ke=this._currentTransform,Qe=Ke.target,Pi=Qe.group?pe$1(ze,void 0,Qe.group.calcTransformMatrix()):ze;Ke.shiftKey=f.shiftKey,Ke.altKey=!!this.centeredKey&&f[this.centeredKey],this._performTransformAction(f,Ke,Pi),Ke.actionPerformed&&this.requestRenderAll()}_performTransformAction(f,ze,Ke){const{action:Qe,actionHandler:Pi,target:nn}=ze,ln=!!Pi&&Pi(f,ze,Ke.x,Ke.y);ln&&nn.setCoords(),Qe==="drag"&&ln&&(ze.target.isMoving=!0,this.setCursor(ze.target.moveCursor||this.moveCursor)),ze.actionPerformed=ze.actionPerformed||ln}_setCursorFromEvent(f,ze){if(!ze)return void this.setCursor(this.defaultCursor);let Ke=ze.hoverCursor||this.hoverCursor;const Qe=Ut$1(this._activeObject)?this._activeObject:null,Pi=(!Qe||ze.group!==Qe)&&ze.findControl(this.getViewportPoint(f));if(Pi){const nn=Pi.control;this.setCursor(nn.cursorStyleHandler(f,nn,ze))}else ze.subTargetCheck&&this.targets.concat().reverse().map(nn=>{Ke=nn.hoverCursor||Ke}),this.setCursor(Ke)}handleMultiSelection(f,ze){const Ke=this._activeObject,Qe=Ut$1(Ke);if(Ke&&this._isSelectionKeyPressed(f)&&this.selection&&ze&&ze.selectable&&(Ke!==ze||Qe)&&(Qe||!ze.isDescendantOf(Ke)&&!Ke.isDescendantOf(ze))&&!ze.onSelect({e:f})&&!Ke.getActiveControl()){if(Qe){const Pi=Ke.getObjects();if(ze===Ke){const nn=this.getViewportPoint(f);if(!(ze=this.searchPossibleTargets(Pi,nn)||this.searchPossibleTargets(this._objects,nn))||!ze.selectable)return!1}ze.group===Ke?(Ke.remove(ze),this._hoveredTarget=ze,this._hoveredTargets=[...this.targets],Ke.size()===1&&this._setActiveObject(Ke.item(0),f)):(Ke.multiSelectAdd(ze),this._hoveredTarget=Ke,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(Pi,f)}else{Ke.isEditing&&Ke.exitEditing();const Pi=new(tt.getClass("ActiveSelection"))([],{canvas:this});Pi.multiSelectAdd(Ke,ze),this._hoveredTarget=Pi,this._setActiveObject(Pi,f),this._fireSelectionEvents([Ke],f)}return!0}return!1}handleSelection(f){if(!this.selection||!this._groupSelector)return!1;const{x:ze,y:Ke,deltaX:Qe,deltaY:Pi}=this._groupSelector,nn=new ot$1(ze,Ke),ln=nn.add(new ot$1(Qe,Pi)),cn=nn.min(ln),hn=nn.max(ln).subtract(cn),un=this.collectObjects({left:cn.x,top:cn.y,width:hn.x,height:hn.y},{includeIntersecting:!this.selectionFullyContained}),zn=nn.eq(ln)?un[0]?[un[0]]:[]:un.length>1?un.filter(Xn=>!Xn.onSelect({e:f})).reverse():un;if(zn.length===1)this.setActiveObject(zn[0],f);else if(zn.length>1){const Xn=tt.getClass("ActiveSelection");this.setActiveObject(new Xn(zn,{canvas:this}),f)}return this._groupSelector=null,!0}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}const bn={x1:0,y1:0,x2:0,y2:0},wn=s(s({},bn),{},{r1:0,r2:0}),Sn=(qe,f)=>isNaN(qe)&&typeof f=="number"?f:qe,Tn=/^(\d+\.\d+)%|(\d+)%$/;function On(qe){return qe&&Tn.test(qe)}function kn(qe,f){const ze=typeof qe=="number"?qe:typeof qe=="string"?parseFloat(qe)/(On(qe)?100:1):NaN;return gs(0,Sn(ze,f),1)}const Dn=/\s*;\s*/,Mn=/\s*:\s*/;function Pn(qe,f){let ze,Ke;const Qe=qe.getAttribute("style");if(Qe){const nn=Qe.split(Dn);nn[nn.length-1]===""&&nn.pop();for(let ln=nn.length;ln--;){const[cn,hn]=nn[ln].split(Mn).map(un=>un.trim());cn==="stop-color"?ze=hn:cn==="stop-opacity"&&(Ke=hn)}}const Pi=new Le$1(ze||qe.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:kn(qe.getAttribute("offset"),0),color:Pi.toRgb(),opacity:Sn(parseFloat(Ke||qe.getAttribute("stop-opacity")||""),1)*Pi.getAlpha()*f}}function En(qe,f){const ze=[],Ke=qe.getElementsByTagName("stop"),Qe=kn(f,1);for(let Pi=Ke.length;Pi--;)ze.push(Pn(Ke[Pi],Qe));return ze}function An(qe){return qe.nodeName==="linearGradient"||qe.nodeName==="LINEARGRADIENT"?"linear":"radial"}function jn(qe){return qe.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage"}function Fn(qe,f){return qe.getAttribute(f)}function Ln(qe,f){return function(ze,Ke){let Qe,{width:Pi,height:nn,gradientUnits:ln}=Ke;return Object.keys(ze).reduce((cn,hn)=>{const un=ze[hn];return un==="Infinity"?Qe=1:un==="-Infinity"?Qe=0:(Qe=typeof un=="string"?parseFloat(un):un,typeof un=="string"&&On(un)&&(Qe*=.01,ln==="pixels"&&(hn!=="x1"&&hn!=="x2"&&hn!=="r2"||(Qe*=Pi),hn!=="y1"&&hn!=="y2"||(Qe*=nn)))),cn[hn]=Qe,cn},{})}(An(qe)==="linear"?function(ze){return{x1:Fn(ze,"x1")||0,y1:Fn(ze,"y1")||0,x2:Fn(ze,"x2")||"100%",y2:Fn(ze,"y2")||0}}(qe):function(ze){return{x1:Fn(ze,"fx")||Fn(ze,"cx")||"50%",y1:Fn(ze,"fy")||Fn(ze,"cy")||"50%",r1:0,x2:Fn(ze,"cx")||"50%",y2:Fn(ze,"cy")||"50%",r2:Fn(ze,"r")||"50%"}}(qe),s(s({},f),{},{gradientUnits:jn(qe)}))}class Rn{constructor(f){const{type:ze="linear",gradientUnits:Ke="pixels",coords:Qe={},colorStops:Pi=[],offsetX:nn=0,offsetY:ln=0,gradientTransform:cn,id:hn}=f||{};Object.assign(this,{type:ze,gradientUnits:Ke,coords:s(s({},ze==="radial"?wn:bn),Qe),colorStops:Pi,offsetX:nn,offsetY:ln,gradientTransform:cn,id:hn?"".concat(hn,"_").concat(ft$1()):ft$1()})}addColorStop(f){for(const ze in f){const Ke=new Le$1(f[ze]);this.colorStops.push({offset:parseFloat(ze),color:Ke.toRgb(),opacity:Ke.getAlpha()})}return this}toObject(f){return s(s({},Yt$1(this,f)),{},{type:this.type,coords:s({},this.coords),colorStops:this.colorStops.map(ze=>s({},ze)),offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0})}toSVG(f){let{additionalTransform:ze}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const Ke=[],Qe=this.gradientTransform?this.gradientTransform.concat():T.concat(),Pi=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox",nn=this.colorStops.map(zn=>s({},zn)).sort((zn,Xn)=>zn.offset-Xn.offset);let ln=-this.offsetX,cn=-this.offsetY;var hn;Pi==="objectBoundingBox"?(ln/=f.width,cn/=f.height):(ln+=f.width/2,cn+=f.height/2),(hn=f)&&typeof hn._renderPathCommands=="function"&&this.gradientUnits!=="percentage"&&(ln-=f.pathOffset.x,cn-=f.pathOffset.y),Qe[4]-=ln,Qe[5]-=cn;const un=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(Pi,'"'),'gradientTransform="'.concat(ze?ze+" ":"").concat(zt$1(Qe),'"'),""].join(" ");if(this.type==="linear"){const{x1:zn,y1:Xn,x2:Un,y2:qn}=this.coords;Ke.push("<linearGradient ",un,' x1="',zn,'" y1="',Xn,'" x2="',Un,'" y2="',qn,`">
`)}else if(this.type==="radial"){const{x1:zn,y1:Xn,x2:Un,y2:qn,r1:ys,r2:vs}=this.coords,ea=ys>vs;Ke.push("<radialGradient ",un,' cx="',ea?zn:Un,'" cy="',ea?Xn:qn,'" r="',ea?ys:vs,'" fx="',ea?Un:zn,'" fy="',ea?qn:Xn,`">
`),ea&&(nn.reverse(),nn.forEach(ta=>{ta.offset=1-ta.offset}));const na=Math.min(ys,vs);if(na>0){const ta=na/Math.max(ys,vs);nn.forEach(ra=>{ra.offset+=ta*(1-ra.offset)})}}return nn.forEach(zn=>{let{color:Xn,offset:Un,opacity:qn}=zn;Ke.push("<stop ",'offset="',100*Un+"%",'" style="stop-color:',Xn,qn!==void 0?";stop-opacity: "+qn:";",`"/>
`)}),Ke.push(this.type==="linear"?"</linearGradient>":"</radialGradient>",`
`),Ke.join("")}toLive(f){const{x1:ze,y1:Ke,x2:Qe,y2:Pi,r1:nn,r2:ln}=this.coords,cn=this.type==="linear"?f.createLinearGradient(ze,Ke,Qe,Pi):f.createRadialGradient(ze,Ke,nn,Qe,Pi,ln);return this.colorStops.forEach(hn=>{let{color:un,opacity:zn,offset:Xn}=hn;cn.addColorStop(Xn,zn!==void 0?new Le$1(un).setAlpha(zn).toRgba():un)}),cn}static async fromObject(f){const{colorStops:ze,gradientTransform:Ke}=f;return new this(s(s({},f),{},{colorStops:ze?ze.map(Qe=>s({},Qe)):void 0,gradientTransform:Ke?[...Ke]:void 0}))}static fromElement(f,ze,Ke){const Qe=jn(f),Pi=ze._findCenterFromElement();return new this(s({id:f.getAttribute("id")||void 0,type:An(f),coords:Ln(f,{width:Ke.viewBoxWidth||Ke.width,height:Ke.viewBoxHeight||Ke.height}),colorStops:En(f,Ke.opacity),gradientUnits:Qe,gradientTransform:or(f.getAttribute("gradientTransform")||"")},Qe==="pixels"?{offsetX:ze.width/2-Pi.x,offsetY:ze.height/2-Pi.y}:{offsetX:0,offsetY:0}))}}t(Rn,"type","Gradient"),tt.setClass(Rn,"gradient"),tt.setClass(Rn,"linear"),tt.setClass(Rn,"radial");const In=["type","source","patternTransform"];class Bn{get type(){return"pattern"}set type(f){a("warn","Setting type has no effect",f)}constructor(f){t(this,"repeat","repeat"),t(this,"offsetX",0),t(this,"offsetY",0),t(this,"crossOrigin",""),this.id=ft$1(),Object.assign(this,f)}isImageSource(){return!!this.source&&typeof this.source.src=="string"}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(f){return this.source&&(!this.isImageSource()||this.source.complete&&this.source.naturalWidth!==0&&this.source.naturalHeight!==0)?f.createPattern(this.source,this.repeat):null}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const{repeat:ze,crossOrigin:Ke}=this;return s(s({},Yt$1(this,f)),{},{type:"pattern",source:this.sourceToString(),repeat:ze,crossOrigin:Ke,offsetX:Vt$1(this.offsetX,o.NUM_FRACTION_DIGITS),offsetY:Vt$1(this.offsetY,o.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(f){let{width:ze,height:Ke}=f;const{source:Qe,repeat:Pi,id:nn}=this,ln=Sn(this.offsetX/ze,0),cn=Sn(this.offsetY/Ke,0),hn=Pi==="repeat-y"||Pi==="no-repeat"?1+Math.abs(ln||0):Sn(Qe.width/ze,0),un=Pi==="repeat-x"||Pi==="no-repeat"?1+Math.abs(cn||0):Sn(Qe.height/Ke,0);return['<pattern id="SVGID_'.concat(nn,'" x="').concat(ln,'" y="').concat(cn,'" width="').concat(hn,'" height="').concat(un,'">'),'<image x="0" y="0" width="'.concat(Qe.width,'" height="').concat(Qe.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join(`
`)}static async fromObject(f,ze){let{type:Ke,source:Qe,patternTransform:Pi}=f,nn=i(f,In);const ln=await It$1(Qe,s(s({},ze),{},{crossOrigin:nn.crossOrigin}));return new this(s(s({},nn),{},{patternTransform:Pi&&Pi.slice(0),source:ln}))}}t(Bn,"type","Pattern"),tt.setClass(Bn),tt.setClass(Bn,"pattern");const Yn=["path","left","top"],Wn=["d"];class Vn extends _i{constructor(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{path:Ke,left:Qe,top:Pi}=ze,nn=i(ze,Yn);super(),Object.assign(this,Vn.ownDefaults),this.setOptions(nn),this._setPath(f||[],!0),typeof Qe=="number"&&this.set(M$1,Qe),typeof Pi=="number"&&this.set(P,Pi)}_setPath(f,ze){this.path=Yr(Array.isArray(f)?f:rn(f)),this.setBoundingBox(ze)}_findCenterFromElement(){const f=this._calcBoundsFromPath();return new ot$1(f.left+f.width/2,f.top+f.height/2)}_renderPathCommands(f){const ze=-this.pathOffset.x,Ke=-this.pathOffset.y;f.beginPath();for(const Qe of this.path)switch(Qe[0]){case"L":f.lineTo(Qe[1]+ze,Qe[2]+Ke);break;case"M":f.moveTo(Qe[1]+ze,Qe[2]+Ke);break;case"C":f.bezierCurveTo(Qe[1]+ze,Qe[2]+Ke,Qe[3]+ze,Qe[4]+Ke,Qe[5]+ze,Qe[6]+Ke);break;case"Q":f.quadraticCurveTo(Qe[1]+ze,Qe[2]+Ke,Qe[3]+ze,Qe[4]+Ke);break;case"Z":f.closePath()}}_render(f){this._renderPathCommands(f),this._renderPaintInOrder(f)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return s(s({},super.toObject(f)),{},{path:this.path.map(ze=>ze.slice())})}toDatalessObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const ze=this.toObject(f);return this.sourcePath&&(delete ze.path,ze.sourcePath=this.sourcePath),ze}_toSVG(){const f=on(this.path,o.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(f,`" stroke-linecap="round" />
`)]}_getOffsetTransform(){const f=o.NUM_FRACTION_DIGITS;return" translate(".concat(Vt$1(-this.pathOffset.x,f),", ").concat(Vt$1(-this.pathOffset.y,f),")")}toClipPathSVG(f){const ze=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:f,additionalTransform:ze})}toSVG(f){const ze=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:f,additionalTransform:ze})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(f){const{width:ze,height:Ke,pathOffset:Qe}=this._calcDimensions();this.set({width:ze,height:Ke,pathOffset:Qe}),f&&this.setPositionByOrigin(Qe,D$1,D$1)}_calcBoundsFromPath(){const f=[];let ze=0,Ke=0,Qe=0,Pi=0;for(const nn of this.path)switch(nn[0]){case"L":Qe=nn[1],Pi=nn[2],f.push({x:ze,y:Ke},{x:Qe,y:Pi});break;case"M":Qe=nn[1],Pi=nn[2],ze=Qe,Ke=Pi;break;case"C":f.push(...Br(Qe,Pi,nn[1],nn[2],nn[3],nn[4],nn[5],nn[6])),Qe=nn[5],Pi=nn[6];break;case"Q":f.push(...Br(Qe,Pi,nn[1],nn[2],nn[1],nn[2],nn[3],nn[4])),Qe=nn[3],Pi=nn[4];break;case"Z":Qe=ze,Pi=Ke}return ae$1(f)}_calcDimensions(){const f=this._calcBoundsFromPath();return s(s({},f),{},{pathOffset:new ot$1(f.left+f.width/2,f.top+f.height/2)})}static fromObject(f){return this._fromObject(f,{extraParam:"path"})}static async fromElement(f,ze,Ke){const Qe=dr(f,this.ATTRIBUTE_NAMES,Ke),{d:Pi}=Qe;return new this(Pi,s(s(s({},i(Qe,Wn)),ze),{},{left:void 0,top:void 0}))}}t(Vn,"type","Path"),t(Vn,"cacheProperties",[...ps,"path","fillRule"]),t(Vn,"ATTRIBUTE_NAMES",[...Fi,"d"]),tt.setClass(Vn),tt.setSVGClass(Vn);const Gn=["left","top","radius"],Hn=["radius","startAngle","endAngle","counterClockwise"];class Nn extends _i{static getDefaults(){return s(s({},super.getDefaults()),Nn.ownDefaults)}constructor(f){super(),Object.assign(this,Nn.ownDefaults),this.setOptions(f)}_set(f,ze){return super._set(f,ze),f==="radius"&&this.setRadius(ze),this}_render(f){f.beginPath(),f.arc(0,0,this.radius,xt$1(this.startAngle),xt$1(this.endAngle),this.counterClockwise),this._renderPaintInOrder(f)}getRadiusX(){return this.get("radius")*this.get(H)}getRadiusY(){return this.get("radius")*this.get(N$1)}setRadius(f){this.radius=f,this.set({width:2*f,height:2*f})}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...Hn,...f])}_toSVG(){const f=(this.endAngle-this.startAngle)%360;if(f===0)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),`" />
`];{const{radius:ze}=this,Ke=xt$1(this.startAngle),Qe=xt$1(this.endAngle),Pi=rt$1(Ke)*ze,nn=nt$1(Ke)*ze,ln=rt$1(Qe)*ze,cn=nt$1(Qe)*ze,hn=f>180?1:0,un=this.counterClockwise?0:1;return['<path d="M '.concat(Pi," ").concat(nn," A ").concat(ze," ").concat(ze," 0 ").concat(hn," ").concat(un," ").concat(ln," ").concat(cn,'" '),"COMMON_PARTS",` />
`]}}static async fromElement(f,ze,Ke){const Qe=dr(f,this.ATTRIBUTE_NAMES,Ke),{left:Pi=0,top:nn=0,radius:ln=0}=Qe;return new this(s(s({},i(Qe,Gn)),{},{radius:ln,left:Pi-ln,top:nn-ln}))}static fromObject(f){return super._fromObject(f)}}t(Nn,"type","Circle"),t(Nn,"cacheProperties",[...ps,...Hn]),t(Nn,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),t(Nn,"ATTRIBUTE_NAMES",["cx","cy","r",...Fi]),tt.setClass(Nn),tt.setSVGClass(Nn);const Jn=["x1","y1","x2","y2"],Qn=["x1","y1","x2","y2"],Zn=["x1","x2","y1","y2"];class $n extends _i{constructor(){let[f,ze,Ke,Qe]=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0,0],Pi=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,$n.ownDefaults),this.setOptions(Pi),this.x1=f,this.x2=Ke,this.y1=ze,this.y2=Qe,this._setWidthHeight();const{left:nn,top:ln}=Pi;typeof nn=="number"&&this.set(M$1,nn),typeof ln=="number"&&this.set(P,ln)}_setWidthHeight(){const{x1:f,y1:ze,x2:Ke,y2:Qe}=this;this.width=Math.abs(Ke-f),this.height=Math.abs(Qe-ze);const{left:Pi,top:nn,width:ln,height:cn}=ae$1([{x:f,y:ze},{x:Ke,y:Qe}]),hn=new ot$1(Pi+ln/2,nn+cn/2);this.setPositionByOrigin(hn,D$1,D$1)}_set(f,ze){return super._set(f,ze),Zn.includes(f)&&this._setWidthHeight(),this}_render(f){f.beginPath();const ze=this.calcLinePoints();f.moveTo(ze.x1,ze.y1),f.lineTo(ze.x2,ze.y2),f.lineWidth=this.strokeWidth;const Ke=f.strokeStyle;var Qe;Gt$1(this.stroke)?f.strokeStyle=this.stroke.toLive(f):f.strokeStyle=(Qe=this.stroke)!==null&&Qe!==void 0?Qe:f.fillStyle,this.stroke&&this._renderStroke(f),f.strokeStyle=Ke}_findCenterFromElement(){return new ot$1((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return s(s({},super.toObject(f)),this.calcLinePoints())}_getNonTransformedDimensions(){const f=super._getNonTransformedDimensions();return this.strokeLineCap==="butt"&&(this.width===0&&(f.y-=this.strokeWidth),this.height===0&&(f.x-=this.strokeWidth)),f}calcLinePoints(){const{x1:f,x2:ze,y1:Ke,y2:Qe,width:Pi,height:nn}=this,ln=f<=ze?-1:1,cn=Ke<=Qe?-1:1;return{x1:ln*Pi/2,x2:ln*-Pi/2,y1:cn*nn/2,y2:cn*-nn/2}}_toSVG(){const{x1:f,x2:ze,y1:Ke,y2:Qe}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(f,'" y1="').concat(Ke,'" x2="').concat(ze,'" y2="').concat(Qe,`" />
`)]}static async fromElement(f,ze,Ke){const Qe=dr(f,this.ATTRIBUTE_NAMES,Ke),{x1:Pi=0,y1:nn=0,x2:ln=0,y2:cn=0}=Qe;return new this([Pi,nn,ln,cn],i(Qe,Jn))}static fromObject(f){let{x1:ze,y1:Ke,x2:Qe,y2:Pi}=f,nn=i(f,Qn);return this._fromObject(s(s({},nn),{},{points:[ze,Ke,Qe,Pi]}),{extraParam:"points"})}}t($n,"type","Line"),t($n,"cacheProperties",[...ps,...Zn]),t($n,"ATTRIBUTE_NAMES",Fi.concat(Zn)),tt.setClass($n),tt.setSVGClass($n);class to extends _i{static getDefaults(){return s(s({},super.getDefaults()),to.ownDefaults)}constructor(f){super(),Object.assign(this,to.ownDefaults),this.setOptions(f)}_render(f){const ze=this.width/2,Ke=this.height/2;f.beginPath(),f.moveTo(-ze,Ke),f.lineTo(0,-Ke),f.lineTo(ze,Ke),f.closePath(),this._renderPaintInOrder(f)}_toSVG(){const f=this.width/2,ze=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-f," ").concat(ze,",0 ").concat(-ze,",").concat(f," ").concat(ze),'" />']}}t(to,"type","Triangle"),t(to,"ownDefaults",{width:100,height:100}),tt.setClass(to),tt.setSVGClass(to);const eo=["rx","ry"];class so extends _i{static getDefaults(){return s(s({},super.getDefaults()),so.ownDefaults)}constructor(f){super(),Object.assign(this,so.ownDefaults),this.setOptions(f)}_set(f,ze){switch(super._set(f,ze),f){case"rx":this.rx=ze,this.set("width",2*ze);break;case"ry":this.ry=ze,this.set("height",2*ze)}return this}getRx(){return this.get("rx")*this.get(H)}getRy(){return this.get("ry")*this.get(N$1)}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...eo,...f])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,`" />
`)]}_render(f){f.beginPath(),f.save(),f.transform(1,0,0,this.ry/this.rx,0,0),f.arc(0,0,this.rx,0,w$1,!1),f.restore(),this._renderPaintInOrder(f)}static async fromElement(f,ze,Ke){const Qe=dr(f,this.ATTRIBUTE_NAMES,Ke);return Qe.left=(Qe.left||0)-Qe.rx,Qe.top=(Qe.top||0)-Qe.ry,new this(Qe)}}function io(qe){if(!qe)return[];const f=qe.replace(/,/g," ").trim().split(/\s+/),ze=[];for(let Ke=0;Ke<f.length;Ke+=2)ze.push({x:parseFloat(f[Ke]),y:parseFloat(f[Ke+1])});return ze}t(so,"type","Ellipse"),t(so,"cacheProperties",[...ps,...eo]),t(so,"ownDefaults",{rx:0,ry:0}),t(so,"ATTRIBUTE_NAMES",[...Fi,"cx","cy","rx","ry"]),tt.setClass(so),tt.setSVGClass(so);const ro=["left","top"],no={exactBoundingBox:!1};class oo extends _i{static getDefaults(){return s(s({},super.getDefaults()),oo.ownDefaults)}constructor(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),t(this,"strokeDiff",void 0),Object.assign(this,oo.ownDefaults),this.setOptions(ze),this.points=f;const{left:Ke,top:Qe}=ze;this.initialized=!0,this.setBoundingBox(!0),typeof Ke=="number"&&this.set(M$1,Ke),typeof Qe=="number"&&this.set(P,Qe)}isOpen(){return!0}_projectStrokeOnPoints(f){return Ti(this.points,f,this.isOpen())}_calcDimensions(f){f=s({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},f||{});const ze=this.exactBoundingBox?this._projectStrokeOnPoints(f).map(hn=>hn.projectedPoint):this.points;if(ze.length===0)return{left:0,top:0,width:0,height:0,pathOffset:new ot$1,strokeOffset:new ot$1,strokeDiff:new ot$1};const Ke=ae$1(ze),Qe=Lt$1(s(s({},f),{},{scaleX:1,scaleY:1})),Pi=ae$1(this.points.map(hn=>wt$1(hn,Qe,!0))),nn=new ot$1(this.scaleX,this.scaleY);let ln=Ke.left+Ke.width/2,cn=Ke.top+Ke.height/2;return this.exactBoundingBox&&(ln-=cn*Math.tan(xt$1(this.skewX)),cn-=ln*Math.tan(xt$1(this.skewY))),s(s({},Ke),{},{pathOffset:new ot$1(ln,cn),strokeOffset:new ot$1(Pi.left,Pi.top).subtract(new ot$1(Ke.left,Ke.top)).multiply(nn),strokeDiff:new ot$1(Ke.width,Ke.height).subtract(new ot$1(Pi.width,Pi.height)).multiply(nn)})}_findCenterFromElement(){const f=ae$1(this.points);return new ot$1(f.left+f.width/2,f.top+f.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(f){const{left:ze,top:Ke,width:Qe,height:Pi,pathOffset:nn,strokeOffset:ln,strokeDiff:cn}=this._calcDimensions();this.set({width:Qe,height:Pi,pathOffset:nn,strokeOffset:ln,strokeDiff:cn}),f&&this.setPositionByOrigin(new ot$1(ze+Qe/2,Ke+Pi/2),D$1,D$1)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new ot$1(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.exactBoundingBox){let nn;if(Object.keys(f).some(ln=>this.strokeUniform||this.constructor.layoutProperties.includes(ln))){var ze,Ke;const{width:ln,height:cn}=this._calcDimensions(f);nn=new ot$1((ze=f.width)!==null&&ze!==void 0?ze:ln,(Ke=f.height)!==null&&Ke!==void 0?Ke:cn)}else{var Qe,Pi;nn=new ot$1((Qe=f.width)!==null&&Qe!==void 0?Qe:this.width,(Pi=f.height)!==null&&Pi!==void 0?Pi:this.height)}return nn.multiply(new ot$1(f.scaleX||this.scaleX,f.scaleY||this.scaleY))}return super._getTransformedDimensions(f)}_set(f,ze){const Ke=this.initialized&&this[f]!==ze,Qe=super._set(f,ze);return this.exactBoundingBox&&Ke&&((f===H||f===N$1)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(f))&&this.setDimensions(),Qe}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return s(s({},super.toObject(f)),{},{points:this.points.map(ze=>{let{x:Ke,y:Qe}=ze;return{x:Ke,y:Qe}})})}_toSVG(){const f=[],ze=this.pathOffset.x,Ke=this.pathOffset.y,Qe=o.NUM_FRACTION_DIGITS;for(let Pi=0,nn=this.points.length;Pi<nn;Pi++)f.push(Vt$1(this.points[Pi].x-ze,Qe),",",Vt$1(this.points[Pi].y-Ke,Qe)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(f.join(""),`" />
`)]}_render(f){const ze=this.points.length,Ke=this.pathOffset.x,Qe=this.pathOffset.y;if(ze&&!isNaN(this.points[ze-1].y)){f.beginPath(),f.moveTo(this.points[0].x-Ke,this.points[0].y-Qe);for(let Pi=0;Pi<ze;Pi++){const nn=this.points[Pi];f.lineTo(nn.x-Ke,nn.y-Qe)}!this.isOpen()&&f.closePath(),this._renderPaintInOrder(f)}}complexity(){return this.points.length}static async fromElement(f,ze,Ke){return new this(io(f.getAttribute("points")),s(s({},i(dr(f,this.ATTRIBUTE_NAMES,Ke),ro)),ze))}static fromObject(f){return this._fromObject(f,{extraParam:"points"})}}t(oo,"ownDefaults",no),t(oo,"type","Polyline"),t(oo,"layoutProperties",[U,q,"strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),t(oo,"cacheProperties",[...ps,"points"]),t(oo,"ATTRIBUTE_NAMES",[...Fi]),tt.setClass(oo),tt.setSVGClass(oo);class ao extends oo{isOpen(){return!1}}t(ao,"ownDefaults",no),t(ao,"type","Polygon"),tt.setClass(ao),tt.setSVGClass(ao);const ho=["fontSize","fontWeight","fontFamily","fontStyle"],co=["underline","overline","linethrough"],lo=[...ho,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],uo=[...lo,...co,"textBackgroundColor","direction"],go=[...ho,...co,J,"strokeWidth",K$1,"deltaY","textBackgroundColor"],fo={_reNewline:F$1,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:M$1,fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:M$1,pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2},po="justify",mo="justify-left",vo="justify-right",yo="justify-center";class _o extends _i{isEmptyStyles(f){if(!this.styles||f!==void 0&&!this.styles[f])return!0;const ze=f===void 0?this.styles:{line:this.styles[f]};for(const Ke in ze)for(const Qe in ze[Ke])for(const Pi in ze[Ke][Qe])return!1;return!0}styleHas(f,ze){if(!this.styles||ze!==void 0&&!this.styles[ze])return!1;const Ke=ze===void 0?this.styles:{0:this.styles[ze]};for(const Qe in Ke)for(const Pi in Ke[Qe])if(Ke[Qe][Pi][f]!==void 0)return!0;return!1}cleanStyle(f){if(!this.styles)return!1;const ze=this.styles;let Ke,Qe,Pi=0,nn=!0,ln=0;for(const cn in ze){Ke=0;for(const hn in ze[cn]){const un=ze[cn][hn]||{};Pi++,un[f]!==void 0?(Qe?un[f]!==Qe&&(nn=!1):Qe=un[f],un[f]===this[f]&&delete un[f]):nn=!1,Object.keys(un).length!==0?Ke++:delete ze[cn][hn]}Ke===0&&delete ze[cn]}for(let cn=0;cn<this._textLines.length;cn++)ln+=this._textLines[cn].length;nn&&Pi===ln&&(this[f]=Qe,this.removeStyle(f))}removeStyle(f){if(!this.styles)return;const ze=this.styles;let Ke,Qe,Pi;for(Qe in ze){for(Pi in Ke=ze[Qe],Ke)delete Ke[Pi][f],Object.keys(Ke[Pi]).length===0&&delete Ke[Pi];Object.keys(Ke).length===0&&delete ze[Qe]}}_extendStyles(f,ze){const{lineIndex:Ke,charIndex:Qe}=this.get2DCursorLocation(f);this._getLineStyle(Ke)||this._setLineStyle(Ke);const Pi=Wt$1(s(s({},this._getStyleDeclaration(Ke,Qe)),ze),nn=>nn!==void 0);this._setStyleDeclaration(Ke,Qe,Pi)}getSelectionStyles(f,ze,Ke){const Qe=[];for(let Pi=f;Pi<(ze||f);Pi++)Qe.push(this.getStyleAtPosition(Pi,Ke));return Qe}getStyleAtPosition(f,ze){const{lineIndex:Ke,charIndex:Qe}=this.get2DCursorLocation(f);return ze?this.getCompleteStyleDeclaration(Ke,Qe):this._getStyleDeclaration(Ke,Qe)}setSelectionStyles(f,ze,Ke){for(let Qe=ze;Qe<(Ke||ze);Qe++)this._extendStyles(Qe,f);this._forceClearCache=!0}_getStyleDeclaration(f,ze){var Ke;const Qe=this.styles&&this.styles[f];return Qe&&(Ke=Qe[ze])!==null&&Ke!==void 0?Ke:{}}getCompleteStyleDeclaration(f,ze){return s(s({},Yt$1(this,this.constructor._styleProperties)),this._getStyleDeclaration(f,ze))}_setStyleDeclaration(f,ze,Ke){this.styles[f][ze]=Ke}_deleteStyleDeclaration(f,ze){delete this.styles[f][ze]}_getLineStyle(f){return!!this.styles[f]}_setLineStyle(f){this.styles[f]={}}_deleteLineStyle(f){delete this.styles[f]}}t(_o,"_styleProperties",go);const xo=/  +/g,Co=/"/g;function bo(qe,f,ze,Ke,Qe){return"		".concat(function(Pi,nn){let{left:ln,top:cn,width:hn,height:un}=nn,zn=arguments.length>2&&arguments[2]!==void 0?arguments[2]:o.NUM_FRACTION_DIGITS;const Xn=Be$1(K$1,Pi,!1),[Un,qn,ys,vs]=[ln,cn,hn,un].map(ea=>Vt$1(ea,zn));return"<rect ".concat(Xn,' x="').concat(Un,'" y="').concat(qn,'" width="').concat(ys,'" height="').concat(vs,'"></rect>')}(qe,{left:f,top:ze,width:Ke,height:Qe}),`
`)}const wo=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];let So;class To extends _o{static getDefaults(){return s(s({},super.getDefaults()),To.ownDefaults)}constructor(f,ze){super(),t(this,"__charBounds",[]),Object.assign(this,To.ownDefaults),this.setOptions(ze),this.styles||(this.styles={}),this.text=f,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){const f=this.path;f&&(f.segmentsInfo=Qr(f.path))}_splitText(){const f=this._splitTextIntoLines(this.text);return this.textLines=f.lines,this._textLines=f.graphemeLines,this._unwrappedTextLines=f._unwrappedLines,this._text=f.graphemeText,f}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(po)&&this.enlargeSpaces()}enlargeSpaces(){let f,ze,Ke,Qe,Pi,nn,ln;for(let cn=0,hn=this._textLines.length;cn<hn;cn++)if((this.textAlign===po||cn!==hn-1&&!this.isEndOfWrapping(cn))&&(Qe=0,Pi=this._textLines[cn],ze=this.getLineWidth(cn),ze<this.width&&(ln=this.textLines[cn].match(this._reSpacesAndTabs)))){Ke=ln.length,f=(this.width-ze)/Ke;for(let un=0;un<=Pi.length;un++)nn=this.__charBounds[cn][un],this._reSpaceAndTab.test(Pi[un])?(nn.width+=f,nn.kernedWidth+=f,nn.left+=Qe,Qe+=f):nn.left+=Qe}}isEndOfWrapping(f){return f===this._textLines.length-1}missingNewlineOffset(f){return 1}get2DCursorLocation(f,ze){const Ke=ze?this._unwrappedTextLines:this._textLines;let Qe;for(Qe=0;Qe<Ke.length;Qe++){if(f<=Ke[Qe].length)return{lineIndex:Qe,charIndex:f};f-=Ke[Qe].length+this.missingNewlineOffset(Qe,ze)}return{lineIndex:Qe-1,charIndex:Ke[Qe-1].length<f?Ke[Qe-1].length:f}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){const f=super._getCacheCanvasDimensions(),ze=this.fontSize;return f.width+=ze*f.zoomX,f.height+=ze*f.zoomY,f}_render(f){const ze=this.path;ze&&!ze.isNotVisible()&&ze._render(f),this._setTextStyles(f),this._renderTextLinesBackground(f),this._renderTextDecoration(f,"underline"),this._renderText(f),this._renderTextDecoration(f,"overline"),this._renderTextDecoration(f,"linethrough")}_renderText(f){this.paintFirst===J?(this._renderTextStroke(f),this._renderTextFill(f)):(this._renderTextFill(f),this._renderTextStroke(f))}_setTextStyles(f,ze,Ke){if(f.textBaseline="alphabetic",this.path)switch(this.pathAlign){case D$1:f.textBaseline="middle";break;case"ascender":f.textBaseline=P;break;case"descender":f.textBaseline=E$1}f.font=this._getFontDeclaration(ze,Ke)}calcTextWidth(){let f=this.getLineWidth(0);for(let ze=1,Ke=this._textLines.length;ze<Ke;ze++){const Qe=this.getLineWidth(ze);Qe>f&&(f=Qe)}return f}_renderTextLine(f,ze,Ke,Qe,Pi,nn){this._renderChars(f,ze,Ke,Qe,Pi,nn)}_renderTextLinesBackground(f){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;const ze=f.fillStyle,Ke=this._getLeftOffset();let Qe=this._getTopOffset();for(let Pi=0,nn=this._textLines.length;Pi<nn;Pi++){const ln=this.getHeightOfLine(Pi);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",Pi)){Qe+=ln;continue}const cn=this._textLines[Pi].length,hn=this._getLineLeftOffset(Pi);let un,zn,Xn=0,Un=0,qn=this.getValueOfPropertyAt(Pi,0,"textBackgroundColor");for(let ys=0;ys<cn;ys++){const vs=this.__charBounds[Pi][ys];zn=this.getValueOfPropertyAt(Pi,ys,"textBackgroundColor"),this.path?(f.save(),f.translate(vs.renderLeft,vs.renderTop),f.rotate(vs.angle),f.fillStyle=zn,zn&&f.fillRect(-vs.width/2,-ln/this.lineHeight*(1-this._fontSizeFraction),vs.width,ln/this.lineHeight),f.restore()):zn!==qn?(un=Ke+hn+Un,this.direction==="rtl"&&(un=this.width-un-Xn),f.fillStyle=qn,qn&&f.fillRect(un,Qe,Xn,ln/this.lineHeight),Un=vs.left,Xn=vs.width,qn=zn):Xn+=vs.kernedWidth}zn&&!this.path&&(un=Ke+hn+Un,this.direction==="rtl"&&(un=this.width-un-Xn),f.fillStyle=zn,f.fillRect(un,Qe,Xn,ln/this.lineHeight)),Qe+=ln}f.fillStyle=ze,this._removeShadow(f)}_measureChar(f,ze,Ke,Qe){const Pi=_.getFontCache(ze),nn=this._getFontDeclaration(ze),ln=Ke+f,cn=Ke&&nn===this._getFontDeclaration(Qe),hn=ze.fontSize/this.CACHE_FONT_SIZE;let un,zn,Xn,Un;if(Ke&&Pi[Ke]!==void 0&&(Xn=Pi[Ke]),Pi[f]!==void 0&&(Un=un=Pi[f]),cn&&Pi[ln]!==void 0&&(zn=Pi[ln],Un=zn-Xn),un===void 0||Xn===void 0||zn===void 0){const qn=function(){return So||(So=vt$1({width:0,height:0}).getContext("2d")),So}();this._setTextStyles(qn,ze,!0),un===void 0&&(Un=un=qn.measureText(f).width,Pi[f]=un),Xn===void 0&&cn&&Ke&&(Xn=qn.measureText(Ke).width,Pi[Ke]=Xn),cn&&zn===void 0&&(zn=qn.measureText(ln).width,Pi[ln]=zn,Un=zn-Xn)}return{width:un*hn,kernedWidth:Un*hn}}getHeightOfChar(f,ze){return this.getValueOfPropertyAt(f,ze,"fontSize")}measureLine(f){const ze=this._measureLine(f);return this.charSpacing!==0&&(ze.width-=this._getWidthOfCharSpacing()),ze.width<0&&(ze.width=0),ze}_measureLine(f){let ze,Ke,Qe=0;const Pi=this.pathSide===A,nn=this.path,ln=this._textLines[f],cn=ln.length,hn=new Array(cn);this.__charBounds[f]=hn;for(let un=0;un<cn;un++){const zn=ln[un];Ke=this._getGraphemeBox(zn,f,un,ze),hn[un]=Ke,Qe+=Ke.kernedWidth,ze=zn}if(hn[cn]={left:Ke?Ke.left+Ke.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},nn&&nn.segmentsInfo){let un=0;const zn=nn.segmentsInfo[nn.segmentsInfo.length-1].length;switch(this.textAlign){case M$1:un=Pi?zn-Qe:0;break;case D$1:un=(zn-Qe)/2;break;case A:un=Pi?0:zn-Qe}un+=this.pathStartOffset*(Pi?-1:1);for(let Xn=Pi?cn-1:0;Pi?Xn>=0:Xn<cn;Pi?Xn--:Xn++)Ke=hn[Xn],un>zn?un%=zn:un<0&&(un+=zn),this._setGraphemeOnPath(un,Ke),un+=Ke.kernedWidth}return{width:Qe,numOfSpaces:0}}_setGraphemeOnPath(f,ze){const Ke=f+ze.kernedWidth/2,Qe=this.path,Pi=Zr(Qe.path,Ke,Qe.segmentsInfo);ze.renderLeft=Pi.x-Qe.pathOffset.x,ze.renderTop=Pi.y-Qe.pathOffset.y,ze.angle=Pi.angle+(this.pathSide===A?Math.PI:0)}_getGraphemeBox(f,ze,Ke,Qe,Pi){const nn=this.getCompleteStyleDeclaration(ze,Ke),ln=Qe?this.getCompleteStyleDeclaration(ze,Ke-1):{},cn=this._measureChar(f,nn,Qe,ln);let hn,un=cn.kernedWidth,zn=cn.width;this.charSpacing!==0&&(hn=this._getWidthOfCharSpacing(),zn+=hn,un+=hn);const Xn={width:zn,left:0,height:nn.fontSize,kernedWidth:un,deltaY:nn.deltaY};if(Ke>0&&!Pi){const Un=this.__charBounds[ze][Ke-1];Xn.left=Un.left+Un.width+cn.kernedWidth-cn.width}return Xn}getHeightOfLine(f){if(this.__lineHeights[f])return this.__lineHeights[f];let ze=this.getHeightOfChar(f,0);for(let Ke=1,Qe=this._textLines[f].length;Ke<Qe;Ke++)ze=Math.max(this.getHeightOfChar(f,Ke),ze);return this.__lineHeights[f]=ze*this.lineHeight*this._fontSizeMult}calcTextHeight(){let f,ze=0;for(let Ke=0,Qe=this._textLines.length;Ke<Qe;Ke++)f=this.getHeightOfLine(Ke),ze+=Ke===Qe-1?f/this.lineHeight:f;return ze}_getLeftOffset(){return this.direction==="ltr"?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(f,ze){f.save();let Ke=0;const Qe=this._getLeftOffset(),Pi=this._getTopOffset();for(let nn=0,ln=this._textLines.length;nn<ln;nn++){const cn=this.getHeightOfLine(nn),hn=cn/this.lineHeight,un=this._getLineLeftOffset(nn);this._renderTextLine(ze,f,this._textLines[nn],Qe+un,Pi+Ke+hn,nn),Ke+=cn}f.restore()}_renderTextFill(f){(this.fill||this.styleHas(K$1))&&this._renderTextCommon(f,"fillText")}_renderTextStroke(f){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(f),f.save(),this._setLineDash(f,this.strokeDashArray),f.beginPath(),this._renderTextCommon(f,"strokeText"),f.closePath(),f.restore())}_renderChars(f,ze,Ke,Qe,Pi,nn){const ln=this.getHeightOfLine(nn),cn=this.textAlign.includes(po),hn=this.path,un=!cn&&this.charSpacing===0&&this.isEmptyStyles(nn)&&!hn,zn=this.direction==="ltr",Xn=this.direction==="ltr"?1:-1,Un=ze.direction;let qn,ys,vs,ea,na,ta="",ra=0;if(ze.save(),Un!==this.direction&&(ze.canvas.setAttribute("dir",zn?"ltr":"rtl"),ze.direction=zn?"ltr":"rtl",ze.textAlign=zn?M$1:A),Pi-=ln*this._fontSizeFraction/this.lineHeight,un)return this._renderChar(f,ze,nn,0,Ke.join(""),Qe,Pi),void ze.restore();for(let oa=0,fa=Ke.length-1;oa<=fa;oa++)ea=oa===fa||this.charSpacing||hn,ta+=Ke[oa],vs=this.__charBounds[nn][oa],ra===0?(Qe+=Xn*(vs.kernedWidth-vs.width),ra+=vs.width):ra+=vs.kernedWidth,cn&&!ea&&this._reSpaceAndTab.test(Ke[oa])&&(ea=!0),ea||(qn=qn||this.getCompleteStyleDeclaration(nn,oa),ys=this.getCompleteStyleDeclaration(nn,oa+1),ea=Ei(qn,ys,!1)),ea&&(hn?(ze.save(),ze.translate(vs.renderLeft,vs.renderTop),ze.rotate(vs.angle),this._renderChar(f,ze,nn,oa,ta,-ra/2,0),ze.restore()):(na=Qe,this._renderChar(f,ze,nn,oa,ta,na,Pi)),ta="",qn=ys,Qe+=Xn*ra,ra=0);ze.restore()}_applyPatternGradientTransformText(f){const ze=this.width+this.strokeWidth,Ke=this.height+this.strokeWidth,Qe=vt$1({width:ze,height:Ke}),Pi=Qe.getContext("2d");return Qe.width=ze,Qe.height=Ke,Pi.beginPath(),Pi.moveTo(0,0),Pi.lineTo(ze,0),Pi.lineTo(ze,Ke),Pi.lineTo(0,Ke),Pi.closePath(),Pi.translate(ze/2,Ke/2),Pi.fillStyle=f.toLive(Pi),this._applyPatternGradientTransform(Pi,f),Pi.fill(),Pi.createPattern(Qe,"no-repeat")}handleFiller(f,ze,Ke){let Qe,Pi;return Gt$1(Ke)?Ke.gradientUnits==="percentage"||Ke.gradientTransform||Ke.patternTransform?(Qe=-this.width/2,Pi=-this.height/2,f.translate(Qe,Pi),f[ze]=this._applyPatternGradientTransformText(Ke),{offsetX:Qe,offsetY:Pi}):(f[ze]=Ke.toLive(f),this._applyPatternGradientTransform(f,Ke)):(f[ze]=Ke,{offsetX:0,offsetY:0})}_setStrokeStyles(f,ze){let{stroke:Ke,strokeWidth:Qe}=ze;return f.lineWidth=Qe,f.lineCap=this.strokeLineCap,f.lineDashOffset=this.strokeDashOffset,f.lineJoin=this.strokeLineJoin,f.miterLimit=this.strokeMiterLimit,this.handleFiller(f,"strokeStyle",Ke)}_setFillStyles(f,ze){let{fill:Ke}=ze;return this.handleFiller(f,"fillStyle",Ke)}_renderChar(f,ze,Ke,Qe,Pi,nn,ln){const cn=this._getStyleDeclaration(Ke,Qe),hn=this.getCompleteStyleDeclaration(Ke,Qe),un=f==="fillText"&&hn.fill,zn=f==="strokeText"&&hn.stroke&&hn.strokeWidth;if(zn||un){if(ze.save(),ze.font=this._getFontDeclaration(hn),cn.textBackgroundColor&&this._removeShadow(ze),cn.deltaY&&(ln+=cn.deltaY),un){const Xn=this._setFillStyles(ze,hn);ze.fillText(Pi,nn-Xn.offsetX,ln-Xn.offsetY)}if(zn){const Xn=this._setStrokeStyles(ze,hn);ze.strokeText(Pi,nn-Xn.offsetX,ln-Xn.offsetY)}ze.restore()}}setSuperscript(f,ze){this._setScript(f,ze,this.superscript)}setSubscript(f,ze){this._setScript(f,ze,this.subscript)}_setScript(f,ze,Ke){const Qe=this.get2DCursorLocation(f,!0),Pi=this.getValueOfPropertyAt(Qe.lineIndex,Qe.charIndex,"fontSize"),nn=this.getValueOfPropertyAt(Qe.lineIndex,Qe.charIndex,"deltaY"),ln={fontSize:Pi*Ke.size,deltaY:nn+Pi*Ke.baseline};this.setSelectionStyles(ln,f,ze)}_getLineLeftOffset(f){const ze=this.getLineWidth(f),Ke=this.width-ze,Qe=this.textAlign,Pi=this.direction,nn=this.isEndOfWrapping(f);let ln=0;return Qe===po||Qe===yo&&!nn||Qe===vo&&!nn||Qe===mo&&!nn?0:(Qe===D$1&&(ln=Ke/2),Qe===A&&(ln=Ke),Qe===yo&&(ln=Ke/2),Qe===vo&&(ln=Ke),Pi==="rtl"&&(Qe===A||Qe===po||Qe===vo?ln=0:Qe===M$1||Qe===mo?ln=-Ke:Qe!==D$1&&Qe!==yo||(ln=-Ke/2)),ln)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(f){if(this.__lineWidths[f]!==void 0)return this.__lineWidths[f];const{width:ze}=this.measureLine(f);return this.__lineWidths[f]=ze,ze}_getWidthOfCharSpacing(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(f,ze,Ke){var Qe;return(Qe=this._getStyleDeclaration(f,ze)[Ke])!==null&&Qe!==void 0?Qe:this[Ke]}_renderTextDecoration(f,ze){if(!this[ze]&&!this.styleHas(ze))return;let Ke=this._getTopOffset();const Qe=this._getLeftOffset(),Pi=this.path,nn=this._getWidthOfCharSpacing(),ln=this.offsets[ze];for(let cn=0,hn=this._textLines.length;cn<hn;cn++){const un=this.getHeightOfLine(cn);if(!this[ze]&&!this.styleHas(ze,cn)){Ke+=un;continue}const zn=this._textLines[cn],Xn=un/this.lineHeight,Un=this._getLineLeftOffset(cn);let qn,ys,vs=0,ea=0,na=this.getValueOfPropertyAt(cn,0,ze),ta=this.getValueOfPropertyAt(cn,0,K$1);const ra=Ke+Xn*(1-this._fontSizeFraction);let oa=this.getHeightOfChar(cn,0),fa=this.getValueOfPropertyAt(cn,0,"deltaY");for(let la=0,ua=zn.length;la<ua;la++){const ga=this.__charBounds[cn][la];qn=this.getValueOfPropertyAt(cn,la,ze),ys=this.getValueOfPropertyAt(cn,la,K$1);const da=this.getHeightOfChar(cn,la),qa=this.getValueOfPropertyAt(cn,la,"deltaY");if(Pi&&qn&&ys)f.save(),f.fillStyle=ta,f.translate(ga.renderLeft,ga.renderTop),f.rotate(ga.angle),f.fillRect(-ga.kernedWidth/2,ln*da+qa,ga.kernedWidth,this.fontSize/15),f.restore();else if((qn!==na||ys!==ta||da!==oa||qa!==fa)&&ea>0){let tl=Qe+Un+vs;this.direction==="rtl"&&(tl=this.width-tl-ea),na&&ta&&(f.fillStyle=ta,f.fillRect(tl,ra+ln*oa+fa,ea,this.fontSize/15)),vs=ga.left,ea=ga.width,na=qn,ta=ys,oa=da,fa=qa}else ea+=ga.kernedWidth}let ca=Qe+Un+vs;this.direction==="rtl"&&(ca=this.width-ca-ea),f.fillStyle=ys,qn&&ys&&f.fillRect(ca,ra+ln*oa+fa,ea-nn,this.fontSize/15),Ke+=un}this._removeShadow(f)}_getFontDeclaration(){let{fontFamily:f=this.fontFamily,fontStyle:ze=this.fontStyle,fontWeight:Ke=this.fontWeight,fontSize:Qe=this.fontSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Pi=arguments.length>1?arguments[1]:void 0;const nn=f.includes("'")||f.includes('"')||f.includes(",")||To.genericFonts.includes(f.toLowerCase())?f:'"'.concat(f,'"');return[ze,Ke,"".concat(Pi?this.CACHE_FONT_SIZE:Qe,"px"),nn].join(" ")}render(f){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(f)))}graphemeSplit(f){return Di(f)}_splitTextIntoLines(f){const ze=f.split(this._reNewline),Ke=new Array(ze.length),Qe=[`
`];let Pi=[];for(let nn=0;nn<ze.length;nn++)Ke[nn]=this.graphemeSplit(ze[nn]),Pi=Pi.concat(Ke[nn],Qe);return Pi.pop(),{_unwrappedLines:Ke,lines:ze,graphemeText:Pi,graphemeLines:Ke}}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return s(s({},super.toObject([...uo,...f])),{},{styles:Ai(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(f,ze){const{textLayoutProperties:Ke}=this.constructor;super.set(f,ze);let Qe=!1,Pi=!1;if(typeof f=="object")for(const nn in f)nn==="path"&&this.setPathInfo(),Qe=Qe||Ke.includes(nn),Pi=Pi||nn==="path";else Qe=Ke.includes(f),Pi=f==="path";return Pi&&this.setPathInfo(),Qe&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(f,ze,Ke){const Qe=dr(f,To.ATTRIBUTE_NAMES,Ke),Pi=s(s({},ze),Qe),{textAnchor:nn=M$1,textDecoration:ln="",dx:cn=0,dy:hn=0,top:un=0,left:zn=0,fontSize:Xn=O$1,strokeWidth:Un=1}=Pi,qn=i(Pi,wo),ys=new this((f.textContent||"").replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),s({left:zn+cn,top:un+hn,underline:ln.includes("underline"),overline:ln.includes("overline"),linethrough:ln.includes("line-through"),strokeWidth:0,fontSize:Xn},qn)),vs=ys.getScaledHeight()/ys.height,ea=((ys.height+ys.strokeWidth)*ys.lineHeight-ys.height)*vs,na=ys.getScaledHeight()+ea;let ta=0;return nn===D$1&&(ta=ys.getScaledWidth()/2),nn===A&&(ta=ys.getScaledWidth()),ys.set({left:ys.left-ta,top:ys.top-(na-ys.fontSize*(.07+ys._fontSizeFraction))/ys.lineHeight,strokeWidth:Un}),ys}static fromObject(f){return this._fromObject(s(s({},f),{},{styles:ji(f.styles||{},f.text)}),{extraParam:"text"})}}t(To,"textLayoutProperties",lo),t(To,"cacheProperties",[...ps,...uo]),t(To,"ownDefaults",fo),t(To,"type","Text"),t(To,"genericFonts",["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),t(To,"ATTRIBUTE_NAMES",Fi.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),yi(To,[class extends Xe{_toSVG(){const qe=this._getSVGLeftTopOffsets(),f=this._getSVGTextAndBg(qe.textTop,qe.textLeft);return this._wrapSVGTextAndBg(f)}toSVG(qe){const f=this._createBaseSVGMarkup(this._toSVG(),{reviver:qe,noStyle:!0,withShadow:!0}),ze=this.path;return ze?f+ze._createBaseSVGMarkup(ze._toSVG(),{reviver:qe,withShadow:!0,additionalTransform:zt$1(this.calcOwnMatrix())}):f}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(qe){let{textBgRects:f,textSpans:ze}=qe;const Ke=this.getSvgTextDecoration(this);return[f.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'.concat(this.fontFamily.replace(Co,"'"),'" '):"",this.fontSize?'font-size="'.concat(this.fontSize,'" '):"",this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",Ke?'text-decoration="'.concat(Ke,'" '):"",this.direction==="rtl"?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",ze.join(""),`</text>
`]}_getSVGTextAndBg(qe,f){const ze=[],Ke=[];let Qe,Pi=qe;this.backgroundColor&&Ke.push(...bo(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let nn=0,ln=this._textLines.length;nn<ln;nn++)Qe=this._getLineLeftOffset(nn),this.direction==="rtl"&&(Qe+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",nn))&&this._setSVGTextLineBg(Ke,nn,f+Qe,Pi),this._setSVGTextLineText(ze,nn,f+Qe,Pi),Pi+=this.getHeightOfLine(nn);return{textSpans:ze,textBgRects:Ke}}_createTextCharSpan(qe,f,ze,Ke,Qe){const Pi=o.NUM_FRACTION_DIGITS,nn=this.getSvgSpanStyles(f,qe!==qe.trim()||!!qe.match(xo)),ln=nn?'style="'.concat(nn,'"'):"",cn=f.deltaY,hn=cn?' dy="'.concat(Vt$1(cn,Pi),'" '):"",{angle:un,renderLeft:zn,renderTop:Xn,width:Un}=Qe;let qn="";if(zn!==void 0){const ys=Un/2;un&&(qn=' rotate="'.concat(Vt$1(Ct$1(un),Pi),'"'));const vs=Pt$1({angle:Ct$1(un)});vs[4]=zn,vs[5]=Xn;const ea=new ot$1(-ys,0).transform(vs);ze=ea.x,Ke=ea.y}return'<tspan x="'.concat(Vt$1(ze,Pi),'" y="').concat(Vt$1(Ke,Pi),'" ').concat(hn).concat(qn).concat(ln,">").concat(ki(qe),"</tspan>")}_setSVGTextLineText(qe,f,ze,Ke){const Qe=this.getHeightOfLine(f),Pi=this.textAlign.includes(po),nn=this._textLines[f];let ln,cn,hn,un,zn,Xn="",Un=0;Ke+=Qe*(1-this._fontSizeFraction)/this.lineHeight;for(let qn=0,ys=nn.length-1;qn<=ys;qn++)zn=qn===ys||this.charSpacing||this.path,Xn+=nn[qn],hn=this.__charBounds[f][qn],Un===0?(ze+=hn.kernedWidth-hn.width,Un+=hn.width):Un+=hn.kernedWidth,Pi&&!zn&&this._reSpaceAndTab.test(nn[qn])&&(zn=!0),zn||(ln=ln||this.getCompleteStyleDeclaration(f,qn),cn=this.getCompleteStyleDeclaration(f,qn+1),zn=Ei(ln,cn,!0)),zn&&(un=this._getStyleDeclaration(f,qn),qe.push(this._createTextCharSpan(Xn,un,ze,Ke,hn)),Xn="",ln=cn,this.direction==="rtl"?ze-=Un:ze+=Un,Un=0)}_setSVGTextLineBg(qe,f,ze,Ke){const Qe=this._textLines[f],Pi=this.getHeightOfLine(f)/this.lineHeight;let nn,ln=0,cn=0,hn=this.getValueOfPropertyAt(f,0,"textBackgroundColor");for(let un=0;un<Qe.length;un++){const{left:zn,width:Xn,kernedWidth:Un}=this.__charBounds[f][un];nn=this.getValueOfPropertyAt(f,un,"textBackgroundColor"),nn!==hn?(hn&&qe.push(...bo(hn,ze+cn,Ke,ln,Pi)),cn=zn,ln=Xn,hn=nn):ln+=Un}nn&&qe.push(...bo(hn,ze+cn,Ke,ln,Pi))}_getSVGLineTopOffset(qe){let f,ze=0;for(f=0;f<qe;f++)ze+=this.getHeightOfLine(f);const Ke=this.getHeightOfLine(f);return{lineTop:ze,offset:(this._fontSizeMult-this._fontSizeFraction)*Ke/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(qe){return"".concat(super.getSvgStyles(qe)," white-space: pre;")}getSvgSpanStyles(qe,f){const{fontFamily:ze,strokeWidth:Ke,stroke:Qe,fill:Pi,fontSize:nn,fontStyle:ln,fontWeight:cn,deltaY:hn}=qe,un=this.getSvgTextDecoration(qe);return[Qe?Be$1(J,Qe):"",Ke?"stroke-width: ".concat(Ke,"; "):"",ze?"font-family: ".concat(ze.includes("'")||ze.includes('"')?ze:"'".concat(ze,"'"),"; "):"",nn?"font-size: ".concat(nn,"px; "):"",ln?"font-style: ".concat(ln,"; "):"",cn?"font-weight: ".concat(cn,"; "):"",un&&"text-decoration: ".concat(un,"; "),Pi?Be$1(K$1,Pi):"",hn?"baseline-shift: ".concat(-hn,"; "):"",f?"white-space: pre; ":""].join("")}getSvgTextDecoration(qe){return["overline","underline","line-through"].filter(f=>qe[f.replace("-","")]).join(" ")}}]),tt.setClass(To),tt.setSVGClass(To);class Oo{constructor(f){t(this,"target",void 0),t(this,"__mouseDownInPlace",!1),t(this,"__dragStartFired",!1),t(this,"__isDraggingOver",!1),t(this,"__dragStartSelection",void 0),t(this,"__dragImageDisposer",void 0),t(this,"_dispose",void 0),this.target=f;const ze=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{ze.forEach(Ke=>Ke()),this._dispose=void 0}}isPointerOverSelection(f){const ze=this.target,Ke=ze.getSelectionStartFromPointer(f);return ze.isEditing&&Ke>=ze.selectionStart&&Ke<=ze.selectionEnd&&ze.selectionStart<ze.selectionEnd}start(f){return this.__mouseDownInPlace=this.isPointerOverSelection(f)}isActive(){return this.__mouseDownInPlace}end(f){const ze=this.isActive();return ze&&!this.__dragStartFired&&(this.target.setCursorByClick(f),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,ze}getDragStartSelection(){return this.__dragStartSelection}setDragImage(f,ze){var Ke;let{selectionStart:Qe,selectionEnd:Pi}=ze;const nn=this.target,ln=nn.canvas,cn=new ot$1(nn.flipX?-1:1,nn.flipY?-1:1),hn=nn._getCursorBoundaries(Qe),un=new ot$1(hn.left+hn.leftOffset,hn.top+hn.topOffset).multiply(cn).transform(nn.calcTransformMatrix()),zn=ln.getScenePoint(f).subtract(un),Xn=nn.getCanvasRetinaScaling(),Un=nn.getBoundingRect(),qn=un.subtract(new ot$1(Un.left,Un.top)),ys=ln.viewportTransform,vs=qn.add(zn).transform(ys,!0),ea=nn.backgroundColor,na=Oi(nn.styles);nn.backgroundColor="";const ta={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};nn.setSelectionStyles(ta,0,Qe),nn.setSelectionStyles(ta,Pi,nn.text.length),nn.dirty=!0;const ra=nn.toCanvasElement({enableRetinaScaling:ln.enableRetinaScaling,viewportTransform:!0});nn.backgroundColor=ea,nn.styles=na,nn.dirty=!0,an(ra,{position:"fixed",left:"".concat(-ra.width,"px"),border:j$1,width:"".concat(ra.width/Xn,"px"),height:"".concat(ra.height/Xn,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{ra.remove()},Kt$1(f.target||this.target.hiddenTextarea).body.appendChild(ra),(Ke=f.dataTransfer)===null||Ke===void 0||Ke.setDragImage(ra,vs.x,vs.y)}onDragStart(f){this.__dragStartFired=!0;const ze=this.target,Ke=this.isActive();if(Ke&&f.dataTransfer){const Qe=this.__dragStartSelection={selectionStart:ze.selectionStart,selectionEnd:ze.selectionEnd},Pi=ze._text.slice(Qe.selectionStart,Qe.selectionEnd).join(""),nn=s({text:ze.text,value:Pi},Qe);f.dataTransfer.setData("text/plain",Pi),f.dataTransfer.setData("application/fabric",JSON.stringify({value:Pi,styles:ze.getSelectionStyles(Qe.selectionStart,Qe.selectionEnd,!0)})),f.dataTransfer.effectAllowed="copyMove",this.setDragImage(f,nn)}return ze.abortCursorAnimation(),Ke}canDrop(f){if(this.target.editable&&!this.target.getActiveControl()&&!f.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){const ze=this.target.getSelectionStartFromPointer(f),Ke=this.__dragStartSelection;return ze<Ke.selectionStart||ze>Ke.selectionEnd}return!0}return!1}targetCanDrop(f){return this.target.canDrop(f)}dragEnterHandler(f){let{e:ze}=f;const Ke=this.targetCanDrop(ze);!this.__isDraggingOver&&Ke&&(this.__isDraggingOver=!0)}dragOverHandler(f){const{e:ze}=f,Ke=this.targetCanDrop(ze);!this.__isDraggingOver&&Ke?this.__isDraggingOver=!0:this.__isDraggingOver&&!Ke&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(ze.preventDefault(),f.canDrop=!0,f.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(f){var ze;const{e:Ke}=f,Qe=Ke.defaultPrevented;this.__isDraggingOver=!1,Ke.preventDefault();let Pi=(ze=Ke.dataTransfer)===null||ze===void 0?void 0:ze.getData("text/plain");if(Pi&&!Qe){const nn=this.target,ln=nn.canvas;let cn=nn.getSelectionStartFromPointer(Ke);const{styles:hn}=Ke.dataTransfer.types.includes("application/fabric")?JSON.parse(Ke.dataTransfer.getData("application/fabric")):{},un=Pi[Math.max(0,Pi.length-1)],zn=0;if(this.__dragStartSelection){const Xn=this.__dragStartSelection.selectionStart,Un=this.__dragStartSelection.selectionEnd;cn>Xn&&cn<=Un?cn=Xn:cn>Un&&(cn-=Un-Xn),nn.removeChars(Xn,Un),delete this.__dragStartSelection}nn._reNewline.test(un)&&(nn._reNewline.test(nn._text[cn])||cn===nn._text.length)&&(Pi=Pi.trimEnd()),f.didDrop=!0,f.dropTarget=nn,nn.insertChars(Pi,hn,cn),ln.setActiveObject(nn),nn.enterEditing(Ke),nn.selectionStart=Math.min(cn+zn,nn._text.length),nn.selectionEnd=Math.min(nn.selectionStart+Pi.length,nn._text.length),nn.hiddenTextarea.value=nn.text,nn._updateTextarea(),nn.hiddenTextarea.focus(),nn.fire(z,{index:cn+zn,action:"drop"}),ln.fire("text:changed",{target:nn}),ln.contextTopDirty=!0,ln.requestRenderAll()}}dragEndHandler(f){let{e:ze}=f;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var Ke;const Qe=this.target,Pi=this.target.canvas,{selectionStart:nn,selectionEnd:ln}=this.__dragStartSelection,cn=((Ke=ze.dataTransfer)===null||Ke===void 0?void 0:Ke.dropEffect)||j$1;cn===j$1?(Qe.selectionStart=nn,Qe.selectionEnd=ln,Qe._updateTextarea(),Qe.hiddenTextarea.focus()):(Qe.clearContextTop(),cn==="move"&&(Qe.removeChars(nn,ln),Qe.selectionStart=Qe.selectionEnd=nn,Qe.hiddenTextarea&&(Qe.hiddenTextarea.value=Qe.text),Qe._updateTextarea(),Qe.fire(z,{index:nn,action:"dragend"}),Pi.fire("text:changed",{target:Qe}),Pi.requestRenderAll()),Qe.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}const ko=/[ \n\.,;!\?\-]/;class Do extends To{constructor(){super(...arguments),t(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(f){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(f)}_animateCursor(f){let{toValue:ze,duration:Ke,delay:Qe,onComplete:Pi}=f;return js({startValue:this._currentCursorOpacity,endValue:ze,duration:Ke,delay:Qe,onComplete:Pi,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:nn=>{this._currentCursorOpacity=nn,this.renderCursorOrSelection()}})}_tick(f){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(f||0,100),onComplete:this._onTickComplete})}_onTickComplete(){var f;(f=this._currentTickCompleteState)===null||f===void 0||f.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick})}initDelayedCursor(f){this.abortCursorAnimation(),this._tick(f?0:this.cursorDelay)}abortCursorAnimation(){let f=!1;[this._currentTickState,this._currentTickCompleteState].forEach(ze=>{ze&&!ze.isDone()&&(f=!0,ze.abort())}),this._currentCursorOpacity=1,f&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some(f=>!f||f.isDone())&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}cmdAll(){this.selectAll(),this.renderCursorOrSelection()}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(f){let ze=0,Ke=f-1;if(this._reSpace.test(this._text[Ke]))for(;this._reSpace.test(this._text[Ke]);)ze++,Ke--;for(;/\S/.test(this._text[Ke])&&Ke>-1;)ze++,Ke--;return f-ze}findWordBoundaryRight(f){let ze=0,Ke=f;if(this._reSpace.test(this._text[Ke]))for(;this._reSpace.test(this._text[Ke]);)ze++,Ke++;for(;/\S/.test(this._text[Ke])&&Ke<this._text.length;)ze++,Ke++;return f+ze}findLineBoundaryLeft(f){let ze=0,Ke=f-1;for(;!/\n/.test(this._text[Ke])&&Ke>-1;)ze++,Ke--;return f-ze}findLineBoundaryRight(f){let ze=0,Ke=f;for(;!/\n/.test(this._text[Ke])&&Ke<this._text.length;)ze++,Ke++;return f+ze}searchWordBoundary(f,ze){const Ke=this._text;let Qe=f>0&&this._reSpace.test(Ke[f])&&(ze===-1||!F$1.test(Ke[f-1]))?f-1:f,Pi=Ke[Qe];for(;Qe>0&&Qe<Ke.length&&!ko.test(Pi);)Qe+=ze,Pi=Ke[Qe];return ze===-1&&ko.test(Pi)&&Qe++,Qe}selectWord(f){var ze;f=(ze=f)!==null&&ze!==void 0?ze:this.selectionStart;const Ke=this.searchWordBoundary(f,-1),Qe=Math.max(Ke,this.searchWordBoundary(f,1));this.selectionStart=Ke,this.selectionEnd=Qe,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(f){var ze;f=(ze=f)!==null&&ze!==void 0?ze:this.selectionStart;const Ke=this.findLineBoundaryLeft(f),Qe=this.findLineBoundaryRight(f);this.selectionStart=Ke,this.selectionEnd=Qe,this._fireSelectionChanged(),this._updateTextarea()}enterEditing(f){!this.isEditing&&this.editable&&(this.enterEditingImpl(),this.fire("editing:entered",f?{e:f}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e:f}),this.canvas.requestRenderAll()))}enterEditingImpl(){this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick()}updateSelectionOnMouseMove(f){if(this.getActiveControl())return;const ze=this.hiddenTextarea;Kt$1(ze).activeElement!==ze&&ze.focus();const Ke=this.getSelectionStartFromPointer(f),Qe=this.selectionStart,Pi=this.selectionEnd;(Ke===this.__selectionStartOnMouseDown&&Qe!==Pi||Qe!==Ke&&Pi!==Ke)&&(Ke>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=Ke):(this.selectionStart=Ke,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===Qe&&this.selectionEnd===Pi||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(f,ze,Ke){const Qe=Ke.slice(0,f),Pi=this.graphemeSplit(Qe).length;if(f===ze)return{selectionStart:Pi,selectionEnd:Pi};const nn=Ke.slice(f,ze);return{selectionStart:Pi,selectionEnd:Pi+this.graphemeSplit(nn).length}}fromGraphemeToStringSelection(f,ze,Ke){const Qe=Ke.slice(0,f).join("").length;return f===ze?{selectionStart:Qe,selectionEnd:Qe}:{selectionStart:Qe,selectionEnd:Qe+Ke.slice(f,ze).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){const f=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=f.selectionStart,this.hiddenTextarea.selectionEnd=f.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};const f=this.hiddenTextarea;this.text=f.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();const ze=this.fromStringToGraphemeSelection(f.selectionStart,f.selectionEnd,f.value);this.selectionEnd=this.selectionStart=ze.selectionEnd,this.inCompositionMode||(this.selectionStart=ze.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){const f=this._calcTextareaPosition();this.hiddenTextarea.style.left=f.left,this.hiddenTextarea.style.top=f.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};const f=this.inCompositionMode?this.compositionStart:this.selectionStart,ze=this._getCursorBoundaries(f),Ke=this.get2DCursorLocation(f),Qe=Ke.lineIndex,Pi=Ke.charIndex,nn=this.getValueOfPropertyAt(Qe,Pi,"fontSize")*this.lineHeight,ln=ze.leftOffset,cn=this.getCanvasRetinaScaling(),hn=this.canvas.upperCanvasEl,un=hn.width/cn,zn=hn.height/cn,Xn=un-nn,Un=zn-nn,qn=new ot$1(ze.left+ln,ze.top+ze.topOffset+nn).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new ot$1(hn.clientWidth/un,hn.clientHeight/zn));return qn.x<0&&(qn.x=0),qn.x>Xn&&(qn.x=Xn),qn.y<0&&(qn.y=0),qn.y>Un&&(qn.y=Un),qn.x+=this.canvas._offset.left,qn.y+=this.canvas._offset.top,{left:"".concat(qn.x,"px"),top:"".concat(qn.y,"px"),fontSize:"".concat(nn,"px"),charHeight:nn}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){const f=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,f&&(f.blur&&f.blur(),f.parentNode&&f.parentNode.removeChild(f)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop()}exitEditingImpl(){this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords())}exitEditing(){const f=this._textBeforeEdit!==this.text;return this.exitEditingImpl(),this.fire("editing:exited"),f&&this.fire(Q$1),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),f&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(const f in this.styles)this._textLines[f]||delete this.styles[f]}removeStyleFromTo(f,ze){const{lineIndex:Ke,charIndex:Qe}=this.get2DCursorLocation(f,!0),{lineIndex:Pi,charIndex:nn}=this.get2DCursorLocation(ze,!0);if(Ke!==Pi){if(this.styles[Ke])for(let ln=Qe;ln<this._unwrappedTextLines[Ke].length;ln++)delete this.styles[Ke][ln];if(this.styles[Pi])for(let ln=nn;ln<this._unwrappedTextLines[Pi].length;ln++){const cn=this.styles[Pi][ln];cn&&(this.styles[Ke]||(this.styles[Ke]={}),this.styles[Ke][Qe+ln-nn]=cn)}for(let ln=Ke+1;ln<=Pi;ln++)delete this.styles[ln];this.shiftLineStyles(Pi,Ke-Pi)}else if(this.styles[Ke]){const ln=this.styles[Ke],cn=nn-Qe;for(let hn=Qe;hn<nn;hn++)delete ln[hn];for(const hn in this.styles[Ke]){const un=parseInt(hn,10);un>=nn&&(ln[un-cn]=ln[hn],delete ln[hn])}}}shiftLineStyles(f,ze){const Ke=Object.assign({},this.styles);for(const Qe in this.styles){const Pi=parseInt(Qe,10);Pi>f&&(this.styles[Pi+ze]=Ke[Pi],Ke[Pi-ze]||delete this.styles[Pi])}}insertNewlineStyleObject(f,ze,Ke,Qe){const Pi={},nn=this._unwrappedTextLines[f].length,ln=nn===ze;let cn=!1;Ke||(Ke=1),this.shiftLineStyles(f,Ke);const hn=this.styles[f]?this.styles[f][ze===0?ze:ze-1]:void 0;for(const zn in this.styles[f]){const Xn=parseInt(zn,10);Xn>=ze&&(cn=!0,Pi[Xn-ze]=this.styles[f][zn],ln&&ze===0||delete this.styles[f][zn])}let un=!1;for(cn&&!ln&&(this.styles[f+Ke]=Pi,un=!0),(un||nn>ze)&&Ke--;Ke>0;)Qe&&Qe[Ke-1]?this.styles[f+Ke]={0:s({},Qe[Ke-1])}:hn?this.styles[f+Ke]={0:s({},hn)}:delete this.styles[f+Ke],Ke--;this._forceClearCache=!0}insertCharStyleObject(f,ze,Ke,Qe){this.styles||(this.styles={});const Pi=this.styles[f],nn=Pi?s({},Pi):{};Ke||(Ke=1);for(const cn in nn){const hn=parseInt(cn,10);hn>=ze&&(Pi[hn+Ke]=nn[hn],nn[hn-Ke]||delete Pi[hn])}if(this._forceClearCache=!0,Qe){for(;Ke--;)Object.keys(Qe[Ke]).length&&(this.styles[f]||(this.styles[f]={}),this.styles[f][ze+Ke]=s({},Qe[Ke]));return}if(!Pi)return;const ln=Pi[ze?ze-1:1];for(;ln&&Ke--;)this.styles[f][ze+Ke]=s({},ln)}insertNewStyleBlock(f,ze,Ke){const Qe=this.get2DCursorLocation(ze,!0),Pi=[0];let nn,ln=0;for(let cn=0;cn<f.length;cn++)f[cn]===`
`?(ln++,Pi[ln]=0):Pi[ln]++;for(Pi[0]>0&&(this.insertCharStyleObject(Qe.lineIndex,Qe.charIndex,Pi[0],Ke),Ke=Ke&&Ke.slice(Pi[0]+1)),ln&&this.insertNewlineStyleObject(Qe.lineIndex,Qe.charIndex+Pi[0],ln),nn=1;nn<ln;nn++)Pi[nn]>0?this.insertCharStyleObject(Qe.lineIndex+nn,0,Pi[nn],Ke):Ke&&this.styles[Qe.lineIndex+nn]&&Ke[0]&&(this.styles[Qe.lineIndex+nn][0]=Ke[0]),Ke=Ke&&Ke.slice(Pi[nn]+1);Pi[nn]>0&&this.insertCharStyleObject(Qe.lineIndex+nn,0,Pi[nn],Ke)}removeChars(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:f+1;this.removeStyleFromTo(f,ze),this._text.splice(f,ze-f),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(f,ze,Ke){let Qe=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Ke;Qe>Ke&&this.removeStyleFromTo(Ke,Qe);const Pi=this.graphemeSplit(f);this.insertNewStyleBlock(Pi,Ke,ze),this._text=[...this._text.slice(0,Ke),...Pi,...this._text.slice(Qe)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(f,ze,Ke){Ke<=f?(ze===f?this._selectionDirection=M$1:this._selectionDirection===A&&(this._selectionDirection=M$1,this.selectionEnd=f),this.selectionStart=Ke):Ke>f&&Ke<ze?this._selectionDirection===A?this.selectionEnd=Ke:this.selectionStart=Ke:(ze===f?this._selectionDirection=A:this._selectionDirection===M$1&&(this._selectionDirection=A,this.selectionStart=ze),this.selectionEnd=Ke)}}class Mo extends Do{initHiddenTextarea(){const f=this.canvas&&Kt$1(this.canvas.getElement())||m(),ze=f.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off"}).map(nn=>{let[ln,cn]=nn;return ze.setAttribute(ln,cn)});const{top:Ke,left:Qe,fontSize:Pi}=this._calcTextareaPosition();ze.style.cssText="position: absolute; top: ".concat(Ke,"; left: ").concat(Qe,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(Pi,";"),(this.hiddenTextareaContainer||f.body).appendChild(ze),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map(nn=>{let[ln,cn]=nn;return ze.addEventListener(ln,this[cn].bind(this))}),this.hiddenTextarea=ze}blur(){this.abortCursorAnimation()}onKeyDown(f){if(!this.isEditing)return;const ze=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(f.keyCode in ze)this[ze[f.keyCode]](f);else{if(!(f.keyCode in this.ctrlKeysMapDown)||!f.ctrlKey&&!f.metaKey)return;this[this.ctrlKeysMapDown[f.keyCode]](f)}f.stopImmediatePropagation(),f.preventDefault(),f.keyCode>=33&&f.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(f){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:f.keyCode in this.ctrlKeysMapUp&&(f.ctrlKey||f.metaKey)&&(this[this.ctrlKeysMapUp[f.keyCode]](f),f.stopImmediatePropagation(),f.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(f){const ze=this.fromPaste,{value:Ke,selectionStart:Qe,selectionEnd:Pi}=this.hiddenTextarea;if(this.fromPaste=!1,f&&f.stopPropagation(),!this.isEditing)return;const nn=()=>{this.updateFromTextArea(),this.fire(z),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(this.hiddenTextarea.value==="")return this.styles={},void nn();const ln=this._splitTextIntoLines(Ke).graphemeText,cn=this._text.length,hn=ln.length,un=this.selectionStart,zn=this.selectionEnd,Xn=un!==zn;let Un,qn,ys,vs,ea=hn-cn;const na=this.fromStringToGraphemeSelection(Qe,Pi,Ke),ta=un>na.selectionStart;Xn?(qn=this._text.slice(un,zn),ea+=zn-un):hn<cn&&(qn=ta?this._text.slice(zn+ea,zn):this._text.slice(un,un-ea));const ra=ln.slice(na.selectionEnd-ea,na.selectionEnd);if(qn&&qn.length&&(ra.length&&(Un=this.getSelectionStyles(un,un+1,!1),Un=ra.map(()=>Un[0])),Xn?(ys=un,vs=zn):ta?(ys=zn-qn.length,vs=zn):(ys=zn,vs=zn+qn.length),this.removeStyleFromTo(ys,vs)),ra.length){const{copyPasteData:oa}=p$1();ze&&ra.join("")===oa.copiedText&&!o.disableStyleCopyPaste&&(Un=oa.copiedTextStyle),this.insertNewStyleBlock(ra,un,Un)}nn()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(f){let{target:ze}=f;const{selectionStart:Ke,selectionEnd:Qe}=ze;this.compositionStart=Ke,this.compositionEnd=Qe,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;const{copyPasteData:f}=p$1();f.copiedText=this.getSelectedText(),o.disableStyleCopyPaste?f.copiedTextStyle=void 0:f.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(f,ze){let Ke,Qe=this._getLineLeftOffset(f);return ze>0&&(Ke=this.__charBounds[f][ze-1],Qe+=Ke.left+Ke.width),Qe}getDownCursorOffset(f,ze){const Ke=this._getSelectionForOffset(f,ze),Qe=this.get2DCursorLocation(Ke),Pi=Qe.lineIndex;if(Pi===this._textLines.length-1||f.metaKey||f.keyCode===34)return this._text.length-Ke;const nn=Qe.charIndex,ln=this._getWidthBeforeCursor(Pi,nn),cn=this._getIndexOnLine(Pi+1,ln);return this._textLines[Pi].slice(nn).length+cn+1+this.missingNewlineOffset(Pi)}_getSelectionForOffset(f,ze){return f.shiftKey&&this.selectionStart!==this.selectionEnd&&ze?this.selectionEnd:this.selectionStart}getUpCursorOffset(f,ze){const Ke=this._getSelectionForOffset(f,ze),Qe=this.get2DCursorLocation(Ke),Pi=Qe.lineIndex;if(Pi===0||f.metaKey||f.keyCode===33)return-Ke;const nn=Qe.charIndex,ln=this._getWidthBeforeCursor(Pi,nn),cn=this._getIndexOnLine(Pi-1,ln),hn=this._textLines[Pi].slice(0,nn),un=this.missingNewlineOffset(Pi-1);return-this._textLines[Pi-1].length+cn-hn.length+(1-un)}_getIndexOnLine(f,ze){const Ke=this._textLines[f];let Qe,Pi,nn=this._getLineLeftOffset(f),ln=0;for(let cn=0,hn=Ke.length;cn<hn;cn++)if(Qe=this.__charBounds[f][cn].width,nn+=Qe,nn>ze){Pi=!0;const un=nn-Qe,zn=nn,Xn=Math.abs(un-ze);ln=Math.abs(zn-ze)<Xn?cn:cn-1;break}return Pi||(ln=Ke.length-1),ln}moveCursorDown(f){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",f)}moveCursorUp(f){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",f)}_moveCursorUpOrDown(f,ze){const Ke=this["get".concat(f,"CursorOffset")](ze,this._selectionDirection===A);if(ze.shiftKey?this.moveCursorWithShift(Ke):this.moveCursorWithoutShift(Ke),Ke!==0){const Qe=this.text.length;this.selectionStart=gs(0,this.selectionStart,Qe),this.selectionEnd=gs(0,this.selectionEnd,Qe),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(f){const ze=this._selectionDirection===M$1?this.selectionStart+f:this.selectionEnd+f;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,ze),f!==0}moveCursorWithoutShift(f){return f<0?(this.selectionStart+=f,this.selectionEnd=this.selectionStart):(this.selectionEnd+=f,this.selectionStart=this.selectionEnd),f!==0}moveCursorLeft(f){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",f)}_move(f,ze,Ke){let Qe;if(f.altKey)Qe=this["findWordBoundary".concat(Ke)](this[ze]);else{if(!f.metaKey&&f.keyCode!==35&&f.keyCode!==36)return this[ze]+=Ke==="Left"?-1:1,!0;Qe=this["findLineBoundary".concat(Ke)](this[ze])}return Qe!==void 0&&this[ze]!==Qe&&(this[ze]=Qe,!0)}_moveLeft(f,ze){return this._move(f,ze,"Left")}_moveRight(f,ze){return this._move(f,ze,"Right")}moveCursorLeftWithoutShift(f){let ze=!0;return this._selectionDirection=M$1,this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(ze=this._moveLeft(f,"selectionStart")),this.selectionEnd=this.selectionStart,ze}moveCursorLeftWithShift(f){return this._selectionDirection===A&&this.selectionStart!==this.selectionEnd?this._moveLeft(f,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection=M$1,this._moveLeft(f,"selectionStart")):void 0}moveCursorRight(f){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",f)}_moveCursorLeftOrRight(f,ze){const Ke="moveCursor".concat(f).concat(ze.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[Ke](ze)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(f){return this._selectionDirection===M$1&&this.selectionStart!==this.selectionEnd?this._moveRight(f,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=A,this._moveRight(f,"selectionEnd")):void 0}moveCursorRightWithoutShift(f){let ze=!0;return this._selectionDirection=A,this.selectionStart===this.selectionEnd?(ze=this._moveRight(f,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,ze}}const Po=qe=>!!qe.button;class Eo extends Mo{constructor(){super(...arguments),t(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("mousetripleclick",this.tripleClickHandler),this.draggableTextDelegate=new Oo(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(f){return this.draggableTextDelegate.onDragStart(f)}canDrop(f){return this.draggableTextDelegate.canDrop(f)}doubleClickHandler(f){this.isEditing&&(this.selectWord(this.getSelectionStartFromPointer(f.e)),this.renderCursorOrSelection())}tripleClickHandler(f){this.isEditing&&(this.selectLine(this.getSelectionStartFromPointer(f.e)),this.renderCursorOrSelection())}_mouseDownHandler(f){let{e:ze,alreadySelected:Ke}=f;this.canvas&&this.editable&&!Po(ze)&&!this.getActiveControl()&&(this.draggableTextDelegate.start(ze)||(this.canvas.textEditingManager.register(this),Ke&&(this.inCompositionMode=!1,this.setCursorByClick(ze)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()),this.selected||(this.selected=Ke||this.isEditing)))}mouseUpHandler(f){let{e:ze,transform:Ke}=f;const Qe=this.draggableTextDelegate.end(ze);if(this.canvas){this.canvas.textEditingManager.unregister(this);const Pi=this.canvas._activeObject;if(Pi&&Pi!==this)return}!this.editable||this.group&&!this.group.interactive||Ke&&Ke.actionPerformed||Po(ze)||Qe||this.selected&&!this.getActiveControl()&&(this.enterEditing(ze),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection())}setCursorByClick(f){const ze=this.getSelectionStartFromPointer(f),Ke=this.selectionStart,Qe=this.selectionEnd;f.shiftKey?this.setSelectionStartEndWithShift(Ke,Qe,ze):(this.selectionStart=ze,this.selectionEnd=ze),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(f){const ze=this.canvas.getScenePoint(f).transform(St$1(this.calcTransformMatrix())).add(new ot$1(-this._getLeftOffset(),-this._getTopOffset()));let Ke=0,Qe=0,Pi=0;for(let hn=0;hn<this._textLines.length&&Ke<=ze.y;hn++)Ke+=this.getHeightOfLine(hn),Pi=hn,hn>0&&(Qe+=this._textLines[hn-1].length+this.missingNewlineOffset(hn-1));let nn=Math.abs(this._getLineLeftOffset(Pi));const ln=this._textLines[Pi].length,cn=this.__charBounds[Pi];for(let hn=0;hn<ln;hn++){const un=nn+cn[hn].kernedWidth;if(ze.x<=un){Math.abs(ze.x-un)<=Math.abs(ze.x-nn)&&Qe++;break}nn=un,Qe++}return Math.min(this.flipX?ln-Qe:Qe,this._text.length)}}const Ao="moveCursorUp",jo="moveCursorDown",Fo="moveCursorLeft",Lo="moveCursorRight",Ro="exitEditing",Io=(qe,f)=>{const ze=f.getRetinaScaling();qe.setTransform(ze,0,0,ze,0,0);const Ke=f.viewportTransform;qe.transform(Ke[0],Ke[1],Ke[2],Ke[3],Ke[4],Ke[5])},Bo=s({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:Ro,27:Ro,33:Ao,34:jo,35:Lo,36:Fo,37:Fo,38:Ao,39:Lo,40:jo},keysMapRtl:{9:Ro,27:Ro,33:Ao,34:jo,35:Fo,36:Lo,37:Lo,38:Ao,39:Fo,40:jo},ctrlKeysMapDown:{65:"cmdAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1});class Xo extends Eo{static getDefaults(){return s(s({},super.getDefaults()),Xo.ownDefaults)}get type(){const f=super.type;return f==="itext"?"i-text":f}constructor(f,ze){super(f,s(s({},Xo.ownDefaults),ze)),this.initBehavior()}_set(f,ze){return this.isEditing&&this._savedProps&&f in this._savedProps?(this._savedProps[f]=ze,this):(f==="canvas"&&(this.canvas instanceof Cn&&this.canvas.textEditingManager.remove(this),ze instanceof Cn&&ze.textEditingManager.add(this)),super._set(f,ze))}setSelectionStart(f){f=Math.max(f,0),this._updateAndFire("selectionStart",f)}setSelectionEnd(f){f=Math.min(f,this.text.length),this._updateAndFire("selectionEnd",f)}_updateAndFire(f,ze){this[f]!==ze&&(this._fireSelectionChanged(),this[f]=ze),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart||0,ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionEnd,Ke=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(f,ze,Ke)}setSelectionStyles(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionStart||0,Ke=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.selectionEnd;return super.setSelectionStyles(f,ze,Ke)}get2DCursorLocation(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,ze=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(f,ze)}render(f){super.render(f),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(f){const ze=this.isEditing;this.isEditing=!1;const Ke=super.toCanvasElement(f);return this.isEditing=ze,Ke}renderCursorOrSelection(){if(!this.isEditing||!this.canvas)return;const f=this.clearContextTop(!0);if(!f)return;const ze=this._getCursorBoundaries(),Ke=this.findAncestorsWithClipPath(),Qe=Ke.length>0;let Pi,nn=f;if(Qe){Pi=vt$1(f.canvas),nn=Pi.getContext("2d"),Io(nn,this.canvas);const ln=this.calcTransformMatrix();nn.transform(ln[0],ln[1],ln[2],ln[3],ln[4],ln[5])}if(this.selectionStart!==this.selectionEnd||this.inCompositionMode?this.renderSelection(nn,ze):this.renderCursor(nn,ze),Qe)for(const ln of Ke){const cn=ln.clipPath,hn=vt$1(f.canvas),un=hn.getContext("2d");if(Io(un,this.canvas),!cn.absolutePositioned){const zn=ln.calcTransformMatrix();un.transform(zn[0],zn[1],zn[2],zn[3],zn[4],zn[5])}cn.transform(un),cn.drawObject(un,!0,{}),this.drawClipPathOnCache(nn,cn,hn)}Qe&&(f.setTransform(1,0,0,1,0,0),f.drawImage(Pi,0,0)),this.canvas.contextTopDirty=!0,f.restore()}findAncestorsWithClipPath(){const f=[];let ze=this;for(;ze;)ze.clipPath&&f.push(ze),ze=ze.parent;return f}_getCursorBoundaries(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,ze=arguments.length>1?arguments[1]:void 0;const Ke=this._getLeftOffset(),Qe=this._getTopOffset(),Pi=this._getCursorBoundariesOffsets(f,ze);return{left:Ke,top:Qe,leftOffset:Pi.left,topOffset:Pi.top}}_getCursorBoundariesOffsets(f,ze){return ze?this.__getCursorBoundariesOffsets(f):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(f)}__getCursorBoundariesOffsets(f){let ze=0,Ke=0;const{charIndex:Qe,lineIndex:Pi}=this.get2DCursorLocation(f);for(let hn=0;hn<Pi;hn++)ze+=this.getHeightOfLine(hn);const nn=this._getLineLeftOffset(Pi),ln=this.__charBounds[Pi][Qe];ln&&(Ke=ln.left),this.charSpacing!==0&&Qe===this._textLines[Pi].length&&(Ke-=this._getWidthOfCharSpacing());const cn={top:ze,left:nn+(Ke>0?Ke:0)};return this.direction==="rtl"&&(this.textAlign===A||this.textAlign===po||this.textAlign===vo?cn.left*=-1:this.textAlign===M$1||this.textAlign===mo?cn.left=nn-(Ke>0?Ke:0):this.textAlign!==D$1&&this.textAlign!==yo||(cn.left=nn-(Ke>0?Ke:0))),cn}renderCursorAt(f){this._renderCursor(this.canvas.contextTop,this._getCursorBoundaries(f,!0),f)}renderCursor(f,ze){this._renderCursor(f,ze,this.selectionStart)}getCursorRenderingData(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this._getCursorBoundaries(f);const Ke=this.get2DCursorLocation(f),Qe=Ke.lineIndex,Pi=Ke.charIndex>0?Ke.charIndex-1:0,nn=this.getValueOfPropertyAt(Qe,Pi,"fontSize"),ln=this.getObjectScaling().x*this.canvas.getZoom(),cn=this.cursorWidth/ln,hn=this.getValueOfPropertyAt(Qe,Pi,"deltaY"),un=ze.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(Qe)/this.lineHeight-nn*(1-this._fontSizeFraction);return{color:this.cursorColor||this.getValueOfPropertyAt(Qe,Pi,"fill"),opacity:this._currentCursorOpacity,left:ze.left+ze.leftOffset-cn/2,top:un+ze.top+hn,width:cn,height:nn}}_renderCursor(f,ze,Ke){const{color:Qe,opacity:Pi,left:nn,top:ln,width:cn,height:hn}=this.getCursorRenderingData(Ke,ze);f.fillStyle=Qe,f.globalAlpha=Pi,f.fillRect(nn,ln,cn,hn)}renderSelection(f,ze){const Ke={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(f,Ke,ze)}renderDragSourceEffect(){const f=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,f,this._getCursorBoundaries(f.selectionStart,!0))}renderDropTargetEffect(f){const ze=this.getSelectionStartFromPointer(f);this.renderCursorAt(ze)}_renderSelection(f,ze,Ke){const Qe=ze.selectionStart,Pi=ze.selectionEnd,nn=this.textAlign.includes(po),ln=this.get2DCursorLocation(Qe),cn=this.get2DCursorLocation(Pi),hn=ln.lineIndex,un=cn.lineIndex,zn=ln.charIndex<0?0:ln.charIndex,Xn=cn.charIndex<0?0:cn.charIndex;for(let Un=hn;Un<=un;Un++){const qn=this._getLineLeftOffset(Un)||0;let ys=this.getHeightOfLine(Un),vs=0,ea=0,na=0;if(Un===hn&&(ea=this.__charBounds[hn][zn].left),Un>=hn&&Un<un)na=nn&&!this.isEndOfWrapping(Un)?this.width:this.getLineWidth(Un)||5;else if(Un===un)if(Xn===0)na=this.__charBounds[un][Xn].left;else{const ca=this._getWidthOfCharSpacing();na=this.__charBounds[un][Xn-1].left+this.__charBounds[un][Xn-1].width-ca}vs=ys,(this.lineHeight<1||Un===un&&this.lineHeight>1)&&(ys/=this.lineHeight);let ta=Ke.left+qn+ea,ra=ys,oa=0;const fa=na-ea;this.inCompositionMode?(f.fillStyle=this.compositionColor||"black",ra=1,oa=ys):f.fillStyle=this.selectionColor,this.direction==="rtl"&&(this.textAlign===A||this.textAlign===po||this.textAlign===vo?ta=this.width-ta-fa:this.textAlign===M$1||this.textAlign===mo?ta=Ke.left+qn-na:this.textAlign!==D$1&&this.textAlign!==yo||(ta=Ke.left+qn-na)),f.fillRect(ta,Ke.top+Ke.topOffset+oa,fa,ra),Ke.topOffset+=vs}}getCurrentCharFontSize(){const f=this._getCurrentCharIndex();return this.getValueOfPropertyAt(f.l,f.c,"fontSize")}getCurrentCharColor(){const f=this._getCurrentCharIndex();return this.getValueOfPropertyAt(f.l,f.c,K$1)}_getCurrentCharIndex(){const f=this.get2DCursorLocation(this.selectionStart,!0),ze=f.charIndex>0?f.charIndex-1:0;return{l:f.lineIndex,c:ze}}dispose(){this.exitEditingImpl(),this.draggableTextDelegate.dispose(),super.dispose()}}t(Xo,"ownDefaults",Bo),t(Xo,"type","IText"),tt.setClass(Xo),tt.setClass(Xo,"i-text");class Yo extends Xo{static getDefaults(){return s(s({},super.getDefaults()),Yo.ownDefaults)}constructor(f,ze){super(f,s(s({},Yo.ownDefaults),ze))}static createControls(){return{controls:mi()}}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(po)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(f){let ze=0,Ke=0,Qe=0;const Pi={};for(let nn=0;nn<f.graphemeLines.length;nn++)f.graphemeText[Qe]===`
`&&nn>0?(Ke=0,Qe++,ze++):!this.splitByGrapheme&&this._reSpaceAndTab.test(f.graphemeText[Qe])&&nn>0&&(Ke++,Qe++),Pi[nn]={line:ze,offset:Ke},Qe+=f.graphemeLines[nn].length,Ke+=f.graphemeLines[nn].length;return Pi}styleHas(f,ze){if(this._styleMap&&!this.isWrapping){const Ke=this._styleMap[ze];Ke&&(ze=Ke.line)}return super.styleHas(f,ze)}isEmptyStyles(f){if(!this.styles)return!0;let ze,Ke=0,Qe=f+1,Pi=!1;const nn=this._styleMap[f],ln=this._styleMap[f+1];nn&&(f=nn.line,Ke=nn.offset),ln&&(Qe=ln.line,Pi=Qe===f,ze=ln.offset);const cn=f===void 0?this.styles:{line:this.styles[f]};for(const hn in cn)for(const un in cn[hn]){const zn=parseInt(un,10);if(zn>=Ke&&(!Pi||zn<ze))for(const Xn in cn[hn][un])return!1}return!0}_getStyleDeclaration(f,ze){if(this._styleMap&&!this.isWrapping){const Ke=this._styleMap[f];if(!Ke)return{};f=Ke.line,ze=Ke.offset+ze}return super._getStyleDeclaration(f,ze)}_setStyleDeclaration(f,ze,Ke){const Qe=this._styleMap[f];super._setStyleDeclaration(Qe.line,Qe.offset+ze,Ke)}_deleteStyleDeclaration(f,ze){const Ke=this._styleMap[f];super._deleteStyleDeclaration(Ke.line,Ke.offset+ze)}_getLineStyle(f){const ze=this._styleMap[f];return!!this.styles[ze.line]}_setLineStyle(f){const ze=this._styleMap[f];super._setLineStyle(ze.line)}_wrapText(f,ze){this.isWrapping=!0;const Ke=this.getGraphemeDataForRender(f),Qe=[];for(let Pi=0;Pi<Ke.wordsData.length;Pi++)Qe.push(...this._wrapLine(Pi,ze,Ke));return this.isWrapping=!1,Qe}getGraphemeDataForRender(f){const ze=this.splitByGrapheme,Ke=ze?"":" ";let Qe=0;return{wordsData:f.map((Pi,nn)=>{let ln=0;const cn=ze?this.graphemeSplit(Pi):this.wordSplit(Pi);return cn.length===0?[{word:[],width:0}]:cn.map(hn=>{const un=ze?[hn]:this.graphemeSplit(hn),zn=this._measureWord(un,nn,ln);return Qe=Math.max(zn,Qe),ln+=un.length+Ke.length,{word:un,width:zn}})}),largestWordWidth:Qe}}_measureWord(f,ze){let Ke,Qe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,Pi=0;for(let nn=0,ln=f.length;nn<ln;nn++)Pi+=this._getGraphemeBox(f[nn],ze,nn+Qe,Ke,!0).kernedWidth,Ke=f[nn];return Pi}wordSplit(f){return f.split(this._wordJoiners)}_wrapLine(f,ze,Ke){let{largestWordWidth:Qe,wordsData:Pi}=Ke,nn=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const ln=this._getWidthOfCharSpacing(),cn=this.splitByGrapheme,hn=[],un=cn?"":" ";let zn=0,Xn=[],Un=0,qn=0,ys=!0;ze-=nn;const vs=Math.max(ze,Qe,this.dynamicMinWidth),ea=Pi[f];let na;for(Un=0,na=0;na<ea.length;na++){const{word:ta,width:ra}=ea[na];Un+=ta.length,zn+=qn+ra-ln,zn>vs&&!ys?(hn.push(Xn),Xn=[],zn=ra,ys=!0):zn+=ln,ys||cn||Xn.push(un),Xn=Xn.concat(ta),qn=cn?0:this._measureWord([un],f,Un),Un++,ys=!1}return na&&hn.push(Xn),Qe+nn>this.dynamicMinWidth&&(this.dynamicMinWidth=Qe-ln+nn),hn}isEndOfWrapping(f){return!this._styleMap[f+1]||this._styleMap[f+1].line!==this._styleMap[f].line}missingNewlineOffset(f,ze){return this.splitByGrapheme&&!ze?this.isEndOfWrapping(f)?1:0:1}_splitTextIntoLines(f){const ze=super._splitTextIntoLines(f),Ke=this._wrapText(ze.lines,this.width),Qe=new Array(Ke.length);for(let Pi=0;Pi<Ke.length;Pi++)Qe[Pi]=Ke[Pi].join("");return ze.lines=Qe,ze.graphemeLines=Ke,ze}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){const f=new Map;for(const ze in this._styleMap){const Ke=parseInt(ze,10);if(this._textLines[Ke]){const Qe=this._styleMap[ze].line;f.set("".concat(Qe),!0)}}for(const ze in this.styles)f.has(ze)||delete this.styles[ze]}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...f])}}t(Yo,"type","Textbox"),t(Yo,"textLayoutProperties",[...Xo.textLayoutProperties,"width"]),t(Yo,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),tt.setClass(Yo);class Wo extends Cr{shouldPerformLayout(f){return!!f.target.clipPath&&super.shouldPerformLayout(f)}shouldLayoutClipPath(){return!1}calcLayoutResult(f,ze){const{target:Ke}=f,{clipPath:Qe,group:Pi}=Ke;if(!Qe||!this.shouldPerformLayout(f))return;const{width:nn,height:ln}=ae$1(xr(Ke,Qe)),cn=new ot$1(nn,ln);if(Qe.absolutePositioned)return{center:pe$1(Qe.getRelativeCenterPoint(),void 0,Pi?Pi.calcTransformMatrix():void 0),size:cn};{const hn=Qe.getRelativeCenterPoint().transform(Ke.calcOwnMatrix(),!0);if(this.shouldPerformLayout(f)){const{center:un=new ot$1,correction:zn=new ot$1}=this.calcBoundingBox(ze,f)||{};return{center:un.add(hn),correction:zn.subtract(hn),size:cn}}return{center:Ke.getRelativeCenterPoint().add(hn),size:cn}}}}t(Wo,"type","clip-path"),tt.setClass(Wo);class Vo extends Cr{getInitialSize(f,ze){let{target:Ke}=f,{size:Qe}=ze;return new ot$1(Ke.width||Qe.x,Ke.height||Qe.y)}}t(Vo,"type","fixed"),tt.setClass(Vo);class zo extends Or{subscribeTargets(f){const ze=f.target;f.targets.reduce((Ke,Qe)=>(Qe.parent&&Ke.add(Qe.parent),Ke),new Set).forEach(Ke=>{Ke.layoutManager.subscribeTargets({target:Ke,targets:[ze]})})}unsubscribeTargets(f){const ze=f.target,Ke=ze.getObjects();f.targets.reduce((Qe,Pi)=>(Pi.parent&&Qe.add(Pi.parent),Qe),new Set).forEach(Qe=>{!Ke.some(Pi=>Pi.parent===Qe)&&Qe.layoutManager.unsubscribeTargets({target:Qe,targets:[ze]})})}}class Go extends Mr{static getDefaults(){return s(s({},super.getDefaults()),Go.ownDefaults)}constructor(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,Go.ownDefaults),this.setOptions(ze);const{left:Ke,top:Qe,layoutManager:Pi}=ze;this.groupInit(f,{left:Ke,top:Qe,layoutManager:Pi??new zo})}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var f=arguments.length,ze=new Array(f),Ke=0;Ke<f;Ke++)ze[Ke]=arguments[Ke];this.multiSelectionStacking==="selection-order"?this.add(...ze):ze.forEach(Qe=>{const Pi=this._objects.findIndex(ln=>ln.isInFrontOf(Qe)),nn=Pi===-1?this.size():Pi;this.insertAt(nn,Qe)})}canEnterGroup(f){return this.getObjects().some(ze=>ze.isDescendantOf(f)||f.isDescendantOf(ze))?(a("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(f)}enterGroup(f,ze){f.parent&&f.parent===f.group?f.parent._exitGroup(f):f.group&&f.parent!==f.group&&f.group.remove(f),this._enterGroup(f,ze)}exitGroup(f,ze){this._exitGroup(f,ze),f.parent&&f.parent._enterGroup(f,!0)}_onAfterObjectsChange(f,ze){super._onAfterObjectsChange(f,ze);const Ke=new Set;ze.forEach(Qe=>{const{parent:Pi}=Qe;Pi&&Ke.add(Pi)}),f===yr?Ke.forEach(Qe=>{Qe._onAfterObjectsChange(vr,ze)}):Ke.forEach(Qe=>{Qe._set("dirty",!0)})}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(f,ze,Ke){f.save(),f.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;const Qe=s(s({hasControls:!1},Ke),{},{forActiveSelection:!0});for(let Pi=0;Pi<this._objects.length;Pi++)this._objects[Pi]._renderControls(f,Qe);super._renderControls(f,ze),f.restore()}}t(Go,"type","ActiveSelection"),t(Go,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),tt.setClass(Go),tt.setClass(Go,"activeSelection");class Ho{constructor(){t(this,"resources",{})}applyFilters(f,ze,Ke,Qe,Pi){const nn=Pi.getContext("2d");if(!nn)return;nn.drawImage(ze,0,0,Ke,Qe);const ln={sourceWidth:Ke,sourceHeight:Qe,imageData:nn.getImageData(0,0,Ke,Qe),originalEl:ze,originalImageData:nn.getImageData(0,0,Ke,Qe),canvasEl:Pi,ctx:nn,filterBackend:this};f.forEach(hn=>{hn.applyTo(ln)});const{imageData:cn}=ln;return cn.width===Ke&&cn.height===Qe||(Pi.width=cn.width,Pi.height=cn.height),nn.putImageData(cn,0,0),ln}}class No{constructor(){let{tileSize:f=o.textureSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};t(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),t(this,"resources",{}),this.tileSize=f,this.setupGLContext(f,f),this.captureGPUInfo()}setupGLContext(f,ze){this.dispose(),this.createWebGLCanvas(f,ze)}createWebGLCanvas(f,ze){const Ke=vt$1({width:f,height:ze}),Qe=Ke.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});Qe&&(Qe.clearColor(0,0,0,0),this.canvas=Ke,this.gl=Qe)}applyFilters(f,ze,Ke,Qe,Pi,nn){const ln=this.gl,cn=Pi.getContext("2d");if(!ln||!cn)return;let hn;nn&&(hn=this.getCachedTexture(nn,ze));const un={originalWidth:ze.width||ze.naturalWidth||0,originalHeight:ze.height||ze.naturalHeight||0,sourceWidth:Ke,sourceHeight:Qe,destinationWidth:Ke,destinationHeight:Qe,context:ln,sourceTexture:this.createTexture(ln,Ke,Qe,hn?void 0:ze),targetTexture:this.createTexture(ln,Ke,Qe),originalTexture:hn||this.createTexture(ln,Ke,Qe,hn?void 0:ze),passes:f.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:Pi},zn=ln.createFramebuffer();return ln.bindFramebuffer(ln.FRAMEBUFFER,zn),f.forEach(Xn=>{Xn&&Xn.applyTo(un)}),function(Xn){const Un=Xn.targetCanvas,qn=Un.width,ys=Un.height,vs=Xn.destinationWidth,ea=Xn.destinationHeight;qn===vs&&ys===ea||(Un.width=vs,Un.height=ea)}(un),this.copyGLTo2D(ln,un),ln.bindTexture(ln.TEXTURE_2D,null),ln.deleteTexture(un.sourceTexture),ln.deleteTexture(un.targetTexture),ln.deleteFramebuffer(zn),cn.setTransform(1,0,0,1,0,0),un}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(f,ze,Ke,Qe,Pi){const{NEAREST:nn,TEXTURE_2D:ln,RGBA:cn,UNSIGNED_BYTE:hn,CLAMP_TO_EDGE:un,TEXTURE_MAG_FILTER:zn,TEXTURE_MIN_FILTER:Xn,TEXTURE_WRAP_S:Un,TEXTURE_WRAP_T:qn}=f,ys=f.createTexture();return f.bindTexture(ln,ys),f.texParameteri(ln,zn,Pi||nn),f.texParameteri(ln,Xn,Pi||nn),f.texParameteri(ln,Un,un),f.texParameteri(ln,qn,un),Qe?f.texImage2D(ln,0,cn,cn,hn,Qe):f.texImage2D(ln,0,cn,ze,Ke,0,cn,hn,null),ys}getCachedTexture(f,ze,Ke){const{textureCache:Qe}=this;if(Qe[f])return Qe[f];{const Pi=this.createTexture(this.gl,ze.width,ze.height,ze,Ke);return Pi&&(Qe[f]=Pi),Pi}}evictCachesForKey(f){this.textureCache[f]&&(this.gl.deleteTexture(this.textureCache[f]),delete this.textureCache[f])}copyGLTo2D(f,ze){const Ke=f.canvas,Qe=ze.targetCanvas,Pi=Qe.getContext("2d");if(!Pi)return;Pi.translate(0,Qe.height),Pi.scale(1,-1);const nn=Ke.height-Qe.height;Pi.drawImage(Ke,0,nn,Qe.width,Qe.height,0,0,Qe.width,Qe.height)}copyGLTo2DPutImageData(f,ze){const Ke=ze.targetCanvas.getContext("2d"),Qe=ze.destinationWidth,Pi=ze.destinationHeight,nn=Qe*Pi*4;if(!Ke)return;const ln=new Uint8Array(this.imageBuffer,0,nn),cn=new Uint8ClampedArray(this.imageBuffer,0,nn);f.readPixels(0,0,Qe,Pi,f.RGBA,f.UNSIGNED_BYTE,ln);const hn=new ImageData(cn,Qe,Pi);Ke.putImageData(hn,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;const f=this.gl,ze={renderer:"",vendor:""};if(!f)return ze;const Ke=f.getExtension("WEBGL_debug_renderer_info");if(Ke){const Qe=f.getParameter(Ke.UNMASKED_RENDERER_WEBGL),Pi=f.getParameter(Ke.UNMASKED_VENDOR_WEBGL);Qe&&(ze.renderer=Qe.toLowerCase()),Pi&&(ze.vendor=Pi.toLowerCase())}return this.gpuInfo=ze,ze}}let Uo;function qo(){const{WebGLProbe:qe}=p$1();return qe.queryWebGL(pt$1()),o.enableGLFiltering&&qe.isSupported(o.textureSize)?new No({tileSize:o.textureSize}):new Ho}function Ko(){return!Uo&&(!(arguments.length>0&&arguments[0]!==void 0)||arguments[0])&&(Uo=qo()),Uo}const Qo=["filters","resizeFilter","src","crossOrigin","type"],Zo=["cropX","cropY"];class $o extends _i{static getDefaults(){return s(s({},super.getDefaults()),$o.ownDefaults)}constructor(f,ze){super(),t(this,"_lastScaleX",1),t(this,"_lastScaleY",1),t(this,"_filterScalingX",1),t(this,"_filterScalingY",1),this.filters=[],Object.assign(this,$o.ownDefaults),this.setOptions(ze),this.cacheKey="texture".concat(ft$1()),this.setElement(typeof f=="string"?(this.canvas&&Kt$1(this.canvas.getElement())||m()).getElementById(f):f,ze)}getElement(){return this._element}setElement(f){var ze;let Ke=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=f,this._originalElement=f,this._setWidthHeight(Ke),(ze=f.classList)===null||ze===void 0||ze.add($o.CSS_CANVAS),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(f){const ze=Ko(!1);ze instanceof No&&ze.evictCachesForKey(f)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(f=>{const ze=this[f];ze&&p$1().dispose(ze),this[f]=void 0})}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){const f=this.getElement();return f?{width:f.naturalWidth||f.width,height:f.naturalHeight||f.height}:{width:0,height:0}}_stroke(f){if(!this.stroke||this.strokeWidth===0)return;const ze=this.width/2,Ke=this.height/2;f.beginPath(),f.moveTo(-ze,-Ke),f.lineTo(ze,-Ke),f.lineTo(ze,Ke),f.lineTo(-ze,Ke),f.lineTo(-ze,-Ke),f.closePath()}toObject(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const ze=[];return this.filters.forEach(Ke=>{Ke&&ze.push(Ke.toObject())}),s(s({},super.toObject([...Zo,...f])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:ze},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){const f=[],ze=this._element,Ke=-this.width/2,Qe=-this.height/2;let Pi=[],nn=[],ln="",cn="";if(!ze)return[];if(this.hasCrop()){const hn=ft$1();Pi.push('<clipPath id="imageCrop_'+hn+`">
`,'	<rect x="'+Ke+'" y="'+Qe+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),ln=' clip-path="url(#imageCrop_'+hn+')" '}if(this.imageSmoothing||(cn=' image-rendering="optimizeSpeed"'),f.push("	<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(Ke-this.cropX,'" y="').concat(Qe-this.cropY,'" width="').concat(ze.width||ze.naturalWidth,'" height="').concat(ze.height||ze.naturalHeight,'"').concat(cn).concat(ln,`></image>
`)),this.stroke||this.strokeDashArray){const hn=this.fill;this.fill=null,nn=['	<rect x="'.concat(Ke,'" y="').concat(Qe,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),`" />
`)],this.fill=hn}return Pi=this.paintFirst!==K$1?Pi.concat(nn,f):Pi.concat(f,nn),Pi}getSrc(f){const ze=f?this._element:this._originalElement;return ze?ze.toDataURL?ze.toDataURL():this.srcFromAttribute?ze.getAttribute("src")||"":ze.src:this.src||""}getSvgSrc(f){return this.getSrc(f)}setSrc(f){let{crossOrigin:ze,signal:Ke}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return It$1(f,{crossOrigin:ze,signal:Ke}).then(Qe=>{ze!==void 0&&this.set({crossOrigin:ze}),this.setElement(Qe)})}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){const f=this.resizeFilter,ze=this.minimumScaleTrigger,Ke=this.getTotalObjectScaling(),Qe=Ke.x,Pi=Ke.y,nn=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!f||Qe>ze&&Pi>ze)return this._element=nn,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=Qe,void(this._lastScaleY=Pi);const ln=vt$1(nn),{width:cn,height:hn}=nn;this._element=ln,this._lastScaleX=f.scaleX=Qe,this._lastScaleY=f.scaleY=Pi,Ko().applyFilters([f],nn,cn,hn,this._element),this._filterScalingX=ln.width/this._originalElement.width,this._filterScalingY=ln.height/this._originalElement.height}applyFilters(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.filters||[];if(f=f.filter(Pi=>Pi&&!Pi.isNeutralState()),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),f.length===0)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);const ze=this._originalElement,Ke=ze.naturalWidth||ze.width,Qe=ze.naturalHeight||ze.height;if(this._element===this._originalElement){const Pi=vt$1({width:Ke,height:Qe});this._element=Pi,this._filteredEl=Pi}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,Ke,Qe),this._lastScaleX=1,this._lastScaleY=1);Ko().applyFilters(f,this._originalElement,Ke,Qe,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(f){f.imageSmoothingEnabled=this.imageSmoothing,this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(f),this._renderPaintInOrder(f)}drawCacheOnCanvas(f){f.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(f)}shouldCache(){return this.needsItsOwnCache()}_renderFill(f){const ze=this._element;if(!ze)return;const Ke=this._filterScalingX,Qe=this._filterScalingY,Pi=this.width,nn=this.height,ln=Math.max(this.cropX,0),cn=Math.max(this.cropY,0),hn=ze.naturalWidth||ze.width,un=ze.naturalHeight||ze.height,zn=ln*Ke,Xn=cn*Qe,Un=Math.min(Pi*Ke,hn-zn),qn=Math.min(nn*Qe,un-Xn),ys=-Pi/2,vs=-nn/2,ea=Math.min(Pi,hn/Ke-ln),na=Math.min(nn,un/Qe-cn);ze&&f.drawImage(ze,zn,Xn,Un,qn,ys,vs,ea,na)}_needsResize(){const f=this.getTotalObjectScaling();return f.x!==this._lastScaleX||f.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:f,height:ze}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const Ke=this.getOriginalSize();this.width=f||Ke.width,this.height=ze||Ke.height}parsePreserveAspectRatioAttribute(){const f=Ie$1(this.preserveAspectRatio||""),ze=this.width,Ke=this.height,Qe={width:ze,height:Ke};let Pi,nn=this._element.width,ln=this._element.height,cn=1,hn=1,un=0,zn=0,Xn=0,Un=0;return!f||f.alignX===j$1&&f.alignY===j$1?(cn=ze/nn,hn=Ke/ln):(f.meetOrSlice==="meet"&&(cn=hn=Pr(this._element,Qe),Pi=(ze-nn*cn)/2,f.alignX==="Min"&&(un=-Pi),f.alignX==="Max"&&(un=Pi),Pi=(Ke-ln*hn)/2,f.alignY==="Min"&&(zn=-Pi),f.alignY==="Max"&&(zn=Pi)),f.meetOrSlice==="slice"&&(cn=hn=Er(this._element,Qe),Pi=nn-ze/cn,f.alignX==="Mid"&&(Xn=Pi/2),f.alignX==="Max"&&(Xn=Pi),Pi=ln-Ke/hn,f.alignY==="Mid"&&(Un=Pi/2),f.alignY==="Max"&&(Un=Pi),nn=ze/cn,ln=Ke/hn)),{width:nn,height:ln,scaleX:cn,scaleY:hn,offsetLeft:un,offsetTop:zn,cropX:Xn,cropY:Un}}static fromObject(f,ze){let{filters:Ke,resizeFilter:Qe,src:Pi,crossOrigin:nn,type:ln}=f,cn=i(f,Qo);return Promise.all([It$1(Pi,s(s({},ze),{},{crossOrigin:nn})),Ke&&Bt$1(Ke,ze),Qe&&Bt$1([Qe],ze),Xt$1(cn,ze)]).then(hn=>{let[un,zn=[],[Xn]=[],Un={}]=hn;return new this(un,s(s({},cn),{},{src:Pi,filters:zn,resizeFilter:Xn},Un))})}static fromURL(f){let{crossOrigin:ze=null,signal:Ke}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Qe=arguments.length>2?arguments[2]:void 0;return It$1(f,{crossOrigin:ze,signal:Ke}).then(Pi=>new this(Pi,Qe))}static async fromElement(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ke=arguments.length>2?arguments[2]:void 0;const Qe=dr(f,this.ATTRIBUTE_NAMES,Ke);return this.fromURL(Qe["xlink:href"]||Qe.href,ze,Qe).catch(Pi=>(a("log","Unable to parse Image",Pi),null))}}t($o,"type","Image"),t($o,"cacheProperties",[...ps,...Zo]),t($o,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),t($o,"CSS_CANVAS","canvas-img"),t($o,"ATTRIBUTE_NAMES",[...Fi,"x","y","width","height","preserveAspectRatio","xlink:href","href","crossOrigin","image-rendering"]),tt.setClass($o),tt.setSVGClass($o);Ye(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);const ma=W$1,va=qe=>function(f,ze,Ke){const{points:Qe,pathOffset:Pi}=Ke;return new ot$1(Qe[qe]).subtract(Pi).transform(Tt$1(Ke.getViewportTransform(),Ke.calcTransformMatrix()))},ya=(qe,f,ze,Ke)=>{const{target:Qe,pointIndex:Pi}=f,nn=Qe,ln=pe$1(new ot$1(ze,Ke),void 0,nn.calcOwnMatrix());return nn.points[Pi]=ln.add(nn.pathOffset),nn.setDimensions(),!0},_a=(qe,f)=>function(ze,Ke,Qe,Pi){const nn=Ke.target,ln=new ot$1(nn.points[(qe>0?qe:nn.points.length)-1]),cn=ln.subtract(nn.pathOffset).transform(nn.calcOwnMatrix()),hn=f(ze,s(s({},Ke),{},{pointIndex:qe}),Qe,Pi),un=ln.subtract(nn.pathOffset).transform(nn.calcOwnMatrix()).subtract(cn);return nn.left-=un.x,nn.top-=un.y,hn},xa=qe=>Ys(ma,_a(qe,ya)),Ca=(qe,f,ze)=>{const{path:Ke,pathOffset:Qe}=qe,Pi=Ke[f];return new ot$1(Pi[ze]-Qe.x,Pi[ze+1]-Qe.y).transform(Tt$1(qe.getViewportTransform(),qe.calcTransformMatrix()))};function ba(qe,f,ze){const{commandIndex:Ke,pointIndex:Qe}=this;return Ca(ze,Ke,Qe)}function wa(qe,f,ze,Ke){const{target:Qe}=f,{commandIndex:Pi,pointIndex:nn}=this,ln=((cn,hn,un,zn,Xn)=>{const{path:Un,pathOffset:qn}=cn,ys=Un[(zn>0?zn:Un.length)-1],vs=new ot$1(ys[Xn],ys[Xn+1]),ea=vs.subtract(qn).transform(cn.calcOwnMatrix()),na=pe$1(new ot$1(hn,un),void 0,cn.calcOwnMatrix());Un[zn][Xn]=na.x+qn.x,Un[zn][Xn+1]=na.y+qn.y,cn.setDimensions();const ta=vs.subtract(cn.pathOffset).transform(cn.calcOwnMatrix()).subtract(ea);return cn.left-=ta.x,cn.top-=ta.y,cn.set("dirty",!0),!0})(Qe,ze,Ke,Pi,nn);return ye$1(this.actionName,s(s({},Te$1(qe,f,ze,Ke)),{},{commandIndex:Pi,pointIndex:nn})),ln}class Sa extends Hs{constructor(f){super(f)}render(f,ze,Ke,Qe,Pi){const nn=s(s({},Qe),{},{cornerColor:this.controlFill,cornerStrokeColor:this.controlStroke,transparentCorners:!this.controlFill});super.render(f,ze,Ke,nn,Pi)}}class Ta extends Sa{constructor(f){super(f)}render(f,ze,Ke,Qe,Pi){const{path:nn}=Pi,{commandIndex:ln,pointIndex:cn,connectToCommandIndex:hn,connectToPointIndex:un}=this;f.save(),f.strokeStyle=this.controlStroke,this.connectionDashArray&&f.setLineDash(this.connectionDashArray);const[zn]=nn[ln],Xn=Ca(Pi,hn,un);if(zn==="Q"){const Un=Ca(Pi,ln,cn+2);f.moveTo(Un.x,Un.y),f.lineTo(ze,Ke)}else f.moveTo(ze,Ke);f.lineTo(Xn.x,Xn.y),f.stroke(),f.restore(),super.render(f,ze,Ke,Qe,Pi)}}const Oa=(qe,f,ze,Ke,Qe,Pi)=>new(ze?Ta:Sa)(s(s({commandIndex:qe,pointIndex:f,actionName:"modifyPath",positionHandler:ba,actionHandler:wa,connectToCommandIndex:Qe,connectToPointIndex:Pi},Ke),ze?Ke.controlPointStyle:Ke.pointStyle));var ka=Object.freeze({__proto__:null,changeWidth:Vs,createObjectDefaultControls:fi,createPathControls:function(qe){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const ze={};let Ke="M";return qe.path.forEach((Qe,Pi)=>{const nn=Qe[0];switch(nn!=="Z"&&(ze["c_".concat(Pi,"_").concat(nn)]=Oa(Pi,Qe.length-2,!1,f)),nn){case"C":ze["c_".concat(Pi,"_C_CP_1")]=Oa(Pi,1,!0,f,Pi-1,(ln=>ln==="C"?5:ln==="Q"?3:1)(Ke)),ze["c_".concat(Pi,"_C_CP_2")]=Oa(Pi,3,!0,f,Pi,5);break;case"Q":ze["c_".concat(Pi,"_Q_CP_1")]=Oa(Pi,1,!0,f,Pi,3)}Ke=nn}),ze},createPolyActionHandler:xa,createPolyControls:function(qe){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const ze={};for(let Ke=0;Ke<(typeof qe=="number"?qe:qe.points.length);Ke++)ze["p".concat(Ke)]=new Hs(s({actionName:ma,positionHandler:va(Ke),actionHandler:xa(Ke)},f));return ze},createPolyPositionHandler:va,createResizeControls:pi,createTextboxDefaultControls:mi,dragHandler:De$1,factoryPolyActionHandler:_a,getLocalPoint:ke$1,polyActionHandler:ya,renderCircleControl:zs,renderSquareControl:Gs,rotationStyleHandler:Ns,rotationWithSnapping:Us,scaleCursorStyleHandler:Qs,scaleOrSkewActionName:li$1,scaleSkewCursorStyleHandler:ui,scalingEqually:$s,scalingX:ti,scalingXOrSkewingY:di,scalingY:ei,scalingYOrSkewingX:gi,skewCursorStyleHandler:ni,skewHandlerX:ai,skewHandlerY:hi,wrapWithFireEvent:Ys,wrapWithFixedAnchor:Ws});const Da=qe=>qe.webgl!==void 0,Pa="precision highp float",Ea=`
    `.concat(Pa,`;
    varying vec2 vTexCoord;
    uniform sampler2D uTexture;
    void main() {
      gl_FragColor = texture2D(uTexture, vTexCoord);
    }`),Aa=["type"],ja=["type"],Fa=new RegExp(Pa,"g");class La{get type(){return this.constructor.type}constructor(){let f=i(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Aa);Object.assign(this,this.constructor.defaults,f)}getFragmentSource(){return Ea}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    void main() {
      vTexCoord = aPosition;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }`}createProgram(f){let ze=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getFragmentSource(),Ke=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.getVertexSource();const{WebGLProbe:{GLPrecision:Qe="highp"}}=p$1();Qe!=="highp"&&(ze=ze.replace(Fa,Pa.replace("highp",Qe)));const Pi=f.createShader(f.VERTEX_SHADER),nn=f.createShader(f.FRAGMENT_SHADER),ln=f.createProgram();if(!Pi||!nn||!ln)throw new h("Vertex, fragment shader or program creation error");if(f.shaderSource(Pi,Ke),f.compileShader(Pi),!f.getShaderParameter(Pi,f.COMPILE_STATUS))throw new h("Vertex shader compile error for ".concat(this.type,": ").concat(f.getShaderInfoLog(Pi)));if(f.shaderSource(nn,ze),f.compileShader(nn),!f.getShaderParameter(nn,f.COMPILE_STATUS))throw new h("Fragment shader compile error for ".concat(this.type,": ").concat(f.getShaderInfoLog(nn)));if(f.attachShader(ln,Pi),f.attachShader(ln,nn),f.linkProgram(ln),!f.getProgramParameter(ln,f.LINK_STATUS))throw new h('Shader link error for "'.concat(this.type,'" ').concat(f.getProgramInfoLog(ln)));const cn=this.getUniformLocations(f,ln)||{};return cn.uStepW=f.getUniformLocation(ln,"uStepW"),cn.uStepH=f.getUniformLocation(ln,"uStepH"),{program:ln,attributeLocations:this.getAttributeLocations(f,ln),uniformLocations:cn}}getAttributeLocations(f,ze){return{aPosition:f.getAttribLocation(ze,"aPosition")}}getUniformLocations(f,ze){const Ke=this.constructor.uniformLocations,Qe={};for(let Pi=0;Pi<Ke.length;Pi++)Qe[Ke[Pi]]=f.getUniformLocation(ze,Ke[Pi]);return Qe}sendAttributeData(f,ze,Ke){const Qe=ze.aPosition,Pi=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,Pi),f.enableVertexAttribArray(Qe),f.vertexAttribPointer(Qe,2,f.FLOAT,!1,0,0),f.bufferData(f.ARRAY_BUFFER,Ke,f.STATIC_DRAW)}_setupFrameBuffer(f){const ze=f.context;if(f.passes>1){const Ke=f.destinationWidth,Qe=f.destinationHeight;f.sourceWidth===Ke&&f.sourceHeight===Qe||(ze.deleteTexture(f.targetTexture),f.targetTexture=f.filterBackend.createTexture(ze,Ke,Qe)),ze.framebufferTexture2D(ze.FRAMEBUFFER,ze.COLOR_ATTACHMENT0,ze.TEXTURE_2D,f.targetTexture,0)}else ze.bindFramebuffer(ze.FRAMEBUFFER,null),ze.finish()}_swapTextures(f){f.passes--,f.pass++;const ze=f.targetTexture;f.targetTexture=f.sourceTexture,f.sourceTexture=ze}isNeutralState(f){return!1}applyTo(f){Da(f)?(this._setupFrameBuffer(f),this.applyToWebGL(f),this._swapTextures(f)):this.applyTo2d(f)}applyTo2d(f){}getCacheKey(){return this.type}retrieveShader(f){const ze=this.getCacheKey();return f.programCache[ze]||(f.programCache[ze]=this.createProgram(f.context)),f.programCache[ze]}applyToWebGL(f){const ze=f.context,Ke=this.retrieveShader(f);f.pass===0&&f.originalTexture?ze.bindTexture(ze.TEXTURE_2D,f.originalTexture):ze.bindTexture(ze.TEXTURE_2D,f.sourceTexture),ze.useProgram(Ke.program),this.sendAttributeData(ze,Ke.attributeLocations,f.aPosition),ze.uniform1f(Ke.uniformLocations.uStepW,1/f.sourceWidth),ze.uniform1f(Ke.uniformLocations.uStepH,1/f.sourceHeight),this.sendUniformData(ze,Ke.uniformLocations),ze.viewport(0,0,f.destinationWidth,f.destinationHeight),ze.drawArrays(ze.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(f,ze,Ke){f.activeTexture(Ke),f.bindTexture(f.TEXTURE_2D,ze),f.activeTexture(f.TEXTURE0)}unbindAdditionalTexture(f,ze){f.activeTexture(ze),f.bindTexture(f.TEXTURE_2D,null),f.activeTexture(f.TEXTURE0)}sendUniformData(f,ze){}createHelpLayer(f){if(!f.helpLayer){const{sourceWidth:ze,sourceHeight:Ke}=f,Qe=vt$1({width:ze,height:Ke});f.helpLayer=Qe}}toObject(){const f=Object.keys(this.constructor.defaults||{});return s({type:this.type},f.reduce((ze,Ke)=>(ze[Ke]=this[Ke],ze),{}))}toJSON(){return this.toObject()}static async fromObject(f,ze){return new this(i(f,ja))}}t(La,"type","BaseFilter"),t(La,"uniformLocations",[]);const Ra={multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,difference:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`
    if (uColor.r < 0.5) {
      gl_FragColor.r *= 2.0 * uColor.r;
    } else {
      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
    }
    if (uColor.g < 0.5) {
      gl_FragColor.g *= 2.0 * uColor.g;
    } else {
      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
    }
    if (uColor.b < 0.5) {
      gl_FragColor.b *= 2.0 * uColor.b;
    } else {
      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
    }
    `,tint:`
    gl_FragColor.rgb *= (1.0 - uColor.a);
    gl_FragColor.rgb += uColor.rgb;
    `};class Ia extends La{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec4 uColor;
      varying vec2 vTexCoord;
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        gl_FragColor = color;
        if (color.a > 0.0) {
          `.concat(Ra[this.mode],`
        }
      }
      `)}applyTo2d(f){let{imageData:{data:ze}}=f;const Ke=new Le$1(this.color).getSource(),Qe=this.alpha,Pi=Ke[0]*Qe,nn=Ke[1]*Qe,ln=Ke[2]*Qe,cn=1-Qe;for(let hn=0;hn<ze.length;hn+=4){const un=ze[hn],zn=ze[hn+1],Xn=ze[hn+2];let Un,qn,ys;switch(this.mode){case"multiply":Un=un*Pi/255,qn=zn*nn/255,ys=Xn*ln/255;break;case"screen":Un=255-(255-un)*(255-Pi)/255,qn=255-(255-zn)*(255-nn)/255,ys=255-(255-Xn)*(255-ln)/255;break;case"add":Un=un+Pi,qn=zn+nn,ys=Xn+ln;break;case"difference":Un=Math.abs(un-Pi),qn=Math.abs(zn-nn),ys=Math.abs(Xn-ln);break;case"subtract":Un=un-Pi,qn=zn-nn,ys=Xn-ln;break;case"darken":Un=Math.min(un,Pi),qn=Math.min(zn,nn),ys=Math.min(Xn,ln);break;case"lighten":Un=Math.max(un,Pi),qn=Math.max(zn,nn),ys=Math.max(Xn,ln);break;case"overlay":Un=Pi<128?2*un*Pi/255:255-2*(255-un)*(255-Pi)/255,qn=nn<128?2*zn*nn/255:255-2*(255-zn)*(255-nn)/255,ys=ln<128?2*Xn*ln/255:255-2*(255-Xn)*(255-ln)/255;break;case"exclusion":Un=Pi+un-2*Pi*un/255,qn=nn+zn-2*nn*zn/255,ys=ln+Xn-2*ln*Xn/255;break;case"tint":Un=Pi+un*cn,qn=nn+zn*cn,ys=ln+Xn*cn}ze[hn]=Un,ze[hn+1]=qn,ze[hn+2]=ys}}sendUniformData(f,ze){const Ke=new Le$1(this.color).getSource();Ke[0]=this.alpha*Ke[0]/255,Ke[1]=this.alpha*Ke[1]/255,Ke[2]=this.alpha*Ke[2]/255,Ke[3]=this.alpha,f.uniform4fv(ze.uColor,Ke)}}t(Ia,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),t(Ia,"type","BlendColor"),t(Ia,"uniformLocations",["uColor"]),tt.setClass(Ia);const Ba={multiply:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.rgba *= color2.rgba;
      gl_FragColor = color;
    }
    `,mask:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.a = color2.a;
      gl_FragColor = color;
    }
    `},Xa=["type","image"];class Ya extends La{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return Ba[this.mode]}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    uniform mat3 uTransformMatrix;
    void main() {
      vTexCoord = aPosition;
      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }
    `}applyToWebGL(f){const ze=f.context,Ke=this.createTexture(f.filterBackend,this.image);this.bindAdditionalTexture(ze,Ke,ze.TEXTURE1),super.applyToWebGL(f),this.unbindAdditionalTexture(ze,ze.TEXTURE1)}createTexture(f,ze){return f.getCachedTexture(ze.cacheKey,ze.getElement())}calculateMatrix(){const f=this.image,{width:ze,height:Ke}=f.getElement();return[1/f.scaleX,0,0,0,1/f.scaleY,0,-f.left/ze,-f.top/Ke,1]}applyTo2d(f){let{imageData:{data:ze,width:Ke,height:Qe},filterBackend:{resources:Pi}}=f;const nn=this.image;Pi.blendImage||(Pi.blendImage=pt$1());const ln=Pi.blendImage,cn=ln.getContext("2d");ln.width!==Ke||ln.height!==Qe?(ln.width=Ke,ln.height=Qe):cn.clearRect(0,0,Ke,Qe),cn.setTransform(nn.scaleX,0,0,nn.scaleY,nn.left,nn.top),cn.drawImage(nn.getElement(),0,0,Ke,Qe);const hn=cn.getImageData(0,0,Ke,Qe).data;for(let un=0;un<ze.length;un+=4){const zn=ze[un],Xn=ze[un+1],Un=ze[un+2],qn=ze[un+3],ys=hn[un],vs=hn[un+1],ea=hn[un+2],na=hn[un+3];switch(this.mode){case"multiply":ze[un]=zn*ys/255,ze[un+1]=Xn*vs/255,ze[un+2]=Un*ea/255,ze[un+3]=qn*na/255;break;case"mask":ze[un+3]=na}}}sendUniformData(f,ze){const Ke=this.calculateMatrix();f.uniform1i(ze.uImage,1),f.uniformMatrix3fv(ze.uTransformMatrix,!1,Ke)}toObject(){return s(s({},super.toObject()),{},{image:this.image&&this.image.toObject()})}static async fromObject(f,ze){let{type:Ke,image:Qe}=f,Pi=i(f,Xa);return $o.fromObject(Qe,ze).then(nn=>new this(s(s({},Pi),{},{image:nn})))}}t(Ya,"type","BlendImage"),t(Ya,"defaults",{mode:"multiply",alpha:1}),t(Ya,"uniformLocations",["uTransformMatrix","uImage"]),tt.setClass(Ya);class Wa extends La{getFragmentSource(){return`
    precision highp float;
    uniform sampler2D uTexture;
    uniform vec2 uDelta;
    varying vec2 vTexCoord;
    const float nSamples = 15.0;
    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
    float random(vec3 scale) {
      /* use the fragment position for a different seed per-pixel */
      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
    }
    void main() {
      vec4 color = vec4(0.0);
      float total = 0.0;
      float offset = random(v3offset);
      for (float t = -nSamples; t <= nSamples; t++) {
        float percent = (t + offset - 0.5) / nSamples;
        float weight = 1.0 - abs(percent);
        color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
        total += weight;
      }
      gl_FragColor = color / total;
    }
  `}applyTo(f){Da(f)?(this.aspectRatio=f.sourceWidth/f.sourceHeight,f.passes++,this._setupFrameBuffer(f),this.horizontal=!0,this.applyToWebGL(f),this._swapTextures(f),this._setupFrameBuffer(f),this.horizontal=!1,this.applyToWebGL(f),this._swapTextures(f)):this.applyTo2d(f)}applyTo2d(f){f.imageData=this.simpleBlur(f)}simpleBlur(f){let{ctx:ze,imageData:Ke,filterBackend:{resources:Qe}}=f;const{width:Pi,height:nn}=Ke;Qe.blurLayer1||(Qe.blurLayer1=pt$1(),Qe.blurLayer2=pt$1());const ln=Qe.blurLayer1,cn=Qe.blurLayer2;ln.width===Pi&&ln.height===nn||(cn.width=ln.width=Pi,cn.height=ln.height=nn);const hn=ln.getContext("2d"),un=cn.getContext("2d"),zn=15,Xn=.06*this.blur*.5;let Un,qn,ys,vs;for(hn.putImageData(Ke,0,0),un.clearRect(0,0,Pi,nn),vs=-15;vs<=zn;vs++)Un=(Math.random()-.5)/4,qn=vs/zn,ys=Xn*qn*Pi+Un,un.globalAlpha=1-Math.abs(qn),un.drawImage(ln,ys,Un),hn.drawImage(cn,0,0),un.globalAlpha=1,un.clearRect(0,0,cn.width,cn.height);for(vs=-15;vs<=zn;vs++)Un=(Math.random()-.5)/4,qn=vs/zn,ys=Xn*qn*nn+Un,un.globalAlpha=1-Math.abs(qn),un.drawImage(ln,Un,ys),hn.drawImage(cn,0,0),un.globalAlpha=1,un.clearRect(0,0,cn.width,cn.height);ze.drawImage(ln,0,0);const ea=ze.getImageData(0,0,ln.width,ln.height);return hn.globalAlpha=1,hn.clearRect(0,0,ln.width,ln.height),ea}sendUniformData(f,ze){const Ke=this.chooseRightDelta();f.uniform2fv(ze.uDelta,Ke)}isNeutralState(){return this.blur===0}chooseRightDelta(){let f=1;const ze=[0,0];this.horizontal?this.aspectRatio>1&&(f=1/this.aspectRatio):this.aspectRatio<1&&(f=this.aspectRatio);const Ke=f*this.blur*.12;return this.horizontal?ze[0]=Ke:ze[1]=Ke,ze}}t(Wa,"type","Blur"),t(Wa,"defaults",{blur:0}),t(Wa,"uniformLocations",["uDelta"]),tt.setClass(Wa);class Va extends La{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBrightness;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += uBrightness;
    gl_FragColor = color;
  }
`}applyTo2d(f){let{imageData:{data:ze}}=f;const Ke=Math.round(255*this.brightness);for(let Qe=0;Qe<ze.length;Qe+=4)ze[Qe]+=Ke,ze[Qe+1]+=Ke,ze[Qe+2]+=Ke}isNeutralState(){return this.brightness===0}sendUniformData(f,ze){f.uniform1f(ze.uBrightness,this.brightness)}}t(Va,"type","Brightness"),t(Va,"defaults",{brightness:0}),t(Va,"uniformLocations",["uBrightness"]),tt.setClass(Va);const za={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],colorsOnly:!0};class Ga extends La{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  varying vec2 vTexCoord;
  uniform mat4 uColorMatrix;
  uniform vec4 uConstants;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color *= uColorMatrix;
    color += uConstants;
    gl_FragColor = color;
  }`}applyTo2d(f){const ze=f.imageData.data,Ke=this.matrix,Qe=this.colorsOnly;for(let Pi=0;Pi<ze.length;Pi+=4){const nn=ze[Pi],ln=ze[Pi+1],cn=ze[Pi+2];if(ze[Pi]=nn*Ke[0]+ln*Ke[1]+cn*Ke[2]+255*Ke[4],ze[Pi+1]=nn*Ke[5]+ln*Ke[6]+cn*Ke[7]+255*Ke[9],ze[Pi+2]=nn*Ke[10]+ln*Ke[11]+cn*Ke[12]+255*Ke[14],!Qe){const hn=ze[Pi+3];ze[Pi]+=hn*Ke[3],ze[Pi+1]+=hn*Ke[8],ze[Pi+2]+=hn*Ke[13],ze[Pi+3]=nn*Ke[15]+ln*Ke[16]+cn*Ke[17]+hn*Ke[18]+255*Ke[19]}}}sendUniformData(f,ze){const Ke=this.matrix,Qe=[Ke[0],Ke[1],Ke[2],Ke[3],Ke[5],Ke[6],Ke[7],Ke[8],Ke[10],Ke[11],Ke[12],Ke[13],Ke[15],Ke[16],Ke[17],Ke[18]],Pi=[Ke[4],Ke[9],Ke[14],Ke[19]];f.uniformMatrix4fv(ze.uColorMatrix,!1,Qe),f.uniform4fv(ze.uConstants,Pi)}toObject(){return s(s({},super.toObject()),{},{matrix:[...this.matrix]})}}function Ha(qe,f){var ze;const Ke=(t(ze=class extends Ga{toObject(){return{type:this.type,colorsOnly:this.colorsOnly}}},"type",qe),t(ze,"defaults",{colorsOnly:!1,matrix:f}),ze);return tt.setClass(Ke,qe),Ke}t(Ga,"type","ColorMatrix"),t(Ga,"defaults",za),t(Ga,"uniformLocations",["uColorMatrix","uConstants"]),tt.setClass(Ga);Ha("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]);Ha("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]);Ha("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]);Ha("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]);Ha("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]);Ha("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]);Ha("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);class $a extends La{constructor(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(f),this.subFilters=f.subFilters||[]}applyTo(f){Da(f)&&(f.passes+=this.subFilters.length-1),this.subFilters.forEach(ze=>{ze.applyTo(f)})}toObject(){return{type:this.type,subFilters:this.subFilters.map(f=>f.toObject())}}isNeutralState(){return!this.subFilters.some(f=>!f.isNeutralState())}static fromObject(f,ze){return Promise.all((f.subFilters||[]).map(Ke=>tt.getClass(Ke.type).fromObject(Ke,ze))).then(Ke=>new this({subFilters:Ke}))}}t($a,"type","Composed"),tt.setClass($a);class th extends La{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uContrast;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
    gl_FragColor = color;
  }`}isNeutralState(){return this.contrast===0}applyTo2d(f){let{imageData:{data:ze}}=f;const Ke=Math.floor(255*this.contrast),Qe=259*(Ke+255)/(255*(259-Ke));for(let Pi=0;Pi<ze.length;Pi+=4)ze[Pi]=Qe*(ze[Pi]-128)+128,ze[Pi+1]=Qe*(ze[Pi+1]-128)+128,ze[Pi+2]=Qe*(ze[Pi+2]-128)+128}sendUniformData(f,ze){f.uniform1f(ze.uContrast,this.contrast)}}t(th,"type","Contrast"),t(th,"defaults",{contrast:0}),t(th,"uniformLocations",["uContrast"]),tt.setClass(th);const eh={Convolute_3_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_3_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_5_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_5_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_7_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_7_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_9_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_9_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `};class sh extends La{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return eh[this.getCacheKey()]}applyTo2d(f){const ze=f.imageData,Ke=ze.data,Qe=this.matrix,Pi=Math.round(Math.sqrt(Qe.length)),nn=Math.floor(Pi/2),ln=ze.width,cn=ze.height,hn=f.ctx.createImageData(ln,cn),un=hn.data,zn=this.opaque?1:0;let Xn,Un,qn,ys,vs,ea,na,ta,ra,oa,fa,ca,la;for(fa=0;fa<cn;fa++)for(oa=0;oa<ln;oa++){for(vs=4*(fa*ln+oa),Xn=0,Un=0,qn=0,ys=0,la=0;la<Pi;la++)for(ca=0;ca<Pi;ca++)na=fa+la-nn,ea=oa+ca-nn,na<0||na>=cn||ea<0||ea>=ln||(ta=4*(na*ln+ea),ra=Qe[la*Pi+ca],Xn+=Ke[ta]*ra,Un+=Ke[ta+1]*ra,qn+=Ke[ta+2]*ra,zn||(ys+=Ke[ta+3]*ra));un[vs]=Xn,un[vs+1]=Un,un[vs+2]=qn,un[vs+3]=zn?Ke[vs+3]:ys}f.imageData=hn}sendUniformData(f,ze){f.uniform1fv(ze.uMatrix,this.matrix)}toObject(){return s(s({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}t(sh,"type","Convolute"),t(sh,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),t(sh,"uniformLocations",["uMatrix","uOpaque","uHalfSize","uSize"]),tt.setClass(sh);const ih="Gamma";class rh extends La{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform vec3 uGamma;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    vec3 correction = (1.0 / uGamma);
    color.r = pow(color.r, correction.r);
    color.g = pow(color.g, correction.g);
    color.b = pow(color.b, correction.b);
    gl_FragColor = color;
    gl_FragColor.rgb *= color.a;
  }
`}constructor(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(f),this.gamma=f.gamma||this.constructor.defaults.gamma.concat()}applyTo2d(f){let{imageData:{data:ze}}=f;const Ke=this.gamma,Qe=1/Ke[0],Pi=1/Ke[1],nn=1/Ke[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});const ln=this.rgbValues;for(let cn=0;cn<256;cn++)ln.r[cn]=255*Math.pow(cn/255,Qe),ln.g[cn]=255*Math.pow(cn/255,Pi),ln.b[cn]=255*Math.pow(cn/255,nn);for(let cn=0;cn<ze.length;cn+=4)ze[cn]=ln.r[ze[cn]],ze[cn+1]=ln.g[ze[cn+1]],ze[cn+2]=ln.b[ze[cn+2]]}sendUniformData(f,ze){f.uniform3fv(ze.uGamma,this.gamma)}isNeutralState(){const{gamma:f}=this;return f[0]===1&&f[1]===1&&f[2]===1}toObject(){return{type:ih,gamma:this.gamma.concat()}}}t(rh,"type",ih),t(rh,"defaults",{gamma:[1,1,1]}),t(rh,"uniformLocations",["uGamma"]),tt.setClass(rh);const nh={average:`
    precision highp float;
    uniform sampler2D uTexture;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      float average = (color.r + color.b + color.g) / 3.0;
      gl_FragColor = vec4(average, average, average, color.a);
    }
    `,lightness:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `,luminosity:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `};class oh extends La{applyTo2d(f){let{imageData:{data:ze}}=f;for(let Ke,Qe=0;Qe<ze.length;Qe+=4){const Pi=ze[Qe],nn=ze[Qe+1],ln=ze[Qe+2];switch(this.mode){case"average":Ke=(Pi+nn+ln)/3;break;case"lightness":Ke=(Math.min(Pi,nn,ln)+Math.max(Pi,nn,ln))/2;break;case"luminosity":Ke=.21*Pi+.72*nn+.07*ln}ze[Qe+2]=ze[Qe+1]=ze[Qe]=Ke}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return nh[this.mode]}sendUniformData(f,ze){f.uniform1i(ze.uMode,1)}isNeutralState(){return!1}}t(oh,"type","Grayscale"),t(oh,"defaults",{mode:"average"}),t(oh,"uniformLocations",["uMode"]),tt.setClass(oh);const ah=s(s({},za),{},{rotation:0});class hh extends Ga{calculateMatrix(){const f=this.rotation*Math.PI,ze=rt$1(f),Ke=nt$1(f),Qe=1/3,Pi=Math.sqrt(Qe)*Ke,nn=1-ze;this.matrix=[ze+nn/3,Qe*nn-Pi,Qe*nn+Pi,0,0,Qe*nn+Pi,ze+Qe*nn,Qe*nn-Pi,0,0,Qe*nn-Pi,Qe*nn+Pi,ze+Qe*nn,0,0,0,0,0,1,0]}isNeutralState(){return this.rotation===0}applyTo(f){this.calculateMatrix(),super.applyTo(f)}toObject(){return{type:this.type,rotation:this.rotation}}}t(hh,"type","HueRotation"),t(hh,"defaults",ah),tt.setClass(hh);class ch extends La{applyTo2d(f){let{imageData:{data:ze}}=f;for(let Ke=0;Ke<ze.length;Ke+=4)ze[Ke]=255-ze[Ke],ze[Ke+1]=255-ze[Ke+1],ze[Ke+2]=255-ze[Ke+2],this.alpha&&(ze[Ke+3]=255-ze[Ke+3])}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform int uInvert;
  uniform int uAlpha;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    if (uInvert == 1) {
      if (uAlpha == 1) {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);
      } else {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
      }
    } else {
      gl_FragColor = color;
    }
  }
`}isNeutralState(){return!this.invert}sendUniformData(f,ze){f.uniform1i(ze.uInvert,Number(this.invert)),f.uniform1i(ze.uAlpha,Number(this.alpha))}}t(ch,"type","Invert"),t(ch,"defaults",{alpha:!1,invert:!0}),t(ch,"uniformLocations",["uInvert","uAlpha"]),tt.setClass(ch);class lh extends La{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uStepH;
  uniform float uNoise;
  uniform float uSeed;
  varying vec2 vTexCoord;
  float rand(vec2 co, float seed, float vScale) {
    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
  }
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
    gl_FragColor = color;
  }
`}applyTo2d(f){let{imageData:{data:ze}}=f;const Ke=this.noise;for(let Qe=0;Qe<ze.length;Qe+=4){const Pi=(.5-Math.random())*Ke;ze[Qe]+=Pi,ze[Qe+1]+=Pi,ze[Qe+2]+=Pi}}sendUniformData(f,ze){f.uniform1f(ze.uNoise,this.noise/255),f.uniform1f(ze.uSeed,Math.random())}isNeutralState(){return this.noise===0}}t(lh,"type","Noise"),t(lh,"defaults",{noise:0}),t(lh,"uniformLocations",["uNoise","uSeed"]),tt.setClass(lh);class uh extends La{applyTo2d(f){let{imageData:{data:ze,width:Ke,height:Qe}}=f;for(let Pi=0;Pi<Qe;Pi+=this.blocksize)for(let nn=0;nn<Ke;nn+=this.blocksize){const ln=4*Pi*Ke+4*nn,cn=ze[ln],hn=ze[ln+1],un=ze[ln+2],zn=ze[ln+3];for(let Xn=Pi;Xn<Math.min(Pi+this.blocksize,Qe);Xn++)for(let Un=nn;Un<Math.min(nn+this.blocksize,Ke);Un++){const qn=4*Xn*Ke+4*Un;ze[qn]=cn,ze[qn+1]=hn,ze[qn+2]=un,ze[qn+3]=zn}}}isNeutralState(){return this.blocksize===1}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBlocksize;
  uniform float uStepW;
  uniform float uStepH;
  varying vec2 vTexCoord;
  void main() {
    float blockW = uBlocksize * uStepW;
    float blockH = uBlocksize * uStepH;
    int posX = int(vTexCoord.x / blockW);
    int posY = int(vTexCoord.y / blockH);
    float fposX = float(posX);
    float fposY = float(posY);
    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
    vec4 color = texture2D(uTexture, squareCoords);
    gl_FragColor = color;
  }
`}sendUniformData(f,ze){f.uniform1f(ze.uBlocksize,this.blocksize)}}t(uh,"type","Pixelate"),t(uh,"defaults",{blocksize:4}),t(uh,"uniformLocations",["uBlocksize"]),tt.setClass(uh);class dh extends La{getFragmentSource(){return`
precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
  gl_FragColor = texture2D(uTexture, vTexCoord);
  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
    gl_FragColor.a = 0.0;
  }
}
`}applyTo2d(f){let{imageData:{data:ze}}=f;const Ke=255*this.distance,Qe=new Le$1(this.color).getSource(),Pi=[Qe[0]-Ke,Qe[1]-Ke,Qe[2]-Ke],nn=[Qe[0]+Ke,Qe[1]+Ke,Qe[2]+Ke];for(let ln=0;ln<ze.length;ln+=4){const cn=ze[ln],hn=ze[ln+1],un=ze[ln+2];cn>Pi[0]&&hn>Pi[1]&&un>Pi[2]&&cn<nn[0]&&hn<nn[1]&&un<nn[2]&&(ze[ln+3]=0)}}sendUniformData(f,ze){const Ke=new Le$1(this.color).getSource(),Qe=this.distance,Pi=[0+Ke[0]/255-Qe,0+Ke[1]/255-Qe,0+Ke[2]/255-Qe,1],nn=[Ke[0]/255+Qe,Ke[1]/255+Qe,Ke[2]/255+Qe,1];f.uniform4fv(ze.uLow,Pi),f.uniform4fv(ze.uHigh,nn)}}t(dh,"type","RemoveColor"),t(dh,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),t(dh,"uniformLocations",["uLow","uHigh"]),tt.setClass(dh);class gh extends La{sendUniformData(f,ze){f.uniform2fv(ze.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),f.uniform1fv(ze.uTaps,this.taps)}getFilterWindow(){const f=this.tempScale;return Math.ceil(this.lanczosLobes/f)}getCacheKey(){const f=this.getFilterWindow();return"".concat(this.type,"_").concat(f)}getFragmentSource(){const f=this.getFilterWindow();return this.generateShader(f)}getTaps(){const f=this.lanczosCreate(this.lanczosLobes),ze=this.tempScale,Ke=this.getFilterWindow(),Qe=new Array(Ke);for(let Pi=1;Pi<=Ke;Pi++)Qe[Pi-1]=f(Pi*ze);return Qe}generateShader(f){const ze=new Array(f);for(let Ke=1;Ke<=f;Ke++)ze[Ke-1]="".concat(Ke,".0 * uDelta");return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec2 uDelta;
      varying vec2 vTexCoord;
      uniform float uTaps[`.concat(f,`];
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        float sum = 1.0;
        `).concat(ze.map((Ke,Qe)=>`
              color += texture2D(uTexture, vTexCoord + `.concat(Ke,") * uTaps[").concat(Qe,"] + texture2D(uTexture, vTexCoord - ").concat(Ke,") * uTaps[").concat(Qe,`];
              sum += 2.0 * uTaps[`).concat(Qe,`];
            `)).join(`
`),`
        gl_FragColor = color / sum;
      }
    `)}applyToForWebgl(f){f.passes++,this.width=f.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=f.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),f.destinationWidth=this.dW,super.applyTo(f),f.sourceWidth=f.destinationWidth,this.height=f.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),f.destinationHeight=this.dH,super.applyTo(f),f.sourceHeight=f.destinationHeight}applyTo(f){Da(f)?this.applyToForWebgl(f):this.applyTo2d(f)}isNeutralState(){return this.scaleX===1&&this.scaleY===1}lanczosCreate(f){return ze=>{if(ze>=f||ze<=-f)return 0;if(ze<11920929e-14&&ze>-11920929e-14)return 1;const Ke=(ze*=Math.PI)/f;return Math.sin(ze)/ze*Math.sin(Ke)/Ke}}applyTo2d(f){const ze=f.imageData,Ke=this.scaleX,Qe=this.scaleY;this.rcpScaleX=1/Ke,this.rcpScaleY=1/Qe;const Pi=ze.width,nn=ze.height,ln=Math.round(Pi*Ke),cn=Math.round(nn*Qe);let hn;hn=this.resizeType==="sliceHack"?this.sliceByTwo(f,Pi,nn,ln,cn):this.resizeType==="hermite"?this.hermiteFastResize(f,Pi,nn,ln,cn):this.resizeType==="bilinear"?this.bilinearFiltering(f,Pi,nn,ln,cn):this.resizeType==="lanczos"?this.lanczosResize(f,Pi,nn,ln,cn):new ImageData(ln,cn),f.imageData=hn}sliceByTwo(f,ze,Ke,Qe,Pi){const nn=f.imageData,ln=.5;let cn=!1,hn=!1,un=ze*ln,zn=Ke*ln;const Xn=f.filterBackend.resources;let Un=0,qn=0;const ys=ze;let vs=0;Xn.sliceByTwo||(Xn.sliceByTwo=pt$1());const ea=Xn.sliceByTwo;(ea.width<1.5*ze||ea.height<Ke)&&(ea.width=1.5*ze,ea.height=Ke);const na=ea.getContext("2d");for(na.clearRect(0,0,1.5*ze,Ke),na.putImageData(nn,0,0),Qe=Math.floor(Qe),Pi=Math.floor(Pi);!cn||!hn;)ze=un,Ke=zn,Qe<Math.floor(un*ln)?un=Math.floor(un*ln):(un=Qe,cn=!0),Pi<Math.floor(zn*ln)?zn=Math.floor(zn*ln):(zn=Pi,hn=!0),na.drawImage(ea,Un,qn,ze,Ke,ys,vs,un,zn),Un=ys,qn=vs,vs+=zn;return na.getImageData(Un,qn,Qe,Pi)}lanczosResize(f,ze,Ke,Qe,Pi){const nn=f.imageData.data,ln=f.ctx.createImageData(Qe,Pi),cn=ln.data,hn=this.lanczosCreate(this.lanczosLobes),un=this.rcpScaleX,zn=this.rcpScaleY,Xn=2/this.rcpScaleX,Un=2/this.rcpScaleY,qn=Math.ceil(un*this.lanczosLobes/2),ys=Math.ceil(zn*this.lanczosLobes/2),vs={},ea={x:0,y:0},na={x:0,y:0};return function ta(ra){let oa,fa,ca,la,ua,ga,da,qa,tl,ol,hl;for(ea.x=(ra+.5)*un,na.x=Math.floor(ea.x),oa=0;oa<Pi;oa++){for(ea.y=(oa+.5)*zn,na.y=Math.floor(ea.y),ua=0,ga=0,da=0,qa=0,tl=0,fa=na.x-qn;fa<=na.x+qn;fa++)if(!(fa<0||fa>=ze)){ol=Math.floor(1e3*Math.abs(fa-ea.x)),vs[ol]||(vs[ol]={});for(let wl=na.y-ys;wl<=na.y+ys;wl++)wl<0||wl>=Ke||(hl=Math.floor(1e3*Math.abs(wl-ea.y)),vs[ol][hl]||(vs[ol][hl]=hn(Math.sqrt(Math.pow(ol*Xn,2)+Math.pow(hl*Un,2))/1e3)),ca=vs[ol][hl],ca>0&&(la=4*(wl*ze+fa),ua+=ca,ga+=ca*nn[la],da+=ca*nn[la+1],qa+=ca*nn[la+2],tl+=ca*nn[la+3]))}la=4*(oa*Qe+ra),cn[la]=ga/ua,cn[la+1]=da/ua,cn[la+2]=qa/ua,cn[la+3]=tl/ua}return++ra<Qe?ta(ra):ln}(0)}bilinearFiltering(f,ze,Ke,Qe,Pi){let nn,ln,cn,hn,un,zn,Xn,Un,qn,ys,vs,ea,na,ta=0;const ra=this.rcpScaleX,oa=this.rcpScaleY,fa=4*(ze-1),ca=f.imageData.data,la=f.ctx.createImageData(Qe,Pi),ua=la.data;for(Xn=0;Xn<Pi;Xn++)for(Un=0;Un<Qe;Un++)for(un=Math.floor(ra*Un),zn=Math.floor(oa*Xn),qn=ra*Un-un,ys=oa*Xn-zn,na=4*(zn*ze+un),vs=0;vs<4;vs++)nn=ca[na+vs],ln=ca[na+4+vs],cn=ca[na+fa+vs],hn=ca[na+fa+4+vs],ea=nn*(1-qn)*(1-ys)+ln*qn*(1-ys)+cn*ys*(1-qn)+hn*qn*ys,ua[ta++]=ea;return la}hermiteFastResize(f,ze,Ke,Qe,Pi){const nn=this.rcpScaleX,ln=this.rcpScaleY,cn=Math.ceil(nn/2),hn=Math.ceil(ln/2),un=f.imageData.data,zn=f.ctx.createImageData(Qe,Pi),Xn=zn.data;for(let Un=0;Un<Pi;Un++)for(let qn=0;qn<Qe;qn++){const ys=4*(qn+Un*Qe);let vs=0,ea=0,na=0,ta=0,ra=0,oa=0,fa=0;const ca=(Un+.5)*ln;for(let la=Math.floor(Un*ln);la<(Un+1)*ln;la++){const ua=Math.abs(ca-(la+.5))/hn,ga=(qn+.5)*nn,da=ua*ua;for(let qa=Math.floor(qn*nn);qa<(qn+1)*nn;qa++){let tl=Math.abs(ga-(qa+.5))/cn;const ol=Math.sqrt(da+tl*tl);ol>1&&ol<-1||(vs=2*ol*ol*ol-3*ol*ol+1,vs>0&&(tl=4*(qa+la*ze),fa+=vs*un[tl+3],na+=vs,un[tl+3]<255&&(vs=vs*un[tl+3]/250),ta+=vs*un[tl],ra+=vs*un[tl+1],oa+=vs*un[tl+2],ea+=vs))}}Xn[ys]=ta/ea,Xn[ys+1]=ra/ea,Xn[ys+2]=oa/ea,Xn[ys+3]=fa/na}return zn}}t(gh,"type","Resize"),t(gh,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3}),t(gh,"uniformLocations",["uDelta","uTaps"]),tt.setClass(gh);class fh extends La{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uSaturation;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float rgMax = max(color.r, color.g);
    float rgbMax = max(rgMax, color.b);
    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(f){let{imageData:{data:ze}}=f;const Ke=-this.saturation;for(let Qe=0;Qe<ze.length;Qe+=4){const Pi=ze[Qe],nn=ze[Qe+1],ln=ze[Qe+2],cn=Math.max(Pi,nn,ln);ze[Qe]+=cn!==Pi?(cn-Pi)*Ke:0,ze[Qe+1]+=cn!==nn?(cn-nn)*Ke:0,ze[Qe+2]+=cn!==ln?(cn-ln)*Ke:0}}sendUniformData(f,ze){f.uniform1f(ze.uSaturation,-this.saturation)}isNeutralState(){return this.saturation===0}}t(fh,"type","Saturation"),t(fh,"defaults",{saturation:0}),t(fh,"uniformLocations",["uSaturation"]),tt.setClass(fh);class ph extends La{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uVibrance;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float max = max(color.r, max(color.g, color.b));
    float avg = (color.r + color.g + color.b) / 3.0;
    float amt = (abs(max - avg) * 2.0) * uVibrance;
    color.r += max != color.r ? (max - color.r) * amt : 0.00;
    color.g += max != color.g ? (max - color.g) * amt : 0.00;
    color.b += max != color.b ? (max - color.b) * amt : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(f){let{imageData:{data:ze}}=f;const Ke=-this.vibrance;for(let Qe=0;Qe<ze.length;Qe+=4){const Pi=ze[Qe],nn=ze[Qe+1],ln=ze[Qe+2],cn=Math.max(Pi,nn,ln),hn=(Pi+nn+ln)/3,un=2*Math.abs(cn-hn)/255*Ke;ze[Qe]+=cn!==Pi?(cn-Pi)*un:0,ze[Qe+1]+=cn!==nn?(cn-nn)*un:0,ze[Qe+2]+=cn!==ln?(cn-ln)*un:0}}sendUniformData(f,ze){f.uniform1f(ze.uVibrance,-this.vibrance)}isNeutralState(){return this.vibrance===0}}t(ph,"type","Vibrance"),t(ph,"defaults",{vibrance:0}),t(ph,"uniformLocations",["uVibrance"]),tt.setClass(ph);const makeVDialogTransitionProps=propsFactory({target:[Object,Array]},"v-dialog-transition"),saved=new WeakMap,VDialogTransition=genericComponent()({name:"VDialogTransition",props:makeVDialogTransitionProps(),setup(qe,f){let{slots:ze}=f;const Ke={onBeforeEnter(Qe){Qe.style.pointerEvents="none",Qe.style.visibility="hidden"},async onEnter(Qe,Pi){var Un;await new Promise(qn=>requestAnimationFrame(qn)),await new Promise(qn=>requestAnimationFrame(qn)),Qe.style.visibility="";const nn=getDimensions(qe.target,Qe),{x:ln,y:cn,sx:hn,sy:un,speed:zn}=nn;saved.set(Qe,nn);const Xn=animate(Qe,[{transform:`translate(${ln}px, ${cn}px) scale(${hn}, ${un})`,opacity:0},{}],{duration:225*zn,easing:deceleratedEasing});(Un=getChildren(Qe))==null||Un.forEach(qn=>{animate(qn,[{opacity:0},{opacity:0,offset:.33},{}],{duration:225*2*zn,easing:standardEasing})}),Xn.finished.then(()=>Pi())},onAfterEnter(Qe){Qe.style.removeProperty("pointer-events")},onBeforeLeave(Qe){Qe.style.pointerEvents="none"},async onLeave(Qe,Pi){var Un;await new Promise(qn=>requestAnimationFrame(qn));let nn;!saved.has(Qe)||Array.isArray(qe.target)||qe.target.offsetParent||qe.target.getClientRects().length?nn=getDimensions(qe.target,Qe):nn=saved.get(Qe);const{x:ln,y:cn,sx:hn,sy:un,speed:zn}=nn;animate(Qe,[{},{transform:`translate(${ln}px, ${cn}px) scale(${hn}, ${un})`,opacity:0}],{duration:125*zn,easing:acceleratedEasing}).finished.then(()=>Pi()),(Un=getChildren(Qe))==null||Un.forEach(qn=>{animate(qn,[{},{opacity:0,offset:.2},{opacity:0}],{duration:125*2*zn,easing:standardEasing})})},onAfterLeave(Qe){Qe.style.removeProperty("pointer-events")}};return()=>qe.target?createVNode(Transition,mergeProps({name:"dialog-transition"},Ke,{css:!1}),ze):createVNode(Transition,{name:"dialog-transition"},ze)}});function getChildren(qe){var ze;const f=(ze=qe.querySelector(":scope > .v-card, :scope > .v-sheet, :scope > .v-list"))==null?void 0:ze.children;return f&&[...f]}function getDimensions(qe,f){const ze=getTargetBox(qe),Ke=nullifyTransforms(f),[Qe,Pi]=getComputedStyle(f).transformOrigin.split(" ").map(ea=>parseFloat(ea)),[nn,ln]=getComputedStyle(f).getPropertyValue("--v-overlay-anchor-origin").split(" ");let cn=ze.left+ze.width/2;nn==="left"||ln==="left"?cn-=ze.width/2:(nn==="right"||ln==="right")&&(cn+=ze.width/2);let hn=ze.top+ze.height/2;nn==="top"||ln==="top"?hn-=ze.height/2:(nn==="bottom"||ln==="bottom")&&(hn+=ze.height/2);const un=ze.width/Ke.width,zn=ze.height/Ke.height,Xn=Math.max(1,un,zn),Un=un/Xn||0,qn=zn/Xn||0,ys=Ke.width*Ke.height/(window.innerWidth*window.innerHeight),vs=ys>.12?Math.min(1.5,(ys-.12)*10+1):1;return{x:cn-(Qe+Ke.left),y:hn-(Pi+Ke.top),sx:Un,sy:qn,speed:vs}}/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var XLSX={};XLSX.version="0.20.3";var current_codepage=1200,set_cp=function(qe){current_codepage=qe};function reset_cp(){set_cp(1200)}var _getchar=function(f){return String.fromCharCode(f)},_getansi=function(f){return String.fromCharCode(f)},Base64_map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Base64_encode(qe){for(var f="",ze=0,Ke=0,Qe=0,Pi=0,nn=0,ln=0,cn=0,hn=0;hn<qe.length;)ze=qe.charCodeAt(hn++),Pi=ze>>2,Ke=qe.charCodeAt(hn++),nn=(ze&3)<<4|Ke>>4,Qe=qe.charCodeAt(hn++),ln=(Ke&15)<<2|Qe>>6,cn=Qe&63,isNaN(Ke)?ln=cn=64:isNaN(Qe)&&(cn=64),f+=Base64_map.charAt(Pi)+Base64_map.charAt(nn)+Base64_map.charAt(ln)+Base64_map.charAt(cn);return f}function Base64_encode_pass(qe){for(var f="",ze=0,Ke=0,Qe=0,Pi=0,nn=0,ln=0,cn=0,hn=0;hn<qe.length;)ze=qe.charCodeAt(hn++),ze>255&&(ze=95),Pi=ze>>2,Ke=qe.charCodeAt(hn++),Ke>255&&(Ke=95),nn=(ze&3)<<4|Ke>>4,Qe=qe.charCodeAt(hn++),Qe>255&&(Qe=95),ln=(Ke&15)<<2|Qe>>6,cn=Qe&63,isNaN(Ke)?ln=cn=64:isNaN(Qe)&&(cn=64),f+=Base64_map.charAt(Pi)+Base64_map.charAt(nn)+Base64_map.charAt(ln)+Base64_map.charAt(cn);return f}function Base64_encode_arr(qe){for(var f="",ze=0,Ke=0,Qe=0,Pi=0,nn=0,ln=0,cn=0,hn=0;hn<qe.length;)ze=qe[hn++],Pi=ze>>2,Ke=qe[hn++],nn=(ze&3)<<4|Ke>>4,Qe=qe[hn++],ln=(Ke&15)<<2|Qe>>6,cn=Qe&63,isNaN(Ke)?ln=cn=64:isNaN(Qe)&&(cn=64),f+=Base64_map.charAt(Pi)+Base64_map.charAt(nn)+Base64_map.charAt(ln)+Base64_map.charAt(cn);return f}function Base64_decode(qe){var f="",ze=0,Ke=0,Qe=0,Pi=0,nn=0,ln=0,cn=0;if(qe.slice(0,5)=="data:"){var hn=qe.slice(0,1024).indexOf(";base64,");hn>-1&&(qe=qe.slice(hn+8))}qe=qe.replace(/[^\w\+\/\=]/g,"");for(var hn=0;hn<qe.length;)Pi=Base64_map.indexOf(qe.charAt(hn++)),nn=Base64_map.indexOf(qe.charAt(hn++)),ze=Pi<<2|nn>>4,f+=String.fromCharCode(ze),ln=Base64_map.indexOf(qe.charAt(hn++)),Ke=(nn&15)<<4|ln>>2,ln!==64&&(f+=String.fromCharCode(Ke)),cn=Base64_map.indexOf(qe.charAt(hn++)),Qe=(ln&3)<<6|cn,cn!==64&&(f+=String.fromCharCode(Qe));return f}var has_buf=function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node}(),Buffer_from=function(){if(typeof Buffer<"u"){var qe=!Buffer.from;if(!qe)try{Buffer.from("foo","utf8")}catch{qe=!0}return qe?function(f,ze){return ze?new Buffer(f,ze):new Buffer(f)}:Buffer.from.bind(Buffer)}return function(){}}(),buf_utf16le=function(){if(typeof Buffer>"u")return!1;var qe=Buffer_from([65,0]);if(!qe)return!1;var f=qe.toString("utf16le");return f.length==1}();function new_raw_buf(qe){return has_buf?Buffer.alloc?Buffer.alloc(qe):new Buffer(qe):typeof Uint8Array<"u"?new Uint8Array(qe):new Array(qe)}function new_unsafe_buf(qe){return has_buf?Buffer.allocUnsafe?Buffer.allocUnsafe(qe):new Buffer(qe):typeof Uint8Array<"u"?new Uint8Array(qe):new Array(qe)}var s2a=function(f){return has_buf?Buffer_from(f,"binary"):f.split("").map(function(ze){return ze.charCodeAt(0)&255})};function s2ab(qe){if(typeof ArrayBuffer>"u")return s2a(qe);for(var f=new ArrayBuffer(qe.length),ze=new Uint8Array(f),Ke=0;Ke!=qe.length;++Ke)ze[Ke]=qe.charCodeAt(Ke)&255;return f}function a2s(qe){if(Array.isArray(qe))return qe.map(function(Ke){return String.fromCharCode(Ke)}).join("");for(var f=[],ze=0;ze<qe.length;++ze)f[ze]=String.fromCharCode(qe[ze]);return f.join("")}function a2u(qe){if(typeof Uint8Array>"u")throw new Error("Unsupported");return new Uint8Array(qe)}var bconcat=has_buf?function(qe){return Buffer.concat(qe.map(function(f){return Buffer.isBuffer(f)?f:Buffer_from(f)}))}:function(qe){if(typeof Uint8Array<"u"){var f=0,ze=0;for(f=0;f<qe.length;++f)ze+=qe[f].length;var Ke=new Uint8Array(ze),Qe=0;for(f=0,ze=0;f<qe.length;ze+=Qe,++f)Qe=qe[f].length,qe[f]instanceof Uint8Array?Ke.set(qe[f],ze):typeof qe[f]=="string"?Ke.set(new Uint8Array(s2a(qe[f])),ze):Ke.set(new Uint8Array(qe[f]),ze);return Ke}return[].concat.apply([],qe.map(function(Pi){return Array.isArray(Pi)?Pi:[].slice.call(Pi)}))};function utf8decode(qe){for(var f=[],ze=0,Ke=qe.length+250,Qe=new_raw_buf(qe.length+255),Pi=0;Pi<qe.length;++Pi){var nn=qe.charCodeAt(Pi);if(nn<128)Qe[ze++]=nn;else if(nn<2048)Qe[ze++]=192|nn>>6&31,Qe[ze++]=128|nn&63;else if(nn>=55296&&nn<57344){nn=(nn&1023)+64;var ln=qe.charCodeAt(++Pi)&1023;Qe[ze++]=240|nn>>8&7,Qe[ze++]=128|nn>>2&63,Qe[ze++]=128|ln>>6&15|(nn&3)<<4,Qe[ze++]=128|ln&63}else Qe[ze++]=224|nn>>12&15,Qe[ze++]=128|nn>>6&63,Qe[ze++]=128|nn&63;ze>Ke&&(f.push(Qe.slice(0,ze)),ze=0,Qe=new_raw_buf(65535),Ke=65530)}return f.push(Qe.slice(0,ze)),bconcat(f)}var chr0=/\u0000/g,chr1=/[\u0001-\u0006]/g;function _strrev(qe){for(var f="",ze=qe.length-1;ze>=0;)f+=qe.charAt(ze--);return f}function pad0(qe,f){var ze=""+qe;return ze.length>=f?ze:fill$1("0",f-ze.length)+ze}function pad_(qe,f){var ze=""+qe;return ze.length>=f?ze:fill$1(" ",f-ze.length)+ze}function rpad_(qe,f){var ze=""+qe;return ze.length>=f?ze:ze+fill$1(" ",f-ze.length)}function pad0r1(qe,f){var ze=""+Math.round(qe);return ze.length>=f?ze:fill$1("0",f-ze.length)+ze}function pad0r2(qe,f){var ze=""+qe;return ze.length>=f?ze:fill$1("0",f-ze.length)+ze}var p2_32=Math.pow(2,32);function pad0r(qe,f){if(qe>p2_32||qe<-p2_32)return pad0r1(qe,f);var ze=Math.round(qe);return pad0r2(ze,f)}function SSF_isgeneral(qe,f){return f=f||0,qe.length>=7+f&&(qe.charCodeAt(f)|32)===103&&(qe.charCodeAt(f+1)|32)===101&&(qe.charCodeAt(f+2)|32)===110&&(qe.charCodeAt(f+3)|32)===101&&(qe.charCodeAt(f+4)|32)===114&&(qe.charCodeAt(f+5)|32)===97&&(qe.charCodeAt(f+6)|32)===108}var days=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],months=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function SSF_init_table(qe){return qe||(qe={}),qe[0]="General",qe[1]="0",qe[2]="0.00",qe[3]="#,##0",qe[4]="#,##0.00",qe[9]="0%",qe[10]="0.00%",qe[11]="0.00E+00",qe[12]="# ?/?",qe[13]="# ??/??",qe[14]="m/d/yy",qe[15]="d-mmm-yy",qe[16]="d-mmm",qe[17]="mmm-yy",qe[18]="h:mm AM/PM",qe[19]="h:mm:ss AM/PM",qe[20]="h:mm",qe[21]="h:mm:ss",qe[22]="m/d/yy h:mm",qe[37]="#,##0 ;(#,##0)",qe[38]="#,##0 ;[Red](#,##0)",qe[39]="#,##0.00;(#,##0.00)",qe[40]="#,##0.00;[Red](#,##0.00)",qe[45]="mm:ss",qe[46]="[h]:mm:ss",qe[47]="mmss.0",qe[48]="##0.0E+0",qe[49]="@",qe[56]='"/ "hh""mm""ss" "',qe}var table_fmt={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"/ "hh""mm""ss" "'},SSF_default_map={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},SSF_default_str={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function SSF_frac(qe,f,ze){for(var Ke=qe<0?-1:1,Qe=qe*Ke,Pi=0,nn=1,ln=0,cn=1,hn=0,un=0,zn=Math.floor(Qe);hn<f&&(zn=Math.floor(Qe),ln=zn*nn+Pi,un=zn*hn+cn,!(Qe-zn<5e-8));)Qe=1/(Qe-zn),Pi=nn,nn=ln,cn=hn,hn=un;if(un>f&&(hn>f?(un=cn,ln=Pi):(un=hn,ln=nn)),!ze)return[0,Ke*ln,un];var Xn=Math.floor(Ke*ln/un);return[Xn,Ke*ln-Xn*un,un]}function SSF_normalize_xl_unsafe(qe){var f=qe.toPrecision(16);if(f.indexOf("e")>-1){var ze=f.slice(0,f.indexOf("e"));return ze=ze.indexOf(".")>-1?ze.slice(0,ze.slice(0,2)=="0."?17:16):ze.slice(0,15)+fill$1("0",ze.length-15),ze+f.slice(f.indexOf("e"))}var Ke=f.indexOf(".")>-1?f.slice(0,f.slice(0,2)=="0."?17:16):f.slice(0,15)+fill$1("0",f.length-15);return Number(Ke)}function SSF_parse_date_code(qe,f,ze){if(qe>2958465||qe<0)return null;qe=SSF_normalize_xl_unsafe(qe);var Ke=qe|0,Qe=Math.floor(86400*(qe-Ke)),Pi=0,nn=[],ln={D:Ke,T:Qe,u:86400*(qe-Ke)-Qe,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(ln.u)<1e-6&&(ln.u=0),f&&f.date1904&&(Ke+=1462),ln.u>.9999&&(ln.u=0,++Qe==86400&&(ln.T=Qe=0,++Ke,++ln.D)),Ke===60)nn=ze?[1317,10,29]:[1900,2,29],Pi=3;else if(Ke===0)nn=ze?[1317,8,29]:[1900,1,0],Pi=6;else{Ke>60&&--Ke;var cn=new Date(1900,0,1);cn.setDate(cn.getDate()+Ke-1),nn=[cn.getFullYear(),cn.getMonth()+1,cn.getDate()],Pi=cn.getDay(),Ke<60&&(Pi=(Pi+6)%7),ze&&(Pi=SSF_fix_hijri(cn,nn))}return ln.y=nn[0],ln.m=nn[1],ln.d=nn[2],ln.S=Qe%60,Qe=Math.floor(Qe/60),ln.M=Qe%60,Qe=Math.floor(Qe/60),ln.H=Qe,ln.q=Pi,ln}function SSF_strip_decimal(qe){return qe.indexOf(".")==-1?qe:qe.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function SSF_normalize_exp(qe){return qe.indexOf("E")==-1?qe:qe.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function SSF_small_exp(qe){var f=qe<0?12:11,ze=SSF_strip_decimal(qe.toFixed(12));return ze.length<=f||(ze=qe.toPrecision(10),ze.length<=f)?ze:qe.toExponential(5)}function SSF_large_exp(qe){var f=SSF_strip_decimal(qe.toFixed(11));return f.length>(qe<0?12:11)||f==="0"||f==="-0"?qe.toPrecision(6):f}function SSF_general_num(qe){if(!isFinite(qe))return isNaN(qe)?"#NUM!":"#DIV/0!";var f=Math.floor(Math.log(Math.abs(qe))*Math.LOG10E),ze;return f>=-4&&f<=-1?ze=qe.toPrecision(10+f):Math.abs(f)<=9?ze=SSF_small_exp(qe):f===10?ze=qe.toFixed(10).substr(0,12):ze=SSF_large_exp(qe),SSF_strip_decimal(SSF_normalize_exp(ze.toUpperCase()))}function SSF_general(qe,f){switch(typeof qe){case"string":return qe;case"boolean":return qe?"TRUE":"FALSE";case"number":return(qe|0)===qe?qe.toString(10):SSF_general_num(qe);case"undefined":return"";case"object":if(qe==null)return"";if(qe instanceof Date)return SSF_format(14,datenum(qe,f&&f.date1904),f)}throw new Error("unsupported value in General format: "+qe)}function SSF_fix_hijri(qe,f){f[0]-=581;var ze=qe.getDay();return qe<60&&(ze=(ze+6)%7),ze}function SSF_write_date(qe,f,ze,Ke){var Qe="",Pi=0,nn=0,ln=ze.y,cn,hn=0;switch(qe){case 98:ln=ze.y+543;case 121:switch(f.length){case 1:case 2:cn=ln%100,hn=2;break;default:cn=ln%1e4,hn=4;break}break;case 109:switch(f.length){case 1:case 2:cn=ze.m,hn=f.length;break;case 3:return months[ze.m-1][1];case 5:return months[ze.m-1][0];default:return months[ze.m-1][2]}break;case 100:switch(f.length){case 1:case 2:cn=ze.d,hn=f.length;break;case 3:return days[ze.q][0];default:return days[ze.q][1]}break;case 104:switch(f.length){case 1:case 2:cn=1+(ze.H+11)%12,hn=f.length;break;default:throw"bad hour format: "+f}break;case 72:switch(f.length){case 1:case 2:cn=ze.H,hn=f.length;break;default:throw"bad hour format: "+f}break;case 77:switch(f.length){case 1:case 2:cn=ze.M,hn=f.length;break;default:throw"bad minute format: "+f}break;case 115:if(f!="s"&&f!="ss"&&f!=".0"&&f!=".00"&&f!=".000")throw"bad second format: "+f;return ze.u===0&&(f=="s"||f=="ss")?pad0(ze.S,f.length):(Ke>=2?nn=Ke===3?1e3:100:nn=Ke===1?10:1,Pi=Math.round(nn*(ze.S+ze.u)),Pi>=60*nn&&(Pi=0),f==="s"?Pi===0?"0":""+Pi/nn:(Qe=pad0(Pi,2+Ke),f==="ss"?Qe.substr(0,2):"."+Qe.substr(2,f.length-1)));case 90:switch(f){case"[h]":case"[hh]":cn=ze.D*24+ze.H;break;case"[m]":case"[mm]":cn=(ze.D*24+ze.H)*60+ze.M;break;case"[s]":case"[ss]":cn=((ze.D*24+ze.H)*60+ze.M)*60+(Ke==0?Math.round(ze.S+ze.u):ze.S);break;default:throw"bad abstime format: "+f}hn=f.length===3?1:2;break;case 101:cn=ln,hn=1;break}var un=hn>0?pad0(cn,hn):"";return un}function commaify(qe){var f=3;if(qe.length<=f)return qe;for(var ze=qe.length%f,Ke=qe.substr(0,ze);ze!=qe.length;ze+=f)Ke+=(Ke.length>0?",":"")+qe.substr(ze,f);return Ke}var pct1=/%/g;function write_num_pct(qe,f,ze){var Ke=f.replace(pct1,""),Qe=f.length-Ke.length;return write_num(qe,Ke,ze*Math.pow(10,2*Qe))+fill$1("%",Qe)}function write_num_cm(qe,f,ze){for(var Ke=f.length-1;f.charCodeAt(Ke-1)===44;)--Ke;return write_num(qe,f.substr(0,Ke),ze/Math.pow(10,3*(f.length-Ke)))}function write_num_exp(qe,f){var ze,Ke=qe.indexOf("E")-qe.indexOf(".")-1;if(qe.match(/^#+0.0E\+0$/)){if(f==0)return"0.0E+0";if(f<0)return"-"+write_num_exp(qe,-f);var Qe=qe.indexOf(".");Qe===-1&&(Qe=qe.indexOf("E"));var Pi=Math.floor(Math.log(f)*Math.LOG10E)%Qe;if(Pi<0&&(Pi+=Qe),ze=(f/Math.pow(10,Pi)).toPrecision(Ke+1+(Qe+Pi)%Qe),ze.indexOf("e")===-1){var nn=Math.floor(Math.log(f)*Math.LOG10E);for(ze.indexOf(".")===-1?ze=ze.charAt(0)+"."+ze.substr(1)+"E+"+(nn-ze.length+Pi):ze+="E+"+(nn-Pi);ze.substr(0,2)==="0.";)ze=ze.charAt(0)+ze.substr(2,Qe)+"."+ze.substr(2+Qe),ze=ze.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");ze=ze.replace(/\+-/,"-")}ze=ze.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(ln,cn,hn,un){return cn+hn+un.substr(0,(Qe+Pi)%Qe)+"."+un.substr(Pi)+"E"})}else ze=f.toExponential(Ke);return qe.match(/E\+00$/)&&ze.match(/e[+-]\d$/)&&(ze=ze.substr(0,ze.length-1)+"0"+ze.charAt(ze.length-1)),qe.match(/E\-/)&&ze.match(/e\+/)&&(ze=ze.replace(/e\+/,"e")),ze.replace("e","E")}var frac1=/# (\?+)( ?)\/( ?)(\d+)/;function write_num_f1(qe,f,ze){var Ke=parseInt(qe[4],10),Qe=Math.round(f*Ke),Pi=Math.floor(Qe/Ke),nn=Qe-Pi*Ke,ln=Ke;return ze+(Pi===0?"":""+Pi)+" "+(nn===0?fill$1(" ",qe[1].length+1+qe[4].length):pad_(nn,qe[1].length)+qe[2]+"/"+qe[3]+pad0(ln,qe[4].length))}function write_num_f2(qe,f,ze){return ze+(f===0?"":""+f)+fill$1(" ",qe[1].length+2+qe[4].length)}var dec1=/^#*0*\.([0#]+)/,closeparen=/\)[^)]*[0#]/,phone=/\(###\) ###\\?-####/;function hashq(qe){for(var f="",ze,Ke=0;Ke!=qe.length;++Ke)switch(ze=qe.charCodeAt(Ke)){case 35:break;case 63:f+=" ";break;case 48:f+="0";break;default:f+=String.fromCharCode(ze)}return f}function rnd(qe,f){var ze=Math.pow(10,f);return""+Math.round(qe*ze)/ze}function dec(qe,f){var ze=qe-Math.floor(qe),Ke=Math.pow(10,f);return f<(""+Math.round(ze*Ke)).length?0:Math.round(ze*Ke)}function carry(qe,f){return f<(""+Math.round((qe-Math.floor(qe))*Math.pow(10,f))).length?1:0}function flr(qe){return qe<2147483647&&qe>-2147483648?""+(qe>=0?qe|0:qe-1|0):""+Math.floor(qe)}function write_num_flt(qe,f,ze){if(qe.charCodeAt(0)===40&&!f.match(closeparen)){var Ke=f.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return ze>=0?write_num_flt("n",Ke,ze):"("+write_num_flt("n",Ke,-ze)+")"}if(f.charCodeAt(f.length-1)===44)return write_num_cm(qe,f,ze);if(f.indexOf("%")!==-1)return write_num_pct(qe,f,ze);if(f.indexOf("E")!==-1)return write_num_exp(f,ze);if(f.charCodeAt(0)===36)return"$"+write_num_flt(qe,f.substr(f.charAt(1)==" "?2:1),ze);var Qe,Pi,nn,ln,cn=Math.abs(ze),hn=ze<0?"-":"";if(f.match(/^00+$/))return hn+pad0r(cn,f.length);if(f.match(/^[#?]+$/))return Qe=pad0r(ze,0),Qe==="0"&&(Qe=""),Qe.length>f.length?Qe:hashq(f.substr(0,f.length-Qe.length))+Qe;if(Pi=f.match(frac1))return write_num_f1(Pi,cn,hn);if(f.match(/^#+0+$/))return hn+pad0r(cn,f.length-f.indexOf("0"));if(Pi=f.match(dec1))return Qe=rnd(ze,Pi[1].length).replace(/^([^\.]+)$/,"$1."+hashq(Pi[1])).replace(/\.$/,"."+hashq(Pi[1])).replace(/\.(\d*)$/,function(qn,ys){return"."+ys+fill$1("0",hashq(Pi[1]).length-ys.length)}),f.indexOf("0.")!==-1?Qe:Qe.replace(/^0\./,".");if(f=f.replace(/^#+([0.])/,"$1"),Pi=f.match(/^(0*)\.(#*)$/))return hn+rnd(cn,Pi[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,Pi[1].length?"0.":".");if(Pi=f.match(/^#{1,3},##0(\.?)$/))return hn+commaify(pad0r(cn,0));if(Pi=f.match(/^#,##0\.([#0]*0)$/))return ze<0?"-"+write_num_flt(qe,f,-ze):commaify(""+(Math.floor(ze)+carry(ze,Pi[1].length)))+"."+pad0(dec(ze,Pi[1].length),Pi[1].length);if(Pi=f.match(/^#,#*,#0/))return write_num_flt(qe,f.replace(/^#,#*,/,""),ze);if(Pi=f.match(/^([0#]+)(\\?-([0#]+))+$/))return Qe=_strrev(write_num_flt(qe,f.replace(/[\\-]/g,""),ze)),nn=0,_strrev(_strrev(f.replace(/\\/g,"")).replace(/[0#]/g,function(qn){return nn<Qe.length?Qe.charAt(nn++):qn==="0"?"0":""}));if(f.match(phone))return Qe=write_num_flt(qe,"##########",ze),"("+Qe.substr(0,3)+") "+Qe.substr(3,3)+"-"+Qe.substr(6);var un="";if(Pi=f.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return nn=Math.min(Pi[4].length,7),ln=SSF_frac(cn,Math.pow(10,nn)-1,!1),Qe=""+hn,un=write_num("n",Pi[1],ln[1]),un.charAt(un.length-1)==" "&&(un=un.substr(0,un.length-1)+"0"),Qe+=un+Pi[2]+"/"+Pi[3],un=rpad_(ln[2],nn),un.length<Pi[4].length&&(un=hashq(Pi[4].substr(Pi[4].length-un.length))+un),Qe+=un,Qe;if(Pi=f.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return nn=Math.min(Math.max(Pi[1].length,Pi[4].length),7),ln=SSF_frac(cn,Math.pow(10,nn)-1,!0),hn+(ln[0]||(ln[1]?"":"0"))+" "+(ln[1]?pad_(ln[1],nn)+Pi[2]+"/"+Pi[3]+rpad_(ln[2],nn):fill$1(" ",2*nn+1+Pi[2].length+Pi[3].length));if(Pi=f.match(/^[#0?]+$/))return Qe=pad0r(ze,0),f.length<=Qe.length?Qe:hashq(f.substr(0,f.length-Qe.length))+Qe;if(Pi=f.match(/^([#0?]+)\.([#0]+)$/)){Qe=""+ze.toFixed(Math.min(Pi[2].length,10)).replace(/([^0])0+$/,"$1"),nn=Qe.indexOf(".");var zn=f.indexOf(".")-nn,Xn=f.length-Qe.length-zn;return hashq(f.substr(0,zn)+Qe+f.substr(f.length-Xn))}if(Pi=f.match(/^00,000\.([#0]*0)$/))return nn=dec(ze,Pi[1].length),ze<0?"-"+write_num_flt(qe,f,-ze):commaify(flr(ze)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(qn){return"00,"+(qn.length<3?pad0(0,3-qn.length):"")+qn})+"."+pad0(nn,Pi[1].length);switch(f){case"###,##0.00":return write_num_flt(qe,"#,##0.00",ze);case"###,###":case"##,###":case"#,###":var Un=commaify(pad0r(cn,0));return Un!=="0"?hn+Un:"";case"###,###.00":return write_num_flt(qe,"###,##0.00",ze).replace(/^0\./,".");case"#,###.00":return write_num_flt(qe,"#,##0.00",ze).replace(/^0\./,".")}throw new Error("unsupported format |"+f+"|")}function write_num_cm2(qe,f,ze){for(var Ke=f.length-1;f.charCodeAt(Ke-1)===44;)--Ke;return write_num(qe,f.substr(0,Ke),ze/Math.pow(10,3*(f.length-Ke)))}function write_num_pct2(qe,f,ze){var Ke=f.replace(pct1,""),Qe=f.length-Ke.length;return write_num(qe,Ke,ze*Math.pow(10,2*Qe))+fill$1("%",Qe)}function write_num_exp2(qe,f){var ze,Ke=qe.indexOf("E")-qe.indexOf(".")-1;if(qe.match(/^#+0.0E\+0$/)){if(f==0)return"0.0E+0";if(f<0)return"-"+write_num_exp2(qe,-f);var Qe=qe.indexOf(".");Qe===-1&&(Qe=qe.indexOf("E"));var Pi=Math.floor(Math.log(f)*Math.LOG10E)%Qe;if(Pi<0&&(Pi+=Qe),ze=(f/Math.pow(10,Pi)).toPrecision(Ke+1+(Qe+Pi)%Qe),!ze.match(/[Ee]/)){var nn=Math.floor(Math.log(f)*Math.LOG10E);ze.indexOf(".")===-1?ze=ze.charAt(0)+"."+ze.substr(1)+"E+"+(nn-ze.length+Pi):ze+="E+"+(nn-Pi),ze=ze.replace(/\+-/,"-")}ze=ze.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(ln,cn,hn,un){return cn+hn+un.substr(0,(Qe+Pi)%Qe)+"."+un.substr(Pi)+"E"})}else ze=f.toExponential(Ke);return qe.match(/E\+00$/)&&ze.match(/e[+-]\d$/)&&(ze=ze.substr(0,ze.length-1)+"0"+ze.charAt(ze.length-1)),qe.match(/E\-/)&&ze.match(/e\+/)&&(ze=ze.replace(/e\+/,"e")),ze.replace("e","E")}function write_num_int(qe,f,ze){if(qe.charCodeAt(0)===40&&!f.match(closeparen)){var Ke=f.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return ze>=0?write_num_int("n",Ke,ze):"("+write_num_int("n",Ke,-ze)+")"}if(f.charCodeAt(f.length-1)===44)return write_num_cm2(qe,f,ze);if(f.indexOf("%")!==-1)return write_num_pct2(qe,f,ze);if(f.indexOf("E")!==-1)return write_num_exp2(f,ze);if(f.charCodeAt(0)===36)return"$"+write_num_int(qe,f.substr(f.charAt(1)==" "?2:1),ze);var Qe,Pi,nn,ln,cn=Math.abs(ze),hn=ze<0?"-":"";if(f.match(/^00+$/))return hn+pad0(cn,f.length);if(f.match(/^[#?]+$/))return Qe=""+ze,ze===0&&(Qe=""),Qe.length>f.length?Qe:hashq(f.substr(0,f.length-Qe.length))+Qe;if(Pi=f.match(frac1))return write_num_f2(Pi,cn,hn);if(f.match(/^#+0+$/))return hn+pad0(cn,f.length-f.indexOf("0"));if(Pi=f.match(dec1))return Qe=(""+ze).replace(/^([^\.]+)$/,"$1."+hashq(Pi[1])).replace(/\.$/,"."+hashq(Pi[1])),Qe=Qe.replace(/\.(\d*)$/,function(qn,ys){return"."+ys+fill$1("0",hashq(Pi[1]).length-ys.length)}),f.indexOf("0.")!==-1?Qe:Qe.replace(/^0\./,".");if(f=f.replace(/^#+([0.])/,"$1"),Pi=f.match(/^(0*)\.(#*)$/))return hn+(""+cn).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,Pi[1].length?"0.":".");if(Pi=f.match(/^#{1,3},##0(\.?)$/))return hn+commaify(""+cn);if(Pi=f.match(/^#,##0\.([#0]*0)$/))return ze<0?"-"+write_num_int(qe,f,-ze):commaify(""+ze)+"."+fill$1("0",Pi[1].length);if(Pi=f.match(/^#,#*,#0/))return write_num_int(qe,f.replace(/^#,#*,/,""),ze);if(Pi=f.match(/^([0#]+)(\\?-([0#]+))+$/))return Qe=_strrev(write_num_int(qe,f.replace(/[\\-]/g,""),ze)),nn=0,_strrev(_strrev(f.replace(/\\/g,"")).replace(/[0#]/g,function(qn){return nn<Qe.length?Qe.charAt(nn++):qn==="0"?"0":""}));if(f.match(phone))return Qe=write_num_int(qe,"##########",ze),"("+Qe.substr(0,3)+") "+Qe.substr(3,3)+"-"+Qe.substr(6);var un="";if(Pi=f.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return nn=Math.min(Pi[4].length,7),ln=SSF_frac(cn,Math.pow(10,nn)-1,!1),Qe=""+hn,un=write_num("n",Pi[1],ln[1]),un.charAt(un.length-1)==" "&&(un=un.substr(0,un.length-1)+"0"),Qe+=un+Pi[2]+"/"+Pi[3],un=rpad_(ln[2],nn),un.length<Pi[4].length&&(un=hashq(Pi[4].substr(Pi[4].length-un.length))+un),Qe+=un,Qe;if(Pi=f.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return nn=Math.min(Math.max(Pi[1].length,Pi[4].length),7),ln=SSF_frac(cn,Math.pow(10,nn)-1,!0),hn+(ln[0]||(ln[1]?"":"0"))+" "+(ln[1]?pad_(ln[1],nn)+Pi[2]+"/"+Pi[3]+rpad_(ln[2],nn):fill$1(" ",2*nn+1+Pi[2].length+Pi[3].length));if(Pi=f.match(/^[#0?]+$/))return Qe=""+ze,f.length<=Qe.length?Qe:hashq(f.substr(0,f.length-Qe.length))+Qe;if(Pi=f.match(/^([#0]+)\.([#0]+)$/)){Qe=""+ze.toFixed(Math.min(Pi[2].length,10)).replace(/([^0])0+$/,"$1"),nn=Qe.indexOf(".");var zn=f.indexOf(".")-nn,Xn=f.length-Qe.length-zn;return hashq(f.substr(0,zn)+Qe+f.substr(f.length-Xn))}if(Pi=f.match(/^00,000\.([#0]*0)$/))return ze<0?"-"+write_num_int(qe,f,-ze):commaify(""+ze).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(qn){return"00,"+(qn.length<3?pad0(0,3-qn.length):"")+qn})+"."+pad0(0,Pi[1].length);switch(f){case"###,###":case"##,###":case"#,###":var Un=commaify(""+cn);return Un!=="0"?hn+Un:"";default:if(f.match(/\.[0#?]*$/))return write_num_int(qe,f.slice(0,f.lastIndexOf(".")),ze)+hashq(f.slice(f.lastIndexOf(".")))}throw new Error("unsupported format |"+f+"|")}function write_num(qe,f,ze){return(ze|0)===ze?write_num_int(qe,f,ze):write_num_flt(qe,f,ze)}function SSF_split_fmt(qe){for(var f=[],ze=!1,Ke=0,Qe=0;Ke<qe.length;++Ke)switch(qe.charCodeAt(Ke)){case 34:ze=!ze;break;case 95:case 42:case 92:++Ke;break;case 59:f[f.length]=qe.substr(Qe,Ke-Qe),Qe=Ke+1}if(f[f.length]=qe.substr(Qe),ze===!0)throw new Error("Format |"+qe+"| unterminated string ");return f}var SSF_abstime=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function fmt_is_date(qe){for(var f=0,ze="",Ke="";f<qe.length;)switch(ze=qe.charAt(f)){case"G":SSF_isgeneral(qe,f)&&(f+=6),f++;break;case'"':for(;qe.charCodeAt(++f)!==34&&f<qe.length;);++f;break;case"\\":f+=2;break;case"_":f+=2;break;case"@":++f;break;case"B":case"b":if(qe.charAt(f+1)==="1"||qe.charAt(f+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"":if(qe.substr(f,3).toUpperCase()==="A/P"||qe.substr(f,5).toUpperCase()==="AM/PM"||qe.substr(f,5).toUpperCase()==="/")return!0;++f;break;case"[":for(Ke=ze;qe.charAt(f++)!=="]"&&f<qe.length;)Ke+=qe.charAt(f);if(Ke.match(SSF_abstime))return!0;break;case".":case"0":case"#":for(;f<qe.length&&("0#?.,E+-%".indexOf(ze=qe.charAt(++f))>-1||ze=="\\"&&qe.charAt(f+1)=="-"&&"0#".indexOf(qe.charAt(f+2))>-1););break;case"?":for(;qe.charAt(++f)===ze;);break;case"*":++f,(qe.charAt(f)==" "||qe.charAt(f)=="*")&&++f;break;case"(":case")":++f;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;f<qe.length&&"0123456789".indexOf(qe.charAt(++f))>-1;);break;case" ":++f;break;default:++f;break}return!1}function eval_fmt(qe,f,ze,Ke){for(var Qe=[],Pi="",nn=0,ln="",cn="t",hn,un,zn,Xn="H";nn<qe.length;)switch(ln=qe.charAt(nn)){case"G":if(!SSF_isgeneral(qe,nn))throw new Error("unrecognized character "+ln+" in "+qe);Qe[Qe.length]={t:"G",v:"General"},nn+=7;break;case'"':for(Pi="";(zn=qe.charCodeAt(++nn))!==34&&nn<qe.length;)Pi+=String.fromCharCode(zn);Qe[Qe.length]={t:"t",v:Pi},++nn;break;case"\\":var Un=qe.charAt(++nn),qn=Un==="("||Un===")"?Un:"t";Qe[Qe.length]={t:qn,v:Un},++nn;break;case"_":Qe[Qe.length]={t:"t",v:" "},nn+=2;break;case"@":Qe[Qe.length]={t:"T",v:f},++nn;break;case"B":case"b":if(qe.charAt(nn+1)==="1"||qe.charAt(nn+1)==="2"){if(hn==null&&(hn=SSF_parse_date_code(f,ze,qe.charAt(nn+1)==="2"),hn==null))return"";Qe[Qe.length]={t:"X",v:qe.substr(nn,2)},cn=ln,nn+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":ln=ln.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(f<0||hn==null&&(hn=SSF_parse_date_code(f,ze),hn==null))return"";for(Pi=ln;++nn<qe.length&&qe.charAt(nn).toLowerCase()===ln;)Pi+=ln;ln==="m"&&cn.toLowerCase()==="h"&&(ln="M"),ln==="h"&&(ln=Xn),Qe[Qe.length]={t:ln,v:Pi},cn=ln;break;case"A":case"a":case"":var ys={t:ln,v:ln};if(hn==null&&(hn=SSF_parse_date_code(f,ze)),qe.substr(nn,3).toUpperCase()==="A/P"?(hn!=null&&(ys.v=hn.H>=12?qe.charAt(nn+2):ln),ys.t="T",Xn="h",nn+=3):qe.substr(nn,5).toUpperCase()==="AM/PM"?(hn!=null&&(ys.v=hn.H>=12?"PM":"AM"),ys.t="T",nn+=5,Xn="h"):qe.substr(nn,5).toUpperCase()==="/"?(hn!=null&&(ys.v=hn.H>=12?"":""),ys.t="T",nn+=5,Xn="h"):(ys.t="t",++nn),hn==null&&ys.t==="T")return"";Qe[Qe.length]=ys,cn=ln;break;case"[":for(Pi=ln;qe.charAt(nn++)!=="]"&&nn<qe.length;)Pi+=qe.charAt(nn);if(Pi.slice(-1)!=="]")throw'unterminated "[" block: |'+Pi+"|";if(Pi.match(SSF_abstime)){if(hn==null&&(hn=SSF_parse_date_code(f,ze),hn==null))return"";Qe[Qe.length]={t:"Z",v:Pi.toLowerCase()},cn=Pi.charAt(1)}else Pi.indexOf("$")>-1&&(Pi=(Pi.match(/\$([^-\[\]]*)/)||[])[1]||"$",fmt_is_date(qe)||(Qe[Qe.length]={t:"t",v:Pi}));break;case".":if(hn!=null){for(Pi=ln;++nn<qe.length&&(ln=qe.charAt(nn))==="0";)Pi+=ln;Qe[Qe.length]={t:"s",v:Pi};break}case"0":case"#":for(Pi=ln;++nn<qe.length&&"0#?.,E+-%".indexOf(ln=qe.charAt(nn))>-1;)Pi+=ln;Qe[Qe.length]={t:"n",v:Pi};break;case"?":for(Pi=ln;qe.charAt(++nn)===ln;)Pi+=ln;Qe[Qe.length]={t:ln,v:Pi},cn=ln;break;case"*":++nn,(qe.charAt(nn)==" "||qe.charAt(nn)=="*")&&++nn;break;case"(":case")":Qe[Qe.length]={t:Ke===1?"t":ln,v:ln},++nn;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(Pi=ln;nn<qe.length&&"0123456789".indexOf(qe.charAt(++nn))>-1;)Pi+=qe.charAt(nn);Qe[Qe.length]={t:"D",v:Pi};break;case" ":Qe[Qe.length]={t:ln,v:ln},++nn;break;case"$":Qe[Qe.length]={t:"t",v:"$"},++nn;break;default:if(",$-+/():!^&'~{}<>=acfijklopqrtuvwxzP".indexOf(ln)===-1)throw new Error("unrecognized character "+ln+" in "+qe);Qe[Qe.length]={t:"t",v:ln},++nn;break}var vs=0,ea=0,na;for(nn=Qe.length-1,cn="t";nn>=0;--nn)switch(Qe[nn].t){case"h":case"H":Qe[nn].t=Xn,cn="h",vs<1&&(vs=1);break;case"s":(na=Qe[nn].v.match(/\.0+$/))&&(ea=Math.max(ea,na[0].length-1),vs=4),vs<3&&(vs=3);case"d":case"y":case"e":cn=Qe[nn].t;break;case"M":cn=Qe[nn].t,vs<2&&(vs=2);break;case"m":cn==="s"&&(Qe[nn].t="M",vs<2&&(vs=2));break;case"X":break;case"Z":vs<1&&Qe[nn].v.match(/[Hh]/)&&(vs=1),vs<2&&Qe[nn].v.match(/[Mm]/)&&(vs=2),vs<3&&Qe[nn].v.match(/[Ss]/)&&(vs=3)}var ta;switch(vs){case 0:break;case 1:case 2:case 3:hn.u>=.5&&(hn.u=0,++hn.S),hn.S>=60&&(hn.S=0,++hn.M),hn.M>=60&&(hn.M=0,++hn.H),hn.H>=24&&(hn.H=0,++hn.D,ta=SSF_parse_date_code(hn.D),ta.u=hn.u,ta.S=hn.S,ta.M=hn.M,ta.H=hn.H,hn=ta);break;case 4:switch(ea){case 1:hn.u=Math.round(hn.u*10)/10;break;case 2:hn.u=Math.round(hn.u*100)/100;break;case 3:hn.u=Math.round(hn.u*1e3)/1e3;break}hn.u>=1&&(hn.u=0,++hn.S),hn.S>=60&&(hn.S=0,++hn.M),hn.M>=60&&(hn.M=0,++hn.H),hn.H>=24&&(hn.H=0,++hn.D,ta=SSF_parse_date_code(hn.D),ta.u=hn.u,ta.S=hn.S,ta.M=hn.M,ta.H=hn.H,hn=ta);break}var ra="",oa;for(nn=0;nn<Qe.length;++nn)switch(Qe[nn].t){case"t":case"T":case" ":case"D":break;case"X":Qe[nn].v="",Qe[nn].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":Qe[nn].v=SSF_write_date(Qe[nn].t.charCodeAt(0),Qe[nn].v,hn,ea),Qe[nn].t="t";break;case"n":case"?":for(oa=nn+1;Qe[oa]!=null&&((ln=Qe[oa].t)==="?"||ln==="D"||(ln===" "||ln==="t")&&Qe[oa+1]!=null&&(Qe[oa+1].t==="?"||Qe[oa+1].t==="t"&&Qe[oa+1].v==="/")||Qe[nn].t==="("&&(ln===" "||ln==="n"||ln===")")||ln==="t"&&(Qe[oa].v==="/"||Qe[oa].v===" "&&Qe[oa+1]!=null&&Qe[oa+1].t=="?"));)Qe[nn].v+=Qe[oa].v,Qe[oa]={v:"",t:";"},++oa;ra+=Qe[nn].v,nn=oa-1;break;case"G":Qe[nn].t="t",Qe[nn].v=SSF_general(f,ze);break}var fa="",ca,la;if(ra.length>0){ra.charCodeAt(0)==40?(ca=f<0&&ra.charCodeAt(0)===45?-f:f,la=write_num("n",ra,ca)):(ca=f<0&&Ke>1?-f:f,la=write_num("n",ra,ca),ca<0&&Qe[0]&&Qe[0].t=="t"&&(la=la.substr(1),Qe[0].v="-"+Qe[0].v)),oa=la.length-1;var ua=Qe.length;for(nn=0;nn<Qe.length;++nn)if(Qe[nn]!=null&&Qe[nn].t!="t"&&Qe[nn].v.indexOf(".")>-1){ua=nn;break}var ga=Qe.length;if(ua===Qe.length&&la.indexOf("E")===-1){for(nn=Qe.length-1;nn>=0;--nn)Qe[nn]==null||"n?".indexOf(Qe[nn].t)===-1||(oa>=Qe[nn].v.length-1?(oa-=Qe[nn].v.length,Qe[nn].v=la.substr(oa+1,Qe[nn].v.length)):oa<0?Qe[nn].v="":(Qe[nn].v=la.substr(0,oa+1),oa=-1),Qe[nn].t="t",ga=nn);oa>=0&&ga<Qe.length&&(Qe[ga].v=la.substr(0,oa+1)+Qe[ga].v)}else if(ua!==Qe.length&&la.indexOf("E")===-1){for(oa=la.indexOf(".")-1,nn=ua;nn>=0;--nn)if(!(Qe[nn]==null||"n?".indexOf(Qe[nn].t)===-1)){for(un=Qe[nn].v.indexOf(".")>-1&&nn===ua?Qe[nn].v.indexOf(".")-1:Qe[nn].v.length-1,fa=Qe[nn].v.substr(un+1);un>=0;--un)oa>=0&&(Qe[nn].v.charAt(un)==="0"||Qe[nn].v.charAt(un)==="#")&&(fa=la.charAt(oa--)+fa);Qe[nn].v=fa,Qe[nn].t="t",ga=nn}for(oa>=0&&ga<Qe.length&&(Qe[ga].v=la.substr(0,oa+1)+Qe[ga].v),oa=la.indexOf(".")+1,nn=ua;nn<Qe.length;++nn)if(!(Qe[nn]==null||"n?(".indexOf(Qe[nn].t)===-1&&nn!==ua)){for(un=Qe[nn].v.indexOf(".")>-1&&nn===ua?Qe[nn].v.indexOf(".")+1:0,fa=Qe[nn].v.substr(0,un);un<Qe[nn].v.length;++un)oa<la.length&&(fa+=la.charAt(oa++));Qe[nn].v=fa,Qe[nn].t="t",ga=nn}}}for(nn=0;nn<Qe.length;++nn)Qe[nn]!=null&&"n?".indexOf(Qe[nn].t)>-1&&(ca=Ke>1&&f<0&&nn>0&&Qe[nn-1].v==="-"?-f:f,Qe[nn].v=write_num(Qe[nn].t,Qe[nn].v,ca),Qe[nn].t="t");var da="";for(nn=0;nn!==Qe.length;++nn)Qe[nn]!=null&&(da+=Qe[nn].v);return da}var cfregex2=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function chkcond(qe,f){if(f==null)return!1;var ze=parseFloat(f[2]);switch(f[1]){case"=":if(qe==ze)return!0;break;case">":if(qe>ze)return!0;break;case"<":if(qe<ze)return!0;break;case"<>":if(qe!=ze)return!0;break;case">=":if(qe>=ze)return!0;break;case"<=":if(qe<=ze)return!0;break}return!1}function choose_fmt(qe,f){var ze=SSF_split_fmt(qe),Ke=ze.length,Qe=ze[Ke-1].indexOf("@");if(Ke<4&&Qe>-1&&--Ke,ze.length>4)throw new Error("cannot find right format for |"+ze.join("|")+"|");if(typeof f!="number")return[4,ze.length===4||Qe>-1?ze[ze.length-1]:"@"];switch(typeof f=="number"&&!isFinite(f)&&(f=0),ze.length){case 1:ze=Qe>-1?["General","General","General",ze[0]]:[ze[0],ze[0],ze[0],"@"];break;case 2:ze=Qe>-1?[ze[0],ze[0],ze[0],ze[1]]:[ze[0],ze[1],ze[0],"@"];break;case 3:ze=Qe>-1?[ze[0],ze[1],ze[0],ze[2]]:[ze[0],ze[1],ze[2],"@"];break}var Pi=f>0?ze[0]:f<0?ze[1]:ze[2];if(ze[0].indexOf("[")===-1&&ze[1].indexOf("[")===-1)return[Ke,Pi];if(ze[0].match(/\[[=<>]/)!=null||ze[1].match(/\[[=<>]/)!=null){var nn=ze[0].match(cfregex2),ln=ze[1].match(cfregex2);return chkcond(f,nn)?[Ke,ze[0]]:chkcond(f,ln)?[Ke,ze[1]]:[Ke,ze[nn!=null&&ln!=null?2:1]]}return[Ke,Pi]}function SSF_format(qe,f,ze){ze==null&&(ze={});var Ke="";switch(typeof qe){case"string":qe=="m/d/yy"&&ze.dateNF?Ke=ze.dateNF:Ke=qe;break;case"number":qe==14&&ze.dateNF?Ke=ze.dateNF:Ke=(ze.table!=null?ze.table:table_fmt)[qe],Ke==null&&(Ke=ze.table&&ze.table[SSF_default_map[qe]]||table_fmt[SSF_default_map[qe]]),Ke==null&&(Ke=SSF_default_str[qe]||"General");break}if(SSF_isgeneral(Ke,0))return SSF_general(f,ze);f instanceof Date&&(f=datenum(f,ze.date1904));var Qe=choose_fmt(Ke,f);if(SSF_isgeneral(Qe[1]))return SSF_general(f,ze);if(f===!0)f="TRUE";else if(f===!1)f="FALSE";else{if(f===""||f==null)return"";if(isNaN(f)&&Qe[1].indexOf("0")>-1)return"#NUM!";if(!isFinite(f)&&Qe[1].indexOf("0")>-1)return"#DIV/0!"}return eval_fmt(Qe[1],f,ze,Qe[0])}function SSF_load(qe,f){if(typeof f!="number"){f=+f||-1;for(var ze=0;ze<392;++ze){if(table_fmt[ze]==null){f<0&&(f=ze);continue}if(table_fmt[ze]==qe){f=ze;break}}f<0&&(f=391)}return table_fmt[f]=qe,f}function SSF_load_table(qe){for(var f=0;f!=392;++f)qe[f]!==void 0&&SSF_load(qe[f],f)}function make_ssf(){table_fmt=SSF_init_table()}var dateNFregex=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function dateNF_regex(qe){var f=typeof qe=="number"?table_fmt[qe]:qe;return f=f.replace(dateNFregex,"(\\d+)"),dateNFregex.lastIndex=0,new RegExp("^"+f+"$")}function dateNF_fix(qe,f,ze){var Ke=-1,Qe=-1,Pi=-1,nn=-1,ln=-1,cn=-1;(f.match(dateNFregex)||[]).forEach(function(zn,Xn){var Un=parseInt(ze[Xn+1],10);switch(zn.toLowerCase().charAt(0)){case"y":Ke=Un;break;case"d":Pi=Un;break;case"h":nn=Un;break;case"s":cn=Un;break;case"m":nn>=0?ln=Un:Qe=Un;break}}),dateNFregex.lastIndex=0,cn>=0&&ln==-1&&Qe>=0&&(ln=Qe,Qe=-1);var hn=(""+(Ke>=0?Ke:new Date().getFullYear())).slice(-4)+"-"+("00"+(Qe>=1?Qe:1)).slice(-2)+"-"+("00"+(Pi>=1?Pi:1)).slice(-2);hn.length==7&&(hn="0"+hn),hn.length==8&&(hn="20"+hn);var un=("00"+(nn>=0?nn:0)).slice(-2)+":"+("00"+(ln>=0?ln:0)).slice(-2)+":"+("00"+(cn>=0?cn:0)).slice(-2);return nn==-1&&ln==-1&&cn==-1?hn:Ke==-1&&Qe==-1&&Pi==-1?un:hn+"T"+un}var bad_formats={"d.m":"d\\.m"};function SSF__load(qe,f){return SSF_load(bad_formats[qe]||qe,f)}var CRC32=function(){var qe={};qe.version="1.2.0";function f(){for(var ca=0,la=new Array(256),ua=0;ua!=256;++ua)ca=ua,ca=ca&1?-306674912^ca>>>1:ca>>>1,ca=ca&1?-306674912^ca>>>1:ca>>>1,ca=ca&1?-306674912^ca>>>1:ca>>>1,ca=ca&1?-306674912^ca>>>1:ca>>>1,ca=ca&1?-306674912^ca>>>1:ca>>>1,ca=ca&1?-306674912^ca>>>1:ca>>>1,ca=ca&1?-306674912^ca>>>1:ca>>>1,ca=ca&1?-306674912^ca>>>1:ca>>>1,la[ua]=ca;return typeof Int32Array<"u"?new Int32Array(la):la}var ze=f();function Ke(ca){var la=0,ua=0,ga=0,da=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(ga=0;ga!=256;++ga)da[ga]=ca[ga];for(ga=0;ga!=256;++ga)for(ua=ca[ga],la=256+ga;la<4096;la+=256)ua=da[la]=ua>>>8^ca[ua&255];var qa=[];for(ga=1;ga!=16;++ga)qa[ga-1]=typeof Int32Array<"u"&&typeof da.subarray=="function"?da.subarray(ga*256,ga*256+256):da.slice(ga*256,ga*256+256);return qa}var Qe=Ke(ze),Pi=Qe[0],nn=Qe[1],ln=Qe[2],cn=Qe[3],hn=Qe[4],un=Qe[5],zn=Qe[6],Xn=Qe[7],Un=Qe[8],qn=Qe[9],ys=Qe[10],vs=Qe[11],ea=Qe[12],na=Qe[13],ta=Qe[14];function ra(ca,la){for(var ua=la^-1,ga=0,da=ca.length;ga<da;)ua=ua>>>8^ze[(ua^ca.charCodeAt(ga++))&255];return~ua}function oa(ca,la){for(var ua=la^-1,ga=ca.length-15,da=0;da<ga;)ua=ta[ca[da++]^ua&255]^na[ca[da++]^ua>>8&255]^ea[ca[da++]^ua>>16&255]^vs[ca[da++]^ua>>>24]^ys[ca[da++]]^qn[ca[da++]]^Un[ca[da++]]^Xn[ca[da++]]^zn[ca[da++]]^un[ca[da++]]^hn[ca[da++]]^cn[ca[da++]]^ln[ca[da++]]^nn[ca[da++]]^Pi[ca[da++]]^ze[ca[da++]];for(ga+=15;da<ga;)ua=ua>>>8^ze[(ua^ca[da++])&255];return~ua}function fa(ca,la){for(var ua=la^-1,ga=0,da=ca.length,qa=0,tl=0;ga<da;)qa=ca.charCodeAt(ga++),qa<128?ua=ua>>>8^ze[(ua^qa)&255]:qa<2048?(ua=ua>>>8^ze[(ua^(192|qa>>6&31))&255],ua=ua>>>8^ze[(ua^(128|qa&63))&255]):qa>=55296&&qa<57344?(qa=(qa&1023)+64,tl=ca.charCodeAt(ga++)&1023,ua=ua>>>8^ze[(ua^(240|qa>>8&7))&255],ua=ua>>>8^ze[(ua^(128|qa>>2&63))&255],ua=ua>>>8^ze[(ua^(128|tl>>6&15|(qa&3)<<4))&255],ua=ua>>>8^ze[(ua^(128|tl&63))&255]):(ua=ua>>>8^ze[(ua^(224|qa>>12&15))&255],ua=ua>>>8^ze[(ua^(128|qa>>6&63))&255],ua=ua>>>8^ze[(ua^(128|qa&63))&255]);return~ua}return qe.table=ze,qe.bstr=ra,qe.buf=oa,qe.str=fa,qe}(),CFB=function(){var f={};f.version="1.2.2";function ze(aa,pa){for(var ha=aa.split("/"),Ma=pa.split("/"),Ka=0,Na=0,el=Math.min(ha.length,Ma.length);Ka<el;++Ka){if(Na=ha[Ka].length-Ma[Ka].length)return Na;if(ha[Ka]!=Ma[Ka])return ha[Ka]<Ma[Ka]?-1:1}return ha.length-Ma.length}function Ke(aa){if(aa.charAt(aa.length-1)=="/")return aa.slice(0,-1).indexOf("/")===-1?aa:Ke(aa.slice(0,-1));var pa=aa.lastIndexOf("/");return pa===-1?aa:aa.slice(0,pa+1)}function Qe(aa){if(aa.charAt(aa.length-1)=="/")return Qe(aa.slice(0,-1));var pa=aa.lastIndexOf("/");return pa===-1?aa:aa.slice(pa+1)}function Pi(aa,pa){typeof pa=="string"&&(pa=new Date(pa));var ha=pa.getHours();ha=ha<<6|pa.getMinutes(),ha=ha<<5|pa.getSeconds()>>>1,aa.write_shift(2,ha);var Ma=pa.getFullYear()-1980;Ma=Ma<<4|pa.getMonth()+1,Ma=Ma<<5|pa.getDate(),aa.write_shift(2,Ma)}function nn(aa){var pa=aa.read_shift(2)&65535,ha=aa.read_shift(2)&65535,Ma=new Date,Ka=ha&31;ha>>>=5;var Na=ha&15;ha>>>=4,Ma.setMilliseconds(0),Ma.setFullYear(ha+1980),Ma.setMonth(Na-1),Ma.setDate(Ka);var el=pa&31;pa>>>=5;var fl=pa&63;return pa>>>=6,Ma.setHours(pa),Ma.setMinutes(fl),Ma.setSeconds(el<<1),Ma}function ln(aa){prep_blob(aa,0);for(var pa={},ha=0;aa.l<=aa.length-4;){var Ma=aa.read_shift(2),Ka=aa.read_shift(2),Na=aa.l+Ka,el={};switch(Ma){case 21589:ha=aa.read_shift(1),ha&1&&(el.mtime=aa.read_shift(4)),Ka>5&&(ha&2&&(el.atime=aa.read_shift(4)),ha&4&&(el.ctime=aa.read_shift(4))),el.mtime&&(el.mt=new Date(el.mtime*1e3));break;case 1:{var fl=aa.read_shift(4),Ua=aa.read_shift(4);el.usz=Ua*Math.pow(2,32)+fl,fl=aa.read_shift(4),Ua=aa.read_shift(4),el.csz=Ua*Math.pow(2,32)+fl}break}aa.l=Na,pa[Ma]=el}return pa}var cn;function hn(){return cn||(cn=_fs)}function un(aa,pa){if(aa[0]==80&&aa[1]==75)return Cc(aa,pa);if((aa[0]|32)==109&&(aa[1]|32)==105)return xs(aa,pa);if(aa.length<512)throw new Error("CFB file size "+aa.length+" < 512");var ha=3,Ma=512,Ka=0,Na=0,el=0,fl=0,Ua=0,il=[],ll=aa.slice(0,512);prep_blob(ll,0);var Tl=zn(ll);switch(ha=Tl[0],ha){case 3:Ma=512;break;case 4:Ma=4096;break;case 0:if(Tl[1]==0)return Cc(aa,pa);default:throw new Error("Major Version: Expected 3 or 4 saw "+ha)}Ma!==512&&(ll=aa.slice(0,Ma),prep_blob(ll,28));var Dl=aa.slice(0,Ma);Xn(ll,ha);var Nl=ll.read_shift(4,"i");if(ha===3&&Nl!==0)throw new Error("# Directory Sectors: Expected 0 saw "+Nl);ll.l+=4,el=ll.read_shift(4,"i"),ll.l+=4,ll.chk("00100000","Mini Stream Cutoff Size: "),fl=ll.read_shift(4,"i"),Ka=ll.read_shift(4,"i"),Ua=ll.read_shift(4,"i"),Na=ll.read_shift(4,"i");for(var bl=-1,Cl=0;Cl<109&&(bl=ll.read_shift(4,"i"),!(bl<0));++Cl)il[Cl]=bl;var Kl=Un(aa,Ma);vs(Ua,Na,Kl,Ma,il);var ul=na(Kl,el,il,Ma);el<ul.length&&(ul[el].name="!Directory"),Ka>0&&fl!==tl&&(ul[fl].name="!MiniFAT"),ul[il[0]].name="!FAT",ul.fat_addrs=il,ul.ssz=Ma;var Ml={},Ul=[],Bl=[],sc=[];ta(el,ul,Kl,Ul,Ka,Ml,Bl,fl),qn(Bl,sc,Ul),Ul.shift();var ic={FileIndex:Bl,FullPaths:sc};return pa&&pa.raw&&(ic.raw={header:Dl,sectors:Kl}),ic}function zn(aa){if(aa[aa.l]==80&&aa[aa.l+1]==75)return[0,0];aa.chk(ol,"Header Signature: "),aa.l+=16;var pa=aa.read_shift(2,"u");return[aa.read_shift(2,"u"),pa]}function Xn(aa,pa){var ha=9;switch(aa.l+=2,ha=aa.read_shift(2)){case 9:if(pa!=3)throw new Error("Sector Shift: Expected 9 saw "+ha);break;case 12:if(pa!=4)throw new Error("Sector Shift: Expected 12 saw "+ha);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+ha)}aa.chk("0600","Mini Sector Shift: "),aa.chk("000000000000","Reserved: ")}function Un(aa,pa){for(var ha=Math.ceil(aa.length/pa)-1,Ma=[],Ka=1;Ka<ha;++Ka)Ma[Ka-1]=aa.slice(Ka*pa,(Ka+1)*pa);return Ma[ha-1]=aa.slice(ha*pa),Ma}function qn(aa,pa,ha){for(var Ma=0,Ka=0,Na=0,el=0,fl=0,Ua=ha.length,il=[],ll=[];Ma<Ua;++Ma)il[Ma]=ll[Ma]=Ma,pa[Ma]=ha[Ma];for(;fl<ll.length;++fl)Ma=ll[fl],Ka=aa[Ma].L,Na=aa[Ma].R,el=aa[Ma].C,il[Ma]===Ma&&(Ka!==-1&&il[Ka]!==Ka&&(il[Ma]=il[Ka]),Na!==-1&&il[Na]!==Na&&(il[Ma]=il[Na])),el!==-1&&(il[el]=Ma),Ka!==-1&&Ma!=il[Ma]&&(il[Ka]=il[Ma],ll.lastIndexOf(Ka)<fl&&ll.push(Ka)),Na!==-1&&Ma!=il[Ma]&&(il[Na]=il[Ma],ll.lastIndexOf(Na)<fl&&ll.push(Na));for(Ma=1;Ma<Ua;++Ma)il[Ma]===Ma&&(Na!==-1&&il[Na]!==Na?il[Ma]=il[Na]:Ka!==-1&&il[Ka]!==Ka&&(il[Ma]=il[Ka]));for(Ma=1;Ma<Ua;++Ma)if(aa[Ma].type!==0){if(fl=Ma,fl!=il[fl])do fl=il[fl],pa[Ma]=pa[fl]+"/"+pa[Ma];while(fl!==0&&il[fl]!==-1&&fl!=il[fl]);il[Ma]=-1}for(pa[0]+="/",Ma=1;Ma<Ua;++Ma)aa[Ma].type!==2&&(pa[Ma]+="/")}function ys(aa,pa,ha){for(var Ma=aa.start,Ka=aa.size,Na=[],el=Ma;ha&&Ka>0&&el>=0;)Na.push(pa.slice(el*qa,el*qa+qa)),Ka-=qa,el=__readInt32LE(ha,el*4);return Na.length===0?new_buf(0):bconcat(Na).slice(0,aa.size)}function vs(aa,pa,ha,Ma,Ka){var Na=tl;if(aa===tl){if(pa!==0)throw new Error("DIFAT chain shorter than expected")}else if(aa!==-1){var el=ha[aa],fl=(Ma>>>2)-1;if(!el)return;for(var Ua=0;Ua<fl&&(Na=__readInt32LE(el,Ua*4))!==tl;++Ua)Ka.push(Na);pa>=1&&vs(__readInt32LE(el,Ma-4),pa-1,ha,Ma,Ka)}}function ea(aa,pa,ha,Ma,Ka){var Na=[],el=[];Ka||(Ka=[]);var fl=Ma-1,Ua=0,il=0;for(Ua=pa;Ua>=0;){Ka[Ua]=!0,Na[Na.length]=Ua,el.push(aa[Ua]);var ll=ha[Math.floor(Ua*4/Ma)];if(il=Ua*4&fl,Ma<4+il)throw new Error("FAT boundary crossed: "+Ua+" 4 "+Ma);if(!aa[ll])break;Ua=__readInt32LE(aa[ll],il)}return{nodes:Na,data:__toBuffer([el])}}function na(aa,pa,ha,Ma){var Ka=aa.length,Na=[],el=[],fl=[],Ua=[],il=Ma-1,ll=0,Tl=0,Dl=0,Nl=0;for(ll=0;ll<Ka;++ll)if(fl=[],Dl=ll+pa,Dl>=Ka&&(Dl-=Ka),!el[Dl]){Ua=[];var bl=[];for(Tl=Dl;Tl>=0;){bl[Tl]=!0,el[Tl]=!0,fl[fl.length]=Tl,Ua.push(aa[Tl]);var Cl=ha[Math.floor(Tl*4/Ma)];if(Nl=Tl*4&il,Ma<4+Nl)throw new Error("FAT boundary crossed: "+Tl+" 4 "+Ma);if(!aa[Cl]||(Tl=__readInt32LE(aa[Cl],Nl),bl[Tl]))break}Na[Dl]={nodes:fl,data:__toBuffer([Ua])}}return Na}function ta(aa,pa,ha,Ma,Ka,Na,el,fl){for(var Ua=0,il=Ma.length?2:0,ll=pa[aa].data,Tl=0,Dl=0,Nl;Tl<ll.length;Tl+=128){var bl=ll.slice(Tl,Tl+128);prep_blob(bl,64),Dl=bl.read_shift(2),Nl=__utf16le(bl,0,Dl-il),Ma.push(Nl);var Cl={name:Nl,type:bl.read_shift(1),color:bl.read_shift(1),L:bl.read_shift(4,"i"),R:bl.read_shift(4,"i"),C:bl.read_shift(4,"i"),clsid:bl.read_shift(16),state:bl.read_shift(4,"i"),start:0,size:0},Kl=bl.read_shift(2)+bl.read_shift(2)+bl.read_shift(2)+bl.read_shift(2);Kl!==0&&(Cl.ct=ra(bl,bl.l-8));var ul=bl.read_shift(2)+bl.read_shift(2)+bl.read_shift(2)+bl.read_shift(2);ul!==0&&(Cl.mt=ra(bl,bl.l-8)),Cl.start=bl.read_shift(4,"i"),Cl.size=bl.read_shift(4,"i"),Cl.size<0&&Cl.start<0&&(Cl.size=Cl.type=0,Cl.start=tl,Cl.name=""),Cl.type===5?(Ua=Cl.start,Ka>0&&Ua!==tl&&(pa[Ua].name="!StreamData")):Cl.size>=4096?(Cl.storage="fat",pa[Cl.start]===void 0&&(pa[Cl.start]=ea(ha,Cl.start,pa.fat_addrs,pa.ssz)),pa[Cl.start].name=Cl.name,Cl.content=pa[Cl.start].data.slice(0,Cl.size)):(Cl.storage="minifat",Cl.size<0?Cl.size=0:Ua!==tl&&Cl.start!==tl&&pa[Ua]&&(Cl.content=ys(Cl,pa[Ua].data,(pa[fl]||{}).data))),Cl.content&&prep_blob(Cl.content,0),Na[Nl]=Cl,el.push(Cl)}}function ra(aa,pa){return new Date((__readUInt32LE(aa,pa+4)/1e7*Math.pow(2,32)+__readUInt32LE(aa,pa)/1e7-11644473600)*1e3)}function oa(aa,pa){return hn(),un(cn.readFileSync(aa),pa)}function fa(aa,pa){var ha=pa&&pa.type;switch(ha||has_buf&&Buffer.isBuffer(aa)&&(ha="buffer"),ha||"base64"){case"file":return oa(aa,pa);case"base64":return un(s2a(Base64_decode(aa)),pa);case"binary":return un(s2a(aa),pa)}return un(aa,pa)}function ca(aa,pa){var ha=pa||{},Ma=ha.root||"Root Entry";if(aa.FullPaths||(aa.FullPaths=[]),aa.FileIndex||(aa.FileIndex=[]),aa.FullPaths.length!==aa.FileIndex.length)throw new Error("inconsistent CFB structure");aa.FullPaths.length===0&&(aa.FullPaths[0]=Ma+"/",aa.FileIndex[0]={name:Ma,type:5}),ha.CLSID&&(aa.FileIndex[0].clsid=ha.CLSID),la(aa)}function la(aa){var pa="Sh33tJ5";if(!CFB.find(aa,"/"+pa)){var ha=new_buf(4);ha[0]=55,ha[1]=ha[3]=50,ha[2]=54,aa.FileIndex.push({name:pa,type:2,content:ha,size:4,L:69,R:69,C:69}),aa.FullPaths.push(aa.FullPaths[0]+pa),ua(aa)}}function ua(aa,pa){ca(aa);for(var ha=!1,Ma=!1,Ka=aa.FullPaths.length-1;Ka>=0;--Ka){var Na=aa.FileIndex[Ka];switch(Na.type){case 0:Ma?ha=!0:(aa.FileIndex.pop(),aa.FullPaths.pop());break;case 1:case 2:case 5:Ma=!0,isNaN(Na.R*Na.L*Na.C)&&(ha=!0),Na.R>-1&&Na.L>-1&&Na.R==Na.L&&(ha=!0);break;default:ha=!0;break}}if(!(!ha&&!pa)){var el=new Date(1987,1,19),fl=0,Ua=Object.create?Object.create(null):{},il=[];for(Ka=0;Ka<aa.FullPaths.length;++Ka)Ua[aa.FullPaths[Ka]]=!0,aa.FileIndex[Ka].type!==0&&il.push([aa.FullPaths[Ka],aa.FileIndex[Ka]]);for(Ka=0;Ka<il.length;++Ka){var ll=Ke(il[Ka][0]);for(Ma=Ua[ll];!Ma;){for(;Ke(ll)&&!Ua[Ke(ll)];)ll=Ke(ll);il.push([ll,{name:Qe(ll).replace("/",""),type:1,clsid:wl,ct:el,mt:el,content:null}]),Ua[ll]=!0,ll=Ke(il[Ka][0]),Ma=Ua[ll]}}for(il.sort(function(Nl,bl){return ze(Nl[0],bl[0])}),aa.FullPaths=[],aa.FileIndex=[],Ka=0;Ka<il.length;++Ka)aa.FullPaths[Ka]=il[Ka][0],aa.FileIndex[Ka]=il[Ka][1];for(Ka=0;Ka<il.length;++Ka){var Tl=aa.FileIndex[Ka],Dl=aa.FullPaths[Ka];if(Tl.name=Qe(Dl).replace("/",""),Tl.L=Tl.R=Tl.C=-(Tl.color=1),Tl.size=Tl.content?Tl.content.length:0,Tl.start=0,Tl.clsid=Tl.clsid||wl,Ka===0)Tl.C=il.length>1?1:-1,Tl.size=0,Tl.type=5;else if(Dl.slice(-1)=="/"){for(fl=Ka+1;fl<il.length&&Ke(aa.FullPaths[fl])!=Dl;++fl);for(Tl.C=fl>=il.length?-1:fl,fl=Ka+1;fl<il.length&&Ke(aa.FullPaths[fl])!=Ke(Dl);++fl);Tl.R=fl>=il.length?-1:fl,Tl.type=1}else Ke(aa.FullPaths[Ka+1]||"")==Ke(Dl)&&(Tl.R=Ka+1),Tl.type=2}}}function ga(aa,pa){var ha=pa||{};if(ha.fileType=="mad")return Kn(aa,ha);switch(ua(aa),ha.fileType){case"zip":return xc(aa,ha)}var Ma=function(Nl){for(var bl=0,Cl=0,Kl=0;Kl<Nl.FileIndex.length;++Kl){var ul=Nl.FileIndex[Kl];if(ul.content){var Ml=ul.content.length;Ml>0&&(Ml<4096?bl+=Ml+63>>6:Cl+=Ml+511>>9)}}for(var Ul=Nl.FullPaths.length+3>>2,Bl=bl+7>>3,sc=bl+127>>7,ic=Bl+Cl+Ul+sc,nc=ic+127>>7,lc=nc<=109?0:Math.ceil((nc-109)/127);ic+nc+lc+127>>7>nc;)lc=++nc<=109?0:Math.ceil((nc-109)/127);var cc=[1,lc,nc,sc,Ul,Cl,bl,0];return Nl.FileIndex[0].size=bl<<6,cc[7]=(Nl.FileIndex[0].start=cc[0]+cc[1]+cc[2]+cc[3]+cc[4]+cc[5])+(cc[6]+7>>3),cc}(aa),Ka=new_buf(Ma[7]<<9),Na=0,el=0;{for(Na=0;Na<8;++Na)Ka.write_shift(1,hl[Na]);for(Na=0;Na<8;++Na)Ka.write_shift(2,0);for(Ka.write_shift(2,62),Ka.write_shift(2,3),Ka.write_shift(2,65534),Ka.write_shift(2,9),Ka.write_shift(2,6),Na=0;Na<3;++Na)Ka.write_shift(2,0);for(Ka.write_shift(4,0),Ka.write_shift(4,Ma[2]),Ka.write_shift(4,Ma[0]+Ma[1]+Ma[2]+Ma[3]-1),Ka.write_shift(4,0),Ka.write_shift(4,4096),Ka.write_shift(4,Ma[3]?Ma[0]+Ma[1]+Ma[2]-1:tl),Ka.write_shift(4,Ma[3]),Ka.write_shift(-4,Ma[1]?Ma[0]-1:tl),Ka.write_shift(4,Ma[1]),Na=0;Na<109;++Na)Ka.write_shift(-4,Na<Ma[2]?Ma[1]+Na:-1)}if(Ma[1])for(el=0;el<Ma[1];++el){for(;Na<236+el*127;++Na)Ka.write_shift(-4,Na<Ma[2]?Ma[1]+Na:-1);Ka.write_shift(-4,el===Ma[1]-1?tl:el+1)}var fl=function(Nl){for(el+=Nl;Na<el-1;++Na)Ka.write_shift(-4,Na+1);Nl&&(++Na,Ka.write_shift(-4,tl))};for(el=Na=0,el+=Ma[1];Na<el;++Na)Ka.write_shift(-4,_l.DIFSECT);for(el+=Ma[2];Na<el;++Na)Ka.write_shift(-4,_l.FATSECT);fl(Ma[3]),fl(Ma[4]);for(var Ua=0,il=0,ll=aa.FileIndex[0];Ua<aa.FileIndex.length;++Ua)ll=aa.FileIndex[Ua],ll.content&&(il=ll.content.length,!(il<4096)&&(ll.start=el,fl(il+511>>9)));for(fl(Ma[6]+7>>3);Ka.l&511;)Ka.write_shift(-4,_l.ENDOFCHAIN);for(el=Na=0,Ua=0;Ua<aa.FileIndex.length;++Ua)ll=aa.FileIndex[Ua],ll.content&&(il=ll.content.length,!(!il||il>=4096)&&(ll.start=el,fl(il+63>>6)));for(;Ka.l&511;)Ka.write_shift(-4,_l.ENDOFCHAIN);for(Na=0;Na<Ma[4]<<2;++Na){var Tl=aa.FullPaths[Na];if(!Tl||Tl.length===0){for(Ua=0;Ua<17;++Ua)Ka.write_shift(4,0);for(Ua=0;Ua<3;++Ua)Ka.write_shift(4,-1);for(Ua=0;Ua<12;++Ua)Ka.write_shift(4,0);continue}ll=aa.FileIndex[Na],Na===0&&(ll.start=ll.size?ll.start-1:tl);var Dl=Na===0&&ha.root||ll.name;if(Dl.length>31&&(console.error("Name "+Dl+" will be truncated to "+Dl.slice(0,31)),Dl=Dl.slice(0,31)),il=2*(Dl.length+1),Ka.write_shift(64,Dl,"utf16le"),Ka.write_shift(2,il),Ka.write_shift(1,ll.type),Ka.write_shift(1,ll.color),Ka.write_shift(-4,ll.L),Ka.write_shift(-4,ll.R),Ka.write_shift(-4,ll.C),ll.clsid)Ka.write_shift(16,ll.clsid,"hex");else for(Ua=0;Ua<4;++Ua)Ka.write_shift(4,0);Ka.write_shift(4,ll.state||0),Ka.write_shift(4,0),Ka.write_shift(4,0),Ka.write_shift(4,0),Ka.write_shift(4,0),Ka.write_shift(4,ll.start),Ka.write_shift(4,ll.size),Ka.write_shift(4,0)}for(Na=1;Na<aa.FileIndex.length;++Na)if(ll=aa.FileIndex[Na],ll.size>=4096)if(Ka.l=ll.start+1<<9,has_buf&&Buffer.isBuffer(ll.content))ll.content.copy(Ka,Ka.l,0,ll.size),Ka.l+=ll.size+511&-512;else{for(Ua=0;Ua<ll.size;++Ua)Ka.write_shift(1,ll.content[Ua]);for(;Ua&511;++Ua)Ka.write_shift(1,0)}for(Na=1;Na<aa.FileIndex.length;++Na)if(ll=aa.FileIndex[Na],ll.size>0&&ll.size<4096)if(has_buf&&Buffer.isBuffer(ll.content))ll.content.copy(Ka,Ka.l,0,ll.size),Ka.l+=ll.size+63&-64;else{for(Ua=0;Ua<ll.size;++Ua)Ka.write_shift(1,ll.content[Ua]);for(;Ua&63;++Ua)Ka.write_shift(1,0)}if(has_buf)Ka.l=Ka.length;else for(;Ka.l<Ka.length;)Ka.write_shift(1,0);return Ka}function da(aa,pa){var ha=aa.FullPaths.map(function(Ua){return Ua.toUpperCase()}),Ma=ha.map(function(Ua){var il=Ua.split("/");return il[il.length-(Ua.slice(-1)=="/"?2:1)]}),Ka=!1;pa.charCodeAt(0)===47?(Ka=!0,pa=ha[0].slice(0,-1)+pa):Ka=pa.indexOf("/")!==-1;var Na=pa.toUpperCase(),el=Ka===!0?ha.indexOf(Na):Ma.indexOf(Na);if(el!==-1)return aa.FileIndex[el];var fl=!Na.match(chr1);for(Na=Na.replace(chr0,""),fl&&(Na=Na.replace(chr1,"!")),el=0;el<ha.length;++el)if((fl?ha[el].replace(chr1,"!"):ha[el]).replace(chr0,"")==Na||(fl?Ma[el].replace(chr1,"!"):Ma[el]).replace(chr0,"")==Na)return aa.FileIndex[el];return null}var qa=64,tl=-2,ol="d0cf11e0a1b11ae1",hl=[208,207,17,224,161,177,26,225],wl="00000000000000000000000000000000",_l={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:tl,FREESECT:-1,HEADER_SIGNATURE:ol,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:wl,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function gl(aa,pa,ha){hn();var Ma=ga(aa,ha);cn.writeFileSync(pa,Ma)}function dl(aa){for(var pa=new Array(aa.length),ha=0;ha<aa.length;++ha)pa[ha]=String.fromCharCode(aa[ha]);return pa.join("")}function sl(aa,pa){var ha=ga(aa,pa);switch(pa&&pa.type||"buffer"){case"file":return hn(),cn.writeFileSync(pa.filename,ha),ha;case"binary":return typeof ha=="string"?ha:dl(ha);case"base64":return Base64_encode(typeof ha=="string"?ha:dl(ha));case"buffer":if(has_buf)return Buffer.isBuffer(ha)?ha:Buffer_from(ha);case"array":return typeof ha=="string"?s2a(ha):ha}return ha}var kl;function pl(aa){try{var pa=aa.InflateRaw,ha=new pa;if(ha._processChunk(new Uint8Array([3,0]),ha._finishFlushFlag),ha.bytesRead)kl=aa;else throw new Error("zlib does not expose bytesRead")}catch(Ma){console.error("cannot use native zlib: "+(Ma.message||Ma))}}function Al(aa,pa){if(!kl)return fc(aa,pa);var ha=kl.InflateRaw,Ma=new ha,Ka=Ma._processChunk(aa.slice(aa.l),Ma._finishFlushFlag);return aa.l+=Ma.bytesRead,Ka}function xl(aa){return kl?kl.deflateRawSync(aa):Jl(aa)}var al=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Fl=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],Ol=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function Jo(aa){var pa=(aa<<1|aa<<11)&139536|(aa<<5|aa<<15)&558144;return(pa>>16|pa>>8|pa)&255}for(var cl=typeof Uint8Array<"u",rl=cl?new Uint8Array(256):[],nl=0;nl<256;++nl)rl[nl]=Jo(nl);function vl(aa,pa){var ha=rl[aa&255];return pa<=8?ha>>>8-pa:(ha=ha<<8|rl[aa>>8&255],pa<=16?ha>>>16-pa:(ha=ha<<8|rl[aa>>16&255],ha>>>24-pa))}function Pl(aa,pa){var ha=pa&7,Ma=pa>>>3;return(aa[Ma]|(ha<=6?0:aa[Ma+1]<<8))>>>ha&3}function Sl(aa,pa){var ha=pa&7,Ma=pa>>>3;return(aa[Ma]|(ha<=5?0:aa[Ma+1]<<8))>>>ha&7}function El(aa,pa){var ha=pa&7,Ma=pa>>>3;return(aa[Ma]|(ha<=4?0:aa[Ma+1]<<8))>>>ha&15}function Il(aa,pa){var ha=pa&7,Ma=pa>>>3;return(aa[Ma]|(ha<=3?0:aa[Ma+1]<<8))>>>ha&31}function $l(aa,pa){var ha=pa&7,Ma=pa>>>3;return(aa[Ma]|(ha<=1?0:aa[Ma+1]<<8))>>>ha&127}function Ll(aa,pa,ha){var Ma=pa&7,Ka=pa>>>3,Na=(1<<ha)-1,el=aa[Ka]>>>Ma;return ha<8-Ma||(el|=aa[Ka+1]<<8-Ma,ha<16-Ma)||(el|=aa[Ka+2]<<16-Ma,ha<24-Ma)||(el|=aa[Ka+3]<<24-Ma),el&Na}function ml(aa,pa,ha){var Ma=pa&7,Ka=pa>>>3;return Ma<=5?aa[Ka]|=(ha&7)<<Ma:(aa[Ka]|=ha<<Ma&255,aa[Ka+1]=(ha&7)>>8-Ma),pa+3}function Vl(aa,pa,ha){var Ma=pa&7,Ka=pa>>>3;return ha=(ha&1)<<Ma,aa[Ka]|=ha,pa+1}function jl(aa,pa,ha){var Ma=pa&7,Ka=pa>>>3;return ha<<=Ma,aa[Ka]|=ha&255,ha>>>=8,aa[Ka+1]=ha,pa+8}function Xl(aa,pa,ha){var Ma=pa&7,Ka=pa>>>3;return ha<<=Ma,aa[Ka]|=ha&255,ha>>>=8,aa[Ka+1]=ha&255,aa[Ka+2]=ha>>>8,pa+16}function yl(aa,pa){var ha=aa.length,Ma=2*ha>pa?2*ha:pa+5,Ka=0;if(ha>=pa)return aa;if(has_buf){var Na=new_unsafe_buf(Ma);if(aa.copy)aa.copy(Na);else for(;Ka<aa.length;++Ka)Na[Ka]=aa[Ka];return Na}else if(cl){var el=new Uint8Array(Ma);if(el.set)el.set(aa);else for(;Ka<ha;++Ka)el[Ka]=aa[Ka];return el}return aa.length=Ma,aa}function Yl(aa){for(var pa=new Array(aa),ha=0;ha<aa;++ha)pa[ha]=0;return pa}function Rl(aa,pa,ha){var Ma=1,Ka=0,Na=0,el=0,fl=0,Ua=aa.length,il=cl?new Uint16Array(32):Yl(32);for(Na=0;Na<32;++Na)il[Na]=0;for(Na=Ua;Na<ha;++Na)aa[Na]=0;Ua=aa.length;var ll=cl?new Uint16Array(Ua):Yl(Ua);for(Na=0;Na<Ua;++Na)il[Ka=aa[Na]]++,Ma<Ka&&(Ma=Ka),ll[Na]=0;for(il[0]=0,Na=1;Na<=Ma;++Na)il[Na+16]=fl=fl+il[Na-1]<<1;for(Na=0;Na<Ua;++Na)fl=aa[Na],fl!=0&&(ll[Na]=il[fl+16]++);var Tl=0;for(Na=0;Na<Ua;++Na)if(Tl=aa[Na],Tl!=0)for(fl=vl(ll[Na],Ma)>>Ma-Tl,el=(1<<Ma+4-Tl)-1;el>=0;--el)pa[fl|el<<Tl]=Tl&15|Na<<4;return Ma}var Hl=cl?new Uint16Array(512):Yl(512),Wl=cl?new Uint16Array(32):Yl(32);if(!cl){for(var zl=0;zl<512;++zl)Hl[zl]=0;for(zl=0;zl<32;++zl)Wl[zl]=0}(function(){for(var aa=[],pa=0;pa<32;pa++)aa.push(5);Rl(aa,Wl,32);var ha=[];for(pa=0;pa<=143;pa++)ha.push(8);for(;pa<=255;pa++)ha.push(9);for(;pa<=279;pa++)ha.push(7);for(;pa<=287;pa++)ha.push(8);Rl(ha,Hl,288)})();var Gl=function(){for(var pa=cl?new Uint8Array(32768):[],ha=0,Ma=0;ha<Ol.length-1;++ha)for(;Ma<Ol[ha+1];++Ma)pa[Ma]=ha;for(;Ma<32768;++Ma)pa[Ma]=29;var Ka=cl?new Uint8Array(259):[];for(ha=0,Ma=0;ha<Fl.length-1;++ha)for(;Ma<Fl[ha+1];++Ma)Ka[Ma]=ha;function Na(fl,Ua){for(var il=0;il<fl.length;){var ll=Math.min(65535,fl.length-il),Tl=il+ll==fl.length;for(Ua.write_shift(1,+Tl),Ua.write_shift(2,ll),Ua.write_shift(2,~ll&65535);ll-- >0;)Ua[Ua.l++]=fl[il++]}return Ua.l}function el(fl,Ua){for(var il=0,ll=0,Tl=cl?new Uint16Array(32768):[];ll<fl.length;){var Dl=Math.min(65535,fl.length-ll);if(Dl<10){for(il=ml(Ua,il,+(ll+Dl==fl.length)),il&7&&(il+=8-(il&7)),Ua.l=il/8|0,Ua.write_shift(2,Dl),Ua.write_shift(2,~Dl&65535);Dl-- >0;)Ua[Ua.l++]=fl[ll++];il=Ua.l*8;continue}il=ml(Ua,il,+(ll+Dl==fl.length)+2);for(var Nl=0;Dl-- >0;){var bl=fl[ll];Nl=(Nl<<5^bl)&32767;var Cl=-1,Kl=0;if((Cl=Tl[Nl])&&(Cl|=ll&-32768,Cl>ll&&(Cl-=32768),Cl<ll))for(;fl[Cl+Kl]==fl[ll+Kl]&&Kl<250;)++Kl;if(Kl>2){bl=Ka[Kl],bl<=22?il=jl(Ua,il,rl[bl+1]>>1)-1:(jl(Ua,il,3),il+=5,jl(Ua,il,rl[bl-23]>>5),il+=3);var ul=bl<8?0:bl-4>>2;ul>0&&(Xl(Ua,il,Kl-Fl[bl]),il+=ul),bl=pa[ll-Cl],il=jl(Ua,il,rl[bl]>>3),il-=3;var Ml=bl<4?0:bl-2>>1;Ml>0&&(Xl(Ua,il,ll-Cl-Ol[bl]),il+=Ml);for(var Ul=0;Ul<Kl;++Ul)Tl[Nl]=ll&32767,Nl=(Nl<<5^fl[ll])&32767,++ll;Dl-=Kl-1}else bl<=143?bl=bl+48:il=Vl(Ua,il,1),il=jl(Ua,il,rl[bl]),Tl[Nl]=ll&32767,++ll}il=jl(Ua,il,0)-1}return Ua.l=(il+7)/8|0,Ua.l}return function(Ua,il){return Ua.length<8?Na(Ua,il):el(Ua,il)}}();function Jl(aa){var pa=new_buf(50+Math.floor(aa.length*1.1)),ha=Gl(aa,pa);return pa.slice(0,ha)}var ql=cl?new Uint16Array(32768):Yl(32768),Zl=cl?new Uint16Array(32768):Yl(32768),Ql=cl?new Uint16Array(128):Yl(128),ec=1,tc=1;function ac(aa,pa){var ha=Il(aa,pa)+257;pa+=5;var Ma=Il(aa,pa)+1;pa+=5;var Ka=El(aa,pa)+4;pa+=4;for(var Na=0,el=cl?new Uint8Array(19):Yl(19),fl=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Ua=1,il=cl?new Uint8Array(8):Yl(8),ll=cl?new Uint8Array(8):Yl(8),Tl=el.length,Dl=0;Dl<Ka;++Dl)el[al[Dl]]=Na=Sl(aa,pa),Ua<Na&&(Ua=Na),il[Na]++,pa+=3;var Nl=0;for(il[0]=0,Dl=1;Dl<=Ua;++Dl)ll[Dl]=Nl=Nl+il[Dl-1]<<1;for(Dl=0;Dl<Tl;++Dl)(Nl=el[Dl])!=0&&(fl[Dl]=ll[Nl]++);var bl=0;for(Dl=0;Dl<Tl;++Dl)if(bl=el[Dl],bl!=0){Nl=rl[fl[Dl]]>>8-bl;for(var Cl=(1<<7-bl)-1;Cl>=0;--Cl)Ql[Nl|Cl<<bl]=bl&7|Dl<<3}var Kl=[];for(Ua=1;Kl.length<ha+Ma;)switch(Nl=Ql[$l(aa,pa)],pa+=Nl&7,Nl>>>=3){case 16:for(Na=3+Pl(aa,pa),pa+=2,Nl=Kl[Kl.length-1];Na-- >0;)Kl.push(Nl);break;case 17:for(Na=3+Sl(aa,pa),pa+=3;Na-- >0;)Kl.push(0);break;case 18:for(Na=11+$l(aa,pa),pa+=7;Na-- >0;)Kl.push(0);break;default:Kl.push(Nl),Ua<Nl&&(Ua=Nl);break}var ul=Kl.slice(0,ha),Ml=Kl.slice(ha);for(Dl=ha;Dl<286;++Dl)ul[Dl]=0;for(Dl=Ma;Dl<30;++Dl)Ml[Dl]=0;return ec=Rl(ul,ql,286),tc=Rl(Ml,Zl,30),pa}function oc(aa,pa){if(aa[0]==3&&!(aa[1]&3))return[new_raw_buf(pa),2];for(var ha=0,Ma=0,Ka=new_unsafe_buf(pa||1<<18),Na=0,el=Ka.length>>>0,fl=0,Ua=0;(Ma&1)==0;){if(Ma=Sl(aa,ha),ha+=3,Ma>>>1)Ma>>1==1?(fl=9,Ua=5):(ha=ac(aa,ha),fl=ec,Ua=tc);else{ha&7&&(ha+=8-(ha&7));var il=aa[ha>>>3]|aa[(ha>>>3)+1]<<8;if(ha+=32,il>0)for(!pa&&el<Na+il&&(Ka=yl(Ka,Na+il),el=Ka.length);il-- >0;)Ka[Na++]=aa[ha>>>3],ha+=8;continue}for(;;){!pa&&el<Na+32767&&(Ka=yl(Ka,Na+32767),el=Ka.length);var ll=Ll(aa,ha,fl),Tl=Ma>>>1==1?Hl[ll]:ql[ll];if(ha+=Tl&15,Tl>>>=4,(Tl>>>8&255)===0)Ka[Na++]=Tl;else{if(Tl==256)break;Tl-=257;var Dl=Tl<8?0:Tl-4>>2;Dl>5&&(Dl=0);var Nl=Na+Fl[Tl];Dl>0&&(Nl+=Ll(aa,ha,Dl),ha+=Dl),ll=Ll(aa,ha,Ua),Tl=Ma>>>1==1?Wl[ll]:Zl[ll],ha+=Tl&15,Tl>>>=4;var bl=Tl<4?0:Tl-2>>1,Cl=Ol[Tl];for(bl>0&&(Cl+=Ll(aa,ha,bl),ha+=bl),!pa&&el<Nl&&(Ka=yl(Ka,Nl+100),el=Ka.length);Na<Nl;)Ka[Na]=Ka[Na-Cl],++Na}}}return pa?[Ka,ha+7>>>3]:[Ka.slice(0,Na),ha+7>>>3]}function fc(aa,pa){var ha=aa.slice(aa.l||0),Ma=oc(ha,pa);return aa.l+=Ma[1],Ma[0]}function yc(aa,pa){if(aa)typeof console<"u"&&console.error(pa);else throw new Error(pa)}function Cc(aa,pa){var ha=aa;prep_blob(ha,0);var Ma=[],Ka=[],Na={FileIndex:Ma,FullPaths:Ka};ca(Na,{root:pa.root});for(var el=ha.length-4;(ha[el]!=80||ha[el+1]!=75||ha[el+2]!=5||ha[el+3]!=6)&&el>=0;)--el;ha.l=el+4,ha.l+=4;var fl=ha.read_shift(2);ha.l+=6;var Ua=ha.read_shift(4);for(ha.l=Ua,el=0;el<fl;++el){ha.l+=20;var il=ha.read_shift(4),ll=ha.read_shift(4),Tl=ha.read_shift(2),Dl=ha.read_shift(2),Nl=ha.read_shift(2);ha.l+=8;var bl=ha.read_shift(4),Cl=ln(ha.slice(ha.l+Tl,ha.l+Tl+Dl));ha.l+=Tl+Dl+Nl;var Kl=ha.l;ha.l=bl+4,Cl&&Cl[1]&&((Cl[1]||{}).usz&&(ll=Cl[1].usz),(Cl[1]||{}).csz&&(il=Cl[1].csz)),pc(ha,il,ll,Na,Cl),ha.l=Kl}return Na}function pc(aa,pa,ha,Ma,Ka){aa.l+=2;var Na=aa.read_shift(2),el=aa.read_shift(2),fl=nn(aa);if(Na&8257)throw new Error("Unsupported ZIP encryption");for(var Ua=aa.read_shift(4),il=aa.read_shift(4),ll=aa.read_shift(4),Tl=aa.read_shift(2),Dl=aa.read_shift(2),Nl="",bl=0;bl<Tl;++bl)Nl+=String.fromCharCode(aa[aa.l++]);if(Dl){var Cl=ln(aa.slice(aa.l,aa.l+Dl));(Cl[21589]||{}).mt&&(fl=Cl[21589].mt),(Cl[1]||{}).usz&&(ll=Cl[1].usz),(Cl[1]||{}).csz&&(il=Cl[1].csz),Ka&&((Ka[21589]||{}).mt&&(fl=Ka[21589].mt),(Ka[1]||{}).usz&&(ll=Ka[1].usz),(Ka[1]||{}).csz&&(il=Ka[1].csz))}aa.l+=Dl;var Kl=aa.slice(aa.l,aa.l+il);switch(el){case 8:Kl=Al(aa,ll);break;case 0:aa.l+=il;break;default:throw new Error("Unsupported ZIP Compression method "+el)}var ul=!1;Na&8&&(Ua=aa.read_shift(4),Ua==134695760&&(Ua=aa.read_shift(4),ul=!0),il=aa.read_shift(4),ll=aa.read_shift(4)),il!=pa&&yc(ul,"Bad compressed size: "+pa+" != "+il),ll!=ha&&yc(ul,"Bad uncompressed size: "+ha+" != "+ll),ia(Ma,Nl,Kl,{unsafe:!0,mt:fl})}function xc(aa,pa){var ha=pa||{},Ma=[],Ka=[],Na=new_buf(1),el=ha.compression?8:0,fl=0,Ua=0,il=0,ll=0,Tl=0,Dl=aa.FullPaths[0],Nl=Dl,bl=aa.FileIndex[0],Cl=[],Kl=0;for(Ua=1;Ua<aa.FullPaths.length;++Ua)if(Nl=aa.FullPaths[Ua].slice(Dl.length),bl=aa.FileIndex[Ua],!(!bl.size||!bl.content||Array.isArray(bl.content)&&bl.content.length==0||Nl=="Sh33tJ5")){var ul=ll,Ml=new_buf(Nl.length);for(il=0;il<Nl.length;++il)Ml.write_shift(1,Nl.charCodeAt(il)&127);Ml=Ml.slice(0,Ml.l),Cl[Tl]=typeof bl.content=="string"?CRC32.bstr(bl.content,0):CRC32.buf(bl.content,0);var Ul=typeof bl.content=="string"?s2a(bl.content):bl.content;el==8&&(Ul=xl(Ul)),Na=new_buf(30),Na.write_shift(4,67324752),Na.write_shift(2,20),Na.write_shift(2,fl),Na.write_shift(2,el),bl.mt?Pi(Na,bl.mt):Na.write_shift(4,0),Na.write_shift(-4,Cl[Tl]),Na.write_shift(4,Ul.length),Na.write_shift(4,bl.content.length),Na.write_shift(2,Ml.length),Na.write_shift(2,0),ll+=Na.length,Ma.push(Na),ll+=Ml.length,Ma.push(Ml),ll+=Ul.length,Ma.push(Ul),Na=new_buf(46),Na.write_shift(4,33639248),Na.write_shift(2,0),Na.write_shift(2,20),Na.write_shift(2,fl),Na.write_shift(2,el),Na.write_shift(4,0),Na.write_shift(-4,Cl[Tl]),Na.write_shift(4,Ul.length),Na.write_shift(4,bl.content.length),Na.write_shift(2,Ml.length),Na.write_shift(2,0),Na.write_shift(2,0),Na.write_shift(2,0),Na.write_shift(2,0),Na.write_shift(4,0),Na.write_shift(4,ul),Kl+=Na.l,Ka.push(Na),Kl+=Ml.length,Ka.push(Ml),++Tl}return Na=new_buf(22),Na.write_shift(4,101010256),Na.write_shift(2,0),Na.write_shift(2,0),Na.write_shift(2,Tl),Na.write_shift(2,Tl),Na.write_shift(4,Kl),Na.write_shift(4,ll),Na.write_shift(2,0),bconcat([bconcat(Ma),bconcat(Ka),Na])}var bc={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function mc(aa,pa){if(aa.ctype)return aa.ctype;var ha=aa.name||"",Ma=ha.match(/\.([^\.]+)$/);return Ma&&bc[Ma[1]]||pa&&(Ma=(ha=pa).match(/[\.\\]([^\.\\])+$/),Ma&&bc[Ma[1]])?bc[Ma[1]]:"application/octet-stream"}function uc(aa){for(var pa=Base64_encode(aa),ha=[],Ma=0;Ma<pa.length;Ma+=76)ha.push(pa.slice(Ma,Ma+76));return ha.join(`\r
`)+`\r
`}function Sc(aa){var pa=aa.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(il){var ll=il.charCodeAt(0).toString(16).toUpperCase();return"="+(ll.length==1?"0"+ll:ll)});pa=pa.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),pa.charAt(0)==`
`&&(pa="=0D"+pa.slice(1)),pa=pa.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var ha=[],Ma=pa.split(`\r
`),Ka=0;Ka<Ma.length;++Ka){var Na=Ma[Ka];if(Na.length==0){ha.push("");continue}for(var el=0;el<Na.length;){var fl=76,Ua=Na.slice(el,el+fl);Ua.charAt(fl-1)=="="?fl--:Ua.charAt(fl-2)=="="?fl-=2:Ua.charAt(fl-3)=="="&&(fl-=3),Ua=Na.slice(el,el+fl),el+=fl,el<Na.length&&(Ua+="="),ha.push(Ua)}}return ha.join(`\r
`)}function sa(aa){for(var pa=[],ha=0;ha<aa.length;++ha){for(var Ma=aa[ha];ha<=aa.length&&Ma.charAt(Ma.length-1)=="=";)Ma=Ma.slice(0,Ma.length-1)+aa[++ha];pa.push(Ma)}for(var Ka=0;Ka<pa.length;++Ka)pa[Ka]=pa[Ka].replace(/[=][0-9A-Fa-f]{2}/g,function(Na){return String.fromCharCode(parseInt(Na.slice(1),16))});return s2a(pa.join(`\r
`))}function bs(aa,pa,ha){for(var Ma="",Ka="",Na="",el,fl=0;fl<10;++fl){var Ua=pa[fl];if(!Ua||Ua.match(/^\s*$/))break;var il=Ua.match(/^([^:]*?):\s*([^\s].*)$/);if(il)switch(il[1].toLowerCase()){case"content-location":Ma=il[2].trim();break;case"content-type":Na=il[2].trim();break;case"content-transfer-encoding":Ka=il[2].trim();break}}switch(++fl,Ka.toLowerCase()){case"base64":el=s2a(Base64_decode(pa.slice(fl).join("")));break;case"quoted-printable":el=sa(pa.slice(fl));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+Ka)}var ll=ia(aa,Ma.slice(ha.length),el,{unsafe:!0});Na&&(ll.ctype=Na)}function xs(aa,pa){if(dl(aa.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var ha=pa&&pa.root||"",Ma=(has_buf&&Buffer.isBuffer(aa)?aa.toString("binary"):dl(aa)).split(`\r
`),Ka=0,Na="";for(Ka=0;Ka<Ma.length;++Ka)if(Na=Ma[Ka],!!/^Content-Location:/i.test(Na)&&(Na=Na.slice(Na.indexOf("file")),ha||(ha=Na.slice(0,Na.lastIndexOf("/")+1)),Na.slice(0,ha.length)!=ha))for(;ha.length>0&&(ha=ha.slice(0,ha.length-1),ha=ha.slice(0,ha.lastIndexOf("/")+1),Na.slice(0,ha.length)!=ha););var el=(Ma[1]||"").match(/boundary="(.*?)"/);if(!el)throw new Error("MAD cannot find boundary");var fl="--"+(el[1]||""),Ua=[],il=[],ll={FileIndex:Ua,FullPaths:il};ca(ll);var Tl,Dl=0;for(Ka=0;Ka<Ma.length;++Ka){var Nl=Ma[Ka];Nl!==fl&&Nl!==fl+"--"||(Dl++&&bs(ll,Ma.slice(Tl,Ka),ha),Tl=Ka)}return ll}function Kn(aa,pa){var ha=pa||{},Ma=ha.boundary||"SheetJS";Ma="------="+Ma;for(var Ka=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+Ma.slice(2)+'"',"","",""],Na=aa.FullPaths[0],el=Na,fl=aa.FileIndex[0],Ua=1;Ua<aa.FullPaths.length;++Ua)if(el=aa.FullPaths[Ua].slice(Na.length),fl=aa.FileIndex[Ua],!(!fl.size||!fl.content||el=="Sh33tJ5")){el=el.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(Kl){return"_x"+Kl.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(Kl){return"_u"+Kl.charCodeAt(0).toString(16)+"_"});for(var il=fl.content,ll=has_buf&&Buffer.isBuffer(il)?il.toString("binary"):dl(il),Tl=0,Dl=Math.min(1024,ll.length),Nl=0,bl=0;bl<=Dl;++bl)(Nl=ll.charCodeAt(bl))>=32&&Nl<128&&++Tl;var Cl=Tl>=Dl*4/5;Ka.push(Ma),Ka.push("Content-Location: "+(ha.root||"file:///C:/SheetJS/")+el),Ka.push("Content-Transfer-Encoding: "+(Cl?"quoted-printable":"base64")),Ka.push("Content-Type: "+mc(fl,el)),Ka.push(""),Ka.push(Cl?Sc(ll):uc(ll))}return Ka.push(Ma+`--\r
`),Ka.join(`\r
`)}function Cs(aa){var pa={};return ca(pa,aa),pa}function ia(aa,pa,ha,Ma){var Ka=Ma&&Ma.unsafe;Ka||ca(aa);var Na=!Ka&&CFB.find(aa,pa);if(!Na){var el=aa.FullPaths[0];pa.slice(0,el.length)==el?el=pa:(el.slice(-1)!="/"&&(el+="/"),el=(el+pa).replace("//","/")),Na={name:Qe(pa),type:2},aa.FileIndex.push(Na),aa.FullPaths.push(el),Ka||CFB.utils.cfb_gc(aa)}return Na.content=ha,Na.size=ha?ha.length:0,Ma&&(Ma.CLSID&&(Na.clsid=Ma.CLSID),Ma.mt&&(Na.mt=Ma.mt),Ma.ct&&(Na.ct=Ma.ct)),Na}function Za(aa,pa){ca(aa);var ha=CFB.find(aa,pa);if(ha){for(var Ma=0;Ma<aa.FileIndex.length;++Ma)if(aa.FileIndex[Ma]==ha)return aa.FileIndex.splice(Ma,1),aa.FullPaths.splice(Ma,1),!0}return!1}function Ja(aa,pa,ha){ca(aa);var Ma=CFB.find(aa,pa);if(Ma){for(var Ka=0;Ka<aa.FileIndex.length;++Ka)if(aa.FileIndex[Ka]==Ma)return aa.FileIndex[Ka].name=Qe(ha),aa.FullPaths[Ka]=ha,!0}return!1}function Qa(aa){ua(aa,!0)}return f.find=da,f.read=fa,f.parse=un,f.write=sl,f.writeFile=gl,f.utils={cfb_new:Cs,cfb_add:ia,cfb_del:Za,cfb_mov:Ja,cfb_gc:Qa,ReadShift,CheckField,prep_blob,bconcat,use_zlib:pl,_deflateRaw:Jl,_inflateRaw:fc,consts:_l},f}(),_fs;function blobify(qe){return typeof qe=="string"?s2ab(qe):Array.isArray(qe)?a2u(qe):qe}function write_dl(qe,f,ze){if(typeof Deno<"u"){if(ze&&typeof f=="string")switch(ze){case"utf8":f=new TextEncoder(ze).encode(f);break;case"binary":f=s2ab(f);break;default:throw new Error("Unsupported encoding "+ze)}return Deno.writeFileSync(qe,f)}var Ke=ze=="utf8"?utf8write(f):f;if(typeof IE_SaveFile<"u")return IE_SaveFile(Ke,qe);if(typeof Blob<"u"){var Qe=new Blob([blobify(Ke)],{type:"application/octet-stream"});if(typeof navigator<"u"&&navigator.msSaveBlob)return navigator.msSaveBlob(Qe,qe);if(typeof saveAs<"u")return saveAs(Qe,qe);if(typeof URL<"u"&&typeof document<"u"&&document.createElement&&URL.createObjectURL){var Pi=URL.createObjectURL(Qe);if(typeof chrome=="object"&&typeof(chrome.downloads||{}).download=="function")return URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(Pi)},6e4),chrome.downloads.download({url:Pi,filename:qe,saveAs:!0});var nn=document.createElement("a");if(nn.download!=null)return nn.download=qe,nn.href=Pi,document.body.appendChild(nn),nn.click(),document.body.removeChild(nn),URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(Pi)},6e4),Pi}else if(typeof URL<"u"&&!URL.createObjectURL&&typeof chrome=="object"){var ln="data:application/octet-stream;base64,"+Base64_encode_arr(new Uint8Array(blobify(Ke)));return chrome.downloads.download({url:ln,filename:qe,saveAs:!0})}}if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var cn=File(qe);return cn.open("w"),cn.encoding="binary",Array.isArray(f)&&(f=a2s(f)),cn.write(f),cn.close(),f}catch(hn){if(!hn.message||hn.message.indexOf("onstruct")==-1)throw hn}throw new Error("cannot save file "+qe)}function keys(qe){for(var f=Object.keys(qe),ze=[],Ke=0;Ke<f.length;++Ke)Object.prototype.hasOwnProperty.call(qe,f[Ke])&&ze.push(f[Ke]);return ze}function evert_key(qe,f){for(var ze=[],Ke=keys(qe),Qe=0;Qe!==Ke.length;++Qe)ze[qe[Ke[Qe]][f]]==null&&(ze[qe[Ke[Qe]][f]]=Ke[Qe]);return ze}function evert(qe){for(var f=[],ze=keys(qe),Ke=0;Ke!==ze.length;++Ke)f[qe[ze[Ke]]]=ze[Ke];return f}function evert_num(qe){for(var f=[],ze=keys(qe),Ke=0;Ke!==ze.length;++Ke)f[qe[ze[Ke]]]=parseInt(ze[Ke],10);return f}function evert_arr(qe){for(var f=[],ze=keys(qe),Ke=0;Ke!==ze.length;++Ke)f[qe[ze[Ke]]]==null&&(f[qe[ze[Ke]]]=[]),f[qe[ze[Ke]]].push(ze[Ke]);return f}var dnthresh=Date.UTC(1899,11,30,0,0,0),dnthresh1=Date.UTC(1899,11,31,0,0,0),dnthresh2=Date.UTC(1904,0,1,0,0,0);function datenum(qe,f){var ze=qe.getTime(),Ke=(ze-dnthresh)/(24*60*60*1e3);return f?(Ke-=1462,Ke<-1402?Ke-1:Ke):Ke<60?Ke-1:Ke}function numdate(qe){if(qe>=60&&qe<61)return qe;var f=new Date;return f.setTime((qe>60?qe:qe+1)*24*60*60*1e3+dnthresh),f}var pdre1=/^(\d+):(\d+)(:\d+)?(\.\d+)?$/,pdre2=/^(\d+)-(\d+)-(\d+)$/,pdre3=/^(\d+)-(\d+)-(\d+)[T ](\d+):(\d+)(:\d+)?(\.\d+)?$/;function parseDate(qe,f){if(qe instanceof Date)return qe;var ze=qe.match(pdre1);if(ze)return new Date((f?dnthresh2:dnthresh1)+((parseInt(ze[1],10)*60+parseInt(ze[2],10))*60+(ze[3]?parseInt(ze[3].slice(1),10):0))*1e3+(ze[4]?parseInt((ze[4]+"000").slice(1,4),10):0));if(ze=qe.match(pdre2),ze)return new Date(Date.UTC(+ze[1],+ze[2]-1,+ze[3],0,0,0,0));if(ze=qe.match(pdre3),ze)return new Date(Date.UTC(+ze[1],+ze[2]-1,+ze[3],+ze[4],+ze[5],ze[6]&&parseInt(ze[6].slice(1),10)||0,ze[7]&&parseInt((ze[7]+"0000").slice(1,4),10)||0));var Ke=new Date(qe);return Ke}function cc2str(qe,f){if(has_buf&&Buffer.isBuffer(qe))return qe.toString("binary");if(typeof TextDecoder<"u")try{var ze={"":"","":"",:"","":"","":"","":"","":"","":"","":"",:"","":"",:"",:"","":"","":"","":"","":"","":"","":"","":"","":"","":"",:"","":"",:"",:"",:""};return Array.isArray(qe)&&(qe=new Uint8Array(qe)),new TextDecoder("latin1").decode(qe).replace(/[]/g,function(Pi){return ze[Pi]||Pi})}catch{}var Ke=[],Qe=0;try{for(Qe=0;Qe<qe.length-65536;Qe+=65536)Ke.push(String.fromCharCode.apply(0,qe.slice(Qe,Qe+65536)));Ke.push(String.fromCharCode.apply(0,qe.slice(Qe)))}catch{try{for(;Qe<qe.length-16384;Qe+=16384)Ke.push(String.fromCharCode.apply(0,qe.slice(Qe,Qe+16384)));Ke.push(String.fromCharCode.apply(0,qe.slice(Qe)))}catch{for(;Qe!=qe.length;++Qe)Ke.push(String.fromCharCode(qe[Qe]))}}return Ke.join("")}function dup(qe){if(typeof JSON<"u"&&!Array.isArray(qe))return JSON.parse(JSON.stringify(qe));if(typeof qe!="object"||qe==null)return qe;if(qe instanceof Date)return new Date(qe.getTime());var f={};for(var ze in qe)Object.prototype.hasOwnProperty.call(qe,ze)&&(f[ze]=dup(qe[ze]));return f}function fill$1(qe,f){for(var ze="";ze.length<f;)ze+=qe;return ze}function fuzzynum(qe){var f=Number(qe);if(!isNaN(f))return isFinite(f)?f:NaN;if(!/\d/.test(qe))return f;var ze=1,Ke=qe.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return ze*=100,""});return!isNaN(f=Number(Ke))||(Ke=Ke.replace(/[(]([^()]*)[)]/,function(Qe,Pi){return ze=-ze,Pi}),!isNaN(f=Number(Ke)))?f/ze:f}var FDRE1=/^(0?\d|1[0-2])(?:|:([0-5]?\d)(?:|(\.\d+)(?:|:([0-5]?\d))|:([0-5]?\d)(|\.\d+)))\s+([ap])m?$/,FDRE2=/^([01]?\d|2[0-3])(?:|:([0-5]?\d)(?:|(\.\d+)(?:|:([0-5]?\d))|:([0-5]?\d)(|\.\d+)))$/,FDISO=/^(\d+)-(\d+)-(\d+)[T ](\d+):(\d+)(:\d+)(\.\d+)?[Z]?$/,utc_append_works=new Date("6/9/69 00:00 UTC").valueOf()==-177984e5;function fuzzytime1(qe){return qe[2]?qe[3]?qe[4]?new Date(Date.UTC(1899,11,31,+qe[1]%12+(qe[7]=="p"?12:0),+qe[2],+qe[4],parseFloat(qe[3])*1e3)):new Date(Date.UTC(1899,11,31,qe[7]=="p"?12:0,+qe[1],+qe[2],parseFloat(qe[3])*1e3)):qe[5]?new Date(Date.UTC(1899,11,31,+qe[1]%12+(qe[7]=="p"?12:0),+qe[2],+qe[5],qe[6]?parseFloat(qe[6])*1e3:0)):new Date(Date.UTC(1899,11,31,+qe[1]%12+(qe[7]=="p"?12:0),+qe[2],0,0)):new Date(Date.UTC(1899,11,31,+qe[1]%12+(qe[7]=="p"?12:0),0,0,0))}function fuzzytime2(qe){return qe[2]?qe[3]?qe[4]?new Date(Date.UTC(1899,11,31,+qe[1],+qe[2],+qe[4],parseFloat(qe[3])*1e3)):new Date(Date.UTC(1899,11,31,0,+qe[1],+qe[2],parseFloat(qe[3])*1e3)):qe[5]?new Date(Date.UTC(1899,11,31,+qe[1],+qe[2],+qe[5],qe[6]?parseFloat(qe[6])*1e3:0)):new Date(Date.UTC(1899,11,31,+qe[1],+qe[2],0,0)):new Date(Date.UTC(1899,11,31,+qe[1],0,0,0))}var lower_months=["january","february","march","april","may","june","july","august","september","october","november","december"];function fuzzydate(qe){if(FDISO.test(qe))return qe.indexOf("Z")==-1?local_to_utc(new Date(qe)):new Date(qe);var f=qe.toLowerCase(),ze=f.replace(/\s+/g," ").trim(),Ke=ze.match(FDRE1);if(Ke)return fuzzytime1(Ke);if(Ke=ze.match(FDRE2),Ke)return fuzzytime2(Ke);if(Ke=ze.match(pdre3),Ke)return new Date(Date.UTC(+Ke[1],+Ke[2]-1,+Ke[3],+Ke[4],+Ke[5],Ke[6]&&parseInt(Ke[6].slice(1),10)||0,Ke[7]&&parseInt((Ke[7]+"0000").slice(1,4),10)||0));var Qe=new Date(utc_append_works&&qe.indexOf("UTC")==-1?qe+" UTC":qe),Pi=new Date(NaN),nn=Qe.getYear();Qe.getMonth();var ln=Qe.getDate();if(isNaN(ln))return Pi;if(f.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(f=f.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),f.length>3&&lower_months.indexOf(f)==-1)return Pi}else if(f.replace(/[ap]m?/,"").match(/[a-z]/))return Pi;return nn<0||nn>8099||qe.match(/[^-0-9:,\/\\\ ]/)?Pi:Qe}function utc_to_local(qe){return new Date(qe.getUTCFullYear(),qe.getUTCMonth(),qe.getUTCDate(),qe.getUTCHours(),qe.getUTCMinutes(),qe.getUTCSeconds(),qe.getUTCMilliseconds())}function local_to_utc(qe){return new Date(Date.UTC(qe.getFullYear(),qe.getMonth(),qe.getDate(),qe.getHours(),qe.getMinutes(),qe.getSeconds(),qe.getMilliseconds()))}function zip_add_file(qe,f,ze){if(qe.FullPaths){if(Array.isArray(ze)&&typeof ze[0]=="string"&&(ze=ze.join("")),typeof ze=="string"){var Ke;return has_buf?Ke=Buffer_from(ze):Ke=utf8decode(ze),CFB.utils.cfb_add(qe,f,Ke)}CFB.utils.cfb_add(qe,f,ze)}else qe.file(f,ze)}function zip_new(){return CFB.utils.cfb_new()}var XML_HEADER=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,encodings={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},rencoding=evert(encodings),decregex=/[&<>'"]/g,charegex=/[\u0000-\u0008\u000b-\u001f\uFFFE-\uFFFF]/g;function escapexml(qe){var f=qe+"";return f.replace(decregex,function(ze){return rencoding[ze]}).replace(charegex,function(ze){return"_x"+("000"+ze.charCodeAt(0).toString(16)).slice(-4)+"_"})}function escapexmltag(qe){return escapexml(qe).replace(/ /g,"_x0020_")}var htmlcharegex=/[\u0000-\u001f]/g;function escapehtml(qe){var f=qe+"";return f.replace(decregex,function(ze){return rencoding[ze]}).replace(/\n/g,"<br/>").replace(htmlcharegex,function(ze){return"&#x"+("000"+ze.charCodeAt(0).toString(16)).slice(-4)+";"})}function escapexlml(qe){var f=qe+"";return f.replace(decregex,function(ze){return rencoding[ze]}).replace(htmlcharegex,function(ze){return"&#x"+ze.charCodeAt(0).toString(16).toUpperCase()+";"})}function xlml_unfixstr(qe){return qe.replace(/(\r\n|[\r\n])/g,"&#10;")}function parsexmlbool(qe){switch(qe){case 1:case!0:case"1":case"true":return!0;case 0:case!1:case"0":case"false":return!1}return!1}function utf8reada(qe){for(var f="",ze=0,Ke=0,Qe=0,Pi=0,nn=0,ln=0;ze<qe.length;){if(Ke=qe.charCodeAt(ze++),Ke<128){f+=String.fromCharCode(Ke);continue}if(Qe=qe.charCodeAt(ze++),Ke>191&&Ke<224){nn=(Ke&31)<<6,nn|=Qe&63,f+=String.fromCharCode(nn);continue}if(Pi=qe.charCodeAt(ze++),Ke<240){f+=String.fromCharCode((Ke&15)<<12|(Qe&63)<<6|Pi&63);continue}nn=qe.charCodeAt(ze++),ln=((Ke&7)<<18|(Qe&63)<<12|(Pi&63)<<6|nn&63)-65536,f+=String.fromCharCode(55296+(ln>>>10&1023)),f+=String.fromCharCode(56320+(ln&1023))}return f}function utf8readb(qe){var f=new_raw_buf(2*qe.length),ze,Ke,Qe=1,Pi=0,nn=0,ln;for(Ke=0;Ke<qe.length;Ke+=Qe)Qe=1,(ln=qe.charCodeAt(Ke))<128?ze=ln:ln<224?(ze=(ln&31)*64+(qe.charCodeAt(Ke+1)&63),Qe=2):ln<240?(ze=(ln&15)*4096+(qe.charCodeAt(Ke+1)&63)*64+(qe.charCodeAt(Ke+2)&63),Qe=3):(Qe=4,ze=(ln&7)*262144+(qe.charCodeAt(Ke+1)&63)*4096+(qe.charCodeAt(Ke+2)&63)*64+(qe.charCodeAt(Ke+3)&63),ze-=65536,nn=55296+(ze>>>10&1023),ze=56320+(ze&1023)),nn!==0&&(f[Pi++]=nn&255,f[Pi++]=nn>>>8,nn=0),f[Pi++]=ze%256,f[Pi++]=ze>>>8;return f.slice(0,Pi).toString("ucs2")}function utf8readc(qe){return Buffer_from(qe,"binary").toString("utf8")}var utf8corpus="foo bar baz",utf8read=has_buf&&(utf8readc(utf8corpus)==utf8reada(utf8corpus)&&utf8readc||utf8readb(utf8corpus)==utf8reada(utf8corpus)&&utf8readb)||utf8reada,utf8write=has_buf?function(qe){return Buffer_from(qe,"utf8").toString("binary")}:function(qe){for(var f=[],ze=0,Ke=0,Qe=0;ze<qe.length;)switch(Ke=qe.charCodeAt(ze++),!0){case Ke<128:f.push(String.fromCharCode(Ke));break;case Ke<2048:f.push(String.fromCharCode(192+(Ke>>6))),f.push(String.fromCharCode(128+(Ke&63)));break;case(Ke>=55296&&Ke<57344):Ke-=55296,Qe=qe.charCodeAt(ze++)-56320+(Ke<<10),f.push(String.fromCharCode(240+(Qe>>18&7))),f.push(String.fromCharCode(144+(Qe>>12&63))),f.push(String.fromCharCode(128+(Qe>>6&63))),f.push(String.fromCharCode(128+(Qe&63)));break;default:f.push(String.fromCharCode(224+(Ke>>12))),f.push(String.fromCharCode(128+(Ke>>6&63))),f.push(String.fromCharCode(128+(Ke&63)))}return f.join("")},htmldecode=function(){var qe=[["nbsp"," "],["middot",""],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(f){return[new RegExp("&"+f[0]+";","ig"),f[1]]});return function(ze){for(var Ke=ze.replace(/^[\t\n\r ]+/,"").replace(/(^|[^\t\n\r ])[\t\n\r ]+$/,"$1").replace(/>\s+/g,">").replace(/\b\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^<>]*>/g,""),Qe=0;Qe<qe.length;++Qe)Ke=Ke.replace(qe[Qe][0],qe[Qe][1]);return Ke}}(),wtregex=/(^\s|\s$|\n)/;function writetag(qe,f){return"<"+qe+(f.match(wtregex)?' xml:space="preserve"':"")+">"+f+"</"+qe+">"}function wxt_helper(qe){return keys(qe).map(function(f){return" "+f+'="'+qe[f]+'"'}).join("")}function writextag(qe,f,ze){return"<"+qe+(ze!=null?wxt_helper(ze):"")+(f!=null?(f.match(wtregex)?' xml:space="preserve"':"")+">"+f+"</"+qe:"/")+">"}function write_w3cdtf(qe,f){try{return qe.toISOString().replace(/\.\d*/,"")}catch(ze){if(f)throw ze}return""}function write_vt(qe,f){switch(typeof qe){case"string":var ze=writextag("vt:lpwstr",escapexml(qe));return ze=ze.replace(/&quot;/g,"_x0022_"),ze;case"number":return writextag((qe|0)==qe?"vt:i4":"vt:r8",escapexml(String(qe)));case"boolean":return writextag("vt:bool",qe?"true":"false")}if(qe instanceof Date)return writextag("vt:filetime",write_w3cdtf(qe));throw new Error("Unable to serialize "+qe)}var XMLNS={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},XMLNS_main=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],XLMLNS={o:"urn:schemas-microsoft-com:office:office",x:"urn:schemas-microsoft-com:office:excel",ss:"urn:schemas-microsoft-com:office:spreadsheet",dt:"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",mv:"http://macVmlSchemaUri",v:"urn:schemas-microsoft-com:vml",html:"http://www.w3.org/TR/REC-html40"};function read_double_le(qe,f){for(var ze=1-2*(qe[f+7]>>>7),Ke=((qe[f+7]&127)<<4)+(qe[f+6]>>>4&15),Qe=qe[f+6]&15,Pi=5;Pi>=0;--Pi)Qe=Qe*256+qe[f+Pi];return Ke==2047?Qe==0?ze*(1/0):NaN:(Ke==0?Ke=-1022:(Ke-=1023,Qe+=Math.pow(2,52)),ze*Math.pow(2,Ke-52)*Qe)}function write_double_le(qe,f,ze){var Ke=(f<0||1/f==-1/0?1:0)<<7,Qe=0,Pi=0,nn=Ke?-f:f;isFinite(nn)?nn==0?Qe=Pi=0:(Qe=Math.floor(Math.log(nn)/Math.LN2),Pi=nn*Math.pow(2,52-Qe),Qe<=-1023&&(!isFinite(Pi)||Pi<Math.pow(2,52))?Qe=-1022:(Pi-=Math.pow(2,52),Qe+=1023)):(Qe=2047,Pi=isNaN(f)?26985:0);for(var ln=0;ln<=5;++ln,Pi/=256)qe[ze+ln]=Pi&255;qe[ze+6]=(Qe&15)<<4|Pi&15,qe[ze+7]=Qe>>4|Ke}var ___toBuffer=function(qe){for(var f=[],ze=10240,Ke=0;Ke<qe[0].length;++Ke)if(qe[0][Ke])for(var Qe=0,Pi=qe[0][Ke].length;Qe<Pi;Qe+=ze)f.push.apply(f,qe[0][Ke].slice(Qe,Qe+ze));return f},__toBuffer=has_buf?function(qe){return qe[0].length>0&&Buffer.isBuffer(qe[0][0])?Buffer.concat(qe[0].map(function(f){return Buffer.isBuffer(f)?f:Buffer_from(f)})):___toBuffer(qe)}:___toBuffer,___utf16le=function(qe,f,ze){for(var Ke=[],Qe=f;Qe<ze;Qe+=2)Ke.push(String.fromCharCode(__readUInt16LE(qe,Qe)));return Ke.join("").replace(chr0,"")},__utf16le=has_buf?function(qe,f,ze){return!Buffer.isBuffer(qe)||!buf_utf16le?___utf16le(qe,f,ze):qe.toString("utf16le",f,ze).replace(chr0,"")}:___utf16le,___hexlify=function(qe,f,ze){for(var Ke=[],Qe=f;Qe<f+ze;++Qe)Ke.push(("0"+qe[Qe].toString(16)).slice(-2));return Ke.join("")},__hexlify=has_buf?function(qe,f,ze){return Buffer.isBuffer(qe)?qe.toString("hex",f,f+ze):___hexlify(qe,f,ze)}:___hexlify,___utf8=function(qe,f,ze){for(var Ke=[],Qe=f;Qe<ze;Qe++)Ke.push(String.fromCharCode(__readUInt8(qe,Qe)));return Ke.join("")},__utf8=has_buf?function(f,ze,Ke){return Buffer.isBuffer(f)?f.toString("utf8",ze,Ke):___utf8(f,ze,Ke)}:___utf8,___lpstr=function(qe,f){var ze=__readUInt32LE(qe,f);return ze>0?__utf8(qe,f+4,f+4+ze-1):""},__lpstr=___lpstr,___cpstr=function(qe,f){var ze=__readUInt32LE(qe,f);return ze>0?__utf8(qe,f+4,f+4+ze-1):""},__cpstr=___cpstr,___lpwstr=function(qe,f){var ze=2*__readUInt32LE(qe,f);return ze>0?__utf8(qe,f+4,f+4+ze-1):""},__lpwstr=___lpwstr,___lpp4=function(f,ze){var Ke=__readUInt32LE(f,ze);return Ke>0?__utf16le(f,ze+4,ze+4+Ke):""},__lpp4=___lpp4,___8lpp4=function(qe,f){var ze=__readUInt32LE(qe,f);return ze>0?__utf8(qe,f+4,f+4+ze):""},__8lpp4=___8lpp4,___double=function(qe,f){return read_double_le(qe,f)},__double=___double,is_buf=function(f){return Array.isArray(f)||typeof Uint8Array<"u"&&f instanceof Uint8Array};has_buf&&(__lpstr=function(f,ze){if(!Buffer.isBuffer(f))return ___lpstr(f,ze);var Ke=f.readUInt32LE(ze);return Ke>0?f.toString("utf8",ze+4,ze+4+Ke-1):""},__cpstr=function(f,ze){if(!Buffer.isBuffer(f))return ___cpstr(f,ze);var Ke=f.readUInt32LE(ze);return Ke>0?f.toString("utf8",ze+4,ze+4+Ke-1):""},__lpwstr=function(f,ze){if(!Buffer.isBuffer(f)||!buf_utf16le)return ___lpwstr(f,ze);var Ke=2*f.readUInt32LE(ze);return f.toString("utf16le",ze+4,ze+4+Ke-1)},__lpp4=function(f,ze){if(!Buffer.isBuffer(f)||!buf_utf16le)return ___lpp4(f,ze);var Ke=f.readUInt32LE(ze);return f.toString("utf16le",ze+4,ze+4+Ke)},__8lpp4=function(f,ze){if(!Buffer.isBuffer(f))return ___8lpp4(f,ze);var Ke=f.readUInt32LE(ze);return f.toString("utf8",ze+4,ze+4+Ke)},__double=function(f,ze){return Buffer.isBuffer(f)?f.readDoubleLE(ze):___double(f,ze)},is_buf=function(f){return Buffer.isBuffer(f)||Array.isArray(f)||typeof Uint8Array<"u"&&f instanceof Uint8Array});var __readUInt8=function(qe,f){return qe[f]},__readUInt16LE=function(qe,f){return qe[f+1]*256+qe[f]},__readInt16LE=function(qe,f){var ze=qe[f+1]*256+qe[f];return ze<32768?ze:(65535-ze+1)*-1},__readUInt32LE=function(qe,f){return qe[f+3]*(1<<24)+(qe[f+2]<<16)+(qe[f+1]<<8)+qe[f]},__readInt32LE=function(qe,f){return qe[f+3]<<24|qe[f+2]<<16|qe[f+1]<<8|qe[f]},__readInt32BE=function(qe,f){return qe[f]<<24|qe[f+1]<<16|qe[f+2]<<8|qe[f+3]};function ReadShift(qe,f){var ze="",Ke,Qe,Pi=[],nn,ln,cn,hn;switch(f){case"dbcs":if(hn=this.l,has_buf&&Buffer.isBuffer(this)&&buf_utf16le)ze=this.slice(this.l,this.l+2*qe).toString("utf16le");else for(cn=0;cn<qe;++cn)ze+=String.fromCharCode(__readUInt16LE(this,hn)),hn+=2;qe*=2;break;case"utf8":ze=__utf8(this,this.l,this.l+qe);break;case"utf16le":qe*=2,ze=__utf16le(this,this.l,this.l+qe);break;case"wstr":return ReadShift.call(this,qe,"dbcs");case"lpstr-ansi":ze=__lpstr(this,this.l),qe=4+__readUInt32LE(this,this.l);break;case"lpstr-cp":ze=__cpstr(this,this.l),qe=4+__readUInt32LE(this,this.l);break;case"lpwstr":ze=__lpwstr(this,this.l),qe=4+2*__readUInt32LE(this,this.l);break;case"lpp4":qe=4+__readUInt32LE(this,this.l),ze=__lpp4(this,this.l),qe&2&&(qe+=2);break;case"8lpp4":qe=4+__readUInt32LE(this,this.l),ze=__8lpp4(this,this.l),qe&3&&(qe+=4-(qe&3));break;case"cstr":for(qe=0,ze="";(nn=__readUInt8(this,this.l+qe++))!==0;)Pi.push(_getchar(nn));ze=Pi.join("");break;case"_wstr":for(qe=0,ze="";(nn=__readUInt16LE(this,this.l+qe))!==0;)Pi.push(_getchar(nn)),qe+=2;qe+=2,ze=Pi.join("");break;case"dbcs-cont":for(ze="",hn=this.l,cn=0;cn<qe;++cn){if(this.lens&&this.lens.indexOf(hn)!==-1)return nn=__readUInt8(this,hn),this.l=hn+1,ln=ReadShift.call(this,qe-cn,nn?"dbcs-cont":"sbcs-cont"),Pi.join("")+ln;Pi.push(_getchar(__readUInt16LE(this,hn))),hn+=2}ze=Pi.join(""),qe*=2;break;case"cpstr":case"sbcs-cont":for(ze="",hn=this.l,cn=0;cn!=qe;++cn){if(this.lens&&this.lens.indexOf(hn)!==-1)return nn=__readUInt8(this,hn),this.l=hn+1,ln=ReadShift.call(this,qe-cn,nn?"dbcs-cont":"sbcs-cont"),Pi.join("")+ln;Pi.push(_getchar(__readUInt8(this,hn))),hn+=1}ze=Pi.join("");break;default:switch(qe){case 1:return Ke=__readUInt8(this,this.l),this.l++,Ke;case 2:return Ke=(f==="i"?__readInt16LE:__readUInt16LE)(this,this.l),this.l+=2,Ke;case 4:case-4:return f==="i"||(this[this.l+3]&128)===0?(Ke=(qe>0?__readInt32LE:__readInt32BE)(this,this.l),this.l+=4,Ke):(Qe=__readUInt32LE(this,this.l),this.l+=4,Qe);case 8:case-8:if(f==="f")return qe==8?Qe=__double(this,this.l):Qe=__double([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,Qe;qe=8;case 16:ze=__hexlify(this,this.l,qe);break}}return this.l+=qe,ze}var __writeUInt32LE=function(qe,f,ze){qe[ze]=f&255,qe[ze+1]=f>>>8&255,qe[ze+2]=f>>>16&255,qe[ze+3]=f>>>24&255},__writeInt32LE=function(qe,f,ze){qe[ze]=f&255,qe[ze+1]=f>>8&255,qe[ze+2]=f>>16&255,qe[ze+3]=f>>24&255},__writeUInt16LE=function(qe,f,ze){qe[ze]=f&255,qe[ze+1]=f>>>8&255};function WriteShift(qe,f,ze){var Ke=0,Qe=0;if(ze==="dbcs"){for(Qe=0;Qe!=f.length;++Qe)__writeUInt16LE(this,f.charCodeAt(Qe),this.l+2*Qe);Ke=2*f.length}else if(ze==="sbcs"||ze=="cpstr"){for(f=f.replace(/[^\x00-\x7F]/g,"_"),Qe=0;Qe!=f.length;++Qe)this[this.l+Qe]=f.charCodeAt(Qe)&255;Ke=f.length}else if(ze==="hex"){for(;Qe<qe;++Qe)this[this.l++]=parseInt(f.slice(2*Qe,2*Qe+2),16)||0;return this}else if(ze==="utf16le"){var Pi=Math.min(this.l+qe,this.length);for(Qe=0;Qe<Math.min(f.length,qe);++Qe){var nn=f.charCodeAt(Qe);this[this.l++]=nn&255,this[this.l++]=nn>>8}for(;this.l<Pi;)this[this.l++]=0;return this}else switch(qe){case 1:Ke=1,this[this.l]=f&255;break;case 2:Ke=2,this[this.l]=f&255,f>>>=8,this[this.l+1]=f&255;break;case 3:Ke=3,this[this.l]=f&255,f>>>=8,this[this.l+1]=f&255,f>>>=8,this[this.l+2]=f&255;break;case 4:Ke=4,__writeUInt32LE(this,f,this.l);break;case 8:if(Ke=8,ze==="f"){write_double_le(this,f,this.l);break}case 16:break;case-4:Ke=4,__writeInt32LE(this,f,this.l);break}return this.l+=Ke,this}function CheckField(qe,f){var ze=__hexlify(this,this.l,qe.length>>1);if(ze!==qe)throw new Error(f+"Expected "+qe+" saw "+ze);this.l+=qe.length>>1}function prep_blob(qe,f){qe.l=f,qe.read_shift=ReadShift,qe.chk=CheckField,qe.write_shift=WriteShift}function parsenoop(qe,f){qe.l+=f}function new_buf(qe){var f=new_raw_buf(qe);return prep_blob(f,0),f}function buf_array(){var qe=[],f=has_buf?16384:2048;has_buf&&new_buf(f).copy;var ze=function(un){var zn=new_buf(un);return prep_blob(zn,0),zn},Ke=ze(f),Qe=function(){Ke&&(Ke.l&&(Ke.length>Ke.l&&(Ke=Ke.slice(0,Ke.l),Ke.l=Ke.length),Ke.length>0&&qe.push(Ke)),Ke=null)},Pi=function(un){return Ke&&un<Ke.length-Ke.l?Ke:(Qe(),Ke=ze(Math.max(un+1,f)))},nn=function(){return Qe(),bconcat(qe)},ln=function(){return Qe(),qe},cn=function(un){Qe(),Ke=un,Ke.l==null&&(Ke.l=Ke.length),Pi(f)};return{next:Pi,push:cn,end:nn,_bufs:qe,end2:ln}}function write_record(qe,f,ze,Ke){var Qe=+f,Pi;if(!isNaN(Qe)){Ke||(Ke=XLSBRecordEnum[Qe].p||(ze||[]).length||0),Pi=1+(Qe>=128?1:0)+1,Ke>=128&&++Pi,Ke>=16384&&++Pi,Ke>=2097152&&++Pi;var nn=qe.next(Pi);Qe<=127?nn.write_shift(1,Qe):(nn.write_shift(1,(Qe&127)+128),nn.write_shift(1,Qe>>7));for(var ln=0;ln!=4;++ln)if(Ke>=128)nn.write_shift(1,(Ke&127)+128),Ke>>=7;else{nn.write_shift(1,Ke);break}Ke>0&&is_buf(ze)&&qe.push(ze)}}function shift_cell_xls(qe,f,ze){var Ke=dup(qe);if(f.s?(Ke.cRel&&(Ke.c+=f.s.c),Ke.rRel&&(Ke.r+=f.s.r)):(Ke.cRel&&(Ke.c+=f.c),Ke.rRel&&(Ke.r+=f.r)),!ze||ze.biff<12){for(;Ke.c>=256;)Ke.c-=256;for(;Ke.r>=65536;)Ke.r-=65536}return Ke}function shift_range_xls(qe,f,ze){var Ke=dup(qe);return Ke.s=shift_cell_xls(Ke.s,f.s,ze),Ke.e=shift_cell_xls(Ke.e,f.s,ze),Ke}function encode_cell_xls(qe,f){if(qe.cRel&&qe.c<0)for(qe=dup(qe);qe.c<0;)qe.c+=f>8?16384:256;if(qe.rRel&&qe.r<0)for(qe=dup(qe);qe.r<0;)qe.r+=f>8?1048576:f>5?65536:16384;var ze=encode_cell(qe);return!qe.cRel&&qe.cRel!=null&&(ze=fix_col(ze)),!qe.rRel&&qe.rRel!=null&&(ze=fix_row(ze)),ze}function encode_range_xls(qe,f){return qe.s.r==0&&!qe.s.rRel&&qe.e.r==(f.biff>=12?1048575:f.biff>=8?65536:16384)&&!qe.e.rRel?(qe.s.cRel?"":"$")+encode_col(qe.s.c)+":"+(qe.e.cRel?"":"$")+encode_col(qe.e.c):qe.s.c==0&&!qe.s.cRel&&qe.e.c==(f.biff>=12?16383:255)&&!qe.e.cRel?(qe.s.rRel?"":"$")+encode_row(qe.s.r)+":"+(qe.e.rRel?"":"$")+encode_row(qe.e.r):encode_cell_xls(qe.s,f.biff)+":"+encode_cell_xls(qe.e,f.biff)}function decode_row(qe){return parseInt(unfix_row(qe),10)-1}function encode_row(qe){return""+(qe+1)}function fix_row(qe){return qe.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function unfix_row(qe){return qe.replace(/\$(\d+)$/,"$1")}function decode_col(qe){for(var f=unfix_col(qe),ze=0,Ke=0;Ke!==f.length;++Ke)ze=26*ze+f.charCodeAt(Ke)-64;return ze-1}function encode_col(qe){if(qe<0)throw new Error("invalid column "+qe);var f="";for(++qe;qe;qe=Math.floor((qe-1)/26))f=String.fromCharCode((qe-1)%26+65)+f;return f}function fix_col(qe){return qe.replace(/^([A-Z])/,"$$$1")}function unfix_col(qe){return qe.replace(/^\$([A-Z])/,"$1")}function split_cell(qe){return qe.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function decode_cell(qe){for(var f=0,ze=0,Ke=0;Ke<qe.length;++Ke){var Qe=qe.charCodeAt(Ke);Qe>=48&&Qe<=57?f=10*f+(Qe-48):Qe>=65&&Qe<=90&&(ze=26*ze+(Qe-64))}return{c:ze-1,r:f-1}}function encode_cell(qe){for(var f=qe.c+1,ze="";f;f=(f-1)/26|0)ze=String.fromCharCode((f-1)%26+65)+ze;return ze+(qe.r+1)}function decode_range(qe){var f=qe.indexOf(":");return f==-1?{s:decode_cell(qe),e:decode_cell(qe)}:{s:decode_cell(qe.slice(0,f)),e:decode_cell(qe.slice(f+1))}}function encode_range(qe,f){return typeof f>"u"||typeof f=="number"?encode_range(qe.s,qe.e):(typeof qe!="string"&&(qe=encode_cell(qe)),typeof f!="string"&&(f=encode_cell(f)),qe==f?qe:qe+":"+f)}function fix_range(qe){var f=decode_range(qe);return"$"+encode_col(f.s.c)+"$"+encode_row(f.s.r)+":$"+encode_col(f.e.c)+"$"+encode_row(f.e.r)}function formula_quote_sheet_name(qe,f){if(!qe&&!(f&&f.biff<=5&&f.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(qe)?"'"+qe.replace(/'/g,"''")+"'":qe}function safe_decode_range(qe){var f={s:{c:0,r:0},e:{c:0,r:0}},ze=0,Ke=0,Qe=0,Pi=qe.length;for(ze=0;Ke<Pi&&!((Qe=qe.charCodeAt(Ke)-64)<1||Qe>26);++Ke)ze=26*ze+Qe;for(f.s.c=--ze,ze=0;Ke<Pi&&!((Qe=qe.charCodeAt(Ke)-48)<0||Qe>9);++Ke)ze=10*ze+Qe;if(f.s.r=--ze,Ke===Pi||Qe!=10)return f.e.c=f.s.c,f.e.r=f.s.r,f;for(++Ke,ze=0;Ke!=Pi&&!((Qe=qe.charCodeAt(Ke)-64)<1||Qe>26);++Ke)ze=26*ze+Qe;for(f.e.c=--ze,ze=0;Ke!=Pi&&!((Qe=qe.charCodeAt(Ke)-48)<0||Qe>9);++Ke)ze=10*ze+Qe;return f.e.r=--ze,f}function safe_format_cell(qe,f){var ze=qe.t=="d"&&f instanceof Date;if(qe.z!=null)try{return qe.w=SSF_format(qe.z,ze?datenum(f):f)}catch{}try{return qe.w=SSF_format((qe.XF||{}).numFmtId||(ze?14:0),ze?datenum(f):f)}catch{return""+f}}function format_cell(qe,f,ze){return qe==null||qe.t==null||qe.t=="z"?"":qe.w!==void 0?qe.w:(qe.t=="d"&&!qe.z&&ze&&ze.dateNF&&(qe.z=ze.dateNF),qe.t=="e"?BErr[qe.v]||qe.v:f==null?safe_format_cell(qe,qe.v):safe_format_cell(qe,f))}function sheet_to_workbook(qe,f){var ze=f&&f.sheet?f.sheet:"Sheet1",Ke={};return Ke[ze]=qe,{SheetNames:[ze],Sheets:Ke}}function sheet_new(qe){var f={},ze=qe||{};return ze.dense&&(f["!data"]=[]),f}function sheet_add_aoa(qe,f,ze){var Ke=ze||{},Qe=qe?qe["!data"]!=null:Ke.dense,Pi=qe||(Qe?{"!data":[]}:{});Qe&&!Pi["!data"]&&(Pi["!data"]=[]);var nn=0,ln=0;if(Pi&&Ke.origin!=null)if(typeof Ke.origin=="number")nn=Ke.origin;else{var cn=typeof Ke.origin=="string"?decode_cell(Ke.origin):Ke.origin;nn=cn.r,ln=cn.c}var hn={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(Pi["!ref"]){var un=safe_decode_range(Pi["!ref"]);hn.s.c=un.s.c,hn.s.r=un.s.r,hn.e.c=Math.max(hn.e.c,un.e.c),hn.e.r=Math.max(hn.e.r,un.e.r),nn==-1&&(hn.e.r=nn=Pi["!ref"]?un.e.r+1:0)}else hn.s.c=hn.e.c=hn.s.r=hn.e.r=0;for(var zn=[],Xn=!1,Un=0;Un!=f.length;++Un)if(f[Un]){if(!Array.isArray(f[Un]))throw new Error("aoa_to_sheet expects an array of arrays");var qn=nn+Un;Qe&&(Pi["!data"][qn]||(Pi["!data"][qn]=[]),zn=Pi["!data"][qn]);for(var ys=f[Un],vs=0;vs!=ys.length;++vs)if(!(typeof ys[vs]>"u")){var ea={v:ys[vs],t:""},na=ln+vs;if(hn.s.r>qn&&(hn.s.r=qn),hn.s.c>na&&(hn.s.c=na),hn.e.r<qn&&(hn.e.r=qn),hn.e.c<na&&(hn.e.c=na),Xn=!0,ys[vs]&&typeof ys[vs]=="object"&&!Array.isArray(ys[vs])&&!(ys[vs]instanceof Date))ea=ys[vs];else if(Array.isArray(ea.v)&&(ea.f=ys[vs][1],ea.v=ea.v[0]),ea.v===null)if(ea.f)ea.t="n";else if(Ke.nullError)ea.t="e",ea.v=0;else if(Ke.sheetStubs)ea.t="z";else continue;else typeof ea.v=="number"?isFinite(ea.v)?ea.t="n":isNaN(ea.v)?(ea.t="e",ea.v=15):(ea.t="e",ea.v=7):typeof ea.v=="boolean"?ea.t="b":ea.v instanceof Date?(ea.z=Ke.dateNF||table_fmt[14],Ke.UTC||(ea.v=local_to_utc(ea.v)),Ke.cellDates?(ea.t="d",ea.w=SSF_format(ea.z,datenum(ea.v,Ke.date1904))):(ea.t="n",ea.v=datenum(ea.v,Ke.date1904),ea.w=SSF_format(ea.z,ea.v))):ea.t="s";if(Qe)zn[na]&&zn[na].z&&(ea.z=zn[na].z),zn[na]=ea;else{var ta=encode_col(na)+(qn+1);Pi[ta]&&Pi[ta].z&&(ea.z=Pi[ta].z),Pi[ta]=ea}}}return Xn&&hn.s.c<104e5&&(Pi["!ref"]=encode_range(hn)),Pi}function aoa_to_sheet(qe,f){return sheet_add_aoa(null,qe,f)}function parse_Int32LE(qe){return qe.read_shift(4,"i")}function write_UInt32LE(qe,f){return f||(f=new_buf(4)),f.write_shift(4,qe),f}function parse_XLWideString(qe){var f=qe.read_shift(4);return f===0?"":qe.read_shift(f,"dbcs")}function write_XLWideString(qe,f){var ze=!1;return f==null&&(ze=!0,f=new_buf(4+2*qe.length)),f.write_shift(4,qe.length),qe.length>0&&f.write_shift(0,qe,"dbcs"),ze?f.slice(0,f.l):f}function parse_StrRun(qe){return{ich:qe.read_shift(2),ifnt:qe.read_shift(2)}}function write_StrRun(qe,f){return f||(f=new_buf(4)),f.write_shift(2,0),f.write_shift(2,0),f}function parse_RichStr(qe,f){var ze=qe.l,Ke=qe.read_shift(1),Qe=parse_XLWideString(qe),Pi=[],nn={t:Qe,h:Qe};if((Ke&1)!==0){for(var ln=qe.read_shift(4),cn=0;cn!=ln;++cn)Pi.push(parse_StrRun(qe));nn.r=Pi}else nn.r=[{ich:0,ifnt:0}];return qe.l=ze+f,nn}function write_RichStr(qe,f){var ze=!1;return f==null&&(ze=!0,f=new_buf(15+4*qe.t.length)),f.write_shift(1,0),write_XLWideString(qe.t,f),ze?f.slice(0,f.l):f}var parse_BrtCommentText=parse_RichStr;function write_BrtCommentText(qe,f){var ze=!1;return f==null&&(ze=!0,f=new_buf(23+4*qe.t.length)),f.write_shift(1,1),write_XLWideString(qe.t,f),f.write_shift(4,1),write_StrRun({},f),ze?f.slice(0,f.l):f}function parse_XLSBCell(qe){var f=qe.read_shift(4),ze=qe.read_shift(2);return ze+=qe.read_shift(1)<<16,qe.l++,{c:f,iStyleRef:ze}}function write_XLSBCell(qe,f){return f==null&&(f=new_buf(8)),f.write_shift(-4,qe.c),f.write_shift(3,qe.iStyleRef||qe.s),f.write_shift(1,0),f}function parse_XLSBShortCell(qe){var f=qe.read_shift(2);return f+=qe.read_shift(1)<<16,qe.l++,{c:-1,iStyleRef:f}}function write_XLSBShortCell(qe,f){return f==null&&(f=new_buf(4)),f.write_shift(3,qe.iStyleRef||qe.s),f.write_shift(1,0),f}var parse_XLSBCodeName=parse_XLWideString,write_XLSBCodeName=write_XLWideString;function parse_XLNullableWideString(qe){var f=qe.read_shift(4);return f===0||f===4294967295?"":qe.read_shift(f,"dbcs")}function write_XLNullableWideString(qe,f){var ze=!1;return f==null&&(ze=!0,f=new_buf(127)),f.write_shift(4,qe.length>0?qe.length:4294967295),qe.length>0&&f.write_shift(0,qe,"dbcs"),ze?f.slice(0,f.l):f}var parse_XLNameWideString=parse_XLWideString,parse_RelID=parse_XLNullableWideString,write_RelID=write_XLNullableWideString;function parse_RkNumber(qe){var f=qe.slice(qe.l,qe.l+4),ze=f[0]&1,Ke=f[0]&2;qe.l+=4;var Qe=Ke===0?__double([0,0,0,0,f[0]&252,f[1],f[2],f[3]],0):__readInt32LE(f,0)>>2;return ze?Qe/100:Qe}function write_RkNumber(qe,f){f==null&&(f=new_buf(4));var ze=0,Ke=0,Qe=qe*100;if(qe==(qe|0)&&qe>=-536870912&&qe<1<<29?Ke=1:Qe==(Qe|0)&&Qe>=-536870912&&Qe<1<<29&&(Ke=1,ze=1),Ke)f.write_shift(-4,((ze?Qe:qe)<<2)+(ze+2));else throw new Error("unsupported RkNumber "+qe)}function parse_RfX(qe){var f={s:{},e:{}};return f.s.r=qe.read_shift(4),f.e.r=qe.read_shift(4),f.s.c=qe.read_shift(4),f.e.c=qe.read_shift(4),f}function write_RfX(qe,f){return f||(f=new_buf(16)),f.write_shift(4,qe.s.r),f.write_shift(4,qe.e.r),f.write_shift(4,qe.s.c),f.write_shift(4,qe.e.c),f}var parse_UncheckedRfX=parse_RfX,write_UncheckedRfX=write_RfX;function parse_Xnum(qe){if(qe.length-qe.l<8)throw"XLS Xnum Buffer underflow";return qe.read_shift(8,"f")}function write_Xnum(qe,f){return(f||new_buf(8)).write_shift(8,qe,"f")}function parse_BrtColor(qe){var f={},ze=qe.read_shift(1),Ke=ze>>>1,Qe=qe.read_shift(1),Pi=qe.read_shift(2,"i"),nn=qe.read_shift(1),ln=qe.read_shift(1),cn=qe.read_shift(1);switch(qe.l++,Ke){case 0:f.auto=1;break;case 1:f.index=Qe;var hn=XLSIcv[Qe];hn&&(f.rgb=rgb2Hex(hn));break;case 2:f.rgb=rgb2Hex([nn,ln,cn]);break;case 3:f.theme=Qe;break}return Pi!=0&&(f.tint=Pi>0?Pi/32767:Pi/32768),f}function write_BrtColor(qe,f){if(f||(f=new_buf(8)),!qe||qe.auto)return f.write_shift(4,0),f.write_shift(4,0),f;qe.index!=null?(f.write_shift(1,2),f.write_shift(1,qe.index)):qe.theme!=null?(f.write_shift(1,6),f.write_shift(1,qe.theme)):(f.write_shift(1,5),f.write_shift(1,0));var ze=qe.tint||0;if(ze>0?ze*=32767:ze<0&&(ze*=32768),f.write_shift(2,ze),!qe.rgb||qe.theme!=null)f.write_shift(2,0),f.write_shift(1,0),f.write_shift(1,0);else{var Ke=qe.rgb||"FFFFFF";typeof Ke=="number"&&(Ke=("000000"+Ke.toString(16)).slice(-6)),f.write_shift(1,parseInt(Ke.slice(0,2),16)),f.write_shift(1,parseInt(Ke.slice(2,4),16)),f.write_shift(1,parseInt(Ke.slice(4,6),16)),f.write_shift(1,255)}return f}function parse_FontFlags(qe){var f=qe.read_shift(1);qe.l++;var ze={fBold:f&1,fItalic:f&2,fUnderline:f&4,fStrikeout:f&8,fOutline:f&16,fShadow:f&32,fCondense:f&64,fExtend:f&128};return ze}function write_FontFlags(qe,f){f||(f=new_buf(2));var ze=(qe.italic?2:0)|(qe.strike?8:0)|(qe.outline?16:0)|(qe.shadow?32:0)|(qe.condense?64:0)|(qe.extend?128:0);return f.write_shift(1,ze),f.write_shift(1,0),f}var VT_I2=2,VT_I4=3,VT_BOOL=11,VT_UI4=19,VT_FILETIME=64,VT_BLOB=65,VT_CF=71,VT_VECTOR_VARIANT=4108,VT_VECTOR_LPSTR=4126,VT_STRING=80,DocSummaryPIDDSI={1:{n:"CodePage",t:VT_I2},2:{n:"Category",t:VT_STRING},3:{n:"PresentationFormat",t:VT_STRING},4:{n:"ByteCount",t:VT_I4},5:{n:"LineCount",t:VT_I4},6:{n:"ParagraphCount",t:VT_I4},7:{n:"SlideCount",t:VT_I4},8:{n:"NoteCount",t:VT_I4},9:{n:"HiddenCount",t:VT_I4},10:{n:"MultimediaClipCount",t:VT_I4},11:{n:"ScaleCrop",t:VT_BOOL},12:{n:"HeadingPairs",t:VT_VECTOR_VARIANT},13:{n:"TitlesOfParts",t:VT_VECTOR_LPSTR},14:{n:"Manager",t:VT_STRING},15:{n:"Company",t:VT_STRING},16:{n:"LinksUpToDate",t:VT_BOOL},17:{n:"CharacterCount",t:VT_I4},19:{n:"SharedDoc",t:VT_BOOL},22:{n:"HyperlinksChanged",t:VT_BOOL},23:{n:"AppVersion",t:VT_I4,p:"version"},24:{n:"DigSig",t:VT_BLOB},26:{n:"ContentType",t:VT_STRING},27:{n:"ContentStatus",t:VT_STRING},28:{n:"Language",t:VT_STRING},29:{n:"Version",t:VT_STRING},255:{},2147483648:{n:"Locale",t:VT_UI4},2147483651:{n:"Behavior",t:VT_UI4},1919054434:{}},SummaryPIDSI={1:{n:"CodePage",t:VT_I2},2:{n:"Title",t:VT_STRING},3:{n:"Subject",t:VT_STRING},4:{n:"Author",t:VT_STRING},5:{n:"Keywords",t:VT_STRING},6:{n:"Comments",t:VT_STRING},7:{n:"Template",t:VT_STRING},8:{n:"LastAuthor",t:VT_STRING},9:{n:"RevNumber",t:VT_STRING},10:{n:"EditTime",t:VT_FILETIME},11:{n:"LastPrinted",t:VT_FILETIME},12:{n:"CreatedDate",t:VT_FILETIME},13:{n:"ModifiedDate",t:VT_FILETIME},14:{n:"PageCount",t:VT_I4},15:{n:"WordCount",t:VT_I4},16:{n:"CharCount",t:VT_I4},17:{n:"Thumbnail",t:VT_CF},18:{n:"Application",t:VT_STRING},19:{n:"DocSecurity",t:VT_I4},255:{},2147483648:{n:"Locale",t:VT_UI4},2147483651:{n:"Behavior",t:VT_UI4},1919054434:{}};function rgbify(qe){return qe.map(function(f){return[f>>16&255,f>>8&255,f&255]})}var _XLSIcv=rgbify([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,0,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),XLSIcv=dup(_XLSIcv),BErr={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},RBErr={"#NULL!":0,"#DIV/0!":7,"#VALUE!":15,"#REF!":23,"#NAME?":29,"#NUM!":36,"#N/A":42,"#GETTING_DATA":43,"#WTF?":255},XLSLblBuiltIn=["_xlnm.Consolidate_Area","_xlnm.Auto_Open","_xlnm.Auto_Close","_xlnm.Extract","_xlnm.Database","_xlnm.Criteria","_xlnm.Print_Area","_xlnm.Print_Titles","_xlnm.Recorder","_xlnm.Data_Form","_xlnm.Auto_Activate","_xlnm.Auto_Deactivate","_xlnm.Sheet_Title","_xlnm._FilterDatabase"],ct2type={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},CT_LIST={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function new_ct(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function write_ct(qe,f,ze){var Ke=evert_arr(ct2type),Qe=[],Pi;Qe[Qe.length]=XML_HEADER,Qe[Qe.length]=writextag("Types",null,{xmlns:XMLNS.CT,"xmlns:xsd":XMLNS.xsd,"xmlns:xsi":XMLNS.xsi}),Qe=Qe.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map(function(hn){return writextag("Default",null,{Extension:hn[0],ContentType:hn[1]})}));var nn=function(hn){qe[hn]&&qe[hn].length>0&&(Pi=qe[hn][0],Qe[Qe.length]=writextag("Override",null,{PartName:(Pi[0]=="/"?"":"/")+Pi,ContentType:CT_LIST[hn][f.bookType]||CT_LIST[hn].xlsx}))},ln=function(hn){(qe[hn]||[]).forEach(function(un){Qe[Qe.length]=writextag("Override",null,{PartName:(un[0]=="/"?"":"/")+un,ContentType:CT_LIST[hn][f.bookType]||CT_LIST[hn].xlsx})})},cn=function(hn){(qe[hn]||[]).forEach(function(un){Qe[Qe.length]=writextag("Override",null,{PartName:(un[0]=="/"?"":"/")+un,ContentType:Ke[hn][0]})})};return nn("workbooks"),ln("sheets"),ln("charts"),cn("themes"),["strs","styles"].forEach(nn),["coreprops","extprops","custprops"].forEach(cn),cn("vba"),cn("comments"),cn("threadedcomments"),cn("drawings"),ln("metadata"),cn("people"),Qe.length>2&&(Qe[Qe.length]="</Types>",Qe[1]=Qe[1].replace("/>",">")),Qe.join("")}var RELS={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function get_rels_path(qe){var f=qe.lastIndexOf("/");return qe.slice(0,f+1)+"_rels/"+qe.slice(f+1)+".rels"}function write_rels(qe){var f=[XML_HEADER,writextag("Relationships",null,{xmlns:XMLNS.RELS})];return keys(qe["!id"]).forEach(function(ze){f[f.length]=writextag("Relationship",null,qe["!id"][ze])}),f.length>2&&(f[f.length]="</Relationships>",f[1]=f[1].replace("/>",">")),f.join("")}function add_rels(qe,f,ze,Ke,Qe,Pi){if(Qe||(Qe={}),qe["!id"]||(qe["!id"]={}),qe["!idx"]||(qe["!idx"]=1),f<0)for(f=qe["!idx"];qe["!id"]["rId"+f];++f);if(qe["!idx"]=f+1,Qe.Id="rId"+f,Qe.Type=Ke,Qe.Target=ze,[RELS.HLINK,RELS.XPATH,RELS.XMISS].indexOf(Qe.Type)>-1&&(Qe.TargetMode="External"),qe["!id"][Qe.Id])throw new Error("Cannot rewrite rId "+f);return qe["!id"][Qe.Id]=Qe,qe[("/"+Qe.Target).replace("//","/")]=Qe,f}function write_manifest(qe){var f=[XML_HEADER];f.push(`<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">
`),f.push(`  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>
`);for(var ze=0;ze<qe.length;++ze)f.push('  <manifest:file-entry manifest:full-path="'+qe[ze][0]+'" manifest:media-type="'+qe[ze][1]+`"/>
`);return f.push("</manifest:manifest>"),f.join("")}function write_rdf_type(qe,f,ze){return['  <rdf:Description rdf:about="'+qe+`">
`,'    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(ze||"odf")+"#"+f+`"/>
`,`  </rdf:Description>
`].join("")}function write_rdf_has(qe,f){return['  <rdf:Description rdf:about="'+qe+`">
`,'    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+f+`"/>
`,`  </rdf:Description>
`].join("")}function write_rdf(qe){var f=[XML_HEADER];f.push(`<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
`);for(var ze=0;ze!=qe.length;++ze)f.push(write_rdf_type(qe[ze][0],qe[ze][1])),f.push(write_rdf_has("",qe[ze][0]));return f.push(write_rdf_type("","Document","pkg")),f.push("</rdf:RDF>"),f.join("")}function write_meta_ods(qe,f){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+XLSX.version+"</meta:generator></office:meta></office:document-meta>"}var CORE_PROPS=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]];function cp_doit(qe,f,ze,Ke,Qe){Qe[qe]!=null||f==null||f===""||(Qe[qe]=f,f=escapexml(f),Ke[Ke.length]=ze?writextag(qe,f,ze):writetag(qe,f))}function write_core_props(qe,f){var ze=f||{},Ke=[XML_HEADER,writextag("cp:coreProperties",null,{"xmlns:cp":XMLNS.CORE_PROPS,"xmlns:dc":XMLNS.dc,"xmlns:dcterms":XMLNS.dcterms,"xmlns:dcmitype":XMLNS.dcmitype,"xmlns:xsi":XMLNS.xsi})],Qe={};if(!qe&&!ze.Props)return Ke.join("");qe&&(qe.CreatedDate!=null&&cp_doit("dcterms:created",typeof qe.CreatedDate=="string"?qe.CreatedDate:write_w3cdtf(qe.CreatedDate,ze.WTF),{"xsi:type":"dcterms:W3CDTF"},Ke,Qe),qe.ModifiedDate!=null&&cp_doit("dcterms:modified",typeof qe.ModifiedDate=="string"?qe.ModifiedDate:write_w3cdtf(qe.ModifiedDate,ze.WTF),{"xsi:type":"dcterms:W3CDTF"},Ke,Qe));for(var Pi=0;Pi!=CORE_PROPS.length;++Pi){var nn=CORE_PROPS[Pi],ln=ze.Props&&ze.Props[nn[1]]!=null?ze.Props[nn[1]]:qe?qe[nn[1]]:null;ln===!0?ln="1":ln===!1?ln="0":typeof ln=="number"&&(ln=String(ln)),ln!=null&&cp_doit(nn[0],ln,null,Ke,Qe)}return Ke.length>2&&(Ke[Ke.length]="</cp:coreProperties>",Ke[1]=Ke[1].replace("/>",">")),Ke.join("")}var EXT_PROPS=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],PseudoPropsPairs=["Worksheets","SheetNames","NamedRanges","DefinedNames","Chartsheets","ChartNames"];function write_ext_props(qe){var f=[],ze=writextag;return qe||(qe={}),qe.Application="SheetJS",f[f.length]=XML_HEADER,f[f.length]=writextag("Properties",null,{xmlns:XMLNS.EXT_PROPS,"xmlns:vt":XMLNS.vt}),EXT_PROPS.forEach(function(Ke){if(qe[Ke[1]]!==void 0){var Qe;switch(Ke[2]){case"string":Qe=escapexml(String(qe[Ke[1]]));break;case"bool":Qe=qe[Ke[1]]?"true":"false";break}Qe!==void 0&&(f[f.length]=ze(Ke[0],Qe))}}),f[f.length]=ze("HeadingPairs",ze("vt:vector",ze("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+ze("vt:variant",ze("vt:i4",String(qe.Worksheets))),{size:2,baseType:"variant"})),f[f.length]=ze("TitlesOfParts",ze("vt:vector",qe.SheetNames.map(function(Ke){return"<vt:lpstr>"+escapexml(Ke)+"</vt:lpstr>"}).join(""),{size:qe.Worksheets,baseType:"lpstr"})),f.length>2&&(f[f.length]="</Properties>",f[1]=f[1].replace("/>",">")),f.join("")}function write_cust_props(qe){var f=[XML_HEADER,writextag("Properties",null,{xmlns:XMLNS.CUST_PROPS,"xmlns:vt":XMLNS.vt})];if(!qe)return f.join("");var ze=1;return keys(qe).forEach(function(Qe){++ze,f[f.length]=writextag("property",write_vt(qe[Qe]),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:ze,name:escapexml(Qe)})}),f.length>2&&(f[f.length]="</Properties>",f[1]=f[1].replace("/>",">")),f.join("")}var XLMLDocPropsMap={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"};function xlml_write_docprops(qe,f){var ze=[];return keys(XLMLDocPropsMap).map(function(Ke){for(var Qe=0;Qe<CORE_PROPS.length;++Qe)if(CORE_PROPS[Qe][1]==Ke)return CORE_PROPS[Qe];for(Qe=0;Qe<EXT_PROPS.length;++Qe)if(EXT_PROPS[Qe][1]==Ke)return EXT_PROPS[Qe];throw Ke}).forEach(function(Ke){if(qe[Ke[1]]!=null){var Qe=f&&f.Props&&f.Props[Ke[1]]!=null?f.Props[Ke[1]]:qe[Ke[1]];switch(Ke[2]){case"date":Qe=new Date(Qe).toISOString().replace(/\.\d*Z/,"Z");break}typeof Qe=="number"?Qe=String(Qe):Qe===!0||Qe===!1?Qe=Qe?"1":"0":Qe instanceof Date&&(Qe=new Date(Qe).toISOString().replace(/\.\d*Z/,"")),ze.push(writetag(XLMLDocPropsMap[Ke[1]]||Ke[1],Qe))}}),writextag("DocumentProperties",ze.join(""),{xmlns:XLMLNS.o})}function xlml_write_custprops(qe,f){var ze=["Worksheets","SheetNames"],Ke="CustomDocumentProperties",Qe=[];return qe&&keys(qe).forEach(function(Pi){if(Object.prototype.hasOwnProperty.call(qe,Pi)){for(var nn=0;nn<CORE_PROPS.length;++nn)if(Pi==CORE_PROPS[nn][1])return;for(nn=0;nn<EXT_PROPS.length;++nn)if(Pi==EXT_PROPS[nn][1])return;for(nn=0;nn<ze.length;++nn)if(Pi==ze[nn])return;var ln=qe[Pi],cn="string";typeof ln=="number"?(cn="float",ln=String(ln)):ln===!0||ln===!1?(cn="boolean",ln=ln?"1":"0"):ln=String(ln),Qe.push(writextag(escapexmltag(Pi),ln,{"dt:dt":cn}))}}),f&&keys(f).forEach(function(Pi){if(Object.prototype.hasOwnProperty.call(f,Pi)&&!(qe&&Object.prototype.hasOwnProperty.call(qe,Pi))){var nn=f[Pi],ln="string";typeof nn=="number"?(ln="float",nn=String(nn)):nn===!0||nn===!1?(ln="boolean",nn=nn?"1":"0"):nn instanceof Date?(ln="dateTime.tz",nn=nn.toISOString()):nn=String(nn),Qe.push(writextag(escapexmltag(Pi),nn,{"dt:dt":ln}))}}),"<"+Ke+' xmlns="'+XLMLNS.o+'">'+Qe.join("")+"</"+Ke+">"}function write_FILETIME(qe){var f=typeof qe=="string"?new Date(Date.parse(qe)):qe,ze=f.getTime()/1e3+11644473600,Ke=ze%Math.pow(2,32),Qe=(ze-Ke)/Math.pow(2,32);Ke*=1e7,Qe*=1e7;var Pi=Ke/Math.pow(2,32)|0;Pi>0&&(Ke=Ke%Math.pow(2,32),Qe+=Pi);var nn=new_buf(8);return nn.write_shift(4,Ke),nn.write_shift(4,Qe),nn}function write_TypedPropertyValue(qe,f){var ze=new_buf(4),Ke=new_buf(4);switch(ze.write_shift(4,qe==80?31:qe),qe){case 3:Ke.write_shift(-4,f);break;case 5:Ke=new_buf(8),Ke.write_shift(8,f,"f");break;case 11:Ke.write_shift(4,f?1:0);break;case 64:Ke=write_FILETIME(f);break;case 31:case 80:for(Ke=new_buf(4+2*(f.length+1)+(f.length%2?0:2)),Ke.write_shift(4,f.length+1),Ke.write_shift(0,f,"dbcs");Ke.l!=Ke.length;)Ke.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+qe+" "+f)}return bconcat([ze,Ke])}var XLSPSSkip=["CodePage","Thumbnail","_PID_LINKBASE","_PID_HLINKS","SystemIdentifier","FMTID"];function guess_property_type(qe){switch(typeof qe){case"boolean":return 11;case"number":return(qe|0)==qe?3:5;case"string":return 31;case"object":if(qe instanceof Date)return 64;break}return-1}function write_PropertySet(qe,f,ze){var Ke=new_buf(8),Qe=[],Pi=[],nn=8,ln=0,cn=new_buf(8),hn=new_buf(8);if(cn.write_shift(4,2),cn.write_shift(4,1200),hn.write_shift(4,1),Pi.push(cn),Qe.push(hn),nn+=8+cn.length,!f){hn=new_buf(8),hn.write_shift(4,0),Qe.unshift(hn);var un=[new_buf(4)];for(un[0].write_shift(4,qe.length),ln=0;ln<qe.length;++ln){var zn=qe[ln][0];for(cn=new_buf(8+2*(zn.length+1)+(zn.length%2?0:2)),cn.write_shift(4,ln+2),cn.write_shift(4,zn.length+1),cn.write_shift(0,zn,"dbcs");cn.l!=cn.length;)cn.write_shift(1,0);un.push(cn)}cn=bconcat(un),Pi.unshift(cn),nn+=8+cn.length}for(ln=0;ln<qe.length;++ln)if(!(f&&!f[qe[ln][0]])&&!(XLSPSSkip.indexOf(qe[ln][0])>-1||PseudoPropsPairs.indexOf(qe[ln][0])>-1)&&qe[ln][1]!=null){var Xn=qe[ln][1],Un=0;if(f){Un=+f[qe[ln][0]];var qn=ze[Un];if(qn.p=="version"&&typeof Xn=="string"){var ys=Xn.split(".");Xn=(+ys[0]<<16)+(+ys[1]||0)}cn=write_TypedPropertyValue(qn.t,Xn)}else{var vs=guess_property_type(Xn);vs==-1&&(vs=31,Xn=String(Xn)),cn=write_TypedPropertyValue(vs,Xn)}Pi.push(cn),hn=new_buf(8),hn.write_shift(4,f?Un:2+ln),Qe.push(hn),nn+=8+cn.length}var ea=8*(Pi.length+1);for(ln=0;ln<Pi.length;++ln)Qe[ln].write_shift(4,ea),ea+=Pi[ln].length;return Ke.write_shift(4,nn),Ke.write_shift(4,Pi.length),bconcat([Ke].concat(Qe).concat(Pi))}function write_PropertySetStream(qe,f,ze,Ke,Qe,Pi){var nn=new_buf(Qe?68:48),ln=[nn];nn.write_shift(2,65534),nn.write_shift(2,0),nn.write_shift(4,842412599),nn.write_shift(16,CFB.utils.consts.HEADER_CLSID,"hex"),nn.write_shift(4,Qe?2:1),nn.write_shift(16,f,"hex"),nn.write_shift(4,Qe?68:48);var cn=write_PropertySet(qe,ze,Ke);if(ln.push(cn),Qe){var hn=write_PropertySet(Qe,null,null);nn.write_shift(16,Pi,"hex"),nn.write_shift(4,68+cn.length),ln.push(hn)}return bconcat(ln)}function writezeroes(qe,f){f||(f=new_buf(qe));for(var ze=0;ze<qe;++ze)f.write_shift(1,0);return f}function parsebool(qe,f){return qe.read_shift(f)===1}function writebool(qe,f){return f||(f=new_buf(2)),f.write_shift(2,+!!qe),f}function parseuint16(qe){return qe.read_shift(2,"u")}function writeuint16(qe,f){return f||(f=new_buf(2)),f.write_shift(2,qe),f}function write_Bes(qe,f,ze){return ze||(ze=new_buf(2)),ze.write_shift(1,f=="e"?+qe:+!!qe),ze.write_shift(1,f=="e"?1:0),ze}function parse_ShortXLUnicodeString(qe,f,ze){var Ke=qe.read_shift(ze&&ze.biff>=12?2:1),Qe="sbcs-cont",Pi=current_codepage;if(ze&&ze.biff>=8&&(current_codepage=1200),!ze||ze.biff==8){var nn=qe.read_shift(1);nn&&(Qe="dbcs-cont")}else ze.biff==12&&(Qe="wstr");ze.biff>=2&&ze.biff<=5&&(Qe="cpstr");var ln=Ke?qe.read_shift(Ke,Qe):"";return current_codepage=Pi,ln}function write_XLUnicodeRichExtendedString(qe){var f=qe.t||"",ze=new_buf(3);ze.write_shift(2,f.length),ze.write_shift(1,1);var Ke=new_buf(2*f.length);Ke.write_shift(2*f.length,f,"utf16le");var Qe=[ze,Ke];return bconcat(Qe)}function parse_XLUnicodeStringNoCch(qe,f,ze){var Ke;if(ze){if(ze.biff>=2&&ze.biff<=5)return qe.read_shift(f,"cpstr");if(ze.biff>=12)return qe.read_shift(f,"dbcs-cont")}var Qe=qe.read_shift(1);return Qe===0?Ke=qe.read_shift(f,"sbcs-cont"):Ke=qe.read_shift(f,"dbcs-cont"),Ke}function parse_XLUnicodeString(qe,f,ze){var Ke=qe.read_shift(ze&&ze.biff==2?1:2);return Ke===0?(qe.l++,""):parse_XLUnicodeStringNoCch(qe,Ke,ze)}function parse_XLUnicodeString2(qe,f,ze){if(ze.biff>5)return parse_XLUnicodeString(qe,f,ze);var Ke=qe.read_shift(1);return Ke===0?(qe.l++,""):qe.read_shift(Ke,ze.biff<=4||!qe.lens?"cpstr":"sbcs-cont")}function write_XLUnicodeString(qe,f,ze){return ze||(ze=new_buf(3+2*qe.length)),ze.write_shift(2,qe.length),ze.write_shift(1,1),ze.write_shift(31,qe,"utf16le"),ze}function write_HyperlinkString(qe,f){f||(f=new_buf(6+qe.length*2)),f.write_shift(4,1+qe.length);for(var ze=0;ze<qe.length;++ze)f.write_shift(2,qe.charCodeAt(ze));return f.write_shift(2,0),f}function write_Hyperlink(qe){var f=new_buf(512),ze=0,Ke=qe.Target;Ke.slice(0,7)=="file://"&&(Ke=Ke.slice(7));var Qe=Ke.indexOf("#"),Pi=Qe>-1?31:23;switch(Ke.charAt(0)){case"#":Pi=28;break;case".":Pi&=-3;break}f.write_shift(4,2),f.write_shift(4,Pi);var nn=[8,6815827,6619237,4849780,83];for(ze=0;ze<nn.length;++ze)f.write_shift(4,nn[ze]);if(Pi==28)Ke=Ke.slice(1),write_HyperlinkString(Ke,f);else if(Pi&2){for(nn="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),ze=0;ze<nn.length;++ze)f.write_shift(1,parseInt(nn[ze],16));var ln=Qe>-1?Ke.slice(0,Qe):Ke;for(f.write_shift(4,2*(ln.length+1)),ze=0;ze<ln.length;++ze)f.write_shift(2,ln.charCodeAt(ze));f.write_shift(2,0),Pi&8&&write_HyperlinkString(Qe>-1?Ke.slice(Qe+1):"",f)}else{for(nn="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),ze=0;ze<nn.length;++ze)f.write_shift(1,parseInt(nn[ze],16));for(var cn=0;Ke.slice(cn*3,cn*3+3)=="../"||Ke.slice(cn*3,cn*3+3)=="..\\";)++cn;for(f.write_shift(2,cn),f.write_shift(4,Ke.length-3*cn+1),ze=0;ze<Ke.length-3*cn;++ze)f.write_shift(1,Ke.charCodeAt(ze+3*cn)&255);for(f.write_shift(1,0),f.write_shift(2,65535),f.write_shift(2,57005),ze=0;ze<6;++ze)f.write_shift(4,0)}return f.slice(0,f.l)}function write_XLSCell(qe,f,ze,Ke){return Ke||(Ke=new_buf(6)),Ke.write_shift(2,qe),Ke.write_shift(2,f),Ke.write_shift(2,ze||0),Ke}function parse_XTI(qe,f,ze){var Ke=ze.biff>8?4:2,Qe=qe.read_shift(Ke),Pi=qe.read_shift(Ke,"i"),nn=qe.read_shift(Ke,"i");return[Qe,Pi,nn]}function parse_Ref8U(qe){var f=qe.read_shift(2),ze=qe.read_shift(2),Ke=qe.read_shift(2),Qe=qe.read_shift(2);return{s:{c:Ke,r:f},e:{c:Qe,r:ze}}}function write_Ref8U(qe,f){return f||(f=new_buf(8)),f.write_shift(2,qe.s.r),f.write_shift(2,qe.e.r),f.write_shift(2,qe.s.c),f.write_shift(2,qe.e.c),f}function write_BOF(qe,f,ze){var Ke=1536,Qe=16;switch(ze.bookType){case"biff8":break;case"biff5":Ke=1280,Qe=8;break;case"biff4":Ke=4,Qe=6;break;case"biff3":Ke=3,Qe=6;break;case"biff2":Ke=2,Qe=4;break;case"xla":break;default:throw new Error("unsupported BIFF version")}var Pi=new_buf(Qe);return Pi.write_shift(2,Ke),Pi.write_shift(2,f),Qe>4&&Pi.write_shift(2,29282),Qe>6&&Pi.write_shift(2,1997),Qe>8&&(Pi.write_shift(2,49161),Pi.write_shift(2,1),Pi.write_shift(2,1798),Pi.write_shift(2,0)),Pi}function write_WriteAccess(qe,f){var ze=!f||f.biff==8,Ke=new_buf(ze?112:54);for(Ke.write_shift(f.biff==8?2:1,7),ze&&Ke.write_shift(1,0),Ke.write_shift(4,859007059),Ke.write_shift(4,5458548|(ze?0:536870912));Ke.l<Ke.length;)Ke.write_shift(1,ze?0:32);return Ke}function write_BoundSheet8(qe,f){var ze=!f||f.biff>=8?2:1,Ke=new_buf(8+ze*qe.name.length);Ke.write_shift(4,qe.pos),Ke.write_shift(1,qe.hs||0),Ke.write_shift(1,qe.dt),Ke.write_shift(1,qe.name.length),f.biff>=8&&Ke.write_shift(1,1),Ke.write_shift(ze*qe.name.length,qe.name,f.biff<8?"sbcs":"utf16le");var Qe=Ke.slice(0,Ke.l);return Qe.l=Ke.l,Qe}function write_SST(qe,f){var ze=new_buf(8);ze.write_shift(4,qe.Count),ze.write_shift(4,qe.Unique);for(var Ke=[],Qe=0;Qe<qe.length;++Qe)Ke[Qe]=write_XLUnicodeRichExtendedString(qe[Qe]);var Pi=bconcat([ze].concat(Ke));return Pi.parts=[ze.length].concat(Ke.map(function(nn){return nn.length})),Pi}function write_Window1(){var qe=new_buf(18);return qe.write_shift(2,0),qe.write_shift(2,0),qe.write_shift(2,29280),qe.write_shift(2,17600),qe.write_shift(2,56),qe.write_shift(2,0),qe.write_shift(2,0),qe.write_shift(2,1),qe.write_shift(2,500),qe}function write_Window2(qe){var f=new_buf(18),ze=1718;return qe&&qe.RTL&&(ze|=64),f.write_shift(2,ze),f.write_shift(4,0),f.write_shift(4,64),f.write_shift(4,0),f.write_shift(4,0),f}function write_Font(qe,f){var ze=qe.name||"Arial",Ke=f&&f.biff==5,Qe=Ke?15+ze.length:16+2*ze.length,Pi=new_buf(Qe);return Pi.write_shift(2,qe.sz*20),Pi.write_shift(4,0),Pi.write_shift(2,400),Pi.write_shift(4,0),Pi.write_shift(2,0),Pi.write_shift(1,ze.length),Ke||Pi.write_shift(1,1),Pi.write_shift((Ke?1:2)*ze.length,ze,Ke?"sbcs":"utf16le"),Pi}function write_LabelSst(qe,f,ze,Ke){var Qe=new_buf(10);return write_XLSCell(qe,f,Ke,Qe),Qe.write_shift(4,ze),Qe}function write_Label(qe,f,ze,Ke,Qe){var Pi=!Qe||Qe.biff==8,nn=new_buf(8+ +Pi+(1+Pi)*ze.length);return write_XLSCell(qe,f,Ke,nn),nn.write_shift(2,ze.length),Pi&&nn.write_shift(1,1),nn.write_shift((1+Pi)*ze.length,ze,Pi?"utf16le":"sbcs"),nn}function write_Format(qe,f,ze,Ke){var Qe=ze&&ze.biff==5;Ke||(Ke=new_buf(Qe?3+f.length:5+2*f.length)),Ke.write_shift(2,qe),Ke.write_shift(Qe?1:2,f.length),Qe||Ke.write_shift(1,1),Ke.write_shift((Qe?1:2)*f.length,f,Qe?"sbcs":"utf16le");var Pi=Ke.length>Ke.l?Ke.slice(0,Ke.l):Ke;return Pi.l==null&&(Pi.l=Pi.length),Pi}function write_BIFF2Format(qe){var f=new_buf(1+qe.length);return f.write_shift(1,qe.length),f.write_shift(qe.length,qe,"sbcs"),f}function write_BIFF4Format(qe){var f=new_buf(3+qe.length);return f.l+=2,f.write_shift(1,qe.length),f.write_shift(qe.length,qe,"sbcs"),f}function write_Dimensions(qe,f){var ze=f.biff==8||!f.biff?4:2,Ke=new_buf(2*ze+6);return Ke.write_shift(ze,qe.s.r),Ke.write_shift(ze,qe.e.r+1),Ke.write_shift(2,qe.s.c),Ke.write_shift(2,qe.e.c+1),Ke.write_shift(2,0),Ke}function write_XF(qe,f,ze,Ke){var Qe=ze&&ze.biff==5;Ke||(Ke=new_buf(Qe?16:20)),Ke.write_shift(2,0),qe.style?(Ke.write_shift(2,qe.numFmtId||0),Ke.write_shift(2,65524)):(Ke.write_shift(2,qe.numFmtId||0),Ke.write_shift(2,f<<4));var Pi=0;return qe.numFmtId>0&&Qe&&(Pi|=1024),Ke.write_shift(4,Pi),Ke.write_shift(4,0),Qe||Ke.write_shift(4,0),Ke.write_shift(2,0),Ke}function write_BIFF2XF(qe){var f=new_buf(4);return f.l+=2,f.write_shift(1,qe.numFmtId),f.l++,f}function write_BIFF3XF(qe){var f=new_buf(12);return f.l++,f.write_shift(1,qe.numFmtId),f.l+=10,f}var write_BIFF4XF=write_BIFF3XF;function write_Guts(qe){var f=new_buf(8);return f.write_shift(4,0),f.write_shift(2,0),f.write_shift(2,0),f}function write_BoolErr(qe,f,ze,Ke,Qe,Pi){var nn=new_buf(8);return write_XLSCell(qe,f,Ke,nn),write_Bes(ze,Pi,nn),nn}function write_Number(qe,f,ze,Ke){var Qe=new_buf(14);return write_XLSCell(qe,f,Ke,Qe),write_Xnum(ze,Qe),Qe}function parse_ExternSheet(qe,f,ze){if(ze.biff<8||!(ze.biff>8)&&f==qe[qe.l]+(qe[qe.l+1]==3?1:0)+1)return parse_BIFF5ExternSheet(qe,f,ze);for(var Ke=[],Qe=qe.l+f,Pi=qe.read_shift(ze.biff>8?4:2);Pi--!==0;)Ke.push(parse_XTI(qe,ze.biff>8?12:6,ze));if(qe.l!=Qe)throw new Error("Bad ExternSheet: "+qe.l+" != "+Qe);return Ke}function parse_BIFF5ExternSheet(qe,f,ze){qe[qe.l+1]==3&&qe[qe.l]++;var Ke=parse_ShortXLUnicodeString(qe,f,ze);return Ke.charCodeAt(0)==3?Ke.slice(1):Ke}function write_NOTE_BIFF2(qe,f,ze,Ke){var Qe=new_buf(6+(Ke||qe.length));return Qe.write_shift(2,f),Qe.write_shift(2,ze),Qe.write_shift(2,Ke||qe.length),Qe.write_shift(qe.length,qe,"sbcs"),Qe}function write_MergeCells(qe){var f=new_buf(2+qe.length*8);f.write_shift(2,qe.length);for(var ze=0;ze<qe.length;++ze)write_Ref8U(qe[ze],f);return f}function write_HLink(qe){var f=new_buf(24),ze=decode_cell(qe[0]);f.write_shift(2,ze.r),f.write_shift(2,ze.r),f.write_shift(2,ze.c),f.write_shift(2,ze.c);for(var Ke="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),Qe=0;Qe<16;++Qe)f.write_shift(1,parseInt(Ke[Qe],16));return bconcat([f,write_Hyperlink(qe[1])])}function write_HLinkTooltip(qe){var f=qe[1].Tooltip,ze=new_buf(10+2*(f.length+1));ze.write_shift(2,2048);var Ke=decode_cell(qe[0]);ze.write_shift(2,Ke.r),ze.write_shift(2,Ke.r),ze.write_shift(2,Ke.c),ze.write_shift(2,Ke.c);for(var Qe=0;Qe<f.length;++Qe)ze.write_shift(2,f.charCodeAt(Qe));return ze.write_shift(2,0),ze}function write_Country(qe){return qe||(qe=new_buf(4)),qe.write_shift(2,1),qe.write_shift(2,1),qe}function parse_ColInfo(qe,f,ze){if(!ze.cellStyles)return parsenoop(qe,f);var Ke=ze&&ze.biff>=12?4:2,Qe=qe.read_shift(Ke),Pi=qe.read_shift(Ke),nn=qe.read_shift(Ke),ln=qe.read_shift(Ke),cn=qe.read_shift(2);Ke==2&&(qe.l+=2);var hn={s:Qe,e:Pi,w:nn,ixfe:ln,flags:cn};return(ze.biff>=5||!ze.biff)&&(hn.level=cn>>8&7),hn}function write_ColInfo(qe,f){var ze=new_buf(12);ze.write_shift(2,f),ze.write_shift(2,f),ze.write_shift(2,qe.width*256),ze.write_shift(2,0);var Ke=0;return qe.hidden&&(Ke|=1),ze.write_shift(1,Ke),Ke=qe.level||0,ze.write_shift(1,Ke),ze.write_shift(2,0),ze}function write_RRTabId(qe){for(var f=new_buf(2*qe),ze=0;ze<qe;++ze)f.write_shift(2,ze+1);return f}function write_BIFF2Cell(qe,f,ze,Ke,Qe){return qe||(qe=new_buf(7)),qe.write_shift(2,f),qe.write_shift(2,ze),qe.write_shift(1,Ke||0),qe.write_shift(1,Qe||0),qe.write_shift(1,0),qe}function write_BIFF2NUM(qe,f,ze,Ke,Qe){var Pi=new_buf(15);return write_BIFF2Cell(Pi,qe,f,Ke||0,Qe||0),Pi.write_shift(8,ze,"f"),Pi}function write_BIFF2INT(qe,f,ze,Ke,Qe){var Pi=new_buf(9);return write_BIFF2Cell(Pi,qe,f,Ke||0,Qe||0),Pi.write_shift(2,ze),Pi}var DBF=function(){var qe={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},f=evert({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function ze(ln,cn){var hn=[],un=new_raw_buf(1);switch(cn.type){case"base64":un=s2a(Base64_decode(ln));break;case"binary":un=s2a(ln);break;case"buffer":case"array":un=ln;break}prep_blob(un,0);var zn=un.read_shift(1),Xn=!!(zn&136),Un=!1,qn=!1;switch(zn){case 2:break;case 3:break;case 48:Un=!0,Xn=!0;break;case 49:Un=!0,Xn=!0;break;case 131:break;case 139:break;case 140:qn=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+zn.toString(16))}var ys=0,vs=521;zn==2&&(ys=un.read_shift(2)),un.l+=3,zn!=2&&(ys=un.read_shift(4)),ys>1048576&&(ys=1e6),zn!=2&&(vs=un.read_shift(2));var ea=un.read_shift(2);cn.codepage,zn!=2&&(un.l+=16,un.read_shift(1),un[un.l]!==0&&qe[un[un.l]],un.l+=1,un.l+=2),qn&&(un.l+=36);for(var na=[],ta={},ra=Math.min(un.length,zn==2?521:vs-10-(Un?264:0)),oa=qn?32:11;un.l<ra&&un[un.l]!=13;)switch(ta={},ta.name=a2s(un.slice(un.l,un.l+oa)).replace(/[\u0000\r\n][\S\s]*$/g,""),un.l+=oa,ta.type=String.fromCharCode(un.read_shift(1)),zn!=2&&!qn&&(ta.offset=un.read_shift(4)),ta.len=un.read_shift(1),zn==2&&(ta.offset=un.read_shift(2)),ta.dec=un.read_shift(1),ta.name.length&&na.push(ta),zn!=2&&(un.l+=qn?13:14),ta.type){case"B":(!Un||ta.len!=8)&&cn.WTF&&console.log("Skipping "+ta.name+":"+ta.type);break;case"G":case"P":cn.WTF&&console.log("Skipping "+ta.name+":"+ta.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+ta.type)}if(un[un.l]!==13&&(un.l=vs-1),un.read_shift(1)!==13)throw new Error("DBF Terminator not found "+un.l+" "+un[un.l]);un.l=vs;var fa=0,ca=0;for(hn[0]=[],ca=0;ca!=na.length;++ca)hn[0][ca]=na[ca].name;for(;ys-- >0;){if(un[un.l]===42){un.l+=ea;continue}for(++un.l,hn[++fa]=[],ca=0,ca=0;ca!=na.length;++ca){var la=un.slice(un.l,un.l+na[ca].len);un.l+=na[ca].len,prep_blob(la,0);var ua=a2s(la);switch(na[ca].type){case"C":ua.trim().length&&(hn[fa][ca]=ua.replace(/([^\s])\s+$/,"$1"));break;case"D":ua.length===8?(hn[fa][ca]=new Date(Date.UTC(+ua.slice(0,4),+ua.slice(4,6)-1,+ua.slice(6,8),0,0,0,0)),cn&&cn.UTC||(hn[fa][ca]=utc_to_local(hn[fa][ca]))):hn[fa][ca]=ua;break;case"F":hn[fa][ca]=parseFloat(ua.trim());break;case"+":case"I":hn[fa][ca]=qn?la.read_shift(-4,"i")^2147483648:la.read_shift(4,"i");break;case"L":switch(ua.trim().toUpperCase()){case"Y":case"T":hn[fa][ca]=!0;break;case"N":case"F":hn[fa][ca]=!1;break;case"":case"\0":case"?":break;default:throw new Error("DBF Unrecognized L:|"+ua+"|")}break;case"M":if(!Xn)throw new Error("DBF Unexpected MEMO for type "+zn.toString(16));hn[fa][ca]="##MEMO##"+(qn?parseInt(ua.trim(),10):la.read_shift(4));break;case"N":ua=ua.replace(/\u0000/g,"").trim(),ua&&ua!="."&&(hn[fa][ca]=+ua||0);break;case"@":hn[fa][ca]=new Date(la.read_shift(-8,"f")-621356832e5);break;case"T":{var ga=la.read_shift(4),da=la.read_shift(4);if(ga==0&&da==0)break;hn[fa][ca]=new Date((ga-2440588)*864e5+da),cn&&cn.UTC||(hn[fa][ca]=utc_to_local(hn[fa][ca]))}break;case"Y":hn[fa][ca]=la.read_shift(4,"i")/1e4+la.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":hn[fa][ca]=-la.read_shift(-8,"f");break;case"B":if(Un&&na[ca].len==8){hn[fa][ca]=la.read_shift(8,"f");break}case"G":case"P":la.l+=na[ca].len;break;case"0":if(na[ca].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+na[ca].type)}}}if(zn!=2&&un.l<un.length&&un[un.l++]!=26)throw new Error("DBF EOF Marker missing "+(un.l-1)+" of "+un.length+" "+un[un.l-1].toString(16));return cn&&cn.sheetRows&&(hn=hn.slice(0,cn.sheetRows)),cn.DBF=na,hn}function Ke(ln,cn){var hn=cn||{};hn.dateNF||(hn.dateNF="yyyymmdd");var un=aoa_to_sheet(ze(ln,hn),hn);return un["!cols"]=hn.DBF.map(function(zn){return{wch:zn.len,DBF:zn}}),delete hn.DBF,un}function Qe(ln,cn){try{var hn=sheet_to_workbook(Ke(ln,cn),cn);return hn.bookType="dbf",hn}catch(un){if(cn&&cn.WTF)throw un}return{SheetNames:[],Sheets:{}}}var Pi={B:8,C:250,L:1,D:8,"?":0,"":0};function nn(ln,cn){if(!ln["!ref"])throw new Error("Cannot export empty sheet to DBF");var hn=cn||{},un=current_codepage;if(+hn.codepage>=0&&set_cp(+hn.codepage),hn.type=="string")throw new Error("Cannot write DBF to JS string");var zn=buf_array(),Xn=sheet_to_json(ln,{header:1,raw:!0,cellDates:!0}),Un=Xn[0],qn=Xn.slice(1),ys=ln["!cols"]||[],vs=0,ea=0,na=0,ta=1;for(vs=0;vs<Un.length;++vs){if(((ys[vs]||{}).DBF||{}).name){Un[vs]=ys[vs].DBF.name,++na;continue}if(Un[vs]!=null){if(++na,typeof Un[vs]=="number"&&(Un[vs]=Un[vs].toString(10)),typeof Un[vs]!="string")throw new Error("DBF Invalid column name "+Un[vs]+" |"+typeof Un[vs]+"|");if(Un.indexOf(Un[vs])!==vs){for(ea=0;ea<1024;++ea)if(Un.indexOf(Un[vs]+"_"+ea)==-1){Un[vs]+="_"+ea;break}}}}var ra=safe_decode_range(ln["!ref"]),oa=[],fa=[],ca=[];for(vs=0;vs<=ra.e.c-ra.s.c;++vs){var la="",ua="",ga=0,da=[];for(ea=0;ea<qn.length;++ea)qn[ea][vs]!=null&&da.push(qn[ea][vs]);if(da.length==0||Un[vs]==null){oa[vs]="?";continue}for(ea=0;ea<da.length;++ea){switch(typeof da[ea]){case"number":ua="B";break;case"string":ua="C";break;case"boolean":ua="L";break;case"object":ua=da[ea]instanceof Date?"D":"C";break;default:ua="C"}ga=Math.max(ga,String(da[ea]).length),la=la&&la!=ua?"C":ua}ga>250&&(ga=250),ua=((ys[vs]||{}).DBF||{}).type,ua=="C"&&ys[vs].DBF.len>ga&&(ga=ys[vs].DBF.len),la=="B"&&ua=="N"&&(la="N",ca[vs]=ys[vs].DBF.dec,ga=ys[vs].DBF.len),fa[vs]=la=="C"||ua=="N"?ga:Pi[la]||0,ta+=fa[vs],oa[vs]=la}var qa=zn.next(32);for(qa.write_shift(4,318902576),qa.write_shift(4,qn.length),qa.write_shift(2,296+32*na),qa.write_shift(2,ta),vs=0;vs<4;++vs)qa.write_shift(4,0);var tl=+f[current_codepage]||3;for(qa.write_shift(4,0|tl<<8),qe[tl]!=+hn.codepage&&(hn.codepage&&console.error("DBF Unsupported codepage "+current_codepage+", using 1252"),current_codepage=1252),vs=0,ea=0;vs<Un.length;++vs)if(Un[vs]!=null){var ol=zn.next(32),hl=(Un[vs].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);ol.write_shift(1,hl,"sbcs"),ol.write_shift(1,oa[vs]=="?"?"C":oa[vs],"sbcs"),ol.write_shift(4,ea),ol.write_shift(1,fa[vs]||Pi[oa[vs]]||0),ol.write_shift(1,ca[vs]||0),ol.write_shift(1,2),ol.write_shift(4,0),ol.write_shift(1,0),ol.write_shift(4,0),ol.write_shift(4,0),ea+=fa[vs]||Pi[oa[vs]]||0}var wl=zn.next(264);for(wl.write_shift(4,13),vs=0;vs<65;++vs)wl.write_shift(4,0);for(vs=0;vs<qn.length;++vs){var _l=zn.next(ta);for(_l.write_shift(1,0),ea=0;ea<Un.length;++ea)if(Un[ea]!=null)switch(oa[ea]){case"L":_l.write_shift(1,qn[vs][ea]==null?63:qn[vs][ea]?84:70);break;case"B":_l.write_shift(8,qn[vs][ea]||0,"f");break;case"N":var gl="0";for(typeof qn[vs][ea]=="number"&&(gl=qn[vs][ea].toFixed(ca[ea]||0)),gl.length>fa[ea]&&(gl=gl.slice(0,fa[ea])),na=0;na<fa[ea]-gl.length;++na)_l.write_shift(1,32);_l.write_shift(1,gl,"sbcs");break;case"D":qn[vs][ea]?(_l.write_shift(4,("0000"+qn[vs][ea].getFullYear()).slice(-4),"sbcs"),_l.write_shift(2,("00"+(qn[vs][ea].getMonth()+1)).slice(-2),"sbcs"),_l.write_shift(2,("00"+qn[vs][ea].getDate()).slice(-2),"sbcs")):_l.write_shift(8,"00000000","sbcs");break;case"C":var dl=_l.l,sl=String(qn[vs][ea]!=null?qn[vs][ea]:"").slice(0,fa[ea]);for(_l.write_shift(1,sl,"cpstr"),dl+=fa[ea]-_l.l,na=0;na<dl;++na)_l.write_shift(1,32);break}}return current_codepage=un,zn.next(1).write_shift(1,26),zn.end()}return{to_workbook:Qe,to_sheet:Ke,from_sheet:nn}}(),SYLK=function(){var qe={AA:"",BA:"",CA:"",DA:195,HA:"",JA:197,AE:"",BE:"",CE:"",HE:"",AI:"",BI:"",CI:"",HI:"",AO:"",BO:"",CO:"",DO:213,HO:"",AU:"",BU:"",CU:"",HU:"",Aa:"",Ba:"",Ca:"",Da:227,Ha:"",Ja:229,Ae:"",Be:"",Ce:"",He:"",Ai:"",Bi:"",Ci:"",Hi:"",Ao:"",Bo:"",Co:"",Do:245,Ho:"",Au:"",Bu:"",Cu:"",Hu:"",KC:"",Kc:"",q:"",z:"",a:"",j:"",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},f=new RegExp("\x1BN("+keys(qe).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1").replace("{","\\{")+"|\\|)","gm");try{f=new RegExp("\x1BN("+keys(qe).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm")}catch{}var ze=function(Un,qn){var ys=qe[qn];return typeof ys=="number"?_getansi(ys):ys},Ke=function(Un,qn,ys){var vs=qn.charCodeAt(0)-32<<4|ys.charCodeAt(0)-48;return vs==59?Un:_getansi(vs)};qe["|"]=254;var Qe=function(Un){return Un.replace(/\n/g,"\x1B :").replace(/\r/g,"\x1B =")};function Pi(Un,qn){switch(qn.type){case"base64":return nn(Base64_decode(Un),qn);case"binary":return nn(Un,qn);case"buffer":return nn(has_buf&&Buffer.isBuffer(Un)?Un.toString("binary"):a2s(Un),qn);case"array":return nn(cc2str(Un),qn)}throw new Error("Unrecognized type "+qn.type)}function nn(Un,qn){var ys=Un.split(/[\n\r]+/),vs=-1,ea=-1,na=0,ta=0,ra=[],oa=[],fa=null,ca={},la=[],ua=[],ga=[],da=0,qa,tl={Workbook:{WBProps:{},Names:[]}};for(+qn.codepage>=0&&set_cp(+qn.codepage);na!==ys.length;++na){da=0;var ol=ys[na].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,Ke).replace(f,ze),hl=ol.replace(/;;/g,"\0").split(";").map(function(nl){return nl.replace(/\u0000/g,";")}),wl=hl[0],_l;if(ol.length>0)switch(wl){case"ID":break;case"E":break;case"B":break;case"O":for(ta=1;ta<hl.length;++ta)switch(hl[ta].charAt(0)){case"V":{var gl=parseInt(hl[ta].slice(1),10);gl>=1&&gl<=4&&(tl.Workbook.WBProps.date1904=!0)}break}break;case"W":break;case"P":switch(hl[1].charAt(0)){case"P":oa.push(ol.slice(3).replace(/;;/g,";"));break}break;case"NN":{var dl={Sheet:0};for(ta=1;ta<hl.length;++ta)switch(hl[ta].charAt(0)){case"N":dl.Name=hl[ta].slice(1);break;case"E":dl.Ref=(qn&&qn.sheet||"Sheet1")+"!"+rc_to_a1(hl[ta].slice(1));break}tl.Workbook.Names.push(dl)}break;case"C":var sl=!1,kl=!1,pl=!1,Al=!1,xl=-1,al=-1,Fl="",Ol="z",Jo="";for(ta=1;ta<hl.length;++ta)switch(hl[ta].charAt(0)){case"A":Jo=hl[ta].slice(1);break;case"X":ea=parseInt(hl[ta].slice(1),10)-1,kl=!0;break;case"Y":for(vs=parseInt(hl[ta].slice(1),10)-1,kl||(ea=0),qa=ra.length;qa<=vs;++qa)ra[qa]=[];break;case"K":_l=hl[ta].slice(1),_l.charAt(0)==='"'?(_l=_l.slice(1,_l.length-1),Ol="s"):_l==="TRUE"||_l==="FALSE"?(_l=_l==="TRUE",Ol="b"):_l.charAt(0)=="#"&&RBErr[_l]!=null?(Ol="e",_l=RBErr[_l]):isNaN(fuzzynum(_l))||(_l=fuzzynum(_l),Ol="n",fa!==null&&fmt_is_date(fa)&&qn.cellDates&&(_l=numdate(tl.Workbook.WBProps.date1904?_l+1462:_l),Ol=typeof _l=="number"?"n":"d")),sl=!0;break;case"E":Al=!0,Fl=rc_to_a1(hl[ta].slice(1),{r:vs,c:ea});break;case"S":pl=!0;break;case"G":break;case"R":xl=parseInt(hl[ta].slice(1),10)-1;break;case"C":al=parseInt(hl[ta].slice(1),10)-1;break;default:if(qn&&qn.WTF)throw new Error("SYLK bad record "+ol)}if(sl&&(ra[vs][ea]?(ra[vs][ea].t=Ol,ra[vs][ea].v=_l):ra[vs][ea]={t:Ol,v:_l},fa&&(ra[vs][ea].z=fa),qn.cellText!==!1&&fa&&(ra[vs][ea].w=SSF_format(ra[vs][ea].z,ra[vs][ea].v,{date1904:tl.Workbook.WBProps.date1904})),fa=null),pl){if(Al)throw new Error("SYLK shared formula cannot have own formula");var cl=xl>-1&&ra[xl][al];if(!cl||!cl[1])throw new Error("SYLK shared formula cannot find base");Fl=shift_formula_str(cl[1],{r:vs-xl,c:ea-al})}Fl&&(ra[vs][ea]?ra[vs][ea].f=Fl:ra[vs][ea]={t:"n",f:Fl}),Jo&&(ra[vs][ea]||(ra[vs][ea]={t:"z"}),ra[vs][ea].c=[{a:"SheetJSYLK",t:Jo}]);break;case"F":var rl=0;for(ta=1;ta<hl.length;++ta)switch(hl[ta].charAt(0)){case"X":ea=parseInt(hl[ta].slice(1),10)-1,++rl;break;case"Y":for(vs=parseInt(hl[ta].slice(1),10)-1,qa=ra.length;qa<=vs;++qa)ra[qa]=[];break;case"M":da=parseInt(hl[ta].slice(1),10)/20;break;case"F":break;case"G":break;case"P":fa=oa[parseInt(hl[ta].slice(1),10)];break;case"S":break;case"D":break;case"N":break;case"W":for(ga=hl[ta].slice(1).split(" "),qa=parseInt(ga[0],10);qa<=parseInt(ga[1],10);++qa)da=parseInt(ga[2],10),ua[qa-1]=da===0?{hidden:!0}:{wch:da};break;case"C":ea=parseInt(hl[ta].slice(1),10)-1,ua[ea]||(ua[ea]={});break;case"R":vs=parseInt(hl[ta].slice(1),10)-1,la[vs]||(la[vs]={}),da>0?(la[vs].hpt=da,la[vs].hpx=pt2px(da)):da===0&&(la[vs].hidden=!0);break;default:if(qn&&qn.WTF)throw new Error("SYLK bad record "+ol)}rl<1&&(fa=null);break;default:if(qn&&qn.WTF)throw new Error("SYLK bad record "+ol)}}return la.length>0&&(ca["!rows"]=la),ua.length>0&&(ca["!cols"]=ua),ua.forEach(function(nl){process_col(nl)}),qn&&qn.sheetRows&&(ra=ra.slice(0,qn.sheetRows)),[ra,ca,tl]}function ln(Un,qn){var ys=Pi(Un,qn),vs=ys[0],ea=ys[1],na=ys[2],ta=dup(qn);ta.date1904=(((na||{}).Workbook||{}).WBProps||{}).date1904;var ra=aoa_to_sheet(vs,ta);keys(ea).forEach(function(fa){ra[fa]=ea[fa]});var oa=sheet_to_workbook(ra,qn);return keys(na).forEach(function(fa){oa[fa]=na[fa]}),oa.bookType="sylk",oa}function cn(Un,qn,ys,vs,ea,na){var ta="C;Y"+(ys+1)+";X"+(vs+1)+";K";switch(Un.t){case"n":ta+=isFinite(Un.v)?Un.v||0:BErr[isNaN(Un.v)?36:7],Un.f&&!Un.F&&(ta+=";E"+a1_to_rc(Un.f,{r:ys,c:vs}));break;case"b":ta+=Un.v?"TRUE":"FALSE";break;case"e":ta+=Un.w||BErr[Un.v]||Un.v;break;case"d":ta+=datenum(parseDate(Un.v,na),na);break;case"s":ta+='"'+(Un.v==null?"":String(Un.v)).replace(/"/g,"").replace(/;/g,";;")+'"';break}return ta}function hn(Un,qn,ys){var vs="C;Y"+(qn+1)+";X"+(ys+1)+";A";return vs+=Qe(Un.map(function(ea){return ea.t}).join("")),vs}function un(Un,qn){qn.forEach(function(ys,vs){var ea="F;W"+(vs+1)+" "+(vs+1)+" ";ys.hidden?ea+="0":(typeof ys.width=="number"&&!ys.wpx&&(ys.wpx=width2px(ys.width)),typeof ys.wpx=="number"&&!ys.wch&&(ys.wch=px2char(ys.wpx)),typeof ys.wch=="number"&&(ea+=Math.round(ys.wch))),ea.charAt(ea.length-1)!=" "&&Un.push(ea)})}function zn(Un,qn){qn.forEach(function(ys,vs){var ea="F;";ys.hidden?ea+="M0;":ys.hpt?ea+="M"+20*ys.hpt+";":ys.hpx&&(ea+="M"+20*px2pt(ys.hpx)+";"),ea.length>2&&Un.push(ea+"R"+(vs+1))})}function Xn(Un,qn,ys){qn||(qn={}),qn._formats=["General"];var vs=["ID;PSheetJS;N;E"],ea=[],na=safe_decode_range(Un["!ref"]||"A1"),ta,ra=Un["!data"]!=null,oa=`\r
`,fa=(((ys||{}).Workbook||{}).WBProps||{}).date1904,ca="General";vs.push("P;PGeneral");var la=na.s.r,ua=na.s.c,ga=[];if(Un["!ref"]){for(la=na.s.r;la<=na.e.r;++la)if(!(ra&&!Un["!data"][la])){for(ga=[],ua=na.s.c;ua<=na.e.c;++ua)ta=ra?Un["!data"][la][ua]:Un[encode_col(ua)+encode_row(la)],!(!ta||!ta.c)&&ga.push(hn(ta.c,la,ua));ga.length&&ea.push(ga.join(oa))}}if(Un["!ref"]){for(la=na.s.r;la<=na.e.r;++la)if(!(ra&&!Un["!data"][la])){for(ga=[],ua=na.s.c;ua<=na.e.c;++ua)if(ta=ra?Un["!data"][la][ua]:Un[encode_col(ua)+encode_row(la)],!(!ta||ta.v==null&&(!ta.f||ta.F))){if((ta.z||(ta.t=="d"?table_fmt[14]:"General"))!=ca){var da=qn._formats.indexOf(ta.z);da==-1&&(qn._formats.push(ta.z),da=qn._formats.length-1,vs.push("P;P"+ta.z.replace(/;/g,";;"))),ga.push("F;P"+da+";Y"+(la+1)+";X"+(ua+1))}ga.push(cn(ta,Un,la,ua,qn,fa))}ea.push(ga.join(oa))}}return vs.push("F;P0;DG0G8;M255"),Un["!cols"]&&un(vs,Un["!cols"]),Un["!rows"]&&zn(vs,Un["!rows"]),Un["!ref"]&&vs.push("B;Y"+(na.e.r-na.s.r+1)+";X"+(na.e.c-na.s.c+1)+";D"+[na.s.c,na.s.r,na.e.c,na.e.r].join(" ")),vs.push("O;L;D;B"+(fa?";V4":"")+";K47;G100 0.001"),delete qn._formats,vs.join(oa)+oa+ea.join(oa)+oa+"E"+oa}return{to_workbook:ln,from_sheet:Xn}}(),DIF=function(){function qe(ln,cn){switch(cn.type){case"base64":return f(Base64_decode(ln),cn);case"binary":return f(ln,cn);case"buffer":return f(has_buf&&Buffer.isBuffer(ln)?ln.toString("binary"):a2s(ln),cn);case"array":return f(cc2str(ln),cn)}throw new Error("Unrecognized type "+cn.type)}function f(ln,cn){for(var hn=ln.split(`
`),un=-1,zn=-1,Xn=0,Un=[];Xn!==hn.length;++Xn){if(hn[Xn].trim()==="BOT"){Un[++un]=[],zn=0;continue}if(!(un<0)){var qn=hn[Xn].trim().split(","),ys=qn[0],vs=qn[1];++Xn;for(var ea=hn[Xn]||"";(ea.match(/["]/g)||[]).length&1&&Xn<hn.length-1;)ea+=`
`+hn[++Xn];switch(ea=ea.trim(),+ys){case-1:if(ea==="BOT"){Un[++un]=[],zn=0;continue}else if(ea!=="EOD")throw new Error("Unrecognized DIF special command "+ea);break;case 0:ea==="TRUE"?Un[un][zn]=!0:ea==="FALSE"?Un[un][zn]=!1:isNaN(fuzzynum(vs))?isNaN(fuzzydate(vs).getDate())?Un[un][zn]=vs:(Un[un][zn]=parseDate(vs),cn&&cn.UTC||(Un[un][zn]=utc_to_local(Un[un][zn]))):Un[un][zn]=fuzzynum(vs),++zn;break;case 1:ea=ea.slice(1,ea.length-1),ea=ea.replace(/""/g,'"'),ea&&ea.match(/^=".*"$/)&&(ea=ea.slice(2,-1)),Un[un][zn++]=ea!==""?ea:null;break}if(ea==="EOD")break}}return cn&&cn.sheetRows&&(Un=Un.slice(0,cn.sheetRows)),Un}function ze(ln,cn){return aoa_to_sheet(qe(ln,cn),cn)}function Ke(ln,cn){var hn=sheet_to_workbook(ze(ln,cn),cn);return hn.bookType="dif",hn}function Qe(ln,cn){return"0,"+String(ln)+`\r
`+cn}function Pi(ln){return`1,0\r
"`+ln.replace(/"/g,'""')+'"'}function nn(ln){if(!ln["!ref"])throw new Error("Cannot export empty sheet to DIF");for(var cn=safe_decode_range(ln["!ref"]),hn=ln["!data"]!=null,un=[`TABLE\r
0,1\r
"sheetjs"\r
`,`VECTORS\r
0,`+(cn.e.r-cn.s.r+1)+`\r
""\r
`,`TUPLES\r
0,`+(cn.e.c-cn.s.c+1)+`\r
""\r
`,`DATA\r
0,0\r
""\r
`],zn=cn.s.r;zn<=cn.e.r;++zn){for(var Xn=hn?ln["!data"][zn]:[],Un=`-1,0\r
BOT\r
`,qn=cn.s.c;qn<=cn.e.c;++qn){var ys=hn?Xn&&Xn[qn]:ln[encode_cell({r:zn,c:qn})];if(ys==null){Un+=`1,0\r
""\r
`;continue}switch(ys.t){case"n":ys.w!=null?Un+="0,"+ys.w+`\r
V`:ys.v!=null?Un+=Qe(ys.v,"V"):ys.f!=null&&!ys.F?Un+=Pi("="+ys.f):Un+=`1,0\r
""`;break;case"b":Un+=ys.v?Qe(1,"TRUE"):Qe(0,"FALSE");break;case"s":Un+=Pi(isNaN(+ys.v)?ys.v:'="'+ys.v+'"');break;case"d":ys.w||(ys.w=SSF_format(ys.z||table_fmt[14],datenum(parseDate(ys.v)))),Un+=Qe(ys.w,"V");break;default:Un+=`1,0\r
""`}Un+=`\r
`}un.push(Un)}return un.join("")+`-1,0\r
EOD`}return{to_workbook:Ke,to_sheet:ze,from_sheet:nn}}(),ETH=function(){function qe(zn){return zn.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function f(zn){return zn.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function ze(zn,Xn){for(var Un=zn.split(`
`),qn=-1,ys=-1,vs=0,ea=[];vs!==Un.length;++vs){var na=Un[vs].trim().split(":");if(na[0]==="cell"){var ta=decode_cell(na[1]);if(ea.length<=ta.r)for(qn=ea.length;qn<=ta.r;++qn)ea[qn]||(ea[qn]=[]);switch(qn=ta.r,ys=ta.c,na[2]){case"t":ea[qn][ys]=qe(na[3]);break;case"v":ea[qn][ys]=+na[3];break;case"vtf":var ra=na[na.length-1];case"vtc":switch(na[3]){case"nl":ea[qn][ys]=!!+na[4];break;default:ea[qn][ys]=na[na.length-1].charAt(0)=="#"?{t:"e",v:RBErr[na[na.length-1]]}:+na[4];break}na[2]=="vtf"&&(ea[qn][ys]=[ea[qn][ys],ra])}}}return Xn&&Xn.sheetRows&&(ea=ea.slice(0,Xn.sheetRows)),ea}function Ke(zn,Xn){return aoa_to_sheet(ze(zn,Xn),Xn)}function Qe(zn,Xn){return sheet_to_workbook(Ke(zn,Xn),Xn)}var Pi=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),nn=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,ln=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),cn="--SocialCalcSpreadsheetControlSave--";function hn(zn){if(!zn||!zn["!ref"])return"";for(var Xn=[],Un=[],qn,ys="",vs=decode_range(zn["!ref"]),ea=zn["!data"]!=null,na=vs.s.r;na<=vs.e.r;++na)for(var ta=vs.s.c;ta<=vs.e.c;++ta)if(ys=encode_cell({r:na,c:ta}),qn=ea?(zn["!data"][na]||[])[ta]:zn[ys],!(!qn||qn.v==null||qn.t==="z")){switch(Un=["cell",ys,"t"],qn.t){case"s":Un.push(f(qn.v));break;case"b":Un[2]="vt"+(qn.f?"f":"c"),Un[3]="nl",Un[4]=qn.v?"1":"0",Un[5]=f(qn.f||(qn.v?"TRUE":"FALSE"));break;case"d":var ra=datenum(parseDate(qn.v));Un[2]="vtc",Un[3]="nd",Un[4]=""+ra,Un[5]=qn.w||SSF_format(qn.z||table_fmt[14],ra);break;case"n":isFinite(qn.v)?qn.f?(Un[2]="vtf",Un[3]="n",Un[4]=qn.v,Un[5]=f(qn.f)):(Un[2]="v",Un[3]=qn.v):(Un[2]="vt"+(qn.f?"f":"c"),Un[3]="e"+BErr[isNaN(qn.v)?36:7],Un[4]="0",Un[5]=qn.f||Un[3].slice(1),Un[6]="e",Un[7]=Un[3].slice(1));break;case"e":continue}Xn.push(Un.join(":"))}return Xn.push("sheet:c:"+(vs.e.c-vs.s.c+1)+":r:"+(vs.e.r-vs.s.r+1)+":tvf:1"),Xn.push("valueformat:1:text-wiki"),Xn.join(`
`)}function un(zn){return[Pi,nn,ln,nn,hn(zn),cn].join(`
`)}return{to_workbook:Qe,to_sheet:Ke,from_sheet:un}}(),PRN=function(){function qe(un,zn,Xn,Un,qn){qn.raw?zn[Xn][Un]=un:un===""||(un==="TRUE"?zn[Xn][Un]=!0:un==="FALSE"?zn[Xn][Un]=!1:isNaN(fuzzynum(un))?isNaN(fuzzydate(un).getDate())?un.charCodeAt(0)==35&&RBErr[un]!=null?zn[Xn][Un]={t:"e",v:RBErr[un],w:un}:zn[Xn][Un]=un:zn[Xn][Un]=parseDate(un):zn[Xn][Un]=fuzzynum(un))}function f(un,zn){var Xn=zn||{},Un=[];if(!un||un.length===0)return Un;for(var qn=un.split(/[\r\n]/),ys=qn.length-1;ys>=0&&qn[ys].length===0;)--ys;for(var vs=10,ea=0,na=0;na<=ys;++na)ea=qn[na].indexOf(" "),ea==-1?ea=qn[na].length:ea++,vs=Math.max(vs,ea);for(na=0;na<=ys;++na){Un[na]=[];var ta=0;for(qe(qn[na].slice(0,vs).trim(),Un,na,ta,Xn),ta=1;ta<=(qn[na].length-vs)/10+1;++ta)qe(qn[na].slice(vs+(ta-1)*10,vs+ta*10).trim(),Un,na,ta,Xn)}return Xn.sheetRows&&(Un=Un.slice(0,Xn.sheetRows)),Un}var ze={44:",",9:"	",59:";",124:"|"},Ke={44:3,9:2,59:1,124:0};function Qe(un){for(var zn={},Xn=!1,Un=0,qn=0;Un<un.length;++Un)(qn=un.charCodeAt(Un))==34?Xn=!Xn:!Xn&&qn in ze&&(zn[qn]=(zn[qn]||0)+1);qn=[];for(Un in zn)Object.prototype.hasOwnProperty.call(zn,Un)&&qn.push([zn[Un],Un]);if(!qn.length){zn=Ke;for(Un in zn)Object.prototype.hasOwnProperty.call(zn,Un)&&qn.push([zn[Un],Un])}return qn.sort(function(ys,vs){return ys[0]-vs[0]||Ke[ys[1]]-Ke[vs[1]]}),ze[qn.pop()[1]]||44}function Pi(un,zn){var Xn=zn||{},Un="",qn={};Xn.dense&&(qn["!data"]=[]);var ys={s:{c:0,r:0},e:{c:0,r:0}};un.slice(0,4)=="sep="?un.charCodeAt(5)==13&&un.charCodeAt(6)==10?(Un=un.charAt(4),un=un.slice(7)):un.charCodeAt(5)==13||un.charCodeAt(5)==10?(Un=un.charAt(4),un=un.slice(6)):Un=Qe(un.slice(0,1024)):Xn&&Xn.FS?Un=Xn.FS:Un=Qe(un.slice(0,1024));var vs=0,ea=0,na=0,ta=0,ra=0,oa=Un.charCodeAt(0),fa=!1,ca=0,la=un.charCodeAt(0),ua=Xn.dateNF!=null?dateNF_regex(Xn.dateNF):null;function ga(){var da=un.slice(ta,ra);da.slice(-1)=="\r"&&(da=da.slice(0,-1));var qa={};if(da.charAt(0)=='"'&&da.charAt(da.length-1)=='"'&&(da=da.slice(1,-1).replace(/""/g,'"')),Xn.cellText!==!1&&(qa.w=da),da.length===0)qa.t="z";else if(Xn.raw)qa.t="s",qa.v=da;else if(da.trim().length===0)qa.t="s",qa.v=da;else if(da.charCodeAt(0)==61)da.charCodeAt(1)==34&&da.charCodeAt(da.length-1)==34?(qa.t="s",qa.v=da.slice(2,-1).replace(/""/g,'"')):fuzzyfmla(da)?(qa.t="s",qa.f=da.slice(1),qa.v=da):(qa.t="s",qa.v=da);else if(da=="TRUE")qa.t="b",qa.v=!0;else if(da=="FALSE")qa.t="b",qa.v=!1;else if(!isNaN(na=fuzzynum(da)))qa.t="n",qa.v=na;else if(!isNaN((na=fuzzydate(da)).getDate())||ua&&da.match(ua)){if(qa.z=Xn.dateNF||table_fmt[14],ua&&da.match(ua)){var tl=dateNF_fix(da,Xn.dateNF,da.match(ua)||[]);na=parseDate(tl),Xn&&Xn.UTC===!1&&(na=utc_to_local(na))}else Xn&&Xn.UTC===!1?na=utc_to_local(na):Xn.cellText!==!1&&Xn.dateNF&&(qa.w=SSF_format(qa.z,na));Xn.cellDates?(qa.t="d",qa.v=na):(qa.t="n",qa.v=datenum(na)),Xn.cellNF||delete qa.z}else da.charCodeAt(0)==35&&RBErr[da]!=null?(qa.t="e",qa.w=da,qa.v=RBErr[da]):(qa.t="s",qa.v=da);if(qa.t=="z"||(Xn.dense?(qn["!data"][vs]||(qn["!data"][vs]=[]),qn["!data"][vs][ea]=qa):qn[encode_cell({c:ea,r:vs})]=qa),ta=ra+1,la=un.charCodeAt(ta),ys.e.c<ea&&(ys.e.c=ea),ys.e.r<vs&&(ys.e.r=vs),ca==oa)++ea;else if(ea=0,++vs,Xn.sheetRows&&Xn.sheetRows<=vs)return!0}e:for(;ra<un.length;++ra)switch(ca=un.charCodeAt(ra)){case 34:la===34&&(fa=!fa);break;case 13:if(fa)break;un.charCodeAt(ra+1)==10&&++ra;case oa:case 10:if(!fa&&ga())break e;break}return ra-ta>0&&ga(),qn["!ref"]=encode_range(ys),qn}function nn(un,zn){return!(zn&&zn.PRN)||zn.FS||un.slice(0,4)=="sep="||un.indexOf("	")>=0||un.indexOf(",")>=0||un.indexOf(";")>=0?Pi(un,zn):aoa_to_sheet(f(un,zn),zn)}function ln(un,zn){var Xn="",Un=zn.type=="string"?[0,0,0,0]:firstbyte(un,zn);switch(zn.type){case"base64":Xn=Base64_decode(un);break;case"binary":Xn=un;break;case"buffer":zn.codepage==65001?Xn=un.toString("utf8"):(zn.codepage,Xn=has_buf&&Buffer.isBuffer(un)?un.toString("binary"):a2s(un));break;case"array":Xn=cc2str(un);break;case"string":Xn=un;break;default:throw new Error("Unrecognized type "+zn.type)}return Un[0]==239&&Un[1]==187&&Un[2]==191?Xn=utf8read(Xn.slice(3)):zn.type!="string"&&zn.type!="buffer"&&zn.codepage==65001?Xn=utf8read(Xn):zn.type=="binary",Xn.slice(0,19)=="socialcalc:version:"?ETH.to_sheet(zn.type=="string"?Xn:utf8read(Xn),zn):nn(Xn,zn)}function cn(un,zn){return sheet_to_workbook(ln(un,zn),zn)}function hn(un){var zn=[];if(!un["!ref"])return"";for(var Xn=safe_decode_range(un["!ref"]),Un,qn=un["!data"]!=null,ys=Xn.s.r;ys<=Xn.e.r;++ys){for(var vs=[],ea=Xn.s.c;ea<=Xn.e.c;++ea){var na=encode_cell({r:ys,c:ea});if(Un=qn?(un["!data"][ys]||[])[ea]:un[na],!Un||Un.v==null){vs.push("          ");continue}for(var ta=(Un.w||(format_cell(Un),Un.w)||"").slice(0,10);ta.length<10;)ta+=" ";vs.push(ta+(ea===0?" ":""))}zn.push(vs.join(""))}return zn.join(`
`)}return{to_workbook:cn,to_sheet:ln,from_sheet:hn}}(),WK_=function(){function qe(Jo,cl,rl){if(Jo){prep_blob(Jo,Jo.l||0);for(var nl=rl.Enum||Al;Jo.l<Jo.length;){var vl=Jo.read_shift(2),Pl=nl[vl]||nl[65535],Sl=Jo.read_shift(2),El=Jo.l+Sl,Il=Pl.f&&Pl.f(Jo,Sl,rl);if(Jo.l=El,cl(Il,Pl,vl))return}}}function f(Jo,cl){switch(cl.type){case"base64":return Ke(s2a(Base64_decode(Jo)),cl);case"binary":return Ke(s2a(Jo),cl);case"buffer":case"array":return Ke(Jo,cl)}throw"Unsupported type "+cl.type}var ze=["mmmm","dd-mmm-yyyy","dd-mmm","mmm-yyyy","@","mm/dd","hh:mm:ss AM/PM","hh:mm AM/PM","mm/dd/yyyy","mm/dd","hh:mm:ss","hh:mm"];function Ke(Jo,cl){if(!Jo)return Jo;var rl=cl||{},nl={},vl="Sheet1",Pl="",Sl=0,El={},Il=[],$l=[],Ll=[];rl.dense&&(Ll=nl["!data"]=[]);var ml={s:{r:0,c:0},e:{r:0,c:0}},Vl=rl.sheetRows||0,jl={};if(Jo[4]==81&&Jo[5]==80&&Jo[6]==87)return Ol(Jo,cl);if(Jo[2]==0&&(Jo[3]==8||Jo[3]==9)&&Jo.length>=16&&Jo[14]==5&&Jo[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(Jo[2]==2)rl.Enum=Al,qe(Jo,function(Rl,Hl,Wl){switch(Wl){case 0:rl.vers=Rl,Rl>=4096&&(rl.qpro=!0);break;case 255:rl.vers=Rl,rl.works=!0;break;case 6:ml=Rl;break;case 204:Rl&&(Pl=Rl);break;case 222:Pl=Rl;break;case 15:case 51:(!rl.qpro&&!rl.works||Wl==51)&&Rl[1].v.charCodeAt(0)<48&&(Rl[1].v=Rl[1].v.slice(1)),(rl.works||rl.works2)&&(Rl[1].v=Rl[1].v.replace(/\r\n/g,`
`));case 13:case 14:case 16:(Rl[2]&112)==112&&(Rl[2]&15)>1&&(Rl[2]&15)<15&&(Rl[1].z=rl.dateNF||ze[(Rl[2]&15)-1]||table_fmt[14],rl.cellDates&&(Rl[1].v=numdate(Rl[1].v),Rl[1].t=typeof Rl[1].v=="number"?"n":"d")),rl.qpro&&Rl[3]>Sl&&(nl["!ref"]=encode_range(ml),El[vl]=nl,Il.push(vl),nl={},rl.dense&&(Ll=nl["!data"]=[]),ml={s:{r:0,c:0},e:{r:0,c:0}},Sl=Rl[3],vl=Pl||"Sheet"+(Sl+1),Pl="");var zl=rl.dense?(Ll[Rl[0].r]||[])[Rl[0].c]:nl[encode_cell(Rl[0])];if(zl){zl.t=Rl[1].t,zl.v=Rl[1].v,Rl[1].z!=null&&(zl.z=Rl[1].z),Rl[1].f!=null&&(zl.f=Rl[1].f),jl=zl;break}rl.dense?(Ll[Rl[0].r]||(Ll[Rl[0].r]=[]),Ll[Rl[0].r][Rl[0].c]=Rl[1]):nl[encode_cell(Rl[0])]=Rl[1],jl=Rl[1];break;case 21509:rl.works2=!0;break;case 21506:Rl==5281&&(jl.z="hh:mm:ss",rl.cellDates&&jl.t=="n"&&(jl.v=numdate(jl.v),jl.t=typeof jl.v=="number"?"n":"d"));break}},rl);else if(Jo[2]==26||Jo[2]==14)rl.Enum=xl,Jo[2]==14&&(rl.qpro=!0,Jo.l=0),qe(Jo,function(Rl,Hl,Wl){switch(Wl){case 204:vl=Rl;break;case 22:Rl[1].v.charCodeAt(0)<48&&(Rl[1].v=Rl[1].v.slice(1)),Rl[1].v=Rl[1].v.replace(/\x0F./g,function(zl){return String.fromCharCode(zl.charCodeAt(1)-32)}).replace(/\r\n/g,`
`);case 23:case 24:case 25:case 37:case 39:case 40:if(Rl[3]>Sl&&(nl["!ref"]=encode_range(ml),El[vl]=nl,Il.push(vl),nl={},rl.dense&&(Ll=nl["!data"]=[]),ml={s:{r:0,c:0},e:{r:0,c:0}},Sl=Rl[3],vl="Sheet"+(Sl+1)),Vl>0&&Rl[0].r>=Vl)break;rl.dense?(Ll[Rl[0].r]||(Ll[Rl[0].r]=[]),Ll[Rl[0].r][Rl[0].c]=Rl[1]):nl[encode_cell(Rl[0])]=Rl[1],ml.e.c<Rl[0].c&&(ml.e.c=Rl[0].c),ml.e.r<Rl[0].r&&(ml.e.r=Rl[0].r);break;case 27:Rl[14e3]&&($l[Rl[14e3][0]]=Rl[14e3][1]);break;case 1537:$l[Rl[0]]=Rl[1],Rl[0]==Sl&&(vl=Rl[1]);break}},rl);else throw new Error("Unrecognized LOTUS BOF "+Jo[2]);if(nl["!ref"]=encode_range(ml),El[Pl||vl]=nl,Il.push(Pl||vl),!$l.length)return{SheetNames:Il,Sheets:El};for(var Xl={},yl=[],Yl=0;Yl<$l.length;++Yl)El[Il[Yl]]?(yl.push($l[Yl]||Il[Yl]),Xl[$l[Yl]]=El[$l[Yl]]||El[Il[Yl]]):(yl.push($l[Yl]),Xl[$l[Yl]]={"!ref":"A1"});return{SheetNames:yl,Sheets:Xl}}function Qe(Jo,cl){var rl=cl||{};if(+rl.codepage>=0&&set_cp(+rl.codepage),rl.type=="string")throw new Error("Cannot write WK1 to JS string");var nl=buf_array();if(!Jo["!ref"])throw new Error("Cannot export empty sheet to WK1");var vl=safe_decode_range(Jo["!ref"]),Pl=Jo["!data"]!=null,Sl=[];write_biff_rec(nl,0,nn(1030)),write_biff_rec(nl,6,hn(vl));for(var El=Math.min(vl.e.r,8191),Il=vl.s.c;Il<=vl.e.c;++Il)Sl[Il]=encode_col(Il);for(var $l=vl.s.r;$l<=El;++$l){var Ll=encode_row($l);for(Il=vl.s.c;Il<=vl.e.c;++Il){var ml=Pl?(Jo["!data"][$l]||[])[Il]:Jo[Sl[Il]+Ll];if(!(!ml||ml.t=="z"))switch(ml.t){case"n":(ml.v|0)==ml.v&&ml.v>=-32768&&ml.v<=32767?write_biff_rec(nl,13,vs($l,Il,ml)):write_biff_rec(nl,14,na($l,Il,ml));break;case"d":var Vl=datenum(ml.v);(Vl|0)==Vl&&Vl>=-32768&&Vl<=32767?write_biff_rec(nl,13,vs($l,Il,{v:Vl,z:ml.z||table_fmt[14]})):write_biff_rec(nl,14,na($l,Il,{v:Vl,z:ml.z||table_fmt[14]}));break;default:var jl=format_cell(ml);write_biff_rec(nl,15,Un($l,Il,jl.slice(0,239)))}}}return write_biff_rec(nl,1),nl.end()}function Pi(Jo,cl){var rl=cl||{};if(+rl.codepage>=0&&set_cp(+rl.codepage),rl.type=="string")throw new Error("Cannot write WK3 to JS string");var nl=buf_array();write_biff_rec(nl,0,ln(Jo));for(var vl=0,Pl=0;vl<Jo.SheetNames.length;++vl)(Jo.Sheets[Jo.SheetNames[vl]]||{})["!ref"]&&write_biff_rec(nl,27,pl(Jo.SheetNames[vl],Pl++));var Sl=0;for(vl=0;vl<Jo.SheetNames.length;++vl){var El=Jo.Sheets[Jo.SheetNames[vl]];if(!(!El||!El["!ref"])){for(var Il=safe_decode_range(El["!ref"]),$l=El["!data"]!=null,Ll=[],ml=Math.min(Il.e.r,8191),Vl=Il.s.r;Vl<=ml;++Vl)for(var jl=encode_row(Vl),Xl=Il.s.c;Xl<=Il.e.c;++Xl){Vl===Il.s.r&&(Ll[Xl]=encode_col(Xl));var yl=Ll[Xl]+jl,Yl=$l?(El["!data"][Vl]||[])[Xl]:El[yl];if(!(!Yl||Yl.t=="z"))if(Yl.t=="n")write_biff_rec(nl,23,tl(Vl,Xl,Sl,Yl.v));else{var Rl=format_cell(Yl);write_biff_rec(nl,22,ga(Vl,Xl,Sl,Rl.slice(0,239)))}}++Sl}}return write_biff_rec(nl,1),nl.end()}function nn(Jo){var cl=new_buf(2);return cl.write_shift(2,Jo),cl}function ln(Jo){var cl=new_buf(26);cl.write_shift(2,4096),cl.write_shift(2,4),cl.write_shift(4,0);for(var rl=0,nl=0,vl=0,Pl=0;Pl<Jo.SheetNames.length;++Pl){var Sl=Jo.SheetNames[Pl],El=Jo.Sheets[Sl];if(!(!El||!El["!ref"])){++vl;var Il=decode_range(El["!ref"]);rl<Il.e.r&&(rl=Il.e.r),nl<Il.e.c&&(nl=Il.e.c)}}return rl>8191&&(rl=8191),cl.write_shift(2,rl),cl.write_shift(1,vl),cl.write_shift(1,nl),cl.write_shift(2,0),cl.write_shift(2,0),cl.write_shift(1,1),cl.write_shift(1,2),cl.write_shift(4,0),cl.write_shift(4,0),cl}function cn(Jo,cl,rl){var nl={s:{c:0,r:0},e:{c:0,r:0}};return cl==8&&rl.qpro?(nl.s.c=Jo.read_shift(1),Jo.l++,nl.s.r=Jo.read_shift(2),nl.e.c=Jo.read_shift(1),Jo.l++,nl.e.r=Jo.read_shift(2),nl):(nl.s.c=Jo.read_shift(2),nl.s.r=Jo.read_shift(2),cl==12&&rl.qpro&&(Jo.l+=2),nl.e.c=Jo.read_shift(2),nl.e.r=Jo.read_shift(2),cl==12&&rl.qpro&&(Jo.l+=2),nl.s.c==65535&&(nl.s.c=nl.e.c=nl.s.r=nl.e.r=0),nl)}function hn(Jo){var cl=new_buf(8);return cl.write_shift(2,Jo.s.c),cl.write_shift(2,Jo.s.r),cl.write_shift(2,Jo.e.c),cl.write_shift(2,Jo.e.r),cl}function un(Jo,cl,rl){var nl=[{c:0,r:0},{t:"n",v:0},0,0];return rl.qpro&&rl.vers!=20768?(nl[0].c=Jo.read_shift(1),nl[3]=Jo.read_shift(1),nl[0].r=Jo.read_shift(2),Jo.l+=2):rl.works?(nl[0].c=Jo.read_shift(2),nl[0].r=Jo.read_shift(2),nl[2]=Jo.read_shift(2)):(nl[2]=Jo.read_shift(1),nl[0].c=Jo.read_shift(2),nl[0].r=Jo.read_shift(2)),nl}function zn(Jo){return Jo.z&&fmt_is_date(Jo.z)?240|(ze.indexOf(Jo.z)+1||2):255}function Xn(Jo,cl,rl){var nl=Jo.l+cl,vl=un(Jo,cl,rl);if(vl[1].t="s",(rl.vers&65534)==20768){Jo.l++;var Pl=Jo.read_shift(1);return vl[1].v=Jo.read_shift(Pl,"utf8"),vl}return rl.qpro&&Jo.l++,vl[1].v=Jo.read_shift(nl-Jo.l,"cstr"),vl}function Un(Jo,cl,rl){var nl=new_buf(7+rl.length);nl.write_shift(1,255),nl.write_shift(2,cl),nl.write_shift(2,Jo),nl.write_shift(1,39);for(var vl=0;vl<nl.length;++vl){var Pl=rl.charCodeAt(vl);nl.write_shift(1,Pl>=128?95:Pl)}return nl.write_shift(1,0),nl}function qn(Jo,cl,rl){var nl=Jo.l+cl,vl=un(Jo,cl,rl);if(vl[1].t="s",rl.vers==20768){var Pl=Jo.read_shift(1);return vl[1].v=Jo.read_shift(Pl,"utf8"),vl}return vl[1].v=Jo.read_shift(nl-Jo.l,"cstr"),vl}function ys(Jo,cl,rl){var nl=un(Jo,cl,rl);return nl[1].v=Jo.read_shift(2,"i"),nl}function vs(Jo,cl,rl){var nl=new_buf(7);return nl.write_shift(1,zn(rl)),nl.write_shift(2,cl),nl.write_shift(2,Jo),nl.write_shift(2,rl.v,"i"),nl}function ea(Jo,cl,rl){var nl=un(Jo,cl,rl);return nl[1].v=Jo.read_shift(8,"f"),nl}function na(Jo,cl,rl){var nl=new_buf(13);return nl.write_shift(1,zn(rl)),nl.write_shift(2,cl),nl.write_shift(2,Jo),nl.write_shift(8,rl.v,"f"),nl}function ta(Jo,cl,rl){var nl=Jo.l+cl,vl=un(Jo,cl,rl);if(vl[1].v=Jo.read_shift(8,"f"),rl.qpro)Jo.l=nl;else{var Pl=Jo.read_shift(2);ca(Jo.slice(Jo.l,Jo.l+Pl),vl),Jo.l+=Pl}return vl}function ra(Jo,cl,rl){var nl=cl&32768;return cl&=-32769,cl=(nl?Jo:0)+(cl>=8192?cl-16384:cl),(nl?"":"$")+(rl?encode_col(cl):encode_row(cl))}var oa={31:["NA",0],33:["ABS",1],34:["TRUNC",1],35:["SQRT",1],36:["LOG",1],37:["LN",1],38:["PI",0],39:["SIN",1],40:["COS",1],41:["TAN",1],42:["ATAN2",2],43:["ATAN",1],44:["ASIN",1],45:["ACOS",1],46:["EXP",1],47:["MOD",2],49:["ISNA",1],50:["ISERR",1],51:["FALSE",0],52:["TRUE",0],53:["RAND",0],54:["DATE",3],63:["ROUND",2],64:["TIME",3],68:["ISNUMBER",1],69:["ISTEXT",1],70:["LEN",1],71:["VALUE",1],73:["MID",3],74:["CHAR",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],102:["UPPER",1],103:["LOWER",1],107:["PROPER",1],109:["TRIM",1],111:["T",1]},fa=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function ca(Jo,cl){prep_blob(Jo,0);for(var rl=[],nl=0,vl="",Pl="",Sl="",El="";Jo.l<Jo.length;){var Il=Jo[Jo.l++];switch(Il){case 0:rl.push(Jo.read_shift(8,"f"));break;case 1:Pl=ra(cl[0].c,Jo.read_shift(2),!0),vl=ra(cl[0].r,Jo.read_shift(2),!1),rl.push(Pl+vl);break;case 2:{var $l=ra(cl[0].c,Jo.read_shift(2),!0),Ll=ra(cl[0].r,Jo.read_shift(2),!1);Pl=ra(cl[0].c,Jo.read_shift(2),!0),vl=ra(cl[0].r,Jo.read_shift(2),!1),rl.push($l+Ll+":"+Pl+vl)}break;case 3:if(Jo.l<Jo.length){console.error("WK1 premature formula end");return}break;case 4:rl.push("("+rl.pop()+")");break;case 5:rl.push(Jo.read_shift(2));break;case 6:{for(var ml="";Il=Jo[Jo.l++];)ml+=String.fromCharCode(Il);rl.push('"'+ml.replace(/"/g,'""')+'"')}break;case 8:rl.push("-"+rl.pop());break;case 23:rl.push("+"+rl.pop());break;case 22:rl.push("NOT("+rl.pop()+")");break;case 20:case 21:El=rl.pop(),Sl=rl.pop(),rl.push(["AND","OR"][Il-20]+"("+Sl+","+El+")");break;default:if(Il<32&&fa[Il])El=rl.pop(),Sl=rl.pop(),rl.push(Sl+fa[Il]+El);else if(oa[Il]){if(nl=oa[Il][1],nl==69&&(nl=Jo[Jo.l++]),nl>rl.length){console.error("WK1 bad formula parse 0x"+Il.toString(16)+":|"+rl.join("|")+"|");return}var Vl=rl.slice(-nl);rl.length-=nl,rl.push(oa[Il][0]+"("+Vl.join(",")+")")}else return Il<=7?console.error("WK1 invalid opcode "+Il.toString(16)):Il<=24?console.error("WK1 unsupported op "+Il.toString(16)):Il<=30?console.error("WK1 invalid opcode "+Il.toString(16)):Il<=115?console.error("WK1 unsupported function opcode "+Il.toString(16)):console.error("WK1 unrecognized opcode "+Il.toString(16))}}rl.length==1?cl[1].f=""+rl[0]:console.error("WK1 bad formula parse |"+rl.join("|")+"|")}function la(Jo){var cl=[{c:0,r:0},{t:"n",v:0},0];return cl[0].r=Jo.read_shift(2),cl[3]=Jo[Jo.l++],cl[0].c=Jo[Jo.l++],cl}function ua(Jo,cl){var rl=la(Jo);return rl[1].t="s",rl[1].v=Jo.read_shift(cl-4,"cstr"),rl}function ga(Jo,cl,rl,nl){var vl=new_buf(6+nl.length);vl.write_shift(2,Jo),vl.write_shift(1,rl),vl.write_shift(1,cl),vl.write_shift(1,39);for(var Pl=0;Pl<nl.length;++Pl){var Sl=nl.charCodeAt(Pl);vl.write_shift(1,Sl>=128?95:Sl)}return vl.write_shift(1,0),vl}function da(Jo,cl){var rl=la(Jo);rl[1].v=Jo.read_shift(2);var nl=rl[1].v>>1;if(rl[1].v&1)switch(nl&7){case 0:nl=(nl>>3)*5e3;break;case 1:nl=(nl>>3)*500;break;case 2:nl=(nl>>3)/20;break;case 3:nl=(nl>>3)/200;break;case 4:nl=(nl>>3)/2e3;break;case 5:nl=(nl>>3)/2e4;break;case 6:nl=(nl>>3)/16;break;case 7:nl=(nl>>3)/64;break}return rl[1].v=nl,rl}function qa(Jo,cl){var rl=la(Jo),nl=Jo.read_shift(4),vl=Jo.read_shift(4),Pl=Jo.read_shift(2);if(Pl==65535)return nl===0&&vl===3221225472?(rl[1].t="e",rl[1].v=15):nl===0&&vl===3489660928?(rl[1].t="e",rl[1].v=42):rl[1].v=0,rl;var Sl=Pl&32768;return Pl=(Pl&32767)-16446,rl[1].v=(1-Sl*2)*(vl*Math.pow(2,Pl+32)+nl*Math.pow(2,Pl)),rl}function tl(Jo,cl,rl,nl){var vl=new_buf(14);if(vl.write_shift(2,Jo),vl.write_shift(1,rl),vl.write_shift(1,cl),nl==0)return vl.write_shift(4,0),vl.write_shift(4,0),vl.write_shift(2,65535),vl;var Pl=0,Sl=0,El=0,Il=0;return nl<0&&(Pl=1,nl=-nl),Sl=Math.log2(nl)|0,nl/=Math.pow(2,Sl-31),Il=nl>>>0,(Il&2147483648)==0&&(nl/=2,++Sl,Il=nl>>>0),nl-=Il,Il|=2147483648,Il>>>=0,nl*=Math.pow(2,32),El=nl>>>0,vl.write_shift(4,El),vl.write_shift(4,Il),Sl+=16383+(Pl?32768:0),vl.write_shift(2,Sl),vl}function ol(Jo,cl){var rl=qa(Jo);return Jo.l+=cl-14,rl}function hl(Jo,cl){var rl=la(Jo),nl=Jo.read_shift(4);return rl[1].v=nl>>6,rl}function wl(Jo,cl){var rl=la(Jo),nl=Jo.read_shift(8,"f");return rl[1].v=nl,rl}function _l(Jo,cl){var rl=wl(Jo);return Jo.l+=cl-12,rl}function gl(Jo,cl){return Jo[Jo.l+cl-1]==0?Jo.read_shift(cl,"cstr"):""}function dl(Jo,cl){var rl=Jo[Jo.l++];rl>cl-1&&(rl=cl-1);for(var nl="";nl.length<rl;)nl+=String.fromCharCode(Jo[Jo.l++]);return nl}function sl(Jo,cl,rl){if(!(!rl.qpro||cl<21)){var nl=Jo.read_shift(1);Jo.l+=17,Jo.l+=1,Jo.l+=2;var vl=Jo.read_shift(cl-21,"cstr");return[nl,vl]}}function kl(Jo,cl){for(var rl={},nl=Jo.l+cl;Jo.l<nl;){var vl=Jo.read_shift(2);if(vl==14e3){for(rl[vl]=[0,""],rl[vl][0]=Jo.read_shift(2);Jo[Jo.l];)rl[vl][1]+=String.fromCharCode(Jo[Jo.l]),Jo.l++;Jo.l++}}return rl}function pl(Jo,cl){var rl=new_buf(5+Jo.length);rl.write_shift(2,14e3),rl.write_shift(2,cl);for(var nl=0;nl<Jo.length;++nl){var vl=Jo.charCodeAt(nl);rl[rl.l++]=vl>127?95:vl}return rl[rl.l++]=0,rl}var Al={0:{n:"BOF",f:parseuint16},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:cn},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:ys},14:{n:"NUMBER",f:ea},15:{n:"LABEL",f:Xn},16:{n:"FORMULA",f:ta},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:qn},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:gl},222:{n:"SHEETNAMELP",f:dl},255:{n:"BOF",f:parseuint16},21506:{n:"WKSNF",f:parseuint16},65535:{n:""}},xl={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:ua},23:{n:"NUMBER17",f:qa},24:{n:"NUMBER18",f:da},25:{n:"FORMULA19",f:ol},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:kl},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:hl},38:{n:"??"},39:{n:"NUMBER27",f:wl},40:{n:"FORMULA28",f:_l},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:gl},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:sl},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}},al={5:"dd-mmm-yy",6:"dd-mmm",7:"mmm-yy",8:"mm/dd/yy",10:"hh:mm:ss AM/PM",11:"hh:mm AM/PM",14:"dd-mmm-yyyy",15:"mmm-yyyy",34:"0.00",50:"0.00;[Red]0.00",66:"0.00;(0.00)",82:"0.00;[Red](0.00)",162:'"$"#,##0.00;\\("$"#,##0.00\\)',288:"0%",304:"0E+00",320:"# ?/?"};function Fl(Jo){var cl=Jo.read_shift(2),rl=Jo.read_shift(1);if(rl!=0)throw"unsupported QPW string type "+rl.toString(16);return Jo.read_shift(cl,"sbcs-cont")}function Ol(Jo,cl){prep_blob(Jo,0);var rl=cl||{},nl={};rl.dense&&(nl["!data"]=[]);var vl=[],Pl="",Sl={s:{r:-1,c:-1},e:{r:-1,c:-1}},El=0,Il=0,$l=0,Ll=0,ml={SheetNames:[],Sheets:{}},Vl=[];e:for(;Jo.l<Jo.length;){var jl=Jo.read_shift(2),Xl=Jo.read_shift(2),yl=Jo.slice(Jo.l,Jo.l+Xl);switch(prep_blob(yl,0),jl){case 1:if(yl.read_shift(4)!=962023505)throw"Bad QPW9 BOF!";break;case 2:break e;case 8:break;case 10:for(var Yl=yl.read_shift(4),Rl=(yl.length-yl.l)/Yl|0,Hl=0;Hl<Yl;++Hl){var Wl=yl.l+Rl,zl={};yl.l+=2,zl.numFmtId=yl.read_shift(2),al[zl.numFmtId]&&(zl.z=al[zl.numFmtId]),yl.l=Wl,Vl.push(zl)}break;case 1025:break;case 1026:break;case 1031:for(yl.l+=12;yl.l<yl.length;)El=yl.read_shift(2),Il=yl.read_shift(1),vl.push(yl.read_shift(El,"cstr"));break;case 1032:break;case 1537:{var Gl=yl.read_shift(2);nl={},rl.dense&&(nl["!data"]=[]),Sl.s.c=yl.read_shift(2),Sl.e.c=yl.read_shift(2),Sl.s.r=yl.read_shift(4),Sl.e.r=yl.read_shift(4),yl.l+=4,yl.l+2<yl.length&&(El=yl.read_shift(2),Il=yl.read_shift(1),Pl=El==0?"":yl.read_shift(El,"cstr")),Pl||(Pl=encode_col(Gl))}break;case 1538:{if(Sl.s.c>255||Sl.s.r>999999)break;Sl.e.c<Sl.s.c&&(Sl.e.c=Sl.s.c),Sl.e.r<Sl.s.r&&(Sl.e.r=Sl.s.r),nl["!ref"]=encode_range(Sl),book_append_sheet(ml,nl,Pl)}break;case 2561:$l=yl.read_shift(2),Sl.e.c<$l&&(Sl.e.c=$l),Sl.s.c>$l&&(Sl.s.c=$l),Ll=yl.read_shift(4),Sl.s.r>Ll&&(Sl.s.r=Ll),Ll=yl.read_shift(4),Sl.e.r<Ll&&(Sl.e.r=Ll);break;case 3073:{Ll=yl.read_shift(4),El=yl.read_shift(4),Sl.s.r>Ll&&(Sl.s.r=Ll),Sl.e.r<Ll+El-1&&(Sl.e.r=Ll+El-1);for(var Jl=encode_col($l);yl.l<yl.length;){var ql={t:"z"},Zl=yl.read_shift(1),Ql=-1;Zl&128&&(Ql=yl.read_shift(2));var ec=Zl&64?yl.read_shift(2)-1:0;switch(Zl&31){case 0:break;case 1:break;case 2:ql={t:"n",v:yl.read_shift(2)};break;case 3:ql={t:"n",v:yl.read_shift(2,"i")};break;case 4:ql={t:"n",v:parse_RkNumber(yl)};break;case 5:ql={t:"n",v:yl.read_shift(8,"f")};break;case 7:ql={t:"s",v:vl[Il=yl.read_shift(4)-1]};break;case 8:ql={t:"n",v:yl.read_shift(8,"f")},yl.l+=2,yl.l+=4,isNaN(ql.v)&&(ql={t:"e",v:15});break;default:throw"Unrecognized QPW cell type "+(Zl&31)}Ql!=-1&&(Vl[Ql-1]||{}).z&&(ql.z=Vl[Ql-1].z);var tc=0;if(Zl&32)switch(Zl&31){case 2:tc=yl.read_shift(2);break;case 3:tc=yl.read_shift(2,"i");break;case 7:tc=yl.read_shift(2);break;default:throw"Unsupported delta for QPW cell type "+(Zl&31)}if(!(!rl.sheetStubs&&ql.t=="z")){var ac=dup(ql);ql.t=="n"&&ql.z&&fmt_is_date(ql.z)&&rl.cellDates&&(ac.v=numdate(ql.v),ac.t=typeof ac.v=="number"?"n":"d"),nl["!data"]!=null?(nl["!data"][Ll]||(nl["!data"][Ll]=[]),nl["!data"][Ll][$l]=ac):nl[Jl+encode_row(Ll)]=ac}for(++Ll,--El;ec-- >0&&El>=0;){if(Zl&32)switch(Zl&31){case 2:ql={t:"n",v:ql.v+tc&65535};break;case 3:ql={t:"n",v:ql.v+tc&65535},ql.v>32767&&(ql.v-=65536);break;case 7:ql={t:"s",v:vl[Il=Il+tc>>>0]};break;default:throw"Cannot apply delta for QPW cell type "+(Zl&31)}else switch(Zl&31){case 1:ql={t:"z"};break;case 2:ql={t:"n",v:yl.read_shift(2)};break;case 7:ql={t:"s",v:vl[Il=yl.read_shift(4)-1]};break;default:throw"Cannot apply repeat for QPW cell type "+(Zl&31)}!rl.sheetStubs&&ql.t=="z"||(nl["!data"]!=null?(nl["!data"][Ll]||(nl["!data"][Ll]=[]),nl["!data"][Ll][$l]=ql):nl[Jl+encode_row(Ll)]=ql),++Ll,--El}}}break;case 3074:{$l=yl.read_shift(2),Ll=yl.read_shift(4);var oc=Fl(yl);nl["!data"]!=null?(nl["!data"][Ll]||(nl["!data"][Ll]=[]),nl["!data"][Ll][$l]={t:"s",v:oc}):nl[encode_col($l)+encode_row(Ll)]={t:"s",v:oc}}break}Jo.l+=Xl}return ml}return{sheet_to_wk1:Qe,book_to_wk3:Pi,to_workbook:f}}(),straywsregex=/^\s|\s$|[\t\n\r]/;function write_sst_xml(qe,f){if(!f.bookSST)return"";var ze=[XML_HEADER];ze[ze.length]=writextag("sst",null,{xmlns:XMLNS_main[0],count:qe.Count,uniqueCount:qe.Unique});for(var Ke=0;Ke!=qe.length;++Ke)if(qe[Ke]!=null){var Qe=qe[Ke],Pi="<si>";Qe.r?Pi+=Qe.r:(Pi+="<t",Qe.t||(Qe.t=""),typeof Qe.t!="string"&&(Qe.t=String(Qe.t)),Qe.t.match(straywsregex)&&(Pi+=' xml:space="preserve"'),Pi+=">"+escapexml(Qe.t)+"</t>"),Pi+="</si>",ze[ze.length]=Pi}return ze.length>2&&(ze[ze.length]="</sst>",ze[1]=ze[1].replace("/>",">")),ze.join("")}function parse_BrtBeginSst(qe){return[qe.read_shift(4),qe.read_shift(4)]}function write_BrtBeginSst(qe,f){return f||(f=new_buf(8)),f.write_shift(4,qe.Count),f.write_shift(4,qe.Unique),f}var write_BrtSSTItem=write_RichStr;function write_sst_bin(qe){var f=buf_array();write_record(f,159,write_BrtBeginSst(qe));for(var ze=0;ze<qe.length;++ze)write_record(f,19,write_BrtSSTItem(qe[ze]));return write_record(f,160),f.end()}function _JS2ANSI(qe){for(var f=[],ze=qe.split(""),Ke=0;Ke<ze.length;++Ke)f[Ke]=ze[Ke].charCodeAt(0);return f}function crypto_CreatePasswordVerifier_Method1(qe){var f=0,ze,Ke=_JS2ANSI(qe),Qe=Ke.length+1,Pi,nn,ln,cn,hn;for(ze=new_raw_buf(Qe),ze[0]=Ke.length,Pi=1;Pi!=Qe;++Pi)ze[Pi]=Ke[Pi-1];for(Pi=Qe-1;Pi>=0;--Pi)nn=ze[Pi],ln=(f&16384)===0?0:1,cn=f<<1&32767,hn=ln|cn,f=hn^nn;return f^52811}function sheet_to_rtf(qe,f){var ze=["{\\rtf1\\ansi"];if(!qe["!ref"])return ze[0]+"}";for(var Ke=safe_decode_range(qe["!ref"]),Qe,Pi=qe["!data"]!=null,nn=[],ln=Ke.s.r;ln<=Ke.e.r;++ln){ze.push("\\trowd\\trautofit1");for(var cn=Ke.s.c;cn<=Ke.e.c;++cn)ze.push("\\cellx"+(cn+1));for(ze.push("\\pard\\intbl"),Pi&&(nn=qe["!data"][ln]||[]),cn=Ke.s.c;cn<=Ke.e.c;++cn){var hn=encode_cell({r:ln,c:cn});if(Qe=Pi?nn[cn]:qe[hn],!Qe||Qe.v==null&&(!Qe.f||Qe.F)){ze.push(" \\cell");continue}ze.push(" "+(Qe.w||(format_cell(Qe),Qe.w)||"").replace(/[\r\n]/g,"\\par ")),ze.push("\\cell")}ze.push("\\pard\\intbl\\row")}return ze.join("")+"}"}function rgb2Hex(qe){for(var f=0,ze=1;f!=3;++f)ze=ze*256+(qe[f]>255?255:qe[f]<0?0:qe[f]);return ze.toString(16).toUpperCase().slice(1)}var DEF_MDW=6,MDW=DEF_MDW;function width2px(qe){return Math.floor((qe+Math.round(128/MDW)/256)*MDW)}function px2char(qe){return Math.floor((qe-5)/MDW*100+.5)/100}function char2width(qe){return Math.round((qe*MDW+5)/MDW*256)/256}function process_col(qe){qe.width?(qe.wpx=width2px(qe.width),qe.wch=px2char(qe.wpx),qe.MDW=MDW):qe.wpx?(qe.wch=px2char(qe.wpx),qe.width=char2width(qe.wch),qe.MDW=MDW):typeof qe.wch=="number"&&(qe.width=char2width(qe.wch),qe.wpx=width2px(qe.width),qe.MDW=MDW),qe.customWidth&&delete qe.customWidth}var DEF_PPI=96,PPI=DEF_PPI;function px2pt(qe){return qe*96/PPI}function pt2px(qe){return qe*PPI/96}function write_numFmts(qe){var f=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach(function(ze){for(var Ke=ze[0];Ke<=ze[1];++Ke)qe[Ke]!=null&&(f[f.length]=writextag("numFmt",null,{numFmtId:Ke,formatCode:escapexml(qe[Ke])}))}),f.length===1?"":(f[f.length]="</numFmts>",f[0]=writextag("numFmts",null,{count:f.length-2}).replace("/>",">"),f.join(""))}function write_cellXfs(qe){var f=[];return f[f.length]=writextag("cellXfs",null),qe.forEach(function(ze){f[f.length]=writextag("xf",null,ze)}),f[f.length]="</cellXfs>",f.length===2?"":(f[0]=writextag("cellXfs",null,{count:f.length-2}).replace("/>",">"),f.join(""))}function write_sty_xml(qe,f){var ze=[XML_HEADER,writextag("styleSheet",null,{xmlns:XMLNS_main[0],"xmlns:vt":XMLNS.vt})],Ke;return qe.SSF&&(Ke=write_numFmts(qe.SSF))!=null&&(ze[ze.length]=Ke),ze[ze.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',ze[ze.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',ze[ze.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',ze[ze.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(Ke=write_cellXfs(f.cellXfs))&&(ze[ze.length]=Ke),ze[ze.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',ze[ze.length]='<dxfs count="0"/>',ze[ze.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',ze.length>2&&(ze[ze.length]="</styleSheet>",ze[1]=ze[1].replace("/>",">")),ze.join("")}function parse_BrtFmt(qe,f){var ze=qe.read_shift(2),Ke=parse_XLWideString(qe);return[ze,Ke]}function write_BrtFmt(qe,f,ze){ze||(ze=new_buf(6+4*f.length)),ze.write_shift(2,qe),write_XLWideString(f,ze);var Ke=ze.length>ze.l?ze.slice(0,ze.l):ze;return ze.l==null&&(ze.l=ze.length),Ke}function parse_BrtFont(qe,f,ze){var Ke={};Ke.sz=qe.read_shift(2)/20;var Qe=parse_FontFlags(qe);Qe.fItalic&&(Ke.italic=1),Qe.fCondense&&(Ke.condense=1),Qe.fExtend&&(Ke.extend=1),Qe.fShadow&&(Ke.shadow=1),Qe.fOutline&&(Ke.outline=1),Qe.fStrikeout&&(Ke.strike=1);var Pi=qe.read_shift(2);switch(Pi===700&&(Ke.bold=1),qe.read_shift(2)){case 1:Ke.vertAlign="superscript";break;case 2:Ke.vertAlign="subscript";break}var nn=qe.read_shift(1);nn!=0&&(Ke.underline=nn);var ln=qe.read_shift(1);ln>0&&(Ke.family=ln);var cn=qe.read_shift(1);switch(cn>0&&(Ke.charset=cn),qe.l++,Ke.color=parse_BrtColor(qe),qe.read_shift(1)){case 1:Ke.scheme="major";break;case 2:Ke.scheme="minor";break}return Ke.name=parse_XLWideString(qe),Ke}function write_BrtFont(qe,f){f||(f=new_buf(25+4*32)),f.write_shift(2,qe.sz*20),write_FontFlags(qe,f),f.write_shift(2,qe.bold?700:400);var ze=0;qe.vertAlign=="superscript"?ze=1:qe.vertAlign=="subscript"&&(ze=2),f.write_shift(2,ze),f.write_shift(1,qe.underline||0),f.write_shift(1,qe.family||0),f.write_shift(1,qe.charset||0),f.write_shift(1,0),write_BrtColor(qe.color,f);var Ke=0;return Ke=2,f.write_shift(1,Ke),write_XLWideString(qe.name,f),f.length>f.l?f.slice(0,f.l):f}var XLSBFillPTNames=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"],rev_XLSBFillPTNames,parse_BrtFill=parsenoop;function write_BrtFill(qe,f){f||(f=new_buf(4*3+8*7+16*1)),rev_XLSBFillPTNames||(rev_XLSBFillPTNames=evert(XLSBFillPTNames));var ze=rev_XLSBFillPTNames[qe.patternType];ze==null&&(ze=40),f.write_shift(4,ze);var Ke=0;if(ze!=40)for(write_BrtColor({auto:1},f),write_BrtColor({auto:1},f);Ke<12;++Ke)f.write_shift(4,0);else{for(;Ke<4;++Ke)f.write_shift(4,0);for(;Ke<12;++Ke)f.write_shift(4,0)}return f.length>f.l?f.slice(0,f.l):f}function parse_BrtXF(qe,f){var ze=qe.l+f,Ke=qe.read_shift(2),Qe=qe.read_shift(2);return qe.l=ze,{ixfe:Ke,numFmtId:Qe}}function write_BrtXF(qe,f,ze){ze||(ze=new_buf(16)),ze.write_shift(2,f||0),ze.write_shift(2,qe.numFmtId||0),ze.write_shift(2,0),ze.write_shift(2,0),ze.write_shift(2,0),ze.write_shift(1,0),ze.write_shift(1,0);var Ke=0;return ze.write_shift(1,Ke),ze.write_shift(1,0),ze.write_shift(1,0),ze.write_shift(1,0),ze}function write_Blxf(qe,f){return f||(f=new_buf(10)),f.write_shift(1,0),f.write_shift(1,0),f.write_shift(4,0),f.write_shift(4,0),f}var parse_BrtBorder=parsenoop;function write_BrtBorder(qe,f){return f||(f=new_buf(51)),f.write_shift(1,0),write_Blxf(null,f),write_Blxf(null,f),write_Blxf(null,f),write_Blxf(null,f),write_Blxf(null,f),f.length>f.l?f.slice(0,f.l):f}function write_BrtStyle(qe,f){return f||(f=new_buf(12+4*10)),f.write_shift(4,qe.xfId),f.write_shift(2,1),f.write_shift(1,0),f.write_shift(1,0),write_XLNullableWideString(qe.name||"",f),f.length>f.l?f.slice(0,f.l):f}function write_BrtBeginTableStyles(qe,f,ze){var Ke=new_buf(2052);return Ke.write_shift(4,qe),write_XLNullableWideString(f,Ke),write_XLNullableWideString(ze,Ke),Ke.length>Ke.l?Ke.slice(0,Ke.l):Ke}function write_FMTS_bin(qe,f){if(f){var ze=0;[[5,8],[23,26],[41,44],[50,392]].forEach(function(Ke){for(var Qe=Ke[0];Qe<=Ke[1];++Qe)f[Qe]!=null&&++ze}),ze!=0&&(write_record(qe,615,write_UInt32LE(ze)),[[5,8],[23,26],[41,44],[50,392]].forEach(function(Ke){for(var Qe=Ke[0];Qe<=Ke[1];++Qe)f[Qe]!=null&&write_record(qe,44,write_BrtFmt(Qe,f[Qe]))}),write_record(qe,616))}}function write_FONTS_bin(qe){var f=1;write_record(qe,611,write_UInt32LE(f)),write_record(qe,43,write_BrtFont({sz:12,color:{theme:1},name:"Calibri",family:2})),write_record(qe,612)}function write_FILLS_bin(qe){var f=2;write_record(qe,603,write_UInt32LE(f)),write_record(qe,45,write_BrtFill({patternType:"none"})),write_record(qe,45,write_BrtFill({patternType:"gray125"})),write_record(qe,604)}function write_BORDERS_bin(qe){var f=1;write_record(qe,613,write_UInt32LE(f)),write_record(qe,46,write_BrtBorder()),write_record(qe,614)}function write_CELLSTYLEXFS_bin(qe){var f=1;write_record(qe,626,write_UInt32LE(f)),write_record(qe,47,write_BrtXF({numFmtId:0},65535)),write_record(qe,627)}function write_CELLXFS_bin(qe,f){write_record(qe,617,write_UInt32LE(f.length)),f.forEach(function(ze){write_record(qe,47,write_BrtXF(ze,0))}),write_record(qe,618)}function write_STYLES_bin(qe){var f=1;write_record(qe,619,write_UInt32LE(f)),write_record(qe,48,write_BrtStyle({xfId:0,name:"Normal"})),write_record(qe,620)}function write_DXFS_bin(qe){var f=0;write_record(qe,505,write_UInt32LE(f)),write_record(qe,506)}function write_TABLESTYLES_bin(qe){var f=0;write_record(qe,508,write_BrtBeginTableStyles(f,"TableStyleMedium9","PivotStyleMedium4")),write_record(qe,509)}function write_sty_bin(qe,f){var ze=buf_array();return write_record(ze,278),write_FMTS_bin(ze,qe.SSF),write_FONTS_bin(ze),write_FILLS_bin(ze),write_BORDERS_bin(ze),write_CELLSTYLEXFS_bin(ze),write_CELLXFS_bin(ze,f.cellXfs),write_STYLES_bin(ze),write_DXFS_bin(ze),write_TABLESTYLES_bin(ze),write_record(ze,279),ze.end()}function write_theme(qe,f){if(f&&f.themeXLSX)return f.themeXLSX;if(qe&&typeof qe.raw=="string")return qe.raw;var ze=[XML_HEADER];return ze[ze.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',ze[ze.length]="<a:themeElements>",ze[ze.length]='<a:clrScheme name="Office">',ze[ze.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',ze[ze.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',ze[ze.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',ze[ze.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',ze[ze.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',ze[ze.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',ze[ze.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',ze[ze.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',ze[ze.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',ze[ze.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',ze[ze.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',ze[ze.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',ze[ze.length]="</a:clrScheme>",ze[ze.length]='<a:fontScheme name="Office">',ze[ze.length]="<a:majorFont>",ze[ze.length]='<a:latin typeface="Cambria"/>',ze[ze.length]='<a:ea typeface=""/>',ze[ze.length]='<a:cs typeface=""/>',ze[ze.length]='<a:font script="Jpan" typeface=" "/>',ze[ze.length]='<a:font script="Hang" typeface=" "/>',ze[ze.length]='<a:font script="Hans" typeface=""/>',ze[ze.length]='<a:font script="Hant" typeface=""/>',ze[ze.length]='<a:font script="Arab" typeface="Times New Roman"/>',ze[ze.length]='<a:font script="Hebr" typeface="Times New Roman"/>',ze[ze.length]='<a:font script="Thai" typeface="Tahoma"/>',ze[ze.length]='<a:font script="Ethi" typeface="Nyala"/>',ze[ze.length]='<a:font script="Beng" typeface="Vrinda"/>',ze[ze.length]='<a:font script="Gujr" typeface="Shruti"/>',ze[ze.length]='<a:font script="Khmr" typeface="MoolBoran"/>',ze[ze.length]='<a:font script="Knda" typeface="Tunga"/>',ze[ze.length]='<a:font script="Guru" typeface="Raavi"/>',ze[ze.length]='<a:font script="Cans" typeface="Euphemia"/>',ze[ze.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',ze[ze.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',ze[ze.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',ze[ze.length]='<a:font script="Thaa" typeface="MV Boli"/>',ze[ze.length]='<a:font script="Deva" typeface="Mangal"/>',ze[ze.length]='<a:font script="Telu" typeface="Gautami"/>',ze[ze.length]='<a:font script="Taml" typeface="Latha"/>',ze[ze.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',ze[ze.length]='<a:font script="Orya" typeface="Kalinga"/>',ze[ze.length]='<a:font script="Mlym" typeface="Kartika"/>',ze[ze.length]='<a:font script="Laoo" typeface="DokChampa"/>',ze[ze.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',ze[ze.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',ze[ze.length]='<a:font script="Viet" typeface="Times New Roman"/>',ze[ze.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',ze[ze.length]='<a:font script="Geor" typeface="Sylfaen"/>',ze[ze.length]="</a:majorFont>",ze[ze.length]="<a:minorFont>",ze[ze.length]='<a:latin typeface="Calibri"/>',ze[ze.length]='<a:ea typeface=""/>',ze[ze.length]='<a:cs typeface=""/>',ze[ze.length]='<a:font script="Jpan" typeface=" "/>',ze[ze.length]='<a:font script="Hang" typeface=" "/>',ze[ze.length]='<a:font script="Hans" typeface=""/>',ze[ze.length]='<a:font script="Hant" typeface=""/>',ze[ze.length]='<a:font script="Arab" typeface="Arial"/>',ze[ze.length]='<a:font script="Hebr" typeface="Arial"/>',ze[ze.length]='<a:font script="Thai" typeface="Tahoma"/>',ze[ze.length]='<a:font script="Ethi" typeface="Nyala"/>',ze[ze.length]='<a:font script="Beng" typeface="Vrinda"/>',ze[ze.length]='<a:font script="Gujr" typeface="Shruti"/>',ze[ze.length]='<a:font script="Khmr" typeface="DaunPenh"/>',ze[ze.length]='<a:font script="Knda" typeface="Tunga"/>',ze[ze.length]='<a:font script="Guru" typeface="Raavi"/>',ze[ze.length]='<a:font script="Cans" typeface="Euphemia"/>',ze[ze.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',ze[ze.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',ze[ze.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',ze[ze.length]='<a:font script="Thaa" typeface="MV Boli"/>',ze[ze.length]='<a:font script="Deva" typeface="Mangal"/>',ze[ze.length]='<a:font script="Telu" typeface="Gautami"/>',ze[ze.length]='<a:font script="Taml" typeface="Latha"/>',ze[ze.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',ze[ze.length]='<a:font script="Orya" typeface="Kalinga"/>',ze[ze.length]='<a:font script="Mlym" typeface="Kartika"/>',ze[ze.length]='<a:font script="Laoo" typeface="DokChampa"/>',ze[ze.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',ze[ze.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',ze[ze.length]='<a:font script="Viet" typeface="Arial"/>',ze[ze.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',ze[ze.length]='<a:font script="Geor" typeface="Sylfaen"/>',ze[ze.length]="</a:minorFont>",ze[ze.length]="</a:fontScheme>",ze[ze.length]='<a:fmtScheme name="Office">',ze[ze.length]="<a:fillStyleLst>",ze[ze.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',ze[ze.length]='<a:gradFill rotWithShape="1">',ze[ze.length]="<a:gsLst>",ze[ze.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',ze[ze.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',ze[ze.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',ze[ze.length]="</a:gsLst>",ze[ze.length]='<a:lin ang="16200000" scaled="1"/>',ze[ze.length]="</a:gradFill>",ze[ze.length]='<a:gradFill rotWithShape="1">',ze[ze.length]="<a:gsLst>",ze[ze.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',ze[ze.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',ze[ze.length]="</a:gsLst>",ze[ze.length]='<a:lin ang="16200000" scaled="0"/>',ze[ze.length]="</a:gradFill>",ze[ze.length]="</a:fillStyleLst>",ze[ze.length]="<a:lnStyleLst>",ze[ze.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',ze[ze.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',ze[ze.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',ze[ze.length]="</a:lnStyleLst>",ze[ze.length]="<a:effectStyleLst>",ze[ze.length]="<a:effectStyle>",ze[ze.length]="<a:effectLst>",ze[ze.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',ze[ze.length]="</a:effectLst>",ze[ze.length]="</a:effectStyle>",ze[ze.length]="<a:effectStyle>",ze[ze.length]="<a:effectLst>",ze[ze.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',ze[ze.length]="</a:effectLst>",ze[ze.length]="</a:effectStyle>",ze[ze.length]="<a:effectStyle>",ze[ze.length]="<a:effectLst>",ze[ze.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',ze[ze.length]="</a:effectLst>",ze[ze.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',ze[ze.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',ze[ze.length]="</a:effectStyle>",ze[ze.length]="</a:effectStyleLst>",ze[ze.length]="<a:bgFillStyleLst>",ze[ze.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',ze[ze.length]='<a:gradFill rotWithShape="1">',ze[ze.length]="<a:gsLst>",ze[ze.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',ze[ze.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',ze[ze.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',ze[ze.length]="</a:gsLst>",ze[ze.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',ze[ze.length]="</a:gradFill>",ze[ze.length]='<a:gradFill rotWithShape="1">',ze[ze.length]="<a:gsLst>",ze[ze.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',ze[ze.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',ze[ze.length]="</a:gsLst>",ze[ze.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',ze[ze.length]="</a:gradFill>",ze[ze.length]="</a:bgFillStyleLst>",ze[ze.length]="</a:fmtScheme>",ze[ze.length]="</a:themeElements>",ze[ze.length]="<a:objectDefaults>",ze[ze.length]="<a:spDef>",ze[ze.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',ze[ze.length]="</a:spDef>",ze[ze.length]="<a:lnDef>",ze[ze.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',ze[ze.length]="</a:lnDef>",ze[ze.length]="</a:objectDefaults>",ze[ze.length]="<a:extraClrSchemeLst/>",ze[ze.length]="</a:theme>",ze.join("")}function parse_BrtMdtinfo(qe,f){return{flags:qe.read_shift(4),version:qe.read_shift(4),name:parse_XLWideString(qe)}}function write_BrtMdtinfo(qe){var f=new_buf(12+2*qe.name.length);return f.write_shift(4,qe.flags),f.write_shift(4,qe.version),write_XLWideString(qe.name,f),f.slice(0,f.l)}function parse_BrtMdb(qe){for(var f=[],ze=qe.read_shift(4);ze-- >0;)f.push([qe.read_shift(4),qe.read_shift(4)]);return f}function write_BrtMdb(qe){var f=new_buf(4+8*qe.length);f.write_shift(4,qe.length);for(var ze=0;ze<qe.length;++ze)f.write_shift(4,qe[ze][0]),f.write_shift(4,qe[ze][1]);return f}function write_BrtBeginEsfmd(qe,f){var ze=new_buf(8+2*f.length);return ze.write_shift(4,qe),write_XLWideString(f,ze),ze.slice(0,ze.l)}function parse_BrtBeginEsmdb(qe){return qe.l+=4,qe.read_shift(4)!=0}function write_BrtBeginEsmdb(qe,f){var ze=new_buf(8);return ze.write_shift(4,qe),ze.write_shift(4,1),ze}function write_xlmeta_bin(){var qe=buf_array();return write_record(qe,332),write_record(qe,334,write_UInt32LE(1)),write_record(qe,335,write_BrtMdtinfo({name:"XLDAPR",version:12e4,flags:3496657072})),write_record(qe,336),write_record(qe,339,write_BrtBeginEsfmd(1,"XLDAPR")),write_record(qe,52),write_record(qe,35,write_UInt32LE(514)),write_record(qe,4096,write_UInt32LE(0)),write_record(qe,4097,writeuint16(1)),write_record(qe,36),write_record(qe,53),write_record(qe,340),write_record(qe,337,write_BrtBeginEsmdb(1)),write_record(qe,51,write_BrtMdb([[1,0]])),write_record(qe,338),write_record(qe,333),qe.end()}function write_xlmeta_xml(){var qe=[XML_HEADER];return qe.push(`<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">
  <metadataTypes count="1">
    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>
  </metadataTypes>
  <futureMetadata name="XLDAPR" count="1">
    <bk>
      <extLst>
        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">
          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>
        </ext>
      </extLst>
    </bk>
  </futureMetadata>
  <cellMetadata count="1">
    <bk>
      <rc t="1" v="0"/>
    </bk>
  </cellMetadata>
</metadata>`),qe.join("")}function parse_BrtCalcChainItem$(qe){var f={};f.i=qe.read_shift(4);var ze={};ze.r=qe.read_shift(4),ze.c=qe.read_shift(4),f.r=encode_cell(ze);var Ke=qe.read_shift(1);return Ke&2&&(f.l="1"),Ke&8&&(f.a="1"),f}function write_vml(qe,f,ze){var Ke=[21600,21600],Qe=["m0,0l0",Ke[1],Ke[0],Ke[1],Ke[0],"0xe"].join(","),Pi=[writextag("xml",null,{"xmlns:v":XLMLNS.v,"xmlns:o":XLMLNS.o,"xmlns:x":XLMLNS.x,"xmlns:mv":XLMLNS.mv}).replace(/\/>/,">"),writextag("o:shapelayout",writextag("o:idmap",null,{"v:ext":"edit",data:qe}),{"v:ext":"edit"})],nn=65536*qe,ln=f||[];return ln.length>0&&Pi.push(writextag("v:shapetype",[writextag("v:stroke",null,{joinstyle:"miter"}),writextag("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202",coordsize:Ke.join(","),"o:spt":202,path:Qe})),ln.forEach(function(cn){++nn,Pi.push(write_vml_comment(cn,nn))}),Pi.push("</xml>"),Pi.join("")}function write_vml_comment(qe,f,ze){var Ke=decode_cell(qe[0]),Qe={color2:"#BEFF82",type:"gradient"};Qe.type=="gradient"&&(Qe.angle="-180");var Pi=Qe.type=="gradient"?writextag("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,nn=writextag("v:fill",Pi,Qe),ln={on:"t",obscured:"t"};return["<v:shape"+wxt_helper({id:"_x0000_s"+f,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(qe[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",nn,writextag("v:shadow",null,ln),writextag("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",writetag("x:Anchor",[Ke.c+1,0,Ke.r+1,0,Ke.c+3,20,Ke.r+5,20].join(",")),writetag("x:AutoFill","False"),writetag("x:Row",String(Ke.r)),writetag("x:Column",String(Ke.c)),qe[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"].join("")}function write_comments_xml(qe){var f=[XML_HEADER,writextag("comments",null,{xmlns:XMLNS_main[0]})],ze=[];return f.push("<authors>"),qe.forEach(function(Ke){Ke[1].forEach(function(Qe){var Pi=escapexml(Qe.a);ze.indexOf(Pi)==-1&&(ze.push(Pi),f.push("<author>"+Pi+"</author>")),Qe.T&&Qe.ID&&ze.indexOf("tc="+Qe.ID)==-1&&(ze.push("tc="+Qe.ID),f.push("<author>tc="+Qe.ID+"</author>"))})}),ze.length==0&&(ze.push("SheetJ5"),f.push("<author>SheetJ5</author>")),f.push("</authors>"),f.push("<commentList>"),qe.forEach(function(Ke){var Qe=0,Pi=[],nn=0;if(Ke[1][0]&&Ke[1][0].T&&Ke[1][0].ID&&(Qe=ze.indexOf("tc="+Ke[1][0].ID)),Ke[1].forEach(function(hn){hn.a&&(Qe=ze.indexOf(escapexml(hn.a))),hn.T&&++nn,Pi.push(hn.t==null?"":escapexml(hn.t))}),nn===0)Ke[1].forEach(function(hn){f.push('<comment ref="'+Ke[0]+'" authorId="'+ze.indexOf(escapexml(hn.a))+'"><text>'),f.push(writetag("t",hn.t==null?"":escapexml(hn.t))),f.push("</text></comment>")});else{Ke[1][0]&&Ke[1][0].T&&Ke[1][0].ID&&(Qe=ze.indexOf("tc="+Ke[1][0].ID)),f.push('<comment ref="'+Ke[0]+'" authorId="'+Qe+'"><text>');for(var ln=`Comment:
    `+Pi[0]+`
`,cn=1;cn<Pi.length;++cn)ln+=`Reply:
    `+Pi[cn]+`
`;f.push(writetag("t",escapexml(ln))),f.push("</text></comment>")}}),f.push("</commentList>"),f.length>2&&(f[f.length]="</comments>",f[1]=f[1].replace("/>",">")),f.join("")}function write_tcmnt_xml(qe,f,ze){var Ke=[XML_HEADER,writextag("ThreadedComments",null,{xmlns:XMLNS.TCMNT}).replace(/[\/]>/,">")];return qe.forEach(function(Qe){var Pi="";(Qe[1]||[]).forEach(function(nn,ln){if(!nn.T){delete nn.ID;return}nn.a&&f.indexOf(nn.a)==-1&&f.push(nn.a);var cn={ref:Qe[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+ze.tcid++).slice(-12)+"}"};ln==0?Pi=cn.id:cn.parentId=Pi,nn.ID=cn.id,nn.a&&(cn.personId="{54EE7950-7262-4200-6969-"+("000000000000"+f.indexOf(nn.a)).slice(-12)+"}"),Ke.push(writextag("threadedComment",writetag("text",nn.t||""),cn))})}),Ke.push("</ThreadedComments>"),Ke.join("")}function write_people_xml(qe){var f=[XML_HEADER,writextag("personList",null,{xmlns:XMLNS.TCMNT,"xmlns:x":XMLNS_main[0]}).replace(/[\/]>/,">")];return qe.forEach(function(ze,Ke){f.push(writextag("person",null,{displayName:ze,id:"{54EE7950-7262-4200-6969-"+("000000000000"+Ke).slice(-12)+"}",userId:ze,providerId:"None"}))}),f.push("</personList>"),f.join("")}function parse_BrtBeginComment(qe){var f={};f.iauthor=qe.read_shift(4);var ze=parse_UncheckedRfX(qe);return f.rfx=ze.s,f.ref=encode_cell(ze.s),qe.l+=16,f}function write_BrtBeginComment(qe,f){return f==null&&(f=new_buf(36)),f.write_shift(4,qe[1].iauthor),write_UncheckedRfX(qe[0],f),f.write_shift(4,0),f.write_shift(4,0),f.write_shift(4,0),f.write_shift(4,0),f}var parse_BrtCommentAuthor=parse_XLWideString;function write_BrtCommentAuthor(qe){return write_XLWideString(qe.slice(0,54))}function write_comments_bin(qe){var f=buf_array(),ze=[];return write_record(f,628),write_record(f,630),qe.forEach(function(Ke){Ke[1].forEach(function(Qe){ze.indexOf(Qe.a)>-1||(ze.push(Qe.a.slice(0,54)),write_record(f,632,write_BrtCommentAuthor(Qe.a)),Qe.T&&Qe.ID&&ze.indexOf("tc="+Qe.ID)==-1&&(ze.push("tc="+Qe.ID),write_record(f,632,write_BrtCommentAuthor("tc="+Qe.ID))))})}),write_record(f,631),write_record(f,633),qe.forEach(function(Ke){Ke[1].forEach(function(Qe){var Pi=-1;Qe.ID&&(Pi=ze.indexOf("tc="+Qe.ID)),Pi==-1&&Ke[1][0].T&&Ke[1][0].ID&&(Pi=ze.indexOf("tc="+Ke[1][0].ID)),Pi==-1&&(Pi=ze.indexOf(Qe.a)),Qe.iauthor=Pi;var nn={s:decode_cell(Ke[0]),e:decode_cell(Ke[0])};write_record(f,635,write_BrtBeginComment([nn,Qe])),Qe.t&&Qe.t.length>0&&write_record(f,637,write_BrtCommentText(Qe)),write_record(f,636),delete Qe.iauthor})}),write_record(f,634),write_record(f,629),f.end()}function fill_vba_xls(qe,f){f.FullPaths.forEach(function(ze,Ke){if(Ke!=0){var Qe=ze.replace(/^[\/]*[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");Qe.slice(-1)!=="/"&&CFB.utils.cfb_add(qe,Qe,f.FileIndex[Ke].content)}})}var VBAFMTS=["xlsb","xlsm","xlam","biff8","xla"],rc_to_a1=function(){var qe=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,f={r:0,c:0};function ze(Ke,Qe,Pi,nn){var ln=!1,cn=!1;Pi.length==0?cn=!0:Pi.charAt(0)=="["&&(cn=!0,Pi=Pi.slice(1,-1)),nn.length==0?ln=!0:nn.charAt(0)=="["&&(ln=!0,nn=nn.slice(1,-1));var hn=Pi.length>0?parseInt(Pi,10)|0:0,un=nn.length>0?parseInt(nn,10)|0:0;return ln?un+=f.c:--un,cn?hn+=f.r:--hn,Qe+(ln?"":"$")+encode_col(un)+(cn?"":"$")+encode_row(hn)}return function(Qe,Pi){return f=Pi,Qe.replace(qe,ze)}}(),crefregex=/(^|[^._A-Z0-9])(\$?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])(\$?)(\d{1,7})(?![_.\(A-Za-z0-9])/g;try{crefregex=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g}catch{}var a1_to_rc=function(){return function(f,ze){return f.replace(crefregex,function(Ke,Qe,Pi,nn,ln,cn){var hn=decode_col(nn)-(Pi?0:ze.c),un=decode_row(cn)-(ln?0:ze.r),zn=ln=="$"?un+1:un==0?"":"["+un+"]",Xn=Pi=="$"?hn+1:hn==0?"":"["+hn+"]";return Qe+"R"+zn+"C"+Xn})}}();function shift_formula_str(qe,f){return qe.replace(crefregex,function(ze,Ke,Qe,Pi,nn,ln){return Ke+(Qe=="$"?Qe+Pi:encode_col(decode_col(Pi)+f.c))+(nn=="$"?nn+ln:encode_row(decode_row(ln)+f.r))})}function fuzzyfmla(qe){return qe.length!=1}function parseread1(qe){qe.l+=1}function parse_ColRelU(qe,f){var ze=qe.read_shift(2);return[ze&16383,ze>>14&1,ze>>15&1]}function parse_RgceArea(qe,f,ze){var Ke=2;if(ze){if(ze.biff>=2&&ze.biff<=5)return parse_RgceArea_BIFF2(qe);ze.biff==12&&(Ke=4)}var Qe=qe.read_shift(Ke),Pi=qe.read_shift(Ke),nn=parse_ColRelU(qe),ln=parse_ColRelU(qe);return{s:{r:Qe,c:nn[0],cRel:nn[1],rRel:nn[2]},e:{r:Pi,c:ln[0],cRel:ln[1],rRel:ln[2]}}}function parse_RgceArea_BIFF2(qe){var f=parse_ColRelU(qe),ze=parse_ColRelU(qe),Ke=qe.read_shift(1),Qe=qe.read_shift(1);return{s:{r:f[0],c:Ke,cRel:f[1],rRel:f[2]},e:{r:ze[0],c:Qe,cRel:ze[1],rRel:ze[2]}}}function parse_RgceAreaRel(qe,f,ze){if(ze.biff<8)return parse_RgceArea_BIFF2(qe);var Ke=qe.read_shift(ze.biff==12?4:2),Qe=qe.read_shift(ze.biff==12?4:2),Pi=parse_ColRelU(qe),nn=parse_ColRelU(qe);return{s:{r:Ke,c:Pi[0],cRel:Pi[1],rRel:Pi[2]},e:{r:Qe,c:nn[0],cRel:nn[1],rRel:nn[2]}}}function parse_RgceLoc(qe,f,ze){if(ze&&ze.biff>=2&&ze.biff<=5)return parse_RgceLoc_BIFF2(qe);var Ke=qe.read_shift(ze&&ze.biff==12?4:2),Qe=parse_ColRelU(qe);return{r:Ke,c:Qe[0],cRel:Qe[1],rRel:Qe[2]}}function parse_RgceLoc_BIFF2(qe){var f=parse_ColRelU(qe),ze=qe.read_shift(1);return{r:f[0],c:ze,cRel:f[1],rRel:f[2]}}function parse_RgceElfLoc(qe){var f=qe.read_shift(2),ze=qe.read_shift(2);return{r:f,c:ze&255,fQuoted:!!(ze&16384),cRel:ze>>15,rRel:ze>>15}}function parse_RgceLocRel(qe,f,ze){var Ke=ze&&ze.biff?ze.biff:8;if(Ke>=2&&Ke<=5)return parse_RgceLocRel_BIFF2(qe);var Qe=qe.read_shift(Ke>=12?4:2),Pi=qe.read_shift(2),nn=(Pi&16384)>>14,ln=(Pi&32768)>>15;if(Pi&=16383,ln==1)for(;Qe>524287;)Qe-=1048576;if(nn==1)for(;Pi>8191;)Pi=Pi-16384;return{r:Qe,c:Pi,cRel:nn,rRel:ln}}function parse_RgceLocRel_BIFF2(qe){var f=qe.read_shift(2),ze=qe.read_shift(1),Ke=(f&32768)>>15,Qe=(f&16384)>>14;return f&=16383,Ke==1&&f>=8192&&(f=f-16384),Qe==1&&ze>=128&&(ze=ze-256),{r:f,c:ze,cRel:Qe,rRel:Ke}}function parse_PtgArea(qe,f,ze){var Ke=(qe[qe.l++]&96)>>5,Qe=parse_RgceArea(qe,ze.biff>=2&&ze.biff<=5?6:8,ze);return[Ke,Qe]}function parse_PtgArea3d(qe,f,ze){var Ke=(qe[qe.l++]&96)>>5,Qe=qe.read_shift(2,"i"),Pi=8;if(ze)switch(ze.biff){case 5:qe.l+=12,Pi=6;break;case 12:Pi=12;break}var nn=parse_RgceArea(qe,Pi,ze);return[Ke,Qe,nn]}function parse_PtgAreaErr(qe,f,ze){var Ke=(qe[qe.l++]&96)>>5;return qe.l+=ze&&ze.biff>8?12:ze.biff<8?6:8,[Ke]}function parse_PtgAreaErr3d(qe,f,ze){var Ke=(qe[qe.l++]&96)>>5,Qe=qe.read_shift(2),Pi=8;if(ze)switch(ze.biff){case 5:qe.l+=12,Pi=6;break;case 12:Pi=12;break}return qe.l+=Pi,[Ke,Qe]}function parse_PtgAreaN(qe,f,ze){var Ke=(qe[qe.l++]&96)>>5,Qe=parse_RgceAreaRel(qe,f-1,ze);return[Ke,Qe]}function parse_PtgArray(qe,f,ze){var Ke=(qe[qe.l++]&96)>>5;return qe.l+=ze.biff==2?6:ze.biff==12?14:7,[Ke]}function parse_PtgAttrBaxcel(qe){var f=qe[qe.l+1]&1,ze=1;return qe.l+=4,[f,ze]}function parse_PtgAttrChoose(qe,f,ze){qe.l+=2;for(var Ke=qe.read_shift(ze&&ze.biff==2?1:2),Qe=[],Pi=0;Pi<=Ke;++Pi)Qe.push(qe.read_shift(ze&&ze.biff==2?1:2));return Qe}function parse_PtgAttrGoto(qe,f,ze){var Ke=qe[qe.l+1]&255?1:0;return qe.l+=2,[Ke,qe.read_shift(ze&&ze.biff==2?1:2)]}function parse_PtgAttrIf(qe,f,ze){var Ke=qe[qe.l+1]&255?1:0;return qe.l+=2,[Ke,qe.read_shift(ze&&ze.biff==2?1:2)]}function parse_PtgAttrIfError(qe){var f=qe[qe.l+1]&255?1:0;return qe.l+=2,[f,qe.read_shift(2)]}function parse_PtgAttrSemi(qe,f,ze){var Ke=qe[qe.l+1]&255?1:0;return qe.l+=ze&&ze.biff==2?3:4,[Ke]}function parse_PtgAttrSpaceType(qe){var f=qe.read_shift(1),ze=qe.read_shift(1);return[f,ze]}function parse_PtgAttrSpace(qe){return qe.read_shift(2),parse_PtgAttrSpaceType(qe)}function parse_PtgAttrSpaceSemi(qe){return qe.read_shift(2),parse_PtgAttrSpaceType(qe)}function parse_PtgRef(qe,f,ze){var Ke=(qe[qe.l]&96)>>5;qe.l+=1;var Qe=parse_RgceLoc(qe,0,ze);return[Ke,Qe]}function parse_PtgRefN(qe,f,ze){var Ke=(qe[qe.l]&96)>>5;qe.l+=1;var Qe=parse_RgceLocRel(qe,0,ze);return[Ke,Qe]}function parse_PtgRef3d(qe,f,ze){var Ke=(qe[qe.l]&96)>>5;qe.l+=1;var Qe=qe.read_shift(2);ze&&ze.biff==5&&(qe.l+=12);var Pi=parse_RgceLoc(qe,0,ze);return[Ke,Qe,Pi]}function parse_PtgFunc(qe,f,ze){var Ke=(qe[qe.l]&96)>>5;qe.l+=1;var Qe=qe.read_shift(ze&&ze.biff<=3?1:2);return[FtabArgc[Qe],Ftab[Qe],Ke]}function parse_PtgFuncVar(qe,f,ze){var Ke=qe[qe.l++],Qe=qe.read_shift(1),Pi=ze&&ze.biff<=3?[Ke==88?-1:0,qe.read_shift(1)]:parsetab(qe);return[Qe,(Pi[0]===0?Ftab:Cetab)[Pi[1]]]}function parsetab(qe){return[qe[qe.l+1]>>7,qe.read_shift(2)&32767]}function parse_PtgAttrSum(qe,f,ze){qe.l+=ze&&ze.biff==2?3:4}function parse_PtgExp(qe,f,ze){if(qe.l++,ze&&ze.biff==12)return[qe.read_shift(4,"i"),0];var Ke=qe.read_shift(2),Qe=qe.read_shift(ze&&ze.biff==2?1:2);return[Ke,Qe]}function parse_PtgErr(qe){return qe.l++,BErr[qe.read_shift(1)]}function parse_PtgInt(qe){return qe.l++,qe.read_shift(2)}function parse_PtgBool(qe){return qe.l++,qe.read_shift(1)!==0}function parse_PtgNum(qe){return qe.l++,parse_Xnum(qe)}function parse_PtgStr(qe,f,ze){return qe.l++,parse_ShortXLUnicodeString(qe,f-1,ze)}function parse_SerAr(qe,f){var ze=[qe.read_shift(1)];if(f==12)switch(ze[0]){case 2:ze[0]=4;break;case 4:ze[0]=16;break;case 0:ze[0]=1;break;case 1:ze[0]=2;break}switch(ze[0]){case 4:ze[1]=parsebool(qe,1)?"TRUE":"FALSE",f!=12&&(qe.l+=7);break;case 37:case 16:ze[1]=BErr[qe[qe.l]],qe.l+=f==12?4:8;break;case 0:qe.l+=8;break;case 1:ze[1]=parse_Xnum(qe);break;case 2:ze[1]=parse_XLUnicodeString2(qe,0,{biff:f>0&&f<8?2:f});break;default:throw new Error("Bad SerAr: "+ze[0])}return ze}function parse_PtgExtraMem(qe,f,ze){for(var Ke=qe.read_shift(ze.biff==12?4:2),Qe=[],Pi=0;Pi!=Ke;++Pi)Qe.push((ze.biff==12?parse_UncheckedRfX:parse_Ref8U)(qe));return Qe}function parse_PtgExtraArray(qe,f,ze){var Ke=0,Qe=0;ze.biff==12?(Ke=qe.read_shift(4),Qe=qe.read_shift(4)):(Qe=1+qe.read_shift(1),Ke=1+qe.read_shift(2)),ze.biff>=2&&ze.biff<8&&(--Ke,--Qe==0&&(Qe=256));for(var Pi=0,nn=[];Pi!=Ke&&(nn[Pi]=[]);++Pi)for(var ln=0;ln!=Qe;++ln)nn[Pi][ln]=parse_SerAr(qe,ze.biff);return nn}function parse_PtgName(qe,f,ze){var Ke=qe.read_shift(1)>>>5&3,Qe=!ze||ze.biff>=8?4:2,Pi=qe.read_shift(Qe);switch(ze.biff){case 2:qe.l+=5;break;case 3:case 4:qe.l+=8;break;case 5:qe.l+=12;break}return[Ke,0,Pi]}function parse_PtgNameX(qe,f,ze){if(ze.biff==5)return parse_PtgNameX_BIFF5(qe);var Ke=qe.read_shift(1)>>>5&3,Qe=qe.read_shift(2),Pi=qe.read_shift(4);return[Ke,Qe,Pi]}function parse_PtgNameX_BIFF5(qe){var f=qe.read_shift(1)>>>5&3,ze=qe.read_shift(2,"i");qe.l+=8;var Ke=qe.read_shift(2);return qe.l+=12,[f,ze,Ke]}function parse_PtgMemArea(qe,f,ze){var Ke=qe.read_shift(1)>>>5&3;qe.l+=ze&&ze.biff==2?3:4;var Qe=qe.read_shift(ze&&ze.biff==2?1:2);return[Ke,Qe]}function parse_PtgMemFunc(qe,f,ze){var Ke=qe.read_shift(1)>>>5&3,Qe=qe.read_shift(ze&&ze.biff==2?1:2);return[Ke,Qe]}function parse_PtgRefErr(qe,f,ze){var Ke=qe.read_shift(1)>>>5&3;return qe.l+=4,ze.biff<8&&qe.l--,ze.biff==12&&(qe.l+=2),[Ke]}function parse_PtgRefErr3d(qe,f,ze){var Ke=(qe[qe.l++]&96)>>5,Qe=qe.read_shift(2),Pi=4;if(ze)switch(ze.biff){case 5:Pi=15;break;case 12:Pi=6;break}return qe.l+=Pi,[Ke,Qe]}var parse_PtgMemErr=parsenoop,parse_PtgMemNoMem=parsenoop,parse_PtgTbl=parsenoop;function parse_PtgElfLoc(qe,f,ze){return qe.l+=2,[parse_RgceElfLoc(qe)]}function parse_PtgElfNoop(qe){return qe.l+=6,[]}var parse_PtgElfCol=parse_PtgElfLoc,parse_PtgElfColS=parse_PtgElfNoop,parse_PtgElfColSV=parse_PtgElfNoop,parse_PtgElfColV=parse_PtgElfLoc;function parse_PtgElfLel(qe){return qe.l+=2,[parseuint16(qe),qe.read_shift(2)&1]}var parse_PtgElfRadical=parse_PtgElfLoc,parse_PtgElfRadicalLel=parse_PtgElfLel,parse_PtgElfRadicalS=parse_PtgElfNoop,parse_PtgElfRw=parse_PtgElfLoc,parse_PtgElfRwV=parse_PtgElfLoc,PtgListRT=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function parse_PtgList(qe){qe.l+=2;var f=qe.read_shift(2),ze=qe.read_shift(2),Ke=qe.read_shift(4),Qe=qe.read_shift(2),Pi=qe.read_shift(2),nn=PtgListRT[ze>>2&31];return{ixti:f,coltype:ze&3,rt:nn,idx:Ke,c:Qe,C:Pi}}function parse_PtgSxName(qe){return qe.l+=2,[qe.read_shift(4)]}function parse_PtgSheet(qe,f,ze){return qe.l+=5,qe.l+=2,qe.l+=ze.biff==2?1:4,["PTGSHEET"]}function parse_PtgEndSheet(qe,f,ze){return qe.l+=ze.biff==2?4:5,["PTGENDSHEET"]}function parse_PtgMemAreaN(qe){var f=qe.read_shift(1)>>>5&3,ze=qe.read_shift(2);return[f,ze]}function parse_PtgMemNoMemN(qe){var f=qe.read_shift(1)>>>5&3,ze=qe.read_shift(2);return[f,ze]}function parse_PtgAttrNoop(qe){return qe.l+=4,[0,0]}var PtgTypes={1:{n:"PtgExp",f:parse_PtgExp},2:{n:"PtgTbl",f:parse_PtgTbl},3:{n:"PtgAdd",f:parseread1},4:{n:"PtgSub",f:parseread1},5:{n:"PtgMul",f:parseread1},6:{n:"PtgDiv",f:parseread1},7:{n:"PtgPower",f:parseread1},8:{n:"PtgConcat",f:parseread1},9:{n:"PtgLt",f:parseread1},10:{n:"PtgLe",f:parseread1},11:{n:"PtgEq",f:parseread1},12:{n:"PtgGe",f:parseread1},13:{n:"PtgGt",f:parseread1},14:{n:"PtgNe",f:parseread1},15:{n:"PtgIsect",f:parseread1},16:{n:"PtgUnion",f:parseread1},17:{n:"PtgRange",f:parseread1},18:{n:"PtgUplus",f:parseread1},19:{n:"PtgUminus",f:parseread1},20:{n:"PtgPercent",f:parseread1},21:{n:"PtgParen",f:parseread1},22:{n:"PtgMissArg",f:parseread1},23:{n:"PtgStr",f:parse_PtgStr},26:{n:"PtgSheet",f:parse_PtgSheet},27:{n:"PtgEndSheet",f:parse_PtgEndSheet},28:{n:"PtgErr",f:parse_PtgErr},29:{n:"PtgBool",f:parse_PtgBool},30:{n:"PtgInt",f:parse_PtgInt},31:{n:"PtgNum",f:parse_PtgNum},32:{n:"PtgArray",f:parse_PtgArray},33:{n:"PtgFunc",f:parse_PtgFunc},34:{n:"PtgFuncVar",f:parse_PtgFuncVar},35:{n:"PtgName",f:parse_PtgName},36:{n:"PtgRef",f:parse_PtgRef},37:{n:"PtgArea",f:parse_PtgArea},38:{n:"PtgMemArea",f:parse_PtgMemArea},39:{n:"PtgMemErr",f:parse_PtgMemErr},40:{n:"PtgMemNoMem",f:parse_PtgMemNoMem},41:{n:"PtgMemFunc",f:parse_PtgMemFunc},42:{n:"PtgRefErr",f:parse_PtgRefErr},43:{n:"PtgAreaErr",f:parse_PtgAreaErr},44:{n:"PtgRefN",f:parse_PtgRefN},45:{n:"PtgAreaN",f:parse_PtgAreaN},46:{n:"PtgMemAreaN",f:parse_PtgMemAreaN},47:{n:"PtgMemNoMemN",f:parse_PtgMemNoMemN},57:{n:"PtgNameX",f:parse_PtgNameX},58:{n:"PtgRef3d",f:parse_PtgRef3d},59:{n:"PtgArea3d",f:parse_PtgArea3d},60:{n:"PtgRefErr3d",f:parse_PtgRefErr3d},61:{n:"PtgAreaErr3d",f:parse_PtgAreaErr3d},255:{}},PtgDupes={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},Ptg18={1:{n:"PtgElfLel",f:parse_PtgElfLel},2:{n:"PtgElfRw",f:parse_PtgElfRw},3:{n:"PtgElfCol",f:parse_PtgElfCol},6:{n:"PtgElfRwV",f:parse_PtgElfRwV},7:{n:"PtgElfColV",f:parse_PtgElfColV},10:{n:"PtgElfRadical",f:parse_PtgElfRadical},11:{n:"PtgElfRadicalS",f:parse_PtgElfRadicalS},13:{n:"PtgElfColS",f:parse_PtgElfColS},15:{n:"PtgElfColSV",f:parse_PtgElfColSV},16:{n:"PtgElfRadicalLel",f:parse_PtgElfRadicalLel},25:{n:"PtgList",f:parse_PtgList},29:{n:"PtgSxName",f:parse_PtgSxName},255:{}},Ptg19={0:{n:"PtgAttrNoop",f:parse_PtgAttrNoop},1:{n:"PtgAttrSemi",f:parse_PtgAttrSemi},2:{n:"PtgAttrIf",f:parse_PtgAttrIf},4:{n:"PtgAttrChoose",f:parse_PtgAttrChoose},8:{n:"PtgAttrGoto",f:parse_PtgAttrGoto},16:{n:"PtgAttrSum",f:parse_PtgAttrSum},32:{n:"PtgAttrBaxcel",f:parse_PtgAttrBaxcel},33:{n:"PtgAttrBaxcel",f:parse_PtgAttrBaxcel},64:{n:"PtgAttrSpace",f:parse_PtgAttrSpace},65:{n:"PtgAttrSpaceSemi",f:parse_PtgAttrSpaceSemi},128:{n:"PtgAttrIfError",f:parse_PtgAttrIfError},255:{}};function parse_RgbExtra(qe,f,ze,Ke){if(Ke.biff<8)return parsenoop(qe,f);for(var Qe=qe.l+f,Pi=[],nn=0;nn!==ze.length;++nn)switch(ze[nn][0]){case"PtgArray":ze[nn][1]=parse_PtgExtraArray(qe,0,Ke),Pi.push(ze[nn][1]);break;case"PtgMemArea":ze[nn][2]=parse_PtgExtraMem(qe,ze[nn][1],Ke),Pi.push(ze[nn][2]);break;case"PtgExp":Ke&&Ke.biff==12&&(ze[nn][1][1]=qe.read_shift(4),Pi.push(ze[nn][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+ze[nn][0]}return f=Qe-qe.l,f!==0&&Pi.push(parsenoop(qe,f)),Pi}function parse_Rgce(qe,f,ze){for(var Ke=qe.l+f,Qe,Pi,nn=[];Ke!=qe.l;)f=Ke-qe.l,Pi=qe[qe.l],Qe=PtgTypes[Pi]||PtgTypes[PtgDupes[Pi]],(Pi===24||Pi===25)&&(Qe=(Pi===24?Ptg18:Ptg19)[qe[qe.l+1]]),!Qe||!Qe.f?parsenoop(qe,f):nn.push([Qe.n,Qe.f(qe,f,ze)]);return nn}function stringify_array(qe){for(var f=[],ze=0;ze<qe.length;++ze){for(var Ke=qe[ze],Qe=[],Pi=0;Pi<Ke.length;++Pi){var nn=Ke[Pi];if(nn)switch(nn[0]){case 2:Qe.push('"'+nn[1].replace(/"/g,'""')+'"');break;default:Qe.push(nn[1])}else Qe.push("")}f.push(Qe.join(","))}return f.join(";")}var PtgBinOp={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function make_3d_range(qe,f){var ze=qe.lastIndexOf("!"),Ke=f.lastIndexOf("!");return ze==-1&&Ke==-1?qe+":"+f:ze>0&&Ke>0&&qe.slice(0,ze).toLowerCase()==f.slice(0,Ke).toLowerCase()?qe+":"+f.slice(Ke+1):(console.error("Cannot hydrate range",qe,f),qe+":"+f)}function get_ixti_raw(qe,f,ze){if(!qe)return"SH33TJSERR0";if(ze.biff>8&&(!qe.XTI||!qe.XTI[f]))return qe.SheetNames[f];if(!qe.XTI)return"SH33TJSERR6";var Ke=qe.XTI[f];if(ze.biff<8)return f>1e4&&(f-=65536),f<0&&(f=-f),f==0?"":qe.XTI[f-1];if(!Ke)return"SH33TJSERR1";var Qe="";if(ze.biff>8)switch(qe[Ke[0]][0]){case 357:return Qe=Ke[1]==-1?"#REF":qe.SheetNames[Ke[1]],Ke[1]==Ke[2]?Qe:Qe+":"+qe.SheetNames[Ke[2]];case 358:return ze.SID!=null?qe.SheetNames[ze.SID]:"SH33TJSSAME"+qe[Ke[0]][0];case 355:default:return"SH33TJSSRC"+qe[Ke[0]][0]}switch(qe[Ke[0]][0][0]){case 1025:return Qe=Ke[1]==-1?"#REF":qe.SheetNames[Ke[1]]||"SH33TJSERR3",Ke[1]==Ke[2]?Qe:Qe+":"+qe.SheetNames[Ke[2]];case 14849:return qe[Ke[0]].slice(1).map(function(Pi){return Pi.Name}).join(";;");default:return qe[Ke[0]][0][3]?(Qe=Ke[1]==-1?"#REF":qe[Ke[0]][0][3][Ke[1]]||"SH33TJSERR4",Ke[1]==Ke[2]?Qe:Qe+":"+qe[Ke[0]][0][3][Ke[2]]):"SH33TJSERR2"}}function get_ixti(qe,f,ze){var Ke=get_ixti_raw(qe,f,ze);return Ke=="#REF"?Ke:formula_quote_sheet_name(Ke,ze)}function stringify_formula(qe,f,ze,Ke,Qe){var Pi=Qe&&Qe.biff||8,nn={s:{c:0,r:0}},ln=[],cn,hn,un,zn=0,Xn=0,Un,qn="";if(!qe[0]||!qe[0][0])return"";for(var ys=-1,vs="",ea=0,na=qe[0].length;ea<na;++ea){var ta=qe[0][ea];switch(ta[0]){case"PtgUminus":ln.push("-"+ln.pop());break;case"PtgUplus":ln.push("+"+ln.pop());break;case"PtgPercent":ln.push(ln.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(cn=ln.pop(),hn=ln.pop(),ys>=0){switch(qe[0][ys][1][0]){case 0:vs=fill$1(" ",qe[0][ys][1][1]);break;case 1:vs=fill$1("\r",qe[0][ys][1][1]);break;default:if(vs="",Qe.WTF)throw new Error("Unexpected PtgAttrSpaceType "+qe[0][ys][1][0])}hn=hn+vs,ys=-1}ln.push(hn+PtgBinOp[ta[0]]+cn);break;case"PtgIsect":cn=ln.pop(),hn=ln.pop(),ln.push(hn+" "+cn);break;case"PtgUnion":cn=ln.pop(),hn=ln.pop(),ln.push(hn+","+cn);break;case"PtgRange":cn=ln.pop(),hn=ln.pop(),ln.push(make_3d_range(hn,cn));break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":un=shift_cell_xls(ta[1][1],nn,Qe),ln.push(encode_cell_xls(un,Pi));break;case"PtgRefN":un=ze?shift_cell_xls(ta[1][1],ze,Qe):ta[1][1],ln.push(encode_cell_xls(un,Pi));break;case"PtgRef3d":zn=ta[1][1],un=shift_cell_xls(ta[1][2],nn,Qe),qn=get_ixti(Ke,zn,Qe),ln.push(qn+"!"+encode_cell_xls(un,Pi));break;case"PtgFunc":case"PtgFuncVar":var ra=ta[1][0],oa=ta[1][1];ra||(ra=0),ra&=127;var fa=ra==0?[]:ln.slice(-ra);ln.length-=ra,oa==="User"&&(oa=fa.shift()),ln.push(oa+"("+fa.join(",")+")");break;case"PtgBool":ln.push(ta[1]?"TRUE":"FALSE");break;case"PtgInt":ln.push(ta[1]);break;case"PtgNum":ln.push(String(ta[1]));break;case"PtgStr":ln.push('"'+ta[1].replace(/"/g,'""')+'"');break;case"PtgErr":ln.push(ta[1]);break;case"PtgAreaN":Un=shift_range_xls(ta[1][1],ze?{s:ze}:nn,Qe),ln.push(encode_range_xls(Un,Qe));break;case"PtgArea":Un=shift_range_xls(ta[1][1],nn,Qe),ln.push(encode_range_xls(Un,Qe));break;case"PtgArea3d":zn=ta[1][1],Un=ta[1][2],qn=get_ixti(Ke,zn,Qe),ln.push(qn+"!"+encode_range_xls(Un,Qe));break;case"PtgAttrSum":ln.push("SUM("+ln.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":Xn=ta[1][2];var ca=(Ke.names||[])[Xn-1]||(Ke[0]||[])[Xn],la=ca?ca.Name:"SH33TJSNAME"+String(Xn);la&&la.slice(0,6)=="_xlfn."&&!Qe.xlfn&&(la=la.slice(6)),ln.push(la);break;case"PtgNameX":var ua=ta[1][1];Xn=ta[1][2];var ga;if(Qe.biff<=5)ua<0&&(ua=-ua),Ke[ua]&&(ga=Ke[ua][Xn]);else{var da="";if(((Ke[ua]||[])[0]||[])[0]==14849||(((Ke[ua]||[])[0]||[])[0]==1025?Ke[ua][Xn]&&Ke[ua][Xn].itab>0&&(da=Ke.SheetNames[Ke[ua][Xn].itab-1]+"!"):da=Ke.SheetNames[Xn-1]+"!"),Ke[ua]&&Ke[ua][Xn])da+=Ke[ua][Xn].Name;else if(Ke[0]&&Ke[0][Xn])da+=Ke[0][Xn].Name;else{var qa=(get_ixti_raw(Ke,ua,Qe)||"").split(";;");qa[Xn-1]?da=qa[Xn-1]:da+="SH33TJSERRX"}ln.push(da);break}ga||(ga={Name:"SH33TJSERRY"}),ln.push(ga.Name);break;case"PtgParen":var tl="(",ol=")";if(ys>=0){switch(vs="",qe[0][ys][1][0]){case 2:tl=fill$1(" ",qe[0][ys][1][1])+tl;break;case 3:tl=fill$1("\r",qe[0][ys][1][1])+tl;break;case 4:ol=fill$1(" ",qe[0][ys][1][1])+ol;break;case 5:ol=fill$1("\r",qe[0][ys][1][1])+ol;break;default:if(Qe.WTF)throw new Error("Unexpected PtgAttrSpaceType "+qe[0][ys][1][0])}ys=-1}ln.push(tl+ln.pop()+ol);break;case"PtgRefErr":ln.push("#REF!");break;case"PtgRefErr3d":ln.push("#REF!");break;case"PtgExp":un={c:ta[1][1],r:ta[1][0]};var hl={c:ze.c,r:ze.r};if(Ke.sharedf[encode_cell(un)]){var wl=Ke.sharedf[encode_cell(un)];ln.push(stringify_formula(wl,nn,hl,Ke,Qe))}else{var _l=!1;for(cn=0;cn!=Ke.arrayf.length;++cn)if(hn=Ke.arrayf[cn],!(un.c<hn[0].s.c||un.c>hn[0].e.c)&&!(un.r<hn[0].s.r||un.r>hn[0].e.r)){ln.push(stringify_formula(hn[1],nn,hl,Ke,Qe)),_l=!0;break}_l||ln.push(ta[1])}break;case"PtgArray":ln.push("{"+stringify_array(ta[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":ys=ea;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":ln.push("");break;case"PtgAreaErr":ln.push("#REF!");break;case"PtgAreaErr3d":ln.push("#REF!");break;case"PtgList":ln.push("Table"+ta[1].idx+"[#"+ta[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(ta));default:throw new Error("Unrecognized Formula Token: "+String(ta))}var gl=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(Qe.biff!=3&&ys>=0&&gl.indexOf(qe[0][ea][0])==-1){ta=qe[0][ys];var dl=!0;switch(ta[1][0]){case 4:dl=!1;case 0:vs=fill$1(" ",ta[1][1]);break;case 5:dl=!1;case 1:vs=fill$1("\r",ta[1][1]);break;default:if(vs="",Qe.WTF)throw new Error("Unexpected PtgAttrSpaceType "+ta[1][0])}ln.push((dl?vs:"")+ln.pop()+(dl?"":vs)),ys=-1}}if(ln.length>1&&Qe.WTF)throw new Error("bad formula stack");return ln[0]=="TRUE"?!0:ln[0]=="FALSE"?!1:ln[0]}function write_FormulaValue(qe){if(qe==null){var f=new_buf(8);return f.write_shift(1,3),f.write_shift(1,0),f.write_shift(2,0),f.write_shift(2,0),f.write_shift(2,65535),f}else if(typeof qe=="number")return write_Xnum(qe);return write_Xnum(0)}function write_Formula(qe,f,ze,Ke,Qe){var Pi=write_XLSCell(f,ze,Qe),nn=write_FormulaValue(qe.v),ln=new_buf(6),cn=33;ln.write_shift(2,cn),ln.write_shift(4,0);for(var hn=new_buf(qe.bf.length),un=0;un<qe.bf.length;++un)hn[un]=qe.bf[un];var zn=bconcat([Pi,nn,ln,hn]);return zn}function parse_XLSBParsedFormula(qe,f,ze){var Ke=qe.read_shift(4),Qe=parse_Rgce(qe,Ke,ze),Pi=qe.read_shift(4),nn=Pi>0?parse_RgbExtra(qe,Pi,Qe,ze):null;return[Qe,nn]}var parse_XLSBArrayParsedFormula=parse_XLSBParsedFormula,parse_XLSBCellParsedFormula=parse_XLSBParsedFormula,parse_XLSBNameParsedFormula=parse_XLSBParsedFormula,parse_XLSBSharedParsedFormula=parse_XLSBParsedFormula;function write_XLSBFormulaNum(qe){if((qe|0)==qe&&qe<Math.pow(2,16)&&qe>=0){var f=new_buf(11);return f.write_shift(4,3),f.write_shift(1,30),f.write_shift(2,qe),f.write_shift(4,0),f}var ze=new_buf(17);return ze.write_shift(4,11),ze.write_shift(1,31),ze.write_shift(8,qe),ze.write_shift(4,0),ze}function write_XLSBFormulaErr(qe){var f=new_buf(10);return f.write_shift(4,2),f.write_shift(1,28),f.write_shift(1,qe),f.write_shift(4,0),f}function write_XLSBFormulaBool(qe){var f=new_buf(10);return f.write_shift(4,2),f.write_shift(1,29),f.write_shift(1,qe?1:0),f.write_shift(4,0),f}function write_XLSBFormulaStr(qe){var f=new_buf(7);f.write_shift(4,3+2*qe.length),f.write_shift(1,23),f.write_shift(2,qe.length);var ze=new_buf(2*qe.length);ze.write_shift(2*qe.length,qe,"utf16le");var Ke=new_buf(4);return Ke.write_shift(4,0),bconcat([f,ze,Ke])}function write_XLSBFormulaRef(qe){var f=decode_cell(qe),ze=new_buf(15);return ze.write_shift(4,7),ze.write_shift(1,36),ze.write_shift(4,f.r),ze.write_shift(2,f.c|(qe.charAt(0)=="$"?0:1)<<14|(qe.match(/\$\d/)?0:1)<<15),ze.write_shift(4,0),ze}function write_XLSBFormulaRef3D(qe,f){var ze=qe.lastIndexOf("!"),Ke=qe.slice(0,ze);qe=qe.slice(ze+1);var Qe=decode_cell(qe);Ke.charAt(0)=="'"&&(Ke=Ke.slice(1,-1).replace(/''/g,"'"));var Pi=new_buf(17);return Pi.write_shift(4,9),Pi.write_shift(1,58),Pi.write_shift(2,2+f.SheetNames.map(function(nn){return nn.toLowerCase()}).indexOf(Ke.toLowerCase())),Pi.write_shift(4,Qe.r),Pi.write_shift(2,Qe.c|(qe.charAt(0)=="$"?0:1)<<14|(qe.match(/\$\d/)?0:1)<<15),Pi.write_shift(4,0),Pi}function write_XLSBFormulaRefErr3D(qe,f){var ze=qe.lastIndexOf("!"),Ke=qe.slice(0,ze);qe=qe.slice(ze+1),Ke.charAt(0)=="'"&&(Ke=Ke.slice(1,-1).replace(/''/g,"'"));var Qe=new_buf(17);return Qe.write_shift(4,9),Qe.write_shift(1,60),Qe.write_shift(2,2+f.SheetNames.map(function(Pi){return Pi.toLowerCase()}).indexOf(Ke.toLowerCase())),Qe.write_shift(4,0),Qe.write_shift(2,0),Qe.write_shift(4,0),Qe}function write_XLSBFormulaRange(qe){var f=qe.split(":"),ze=f[0],Ke=new_buf(23);Ke.write_shift(4,15),ze=f[0];var Qe=decode_cell(ze);return Ke.write_shift(1,36),Ke.write_shift(4,Qe.r),Ke.write_shift(2,Qe.c|(ze.charAt(0)=="$"?0:1)<<14|(ze.match(/\$\d/)?0:1)<<15),Ke.write_shift(4,0),ze=f[1],Qe=decode_cell(ze),Ke.write_shift(1,36),Ke.write_shift(4,Qe.r),Ke.write_shift(2,Qe.c|(ze.charAt(0)=="$"?0:1)<<14|(ze.match(/\$\d/)?0:1)<<15),Ke.write_shift(4,0),Ke.write_shift(1,17),Ke.write_shift(4,0),Ke}function write_XLSBFormulaRangeWS(qe,f){var ze=qe.lastIndexOf("!"),Ke=qe.slice(0,ze);qe=qe.slice(ze+1),Ke.charAt(0)=="'"&&(Ke=Ke.slice(1,-1).replace(/''/g,"'"));var Qe=qe.split(":"),Pi=new_buf(27);Pi.write_shift(4,19);var nn=Qe[0],ln=decode_cell(nn);return Pi.write_shift(1,58),Pi.write_shift(2,2+f.SheetNames.map(function(cn){return cn.toLowerCase()}).indexOf(Ke.toLowerCase())),Pi.write_shift(4,ln.r),Pi.write_shift(2,ln.c|(nn.charAt(0)=="$"?0:1)<<14|(nn.match(/\$\d/)?0:1)<<15),nn=Qe[1],ln=decode_cell(nn),Pi.write_shift(1,58),Pi.write_shift(2,2+f.SheetNames.map(function(cn){return cn.toLowerCase()}).indexOf(Ke.toLowerCase())),Pi.write_shift(4,ln.r),Pi.write_shift(2,ln.c|(nn.charAt(0)=="$"?0:1)<<14|(nn.match(/\$\d/)?0:1)<<15),Pi.write_shift(1,17),Pi.write_shift(4,0),Pi}function write_XLSBFormulaArea3D(qe,f){var ze=qe.lastIndexOf("!"),Ke=qe.slice(0,ze);qe=qe.slice(ze+1),Ke.charAt(0)=="'"&&(Ke=Ke.slice(1,-1).replace(/''/g,"'"));var Qe=decode_range(qe),Pi=new_buf(23);return Pi.write_shift(4,15),Pi.write_shift(1,59),Pi.write_shift(2,2+f.SheetNames.map(function(nn){return nn.toLowerCase()}).indexOf(Ke.toLowerCase())),Pi.write_shift(4,Qe.s.r),Pi.write_shift(4,Qe.e.r),Pi.write_shift(2,Qe.s.c),Pi.write_shift(2,Qe.e.c),Pi.write_shift(4,0),Pi}function write_XLSBFormula(qe,f){if(typeof qe=="number")return write_XLSBFormulaNum(qe);if(typeof qe=="boolean")return write_XLSBFormulaBool(qe);if(/^#(DIV\/0!|GETTING_DATA|N\/A|NAME\?|NULL!|NUM!|REF!|VALUE!)$/.test(qe))return write_XLSBFormulaErr(+RBErr[qe]);if(qe.match(/^\$?(?:[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D]|[A-Z]{1,2})\$?(?:10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})$/))return write_XLSBFormulaRef(qe);if(qe.match(/^\$?(?:[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D]|[A-Z]{1,2})\$?(?:10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5}):\$?(?:[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D]|[A-Z]{1,2})\$?(?:10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})$/))return write_XLSBFormulaRange(qe);if(qe.match(/^#REF!\$?(?:[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D]|[A-Z]{1,2})\$?(?:10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5}):\$?(?:[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D]|[A-Z]{1,2})\$?(?:10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})$/))return write_XLSBFormulaArea3D(qe,f);if(qe.match(/^(?:'[^\\\/?*\[\]:]*'|[^'][^\\\/?*\[\]:'`~!@#$%^()\-=+{}|;,<.>]*)!\$?(?:[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D]|[A-Z]{1,2})\$?(?:10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})$/))return write_XLSBFormulaRef3D(qe,f);if(qe.match(/^(?:'[^\\\/?*\[\]:]*'|[^'][^\\\/?*\[\]:'`~!@#$%^()\-=+{}|;,<.>]*)!\$?(?:[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D]|[A-Z]{1,2})\$?(?:10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5}):\$?(?:[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D]|[A-Z]{1,2})\$?(?:10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})$/))return write_XLSBFormulaRangeWS(qe,f);if(/^(?:'[^\\\/?*\[\]:]*'|[^'][^\\\/?*\[\]:'`~!@#$%^()\-=+{}|;,<.>]*)!#REF!$/.test(qe))return write_XLSBFormulaRefErr3D(qe,f);if(/^".*"$/.test(qe))return write_XLSBFormulaStr(qe);if(/^[+-]\d+$/.test(qe))return write_XLSBFormulaNum(parseInt(qe,10));throw"Formula |"+qe+"| not supported for XLSB"}var write_XLSBNameParsedFormula=write_XLSBFormula,Cetab={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},Ftab={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},FtabArgc={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function csf_to_ods_formula(qe){var f="of:="+qe.replace(crefregex,"$1[.$2$3$4$5]").replace(/\]:\[/g,":");return f.replace(/;/g,"|").replace(/,/g,";")}function csf_to_ods_3D(qe){return qe.replace(/!/,".").replace(/:/,":.")}var browser_has_Map=typeof Map<"u";function get_sst_id(qe,f,ze){var Ke=0,Qe=qe.length;if(ze){if(browser_has_Map?ze.has(f):Object.prototype.hasOwnProperty.call(ze,f)){for(var Pi=browser_has_Map?ze.get(f):ze[f];Ke<Pi.length;++Ke)if(qe[Pi[Ke]].t===f)return qe.Count++,Pi[Ke]}}else for(;Ke<Qe;++Ke)if(qe[Ke].t===f)return qe.Count++,Ke;return qe[Qe]={t:f},qe.Count++,qe.Unique++,ze&&(browser_has_Map?(ze.has(f)||ze.set(f,[]),ze.get(f).push(Qe)):(Object.prototype.hasOwnProperty.call(ze,f)||(ze[f]=[]),ze[f].push(Qe))),Qe}function col_obj_w(qe,f){var ze={min:qe+1,max:qe+1},Ke=-1;return f.MDW&&(MDW=f.MDW),f.width!=null?ze.customWidth=1:f.wpx!=null?Ke=px2char(f.wpx):f.wch!=null&&(Ke=f.wch),Ke>-1?(ze.width=char2width(Ke),ze.customWidth=1):f.width!=null&&(ze.width=f.width),f.hidden&&(ze.hidden=!0),f.level!=null&&(ze.outlineLevel=ze.level=f.level),ze}function default_margins(qe,f){if(qe){var ze=[.7,.7,.75,.75,.3,.3];qe.left==null&&(qe.left=ze[0]),qe.right==null&&(qe.right=ze[1]),qe.top==null&&(qe.top=ze[2]),qe.bottom==null&&(qe.bottom=ze[3]),qe.header==null&&(qe.header=ze[4]),qe.footer==null&&(qe.footer=ze[5])}}function get_cell_style(qe,f,ze){var Ke=ze.revssf[f.z!=null?f.z:"General"],Qe=60,Pi=qe.length;if(Ke==null&&ze.ssf){for(;Qe<392;++Qe)if(ze.ssf[Qe]==null){SSF__load(f.z,Qe),ze.ssf[Qe]=f.z,ze.revssf[f.z]=Ke=Qe;break}}for(Qe=0;Qe!=Pi;++Qe)if(qe[Qe].numFmtId===Ke)return Qe;return qe[Pi]={numFmtId:Ke,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},Pi}function check_ws(qe,f,ze){if(qe&&qe["!ref"]){var Ke=safe_decode_range(qe["!ref"]);if(Ke.e.c<Ke.s.c||Ke.e.r<Ke.s.r)throw new Error("Bad range ("+ze+"): "+qe["!ref"])}}function write_ws_xml_merges(qe){if(qe.length===0)return"";for(var f='<mergeCells count="'+qe.length+'">',ze=0;ze!=qe.length;++ze)f+='<mergeCell ref="'+encode_range(qe[ze])+'"/>';return f+"</mergeCells>"}function write_ws_xml_sheetpr(qe,f,ze,Ke,Qe){var Pi=!1,nn={},ln=null;if(Ke.bookType!=="xlsx"&&f.vbaraw){var cn=f.SheetNames[ze];try{f.Workbook&&(cn=f.Workbook.Sheets[ze].CodeName||cn)}catch{}Pi=!0,nn.codeName=utf8write(escapexml(cn))}if(qe&&qe["!outline"]){var hn={summaryBelow:1,summaryRight:1};qe["!outline"].above&&(hn.summaryBelow=0),qe["!outline"].left&&(hn.summaryRight=0),ln=(ln||"")+writextag("outlinePr",null,hn)}!Pi&&!ln||(Qe[Qe.length]=writextag("sheetPr",ln,nn))}var sheetprot_deffalse=["objects","scenarios","selectLockedCells","selectUnlockedCells"],sheetprot_deftrue=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];function write_ws_xml_protection(qe){var f={sheet:1};return sheetprot_deffalse.forEach(function(ze){qe[ze]!=null&&qe[ze]&&(f[ze]="1")}),sheetprot_deftrue.forEach(function(ze){qe[ze]!=null&&!qe[ze]&&(f[ze]="0")}),qe.password&&(f.password=crypto_CreatePasswordVerifier_Method1(qe.password).toString(16).toUpperCase()),writextag("sheetProtection",null,f)}function write_ws_xml_margins(qe){return default_margins(qe),writextag("pageMargins",null,qe)}function write_ws_xml_cols(qe,f){for(var ze=["<cols>"],Ke,Qe=0;Qe!=f.length;++Qe)(Ke=f[Qe])&&(ze[ze.length]=writextag("col",null,col_obj_w(Qe,Ke)));return ze[ze.length]="</cols>",ze.join("")}function write_ws_xml_autofilter(qe,f,ze,Ke){var Qe=typeof qe.ref=="string"?qe.ref:encode_range(qe.ref);ze.Workbook||(ze.Workbook={Sheets:[]}),ze.Workbook.Names||(ze.Workbook.Names=[]);var Pi=ze.Workbook.Names,nn=decode_range(Qe);nn.s.r==nn.e.r&&(nn.e.r=decode_range(f["!ref"]).e.r,Qe=encode_range(nn));for(var ln=0;ln<Pi.length;++ln){var cn=Pi[ln];if(cn.Name=="_xlnm._FilterDatabase"&&cn.Sheet==Ke){cn.Ref=formula_quote_sheet_name(ze.SheetNames[Ke])+"!"+fix_range(Qe);break}}return ln==Pi.length&&Pi.push({Name:"_xlnm._FilterDatabase",Sheet:Ke,Ref:"'"+ze.SheetNames[Ke]+"'!"+Qe}),writextag("autoFilter",null,{ref:Qe})}function write_ws_xml_sheetviews(qe,f,ze,Ke){var Qe={workbookViewId:"0"};return(((Ke||{}).Workbook||{}).Views||[])[0]&&(Qe.rightToLeft=Ke.Workbook.Views[0].RTL?"1":"0"),writextag("sheetViews",writextag("sheetView",null,Qe),{})}function write_ws_xml_cell(qe,f,ze,Ke,Qe,Pi,nn){if(qe.c&&ze["!comments"].push([f,qe.c]),(qe.v===void 0||qe.t==="z"&&!(Ke||{}).sheetStubs)&&typeof qe.f!="string"&&typeof qe.z>"u")return"";var ln="",cn=qe.t,hn=qe.v;if(qe.t!=="z")switch(qe.t){case"b":ln=qe.v?"1":"0";break;case"n":isNaN(qe.v)?(qe.t="e",ln=BErr[qe.v=36]):isFinite(qe.v)?ln=""+qe.v:(qe.t="e",ln=BErr[qe.v=7]);break;case"e":ln=BErr[qe.v];break;case"d":if(Ke&&Ke.cellDates){var un=parseDate(qe.v,nn);ln=un.toISOString(),un.getUTCFullYear()<1900&&(ln=ln.slice(ln.indexOf("T")+1).replace("Z",""))}else qe=dup(qe),qe.t="n",ln=""+(qe.v=datenum(parseDate(qe.v,nn),nn));typeof qe.z>"u"&&(qe.z=table_fmt[14]);break;default:ln=qe.v;break}var zn=qe.t=="z"||qe.v==null?"":writetag("v",escapexml(ln)),Xn={r:f},Un=get_cell_style(Ke.cellXfs,qe,Ke);switch(Un!==0&&(Xn.s=Un),qe.t){case"n":break;case"d":Xn.t="d";break;case"b":Xn.t="b";break;case"e":Xn.t="e";break;case"z":break;default:if(qe.v==null){delete qe.t;break}if(qe.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(Ke&&Ke.bookSST){zn=writetag("v",""+get_sst_id(Ke.Strings,qe.v,Ke.revStrings)),Xn.t="s";break}else Xn.t="str";break}if(qe.t!=cn&&(qe.t=cn,qe.v=hn),typeof qe.f=="string"&&qe.f){var qn=qe.F&&qe.F.slice(0,f.length)==f?{t:"array",ref:qe.F}:null;zn=writextag("f",escapexml(qe.f),qn)+(qe.v!=null?zn:"")}return qe.l&&(qe.l.display=escapexml(ln),ze["!links"].push([f,qe.l])),qe.D&&(Xn.cm=1),writextag("c",zn,Xn)}function write_ws_xml_data(qe,f,ze,Ke){var Qe=[],Pi=[],nn=safe_decode_range(qe["!ref"]),ln="",cn,hn="",un=[],zn=0,Xn=0,Un=qe["!rows"],qn=qe["!data"]!=null,ys=qn?qe["!data"]:[],vs={r:hn},ea,na=-1,ta=(((Ke||{}).Workbook||{}).WBProps||{}).date1904;for(Xn=nn.s.c;Xn<=nn.e.c;++Xn)un[Xn]=encode_col(Xn);for(zn=nn.s.r;zn<=nn.e.r;++zn){Pi=[],hn=encode_row(zn);var ra=qn?ys[zn]:[];for(Xn=nn.s.c;Xn<=nn.e.c;++Xn){cn=un[Xn]+hn;var oa=qn?ra[Xn]:qe[cn];oa!==void 0&&(ln=write_ws_xml_cell(oa,cn,qe,f,ze,Ke,ta))!=null&&Pi.push(ln)}(Pi.length>0||Un&&Un[zn])&&(vs={r:hn},Un&&Un[zn]&&(ea=Un[zn],ea.hidden&&(vs.hidden=1),na=-1,ea.hpx?na=px2pt(ea.hpx):ea.hpt&&(na=ea.hpt),na>-1&&(vs.ht=na,vs.customHeight=1),ea.level&&(vs.outlineLevel=ea.level)),Qe[Qe.length]=writextag("row",Pi.join(""),vs))}if(Un)for(;zn<Un.length;++zn)Un&&Un[zn]&&(vs={r:zn+1},ea=Un[zn],ea.hidden&&(vs.hidden=1),na=-1,ea.hpx?na=px2pt(ea.hpx):ea.hpt&&(na=ea.hpt),na>-1&&(vs.ht=na,vs.customHeight=1),ea.level&&(vs.outlineLevel=ea.level),Qe[Qe.length]=writextag("row","",vs));return Qe.join("")}function write_ws_xml(qe,f,ze,Ke){var Qe=[XML_HEADER,writextag("worksheet",null,{xmlns:XMLNS_main[0],"xmlns:r":XMLNS.r})],Pi=ze.SheetNames[qe],nn=0,ln="",cn=ze.Sheets[Pi];cn==null&&(cn={});var hn=cn["!ref"]||"A1",un=safe_decode_range(hn);if(un.e.c>16383||un.e.r>1048575){if(f.WTF)throw new Error("Range "+hn+" exceeds format limit A1:XFD1048576");un.e.c=Math.min(un.e.c,16383),un.e.r=Math.min(un.e.c,1048575),hn=encode_range(un)}Ke||(Ke={}),cn["!comments"]=[];var zn=[];write_ws_xml_sheetpr(cn,ze,qe,f,Qe),Qe[Qe.length]=writextag("dimension",null,{ref:hn}),Qe[Qe.length]=write_ws_xml_sheetviews(cn,f,qe,ze),f.sheetFormat&&(Qe[Qe.length]=writextag("sheetFormatPr",null,{defaultRowHeight:f.sheetFormat.defaultRowHeight||"16",baseColWidth:f.sheetFormat.baseColWidth||"10",outlineLevelRow:f.sheetFormat.outlineLevelRow||"7"})),cn["!cols"]!=null&&cn["!cols"].length>0&&(Qe[Qe.length]=write_ws_xml_cols(cn,cn["!cols"])),Qe[nn=Qe.length]="<sheetData/>",cn["!links"]=[],cn["!ref"]!=null&&(ln=write_ws_xml_data(cn,f,qe,ze),ln.length>0&&(Qe[Qe.length]=ln)),Qe.length>nn+1&&(Qe[Qe.length]="</sheetData>",Qe[nn]=Qe[nn].replace("/>",">")),cn["!protect"]&&(Qe[Qe.length]=write_ws_xml_protection(cn["!protect"])),cn["!autofilter"]!=null&&(Qe[Qe.length]=write_ws_xml_autofilter(cn["!autofilter"],cn,ze,qe)),cn["!merges"]!=null&&cn["!merges"].length>0&&(Qe[Qe.length]=write_ws_xml_merges(cn["!merges"]));var Xn=-1,Un,qn=-1;return cn["!links"].length>0&&(Qe[Qe.length]="<hyperlinks>",cn["!links"].forEach(function(ys){ys[1].Target&&(Un={ref:ys[0]},ys[1].Target.charAt(0)!="#"&&(qn=add_rels(Ke,-1,escapexml(ys[1].Target).replace(/#[\s\S]*$/,""),RELS.HLINK),Un["r:id"]="rId"+qn),(Xn=ys[1].Target.indexOf("#"))>-1&&(Un.location=escapexml(ys[1].Target.slice(Xn+1))),ys[1].Tooltip&&(Un.tooltip=escapexml(ys[1].Tooltip)),Un.display=ys[1].display,Qe[Qe.length]=writextag("hyperlink",null,Un))}),Qe[Qe.length]="</hyperlinks>"),delete cn["!links"],cn["!margins"]!=null&&(Qe[Qe.length]=write_ws_xml_margins(cn["!margins"])),(!f||f.ignoreEC||f.ignoreEC==null)&&(Qe[Qe.length]=writetag("ignoredErrors",writextag("ignoredError",null,{numberStoredAsText:1,sqref:hn}))),zn.length>0&&(qn=add_rels(Ke,-1,"../drawings/drawing"+(qe+1)+".xml",RELS.DRAW),Qe[Qe.length]=writextag("drawing",null,{"r:id":"rId"+qn}),cn["!drawing"]=zn),cn["!comments"].length>0&&(qn=add_rels(Ke,-1,"../drawings/vmlDrawing"+(qe+1)+".vml",RELS.VML),Qe[Qe.length]=writextag("legacyDrawing",null,{"r:id":"rId"+qn}),cn["!legacy"]=qn),Qe.length>1&&(Qe[Qe.length]="</worksheet>",Qe[1]=Qe[1].replace("/>",">")),Qe.join("")}function parse_BrtRowHdr(qe,f){var ze={},Ke=qe.l+f;ze.r=qe.read_shift(4),qe.l+=4;var Qe=qe.read_shift(2);qe.l+=1;var Pi=qe.read_shift(1);return qe.l=Ke,Pi&7&&(ze.level=Pi&7),Pi&16&&(ze.hidden=!0),Pi&32&&(ze.hpt=Qe/20),ze}function write_BrtRowHdr(qe,f,ze){var Ke=new_buf(145),Qe=(ze["!rows"]||[])[qe]||{};Ke.write_shift(4,qe),Ke.write_shift(4,0);var Pi=320;Qe.hpx?Pi=px2pt(Qe.hpx)*20:Qe.hpt&&(Pi=Qe.hpt*20),Ke.write_shift(2,Pi),Ke.write_shift(1,0);var nn=0;Qe.level&&(nn|=Qe.level),Qe.hidden&&(nn|=16),(Qe.hpx||Qe.hpt)&&(nn|=32),Ke.write_shift(1,nn),Ke.write_shift(1,0);var ln=0,cn=Ke.l;Ke.l+=4;for(var hn={r:qe,c:0},un=ze["!data"]!=null,zn=0;zn<16;++zn)if(!(f.s.c>zn+1<<10||f.e.c<zn<<10)){for(var Xn=-1,Un=-1,qn=zn<<10;qn<zn+1<<10;++qn){hn.c=qn;var ys=un?(ze["!data"][hn.r]||[])[hn.c]:ze[encode_cell(hn)];ys&&(Xn<0&&(Xn=qn),Un=qn)}Xn<0||(++ln,Ke.write_shift(4,Xn),Ke.write_shift(4,Un))}var vs=Ke.l;return Ke.l=cn,Ke.write_shift(4,ln),Ke.l=vs,Ke.length>Ke.l?Ke.slice(0,Ke.l):Ke}function write_row_header(qe,f,ze,Ke){var Qe=write_BrtRowHdr(Ke,ze,f);(Qe.length>17||(f["!rows"]||[])[Ke])&&write_record(qe,0,Qe)}var parse_BrtWsDim=parse_UncheckedRfX,write_BrtWsDim=write_UncheckedRfX;function parse_BrtWsFmtInfo(){}function parse_BrtWsProp(qe,f){var ze={},Ke=qe[qe.l];return++qe.l,ze.above=!(Ke&64),ze.left=!(Ke&128),qe.l+=18,ze.name=parse_XLSBCodeName(qe),ze}function write_BrtWsProp(qe,f,ze){ze==null&&(ze=new_buf(84+4*qe.length));var Ke=192;f&&(f.above&&(Ke&=-65),f.left&&(Ke&=-129)),ze.write_shift(1,Ke);for(var Qe=1;Qe<3;++Qe)ze.write_shift(1,0);return write_BrtColor({auto:1},ze),ze.write_shift(-4,-1),ze.write_shift(-4,-1),write_XLSBCodeName(qe,ze),ze.slice(0,ze.l)}function parse_BrtCellBlank(qe){var f=parse_XLSBCell(qe);return[f]}function write_BrtCellBlank(qe,f,ze){return ze==null&&(ze=new_buf(8)),write_XLSBCell(f,ze)}function parse_BrtShortBlank(qe){var f=parse_XLSBShortCell(qe);return[f]}function write_BrtShortBlank(qe,f,ze){return ze==null&&(ze=new_buf(4)),write_XLSBShortCell(f,ze)}function parse_BrtCellBool(qe){var f=parse_XLSBCell(qe),ze=qe.read_shift(1);return[f,ze,"b"]}function write_BrtCellBool(qe,f,ze){return ze==null&&(ze=new_buf(9)),write_XLSBCell(f,ze),ze.write_shift(1,qe.v?1:0),ze}function parse_BrtShortBool(qe){var f=parse_XLSBShortCell(qe),ze=qe.read_shift(1);return[f,ze,"b"]}function write_BrtShortBool(qe,f,ze){return ze==null&&(ze=new_buf(5)),write_XLSBShortCell(f,ze),ze.write_shift(1,qe.v?1:0),ze}function parse_BrtCellError(qe){var f=parse_XLSBCell(qe),ze=qe.read_shift(1);return[f,ze,"e"]}function write_BrtCellError(qe,f,ze){return ze==null&&(ze=new_buf(9)),write_XLSBCell(f,ze),ze.write_shift(1,qe.v),ze}function parse_BrtShortError(qe){var f=parse_XLSBShortCell(qe),ze=qe.read_shift(1);return[f,ze,"e"]}function write_BrtShortError(qe,f,ze){return ze==null&&(ze=new_buf(8)),write_XLSBShortCell(f,ze),ze.write_shift(1,qe.v),ze.write_shift(2,0),ze.write_shift(1,0),ze}function parse_BrtCellIsst(qe){var f=parse_XLSBCell(qe),ze=qe.read_shift(4);return[f,ze,"s"]}function write_BrtCellIsst(qe,f,ze){return ze==null&&(ze=new_buf(12)),write_XLSBCell(f,ze),ze.write_shift(4,f.v),ze}function parse_BrtShortIsst(qe){var f=parse_XLSBShortCell(qe),ze=qe.read_shift(4);return[f,ze,"s"]}function write_BrtShortIsst(qe,f,ze){return ze==null&&(ze=new_buf(8)),write_XLSBShortCell(f,ze),ze.write_shift(4,f.v),ze}function parse_BrtCellReal(qe){var f=parse_XLSBCell(qe),ze=parse_Xnum(qe);return[f,ze,"n"]}function write_BrtCellReal(qe,f,ze){return ze==null&&(ze=new_buf(16)),write_XLSBCell(f,ze),write_Xnum(qe.v,ze),ze}function parse_BrtShortReal(qe){var f=parse_XLSBShortCell(qe),ze=parse_Xnum(qe);return[f,ze,"n"]}function write_BrtShortReal(qe,f,ze){return ze==null&&(ze=new_buf(12)),write_XLSBShortCell(f,ze),write_Xnum(qe.v,ze),ze}function parse_BrtCellRk(qe){var f=parse_XLSBCell(qe),ze=parse_RkNumber(qe);return[f,ze,"n"]}function write_BrtCellRk(qe,f,ze){return ze==null&&(ze=new_buf(12)),write_XLSBCell(f,ze),write_RkNumber(qe.v,ze),ze}function parse_BrtShortRk(qe){var f=parse_XLSBShortCell(qe),ze=parse_RkNumber(qe);return[f,ze,"n"]}function write_BrtShortRk(qe,f,ze){return ze==null&&(ze=new_buf(8)),write_XLSBShortCell(f,ze),write_RkNumber(qe.v,ze),ze}function parse_BrtCellRString(qe){var f=parse_XLSBCell(qe),ze=parse_RichStr(qe);return[f,ze,"is"]}function parse_BrtCellSt(qe){var f=parse_XLSBCell(qe),ze=parse_XLWideString(qe);return[f,ze,"str"]}function write_BrtCellSt(qe,f,ze){var Ke=qe.v==null?"":String(qe.v);return ze==null&&(ze=new_buf(12+4*qe.v.length)),write_XLSBCell(f,ze),write_XLWideString(Ke,ze),ze.length>ze.l?ze.slice(0,ze.l):ze}function parse_BrtShortSt(qe){var f=parse_XLSBShortCell(qe),ze=parse_XLWideString(qe);return[f,ze,"str"]}function write_BrtShortSt(qe,f,ze){var Ke=qe.v==null?"":String(qe.v);return ze==null&&(ze=new_buf(8+4*Ke.length)),write_XLSBShortCell(f,ze),write_XLWideString(Ke,ze),ze.length>ze.l?ze.slice(0,ze.l):ze}function parse_BrtFmlaBool(qe,f,ze){var Ke=qe.l+f,Qe=parse_XLSBCell(qe);Qe.r=ze["!row"];var Pi=qe.read_shift(1),nn=[Qe,Pi,"b"];if(ze.cellFormula){qe.l+=2;var ln=parse_XLSBCellParsedFormula(qe,Ke-qe.l,ze);nn[3]=stringify_formula(ln,null,Qe,ze.supbooks,ze)}else qe.l=Ke;return nn}function parse_BrtFmlaError(qe,f,ze){var Ke=qe.l+f,Qe=parse_XLSBCell(qe);Qe.r=ze["!row"];var Pi=qe.read_shift(1),nn=[Qe,Pi,"e"];if(ze.cellFormula){qe.l+=2;var ln=parse_XLSBCellParsedFormula(qe,Ke-qe.l,ze);nn[3]=stringify_formula(ln,null,Qe,ze.supbooks,ze)}else qe.l=Ke;return nn}function parse_BrtFmlaNum(qe,f,ze){var Ke=qe.l+f,Qe=parse_XLSBCell(qe);Qe.r=ze["!row"];var Pi=parse_Xnum(qe),nn=[Qe,Pi,"n"];if(ze.cellFormula){qe.l+=2;var ln=parse_XLSBCellParsedFormula(qe,Ke-qe.l,ze);nn[3]=stringify_formula(ln,null,Qe,ze.supbooks,ze)}else qe.l=Ke;return nn}function parse_BrtFmlaString(qe,f,ze){var Ke=qe.l+f,Qe=parse_XLSBCell(qe);Qe.r=ze["!row"];var Pi=parse_XLWideString(qe),nn=[Qe,Pi,"str"];if(ze.cellFormula){qe.l+=2;var ln=parse_XLSBCellParsedFormula(qe,Ke-qe.l,ze);nn[3]=stringify_formula(ln,null,Qe,ze.supbooks,ze)}else qe.l=Ke;return nn}var parse_BrtMergeCell=parse_UncheckedRfX,write_BrtMergeCell=write_UncheckedRfX;function write_BrtBeginMergeCells(qe,f){return f==null&&(f=new_buf(4)),f.write_shift(4,qe),f}function parse_BrtHLink(qe,f){var ze=qe.l+f,Ke=parse_UncheckedRfX(qe),Qe=parse_XLNullableWideString(qe),Pi=parse_XLWideString(qe),nn=parse_XLWideString(qe),ln=parse_XLWideString(qe);qe.l=ze;var cn={rfx:Ke,relId:Qe,loc:Pi,display:ln};return nn&&(cn.Tooltip=nn),cn}function write_BrtHLink(qe,f){var ze=new_buf(50+4*(qe[1].Target.length+(qe[1].Tooltip||"").length));write_UncheckedRfX({s:decode_cell(qe[0]),e:decode_cell(qe[0])},ze),write_RelID("rId"+f,ze);var Ke=qe[1].Target.indexOf("#"),Qe=Ke==-1?"":qe[1].Target.slice(Ke+1);return write_XLWideString(Qe||"",ze),write_XLWideString(qe[1].Tooltip||"",ze),write_XLWideString("",ze),ze.slice(0,ze.l)}function parse_BrtPane(){}function parse_BrtArrFmla(qe,f,ze){var Ke=qe.l+f,Qe=parse_RfX(qe),Pi=qe.read_shift(1),nn=[Qe];if(nn[2]=Pi,ze.cellFormula){var ln=parse_XLSBArrayParsedFormula(qe,Ke-qe.l,ze);nn[1]=ln}else qe.l=Ke;return nn}function parse_BrtShrFmla(qe,f,ze){var Ke=qe.l+f,Qe=parse_UncheckedRfX(qe),Pi=[Qe];if(ze.cellFormula){var nn=parse_XLSBSharedParsedFormula(qe,Ke-qe.l,ze);Pi[1]=nn,qe.l=Ke}else qe.l=Ke;return Pi}function write_BrtColInfo(qe,f,ze){ze==null&&(ze=new_buf(18));var Ke=col_obj_w(qe,f);ze.write_shift(-4,qe),ze.write_shift(-4,qe),ze.write_shift(4,(Ke.width||10)*256),ze.write_shift(4,0);var Qe=0;return f.hidden&&(Qe|=1),typeof Ke.width=="number"&&(Qe|=2),f.level&&(Qe|=f.level<<8),ze.write_shift(2,Qe),ze}var BrtMarginKeys=["left","right","top","bottom","header","footer"];function parse_BrtMargins(qe){var f={};return BrtMarginKeys.forEach(function(ze){f[ze]=parse_Xnum(qe)}),f}function write_BrtMargins(qe,f){return f==null&&(f=new_buf(6*8)),default_margins(qe),BrtMarginKeys.forEach(function(ze){write_Xnum(qe[ze],f)}),f}function parse_BrtBeginWsView(qe){var f=qe.read_shift(2);return qe.l+=28,{RTL:f&32}}function write_BrtBeginWsView(qe,f,ze){ze==null&&(ze=new_buf(30));var Ke=924;return(((f||{}).Views||[])[0]||{}).RTL&&(Ke|=32),ze.write_shift(2,Ke),ze.write_shift(4,0),ze.write_shift(4,0),ze.write_shift(4,0),ze.write_shift(1,0),ze.write_shift(1,0),ze.write_shift(2,0),ze.write_shift(2,100),ze.write_shift(2,0),ze.write_shift(2,0),ze.write_shift(2,0),ze.write_shift(4,0),ze}function write_BrtCellIgnoreEC(qe){var f=new_buf(24);return f.write_shift(4,4),f.write_shift(4,1),write_UncheckedRfX(qe,f),f}function write_BrtSheetProtection(qe,f){return f==null&&(f=new_buf(16*4+2)),f.write_shift(2,qe.password?crypto_CreatePasswordVerifier_Method1(qe.password):0),f.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach(function(ze){ze[1]?f.write_shift(4,qe[ze[0]]!=null&&!qe[ze[0]]?1:0):f.write_shift(4,qe[ze[0]]!=null&&qe[ze[0]]?0:1)}),f}function parse_BrtDVal(){}function parse_BrtDVal14(){}function write_ws_bin_cell(qe,f,ze,Ke,Qe,Pi,nn,ln){var cn={r:ze,c:Ke};if(f.c&&Pi["!comments"].push([encode_cell(cn),f.c]),f.v===void 0)return!1;var hn="";switch(f.t){case"b":hn=f.v?"1":"0";break;case"d":f=dup(f),f.z=f.z||table_fmt[14],f.v=datenum(parseDate(f.v,ln),ln),f.t="n";break;case"n":case"e":hn=""+f.v;break;default:hn=f.v;break}switch(cn.s=get_cell_style(Qe.cellXfs,f,Qe),f.l&&Pi["!links"].push([encode_cell(cn),f.l]),f.t){case"s":case"str":return Qe.bookSST?(hn=get_sst_id(Qe.Strings,f.v==null?"":String(f.v),Qe.revStrings),cn.t="s",cn.v=hn,nn?write_record(qe,18,write_BrtShortIsst(f,cn)):write_record(qe,7,write_BrtCellIsst(f,cn))):(cn.t="str",nn?write_record(qe,17,write_BrtShortSt(f,cn)):write_record(qe,6,write_BrtCellSt(f,cn))),!0;case"n":return f.v==(f.v|0)&&f.v>-1e3&&f.v<1e3?nn?write_record(qe,13,write_BrtShortRk(f,cn)):write_record(qe,2,write_BrtCellRk(f,cn)):isFinite(f.v)?nn?write_record(qe,16,write_BrtShortReal(f,cn)):write_record(qe,5,write_BrtCellReal(f,cn)):(cn.t="e",isNaN(f.v)?nn?write_record(qe,14,write_BrtShortError({v:36},cn)):write_record(qe,3,write_BrtCellError({v:36},cn)):nn?write_record(qe,14,write_BrtShortError({v:7},cn)):write_record(qe,3,write_BrtCellError({v:7},cn))),!0;case"b":return cn.t="b",nn?write_record(qe,15,write_BrtShortBool(f,cn)):write_record(qe,4,write_BrtCellBool(f,cn)),!0;case"e":return cn.t="e",nn?write_record(qe,14,write_BrtShortError(f,cn)):write_record(qe,3,write_BrtCellError(f,cn)),!0}return nn?write_record(qe,12,write_BrtShortBlank(f,cn)):write_record(qe,1,write_BrtCellBlank(f,cn)),!0}function write_CELLTABLE(qe,f,ze,Ke,Qe){var Pi=safe_decode_range(f["!ref"]||"A1"),nn="",ln=[],cn=(((Qe||{}).Workbook||{}).WBProps||{}).date1904;write_record(qe,145);var hn=f["!data"]!=null,un=hn?f["!data"][Pi.s.r]:[],zn=Pi.e.r;f["!rows"]&&(zn=Math.max(Pi.e.r,f["!rows"].length-1));for(var Xn=Pi.s.r;Xn<=zn;++Xn)if(nn=encode_row(Xn),hn&&(un=f["!data"][Xn]),write_row_header(qe,f,Pi,Xn),!(hn&&!un)){var Un=!1;if(Xn<=Pi.e.r)for(var qn=Pi.s.c;qn<=Pi.e.c;++qn){Xn===Pi.s.r&&(ln[qn]=encode_col(qn));var ys=hn?un[qn]:f[ln[qn]+nn];if(!ys){Un=!1;continue}Un=write_ws_bin_cell(qe,ys,Xn,qn,Ke,f,Un,cn)}}write_record(qe,146)}function write_MERGECELLS(qe,f){!f||!f["!merges"]||(write_record(qe,177,write_BrtBeginMergeCells(f["!merges"].length)),f["!merges"].forEach(function(ze){write_record(qe,176,write_BrtMergeCell(ze))}),write_record(qe,178))}function write_COLINFOS(qe,f){!f||!f["!cols"]||(write_record(qe,390),f["!cols"].forEach(function(ze,Ke){ze&&write_record(qe,60,write_BrtColInfo(Ke,ze))}),write_record(qe,391))}function write_IGNOREECS(qe,f){!f||!f["!ref"]||(write_record(qe,648),write_record(qe,649,write_BrtCellIgnoreEC(safe_decode_range(f["!ref"]))),write_record(qe,650))}function write_HLINKS(qe,f,ze){f["!links"].forEach(function(Ke){if(Ke[1].Target){var Qe=add_rels(ze,-1,Ke[1].Target.replace(/#[\s\S]*$/,""),RELS.HLINK);write_record(qe,494,write_BrtHLink(Ke,Qe))}}),delete f["!links"]}function write_LEGACYDRAWING(qe,f,ze,Ke){if(f["!comments"].length>0){var Qe=add_rels(Ke,-1,"../drawings/vmlDrawing"+(ze+1)+".vml",RELS.VML);write_record(qe,551,write_RelID("rId"+Qe)),f["!legacy"]=Qe}}function write_AUTOFILTER(qe,f,ze,Ke){if(f["!autofilter"]){var Qe=f["!autofilter"],Pi=typeof Qe.ref=="string"?Qe.ref:encode_range(Qe.ref);ze.Workbook||(ze.Workbook={Sheets:[]}),ze.Workbook.Names||(ze.Workbook.Names=[]);var nn=ze.Workbook.Names,ln=decode_range(Pi);ln.s.r==ln.e.r&&(ln.e.r=decode_range(f["!ref"]).e.r,Pi=encode_range(ln));for(var cn=0;cn<nn.length;++cn){var hn=nn[cn];if(hn.Name=="_xlnm._FilterDatabase"&&hn.Sheet==Ke){hn.Ref=formula_quote_sheet_name(ze.SheetNames[Ke])+"!"+fix_range(Pi);break}}cn==nn.length&&nn.push({Name:"_xlnm._FilterDatabase",Sheet:Ke,Ref:formula_quote_sheet_name(ze.SheetNames[Ke])+"!"+fix_range(Pi)}),write_record(qe,161,write_UncheckedRfX(safe_decode_range(Pi))),write_record(qe,162)}}function write_WSVIEWS2(qe,f,ze){write_record(qe,133),write_record(qe,137,write_BrtBeginWsView(f,ze)),write_record(qe,138),write_record(qe,134)}function write_SHEETPROTECT(qe,f){f["!protect"]&&write_record(qe,535,write_BrtSheetProtection(f["!protect"]))}function write_ws_bin(qe,f,ze,Ke){var Qe=buf_array(),Pi=ze.SheetNames[qe],nn=ze.Sheets[Pi]||{},ln=Pi;try{ze&&ze.Workbook&&(ln=ze.Workbook.Sheets[qe].CodeName||ln)}catch{}var cn=safe_decode_range(nn["!ref"]||"A1");if(cn.e.c>16383||cn.e.r>1048575){if(f.WTF)throw new Error("Range "+(nn["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");cn.e.c=Math.min(cn.e.c,16383),cn.e.r=Math.min(cn.e.c,1048575)}return nn["!links"]=[],nn["!comments"]=[],write_record(Qe,129),(ze.vbaraw||nn["!outline"])&&write_record(Qe,147,write_BrtWsProp(ln,nn["!outline"])),write_record(Qe,148,write_BrtWsDim(cn)),write_WSVIEWS2(Qe,nn,ze.Workbook),write_COLINFOS(Qe,nn),write_CELLTABLE(Qe,nn,qe,f,ze),write_SHEETPROTECT(Qe,nn),write_AUTOFILTER(Qe,nn,ze,qe),write_MERGECELLS(Qe,nn),write_HLINKS(Qe,nn,Ke),nn["!margins"]&&write_record(Qe,476,write_BrtMargins(nn["!margins"])),(!f||f.ignoreEC||f.ignoreEC==null)&&write_IGNOREECS(Qe,nn),write_LEGACYDRAWING(Qe,nn,qe,Ke),write_record(Qe,130),Qe.end()}function parse_BrtCsProp(qe,f){qe.l+=10;var ze=parse_XLWideString(qe);return{name:ze}}var WBPropsDef=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]];function safe1904(qe){return!qe.Workbook||!qe.Workbook.WBProps?"false":parsexmlbool(qe.Workbook.WBProps.date1904)?"true":"false"}var badchars=":][*?/\\".split("");function check_ws_name(qe,f){try{if(qe=="")throw new Error("Sheet name cannot be blank");if(qe.length>31)throw new Error("Sheet name cannot exceed 31 chars");if(qe.charCodeAt(0)==39||qe.charCodeAt(qe.length-1)==39)throw new Error("Sheet name cannot start or end with apostrophe (')");if(qe.toLowerCase()=="history")throw new Error("Sheet name cannot be 'History'");badchars.forEach(function(ze){if(qe.indexOf(ze)!=-1)throw new Error("Sheet name cannot contain : \\ / ? * [ ]")})}catch(ze){throw ze}return!0}function check_wb_names(qe,f,ze){qe.forEach(function(Ke,Qe){check_ws_name(Ke);for(var Pi=0;Pi<Qe;++Pi)if(Ke==qe[Pi])throw new Error("Duplicate Sheet Name: "+Ke);if(ze){var nn=f&&f[Qe]&&f[Qe].CodeName||Ke;if(nn.charCodeAt(0)==95&&nn.length>22)throw new Error("Bad Code Name: Worksheet"+nn)}})}function check_wb(qe){if(!qe||!qe.SheetNames||!qe.Sheets)throw new Error("Invalid Workbook");if(!qe.SheetNames.length)throw new Error("Workbook is empty");var f=qe.Workbook&&qe.Workbook.Sheets||[];check_wb_names(qe.SheetNames,f,!!qe.vbaraw);for(var ze=0;ze<qe.SheetNames.length;++ze)check_ws(qe.Sheets[qe.SheetNames[ze]],qe.SheetNames[ze],ze);qe.SheetNames.forEach(function(Ke,Qe){var Pi=qe.Sheets[Ke];if(!(!Pi||!Pi["!autofilter"])){var nn;qe.Workbook||(qe.Workbook={}),qe.Workbook.Names||(qe.Workbook.Names=[]),qe.Workbook.Names.forEach(function(cn){cn.Name=="_xlnm._FilterDatabase"&&cn.Sheet==Qe&&(nn=cn)});var ln=formula_quote_sheet_name(Ke)+"!"+fix_range(Pi["!autofilter"].ref);nn?nn.Ref=ln:qe.Workbook.Names.push({Name:"_xlnm._FilterDatabase",Sheet:Qe,Ref:ln})}})}function write_wb_xml(qe){var f=[XML_HEADER];f[f.length]=writextag("workbook",null,{xmlns:XMLNS_main[0],"xmlns:r":XMLNS.r});var ze=qe.Workbook&&(qe.Workbook.Names||[]).length>0,Ke={codeName:"ThisWorkbook"};qe.Workbook&&qe.Workbook.WBProps&&(WBPropsDef.forEach(function(ln){qe.Workbook.WBProps[ln[0]]!=null&&qe.Workbook.WBProps[ln[0]]!=ln[1]&&(Ke[ln[0]]=qe.Workbook.WBProps[ln[0]])}),qe.Workbook.WBProps.CodeName&&(Ke.codeName=qe.Workbook.WBProps.CodeName,delete Ke.CodeName)),f[f.length]=writextag("workbookPr",null,Ke);var Qe=qe.Workbook&&qe.Workbook.Sheets||[],Pi=0;if(Qe&&Qe[0]&&Qe[0].Hidden){for(f[f.length]="<bookViews>",Pi=0;Pi!=qe.SheetNames.length&&!(!Qe[Pi]||!Qe[Pi].Hidden);++Pi);Pi==qe.SheetNames.length&&(Pi=0),f[f.length]='<workbookView firstSheet="'+Pi+'" activeTab="'+Pi+'"/>',f[f.length]="</bookViews>"}for(f[f.length]="<sheets>",Pi=0;Pi!=qe.SheetNames.length;++Pi){var nn={name:escapexml(qe.SheetNames[Pi].slice(0,31))};if(nn.sheetId=""+(Pi+1),nn["r:id"]="rId"+(Pi+1),Qe[Pi])switch(Qe[Pi].Hidden){case 1:nn.state="hidden";break;case 2:nn.state="veryHidden";break}f[f.length]=writextag("sheet",null,nn)}return f[f.length]="</sheets>",ze&&(f[f.length]="<definedNames>",qe.Workbook&&qe.Workbook.Names&&qe.Workbook.Names.forEach(function(ln){var cn={name:ln.Name};ln.Comment&&(cn.comment=ln.Comment),ln.Sheet!=null&&(cn.localSheetId=""+ln.Sheet),ln.Hidden&&(cn.hidden="1"),ln.Ref&&(f[f.length]=writextag("definedName",escapexml(ln.Ref),cn))}),f[f.length]="</definedNames>"),f.length>2&&(f[f.length]="</workbook>",f[1]=f[1].replace("/>",">")),f.join("")}function parse_BrtBundleSh(qe,f){var ze={};return ze.Hidden=qe.read_shift(4),ze.iTabID=qe.read_shift(4),ze.strRelID=parse_RelID(qe),ze.name=parse_XLWideString(qe),ze}function write_BrtBundleSh(qe,f){return f||(f=new_buf(127)),f.write_shift(4,qe.Hidden),f.write_shift(4,qe.iTabID),write_RelID(qe.strRelID,f),write_XLWideString(qe.name.slice(0,31),f),f.length>f.l?f.slice(0,f.l):f}function parse_BrtWbProp(qe,f){var ze={},Ke=qe.read_shift(4);ze.defaultThemeVersion=qe.read_shift(4);var Qe=f>8?parse_XLWideString(qe):"";return Qe.length>0&&(ze.CodeName=Qe),ze.autoCompressPictures=!!(Ke&65536),ze.backupFile=!!(Ke&64),ze.checkCompatibility=!!(Ke&4096),ze.date1904=!!(Ke&1),ze.filterPrivacy=!!(Ke&8),ze.hidePivotFieldList=!!(Ke&1024),ze.promptedSolutions=!!(Ke&16),ze.publishItems=!!(Ke&2048),ze.refreshAllConnections=!!(Ke&262144),ze.saveExternalLinkValues=!!(Ke&128),ze.showBorderUnselectedTables=!!(Ke&4),ze.showInkAnnotation=!!(Ke&32),ze.showObjects=["all","placeholders","none"][Ke>>13&3],ze.showPivotChartFilter=!!(Ke&32768),ze.updateLinks=["userSet","never","always"][Ke>>8&3],ze}function write_BrtWbProp(qe,f){f||(f=new_buf(72));var ze=0;return qe&&(qe.date1904&&(ze|=1),qe.filterPrivacy&&(ze|=8)),f.write_shift(4,ze),f.write_shift(4,0),write_XLSBCodeName(qe&&qe.CodeName||"ThisWorkbook",f),f.slice(0,f.l)}function parse_BrtName(qe,f,ze){var Ke=qe.l+f,Qe=qe.read_shift(4);qe.l+=1;var Pi=qe.read_shift(4),nn=parse_XLNameWideString(qe),ln,cn="";try{ln=parse_XLSBNameParsedFormula(qe,0,ze);try{cn=parse_XLNullableWideString(qe)}catch{}}catch{console.error("Could not parse defined name "+nn)}Qe&32&&(nn="_xlnm."+nn),qe.l=Ke;var hn={Name:nn,Ptg:ln,Flags:Qe};return Pi<268435455&&(hn.Sheet=Pi),cn&&(hn.Comment=cn),hn}function write_BrtName(qe,f){var ze=new_buf(9),Ke=0,Qe=qe.Name;XLSLblBuiltIn.indexOf(Qe)>-1&&(Ke|=32,Qe=Qe.slice(6)),ze.write_shift(4,Ke),ze.write_shift(1,0),ze.write_shift(4,qe.Sheet==null?4294967295:qe.Sheet);var Pi=[ze,write_XLWideString(Qe),write_XLSBNameParsedFormula(qe.Ref,f)];if(qe.Comment)Pi.push(write_XLNullableWideString(qe.Comment));else{var nn=new_buf(4);nn.write_shift(4,4294967295),Pi.push(nn)}return bconcat(Pi)}function write_BUNDLESHS(qe,f){write_record(qe,143);for(var ze=0;ze!=f.SheetNames.length;++ze){var Ke=f.Workbook&&f.Workbook.Sheets&&f.Workbook.Sheets[ze]&&f.Workbook.Sheets[ze].Hidden||0,Qe={Hidden:Ke,iTabID:ze+1,strRelID:"rId"+(ze+1),name:f.SheetNames[ze]};write_record(qe,156,write_BrtBundleSh(Qe))}write_record(qe,144)}function write_BrtFileVersion(qe,f){f||(f=new_buf(127));for(var ze=0;ze!=4;++ze)f.write_shift(4,0);return write_XLWideString("SheetJS",f),write_XLWideString(XLSX.version,f),write_XLWideString(XLSX.version,f),write_XLWideString("7262",f),f.length>f.l?f.slice(0,f.l):f}function write_BrtBookView(qe,f){f||(f=new_buf(29)),f.write_shift(-4,0),f.write_shift(-4,460),f.write_shift(4,28800),f.write_shift(4,17600),f.write_shift(4,500),f.write_shift(4,qe),f.write_shift(4,qe);var ze=120;return f.write_shift(1,ze),f.length>f.l?f.slice(0,f.l):f}function write_BOOKVIEWS(qe,f){if(!(!f.Workbook||!f.Workbook.Sheets)){for(var ze=f.Workbook.Sheets,Ke=0,Qe=-1,Pi=-1;Ke<ze.length;++Ke)!ze[Ke]||!ze[Ke].Hidden&&Qe==-1?Qe=Ke:ze[Ke].Hidden==1&&Pi==-1&&(Pi=Ke);Pi>Qe||(write_record(qe,135),write_record(qe,158,write_BrtBookView(Qe)),write_record(qe,136))}}function write_BRTNAMES(qe,f){!f.Workbook||!f.Workbook.Names||f.Workbook.Names.forEach(function(ze){try{if(ze.Flags&14)return;write_record(qe,39,write_BrtName(ze,f))}catch{console.error("Could not serialize defined name "+JSON.stringify(ze))}})}function write_SELF_EXTERNS_xlsb(qe){var f=qe.SheetNames.length,ze=new_buf(12*f+28);ze.write_shift(4,f+2),ze.write_shift(4,0),ze.write_shift(4,-2),ze.write_shift(4,-2),ze.write_shift(4,0),ze.write_shift(4,-1),ze.write_shift(4,-1);for(var Ke=0;Ke<f;++Ke)ze.write_shift(4,0),ze.write_shift(4,Ke),ze.write_shift(4,Ke);return ze}function write_EXTERNALS_xlsb(qe,f){write_record(qe,353),write_record(qe,357),write_record(qe,362,write_SELF_EXTERNS_xlsb(f)),write_record(qe,354)}function write_wb_bin(qe,f){var ze=buf_array();return write_record(ze,131),write_record(ze,128,write_BrtFileVersion()),write_record(ze,153,write_BrtWbProp(qe.Workbook&&qe.Workbook.WBProps||null)),write_BOOKVIEWS(ze,qe),write_BUNDLESHS(ze,qe),write_EXTERNALS_xlsb(ze,qe),(qe.Workbook||{}).Names&&write_BRTNAMES(ze,qe),write_record(ze,132),ze.end()}function write_props_xlml(qe,f){var ze=[];return qe.Props&&ze.push(xlml_write_docprops(qe.Props,f)),qe.Custprops&&ze.push(xlml_write_custprops(qe.Props,qe.Custprops)),ze.join("")}function write_wb_xlml(qe){return(((qe||{}).Workbook||{}).WBProps||{}).date1904?'<ExcelWorkbook xmlns="urn:schemas-microsoft-com:office:excel"><Date1904/></ExcelWorkbook>':""}function write_sty_xlml(qe,f){var ze=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return f.cellXfs.forEach(function(Ke,Qe){var Pi=[];Pi.push(writextag("NumberFormat",null,{"ss:Format":escapexml(table_fmt[Ke.numFmtId])}));var nn={"ss:ID":"s"+(21+Qe)};ze.push(writextag("Style",Pi.join(""),nn))}),writextag("Styles",ze.join(""))}function write_name_xlml(qe){return writextag("NamedRange",null,{"ss:Name":qe.Name.slice(0,6)=="_xlnm."?qe.Name.slice(6):qe.Name,"ss:RefersTo":"="+a1_to_rc(qe.Ref,{r:0,c:0})})}function write_names_xlml(qe){if(!((qe||{}).Workbook||{}).Names)return"";for(var f=qe.Workbook.Names,ze=[],Ke=0;Ke<f.length;++Ke){var Qe=f[Ke];Qe.Sheet==null&&(Qe.Name.match(/^_xlfn\./)||ze.push(write_name_xlml(Qe)))}return writextag("Names",ze.join(""))}function write_ws_xlml_names(qe,f,ze,Ke){if(!qe||!((Ke||{}).Workbook||{}).Names)return"";for(var Qe=Ke.Workbook.Names,Pi=[],nn=0;nn<Qe.length;++nn){var ln=Qe[nn];ln.Sheet==ze&&(ln.Name.match(/^_xlfn\./)||Pi.push(write_name_xlml(ln)))}return Pi.join("")}function write_ws_xlml_wsopts(qe,f,ze,Ke){if(!qe)return"";var Qe=[];if(qe["!margins"]&&(Qe.push("<PageSetup>"),qe["!margins"].header&&Qe.push(writextag("Header",null,{"x:Margin":qe["!margins"].header})),qe["!margins"].footer&&Qe.push(writextag("Footer",null,{"x:Margin":qe["!margins"].footer})),Qe.push(writextag("PageMargins",null,{"x:Bottom":qe["!margins"].bottom||"0.75","x:Left":qe["!margins"].left||"0.7","x:Right":qe["!margins"].right||"0.7","x:Top":qe["!margins"].top||"0.75"})),Qe.push("</PageSetup>")),Ke&&Ke.Workbook&&Ke.Workbook.Sheets&&Ke.Workbook.Sheets[ze])if(Ke.Workbook.Sheets[ze].Hidden)Qe.push(writextag("Visible",Ke.Workbook.Sheets[ze].Hidden==1?"SheetHidden":"SheetVeryHidden",{}));else{for(var Pi=0;Pi<ze&&!(Ke.Workbook.Sheets[Pi]&&!Ke.Workbook.Sheets[Pi].Hidden);++Pi);Pi==ze&&Qe.push("<Selected/>")}return((((Ke||{}).Workbook||{}).Views||[])[0]||{}).RTL&&Qe.push("<DisplayRightToLeft/>"),qe["!protect"]&&(Qe.push(writetag("ProtectContents","True")),qe["!protect"].objects&&Qe.push(writetag("ProtectObjects","True")),qe["!protect"].scenarios&&Qe.push(writetag("ProtectScenarios","True")),qe["!protect"].selectLockedCells!=null&&!qe["!protect"].selectLockedCells?Qe.push(writetag("EnableSelection","NoSelection")):qe["!protect"].selectUnlockedCells!=null&&!qe["!protect"].selectUnlockedCells&&Qe.push(writetag("EnableSelection","UnlockedCells")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach(function(nn){qe["!protect"][nn[0]]&&Qe.push("<"+nn[1]+"/>")})),Qe.length==0?"":writextag("WorksheetOptions",Qe.join(""),{xmlns:XLMLNS.x})}function write_ws_xlml_comment(qe){return qe.map(function(f){var ze=xlml_unfixstr(f.t||""),Ke=writextag("ss:Data",ze,{xmlns:"http://www.w3.org/TR/REC-html40"}),Qe={};return f.a&&(Qe["ss:Author"]=f.a),qe.hidden||(Qe["ss:ShowAlways"]="1"),writextag("Comment",Ke,Qe)}).join("")}function write_ws_xlml_cell(qe,f,ze,Ke,Qe,Pi,nn){if(!qe||qe.v==null&&qe.f==null)return"";var ln={};if(qe.f&&(ln["ss:Formula"]="="+escapexml(a1_to_rc(qe.f,nn))),qe.F&&qe.F.slice(0,f.length)==f){var cn=decode_cell(qe.F.slice(f.length+1));ln["ss:ArrayRange"]="RC:R"+(cn.r==nn.r?"":"["+(cn.r-nn.r)+"]")+"C"+(cn.c==nn.c?"":"["+(cn.c-nn.c)+"]")}if(qe.l&&qe.l.Target&&(ln["ss:HRef"]=escapexml(qe.l.Target),qe.l.Tooltip&&(ln["x:HRefScreenTip"]=escapexml(qe.l.Tooltip))),ze["!merges"])for(var hn=ze["!merges"],un=0;un!=hn.length;++un)hn[un].s.c!=nn.c||hn[un].s.r!=nn.r||(hn[un].e.c>hn[un].s.c&&(ln["ss:MergeAcross"]=hn[un].e.c-hn[un].s.c),hn[un].e.r>hn[un].s.r&&(ln["ss:MergeDown"]=hn[un].e.r-hn[un].s.r));var zn="",Xn="";switch(qe.t){case"z":if(!Ke.sheetStubs)return"";break;case"n":isFinite(qe.v)?(zn="Number",Xn=String(qe.v)):(zn="Error",Xn=BErr[isNaN(qe.v)?36:7]);break;case"b":zn="Boolean",Xn=qe.v?"1":"0";break;case"e":zn="Error",Xn=BErr[qe.v];break;case"d":zn="DateTime",Xn=new Date(qe.v).toISOString(),qe.z==null&&(qe.z=qe.z||table_fmt[14]);break;case"s":zn="String",Xn=escapexlml(qe.v||"");break}var Un=get_cell_style(Ke.cellXfs,qe,Ke);ln["ss:StyleID"]="s"+(21+Un),ln["ss:Index"]=nn.c+1;var qn=qe.v!=null?Xn:"",ys=qe.t=="z"?"":'<Data ss:Type="'+zn+'">'+qn+"</Data>";return(qe.c||[]).length>0&&(ys+=write_ws_xlml_comment(qe.c)),writextag("Cell",ys,ln)}function write_ws_xlml_row(qe,f){var ze='<Row ss:Index="'+(qe+1)+'"';return f&&(f.hpt&&!f.hpx&&(f.hpx=pt2px(f.hpt)),f.hpx&&(ze+=' ss:AutoFitHeight="0" ss:Height="'+f.hpx+'"'),f.hidden&&(ze+=' ss:Hidden="1"')),ze+">"}function write_ws_xlml_table(qe,f,ze,Ke){if(!qe["!ref"])return"";var Qe=safe_decode_range(qe["!ref"]),Pi=qe["!merges"]||[],nn=0,ln=[];qe["!cols"]&&qe["!cols"].forEach(function(vs,ea){process_col(vs);var na=!!vs.width,ta=col_obj_w(ea,vs),ra={"ss:Index":ea+1};na&&(ra["ss:Width"]=width2px(ta.width)),vs.hidden&&(ra["ss:Hidden"]="1"),ln.push(writextag("Column",null,ra))});for(var cn=qe["!data"]!=null,hn={r:0,c:0},un=Qe.s.r;un<=Qe.e.r;++un){var zn=[write_ws_xlml_row(un,(qe["!rows"]||[])[un])];hn.r=un;for(var Xn=Qe.s.c;Xn<=Qe.e.c;++Xn){hn.c=Xn;var Un=!1;for(nn=0;nn!=Pi.length;++nn)if(!(Pi[nn].s.c>Xn)&&!(Pi[nn].s.r>un)&&!(Pi[nn].e.c<Xn)&&!(Pi[nn].e.r<un)){(Pi[nn].s.c!=Xn||Pi[nn].s.r!=un)&&(Un=!0);break}if(!Un){var qn=encode_col(Xn)+encode_row(un),ys=cn?(qe["!data"][un]||[])[Xn]:qe[qn];zn.push(write_ws_xlml_cell(ys,qn,qe,f,ze,Ke,hn))}}zn.push("</Row>"),zn.length>2&&ln.push(zn.join(""))}return ln.join("")}function write_ws_xlml(qe,f,ze){var Ke=[],Qe=ze.SheetNames[qe],Pi=ze.Sheets[Qe],nn=Pi?write_ws_xlml_names(Pi,f,qe,ze):"";return nn.length>0&&Ke.push("<Names>"+nn+"</Names>"),nn=Pi?write_ws_xlml_table(Pi,f,qe,ze):"",nn.length>0&&Ke.push("<Table>"+nn+"</Table>"),Ke.push(write_ws_xlml_wsopts(Pi,f,qe,ze)),Pi&&Pi["!autofilter"]&&Ke.push('<AutoFilter x:Range="'+a1_to_rc(fix_range(Pi["!autofilter"].ref),{r:0,c:0})+'" xmlns="urn:schemas-microsoft-com:office:excel"></AutoFilter>'),Ke.join("")}function write_xlml(qe,f){f||(f={}),qe.SSF||(qe.SSF=dup(table_fmt)),qe.SSF&&(make_ssf(),SSF_load_table(qe.SSF),f.revssf=evert_num(qe.SSF),f.revssf[qe.SSF[65535]]=0,f.ssf=qe.SSF,f.cellXfs=[],get_cell_style(f.cellXfs,{},{revssf:{General:0}}));var ze=[];ze.push(write_props_xlml(qe,f)),ze.push(write_wb_xlml(qe)),ze.push(""),ze.push(write_names_xlml(qe));for(var Ke=0;Ke<qe.SheetNames.length;++Ke)ze.push(writextag("Worksheet",write_ws_xlml(Ke,f,qe),{"ss:Name":escapexml(qe.SheetNames[Ke])}));return ze[2]=write_sty_xlml(qe,f),XML_HEADER+writextag("Workbook",ze.join(""),{xmlns:XLMLNS.ss,"xmlns:o":XLMLNS.o,"xmlns:x":XLMLNS.x,"xmlns:ss":XLMLNS.ss,"xmlns:dt":XLMLNS.dt,"xmlns:html":XLMLNS.html})}var PSCLSID={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function write_xls_props(qe,f){var ze=[],Ke=[],Qe=[],Pi=0,nn,ln=evert_key(DocSummaryPIDDSI,"n"),cn=evert_key(SummaryPIDSI,"n");if(qe.Props)for(nn=keys(qe.Props),Pi=0;Pi<nn.length;++Pi)(Object.prototype.hasOwnProperty.call(ln,nn[Pi])?ze:Object.prototype.hasOwnProperty.call(cn,nn[Pi])?Ke:Qe).push([nn[Pi],qe.Props[nn[Pi]]]);if(qe.Custprops)for(nn=keys(qe.Custprops),Pi=0;Pi<nn.length;++Pi)Object.prototype.hasOwnProperty.call(qe.Props||{},nn[Pi])||(Object.prototype.hasOwnProperty.call(ln,nn[Pi])?ze:Object.prototype.hasOwnProperty.call(cn,nn[Pi])?Ke:Qe).push([nn[Pi],qe.Custprops[nn[Pi]]]);var hn=[];for(Pi=0;Pi<Qe.length;++Pi)XLSPSSkip.indexOf(Qe[Pi][0])>-1||PseudoPropsPairs.indexOf(Qe[Pi][0])>-1||Qe[Pi][1]!=null&&hn.push(Qe[Pi]);Ke.length&&CFB.utils.cfb_add(f,"/SummaryInformation",write_PropertySetStream(Ke,PSCLSID.SI,cn,SummaryPIDSI)),(ze.length||hn.length)&&CFB.utils.cfb_add(f,"/DocumentSummaryInformation",write_PropertySetStream(ze,PSCLSID.DSI,ln,DocSummaryPIDDSI,hn.length?hn:null,PSCLSID.UDI))}function write_xlscfb(qe,f){var ze=f||{},Ke=CFB.utils.cfb_new({root:"R"}),Qe="/Workbook";switch(ze.bookType||"xls"){case"xls":ze.bookType="biff8";case"xla":ze.bookType||(ze.bookType="xla");case"biff8":Qe="/Workbook",ze.biff=8;break;case"biff5":Qe="/Book",ze.biff=5;break;default:throw new Error("invalid type "+ze.bookType+" for XLS CFB")}return CFB.utils.cfb_add(Ke,Qe,write_biff_buf(qe,ze)),ze.biff==8&&(qe.Props||qe.Custprops)&&write_xls_props(qe,Ke),ze.biff==8&&qe.vbaraw&&fill_vba_xls(Ke,CFB.read(qe.vbaraw,{type:typeof qe.vbaraw=="string"?"binary":"buffer"})),Ke}var XLSBRecordEnum={0:{f:parse_BrtRowHdr},1:{f:parse_BrtCellBlank},2:{f:parse_BrtCellRk},3:{f:parse_BrtCellError},4:{f:parse_BrtCellBool},5:{f:parse_BrtCellReal},6:{f:parse_BrtCellSt},7:{f:parse_BrtCellIsst},8:{f:parse_BrtFmlaString},9:{f:parse_BrtFmlaNum},10:{f:parse_BrtFmlaBool},11:{f:parse_BrtFmlaError},12:{f:parse_BrtShortBlank},13:{f:parse_BrtShortRk},14:{f:parse_BrtShortError},15:{f:parse_BrtShortBool},16:{f:parse_BrtShortReal},17:{f:parse_BrtShortSt},18:{f:parse_BrtShortIsst},19:{f:parse_RichStr},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:parse_BrtName},40:{},42:{},43:{f:parse_BrtFont},44:{f:parse_BrtFmt},45:{f:parse_BrtFill},46:{f:parse_BrtBorder},47:{f:parse_BrtXF},48:{},49:{f:parse_Int32LE},50:{},51:{f:parse_BrtMdb},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:parse_ColInfo},62:{f:parse_BrtCellRString},63:{f:parse_BrtCalcChainItem$},64:{f:parse_BrtDVal},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:parsenoop,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:parse_BrtBeginWsView},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:parse_BrtWsProp},148:{f:parse_BrtWsDim,p:16},151:{f:parse_BrtPane},152:{},153:{f:parse_BrtWbProp},154:{},155:{},156:{f:parse_BrtBundleSh},157:{},158:{},159:{T:1,f:parse_BrtBeginSst},160:{T:-1},161:{T:1,f:parse_UncheckedRfX},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:parse_BrtMergeCell},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:parse_BrtMdtinfo},336:{T:-1},337:{f:parse_BrtBeginEsmdb,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:parse_RelID},357:{},358:{},359:{},360:{T:1},361:{},362:{f:parse_ExternSheet},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:parse_BrtArrFmla},427:{f:parse_BrtShrFmla},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:parse_BrtMargins},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:parse_BrtWsFmtInfo},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:parse_BrtHLink},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:parse_RelID},551:{f:parse_XLNullableWideString},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:parse_BrtCommentAuthor},633:{T:1},634:{T:-1},635:{T:1,f:parse_BrtBeginComment},636:{T:-1},637:{f:parse_BrtCommentText},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:parse_BrtCsProp},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:parse_BrtDVal14},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}};function write_biff_rec(qe,f,ze,Ke){var Qe=f;if(!isNaN(Qe)){var Pi=Ke||(ze||[]).length||0,nn=qe.next(4);nn.write_shift(2,Qe),nn.write_shift(2,Pi),Pi>0&&is_buf(ze)&&qe.push(ze)}}function write_biff_continue(qe,f,ze,Ke){var Qe=(ze||[]).length||0;if(Qe<=8224)return write_biff_rec(qe,f,ze,Qe);var Pi=f;if(!isNaN(Pi)){for(var nn=ze.parts||[],ln=0,cn=0,hn=0;hn+(nn[ln]||8224)<=8224;)hn+=nn[ln]||8224,ln++;var un=qe.next(4);for(un.write_shift(2,Pi),un.write_shift(2,hn),qe.push(ze.slice(cn,cn+hn)),cn+=hn;cn<Qe;){for(un=qe.next(4),un.write_shift(2,60),hn=0;hn+(nn[ln]||8224)<=8224;)hn+=nn[ln]||8224,ln++;un.write_shift(2,hn),qe.push(ze.slice(cn,cn+hn)),cn+=hn}}}function write_BIFF2BERR(qe,f,ze,Ke){var Qe=new_buf(9);return write_BIFF2Cell(Qe,qe,f),write_Bes(ze,Ke||"b",Qe),Qe}function write_BIFF2LABEL(qe,f,ze){var Ke=new_buf(8+2*ze.length);return write_BIFF2Cell(Ke,qe,f),Ke.write_shift(1,ze.length),Ke.write_shift(ze.length,ze,"sbcs"),Ke.l<Ke.length?Ke.slice(0,Ke.l):Ke}function write_comments_biff2(qe,f){f.forEach(function(ze){var Ke=ze[0].map(function(Pi){return Pi.t}).join("");if(Ke.length<=2048)return write_biff_rec(qe,28,write_NOTE_BIFF2(Ke,ze[1],ze[2]));write_biff_rec(qe,28,write_NOTE_BIFF2(Ke.slice(0,2048),ze[1],ze[2],Ke.length));for(var Qe=2048;Qe<Ke.length;Qe+=2048)write_biff_rec(qe,28,write_NOTE_BIFF2(Ke.slice(Qe,Math.min(Qe+2048,Ke.length)),-1,-1,Math.min(2048,Ke.length-Qe)))})}function write_ws_biff2_cell(qe,f,ze,Ke,Qe,Pi){var nn=0;f.z!=null&&(nn=Qe._BIFF2FmtTable.indexOf(f.z),nn==-1&&(Qe._BIFF2FmtTable.push(f.z),nn=Qe._BIFF2FmtTable.length-1));var ln=0;if(f.z!=null){for(;ln<Qe.cellXfs.length&&Qe.cellXfs[ln].numFmtId!=nn;++ln);ln==Qe.cellXfs.length&&Qe.cellXfs.push({numFmtId:nn})}if(f.v!=null)switch(f.t){case"d":case"n":var cn=f.t=="d"?datenum(parseDate(f.v,Pi),Pi):f.v;Qe.biff==2&&cn==(cn|0)&&cn>=0&&cn<65536?write_biff_rec(qe,2,write_BIFF2INT(ze,Ke,cn,ln,nn)):isNaN(cn)?write_biff_rec(qe,5,write_BIFF2BERR(ze,Ke,36,"e")):isFinite(cn)?write_biff_rec(qe,3,write_BIFF2NUM(ze,Ke,cn,ln,nn)):write_biff_rec(qe,5,write_BIFF2BERR(ze,Ke,7,"e"));return;case"b":case"e":write_biff_rec(qe,5,write_BIFF2BERR(ze,Ke,f.v,f.t));return;case"s":case"str":write_biff_rec(qe,4,write_BIFF2LABEL(ze,Ke,f.v==null?"":String(f.v).slice(0,255)));return}write_biff_rec(qe,1,write_BIFF2Cell(null,ze,Ke))}function write_ws_biff2(qe,f,ze,Ke,Qe){var Pi=f["!data"]!=null,nn=safe_decode_range(f["!ref"]||"A1"),ln="",cn=[];if(nn.e.c>255||nn.e.r>16383){if(Ke.WTF)throw new Error("Range "+(f["!ref"]||"A1")+" exceeds format limit A1:IV16384");nn.e.c=Math.min(nn.e.c,255),nn.e.r=Math.min(nn.e.r,16383)}for(var hn=(((Qe||{}).Workbook||{}).WBProps||{}).date1904,un=[],zn=[],Xn=nn.s.c;Xn<=nn.e.c;++Xn)cn[Xn]=encode_col(Xn);for(var Un=nn.s.r;Un<=nn.e.r;++Un)for(Pi&&(un=f["!data"][Un]||[]),ln=encode_row(Un),Xn=nn.s.c;Xn<=nn.e.c;++Xn){var qn=Pi?un[Xn]:f[cn[Xn]+ln];qn&&(write_ws_biff2_cell(qe,qn,Un,Xn,Ke,hn),qn.c&&zn.push([qn.c,Un,Xn]))}write_comments_biff2(qe,zn)}function write_biff2_buf(qe,f){for(var ze=f||{},Ke=buf_array(),Qe=0,Pi=0;Pi<qe.SheetNames.length;++Pi)qe.SheetNames[Pi]==ze.sheet&&(Qe=Pi);if(Qe==0&&ze.sheet&&qe.SheetNames[0]!=ze.sheet)throw new Error("Sheet not found: "+ze.sheet);write_biff_rec(Ke,ze.biff==4?1033:ze.biff==3?521:9,write_BOF(qe,16,ze)),((qe.Workbook||{}).WBProps||{}).date1904&&write_biff_rec(Ke,34,writebool(!0)),ze.cellXfs=[{numFmtId:0}],ze._BIFF2FmtTable=["General"],ze._Fonts=[];var nn=buf_array();return write_ws_biff2(nn,qe.Sheets[qe.SheetNames[Qe]],Qe,ze,qe),ze._BIFF2FmtTable.forEach(function(ln){ze.biff<=3?write_biff_rec(Ke,30,write_BIFF2Format(ln)):write_biff_rec(Ke,1054,write_BIFF4Format(ln))}),ze.cellXfs.forEach(function(ln){switch(ze.biff){case 2:write_biff_rec(Ke,67,write_BIFF2XF(ln));break;case 3:write_biff_rec(Ke,579,write_BIFF3XF(ln));break;case 4:write_biff_rec(Ke,1091,write_BIFF4XF(ln));break}}),delete ze._BIFF2FmtTable,delete ze.cellXfs,delete ze._Fonts,Ke.push(nn.end()),write_biff_rec(Ke,10),Ke.end()}var b8oid=1,b8ocnts=[];function write_MsoDrawingGroup(){var qe=new_buf(82+8*b8ocnts.length);qe.write_shift(2,15),qe.write_shift(2,61440),qe.write_shift(4,74+8*b8ocnts.length);{qe.write_shift(2,0),qe.write_shift(2,61446),qe.write_shift(4,16+8*b8ocnts.length);{qe.write_shift(4,b8oid),qe.write_shift(4,b8ocnts.length+1);for(var f=0,ze=0;ze<b8ocnts.length;++ze)f+=b8ocnts[ze]&&b8ocnts[ze][1]||0;qe.write_shift(4,f),qe.write_shift(4,b8ocnts.length)}b8ocnts.forEach(function(Ke){qe.write_shift(4,Ke[0]),qe.write_shift(4,Ke[2])})}return qe.write_shift(2,51),qe.write_shift(2,61451),qe.write_shift(4,18),qe.write_shift(2,191),qe.write_shift(4,524296),qe.write_shift(2,385),qe.write_shift(4,134217793),qe.write_shift(2,448),qe.write_shift(4,134217792),qe.write_shift(2,64),qe.write_shift(2,61726),qe.write_shift(4,16),qe.write_shift(4,134217741),qe.write_shift(4,134217740),qe.write_shift(4,134217751),qe.write_shift(4,268435703),qe}function write_comments_biff8(qe,f){var ze=[],Ke=0,Qe=buf_array(),Pi=b8oid,nn;f.forEach(function(cn,hn){var un="",zn=cn[0].map(function(ta){return ta.a&&!un&&(un=ta.a),ta.t}).join("");++b8oid;{var Xn=new_buf(150);Xn.write_shift(2,15),Xn.write_shift(2,61444),Xn.write_shift(4,150),Xn.write_shift(2,3234),Xn.write_shift(2,61450),Xn.write_shift(4,8),Xn.write_shift(4,b8oid),Xn.write_shift(4,2560),Xn.write_shift(2,227),Xn.write_shift(2,61451),Xn.write_shift(4,84),Xn.write_shift(2,128),Xn.write_shift(4,0),Xn.write_shift(2,139),Xn.write_shift(4,2),Xn.write_shift(2,191),Xn.write_shift(4,524296),Xn.write_shift(2,344),Xn.l+=4,Xn.write_shift(2,385),Xn.write_shift(4,134217808),Xn.write_shift(2,387),Xn.write_shift(4,134217808),Xn.write_shift(2,389),Xn.write_shift(4,268435700),Xn.write_shift(2,447),Xn.write_shift(4,1048592),Xn.write_shift(2,448),Xn.write_shift(4,134217809),Xn.write_shift(2,451),Xn.write_shift(4,268435700),Xn.write_shift(2,513),Xn.write_shift(4,134217809),Xn.write_shift(2,515),Xn.write_shift(4,268435700),Xn.write_shift(2,575),Xn.write_shift(4,196609),Xn.write_shift(2,959),Xn.write_shift(4,131072|(cn[0].hidden?2:0)),Xn.l+=2,Xn.write_shift(2,61456),Xn.write_shift(4,18),Xn.write_shift(2,3),Xn.write_shift(2,cn[2]+2),Xn.l+=2,Xn.write_shift(2,cn[1]+1),Xn.l+=2,Xn.write_shift(2,cn[2]+4),Xn.l+=2,Xn.write_shift(2,cn[1]+5),Xn.l+=2,Xn.l+=2,Xn.write_shift(2,61457),Xn.l+=4,Xn.l=150,hn==0?nn=Xn:write_biff_rec(Qe,236,Xn)}Ke+=150;{var Un=new_buf(52);Un.write_shift(2,21),Un.write_shift(2,18),Un.write_shift(2,25),Un.write_shift(2,b8oid),Un.write_shift(2,0),Un.l=22,Un.write_shift(2,13),Un.write_shift(2,22),Un.write_shift(4,1651663474),Un.write_shift(4,2503426821),Un.write_shift(4,2150634280),Un.write_shift(4,1768515844+b8oid*256),Un.write_shift(2,0),Un.write_shift(4,0),Un.l+=4,write_biff_rec(Qe,93,Un)}{var qn=new_buf(8);qn.l+=2,qn.write_shift(2,61453),qn.l+=4,write_biff_rec(Qe,236,qn)}Ke+=8;{var ys=new_buf(18);ys.write_shift(2,18),ys.l+=8,ys.write_shift(2,zn.length),ys.write_shift(2,16),ys.l+=4,write_biff_rec(Qe,438,ys);{var vs=new_buf(1+zn.length);vs.write_shift(1,0),vs.write_shift(zn.length,zn,"sbcs"),write_biff_rec(Qe,60,vs)}{var ea=new_buf(16);ea.l+=8,ea.write_shift(2,zn.length),ea.l+=6,write_biff_rec(Qe,60,ea)}}{var na=new_buf(12+un.length);na.write_shift(2,cn[1]),na.write_shift(2,cn[2]),na.write_shift(2,0|(cn[0].hidden?0:2)),na.write_shift(2,b8oid),na.write_shift(2,un.length),na.write_shift(1,0),na.write_shift(un.length,un,"sbcs"),na.l++,ze.push(na)}});{var ln=new_buf(80);ln.write_shift(2,15),ln.write_shift(2,61442),ln.write_shift(4,Ke+ln.length-8),ln.write_shift(2,16),ln.write_shift(2,61448),ln.write_shift(4,8),ln.write_shift(4,f.length+1),ln.write_shift(4,b8oid),ln.write_shift(2,15),ln.write_shift(2,61443),ln.write_shift(4,Ke+48),ln.write_shift(2,15),ln.write_shift(2,61444),ln.write_shift(4,40),ln.write_shift(2,1),ln.write_shift(2,61449),ln.write_shift(4,16),ln.l+=16,ln.write_shift(2,2),ln.write_shift(2,61450),ln.write_shift(4,8),ln.write_shift(4,Pi),ln.write_shift(4,5),write_biff_rec(qe,236,nn?bconcat([ln,nn]):ln)}qe.push(Qe.end()),ze.forEach(function(cn){write_biff_rec(qe,28,cn)}),b8ocnts.push([Pi,f.length+1,b8oid]),++b8oid}function write_FONTS_biff8(qe,f,ze){write_biff_rec(qe,49,write_Font({sz:12,name:"Arial"},ze))}function write_FMTS_biff8(qe,f,ze){f&&[[5,8],[23,26],[41,44],[50,392]].forEach(function(Ke){for(var Qe=Ke[0];Qe<=Ke[1];++Qe)f[Qe]!=null&&write_biff_rec(qe,1054,write_Format(Qe,f[Qe],ze))})}function write_FEAT(qe,f){var ze=new_buf(19);ze.write_shift(4,2151),ze.write_shift(4,0),ze.write_shift(4,0),ze.write_shift(2,3),ze.write_shift(1,1),ze.write_shift(4,0),write_biff_rec(qe,2151,ze),ze=new_buf(39),ze.write_shift(4,2152),ze.write_shift(4,0),ze.write_shift(4,0),ze.write_shift(2,3),ze.write_shift(1,0),ze.write_shift(4,0),ze.write_shift(2,1),ze.write_shift(4,4),ze.write_shift(2,0),write_Ref8U(safe_decode_range(f["!ref"]||"A1"),ze),ze.write_shift(4,4),write_biff_rec(qe,2152,ze)}function write_CELLXFS_biff8(qe,f){for(var ze=0;ze<16;++ze)write_biff_rec(qe,224,write_XF({numFmtId:0,style:!0},0,f));f.cellXfs.forEach(function(Ke){write_biff_rec(qe,224,write_XF(Ke,0,f))})}function write_ws_biff8_hlinks(qe,f){for(var ze=0;ze<f["!links"].length;++ze){var Ke=f["!links"][ze];write_biff_rec(qe,440,write_HLink(Ke)),Ke[1].Tooltip&&write_biff_rec(qe,2048,write_HLinkTooltip(Ke))}delete f["!links"]}function write_ws_cols_biff8(qe,f){if(f){var ze=0;f.forEach(function(Ke,Qe){++ze<=256&&Ke&&write_biff_rec(qe,125,write_ColInfo(col_obj_w(Qe,Ke),Qe))})}}function write_ws_biff8_cell(qe,f,ze,Ke,Qe,Pi){var nn=16+get_cell_style(Qe.cellXfs,f,Qe);if(f.v==null&&!f.bf){write_biff_rec(qe,513,write_XLSCell(ze,Ke,nn));return}if(f.bf)write_biff_rec(qe,6,write_Formula(f,ze,Ke,Qe,nn));else switch(f.t){case"d":case"n":var ln=f.t=="d"?datenum(parseDate(f.v,Pi),Pi):f.v;isNaN(ln)?write_biff_rec(qe,517,write_BoolErr(ze,Ke,36,nn,Qe,"e")):isFinite(ln)?write_biff_rec(qe,515,write_Number(ze,Ke,ln,nn)):write_biff_rec(qe,517,write_BoolErr(ze,Ke,7,nn,Qe,"e"));break;case"b":case"e":write_biff_rec(qe,517,write_BoolErr(ze,Ke,f.v,nn,Qe,f.t));break;case"s":case"str":if(Qe.bookSST){var cn=get_sst_id(Qe.Strings,f.v==null?"":String(f.v),Qe.revStrings);write_biff_rec(qe,253,write_LabelSst(ze,Ke,cn,nn))}else write_biff_rec(qe,516,write_Label(ze,Ke,(f.v==null?"":String(f.v)).slice(0,255),nn,Qe));break;default:write_biff_rec(qe,513,write_XLSCell(ze,Ke,nn))}}function write_ws_biff8(qe,f,ze){var Ke=buf_array(),Qe=ze.SheetNames[qe],Pi=ze.Sheets[Qe]||{},nn=(ze||{}).Workbook||{},ln=(nn.Sheets||[])[qe]||{},cn=Pi["!data"]!=null,hn=f.biff==8,un="",zn=[],Xn=safe_decode_range(Pi["!ref"]||"A1"),Un=hn?65536:16384;if(Xn.e.c>255||Xn.e.r>=Un){if(f.WTF)throw new Error("Range "+(Pi["!ref"]||"A1")+" exceeds format limit A1:IV"+Un);Xn.e.c=Math.min(Xn.e.c,255),Xn.e.r=Math.min(Xn.e.r,Un-1)}write_biff_rec(Ke,2057,write_BOF(ze,16,f)),write_biff_rec(Ke,13,writeuint16(1)),write_biff_rec(Ke,12,writeuint16(100)),write_biff_rec(Ke,15,writebool(!0)),write_biff_rec(Ke,17,writebool(!1)),write_biff_rec(Ke,16,write_Xnum(.001)),write_biff_rec(Ke,95,writebool(!0)),write_biff_rec(Ke,42,writebool(!1)),write_biff_rec(Ke,43,writebool(!1)),write_biff_rec(Ke,130,writeuint16(1)),write_biff_rec(Ke,128,write_Guts()),write_biff_rec(Ke,131,writebool(!1)),write_biff_rec(Ke,132,writebool(!1)),hn&&write_ws_cols_biff8(Ke,Pi["!cols"]),write_biff_rec(Ke,512,write_Dimensions(Xn,f));var qn=(((ze||{}).Workbook||{}).WBProps||{}).date1904;hn&&(Pi["!links"]=[]);for(var ys=Xn.s.c;ys<=Xn.e.c;++ys)zn[ys]=encode_col(ys);for(var vs=[],ea=[],na=Xn.s.r;na<=Xn.e.r;++na)for(cn&&(ea=Pi["!data"][na]||[]),un=encode_row(na),ys=Xn.s.c;ys<=Xn.e.c;++ys){var ta=cn?ea[ys]:Pi[zn[ys]+un];ta&&(write_ws_biff8_cell(Ke,ta,na,ys,f,qn),hn&&ta.l&&Pi["!links"].push([zn[ys]+un,ta.l]),ta.c&&vs.push([ta.c,na,ys]))}var ra=ln.CodeName||ln.name||Qe;return hn?write_comments_biff8(Ke,vs):write_comments_biff2(Ke,vs),hn&&write_biff_rec(Ke,574,write_Window2((nn.Views||[])[0])),hn&&(Pi["!merges"]||[]).length&&write_biff_rec(Ke,229,write_MergeCells(Pi["!merges"])),hn&&write_ws_biff8_hlinks(Ke,Pi),write_biff_rec(Ke,442,write_XLUnicodeString(ra)),hn&&write_FEAT(Ke,Pi),write_biff_rec(Ke,10),Ke.end()}function write_biff8_global(qe,f,ze){var Ke=buf_array(),Qe=(qe||{}).Workbook||{},Pi=Qe.Sheets||[],nn=Qe.WBProps||{},ln=ze.biff==8,cn=ze.biff==5;if(write_biff_rec(Ke,2057,write_BOF(qe,5,ze)),ze.bookType=="xla"&&write_biff_rec(Ke,135),write_biff_rec(Ke,225,ln?writeuint16(1200):null),write_biff_rec(Ke,193,writezeroes(2)),cn&&write_biff_rec(Ke,191),cn&&write_biff_rec(Ke,192),write_biff_rec(Ke,226),write_biff_rec(Ke,92,write_WriteAccess("SheetJS",ze)),write_biff_rec(Ke,66,writeuint16(ln?1200:1252)),ln&&write_biff_rec(Ke,353,writeuint16(0)),ln&&write_biff_rec(Ke,448),write_biff_rec(Ke,317,write_RRTabId(qe.SheetNames.length)),ln&&qe.vbaraw&&write_biff_rec(Ke,211),ln&&qe.vbaraw){var hn=nn.CodeName||"ThisWorkbook";write_biff_rec(Ke,442,write_XLUnicodeString(hn))}write_biff_rec(Ke,156,writeuint16(17)),write_biff_rec(Ke,25,writebool(!1)),write_biff_rec(Ke,18,writebool(!1)),write_biff_rec(Ke,19,writeuint16(0)),ln&&write_biff_rec(Ke,431,writebool(!1)),ln&&write_biff_rec(Ke,444,writeuint16(0)),write_biff_rec(Ke,61,write_Window1()),write_biff_rec(Ke,64,writebool(!1)),write_biff_rec(Ke,141,writeuint16(0)),write_biff_rec(Ke,34,writebool(safe1904(qe)=="true")),write_biff_rec(Ke,14,writebool(!0)),ln&&write_biff_rec(Ke,439,writebool(!1)),write_biff_rec(Ke,218,writeuint16(0)),write_FONTS_biff8(Ke,qe,ze),write_FMTS_biff8(Ke,qe.SSF,ze),write_CELLXFS_biff8(Ke,ze),ln&&write_biff_rec(Ke,352,writebool(!1));var un=Ke.end(),zn=buf_array();ln&&write_biff_rec(zn,140,write_Country()),ln&&b8ocnts.length&&write_biff_rec(zn,235,write_MsoDrawingGroup()),ln&&ze.Strings&&write_biff_continue(zn,252,write_SST(ze.Strings)),write_biff_rec(zn,10);var Xn=zn.end(),Un=buf_array(),qn=0,ys=0;for(ys=0;ys<qe.SheetNames.length;++ys)qn+=(ln?12:11)+(ln?2:1)*qe.SheetNames[ys].length;var vs=un.length+qn+Xn.length;for(ys=0;ys<qe.SheetNames.length;++ys){var ea=Pi[ys]||{};write_biff_rec(Un,133,write_BoundSheet8({pos:vs,hs:ea.Hidden||0,dt:0,name:qe.SheetNames[ys]},ze)),vs+=f[ys].length}var na=Un.end();if(qn!=na.length)throw new Error("BS8 "+qn+" != "+na.length);var ta=[];return un.length&&ta.push(un),na.length&&ta.push(na),Xn.length&&ta.push(Xn),bconcat(ta)}function write_biff8_buf(qe,f){var ze=f||{},Ke=[];qe&&!qe.SSF&&(qe.SSF=dup(table_fmt)),qe&&qe.SSF&&(make_ssf(),SSF_load_table(qe.SSF),ze.revssf=evert_num(qe.SSF),ze.revssf[qe.SSF[65535]]=0,ze.ssf=qe.SSF),b8oid=1,b8ocnts=[],ze.Strings=[],ze.Strings.Count=0,ze.Strings.Unique=0,fix_write_opts(ze),ze.cellXfs=[],get_cell_style(ze.cellXfs,{},{revssf:{General:0}}),qe.Props||(qe.Props={});for(var Qe=0;Qe<qe.SheetNames.length;++Qe)Ke[Ke.length]=write_ws_biff8(Qe,ze,qe);return Ke.unshift(write_biff8_global(qe,Ke,ze)),bconcat(Ke)}function write_biff_buf(qe,f){for(var ze=0;ze<=qe.SheetNames.length;++ze){var Ke=qe.Sheets[qe.SheetNames[ze]];if(!(!Ke||!Ke["!ref"])){var Qe=decode_range(Ke["!ref"]);Qe.e.c>255&&typeof console<"u"&&console.error&&console.error("Worksheet '"+qe.SheetNames[ze]+"' extends beyond column IV (255).  Data may be lost."),Qe.e.r>65535&&typeof console<"u"&&console.error&&console.error("Worksheet '"+qe.SheetNames[ze]+"' extends beyond row 65536.  Data may be lost.")}}var Pi=f||{};switch(Pi.biff||2){case 8:case 5:return write_biff8_buf(qe,f);case 4:case 3:case 2:return write_biff2_buf(qe,f)}throw new Error("invalid type "+Pi.bookType+" for BIFF")}function make_html_row(qe,f,ze,Ke){for(var Qe=qe["!merges"]||[],Pi=[],nn={},ln=qe["!data"]!=null,cn=f.s.c;cn<=f.e.c;++cn){for(var hn=0,un=0,zn=0;zn<Qe.length;++zn)if(!(Qe[zn].s.r>ze||Qe[zn].s.c>cn)&&!(Qe[zn].e.r<ze||Qe[zn].e.c<cn)){if(Qe[zn].s.r<ze||Qe[zn].s.c<cn){hn=-1;break}hn=Qe[zn].e.r-Qe[zn].s.r+1,un=Qe[zn].e.c-Qe[zn].s.c+1;break}if(!(hn<0)){var Xn=encode_col(cn)+encode_row(ze),Un=ln?(qe["!data"][ze]||[])[cn]:qe[Xn];Un&&Un.t=="n"&&Un.v!=null&&!isFinite(Un.v)&&(isNaN(Un.v)?Un={t:"e",v:36,w:BErr[36]}:Un={t:"e",v:7,w:BErr[7]});var qn=Un&&Un.v!=null&&(Un.h||escapehtml(Un.w||(format_cell(Un),Un.w)||""))||"";nn={},hn>1&&(nn.rowspan=hn),un>1&&(nn.colspan=un),Ke.editable?qn='<span contenteditable="true">'+qn+"</span>":Un&&(nn["data-t"]=Un&&Un.t||"z",Un.v!=null&&(nn["data-v"]=escapehtml(Un.v instanceof Date?Un.v.toISOString():Un.v)),Un.z!=null&&(nn["data-z"]=Un.z),Un.l&&(Un.l.Target||"#").charAt(0)!="#"&&(qn='<a href="'+escapehtml(Un.l.Target)+'">'+qn+"</a>")),nn.id=(Ke.id||"sjs")+"-"+Xn,Pi.push(writextag("td",qn,nn))}}var ys="<tr>";return ys+Pi.join("")+"</tr>"}var HTML_BEGIN='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',HTML_END="</body></html>";function make_html_preamble(qe,f,ze){var Ke=[];return Ke.join("")+"<table"+(ze&&ze.id?' id="'+ze.id+'"':"")+">"}function sheet_to_html(qe,f){var ze=f||{},Ke=ze.header!=null?ze.header:HTML_BEGIN,Qe=ze.footer!=null?ze.footer:HTML_END,Pi=[Ke],nn=decode_range(qe["!ref"]||"A1");if(Pi.push(make_html_preamble(qe,nn,ze)),qe["!ref"])for(var ln=nn.s.r;ln<=nn.e.r;++ln)Pi.push(make_html_row(qe,nn,ln,ze));return Pi.push("</table>"+Qe),Pi.join("")}function sheet_add_dom(qe,f,ze){var Ke=f.rows;if(!Ke)throw"Unsupported origin when "+f.tagName+" is not a TABLE";var Qe=ze||{},Pi=qe["!data"]!=null,nn=0,ln=0;if(Qe.origin!=null)if(typeof Qe.origin=="number")nn=Qe.origin;else{var cn=typeof Qe.origin=="string"?decode_cell(Qe.origin):Qe.origin;nn=cn.r,ln=cn.c}var hn=Math.min(Qe.sheetRows||1e7,Ke.length),un={s:{r:0,c:0},e:{r:nn,c:ln}};if(qe["!ref"]){var zn=decode_range(qe["!ref"]);un.s.r=Math.min(un.s.r,zn.s.r),un.s.c=Math.min(un.s.c,zn.s.c),un.e.r=Math.max(un.e.r,zn.e.r),un.e.c=Math.max(un.e.c,zn.e.c),nn==-1&&(un.e.r=nn=zn.e.r+1)}var Xn=[],Un=0,qn=qe["!rows"]||(qe["!rows"]=[]),ys=0,vs=0,ea=0,na=0,ta=0,ra=0;for(qe["!cols"]||(qe["!cols"]=[]);ys<Ke.length&&vs<hn;++ys){var oa=Ke[ys];if(is_dom_element_hidden(oa)){if(Qe.display)continue;qn[vs]={hidden:!0}}var fa=oa.cells;for(ea=na=0;ea<fa.length;++ea){var ca=fa[ea];if(!(Qe.display&&is_dom_element_hidden(ca))){var la=ca.hasAttribute("data-v")?ca.getAttribute("data-v"):ca.hasAttribute("v")?ca.getAttribute("v"):htmldecode(ca.innerHTML),ua=ca.getAttribute("data-z")||ca.getAttribute("z");for(Un=0;Un<Xn.length;++Un){var ga=Xn[Un];ga.s.c==na+ln&&ga.s.r<vs+nn&&vs+nn<=ga.e.r&&(na=ga.e.c+1-ln,Un=-1)}ra=+ca.getAttribute("colspan")||1,((ta=+ca.getAttribute("rowspan")||1)>1||ra>1)&&Xn.push({s:{r:vs+nn,c:na+ln},e:{r:vs+nn+(ta||1)-1,c:na+ln+(ra||1)-1}});var da={t:"s",v:la},qa=ca.getAttribute("data-t")||ca.getAttribute("t")||"";la!=null&&(la.length==0?da.t=qa||"z":Qe.raw||la.trim().length==0||qa=="s"||(qa=="e"&&BErr[+la]?da={t:"e",v:+la,w:BErr[+la]}:la==="TRUE"?da={t:"b",v:!0}:la==="FALSE"?da={t:"b",v:!1}:isNaN(fuzzynum(la))?isNaN(fuzzydate(la).getDate())?la.charCodeAt(0)==35&&RBErr[la]!=null&&(da={t:"e",v:RBErr[la],w:la}):(da={t:"d",v:parseDate(la)},Qe.UTC&&(da.v=local_to_utc(da.v)),Qe.cellDates||(da={t:"n",v:datenum(da.v)}),da.z=Qe.dateNF||table_fmt[14]):da={t:"n",v:fuzzynum(la)})),da.z===void 0&&ua!=null&&(da.z=ua);var tl="",ol=ca.getElementsByTagName("A");if(ol&&ol.length)for(var hl=0;hl<ol.length&&!(ol[hl].hasAttribute("href")&&(tl=ol[hl].getAttribute("href"),tl.charAt(0)!="#"));++hl);tl&&tl.charAt(0)!="#"&&tl.slice(0,11).toLowerCase()!="javascript:"&&(da.l={Target:tl}),Pi?(qe["!data"][vs+nn]||(qe["!data"][vs+nn]=[]),qe["!data"][vs+nn][na+ln]=da):qe[encode_cell({c:na+ln,r:vs+nn})]=da,un.e.c<na+ln&&(un.e.c=na+ln),na+=ra}}++vs}return Xn.length&&(qe["!merges"]=(qe["!merges"]||[]).concat(Xn)),un.e.r=Math.max(un.e.r,vs-1+nn),qe["!ref"]=encode_range(un),vs>=hn&&(qe["!fullref"]=encode_range((un.e.r=Ke.length-ys+vs-1+nn,un))),qe}function parse_dom_table(qe,f){var ze=f||{},Ke={};return ze.dense&&(Ke["!data"]=[]),sheet_add_dom(Ke,qe,f)}function table_to_book(qe,f){var ze=sheet_to_workbook(parse_dom_table(qe,f),f);return ze}function is_dom_element_hidden(qe){var f="",ze=get_get_computed_style_function(qe);return ze&&(f=ze(qe).getPropertyValue("display")),f||(f=qe.style&&qe.style.display),f==="none"}function get_get_computed_style_function(qe){return qe.ownerDocument.defaultView&&typeof qe.ownerDocument.defaultView.getComputedStyle=="function"?qe.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}var write_styles_ods=function(){var qe=["<office:master-styles>",'<style:master-page style:name="mp1" style:page-layout-name="mp1">',"<style:header/>",'<style:header-left style:display="false"/>',"<style:footer/>",'<style:footer-left style:display="false"/>',"</style:master-page>","</office:master-styles>"].join(""),f="<office:document-styles "+wxt_helper({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","office:version":"1.2"})+">"+qe+"</office:document-styles>";return function(){return XML_HEADER+f}}();function write_number_format_ods(qe,f){var ze="number",Ke="",Qe={"style:name":f},Pi="",nn=0;qe=qe.replace(/"[$]"/g,"$");e:{if(qe.indexOf(";")>-1&&(console.error("Unsupported ODS Style Map exported.  Using first branch of "+qe),qe=qe.slice(0,qe.indexOf(";"))),qe=="@"){ze="text",Ke="<number:text-content/>";break e}if(qe.indexOf(/\$/)>-1&&(ze="currency"),qe[nn]=='"'){for(Pi="";qe[++nn]!='"'||qe[++nn]=='"';)Pi+=qe[nn];--nn,qe[nn+1]=="*"?(nn++,Ke+="<number:fill-character>"+escapexml(Pi.replace(/""/g,'"'))+"</number:fill-character>"):Ke+="<number:text>"+escapexml(Pi.replace(/""/g,'"'))+"</number:text>",qe=qe.slice(nn+1),nn=0}var ln=qe.match(/# (\?+)\/(\?+)/);if(ln){Ke+=writextag("number:fraction",null,{"number:min-integer-digits":0,"number:min-numerator-digits":ln[1].length,"number:max-denominator-value":Math.max(+ln[1].replace(/./g,"9"),+ln[2].replace(/./g,"9"))});break e}if(ln=qe.match(/# (\?+)\/(\d+)/)){Ke+=writextag("number:fraction",null,{"number:min-integer-digits":0,"number:min-numerator-digits":ln[1].length,"number:denominator-value":+ln[2]});break e}if(ln=qe.match(/\b(\d+)(|\.\d+)%/)){ze="percentage",Ke+=writextag("number:number",null,{"number:decimal-places":ln[2]&&ln.length-1||0,"number:min-decimal-places":ln[2]&&ln.length-1||0,"number:min-integer-digits":ln[1].length})+"<number:text>%</number:text>";break e}var cn=!1;if(["y","m","d"].indexOf(qe[0])>-1){ze="date";t:for(;nn<qe.length;++nn)switch(Pi=qe[nn].toLowerCase()){case"h":case"s":cn=!0,--nn;break t;case"m":r:for(var hn=nn+1;hn<qe.length;++hn)switch(qe[hn]){case"y":case"d":break r;case"h":case"s":cn=!0,--nn;break t}case"y":case"d":for(;(qe[++nn]||"").toLowerCase()==Pi[0];)Pi+=Pi[0];switch(--nn,Pi){case"y":case"yy":Ke+="<number:year/>";break;case"yyy":case"yyyy":Ke+='<number:year number:style="long"/>';break;case"mmmmm":console.error("ODS has no equivalent of format |mmmmm|");case"m":case"mm":case"mmm":case"mmmm":Ke+='<number:month number:style="'+(Pi.length%2?"short":"long")+'" number:textual="'+(Pi.length>=3?"true":"false")+'"/>';break;case"d":case"dd":Ke+='<number:day number:style="'+(Pi.length%2?"short":"long")+'"/>';break;case"ddd":case"dddd":Ke+='<number:day-of-week number:style="'+(Pi.length%2?"short":"long")+'"/>';break}break;case'"':for(;qe[++nn]!='"'||qe[++nn]=='"';)Pi+=qe[nn];--nn,Ke+="<number:text>"+escapexml(Pi.slice(1).replace(/""/g,'"'))+"</number:text>";break;case"\\":Pi=qe[++nn],Ke+="<number:text>"+escapexml(Pi)+"</number:text>";break;case"/":case":":Ke+="<number:text>"+escapexml(Pi)+"</number:text>";break;default:console.error("unrecognized character "+Pi+" in ODF format "+qe)}if(!cn)break e;qe=qe.slice(nn+1),nn=0}if(qe.match(/^\[?[hms]/)){for(ze=="number"&&(ze="time"),qe.match(/\[/)&&(qe=qe.replace(/[\[\]]/g,""),Qe["number:truncate-on-overflow"]="false");nn<qe.length;++nn)switch(Pi=qe[nn].toLowerCase()){case"h":case"m":case"s":for(;(qe[++nn]||"").toLowerCase()==Pi[0];)Pi+=Pi[0];switch(--nn,Pi){case"h":case"hh":Ke+='<number:hours number:style="'+(Pi.length%2?"short":"long")+'"/>';break;case"m":case"mm":Ke+='<number:minutes number:style="'+(Pi.length%2?"short":"long")+'"/>';break;case"s":case"ss":if(qe[nn+1]==".")do Pi+=qe[nn+1],++nn;while(qe[nn+1]=="0");Ke+='<number:seconds number:style="'+(Pi.match("ss")?"long":"short")+'"'+(Pi.match(/\./)?' number:decimal-places="'+(Pi.match(/0+/)||[""])[0].length+'"':"")+"/>";break}break;case'"':for(;qe[++nn]!='"'||qe[++nn]=='"';)Pi+=qe[nn];--nn,Ke+="<number:text>"+escapexml(Pi.slice(1).replace(/""/g,'"'))+"</number:text>";break;case"/":case":":Ke+="<number:text>"+escapexml(Pi)+"</number:text>";break;case"a":if(qe.slice(nn,nn+3).toLowerCase()=="a/p"){Ke+="<number:am-pm/>",nn+=2;break}if(qe.slice(nn,nn+5).toLowerCase()=="am/pm"){Ke+="<number:am-pm/>",nn+=4;break}default:console.error("unrecognized character "+Pi+" in ODF format "+qe)}break e}if(qe.indexOf(/\$/)>-1&&(ze="currency"),qe[0]=="$"&&(Ke+='<number:currency-symbol number:language="en" number:country="US">$</number:currency-symbol>',qe=qe.slice(1),nn=0),nn=0,qe[nn]=='"'){for(;qe[++nn]!='"'||qe[++nn]=='"';)Pi+=qe[nn];--nn,qe[nn+1]=="*"?(nn++,Ke+="<number:fill-character>"+escapexml(Pi.replace(/""/g,'"'))+"</number:fill-character>"):Ke+="<number:text>"+escapexml(Pi.replace(/""/g,'"'))+"</number:text>",qe=qe.slice(nn+1),nn=0}var un=qe.match(/([#0][0#,]*)(\.[0#]*|)(E[+]?0*|)/i);if(!un||!un[0])console.error("Could not find numeric part of "+qe);else{var zn=un[1].replace(/,/g,"");Ke+="<number:"+(un[3]?"scientific-":"")+'number number:min-integer-digits="'+(zn.indexOf("0")==-1?"0":zn.length-zn.indexOf("0"))+'"'+(un[0].indexOf(",")>-1?' number:grouping="true"':"")+(un[2]&&' number:decimal-places="'+(un[2].length-1)+'"'||' number:decimal-places="0"')+(un[3]&&un[3].indexOf("+")>-1?' number:forced-exponent-sign="true"':"")+(un[3]?' number:min-exponent-digits="'+un[3].match(/0+/)[0].length+'"':"")+"></number:"+(un[3]?"scientific-":"")+"number>",nn=un.index+un[0].length}if(qe[nn]=='"'){for(Pi="";qe[++nn]!='"'||qe[++nn]=='"';)Pi+=qe[nn];--nn,Ke+="<number:text>"+escapexml(Pi.replace(/""/g,'"'))+"</number:text>"}}return Ke?writextag("number:"+ze+"-style",Ke,Qe):(console.error("Could not generate ODS number format for |"+qe+"|"),"")}function write_names_ods(qe,f,ze){for(var Ke=[],Qe=0;Qe<qe.length;++Qe){var Pi=qe[Qe];Pi&&Pi.Sheet==(ze==-1?null:ze)&&Ke.push(Pi)}return Ke.length?`      <table:named-expressions>
`+Ke.map(function(nn){var ln=(ze==-1?"$":"")+csf_to_ods_3D(nn.Ref);return"        "+writextag("table:named-range",null,{"table:name":nn.Name,"table:cell-range-address":ln,"table:base-cell-address":ln.replace(/[\.][^\.]*$/,".$A$1")})}).join(`
`)+`
      </table:named-expressions>
`:""}var write_content_ods=function(){var qe=function(Qe,Pi){return escapexml(Qe).replace(/  +/g,function(nn){return'<text:s text:c="'+nn.length+'"/>'}).replace(/\t/g,"<text:tab/>").replace(/\n/g,"</text:p><text:p>").replace(/^ /,"<text:s/>").replace(/ $/,"<text:s/>")},f=`          <table:table-cell />
`,ze=function(Qe,Pi,nn,ln,cn,hn){var un=[];un.push('      <table:table table:name="'+escapexml(Pi.SheetNames[nn])+`" table:style-name="ta1">
`);var zn=0,Xn=0,Un=decode_range(Qe["!ref"]||"A1"),qn=Qe["!merges"]||[],ys=0,vs=Qe["!data"]!=null;if(Qe["!cols"])for(Xn=0;Xn<=Un.e.c;++Xn)un.push("        <table:table-column"+(Qe["!cols"][Xn]?' table:style-name="co'+Qe["!cols"][Xn].ods+'"':"")+`></table:table-column>
`);var ea="",na=Qe["!rows"]||[];for(zn=0;zn<Un.s.r;++zn)ea=na[zn]?' table:style-name="ro'+na[zn].ods+'"':"",un.push("        <table:table-row"+ea+`></table:table-row>
`);for(;zn<=Un.e.r;++zn){for(ea=na[zn]?' table:style-name="ro'+na[zn].ods+'"':"",un.push("        <table:table-row"+ea+`>
`),Xn=0;Xn<Un.s.c;++Xn)un.push(f);for(;Xn<=Un.e.c;++Xn){var ta=!1,ra={},oa="";for(ys=0;ys!=qn.length;++ys)if(!(qn[ys].s.c>Xn)&&!(qn[ys].s.r>zn)&&!(qn[ys].e.c<Xn)&&!(qn[ys].e.r<zn)){(qn[ys].s.c!=Xn||qn[ys].s.r!=zn)&&(ta=!0),ra["table:number-columns-spanned"]=qn[ys].e.c-qn[ys].s.c+1,ra["table:number-rows-spanned"]=qn[ys].e.r-qn[ys].s.r+1;break}if(ta){un.push(`          <table:covered-table-cell/>
`);continue}var fa=encode_cell({r:zn,c:Xn}),ca=vs?(Qe["!data"][zn]||[])[Xn]:Qe[fa];if(ca&&ca.f&&(ra["table:formula"]=escapexml(csf_to_ods_formula(ca.f)),ca.F&&ca.F.slice(0,fa.length)==fa)){var la=decode_range(ca.F);ra["table:number-matrix-columns-spanned"]=la.e.c-la.s.c+1,ra["table:number-matrix-rows-spanned"]=la.e.r-la.s.r+1}if(!ca){un.push(f);continue}switch(ca.t){case"b":oa=ca.v?"TRUE":"FALSE",ra["office:value-type"]="boolean",ra["office:boolean-value"]=ca.v?"true":"false";break;case"n":isFinite(ca.v)?(oa=ca.w||String(ca.v||0),ra["office:value-type"]="float",ra["office:value"]=ca.v||0):(isNaN(ca.v)?(oa="#NUM!",ra["table:formula"]="of:=#NUM!"):(oa="#DIV/0!",ra["table:formula"]="of:="+(ca.v<0?"-":"")+"1/0"),ra["office:string-value"]="",ra["office:value-type"]="string",ra["calcext:value-type"]="error");break;case"s":case"str":oa=ca.v==null?"":ca.v,ra["office:value-type"]="string";break;case"d":oa=ca.w||parseDate(ca.v,hn).toISOString(),ra["office:value-type"]="date",ra["office:date-value"]=parseDate(ca.v,hn).toISOString(),ra["table:style-name"]="ce1";break;default:un.push(f);continue}var ua=qe(oa);if(ca.l&&ca.l.Target){var ga=ca.l.Target;ga=ga.charAt(0)=="#"?"#"+csf_to_ods_3D(ga.slice(1)):ga,ga.charAt(0)!="#"&&!ga.match(/^\w+:/)&&(ga="../"+ga),ua=writextag("text:a",ua,{"xlink:href":ga.replace(/&/g,"&amp;")})}cn[ca.z]&&(ra["table:style-name"]="ce"+cn[ca.z].slice(1));var da=writextag("text:p",ua,{});if(ca.c){for(var qa="",tl="",ol={},hl=0;hl<ca.c.length;++hl)!qa&&ca.c[hl].a&&(qa=ca.c[hl].a),tl+="<text:p>"+qe(ca.c[hl].t)+"</text:p>";ca.c.hidden||(ol["office:display"]=!0),da=writextag("office:annotation",tl,ol)+da}un.push("          "+writextag("table:table-cell",da,ra)+`
`)}un.push(`        </table:table-row>
`)}return(Pi.Workbook||{}).Names&&un.push(write_names_ods(Pi.Workbook.Names,Pi.SheetNames,nn)),un.push(`      </table:table>
`),un.join("")},Ke=function(Qe,Pi){Qe.push(` <office:automatic-styles>
`);var nn=0;Pi.SheetNames.map(function(un){return Pi.Sheets[un]}).forEach(function(un){if(un&&un["!cols"]){for(var zn=0;zn<un["!cols"].length;++zn)if(un["!cols"][zn]){var Xn=un["!cols"][zn];if(Xn.width==null&&Xn.wpx==null&&Xn.wch==null)continue;process_col(Xn),Xn.ods=nn;var Un=un["!cols"][zn].wpx+"px";Qe.push('  <style:style style:name="co'+nn+`" style:family="table-column">
`),Qe.push('   <style:table-column-properties fo:break-before="auto" style:column-width="'+Un+`"/>
`),Qe.push(`  </style:style>
`),++nn}}});var ln=0;Pi.SheetNames.map(function(un){return Pi.Sheets[un]}).forEach(function(un){if(un&&un["!rows"]){for(var zn=0;zn<un["!rows"].length;++zn)if(un["!rows"][zn]){un["!rows"][zn].ods=ln;var Xn=un["!rows"][zn].hpx+"px";Qe.push('  <style:style style:name="ro'+ln+`" style:family="table-row">
`),Qe.push('   <style:table-row-properties fo:break-before="auto" style:row-height="'+Xn+`"/>
`),Qe.push(`  </style:style>
`),++ln}}}),Qe.push(`  <style:style style:name="ta1" style:family="table" style:master-page-name="mp1">
`),Qe.push(`   <style:table-properties table:display="true" style:writing-mode="lr-tb"/>
`),Qe.push(`  </style:style>
`),Qe.push(`  <number:date-style style:name="N37" number:automatic-order="true">
`),Qe.push(`   <number:month number:style="long"/>
`),Qe.push(`   <number:text>/</number:text>
`),Qe.push(`   <number:day number:style="long"/>
`),Qe.push(`   <number:text>/</number:text>
`),Qe.push(`   <number:year/>
`),Qe.push(`  </number:date-style>
`);var cn={},hn=69;return Pi.SheetNames.map(function(un){return Pi.Sheets[un]}).forEach(function(un){if(un){var zn=un["!data"]!=null;if(un["!ref"])for(var Xn=decode_range(un["!ref"]),Un=0;Un<=Xn.e.r;++Un)for(var qn=0;qn<=Xn.e.c;++qn){var ys=zn?(un["!data"][Un]||[])[qn]:un[encode_cell({r:Un,c:qn})];if(!(!ys||!ys.z||ys.z.toLowerCase()=="general")&&!cn[ys.z]){var vs=write_number_format_ods(ys.z,"N"+hn);vs&&(cn[ys.z]="N"+hn,++hn,Qe.push(vs+`
`))}}}}),Qe.push(`  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>
`),keys(cn).forEach(function(un){Qe.push('<style:style style:name="ce'+cn[un].slice(1)+'" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="'+cn[un]+`"/>
`)}),Qe.push(` </office:automatic-styles>
`),cn};return function(Pi,nn){var ln=[XML_HEADER],cn=wxt_helper({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"}),hn=wxt_helper({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});nn.bookType=="fods"?(ln.push("<office:document"+cn+hn+`>
`),ln.push(write_meta_ods().replace(/<office:document-meta[^<>]*?>/,"").replace(/<\/office:document-meta>/,"")+`
`)):ln.push("<office:document-content"+cn+`>
`);var un=Ke(ln,Pi);ln.push(`  <office:body>
`),ln.push(`    <office:spreadsheet>
`),((Pi.Workbook||{}).WBProps||{}).date1904&&ln.push(`      <table:calculation-settings table:case-sensitive="false" table:search-criteria-must-apply-to-whole-cell="true" table:use-wildcards="true" table:use-regular-expressions="false" table:automatic-find-labels="false">
        <table:null-date table:date-value="1904-01-01"/>
      </table:calculation-settings>
`);for(var zn=0;zn!=Pi.SheetNames.length;++zn)ln.push(ze(Pi.Sheets[Pi.SheetNames[zn]],Pi,zn,nn,un,((Pi.Workbook||{}).WBProps||{}).date1904));return(Pi.Workbook||{}).Names&&ln.push(write_names_ods(Pi.Workbook.Names,Pi.SheetNames,-1)),ln.push(`    </office:spreadsheet>
`),ln.push(`  </office:body>
`),nn.bookType=="fods"?ln.push("</office:document>"):ln.push("</office:document-content>"),ln.join("")}}();function write_ods(qe,f){if(f.bookType=="fods")return write_content_ods(qe,f);var ze=zip_new(),Ke="",Qe=[],Pi=[];return Ke="mimetype",zip_add_file(ze,Ke,"application/vnd.oasis.opendocument.spreadsheet"),Ke="content.xml",zip_add_file(ze,Ke,write_content_ods(qe,f)),Qe.push([Ke,"text/xml"]),Pi.push([Ke,"ContentFile"]),Ke="styles.xml",zip_add_file(ze,Ke,write_styles_ods(qe,f)),Qe.push([Ke,"text/xml"]),Pi.push([Ke,"StylesFile"]),Ke="meta.xml",zip_add_file(ze,Ke,XML_HEADER+write_meta_ods()),Qe.push([Ke,"text/xml"]),Pi.push([Ke,"MetadataFile"]),Ke="manifest.rdf",zip_add_file(ze,Ke,write_rdf(Pi)),Qe.push([Ke,"application/rdf+xml"]),Ke="META-INF/manifest.xml",zip_add_file(ze,Ke,write_manifest(Qe)),ze}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */var subarray=function(){try{return typeof Uint8Array>"u"||typeof Uint8Array.prototype.subarray>"u"?"slice":typeof Buffer<"u"?typeof Buffer.prototype.subarray>"u"?"slice":(typeof Buffer.from=="function"?Buffer.from([72,62]):new Buffer([72,62]))instanceof Uint8Array?"subarray":"slice":"subarray"}catch{return"slice"}}();function u8_to_dataview(qe){return new DataView(qe.buffer,qe.byteOffset,qe.byteLength)}function u8str(qe){return typeof TextDecoder<"u"?new TextDecoder().decode(qe):utf8read(a2s(qe))}function stru8(qe){return typeof TextEncoder<"u"?new TextEncoder().encode(qe):s2a(utf8write(qe))}function u8concat(qe){for(var f=0,ze=0;ze<qe.length;++ze)f+=qe[ze].length;var Ke=new Uint8Array(f),Qe=0;for(ze=0;ze<qe.length;++ze){var Pi=qe[ze],nn=Pi.length;if(nn<250)for(var ln=0;ln<nn;++ln)Ke[Qe++]=Pi[ln];else Ke.set(Pi,Qe),Qe+=nn}return Ke}function writeDecimal128LE(qe,f,ze){var Ke=Math.floor(ze==0?0:Math.LOG10E*Math.log(Math.abs(ze)))+6176-16,Qe=ze/Math.pow(10,Ke-6176);qe[f+15]|=Ke>>7,qe[f+14]|=(Ke&127)<<1;for(var Pi=0;Qe>=1;++Pi,Qe/=256)qe[f+Pi]=Qe&255;qe[f+15]|=ze>=0?0:128}function parse_varint49(qe,f){var ze=f.l,Ke=qe[ze]&127;e:if(qe[ze++]>=128&&(Ke|=(qe[ze]&127)<<7,qe[ze++]<128||(Ke|=(qe[ze]&127)<<14,qe[ze++]<128)||(Ke|=(qe[ze]&127)<<21,qe[ze++]<128)||(Ke+=(qe[ze]&127)*Math.pow(2,28),++ze,qe[ze++]<128)||(Ke+=(qe[ze]&127)*Math.pow(2,35),++ze,qe[ze++]<128)||(Ke+=(qe[ze]&127)*Math.pow(2,42),++ze,qe[ze++]<128)))break e;return f.l=ze,Ke}function write_varint49(qe){var f=new Uint8Array(7);f[0]=qe&127;var ze=1;e:if(qe>127){if(f[ze-1]|=128,f[ze]=qe>>7&127,++ze,qe<=16383||(f[ze-1]|=128,f[ze]=qe>>14&127,++ze,qe<=2097151)||(f[ze-1]|=128,f[ze]=qe>>21&127,++ze,qe<=268435455)||(f[ze-1]|=128,f[ze]=qe/256>>>21&127,++ze,qe<=34359738367)||(f[ze-1]|=128,f[ze]=qe/65536>>>21&127,++ze,qe<=4398046511103))break e;f[ze-1]|=128,f[ze]=qe/16777216>>>21&127,++ze}return f[subarray](0,ze)}function parse_packed_varints(qe){for(var f={l:0},ze=[];f.l<qe.length;)ze.push(parse_varint49(qe,f));return ze}function write_packed_varints(qe){return u8concat(qe.map(function(f){return write_varint49(f)}))}function varint_to_i32(qe){var f=0,ze=qe[f]&127;return qe[f++]<128||(ze|=(qe[f]&127)<<7,qe[f++]<128)||(ze|=(qe[f]&127)<<14,qe[f++]<128)||(ze|=(qe[f]&127)<<21,qe[f++]<128)||(ze|=(qe[f]&15)<<28),ze}function parse_shallow(qe){for(var f=[],ze={l:0};ze.l<qe.length;){var Ke=ze.l,Qe=parse_varint49(qe,ze),Pi=Qe&7;Qe=Qe/8|0;var nn,ln=ze.l;switch(Pi){case 0:{for(;qe[ln++]>=128;);nn=qe[subarray](ze.l,ln),ze.l=ln}break;case 1:nn=qe[subarray](ln,ln+8),ze.l=ln+8;break;case 2:{var cn=parse_varint49(qe,ze);nn=qe[subarray](ze.l,ze.l+cn),ze.l+=cn}break;case 5:nn=qe[subarray](ln,ln+4),ze.l=ln+4;break;default:throw new Error("PB Type ".concat(Pi," for Field ").concat(Qe," at offset ").concat(Ke))}var hn={data:nn,type:Pi};f[Qe]==null&&(f[Qe]=[]),f[Qe].push(hn)}return f}function write_shallow(qe){var f=[];return qe.forEach(function(ze,Ke){Ke!=0&&ze.forEach(function(Qe){Qe.data&&(f.push(write_varint49(Ke*8+Qe.type)),Qe.type==2&&f.push(write_varint49(Qe.data.length)),f.push(Qe.data))})}),u8concat(f)}function mappa(qe,f){return(qe==null?void 0:qe.map(function(ze){return f(ze.data)}))||[]}function parse_iwa_file(qe){for(var f,ze=[],Ke={l:0};Ke.l<qe.length;){var Qe=parse_varint49(qe,Ke),Pi=parse_shallow(qe[subarray](Ke.l,Ke.l+Qe));Ke.l+=Qe;var nn={id:varint_to_i32(Pi[1][0].data),messages:[]};Pi[2].forEach(function(ln){var cn=parse_shallow(ln.data),hn=varint_to_i32(cn[3][0].data);nn.messages.push({meta:cn,data:qe[subarray](Ke.l,Ke.l+hn)}),Ke.l+=hn}),(f=Pi[3])!=null&&f[0]&&(nn.merge=varint_to_i32(Pi[3][0].data)>>>0>0),ze.push(nn)}return ze}function write_iwa_file(qe){var f=[];return qe.forEach(function(ze){var Ke=[[],[{data:write_varint49(ze.id),type:0}],[]];ze.merge!=null&&(Ke[3]=[{data:write_varint49(+!!ze.merge),type:0}]);var Qe=[];ze.messages.forEach(function(nn){Qe.push(nn.data),nn.meta[3]=[{type:0,data:write_varint49(nn.data.length)}],Ke[2].push({data:write_shallow(nn.meta),type:2})});var Pi=write_shallow(Ke);f.push(write_varint49(Pi.length)),f.push(Pi),Qe.forEach(function(nn){return f.push(nn)})}),u8concat(f)}function parse_snappy_chunk(qe,f){if(qe!=0)throw new Error("Unexpected Snappy chunk type ".concat(qe));for(var ze={l:0},Ke=parse_varint49(f,ze),Qe=[],Pi=ze.l;Pi<f.length;){var nn=f[Pi]&3;if(nn==0){var ln=f[Pi++]>>2;if(ln<60)++ln;else{var cn=ln-59;ln=f[Pi],cn>1&&(ln|=f[Pi+1]<<8),cn>2&&(ln|=f[Pi+2]<<16),cn>3&&(ln|=f[Pi+3]<<24),ln>>>=0,ln++,Pi+=cn}Qe.push(f[subarray](Pi,Pi+ln)),Pi+=ln;continue}else{var hn=0,un=0;if(nn==1?(un=(f[Pi]>>2&7)+4,hn=(f[Pi++]&224)<<3,hn|=f[Pi++]):(un=(f[Pi++]>>2)+1,nn==2?(hn=f[Pi]|f[Pi+1]<<8,Pi+=2):(hn=(f[Pi]|f[Pi+1]<<8|f[Pi+2]<<16|f[Pi+3]<<24)>>>0,Pi+=4)),hn==0)throw new Error("Invalid offset 0");for(var zn=Qe.length-1,Xn=hn;zn>=0&&Xn>=Qe[zn].length;)Xn-=Qe[zn].length,--zn;if(zn<0)if(Xn==0)Xn=Qe[zn=0].length;else throw new Error("Invalid offset beyond length");if(un<Xn)Qe.push(Qe[zn][subarray](Qe[zn].length-Xn,Qe[zn].length-Xn+un));else{for(Xn>0&&(Qe.push(Qe[zn][subarray](Qe[zn].length-Xn)),un-=Xn),++zn;un>=Qe[zn].length;)Qe.push(Qe[zn]),un-=Qe[zn].length,++zn;un&&Qe.push(Qe[zn][subarray](0,un))}Qe.length>25&&(Qe=[u8concat(Qe)])}}for(var Un=0,qn=0;qn<Qe.length;++qn)Un+=Qe[qn].length;if(Un!=Ke)throw new Error("Unexpected length: ".concat(Un," != ").concat(Ke));return Qe}function decompress_iwa_file(qe){Array.isArray(qe)&&(qe=new Uint8Array(qe));for(var f=[],ze=0;ze<qe.length;){var Ke=qe[ze++],Qe=qe[ze]|qe[ze+1]<<8|qe[ze+2]<<16;ze+=3,f.push.apply(f,parse_snappy_chunk(Ke,qe[subarray](ze,ze+Qe))),ze+=Qe}if(ze!==qe.length)throw new Error("data is not a valid framed stream!");return f.length==1?f[0]:u8concat(f)}function compress_iwa_file(qe){for(var f=[],ze=0;ze<qe.length;){var Ke=Math.min(qe.length-ze,268435455),Qe=new Uint8Array(4);f.push(Qe);var Pi=write_varint49(Ke),nn=Pi.length;f.push(Pi),Ke<=60?(nn++,f.push(new Uint8Array([Ke-1<<2]))):Ke<=256?(nn+=2,f.push(new Uint8Array([240,Ke-1&255]))):Ke<=65536?(nn+=3,f.push(new Uint8Array([244,Ke-1&255,Ke-1>>8&255]))):Ke<=16777216?(nn+=4,f.push(new Uint8Array([248,Ke-1&255,Ke-1>>8&255,Ke-1>>16&255]))):Ke<=4294967296&&(nn+=5,f.push(new Uint8Array([252,Ke-1&255,Ke-1>>8&255,Ke-1>>16&255,Ke-1>>>24&255]))),f.push(qe[subarray](ze,ze+Ke)),nn+=Ke,Qe[0]=0,Qe[1]=nn&255,Qe[2]=nn>>8&255,Qe[3]=nn>>16&255,ze+=Ke}return u8concat(f)}function write_new_storage(qe,f){var ze=new Uint8Array(32),Ke=u8_to_dataview(ze),Qe=12,Pi=0;switch(ze[0]=5,qe.t){case"n":if(qe.z&&fmt_is_date(qe.z)){ze[1]=5,Ke.setFloat64(Qe,(numdate(qe.v+1462).getTime()-Date.UTC(2001,0,1))/1e3,!0),Pi|=4,Qe+=8;break}else ze[1]=2,writeDecimal128LE(ze,Qe,qe.v),Pi|=1,Qe+=16;break;case"b":ze[1]=6,Ke.setFloat64(Qe,qe.v?1:0,!0),Pi|=2,Qe+=8;break;case"s":{var nn=qe.v==null?"":String(qe.v);if(qe.l){var ln=f.rsst.findIndex(function(hn){var un;return hn.v==nn&&hn.l==((un=qe.l)==null?void 0:un.Target)});ln==-1&&(f.rsst[ln=f.rsst.length]={v:nn,l:qe.l.Target}),ze[1]=9,Ke.setUint32(Qe,ln,!0),Pi|=16,Qe+=4}else{var cn=f.sst.indexOf(nn);cn==-1&&(f.sst[cn=f.sst.length]=nn),ze[1]=3,Ke.setUint32(Qe,cn,!0),Pi|=8,Qe+=4}}break;case"d":ze[1]=5,Ke.setFloat64(Qe,(qe.v.getTime()-Date.UTC(2001,0,1))/1e3,!0),Pi|=4,Qe+=8;break;case"z":ze[1]=0;break;default:throw"unsupported cell type "+qe.t}return qe.c&&(f.cmnt.push(s5s_to_iwa_comment(qe.c)),Ke.setUint32(Qe,f.cmnt.length-1,!0),Pi|=524288,Qe+=4),Ke.setUint32(8,Pi,!0),ze[subarray](0,Qe)}function write_old_storage(qe,f){var ze=new Uint8Array(32),Ke=u8_to_dataview(ze),Qe=12,Pi=0,nn="";switch(ze[0]=4,qe.t){case"n":break;case"b":break;case"s":if(nn=qe.v==null?"":String(qe.v),qe.l){var ln=f.rsst.findIndex(function(hn){var un;return hn.v==nn&&hn.l==((un=qe.l)==null?void 0:un.Target)});ln==-1&&(f.rsst[ln=f.rsst.length]={v:nn,l:qe.l.Target}),ze[1]=9,Ke.setUint32(Qe,ln,!0),Pi|=512,Qe+=4}break;case"d":break;case"e":break;case"z":break;default:throw"unsupported cell type "+qe.t}switch(qe.c&&(Ke.setUint32(Qe,f.cmnt.length-1,!0),Pi|=4096,Qe+=4),qe.t){case"n":ze[1]=2,Ke.setFloat64(Qe,qe.v,!0),Pi|=32,Qe+=8;break;case"b":ze[1]=6,Ke.setFloat64(Qe,qe.v?1:0,!0),Pi|=32,Qe+=8;break;case"s":if(nn=qe.v==null?"":String(qe.v),!qe.l){var cn=f.sst.indexOf(nn);cn==-1&&(f.sst[cn=f.sst.length]=nn),ze[1]=3,Ke.setUint32(Qe,cn,!0),Pi|=16,Qe+=4}break;case"d":ze[1]=5,Ke.setFloat64(Qe,(qe.v.getTime()-Date.UTC(2001,0,1))/1e3,!0),Pi|=64,Qe+=8;break;case"z":ze[1]=0;break;default:throw"unsupported cell type "+qe.t}return Ke.setUint32(8,Pi,!0),ze[subarray](0,Qe)}function parse_TSP_Reference(qe){var f=parse_shallow(qe);return varint_to_i32(f[1][0].data)}function write_TSP_Reference(qe){return write_shallow([[],[{type:0,data:write_varint49(qe)}]])}function numbers_add_oref(qe,f){var ze,Ke=(ze=qe.messages[0].meta[5])!=null&&ze[0]?parse_packed_varints(qe.messages[0].meta[5][0].data):[],Qe=Ke.indexOf(f);Qe==-1&&(Ke.push(f),qe.messages[0].meta[5]=[{type:2,data:write_packed_varints(Ke)}])}function numbers_del_oref(qe,f){var ze,Ke=(ze=qe.messages[0].meta[5])!=null&&ze[0]?parse_packed_varints(qe.messages[0].meta[5][0].data):[];qe.messages[0].meta[5]=[{type:2,data:write_packed_varints(Ke.filter(function(Qe){return Qe!=f}))}]}function s5s_to_iwa_comment(qe){for(var f={a:"",t:"",replies:[]},ze=0;ze<qe.length;++ze)ze==0?(f.a=qe[ze].a,f.t=qe[ze].t):f.replies.push({a:qe[ze].a,t:qe[ze].t});return f}function write_TST_TileRowInfo(qe,f,ze){var Ke,Qe,Pi,nn=[[],[{type:0,data:write_varint49(0)}],[{type:0,data:write_varint49(0)}],[{type:2,data:new Uint8Array([])}],[{type:2,data:new Uint8Array(Array.from({length:510},function(){return 255}))}],[{type:0,data:write_varint49(5)}],[{type:2,data:new Uint8Array([])}],[{type:2,data:new Uint8Array(Array.from({length:510},function(){return 255}))}],[{type:0,data:write_varint49(1)}]];if(!((Ke=nn[6])!=null&&Ke[0])||!((Qe=nn[7])!=null&&Qe[0]))throw"Mutation only works on post-BNC storages!";var ln=0;if(nn[7][0].data.length<2*qe.length){var cn=new Uint8Array(2*qe.length);cn.set(nn[7][0].data),nn[7][0].data=cn}if(nn[4][0].data.length<2*qe.length){var hn=new Uint8Array(2*qe.length);hn.set(nn[4][0].data),nn[4][0].data=hn}for(var un=u8_to_dataview(nn[7][0].data),zn=0,Xn=[],Un=u8_to_dataview(nn[4][0].data),qn=0,ys=[],vs=4,ea=0;ea<qe.length;++ea){if(qe[ea]==null||qe[ea].t=="z"&&!((Pi=qe[ea].c)!=null&&Pi.length)||qe[ea].t=="e"){un.setUint16(ea*2,65535,!0),Un.setUint16(ea*2,65535);continue}un.setUint16(ea*2,zn/vs,!0),Un.setUint16(ea*2,qn/vs,!0);var na,ta;switch(qe[ea].t){case"d":if(qe[ea].v instanceof Date){na=write_new_storage(qe[ea],f),ta=write_old_storage(qe[ea],f);break}na=write_new_storage(qe[ea],f),ta=write_old_storage(qe[ea],f);break;case"s":case"n":case"b":case"z":na=write_new_storage(qe[ea],f),ta=write_old_storage(qe[ea],f);break;default:throw new Error("Unsupported value "+qe[ea])}Xn.push(na),zn+=na.length,ys.push(ta),qn+=ta.length,++ln}for(nn[2][0].data=write_varint49(ln),nn[5][0].data=write_varint49(5);ea<nn[7][0].data.length/2;++ea)un.setUint16(ea*2,65535,!0),Un.setUint16(ea*2,65535,!0);return nn[6][0].data=u8concat(Xn),nn[3][0].data=u8concat(ys),nn[8]=[{type:0,data:write_varint49(1)}],nn}function write_iwam(qe,f){return{meta:[[],[{type:0,data:write_varint49(qe)}]],data:f}}function get_unique_msgid(qe,f){f.last||(f.last=927262);for(var ze=f.last;ze<2e6;++ze)if(!f[ze])return f[f.last=ze]=qe,ze;throw new Error("Too many messages")}function build_numbers_deps(qe){var f={},ze=[];return qe.FileIndex.map(function(Ke,Qe){return[Ke,qe.FullPaths[Qe]]}).forEach(function(Ke){var Qe=Ke[0],Pi=Ke[1];Qe.type==2&&Qe.name.match(/\.iwa/)&&Qe.content[0]==0&&parse_iwa_file(decompress_iwa_file(Qe.content)).forEach(function(nn){ze.push(nn.id),f[nn.id]={deps:[],location:Pi,type:varint_to_i32(nn.messages[0].meta[1][0].data)}})}),qe.FileIndex.forEach(function(Ke){Ke.name.match(/\.iwa/)&&Ke.content[0]==0&&parse_iwa_file(decompress_iwa_file(Ke.content)).forEach(function(Qe){Qe.messages.forEach(function(Pi){[5,6].forEach(function(nn){Pi.meta[nn]&&Pi.meta[nn].forEach(function(ln){f[Qe.id].deps.push(varint_to_i32(ln.data))})})})})}),f}function write_TSP_Color_RGB(qe,f,ze){return write_shallow([[],[{type:0,data:write_varint49(1)}],[],[{type:5,data:new Uint8Array(Float32Array.from([qe/255]).buffer)}],[{type:5,data:new Uint8Array(Float32Array.from([f/255]).buffer)}],[{type:5,data:new Uint8Array(Float32Array.from([ze/255]).buffer)}],[{type:5,data:new Uint8Array(Float32Array.from([1]).buffer)}],[],[],[],[],[],[{type:0,data:write_varint49(1)}]])}function get_author_color(qe){switch(qe){case 0:return write_TSP_Color_RGB(99,222,171);case 1:return write_TSP_Color_RGB(162,197,240);case 2:return write_TSP_Color_RGB(255,189,189)}return write_TSP_Color_RGB(Math.random()*255,Math.random()*255,Math.random()*255)}function write_numbers_iwa(qe,f){if(!f||!f.numbers)throw new Error("Must pass a `numbers` option -- check the README");var ze=CFB.read(f.numbers,{type:"base64"}),Ke=build_numbers_deps(ze),Qe=numbers_iwa_find(ze,Ke,1);if(Qe==null)throw"Could not find message ".concat(1," in Numbers template");var Pi=mappa(parse_shallow(Qe.messages[0].data)[1],parse_TSP_Reference);if(Pi.length>1)throw new Error("Template NUMBERS file must have exactly one sheet");return qe.SheetNames.forEach(function(nn,ln){ln>=1&&(numbers_add_ws(ze,Ke,ln+1),Qe=numbers_iwa_find(ze,Ke,1),Pi=mappa(parse_shallow(Qe.messages[0].data)[1],parse_TSP_Reference)),write_numbers_ws(ze,Ke,qe.Sheets[nn],nn,ln,Pi[ln])}),ze}function numbers_iwa_doit(qe,f,ze,Ke){var Qe=CFB.find(qe,f[ze].location);if(!Qe)throw"Could not find ".concat(f[ze].location," in Numbers template");var Pi=parse_iwa_file(decompress_iwa_file(Qe.content)),nn=Pi.find(function(ln){return ln.id==ze});Ke(nn,Pi),Qe.content=compress_iwa_file(write_iwa_file(Pi)),Qe.size=Qe.content.length}function numbers_iwa_find(qe,f,ze){var Ke=CFB.find(qe,f[ze].location);if(!Ke)throw"Could not find ".concat(f[ze].location," in Numbers template");var Qe=parse_iwa_file(decompress_iwa_file(Ke.content)),Pi=Qe.find(function(nn){return nn.id==ze});return Pi}function numbers_add_meta(qe,f,ze){qe[3].push({type:2,data:write_shallow([[],[{type:0,data:write_varint49(f)}],[{type:2,data:stru8(ze.replace(/-[\s\S]*$/,""))}],[{type:2,data:stru8(ze)}],[{type:2,data:new Uint8Array([2,0,0])}],[{type:2,data:new Uint8Array([2,0,0])}],[],[],[],[],[{type:0,data:write_varint49(0)}],[],[{type:0,data:write_varint49(0)}]])}),qe[1]=[{type:0,data:write_varint49(Math.max(f+1,varint_to_i32(qe[1][0].data)))}]}function numbers_add_msg(qe,f,ze,Ke,Qe,Pi){Pi||(Pi=get_unique_msgid({deps:[],location:"",type:f},Qe));var nn="".concat(Ke,"-").concat(Pi,".iwa");Qe[Pi].location="Root Entry"+nn,CFB.utils.cfb_add(qe,nn,compress_iwa_file(write_iwa_file([{id:Pi,messages:[write_iwam(f,write_shallow(ze))]}])));var ln=nn.replace(/^[\/]/,"").replace(/^Index\//,"").replace(/\.iwa$/,"");return numbers_iwa_doit(qe,Qe,2,function(cn){var hn=parse_shallow(cn.messages[0].data);numbers_add_meta(hn,Pi||0,ln),cn.messages[0].data=write_shallow(hn)}),Pi}function numbers_meta_add_dep(qe,f,ze,Ke){var Qe=f[ze].location.replace(/^Root Entry\//,"").replace(/^Index\//,"").replace(/\.iwa$/,""),Pi=qe[3].findIndex(function(ln){var cn,hn,un=parse_shallow(ln.data);return(cn=un[3])!=null&&cn[0]?u8str(un[3][0].data)==Qe:!!((hn=un[2])!=null&&hn[0]&&u8str(un[2][0].data)==Qe)}),nn=parse_shallow(qe[3][Pi].data);nn[6]||(nn[6]=[]),(Array.isArray(Ke)?Ke:[Ke]).forEach(function(ln){nn[6].push({type:2,data:write_shallow([[],[{type:0,data:write_varint49(ln)}]])})}),qe[3][Pi].data=write_shallow(nn)}function numbers_meta_del_dep(qe,f,ze,Ke){var Qe=f[ze].location.replace(/^Root Entry\//,"").replace(/^Index\//,"").replace(/\.iwa$/,""),Pi=qe[3].findIndex(function(ln){var cn,hn,un=parse_shallow(ln.data);return(cn=un[3])!=null&&cn[0]?u8str(un[3][0].data)==Qe:!!((hn=un[2])!=null&&hn[0]&&u8str(un[2][0].data)==Qe)}),nn=parse_shallow(qe[3][Pi].data);nn[6]||(nn[6]=[]),nn[6]=nn[6].filter(function(ln){return varint_to_i32(parse_shallow(ln.data)[1][0].data)!=Ke}),qe[3][Pi].data=write_shallow(nn)}function numbers_add_ws(qe,f,ze){var Ke=-1,Qe=-1,Pi={};numbers_iwa_doit(qe,f,1,function(cn,hn){var un=parse_shallow(cn.messages[0].data);Ke=parse_TSP_Reference(parse_shallow(cn.messages[0].data)[1][0].data),Qe=get_unique_msgid({deps:[1],location:f[Ke].location,type:2},f),Pi[Ke]=Qe,numbers_add_oref(cn,Qe),un[1].push({type:2,data:write_TSP_Reference(Qe)});var zn=numbers_iwa_find(qe,f,Ke);zn.id=Qe,f[1].location==f[Qe].location?hn.push(zn):numbers_iwa_doit(qe,f,Qe,function(Xn,Un){return Un.push(zn)}),cn.messages[0].data=write_shallow(un)});var nn=-1;numbers_iwa_doit(qe,f,Qe,function(cn,hn){for(var un=parse_shallow(cn.messages[0].data),zn=3;zn<=69;++zn)delete un[zn];var Xn=mappa(un[2],parse_TSP_Reference);Xn.forEach(function(qn){return numbers_del_oref(cn,qn)}),nn=get_unique_msgid({deps:[Qe],location:f[Xn[0]].location,type:f[Xn[0]].type},f),numbers_add_oref(cn,nn),Pi[Xn[0]]=nn,un[2]=[{type:2,data:write_TSP_Reference(nn)}];var Un=numbers_iwa_find(qe,f,Xn[0]);Un.id=nn,f[Xn[0]].location==f[Qe].location?hn.push(Un):(numbers_iwa_doit(qe,f,2,function(qn){var ys=parse_shallow(qn.messages[0].data);numbers_meta_add_dep(ys,f,Qe,nn),qn.messages[0].data=write_shallow(ys)}),numbers_iwa_doit(qe,f,nn,function(qn,ys){return ys.push(Un)})),cn.messages[0].data=write_shallow(un)});var ln=-1;numbers_iwa_doit(qe,f,nn,function(cn,hn){for(var un=parse_shallow(cn.messages[0].data),zn=parse_shallow(un[1][0].data),Xn=3;Xn<=69;++Xn)delete zn[Xn];var Un=parse_TSP_Reference(zn[2][0].data);zn[2][0].data=write_TSP_Reference(Pi[Un]),un[1][0].data=write_shallow(zn);var qn=parse_TSP_Reference(un[2][0].data);numbers_del_oref(cn,qn),ln=get_unique_msgid({deps:[nn],location:f[qn].location,type:f[qn].type},f),numbers_add_oref(cn,ln),Pi[qn]=ln,un[2][0].data=write_TSP_Reference(ln);var ys=numbers_iwa_find(qe,f,qn);ys.id=ln,f[nn].location==f[ln].location?hn.push(ys):numbers_iwa_doit(qe,f,ln,function(vs,ea){return ea.push(ys)}),cn.messages[0].data=write_shallow(un)}),numbers_iwa_doit(qe,f,ln,function(cn,hn){var un,zn,Xn=parse_shallow(cn.messages[0].data),Un=u8str(Xn[1][0].data),qn=Un.replace(/-[A-Z0-9]*/,"-".concat(("0000"+ze.toString(16)).slice(-4)));if(Xn[1][0].data=stru8(qn),[12,13,29,31,32,33,39,44,47,81,82,84].forEach(function(oa){return delete Xn[oa]}),Xn[45]){var ys=parse_shallow(Xn[45][0].data),vs=parse_TSP_Reference(ys[1][0].data);numbers_del_oref(cn,vs),delete Xn[45]}if(Xn[70]){var ea=parse_shallow(Xn[70][0].data);(un=ea[2])==null||un.forEach(function(oa){var fa=parse_shallow(oa.data);[2,3].map(function(ca){return fa[ca][0]}).forEach(function(ca){var la=parse_shallow(ca.data);if(la[8]){var ua=parse_TSP_Reference(la[8][0].data);numbers_del_oref(cn,ua)}})}),delete Xn[70]}[46,30,34,35,36,38,48,49,60,61,62,63,64,71,72,73,74,75,85,86,87,88,89].forEach(function(oa){if(Xn[oa]){var fa=parse_TSP_Reference(Xn[oa][0].data);delete Xn[oa],numbers_del_oref(cn,fa)}});var na=parse_shallow(Xn[4][0].data);{[2,4,5,6,11,12,13,15,16,17,18,19,20,21,22].forEach(function(oa){var fa;if((fa=na[oa])!=null&&fa[0]){var ca=parse_TSP_Reference(na[oa][0].data),la=get_unique_msgid({deps:[ln],location:f[ca].location,type:f[ca].type},f);numbers_del_oref(cn,ca),numbers_add_oref(cn,la),Pi[ca]=la;var ua=numbers_iwa_find(qe,f,ca);if(ua.id=la,f[ca].location==f[ln].location)hn.push(ua);else{f[la].location=f[ca].location.replace(ca.toString(),la.toString()),f[la].location==f[ca].location&&(f[la].location=f[la].location.replace(/\.iwa/,"-".concat(la,".iwa"))),CFB.utils.cfb_add(qe,f[la].location,compress_iwa_file(write_iwa_file([ua])));var ga=f[la].location.replace(/^Root Entry\//,"").replace(/^Index\//,"").replace(/\.iwa$/,"");numbers_iwa_doit(qe,f,2,function(da){var qa=parse_shallow(da.messages[0].data);numbers_add_meta(qa,la,ga),numbers_meta_add_dep(qa,f,ln,la),da.messages[0].data=write_shallow(qa)})}na[oa][0].data=write_TSP_Reference(la)}});var ta=parse_shallow(na[1][0].data);(zn=ta[2])==null||zn.forEach(function(oa){var fa=parse_TSP_Reference(oa.data),ca=get_unique_msgid({deps:[ln],location:f[fa].location,type:f[fa].type},f);numbers_del_oref(cn,fa),numbers_add_oref(cn,ca),Pi[fa]=ca;var la=numbers_iwa_find(qe,f,fa);if(la.id=ca,f[fa].location==f[ln].location)hn.push(la);else{f[ca].location=f[fa].location.replace(fa.toString(),ca.toString()),f[ca].location==f[fa].location&&(f[ca].location=f[ca].location.replace(/\.iwa/,"-".concat(ca,".iwa"))),CFB.utils.cfb_add(qe,f[ca].location,compress_iwa_file(write_iwa_file([la])));var ua=f[ca].location.replace(/^Root Entry\//,"").replace(/^Index\//,"").replace(/\.iwa$/,"");numbers_iwa_doit(qe,f,2,function(ga){var da=parse_shallow(ga.messages[0].data);numbers_add_meta(da,ca,ua),numbers_meta_add_dep(da,f,ln,ca),ga.messages[0].data=write_shallow(da)})}oa.data=write_TSP_Reference(ca)}),na[1][0].data=write_shallow(ta);var ra=parse_shallow(na[3][0].data);ra[1].forEach(function(oa){var fa=parse_shallow(oa.data),ca=parse_TSP_Reference(fa[2][0].data),la=Pi[ca];if(!Pi[ca]){la=get_unique_msgid({deps:[ln],location:"",type:f[ca].type},f),f[la].location="Root Entry/Index/Tables/Tile-".concat(la,".iwa"),Pi[ca]=la;var ua=numbers_iwa_find(qe,f,ca);ua.id=la,numbers_del_oref(cn,ca),numbers_add_oref(cn,la),CFB.utils.cfb_add(qe,"/Index/Tables/Tile-".concat(la,".iwa"),compress_iwa_file(write_iwa_file([ua]))),numbers_iwa_doit(qe,f,2,function(ga){var da=parse_shallow(ga.messages[0].data);da[3].push({type:2,data:write_shallow([[],[{type:0,data:write_varint49(la)}],[{type:2,data:stru8("Tables/Tile")}],[{type:2,data:stru8("Tables/Tile-".concat(la))}],[{type:2,data:new Uint8Array([2,0,0])}],[{type:2,data:new Uint8Array([2,0,0])}],[],[],[],[],[{type:0,data:write_varint49(0)}],[],[{type:0,data:write_varint49(0)}]])}),da[1]=[{type:0,data:write_varint49(Math.max(la+1,varint_to_i32(da[1][0].data)))}],numbers_meta_add_dep(da,f,ln,la),ga.messages[0].data=write_shallow(da)})}fa[2][0].data=write_TSP_Reference(la),oa.data=write_shallow(fa)}),na[3][0].data=write_shallow(ra)}Xn[4][0].data=write_shallow(na),cn.messages[0].data=write_shallow(Xn)})}function write_numbers_ws(qe,f,ze,Ke,Qe,Pi){var nn=[];numbers_iwa_doit(qe,f,Pi,function(hn){var un=parse_shallow(hn.messages[0].data);un[1]=[{type:2,data:stru8(Ke)}],nn=mappa(un[2],parse_TSP_Reference),hn.messages[0].data=write_shallow(un)});var ln=numbers_iwa_find(qe,f,nn[0]),cn=parse_TSP_Reference(parse_shallow(ln.messages[0].data)[2][0].data);numbers_iwa_doit(qe,f,cn,function(hn,un){return write_numbers_tma(qe,f,ze,hn,un,cn)})}function write_numbers_tma(qe,f,ze,Ke,Qe,Pi){if(!ze["!ref"])throw new Error("Cannot export empty sheet to NUMBERS");var nn=decode_range(ze["!ref"]);nn.s.r=nn.s.c=0;var ln=!1;nn.e.c>999&&(ln=!0,nn.e.c=999),nn.e.r>999999&&(ln=!0,nn.e.r=999999),ln&&console.error("Truncating to ".concat(encode_range(nn)));var cn=[];if(ze["!data"])cn=ze["!data"];else{for(var hn=[],un=0;un<=nn.e.c;++un)hn[un]=encode_col(un);for(var zn=0;zn<=nn.e.r;++zn){cn[zn]=[];var Xn=""+(zn+1);for(un=0;un<=nn.e.c;++un){var Un=ze[hn[un]+Xn];Un&&(cn[zn][un]=Un)}}}var qn={cmnt:[{a:"~54ee77S~",t:"... the people who are crazy enough to think they can change the world, are the ones who do."}],rsst:[{v:"~54ee77S~",l:"https://sheetjs.com/"}],sst:["~Sh33tJ5~"]},ys=parse_shallow(Ke.messages[0].data);{ys[6][0].data=write_varint49(nn.e.r+1),ys[7][0].data=write_varint49(nn.e.c+1),delete ys[46];var vs=parse_shallow(ys[4][0].data);{var ea=parse_TSP_Reference(parse_shallow(vs[1][0].data)[2][0].data);numbers_iwa_doit(qe,f,ea,function(pl,Al){var xl,al=parse_shallow(pl.messages[0].data);if((xl=al==null?void 0:al[2])!=null&&xl[0])for(var Fl=0;Fl<cn.length;++Fl){var Ol=parse_shallow(al[2][0].data);Ol[1][0].data=write_varint49(Fl),Ol[4][0].data=write_varint49(cn[Fl].length),al[2][Fl]={type:al[2][0].type,data:write_shallow(Ol)}}pl.messages[0].data=write_shallow(al)});var na=parse_TSP_Reference(vs[2][0].data);numbers_iwa_doit(qe,f,na,function(pl,Al){for(var xl=parse_shallow(pl.messages[0].data),al=0;al<=nn.e.c;++al){var Fl=parse_shallow(xl[2][0].data);Fl[1][0].data=write_varint49(al),Fl[4][0].data=write_varint49(nn.e.r+1),xl[2][al]={type:xl[2][0].type,data:write_shallow(Fl)}}pl.messages[0].data=write_shallow(xl)});var ta=parse_shallow(vs[9][0].data);ta[1]=[];var ra=parse_shallow(vs[3][0].data);{var oa=256;ra[2]=[{type:0,data:write_varint49(oa)}];var fa=parse_TSP_Reference(parse_shallow(ra[1][0].data)[2][0].data),ca=function(){var pl=numbers_iwa_find(qe,f,2),Al=parse_shallow(pl.messages[0].data),xl=Al[3].filter(function(al){return varint_to_i32(parse_shallow(al.data)[1][0].data)==fa});return xl!=null&&xl.length?varint_to_i32(parse_shallow(xl[0].data)[12][0].data):0}();CFB.utils.cfb_del(qe,f[fa].location),numbers_iwa_doit(qe,f,2,function(pl){var Al=parse_shallow(pl.messages[0].data);Al[3]=Al[3].filter(function(xl){return varint_to_i32(parse_shallow(xl.data)[1][0].data)!=fa}),numbers_meta_del_dep(Al,f,Pi,fa),pl.messages[0].data=write_shallow(Al)}),numbers_del_oref(Ke,fa),ra[1]=[];for(var la=Math.ceil((nn.e.r+1)/oa),ua=0;ua<la;++ua){var ga=get_unique_msgid({deps:[],location:"",type:6002},f);f[ga].location="Root Entry/Index/Tables/Tile-".concat(ga,".iwa");for(var da=[[],[{type:0,data:write_varint49(0)}],[{type:0,data:write_varint49(Math.min(nn.e.r+1,(ua+1)*oa))}],[{type:0,data:write_varint49(0)}],[{type:0,data:write_varint49(Math.min((ua+1)*oa,nn.e.r+1)-ua*oa)}],[],[{type:0,data:write_varint49(5)}],[{type:0,data:write_varint49(1)}],[{type:0,data:write_varint49(1)}]],qa=ua*oa;qa<=Math.min(nn.e.r,(ua+1)*oa-1);++qa){var tl=write_TST_TileRowInfo(cn[qa],qn);tl[1][0].data=write_varint49(qa-ua*oa),da[5].push({data:write_shallow(tl),type:2})}ra[1].push({type:2,data:write_shallow([[],[{type:0,data:write_varint49(ua)}],[{type:2,data:write_TSP_Reference(ga)}]])});var ol={id:ga,messages:[write_iwam(6002,write_shallow(da))]},hl=compress_iwa_file(write_iwa_file([ol]));CFB.utils.cfb_add(qe,"/Index/Tables/Tile-".concat(ga,".iwa"),hl),numbers_iwa_doit(qe,f,2,function(pl){var Al=parse_shallow(pl.messages[0].data);Al[3].push({type:2,data:write_shallow([[],[{type:0,data:write_varint49(ga)}],[{type:2,data:stru8("Tables/Tile")}],[{type:2,data:stru8("Tables/Tile-".concat(ga))}],[{type:2,data:new Uint8Array([2,0,0])}],[{type:2,data:new Uint8Array([2,0,0])}],[],[],[],[],[{type:0,data:write_varint49(0)}],[],[{type:0,data:write_varint49(ca)}]])}),Al[1]=[{type:0,data:write_varint49(Math.max(ga+1,varint_to_i32(Al[1][0].data)))}],numbers_meta_add_dep(Al,f,Pi,ga),pl.messages[0].data=write_shallow(Al)}),numbers_add_oref(Ke,ga),ta[1].push({type:2,data:write_shallow([[],[{type:0,data:write_varint49(ua*oa)}],[{type:0,data:write_varint49(ua)}]])})}}if(vs[3][0].data=write_shallow(ra),vs[9][0].data=write_shallow(ta),vs[10]=[{type:2,data:new Uint8Array([])}],ze["!merges"]){var wl=get_unique_msgid({type:6144,deps:[Pi],location:f[Pi].location},f);Qe.push({id:wl,messages:[write_iwam(6144,write_shallow([[],ze["!merges"].map(function(pl){return{type:2,data:write_shallow([[],[{type:2,data:write_shallow([[],[{type:5,data:new Uint8Array(new Uint16Array([pl.s.r,pl.s.c]).buffer)}]])}],[{type:2,data:write_shallow([[],[{type:5,data:new Uint8Array(new Uint16Array([pl.e.r-pl.s.r+1,pl.e.c-pl.s.c+1]).buffer)}]])}]])}})]))]}),vs[13]=[{type:2,data:write_TSP_Reference(wl)}],numbers_iwa_doit(qe,f,2,function(pl){var Al=parse_shallow(pl.messages[0].data);numbers_meta_add_dep(Al,f,Pi,wl),pl.messages[0].data=write_shallow(Al)}),numbers_add_oref(Ke,wl)}else delete vs[13];var _l=parse_TSP_Reference(vs[4][0].data);numbers_iwa_doit(qe,f,_l,function(pl){var Al=parse_shallow(pl.messages[0].data);Al[3]=[],qn.sst.forEach(function(xl,al){al!=0&&Al[3].push({type:2,data:write_shallow([[],[{type:0,data:write_varint49(al)}],[{type:0,data:write_varint49(1)}],[{type:2,data:stru8(xl)}]])})}),pl.messages[0].data=write_shallow(Al)});var gl=parse_TSP_Reference(vs[17][0].data);if(numbers_iwa_doit(qe,f,gl,function(pl){var Al=parse_shallow(pl.messages[0].data);Al[3]=[];var xl=[904980,903835,903815,903845];qn.rsst.forEach(function(al,Fl){if(Fl!=0){var Ol=[[],[{type:0,data:new Uint8Array([5])}],[],[{type:2,data:stru8(al.v)}]];Ol[10]=[{type:0,data:new Uint8Array([1])}],Ol[19]=[{type:2,data:new Uint8Array([10,6,8,0,18,2,101,110])}],Ol[5]=[{type:2,data:new Uint8Array([10,8,8,0,18,4,8,155,149,55])}],Ol[2]=[{type:2,data:new Uint8Array([8,148,158,55])}],Ol[6]=[{type:2,data:new Uint8Array([10,6,8,0,16,0,24,0])}],Ol[7]=[{type:2,data:new Uint8Array([10,8,8,0,18,4,8,135,149,55])}],Ol[8]=[{type:2,data:new Uint8Array([10,8,8,0,18,4,8,165,149,55])}],Ol[14]=[{type:2,data:new Uint8Array([10,6,8,0,16,0,24,0])}],Ol[24]=[{type:2,data:new Uint8Array([10,6,8,0,16,0,24,0])}];var Jo=get_unique_msgid({deps:[],location:"",type:2001},f),cl=[];if(al.l){var rl=numbers_add_msg(qe,2032,[[],[],[{type:2,data:stru8(al.l)}]],"/Index/Tables/DataList",f);Ol[11]=[];var nl=[[],[]];nl[1]||(nl[1]=[]),nl[1].push({type:2,data:write_shallow([[],[{type:0,data:write_varint49(0)}],[{type:2,data:write_TSP_Reference(rl)}]])}),Ol[11][0]={type:2,data:write_shallow(nl)},cl.push(rl)}numbers_add_msg(qe,2001,Ol,"/Index/Tables/DataList",f,Jo),numbers_iwa_doit(qe,f,Jo,function(Pl){xl.forEach(function(Sl){return numbers_add_oref(Pl,Sl)}),cl.forEach(function(Sl){return numbers_add_oref(Pl,Sl)})});var vl=numbers_add_msg(qe,6218,[[],[{type:2,data:write_TSP_Reference(Jo)}],[],[{type:2,data:new Uint8Array([13,255,255,255,0,18,10,16,255,255,1,24,255,255,255,255,7])}]],"/Index/Tables/DataList",f);numbers_iwa_doit(qe,f,vl,function(Pl){return numbers_add_oref(Pl,Jo)}),Al[3].push({type:2,data:write_shallow([[],[{type:0,data:write_varint49(Fl)}],[{type:0,data:write_varint49(1)}],[],[],[],[],[],[],[{type:2,data:write_TSP_Reference(vl)}]])}),numbers_add_oref(pl,vl),numbers_iwa_doit(qe,f,2,function(Pl){var Sl=parse_shallow(Pl.messages[0].data);numbers_meta_add_dep(Sl,f,gl,vl),numbers_meta_add_dep(Sl,f,vl,Jo),numbers_meta_add_dep(Sl,f,Jo,cl),numbers_meta_add_dep(Sl,f,Jo,xl),Pl.messages[0].data=write_shallow(Sl)})}}),pl.messages[0].data=write_shallow(Al)}),qn.cmnt.length>1){var dl=parse_TSP_Reference(vs[19][0].data),sl={},kl=0;numbers_iwa_doit(qe,f,dl,function(pl){var Al=parse_shallow(pl.messages[0].data);Al[3]=[],qn.cmnt.forEach(function(xl,al){if(al!=0){var Fl=[];xl.replies&&xl.replies.forEach(function(cl){sl[cl.a||""]||(sl[cl.a||""]=numbers_add_msg(qe,212,[[],[{type:2,data:stru8(cl.a||"")}],[{type:2,data:get_author_color(++kl)}],[],[{type:0,data:write_varint49(0)}]],"/Index/Tables/DataList",f));var rl=sl[cl.a||""],nl=numbers_add_msg(qe,3056,[[],[{type:2,data:stru8(cl.t||"")}],[{type:2,data:write_shallow([[],[{type:1,data:new Uint8Array([0,0,0,128,116,109,182,65])}]])}],[{type:2,data:write_TSP_Reference(rl)}]],"/Index/Tables/DataList",f);numbers_iwa_doit(qe,f,nl,function(vl){return numbers_add_oref(vl,rl)}),Fl.push(nl),numbers_iwa_doit(qe,f,2,function(vl){var Pl=parse_shallow(vl.messages[0].data);numbers_meta_add_dep(Pl,f,nl,rl),vl.messages[0].data=write_shallow(Pl)})}),sl[xl.a||""]||(sl[xl.a||""]=numbers_add_msg(qe,212,[[],[{type:2,data:stru8(xl.a||"")}],[{type:2,data:get_author_color(++kl)}],[],[{type:0,data:write_varint49(0)}]],"/Index/Tables/DataList",f));var Ol=sl[xl.a||""],Jo=numbers_add_msg(qe,3056,[[],[{type:2,data:stru8(xl.t||"")}],[{type:2,data:write_shallow([[],[{type:1,data:new Uint8Array([0,0,0,128,116,109,182,65])}]])}],[{type:2,data:write_TSP_Reference(Ol)}],Fl.map(function(cl){return{type:2,data:write_TSP_Reference(cl)}}),[{type:2,data:write_shallow([[],[{type:0,data:write_varint49(al)}],[{type:0,data:write_varint49(0)}]])}]],"/Index/Tables/DataList",f);numbers_iwa_doit(qe,f,Jo,function(cl){numbers_add_oref(cl,Ol),Fl.forEach(function(rl){return numbers_add_oref(cl,rl)})}),Al[3].push({type:2,data:write_shallow([[],[{type:0,data:write_varint49(al)}],[{type:0,data:write_varint49(1)}],[],[],[],[],[],[],[],[{type:2,data:write_TSP_Reference(Jo)}]])}),numbers_add_oref(pl,Jo),numbers_iwa_doit(qe,f,2,function(cl){var rl=parse_shallow(cl.messages[0].data);numbers_meta_add_dep(rl,f,dl,Jo),numbers_meta_add_dep(rl,f,Jo,Ol),Fl.length&&numbers_meta_add_dep(rl,f,Jo,Fl),cl.messages[0].data=write_shallow(rl)})}}),Al[2][0].data=write_varint49(qn.cmnt.length+1),pl.messages[0].data=write_shallow(Al)})}}ys[4][0].data=write_shallow(vs)}Ke.messages[0].data=write_shallow(ys)}function fix_opts_func(qe){return function(ze){for(var Ke=0;Ke!=qe.length;++Ke){var Qe=qe[Ke];ze[Qe[0]]===void 0&&(ze[Qe[0]]=Qe[1]),Qe[2]==="n"&&(ze[Qe[0]]=Number(ze[Qe[0]]))}}}function fix_write_opts(qe){fix_opts_func([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(qe)}function write_zip_xlsb(qe,f){qe&&!qe.SSF&&(qe.SSF=dup(table_fmt)),qe&&qe.SSF&&(make_ssf(),SSF_load_table(qe.SSF),f.revssf=evert_num(qe.SSF),f.revssf[qe.SSF[65535]]=0,f.ssf=qe.SSF),f.rels={},f.wbrels={},f.Strings=[],f.Strings.Count=0,f.Strings.Unique=0,browser_has_Map?f.revStrings=new Map:(f.revStrings={},f.revStrings.foo=[],delete f.revStrings.foo);var ze="bin",Ke=!0,Qe=new_ct();fix_write_opts(f=f||{});var Pi=zip_new(),nn="",ln=0;if(f.cellXfs=[],get_cell_style(f.cellXfs,{},{revssf:{General:0}}),qe.Props||(qe.Props={}),nn="docProps/core.xml",zip_add_file(Pi,nn,write_core_props(qe.Props,f)),Qe.coreprops.push(nn),add_rels(f.rels,2,nn,RELS.CORE_PROPS),nn="docProps/app.xml",!(qe.Props&&qe.Props.SheetNames))if(!qe.Workbook||!qe.Workbook.Sheets)qe.Props.SheetNames=qe.SheetNames;else{for(var cn=[],hn=0;hn<qe.SheetNames.length;++hn)(qe.Workbook.Sheets[hn]||{}).Hidden!=2&&cn.push(qe.SheetNames[hn]);qe.Props.SheetNames=cn}qe.Props.Worksheets=qe.Props.SheetNames.length,zip_add_file(Pi,nn,write_ext_props(qe.Props)),Qe.extprops.push(nn),add_rels(f.rels,3,nn,RELS.EXT_PROPS),qe.Custprops!==qe.Props&&keys(qe.Custprops||{}).length>0&&(nn="docProps/custom.xml",zip_add_file(Pi,nn,write_cust_props(qe.Custprops)),Qe.custprops.push(nn),add_rels(f.rels,4,nn,RELS.CUST_PROPS));var un=["SheetJ5"];for(f.tcid=0,ln=1;ln<=qe.SheetNames.length;++ln){var zn={"!id":{}},Xn=qe.Sheets[qe.SheetNames[ln-1]],Un=(Xn||{})["!type"]||"sheet";switch(Un){case"chart":default:nn="xl/worksheets/sheet"+ln+"."+ze,zip_add_file(Pi,nn,write_ws_bin(ln-1,f,qe,zn)),Qe.sheets.push(nn),add_rels(f.wbrels,-1,"worksheets/sheet"+ln+"."+ze,RELS.WS[0])}if(Xn){var qn=Xn["!comments"],ys=!1,vs="";if(qn&&qn.length>0){var ea=!1;qn.forEach(function(ta){ta[1].forEach(function(ra){ra.T==!0&&(ea=!0)})}),ea&&(vs="xl/threadedComments/threadedComment"+ln+".xml",zip_add_file(Pi,vs,write_tcmnt_xml(qn,un,f)),Qe.threadedcomments.push(vs),add_rels(zn,-1,"../threadedComments/threadedComment"+ln+".xml",RELS.TCMNT)),vs="xl/comments"+ln+"."+ze,zip_add_file(Pi,vs,write_comments_bin(qn)),Qe.comments.push(vs),add_rels(zn,-1,"../comments"+ln+"."+ze,RELS.CMNT),ys=!0}Xn["!legacy"]&&ys&&zip_add_file(Pi,"xl/drawings/vmlDrawing"+ln+".vml",write_vml(ln,Xn["!comments"])),delete Xn["!comments"],delete Xn["!legacy"]}zn["!id"].rId1&&zip_add_file(Pi,get_rels_path(nn),write_rels(zn))}f.Strings!=null&&f.Strings.length>0&&(nn="xl/sharedStrings."+ze,zip_add_file(Pi,nn,write_sst_bin(f.Strings)),Qe.strs.push(nn),add_rels(f.wbrels,-1,"sharedStrings."+ze,RELS.SST)),nn="xl/workbook."+ze,zip_add_file(Pi,nn,write_wb_bin(qe)),Qe.workbooks.push(nn),add_rels(f.rels,1,nn,RELS.WB),nn="xl/theme/theme1.xml";var na=write_theme(qe.Themes,f);return zip_add_file(Pi,nn,na),Qe.themes.push(nn),add_rels(f.wbrels,-1,"theme/theme1.xml",RELS.THEME),nn="xl/styles."+ze,zip_add_file(Pi,nn,write_sty_bin(qe,f)),Qe.styles.push(nn),add_rels(f.wbrels,-1,"styles."+ze,RELS.STY),qe.vbaraw&&Ke&&(nn="xl/vbaProject.bin",zip_add_file(Pi,nn,qe.vbaraw),Qe.vba.push(nn),add_rels(f.wbrels,-1,"vbaProject.bin",RELS.VBA)),nn="xl/metadata."+ze,zip_add_file(Pi,nn,write_xlmeta_bin()),Qe.metadata.push(nn),add_rels(f.wbrels,-1,"metadata."+ze,RELS.XLMETA),un.length>1&&(nn="xl/persons/person.xml",zip_add_file(Pi,nn,write_people_xml(un)),Qe.people.push(nn),add_rels(f.wbrels,-1,"persons/person.xml",RELS.PEOPLE)),zip_add_file(Pi,"[Content_Types].xml",write_ct(Qe,f)),zip_add_file(Pi,"_rels/.rels",write_rels(f.rels)),zip_add_file(Pi,"xl/_rels/workbook."+ze+".rels",write_rels(f.wbrels)),delete f.revssf,delete f.ssf,Pi}function write_zip_xlsx(qe,f){qe&&!qe.SSF&&(qe.SSF=dup(table_fmt)),qe&&qe.SSF&&(make_ssf(),SSF_load_table(qe.SSF),f.revssf=evert_num(qe.SSF),f.revssf[qe.SSF[65535]]=0,f.ssf=qe.SSF),f.rels={},f.wbrels={},f.Strings=[],f.Strings.Count=0,f.Strings.Unique=0,browser_has_Map?f.revStrings=new Map:(f.revStrings={},f.revStrings.foo=[],delete f.revStrings.foo);var ze="xml",Ke=VBAFMTS.indexOf(f.bookType)>-1,Qe=new_ct();fix_write_opts(f=f||{});var Pi=zip_new(),nn="",ln=0;if(f.cellXfs=[],get_cell_style(f.cellXfs,{},{revssf:{General:0}}),qe.Props||(qe.Props={}),nn="docProps/core.xml",zip_add_file(Pi,nn,write_core_props(qe.Props,f)),Qe.coreprops.push(nn),add_rels(f.rels,2,nn,RELS.CORE_PROPS),nn="docProps/app.xml",!(qe.Props&&qe.Props.SheetNames))if(!qe.Workbook||!qe.Workbook.Sheets)qe.Props.SheetNames=qe.SheetNames;else{for(var cn=[],hn=0;hn<qe.SheetNames.length;++hn)(qe.Workbook.Sheets[hn]||{}).Hidden!=2&&cn.push(qe.SheetNames[hn]);qe.Props.SheetNames=cn}qe.Props.Worksheets=qe.Props.SheetNames.length,zip_add_file(Pi,nn,write_ext_props(qe.Props)),Qe.extprops.push(nn),add_rels(f.rels,3,nn,RELS.EXT_PROPS),qe.Custprops!==qe.Props&&keys(qe.Custprops||{}).length>0&&(nn="docProps/custom.xml",zip_add_file(Pi,nn,write_cust_props(qe.Custprops)),Qe.custprops.push(nn),add_rels(f.rels,4,nn,RELS.CUST_PROPS));var un=["SheetJ5"];for(f.tcid=0,ln=1;ln<=qe.SheetNames.length;++ln){var zn={"!id":{}},Xn=qe.Sheets[qe.SheetNames[ln-1]],Un=(Xn||{})["!type"]||"sheet";switch(Un){case"chart":default:nn="xl/worksheets/sheet"+ln+"."+ze,zip_add_file(Pi,nn,write_ws_xml(ln-1,f,qe,zn)),Qe.sheets.push(nn),add_rels(f.wbrels,-1,"worksheets/sheet"+ln+"."+ze,RELS.WS[0])}if(Xn){var qn=Xn["!comments"],ys=!1,vs="";if(qn&&qn.length>0){var ea=!1;qn.forEach(function(na){na[1].forEach(function(ta){ta.T==!0&&(ea=!0)})}),ea&&(vs="xl/threadedComments/threadedComment"+ln+".xml",zip_add_file(Pi,vs,write_tcmnt_xml(qn,un,f)),Qe.threadedcomments.push(vs),add_rels(zn,-1,"../threadedComments/threadedComment"+ln+".xml",RELS.TCMNT)),vs="xl/comments"+ln+"."+ze,zip_add_file(Pi,vs,write_comments_xml(qn)),Qe.comments.push(vs),add_rels(zn,-1,"../comments"+ln+"."+ze,RELS.CMNT),ys=!0}Xn["!legacy"]&&ys&&zip_add_file(Pi,"xl/drawings/vmlDrawing"+ln+".vml",write_vml(ln,Xn["!comments"])),delete Xn["!comments"],delete Xn["!legacy"]}zn["!id"].rId1&&zip_add_file(Pi,get_rels_path(nn),write_rels(zn))}return f.Strings!=null&&f.Strings.length>0&&(nn="xl/sharedStrings."+ze,zip_add_file(Pi,nn,write_sst_xml(f.Strings,f)),Qe.strs.push(nn),add_rels(f.wbrels,-1,"sharedStrings."+ze,RELS.SST)),nn="xl/workbook."+ze,zip_add_file(Pi,nn,write_wb_xml(qe)),Qe.workbooks.push(nn),add_rels(f.rels,1,nn,RELS.WB),nn="xl/theme/theme1.xml",zip_add_file(Pi,nn,write_theme(qe.Themes,f)),Qe.themes.push(nn),add_rels(f.wbrels,-1,"theme/theme1.xml",RELS.THEME),nn="xl/styles."+ze,zip_add_file(Pi,nn,write_sty_xml(qe,f)),Qe.styles.push(nn),add_rels(f.wbrels,-1,"styles."+ze,RELS.STY),qe.vbaraw&&Ke&&(nn="xl/vbaProject.bin",zip_add_file(Pi,nn,qe.vbaraw),Qe.vba.push(nn),add_rels(f.wbrels,-1,"vbaProject.bin",RELS.VBA)),nn="xl/metadata."+ze,zip_add_file(Pi,nn,write_xlmeta_xml()),Qe.metadata.push(nn),add_rels(f.wbrels,-1,"metadata."+ze,RELS.XLMETA),un.length>1&&(nn="xl/persons/person.xml",zip_add_file(Pi,nn,write_people_xml(un)),Qe.people.push(nn),add_rels(f.wbrels,-1,"persons/person.xml",RELS.PEOPLE)),zip_add_file(Pi,"[Content_Types].xml",write_ct(Qe,f)),zip_add_file(Pi,"_rels/.rels",write_rels(f.rels)),zip_add_file(Pi,"xl/_rels/workbook."+ze+".rels",write_rels(f.wbrels)),delete f.revssf,delete f.ssf,Pi}function firstbyte(qe,f){var ze="";switch((f||{}).type||"base64"){case"buffer":return[qe[0],qe[1],qe[2],qe[3],qe[4],qe[5],qe[6],qe[7]];case"base64":ze=Base64_decode(qe.slice(0,12));break;case"binary":ze=qe;break;case"array":return[qe[0],qe[1],qe[2],qe[3],qe[4],qe[5],qe[6],qe[7]];default:throw new Error("Unrecognized type "+(f&&f.type||"undefined"))}return[ze.charCodeAt(0),ze.charCodeAt(1),ze.charCodeAt(2),ze.charCodeAt(3),ze.charCodeAt(4),ze.charCodeAt(5),ze.charCodeAt(6),ze.charCodeAt(7)]}function write_cfb_ctr(qe,f){switch(f.type){case"base64":case"binary":break;case"buffer":case"array":f.type="";break;case"file":return write_dl(f.file,CFB.write(qe,{type:has_buf?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+f.bookType+"' files");default:throw new Error("Unrecognized type "+f.type)}return CFB.write(qe,f)}function write_zip(qe,f){switch(f.bookType){case"ods":return write_ods(qe,f);case"numbers":return write_numbers_iwa(qe,f);case"xlsb":return write_zip_xlsb(qe,f);default:return write_zip_xlsx(qe,f)}}function write_zip_type(qe,f){var ze=dup(f||{}),Ke=write_zip(qe,ze);return write_zip_denouement(Ke,ze)}function write_zip_denouement(qe,f){var ze={},Ke=has_buf?"nodebuffer":typeof Uint8Array<"u"?"array":"string";if(f.compression&&(ze.compression="DEFLATE"),f.password)ze.type=Ke;else switch(f.type){case"base64":ze.type="base64";break;case"binary":ze.type="string";break;case"string":throw new Error("'string' output type invalid for '"+f.bookType+"' files");case"buffer":case"file":ze.type=Ke;break;default:throw new Error("Unrecognized type "+f.type)}var Qe=qe.FullPaths?CFB.write(qe,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[ze.type]||ze.type,compression:!!f.compression}):qe.generate(ze);if(typeof Deno<"u"&&typeof Qe=="string"){if(f.type=="binary"||f.type=="base64")return Qe;Qe=new Uint8Array(s2ab(Qe))}return f.password&&typeof encrypt_agile<"u"?write_cfb_ctr(encrypt_agile(Qe,f.password),f):f.type==="file"?write_dl(f.file,Qe):f.type=="string"?utf8read(Qe):Qe}function write_cfb_type(qe,f){var ze=f||{},Ke=write_xlscfb(qe,ze);return write_cfb_ctr(Ke,ze)}function write_string_type(qe,f,ze){ze||(ze="");var Ke=ze+qe;switch(f.type){case"base64":return Base64_encode(utf8write(Ke));case"binary":return utf8write(Ke);case"string":return qe;case"file":return write_dl(f.file,Ke,"utf8");case"buffer":return has_buf?Buffer_from(Ke,"utf8"):typeof TextEncoder<"u"?new TextEncoder().encode(Ke):write_string_type(Ke,{type:"binary"}).split("").map(function(Qe){return Qe.charCodeAt(0)})}throw new Error("Unrecognized type "+f.type)}function write_stxt_type(qe,f){switch(f.type){case"base64":return Base64_encode_pass(qe);case"binary":return qe;case"string":return qe;case"file":return write_dl(f.file,qe,"binary");case"buffer":return has_buf?Buffer_from(qe,"binary"):qe.split("").map(function(ze){return ze.charCodeAt(0)})}throw new Error("Unrecognized type "+f.type)}function write_binary_type(qe,f){switch(f.type){case"string":case"base64":case"binary":for(var ze="",Ke=0;Ke<qe.length;++Ke)ze+=String.fromCharCode(qe[Ke]);return f.type=="base64"?Base64_encode(ze):f.type=="string"?utf8read(ze):ze;case"file":return write_dl(f.file,qe);case"buffer":return qe;default:throw new Error("Unrecognized type "+f.type)}}function writeSync(qe,f){reset_cp(),check_wb(qe);var ze=dup(f||{});if(ze.cellStyles&&(ze.cellNF=!0,ze.sheetStubs=!0),ze.type=="array"){ze.type="binary";var Ke=writeSync(qe,ze);return ze.type="array",s2ab(Ke)}var Qe=0;if(ze.sheet&&(typeof ze.sheet=="number"?Qe=ze.sheet:Qe=qe.SheetNames.indexOf(ze.sheet),!qe.SheetNames[Qe]))throw new Error("Sheet not found: "+ze.sheet+" : "+typeof ze.sheet);switch(ze.bookType||"xlsb"){case"xml":case"xlml":return write_string_type(write_xlml(qe,ze),ze);case"slk":case"sylk":return write_string_type(SYLK.from_sheet(qe.Sheets[qe.SheetNames[Qe]],ze,qe),ze);case"htm":case"html":return write_string_type(sheet_to_html(qe.Sheets[qe.SheetNames[Qe]],ze),ze);case"txt":return write_stxt_type(sheet_to_txt(qe.Sheets[qe.SheetNames[Qe]],ze),ze);case"csv":return write_string_type(sheet_to_csv(qe.Sheets[qe.SheetNames[Qe]],ze),ze,"\uFEFF");case"dif":return write_string_type(DIF.from_sheet(qe.Sheets[qe.SheetNames[Qe]],ze),ze);case"dbf":return write_binary_type(DBF.from_sheet(qe.Sheets[qe.SheetNames[Qe]],ze),ze);case"prn":return write_string_type(PRN.from_sheet(qe.Sheets[qe.SheetNames[Qe]],ze),ze);case"rtf":return write_string_type(sheet_to_rtf(qe.Sheets[qe.SheetNames[Qe]]),ze);case"eth":return write_string_type(ETH.from_sheet(qe.Sheets[qe.SheetNames[Qe]],ze),ze);case"fods":return write_string_type(write_ods(qe,ze),ze);case"wk1":return write_binary_type(WK_.sheet_to_wk1(qe.Sheets[qe.SheetNames[Qe]],ze),ze);case"wk3":return write_binary_type(WK_.book_to_wk3(qe,ze),ze);case"biff2":ze.biff||(ze.biff=2);case"biff3":ze.biff||(ze.biff=3);case"biff4":return ze.biff||(ze.biff=4),write_binary_type(write_biff_buf(qe,ze),ze);case"biff5":ze.biff||(ze.biff=5);case"biff8":case"xla":case"xls":return ze.biff||(ze.biff=8),write_cfb_type(qe,ze);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return write_zip_type(qe,ze);default:throw new Error("Unrecognized bookType |"+ze.bookType+"|")}}function resolve_book_type(qe){if(!qe.bookType){var f={xls:"biff8",htm:"html",slk:"sylk",socialcalc:"eth",Sh33tJS:"WTF"},ze=qe.file.slice(qe.file.lastIndexOf(".")).toLowerCase();ze.match(/^\.[a-z]+$/)&&(qe.bookType=ze.slice(1)),qe.bookType=f[qe.bookType]||qe.bookType}}function writeFileSync(qe,f,ze){var Ke=ze||{};return Ke.type="file",Ke.file=f,resolve_book_type(Ke),writeSync(qe,Ke)}function make_json_row(qe,f,ze,Ke,Qe,Pi,nn){var ln=encode_row(ze),cn=nn.defval,hn=nn.raw||!Object.prototype.hasOwnProperty.call(nn,"raw"),un=!0,zn=qe["!data"]!=null,Xn=Qe===1?[]:{};if(Qe!==1)if(Object.defineProperty)try{Object.defineProperty(Xn,"__rowNum__",{value:ze,enumerable:!1})}catch{Xn.__rowNum__=ze}else Xn.__rowNum__=ze;if(!zn||qe["!data"][ze])for(var Un=f.s.c;Un<=f.e.c;++Un){var qn=zn?(qe["!data"][ze]||[])[Un]:qe[Ke[Un]+ln];if(qn==null||qn.t===void 0){if(cn===void 0)continue;Pi[Un]!=null&&(Xn[Pi[Un]]=cn);continue}var ys=qn.v;switch(qn.t){case"z":if(ys==null)break;continue;case"e":ys=ys==0?null:void 0;break;case"s":case"b":case"n":if(!qn.z||!fmt_is_date(qn.z)||(ys=numdate(ys),typeof ys=="number"))break;case"d":nn&&(nn.UTC||nn.raw===!1)||(ys=utc_to_local(new Date(ys)));break;default:throw new Error("unrecognized type "+qn.t)}if(Pi[Un]!=null){if(ys==null)if(qn.t=="e"&&ys===null)Xn[Pi[Un]]=null;else if(cn!==void 0)Xn[Pi[Un]]=cn;else if(hn&&ys===null)Xn[Pi[Un]]=null;else continue;else Xn[Pi[Un]]=(qn.t==="n"&&typeof nn.rawNumbers=="boolean"?nn.rawNumbers:hn)?ys:format_cell(qn,ys,nn);ys!=null&&(un=!1)}}return{row:Xn,isempty:un}}function sheet_to_json(qe,f){if(qe==null||qe["!ref"]==null)return[];var ze={t:"n",v:0},Ke=0,Qe=1,Pi=[],nn=0,ln="",cn={s:{r:0,c:0},e:{r:0,c:0}},hn=f||{},un=hn.range!=null?hn.range:qe["!ref"];switch(hn.header===1?Ke=1:hn.header==="A"?Ke=2:Array.isArray(hn.header)?Ke=3:hn.header==null&&(Ke=0),typeof un){case"string":cn=safe_decode_range(un);break;case"number":cn=safe_decode_range(qe["!ref"]),cn.s.r=un;break;default:cn=un}Ke>0&&(Qe=0);var zn=encode_row(cn.s.r),Xn=[],Un=[],qn=0,ys=0,vs=qe["!data"]!=null,ea=cn.s.r,na=0,ta={};vs&&!qe["!data"][ea]&&(qe["!data"][ea]=[]);var ra=hn.skipHidden&&qe["!cols"]||[],oa=hn.skipHidden&&qe["!rows"]||[];for(na=cn.s.c;na<=cn.e.c;++na)if(!(ra[na]||{}).hidden)switch(Xn[na]=encode_col(na),ze=vs?qe["!data"][ea][na]:qe[Xn[na]+zn],Ke){case 1:Pi[na]=na-cn.s.c;break;case 2:Pi[na]=Xn[na];break;case 3:Pi[na]=hn.header[na-cn.s.c];break;default:if(ze==null&&(ze={w:"__EMPTY",t:"s"}),ln=nn=format_cell(ze,null,hn),ys=ta[nn]||0,!ys)ta[nn]=1;else{do ln=nn+"_"+ys++;while(ta[ln]);ta[nn]=ys,ta[ln]=1}Pi[na]=ln}for(ea=cn.s.r+Qe;ea<=cn.e.r;++ea)if(!(oa[ea]||{}).hidden){var fa=make_json_row(qe,cn,ea,Xn,Ke,Pi,hn);(fa.isempty===!1||(Ke===1?hn.blankrows!==!1:hn.blankrows))&&(Un[qn++]=fa.row)}return Un.length=qn,Un}var qreg=/"/g;function make_csv_row(qe,f,ze,Ke,Qe,Pi,nn,ln,cn){for(var hn=!0,un=[],zn="",Xn=encode_row(ze),Un=qe["!data"]!=null,qn=Un&&qe["!data"][ze]||[],ys=f.s.c;ys<=f.e.c;++ys)if(Ke[ys]){var vs=Un?qn[ys]:qe[Ke[ys]+Xn];if(vs==null)zn="";else if(vs.v!=null){hn=!1,zn=""+(cn.rawNumbers&&vs.t=="n"?vs.v:format_cell(vs,null,cn));for(var ea=0,na=0;ea!==zn.length;++ea)if((na=zn.charCodeAt(ea))===Qe||na===Pi||na===34||cn.forceQuotes){zn='"'+zn.replace(qreg,'""')+'"';break}zn=="ID"&&ln==0&&un.length==0&&(zn='"ID"')}else vs.f!=null&&!vs.F?(hn=!1,zn="="+vs.f,zn.indexOf(",")>=0&&(zn='"'+zn.replace(qreg,'""')+'"')):zn="";un.push(zn)}if(cn.strip)for(;un[un.length-1]==="";)--un.length;return cn.blankrows===!1&&hn?null:un.join(nn)}function sheet_to_csv(qe,f){var ze=[],Ke=f??{};if(qe==null||qe["!ref"]==null)return"";for(var Qe=safe_decode_range(qe["!ref"]),Pi=Ke.FS!==void 0?Ke.FS:",",nn=Pi.charCodeAt(0),ln=Ke.RS!==void 0?Ke.RS:`
`,cn=ln.charCodeAt(0),hn="",un=[],zn=Ke.skipHidden&&qe["!cols"]||[],Xn=Ke.skipHidden&&qe["!rows"]||[],Un=Qe.s.c;Un<=Qe.e.c;++Un)(zn[Un]||{}).hidden||(un[Un]=encode_col(Un));for(var qn=0,ys=Qe.s.r;ys<=Qe.e.r;++ys)(Xn[ys]||{}).hidden||(hn=make_csv_row(qe,Qe,ys,un,nn,cn,Pi,qn,Ke),hn!=null&&(hn||Ke.blankrows!==!1)&&ze.push((qn++?ln:"")+hn));return ze.join("")}function sheet_to_txt(qe,f){f||(f={}),f.FS="	",f.RS=`
`;var ze=sheet_to_csv(qe,f);return ze}function sheet_to_formulae(qe,f){var ze="",Ke,Qe="";if(qe==null||qe["!ref"]==null)return[];var Pi=safe_decode_range(qe["!ref"]),nn="",ln=[],cn,hn=[],un=qe["!data"]!=null;for(cn=Pi.s.c;cn<=Pi.e.c;++cn)ln[cn]=encode_col(cn);for(var zn=Pi.s.r;zn<=Pi.e.r;++zn)for(nn=encode_row(zn),cn=Pi.s.c;cn<=Pi.e.c;++cn)if(ze=ln[cn]+nn,Ke=un?(qe["!data"][zn]||[])[cn]:qe[ze],Qe="",Ke!==void 0){if(Ke.F!=null){if(ze=Ke.F,!Ke.f)continue;Qe=Ke.f,ze.indexOf(":")==-1&&(ze=ze+":"+ze)}if(Ke.f!=null)Qe=Ke.f;else{if(f&&f.values===!1)continue;if(Ke.t=="z")continue;if(Ke.t=="n"&&Ke.v!=null)Qe=""+Ke.v;else if(Ke.t=="b")Qe=Ke.v?"TRUE":"FALSE";else if(Ke.w!==void 0)Qe="'"+Ke.w;else{if(Ke.v===void 0)continue;Ke.t=="s"?Qe="'"+Ke.v:Qe=""+Ke.v}}hn[hn.length]=ze+"="+Qe}return hn}function sheet_add_json(qe,f,ze){var Ke=ze||{},Qe=qe?qe["!data"]!=null:Ke.dense,Pi=+!Ke.skipHeader,nn=qe||{};!qe&&Qe&&(nn["!data"]=[]);var ln=0,cn=0;if(nn&&Ke.origin!=null)if(typeof Ke.origin=="number")ln=Ke.origin;else{var hn=typeof Ke.origin=="string"?decode_cell(Ke.origin):Ke.origin;ln=hn.r,cn=hn.c}var un={s:{c:0,r:0},e:{c:cn,r:ln+f.length-1+Pi}};if(nn["!ref"]){var zn=safe_decode_range(nn["!ref"]);un.e.c=Math.max(un.e.c,zn.e.c),un.e.r=Math.max(un.e.r,zn.e.r),ln==-1&&(ln=zn.e.r+1,un.e.r=ln+f.length-1+Pi)}else ln==-1&&(ln=0,un.e.r=f.length-1+Pi);var Xn=Ke.header||[],Un=0,qn=[];f.forEach(function(vs,ea){Qe&&!nn["!data"][ln+ea+Pi]&&(nn["!data"][ln+ea+Pi]=[]),Qe&&(qn=nn["!data"][ln+ea+Pi]),keys(vs).forEach(function(na){(Un=Xn.indexOf(na))==-1&&(Xn[Un=Xn.length]=na);var ta=vs[na],ra="z",oa="",fa=Qe?"":encode_col(cn+Un)+encode_row(ln+ea+Pi),ca=Qe?qn[cn+Un]:nn[fa];ta&&typeof ta=="object"&&!(ta instanceof Date)?Qe?qn[cn+Un]=ta:nn[fa]=ta:(typeof ta=="number"?ra="n":typeof ta=="boolean"?ra="b":typeof ta=="string"?ra="s":ta instanceof Date?(ra="d",Ke.UTC||(ta=local_to_utc(ta)),Ke.cellDates||(ra="n",ta=datenum(ta)),oa=ca!=null&&ca.z&&fmt_is_date(ca.z)?ca.z:Ke.dateNF||table_fmt[14]):ta===null&&Ke.nullError&&(ra="e",ta=0),ca?(ca.t=ra,ca.v=ta,delete ca.w,delete ca.R,oa&&(ca.z=oa)):Qe?qn[cn+Un]=ca={t:ra,v:ta}:nn[fa]=ca={t:ra,v:ta},oa&&(ca.z=oa))})}),un.e.c=Math.max(un.e.c,cn+Xn.length-1);var ys=encode_row(ln);if(Qe&&!nn["!data"][ln]&&(nn["!data"][ln]=[]),Pi)for(Un=0;Un<Xn.length;++Un)Qe?nn["!data"][ln][Un+cn]={t:"s",v:Xn[Un]}:nn[encode_col(Un+cn)+ys]={t:"s",v:Xn[Un]};return nn["!ref"]=encode_range(un),nn}function json_to_sheet(qe,f){return sheet_add_json(null,qe,f)}function ws_get_cell_stub(qe,f,ze){if(typeof f=="string"){if(qe["!data"]!=null){var Ke=decode_cell(f);return qe["!data"][Ke.r]||(qe["!data"][Ke.r]=[]),qe["!data"][Ke.r][Ke.c]||(qe["!data"][Ke.r][Ke.c]={t:"z"})}return qe[f]||(qe[f]={t:"z"})}return typeof f!="number"?ws_get_cell_stub(qe,encode_cell(f)):ws_get_cell_stub(qe,encode_col(ze||0)+encode_row(f))}function wb_sheet_idx(qe,f){if(typeof f=="number"){if(f>=0&&qe.SheetNames.length>f)return f;throw new Error("Cannot find sheet # "+f)}else if(typeof f=="string"){var ze=qe.SheetNames.indexOf(f);if(ze>-1)return ze;throw new Error("Cannot find sheet name |"+f+"|")}else throw new Error("Cannot find sheet |"+f+"|")}function book_new(qe,f){var ze={SheetNames:[],Sheets:{}};return qe&&book_append_sheet(ze,qe,f||"Sheet1"),ze}function book_append_sheet(qe,f,ze,Ke){var Qe=1;if(!ze)for(;Qe<=65535&&qe.SheetNames.indexOf(ze="Sheet"+Qe)!=-1;++Qe,ze=void 0);if(!ze||qe.SheetNames.length>=65535)throw new Error("Too many worksheets");if(Ke&&qe.SheetNames.indexOf(ze)>=0&&ze.length<32){var Pi=ze.match(/\d+$/);Qe=Pi&&+Pi[0]||0;var nn=Pi&&ze.slice(0,Pi.index)||ze;for(++Qe;Qe<=65535&&qe.SheetNames.indexOf(ze=nn+Qe)!=-1;++Qe);}if(check_ws_name(ze),qe.SheetNames.indexOf(ze)>=0)throw new Error("Worksheet with name |"+ze+"| already exists!");return qe.SheetNames.push(ze),qe.Sheets[ze]=f,ze}function book_set_sheet_visibility(qe,f,ze){qe.Workbook||(qe.Workbook={}),qe.Workbook.Sheets||(qe.Workbook.Sheets=[]);var Ke=wb_sheet_idx(qe,f);switch(qe.Workbook.Sheets[Ke]||(qe.Workbook.Sheets[Ke]={}),ze){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+ze)}qe.Workbook.Sheets[Ke].Hidden=ze}function cell_set_number_format(qe,f){return qe.z=f,qe}function cell_set_hyperlink(qe,f,ze){return f?(qe.l={Target:f},ze&&(qe.l.Tooltip=ze)):delete qe.l,qe}function cell_set_internal_link(qe,f,ze){return cell_set_hyperlink(qe,"#"+f,ze)}function cell_add_comment(qe,f,ze){qe.c||(qe.c=[]),qe.c.push({t:f,a:ze||"SheetJS"})}function sheet_set_array_formula(qe,f,ze,Ke){for(var Qe=typeof f!="string"?f:safe_decode_range(f),Pi=typeof f=="string"?f:encode_range(f),nn=Qe.s.r;nn<=Qe.e.r;++nn)for(var ln=Qe.s.c;ln<=Qe.e.c;++ln){var cn=ws_get_cell_stub(qe,nn,ln);cn.t="n",cn.F=Pi,delete cn.v,nn==Qe.s.r&&ln==Qe.s.c&&(cn.f=ze,Ke&&(cn.D=!0))}var hn=decode_range(qe["!ref"]);return hn.s.r>Qe.s.r&&(hn.s.r=Qe.s.r),hn.s.c>Qe.s.c&&(hn.s.c=Qe.s.c),hn.e.r<Qe.e.r&&(hn.e.r=Qe.e.r),hn.e.c<Qe.e.c&&(hn.e.c=Qe.e.c),qe["!ref"]=encode_range(hn),qe}var utils$2={encode_col,encode_row,encode_cell,encode_range,decode_col,decode_row,split_cell,decode_cell,decode_range,format_cell,sheet_new,sheet_add_aoa,sheet_add_json,sheet_add_dom,aoa_to_sheet,json_to_sheet,table_to_sheet:parse_dom_table,table_to_book,sheet_to_csv,sheet_to_txt,sheet_to_json,sheet_to_html,sheet_to_formulae,sheet_to_row_object_array:sheet_to_json,sheet_get_cell:ws_get_cell_stub,book_new,book_append_sheet,book_set_sheet_visibility,cell_set_number_format,cell_set_hyperlink,cell_set_internal_link,cell_add_comment,sheet_set_array_formula,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}},dist={},hasRequiredDist;function requireDist(){return hasRequiredDist||(hasRequiredDist=1,(()=>{var qe={792:(Ke,Qe,Pi)=>{Pi.d(Qe,{Z:()=>cn});var nn=Pi(609),ln=Pi.n(nn)()(function(hn){return hn[1]});ln.push([Ke.id,':host{--divider-width: 1px;--divider-color: #fff;--divider-shadow: none;--default-handle-width: 50px;--default-handle-color: #fff;--default-handle-opacity: 1;--default-handle-shadow: none;--handle-position-start: 50%;position:relative;display:inline-block;overflow:hidden;line-height:0;direction:ltr}@media screen and (-webkit-min-device-pixel-ratio: 0)and (min-resolution: 0.001dpcm){:host{outline-offset:1px}}:host(:focus){outline:2px solid -webkit-focus-ring-color}::slotted(*){-webkit-user-drag:none;-khtml-user-drag:none;-moz-user-drag:none;-o-user-drag:none;user-drag:none;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.first{position:absolute;left:0;top:0;right:0;line-height:normal;font-size:100%;max-height:100%;height:100%;width:100%;--exposure: 50%;--keyboard-transition-time: 0ms;--default-transition-time: 0ms;--transition-time: var(--default-transition-time)}.first .first-overlay-container{position:relative;clip-path:inset(0 var(--exposure) 0 0);transition:clip-path var(--transition-time);height:100%}.first .first-overlay{overflow:hidden;height:100%}.first.focused{will-change:clip-path}.first.focused .first-overlay-container{will-change:clip-path}.second{position:relative}.handle-container{transform:translateX(50%);position:absolute;top:0;right:var(--exposure);height:100%;transition:right var(--transition-time),bottom var(--transition-time)}.focused .handle-container{will-change:right}.divider{position:absolute;height:100%;width:100%;left:0;top:0;display:flex;align-items:center;justify-content:center;flex-direction:column}.divider:after{content:" ";display:block;height:100%;border-left-width:var(--divider-width);border-left-style:solid;border-left-color:var(--divider-color);box-shadow:var(--divider-shadow)}.handle{position:absolute;top:var(--handle-position-start);pointer-events:none;box-sizing:border-box;margin-left:1px;transform:translate(calc(-50% - 0.5px), -50%);line-height:0}.default-handle{width:var(--default-handle-width);opacity:var(--default-handle-opacity);transition:all 1s;filter:drop-shadow(var(--default-handle-shadow))}.default-handle path{stroke:var(--default-handle-color)}.vertical .first-overlay-container{clip-path:inset(0 0 var(--exposure) 0)}.vertical .handle-container{transform:translateY(50%);height:auto;top:unset;bottom:var(--exposure);width:100%;left:0;flex-direction:row}.vertical .divider:after{height:1px;width:100%;border-top-width:var(--divider-width);border-top-style:solid;border-top-color:var(--divider-color);border-left:0}.vertical .handle{top:auto;left:var(--handle-position-start);transform:translate(calc(-50% - 0.5px), -50%) rotate(90deg)}',""]);const cn=ln},609:Ke=>{Ke.exports=function(Qe){var Pi=[];return Pi.toString=function(){return this.map(function(nn){var ln=Qe(nn);return nn[2]?"@media ".concat(nn[2]," {").concat(ln,"}"):ln}).join("")},Pi.i=function(nn,ln,cn){typeof nn=="string"&&(nn=[[null,nn,""]]);var hn={};if(cn)for(var un=0;un<this.length;un++){var zn=this[un][0];zn!=null&&(hn[zn]=!0)}for(var Xn=0;Xn<nn.length;Xn++){var Un=[].concat(nn[Xn]);cn&&hn[Un[0]]||(ln&&(Un[2]?Un[2]="".concat(ln," and ").concat(Un[2]):Un[2]=ln),Pi.push(Un))}},Pi}}},f={};function ze(Ke){var Qe=f[Ke];if(Qe!==void 0)return Qe.exports;var Pi=f[Ke]={id:Ke,exports:{}};return qe[Ke](Pi,Pi.exports,ze),Pi.exports}ze.n=Ke=>{var Qe=Ke&&Ke.__esModule?()=>Ke.default:()=>Ke;return ze.d(Qe,{a:Qe}),Qe},ze.d=(Ke,Qe)=>{for(var Pi in Qe)ze.o(Qe,Pi)&&!ze.o(Ke,Pi)&&Object.defineProperty(Ke,Pi,{enumerable:!0,get:Qe[Pi]})},ze.o=(Ke,Qe)=>Object.prototype.hasOwnProperty.call(Ke,Qe),(()=>{var Ke=ze(792);const Qe="rendered",Pi=(Xn,Un)=>{const qn=Xn.getBoundingClientRect();let ys,vs;return Un.type==="mousedown"?(ys=Un.clientX,vs=Un.clientY):(ys=Un.touches[0].clientX,vs=Un.touches[0].clientY),ys>=qn.x&&ys<=qn.x+qn.width&&vs>=qn.y&&vs<=qn.y+qn.height};let nn;const ln={ArrowLeft:-1,ArrowRight:1},cn=["horizontal","vertical"],hn=Xn=>({x:Xn.touches[0].pageX,y:Xn.touches[0].pageY}),un=Xn=>({x:Xn.pageX,y:Xn.pageY}),zn=typeof window<"u"&&(window==null?void 0:window.HTMLElement);typeof window<"u"&&(window.document&&(nn=document.createElement("template"),nn.innerHTML='<div class="second" id="second"> <slot name="second"><slot name="before"></slot></slot> </div> <div class="first" id="first"> <div class="first-overlay"> <div class="first-overlay-container" id="firstImageContainer"> <slot name="first"><slot name="after"></slot></slot> </div> </div> <div class="handle-container"> <div class="divider"></div> <div class="handle" id="handle"> <slot name="handle"> <svg xmlns="http://www.w3.org/2000/svg" class="default-handle" viewBox="-8 -3 16 6"> <path d="M -5 -2 L -7 0 L -5 2 M 5 -2 L 7 0 L 5 2" fill="none" vector-effect="non-scaling-stroke"/> </svg> </slot> </div> </div> </div> '),window.customElements.define("img-comparison-slider",class extends zn{constructor(){super(),this.exposure=this.hasAttribute("value")?parseFloat(this.getAttribute("value")):50,this.slideOnHover=!1,this.slideDirection="horizontal",this.keyboard="enabled",this.isMouseDown=!1,this.animationDirection=0,this.isFocused=!1,this.dragByHandle=!1,this.onMouseMove=qn=>{if(this.isMouseDown||this.slideOnHover){const ys=un(qn);this.slideToPage(ys)}},this.bodyUserSelectStyle="",this.bodyWebkitUserSelectStyle="",this.onMouseDown=qn=>{if(this.slideOnHover||this.handle&&!Pi(this.handleElement,qn))return;qn.preventDefault(),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp),this.isMouseDown=!0,this.enableTransition();const ys=un(qn);this.slideToPage(ys),this.focus(),this.bodyUserSelectStyle=window.document.body.style.userSelect,this.bodyWebkitUserSelectStyle=window.document.body.style.webkitUserSelect,window.document.body.style.userSelect="none",window.document.body.style.webkitUserSelect="none"},this.onWindowMouseUp=()=>{this.isMouseDown=!1,window.document.body.style.userSelect=this.bodyUserSelectStyle,window.document.body.style.webkitUserSelect=this.bodyWebkitUserSelectStyle,window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp)},this.touchStartPoint=null,this.isTouchComparing=!1,this.hasTouchMoved=!1,this.onTouchStart=qn=>{this.dragByHandle&&!Pi(this.handleElement,qn)||(this.touchStartPoint=hn(qn),this.isFocused&&(this.enableTransition(),this.slideToPage(this.touchStartPoint)))},this.onTouchMove=qn=>{if(this.touchStartPoint===null)return;const ys=hn(qn);if(this.isTouchComparing)return this.slideToPage(ys),qn.preventDefault(),!1;if(!this.hasTouchMoved){const vs=Math.abs(ys.y-this.touchStartPoint.y),ea=Math.abs(ys.x-this.touchStartPoint.x);if(this.slideDirection==="horizontal"&&vs<ea||this.slideDirection==="vertical"&&vs>ea)return this.isTouchComparing=!0,this.focus(),this.slideToPage(ys),qn.preventDefault(),!1;this.hasTouchMoved=!0}},this.onTouchEnd=()=>{this.isTouchComparing=!1,this.hasTouchMoved=!1,this.touchStartPoint=null},this.onBlur=()=>{this.stopSlideAnimation(),this.isFocused=!1,this.firstElement.classList.remove("focused")},this.onFocus=()=>{this.isFocused=!0,this.firstElement.classList.add("focused")},this.onKeyDown=qn=>{if(this.keyboard==="disabled")return;const ys=ln[qn.key];this.animationDirection!==ys&&ys!==void 0&&(this.animationDirection=ys,this.startSlideAnimation())},this.onKeyUp=qn=>{if(this.keyboard==="disabled")return;const ys=ln[qn.key];ys!==void 0&&this.animationDirection===ys&&this.stopSlideAnimation()},this.resetDimensions=()=>{this.imageWidth=this.offsetWidth,this.imageHeight=this.offsetHeight};const Xn=this.attachShadow({mode:"open"}),Un=document.createElement("style");Un.innerHTML=Ke.Z,this.getAttribute("nonce")&&Un.setAttribute("nonce",this.getAttribute("nonce")),Xn.appendChild(Un),Xn.appendChild(nn.content.cloneNode(!0)),this.firstElement=Xn.getElementById("first"),this.handleElement=Xn.getElementById("handle")}set handle(Xn){this.dragByHandle=Xn.toString().toLowerCase()!=="false"}get handle(){return this.dragByHandle}get value(){return this.exposure}set value(Xn){const Un=parseFloat(Xn);Un!==this.exposure&&(this.exposure=Un,this.enableTransition(),this.setExposure())}get hover(){return this.slideOnHover}set hover(Xn){this.slideOnHover=Xn.toString().toLowerCase()!=="false",this.removeEventListener("mousemove",this.onMouseMove),this.slideOnHover&&this.addEventListener("mousemove",this.onMouseMove)}get direction(){return this.slideDirection}set direction(Xn){this.slideDirection=Xn.toString().toLowerCase(),this.slide(0),this.firstElement.classList.remove(...cn),cn.includes(this.slideDirection)&&this.firstElement.classList.add(this.slideDirection)}static get observedAttributes(){return["hover","direction"]}connectedCallback(){this.hasAttribute("tabindex")||(this.tabIndex=0),this.addEventListener("dragstart",Xn=>(Xn.preventDefault(),!1)),new ResizeObserver(this.resetDimensions).observe(this),this.setExposure(0),this.keyboard=this.hasAttribute("keyboard")&&this.getAttribute("keyboard")==="disabled"?"disabled":"enabled",this.addEventListener("keydown",this.onKeyDown),this.addEventListener("keyup",this.onKeyUp),this.addEventListener("focus",this.onFocus),this.addEventListener("blur",this.onBlur),this.addEventListener("touchstart",this.onTouchStart,{passive:!0}),this.addEventListener("touchmove",this.onTouchMove,{passive:!1}),this.addEventListener("touchend",this.onTouchEnd),this.addEventListener("mousedown",this.onMouseDown),this.handle=this.hasAttribute("handle")?this.getAttribute("handle"):this.dragByHandle,this.hover=this.hasAttribute("hover")?this.getAttribute("hover"):this.slideOnHover,this.direction=this.hasAttribute("direction")?this.getAttribute("direction"):this.slideDirection,this.resetDimensions(),this.classList.contains(Qe)||this.classList.add(Qe)}disconnectedCallback(){this.transitionTimer&&window.clearTimeout(this.transitionTimer)}attributeChangedCallback(Xn,Un,qn){Xn==="hover"&&(this.hover=qn),Xn==="direction"&&(this.direction=qn),Xn==="keyboard"&&(this.keyboard=qn==="disabled"?"disabled":"enabled")}setExposure(Xn=0){var Un;this.exposure=(Un=this.exposure+Xn)<0?0:Un>100?100:Un,this.firstElement.style.setProperty("--exposure",100-this.exposure+"%")}slide(Xn=0){this.setExposure(Xn);const Un=new Event("slide");this.dispatchEvent(Un)}slideToPage(Xn){this.slideDirection==="horizontal"&&this.slideToPageX(Xn.x),this.slideDirection==="vertical"&&this.slideToPageY(Xn.y)}slideToPageX(Xn){const Un=Xn-this.getBoundingClientRect().left-window.scrollX;this.exposure=Un/this.imageWidth*100,this.slide(0)}slideToPageY(Xn){const Un=Xn-this.getBoundingClientRect().top-window.scrollY;this.exposure=Un/this.imageHeight*100,this.slide(0)}enableTransition(){this.firstElement.style.setProperty("--transition-time","100ms"),this.transitionTimer=window.setTimeout(()=>{this.firstElement.style.setProperty("--transition-time","var(--default-transition-time)"),this.transitionTimer=null},100)}startSlideAnimation(){let Xn=null,Un=this.animationDirection;this.firstElement.style.setProperty("--transition-time","var(--keyboard-transition-time)");const qn=ys=>{if(this.animationDirection===0||Un!==this.animationDirection)return;Xn===null&&(Xn=ys);const vs=(ys-Xn)/16.666666666666668*this.animationDirection;this.slide(vs),setTimeout(()=>window.requestAnimationFrame(qn),0),Xn=ys};window.requestAnimationFrame(qn)}stopSlideAnimation(){this.animationDirection=0,this.firstElement.style.setProperty("--transition-time","var(--default-transition-time)")}}))})()})()),dist}requireDist();const ImgComparisonSlider=defineComponent({name:"ImgComparisonSlider",setup(qe,{slots:f}){return()=>h$1("img-comparison-slider",f.default())}}),bitMethods={getBit(qe){return this.data[getSlot(qe)]&1<<getShift(qe)?1:0},setBit(qe){this.data[getSlot(qe)]|=1<<getShift(qe)},clearBit(qe){this.data[getSlot(qe)]&=~(1<<getShift(qe))},toggleBit(qe){this.data[getSlot(qe)]^=1<<getShift(qe)},getBitXY(qe,f){return qe>=this.width||f>=this.height?0:this.getBit(f*this.width+qe)},setBitXY(qe,f){this.setBit(f*this.width+qe)},clearBitXY(qe,f){this.clearBit(f*this.width+qe)},toggleBitXY(qe,f){this.toggleBit(f*this.width+qe)}};function getSlot(qe){return qe>>3}function getShift(qe){return 7-(qe&7)}function setBitMethods(qe){for(const f in bitMethods)qe.prototype[f]=bitMethods[f]}function checkProcessable(qe,f={}){let{bitDepth:ze,alpha:Ke,colorModel:Qe,components:Pi,channels:nn}=f;if(typeof qe!="string"||qe.length===0)throw new TypeError("processName must be a string");if(ze&&(Array.isArray(ze)||(ze=[ze]),!ze.includes(this.bitDepth)))throw new TypeError(`The process: ${qe} can only be applied if bit depth is in: ${ze}`);if(Ke&&(Array.isArray(Ke)||(Ke=[Ke]),!Ke.includes(this.alpha)))throw new TypeError(`The process: ${qe} can only be applied if alpha is in: ${Ke}`);if(Qe&&(Array.isArray(Qe)||(Qe=[Qe]),!Qe.includes(this.colorModel)))throw new TypeError(`The process: ${qe} can only be applied if color model is in: ${Qe}`);if(Pi&&(Array.isArray(Pi)||(Pi=[Pi]),!Pi.includes(this.components))){let ln=`The process: ${qe} can only be applied if the number of components is in: ${Pi}`;throw Pi.length===1&&Pi[0]===1?new TypeError(`${ln}.\rYou should transform your image using "image.grey()" before applying the algorithm.`):new TypeError(ln)}if(nn&&(Array.isArray(nn)||(nn=[nn]),!nn.includes(this.channels)))throw new TypeError(`The process: ${qe} can only be applied if the number of channels is in: ${nn}`)}function createBlob(qe,f){qe=qe||[],f=f||{},typeof f=="string"&&(f={type:f});try{return new Blob(qe,f)}catch(Pi){if(Pi.name!=="TypeError")throw Pi;for(var ze=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,Ke=new ze,Qe=0;Qe<qe.length;Qe+=1)Ke.append(qe[Qe]);return Ke.getBlob(f.type)}}function dataURLToBlob(qe){var f=qe.match(/data:([^;]+)/)[1],ze=qe.replace(/^[^,]+,/,""),Ke=binaryStringToArrayBuffer(atob(ze));return createBlob([Ke],{type:f})}function canvasToBlob(qe,f,ze){return typeof qe.toBlob=="function"?new Promise(function(Ke){qe.toBlob(Ke,f,ze)}):Promise.resolve(dataURLToBlob(qe.toDataURL(f,ze)))}function binaryStringToArrayBuffer(qe){for(var f=qe.length,ze=new ArrayBuffer(f),Ke=new Uint8Array(ze),Qe=-1;++Qe<f;)Ke[Qe]=qe.charCodeAt(Qe);return ze}var src$5={};function decode$2(qe,f="utf8"){return new TextDecoder(f).decode(qe)}const encoder$1=new TextEncoder;function encode$3(qe){return encoder$1.encode(qe)}const defaultByteLength=1024*8,hostBigEndian=(()=>{const qe=new Uint8Array(4),f=new Uint32Array(qe.buffer);return!((f[0]=1)&qe[0])})(),typedArrays={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class IOBuffer{constructor(f=defaultByteLength,ze={}){hc(this,"buffer");hc(this,"byteLength");hc(this,"byteOffset");hc(this,"length");hc(this,"offset");hc(this,"lastWrittenByte");hc(this,"littleEndian");hc(this,"_data");hc(this,"_mark");hc(this,"_marks");let Ke=!1;typeof f=="number"?f=new ArrayBuffer(f):(Ke=!0,this.lastWrittenByte=f.byteLength);const Qe=ze.offset?ze.offset>>>0:0,Pi=f.byteLength-Qe;let nn=Qe;(ArrayBuffer.isView(f)||f instanceof IOBuffer)&&(f.byteLength!==f.buffer.byteLength&&(nn=f.byteOffset+Qe),f=f.buffer),Ke?this.lastWrittenByte=Pi:this.lastWrittenByte=0,this.buffer=f,this.length=Pi,this.byteLength=Pi,this.byteOffset=nn,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,nn,Pi),this._mark=0,this._marks=[]}available(f=1){return this.offset+f<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(f=1){return this.offset+=f,this}back(f=1){return this.offset-=f,this}seek(f){return this.offset=f,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const f=this._marks.pop();if(f===void 0)throw new Error("Mark stack empty");return this.seek(f),this}rewind(){return this.offset=0,this}ensureAvailable(f=1){if(!this.available(f)){const Ke=(this.offset+f)*2,Qe=new Uint8Array(Ke);Qe.set(new Uint8Array(this.buffer)),this.buffer=Qe.buffer,this.length=Ke,this.byteLength=Ke,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(f=1){return this.readArray(f,"uint8")}readArray(f,ze){const Ke=typedArrays[ze].BYTES_PER_ELEMENT*f,Qe=this.byteOffset+this.offset,Pi=this.buffer.slice(Qe,Qe+Ke);if(this.littleEndian===hostBigEndian&&ze!=="uint8"&&ze!=="int8"){const ln=new Uint8Array(this.buffer.slice(Qe,Qe+Ke));ln.reverse();const cn=new typedArrays[ze](ln.buffer);return this.offset+=Ke,cn.reverse(),cn}const nn=new typedArrays[ze](Pi);return this.offset+=Ke,nn}readInt16(){const f=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,f}readUint16(){const f=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,f}readInt32(){const f=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,f}readUint32(){const f=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,f}readFloat32(){const f=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,f}readFloat64(){const f=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,f}readBigInt64(){const f=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,f}readBigUint64(){const f=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,f}readChar(){return String.fromCharCode(this.readInt8())}readChars(f=1){let ze="";for(let Ke=0;Ke<f;Ke++)ze+=this.readChar();return ze}readUtf8(f=1){return decode$2(this.readBytes(f))}decodeText(f=1,ze="utf8"){return decode$2(this.readBytes(f),ze)}writeBoolean(f){return this.writeUint8(f?255:0),this}writeInt8(f){return this.ensureAvailable(1),this._data.setInt8(this.offset++,f),this._updateLastWrittenByte(),this}writeUint8(f){return this.ensureAvailable(1),this._data.setUint8(this.offset++,f),this._updateLastWrittenByte(),this}writeByte(f){return this.writeUint8(f)}writeBytes(f){this.ensureAvailable(f.length);for(let ze=0;ze<f.length;ze++)this._data.setUint8(this.offset++,f[ze]);return this._updateLastWrittenByte(),this}writeInt16(f){return this.ensureAvailable(2),this._data.setInt16(this.offset,f,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(f){return this.ensureAvailable(2),this._data.setUint16(this.offset,f,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(f){return this.ensureAvailable(4),this._data.setInt32(this.offset,f,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(f){return this.ensureAvailable(4),this._data.setUint32(this.offset,f,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(f){return this.ensureAvailable(4),this._data.setFloat32(this.offset,f,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(f){return this.ensureAvailable(8),this._data.setFloat64(this.offset,f,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(f){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,f,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(f){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,f,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(f){return this.writeUint8(f.charCodeAt(0))}writeChars(f){for(let ze=0;ze<f.length;ze++)this.writeUint8(f.charCodeAt(ze));return this}writeUtf8(f){return this.writeBytes(encode$3(f))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}const IOBuffer$1=Object.freeze(Object.defineProperty({__proto__:null,IOBuffer},Symbol.toStringTag,{value:"Module"})),require$$0$3=getAugmentedNamespace(IOBuffer$1);var constants,hasRequiredConstants;function requireConstants(){return hasRequiredConstants||(hasRequiredConstants=1,constants={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}}),constants}var BMPEncoder_1,hasRequiredBMPEncoder;function requireBMPEncoder(){if(hasRequiredBMPEncoder)return BMPEncoder_1;hasRequiredBMPEncoder=1;const{IOBuffer:qe}=require$$0$3,f=requireConstants(),ze=[];for(let Qe=0;Qe<=8;Qe++)ze.push(255<<Qe);class Ke extends qe{constructor(Pi){if(Pi.bitDepth!==1)throw new Error("Only bitDepth of 1 is supported");if(!Pi.height||!Pi.width)throw new Error("ImageData width and height are required");super(Pi.data),this.width=Pi.width,this.height=Pi.height,this.bitDepth=Pi.bitDepth,this.channels=Pi.channels,this.components=Pi.components}encode(){this.encoded=new qe,this.encoded.skip(14),this.writeBitmapV5Header(),this.writeColorTable();const Pi=this.encoded.offset;return this.writePixelArray(),this.encoded.rewind(),this.writeBitmapFileHeader(Pi),this.encoded.toArray()}writePixelArray(){let Pi=this.encoded;const nn=Math.floor((this.bitDepth*this.width+31)/32)*4,ln=Math.ceil(this.bitDepth*this.width/8),cn=nn-ln,hn=this.bitDepth*this.width%8,un=hn===0?0:8-hn,zn=nn*this.height;let Xn,Un,qn=0,ys=0,vs=8;Pi.mark(),Un=this.readUint8();for(let ea=this.height-1;ea>=0;ea--){const na=ea===0;Pi.reset(),Pi.skip(ea*nn);for(let ta=0;ta<ln;ta++){const ra=ta===ln-1;ys<=un&&ra?(Pi.writeByte(Un<<ys),(un===0||un===ys)&&!na&&(Xn=Un,Un=this.readByte())):ys===0?(Xn=Un,Un=this.readUint8(),Pi.writeByte(Xn)):(Xn=Un,Un=this.readUint8(),Pi.writeByte(Xn<<ys&ze[ys]|Un>>vs)),ra&&(qn+=hn||0,Pi.skip(cn),ys=qn%8,vs=8-ys)}}nn>ln&&(Pi.reset(),Pi.skip(zn-1),Pi.writeUint8(0))}writeColorTable(){this.encoded.writeUint32(0).writeUint32(16777215)}writeBitmapFileHeader(Pi){this.encoded.writeChars("BM").writeInt32(this.encoded.lastWrittenByte).writeUint16(0).writeUint16(0).writeUint32(Pi)}writeBitmapV5Header(){const nn=Math.floor((this.bitDepth*this.width+31)/32)*4*this.height;this.encoded.writeUint32(124).writeInt32(this.width).writeInt32(this.height).writeUint16(1).writeUint16(this.bitDepth).writeUint32(f.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(nn).writeInt32(0).writeInt32(0).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(f.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(f.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}}return BMPEncoder_1=Ke,BMPEncoder_1}var hasRequiredSrc$5;function requireSrc$5(){if(hasRequiredSrc$5)return src$5;hasRequiredSrc$5=1;const qe=requireBMPEncoder();return src$5.encode=function(ze){return new qe(ze).encode()},src$5}var srcExports$3=requireSrc$5();/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(qe){let f=qe.length;for(;--f>=0;)qe[f]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(qe,f,ze,Ke,Qe){this.static_tree=qe,this.extra_bits=f,this.extra_base=ze,this.elems=Ke,this.max_length=Qe,this.has_stree=qe&&qe.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(qe,f){this.dyn_tree=qe,this.max_code=0,this.stat_desc=f}const d_code=qe=>qe<256?_dist_code[qe]:_dist_code[256+(qe>>>7)],put_short=(qe,f)=>{qe.pending_buf[qe.pending++]=f&255,qe.pending_buf[qe.pending++]=f>>>8&255},send_bits=(qe,f,ze)=>{qe.bi_valid>Buf_size-ze?(qe.bi_buf|=f<<qe.bi_valid&65535,put_short(qe,qe.bi_buf),qe.bi_buf=f>>Buf_size-qe.bi_valid,qe.bi_valid+=ze-Buf_size):(qe.bi_buf|=f<<qe.bi_valid&65535,qe.bi_valid+=ze)},send_code=(qe,f,ze)=>{send_bits(qe,ze[f*2],ze[f*2+1])},bi_reverse=(qe,f)=>{let ze=0;do ze|=qe&1,qe>>>=1,ze<<=1;while(--f>0);return ze>>>1},bi_flush=qe=>{qe.bi_valid===16?(put_short(qe,qe.bi_buf),qe.bi_buf=0,qe.bi_valid=0):qe.bi_valid>=8&&(qe.pending_buf[qe.pending++]=qe.bi_buf&255,qe.bi_buf>>=8,qe.bi_valid-=8)},gen_bitlen=(qe,f)=>{const ze=f.dyn_tree,Ke=f.max_code,Qe=f.stat_desc.static_tree,Pi=f.stat_desc.has_stree,nn=f.stat_desc.extra_bits,ln=f.stat_desc.extra_base,cn=f.stat_desc.max_length;let hn,un,zn,Xn,Un,qn,ys=0;for(Xn=0;Xn<=MAX_BITS$1;Xn++)qe.bl_count[Xn]=0;for(ze[qe.heap[qe.heap_max]*2+1]=0,hn=qe.heap_max+1;hn<HEAP_SIZE$1;hn++)un=qe.heap[hn],Xn=ze[ze[un*2+1]*2+1]+1,Xn>cn&&(Xn=cn,ys++),ze[un*2+1]=Xn,!(un>Ke)&&(qe.bl_count[Xn]++,Un=0,un>=ln&&(Un=nn[un-ln]),qn=ze[un*2],qe.opt_len+=qn*(Xn+Un),Pi&&(qe.static_len+=qn*(Qe[un*2+1]+Un)));if(ys!==0){do{for(Xn=cn-1;qe.bl_count[Xn]===0;)Xn--;qe.bl_count[Xn]--,qe.bl_count[Xn+1]+=2,qe.bl_count[cn]--,ys-=2}while(ys>0);for(Xn=cn;Xn!==0;Xn--)for(un=qe.bl_count[Xn];un!==0;)zn=qe.heap[--hn],!(zn>Ke)&&(ze[zn*2+1]!==Xn&&(qe.opt_len+=(Xn-ze[zn*2+1])*ze[zn*2],ze[zn*2+1]=Xn),un--)}},gen_codes=(qe,f,ze)=>{const Ke=new Array(MAX_BITS$1+1);let Qe=0,Pi,nn;for(Pi=1;Pi<=MAX_BITS$1;Pi++)Qe=Qe+ze[Pi-1]<<1,Ke[Pi]=Qe;for(nn=0;nn<=f;nn++){let ln=qe[nn*2+1];ln!==0&&(qe[nn*2]=bi_reverse(Ke[ln]++,ln))}},tr_static_init=()=>{let qe,f,ze,Ke,Qe;const Pi=new Array(MAX_BITS$1+1);for(ze=0,Ke=0;Ke<LENGTH_CODES$1-1;Ke++)for(base_length[Ke]=ze,qe=0;qe<1<<extra_lbits[Ke];qe++)_length_code[ze++]=Ke;for(_length_code[ze-1]=Ke,Qe=0,Ke=0;Ke<16;Ke++)for(base_dist[Ke]=Qe,qe=0;qe<1<<extra_dbits[Ke];qe++)_dist_code[Qe++]=Ke;for(Qe>>=7;Ke<D_CODES$1;Ke++)for(base_dist[Ke]=Qe<<7,qe=0;qe<1<<extra_dbits[Ke]-7;qe++)_dist_code[256+Qe++]=Ke;for(f=0;f<=MAX_BITS$1;f++)Pi[f]=0;for(qe=0;qe<=143;)static_ltree[qe*2+1]=8,qe++,Pi[8]++;for(;qe<=255;)static_ltree[qe*2+1]=9,qe++,Pi[9]++;for(;qe<=279;)static_ltree[qe*2+1]=7,qe++,Pi[7]++;for(;qe<=287;)static_ltree[qe*2+1]=8,qe++,Pi[8]++;for(gen_codes(static_ltree,L_CODES$1+1,Pi),qe=0;qe<D_CODES$1;qe++)static_dtree[qe*2+1]=5,static_dtree[qe*2]=bi_reverse(qe,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=qe=>{let f;for(f=0;f<L_CODES$1;f++)qe.dyn_ltree[f*2]=0;for(f=0;f<D_CODES$1;f++)qe.dyn_dtree[f*2]=0;for(f=0;f<BL_CODES$1;f++)qe.bl_tree[f*2]=0;qe.dyn_ltree[END_BLOCK*2]=1,qe.opt_len=qe.static_len=0,qe.sym_next=qe.matches=0},bi_windup=qe=>{qe.bi_valid>8?put_short(qe,qe.bi_buf):qe.bi_valid>0&&(qe.pending_buf[qe.pending++]=qe.bi_buf),qe.bi_buf=0,qe.bi_valid=0},smaller=(qe,f,ze,Ke)=>{const Qe=f*2,Pi=ze*2;return qe[Qe]<qe[Pi]||qe[Qe]===qe[Pi]&&Ke[f]<=Ke[ze]},pqdownheap=(qe,f,ze)=>{const Ke=qe.heap[ze];let Qe=ze<<1;for(;Qe<=qe.heap_len&&(Qe<qe.heap_len&&smaller(f,qe.heap[Qe+1],qe.heap[Qe],qe.depth)&&Qe++,!smaller(f,Ke,qe.heap[Qe],qe.depth));)qe.heap[ze]=qe.heap[Qe],ze=Qe,Qe<<=1;qe.heap[ze]=Ke},compress_block=(qe,f,ze)=>{let Ke,Qe,Pi=0,nn,ln;if(qe.sym_next!==0)do Ke=qe.pending_buf[qe.sym_buf+Pi++]&255,Ke+=(qe.pending_buf[qe.sym_buf+Pi++]&255)<<8,Qe=qe.pending_buf[qe.sym_buf+Pi++],Ke===0?send_code(qe,Qe,f):(nn=_length_code[Qe],send_code(qe,nn+LITERALS$1+1,f),ln=extra_lbits[nn],ln!==0&&(Qe-=base_length[nn],send_bits(qe,Qe,ln)),Ke--,nn=d_code(Ke),send_code(qe,nn,ze),ln=extra_dbits[nn],ln!==0&&(Ke-=base_dist[nn],send_bits(qe,Ke,ln)));while(Pi<qe.sym_next);send_code(qe,END_BLOCK,f)},build_tree=(qe,f)=>{const ze=f.dyn_tree,Ke=f.stat_desc.static_tree,Qe=f.stat_desc.has_stree,Pi=f.stat_desc.elems;let nn,ln,cn=-1,hn;for(qe.heap_len=0,qe.heap_max=HEAP_SIZE$1,nn=0;nn<Pi;nn++)ze[nn*2]!==0?(qe.heap[++qe.heap_len]=cn=nn,qe.depth[nn]=0):ze[nn*2+1]=0;for(;qe.heap_len<2;)hn=qe.heap[++qe.heap_len]=cn<2?++cn:0,ze[hn*2]=1,qe.depth[hn]=0,qe.opt_len--,Qe&&(qe.static_len-=Ke[hn*2+1]);for(f.max_code=cn,nn=qe.heap_len>>1;nn>=1;nn--)pqdownheap(qe,ze,nn);hn=Pi;do nn=qe.heap[1],qe.heap[1]=qe.heap[qe.heap_len--],pqdownheap(qe,ze,1),ln=qe.heap[1],qe.heap[--qe.heap_max]=nn,qe.heap[--qe.heap_max]=ln,ze[hn*2]=ze[nn*2]+ze[ln*2],qe.depth[hn]=(qe.depth[nn]>=qe.depth[ln]?qe.depth[nn]:qe.depth[ln])+1,ze[nn*2+1]=ze[ln*2+1]=hn,qe.heap[1]=hn++,pqdownheap(qe,ze,1);while(qe.heap_len>=2);qe.heap[--qe.heap_max]=qe.heap[1],gen_bitlen(qe,f),gen_codes(ze,cn,qe.bl_count)},scan_tree=(qe,f,ze)=>{let Ke,Qe=-1,Pi,nn=f[0*2+1],ln=0,cn=7,hn=4;for(nn===0&&(cn=138,hn=3),f[(ze+1)*2+1]=65535,Ke=0;Ke<=ze;Ke++)Pi=nn,nn=f[(Ke+1)*2+1],!(++ln<cn&&Pi===nn)&&(ln<hn?qe.bl_tree[Pi*2]+=ln:Pi!==0?(Pi!==Qe&&qe.bl_tree[Pi*2]++,qe.bl_tree[REP_3_6*2]++):ln<=10?qe.bl_tree[REPZ_3_10*2]++:qe.bl_tree[REPZ_11_138*2]++,ln=0,Qe=Pi,nn===0?(cn=138,hn=3):Pi===nn?(cn=6,hn=3):(cn=7,hn=4))},send_tree=(qe,f,ze)=>{let Ke,Qe=-1,Pi,nn=f[0*2+1],ln=0,cn=7,hn=4;for(nn===0&&(cn=138,hn=3),Ke=0;Ke<=ze;Ke++)if(Pi=nn,nn=f[(Ke+1)*2+1],!(++ln<cn&&Pi===nn)){if(ln<hn)do send_code(qe,Pi,qe.bl_tree);while(--ln!==0);else Pi!==0?(Pi!==Qe&&(send_code(qe,Pi,qe.bl_tree),ln--),send_code(qe,REP_3_6,qe.bl_tree),send_bits(qe,ln-3,2)):ln<=10?(send_code(qe,REPZ_3_10,qe.bl_tree),send_bits(qe,ln-3,3)):(send_code(qe,REPZ_11_138,qe.bl_tree),send_bits(qe,ln-11,7));ln=0,Qe=Pi,nn===0?(cn=138,hn=3):Pi===nn?(cn=6,hn=3):(cn=7,hn=4)}},build_bl_tree=qe=>{let f;for(scan_tree(qe,qe.dyn_ltree,qe.l_desc.max_code),scan_tree(qe,qe.dyn_dtree,qe.d_desc.max_code),build_tree(qe,qe.bl_desc),f=BL_CODES$1-1;f>=3&&qe.bl_tree[bl_order[f]*2+1]===0;f--);return qe.opt_len+=3*(f+1)+5+5+4,f},send_all_trees=(qe,f,ze,Ke)=>{let Qe;for(send_bits(qe,f-257,5),send_bits(qe,ze-1,5),send_bits(qe,Ke-4,4),Qe=0;Qe<Ke;Qe++)send_bits(qe,qe.bl_tree[bl_order[Qe]*2+1],3);send_tree(qe,qe.dyn_ltree,f-1),send_tree(qe,qe.dyn_dtree,ze-1)},detect_data_type=qe=>{let f=4093624447,ze;for(ze=0;ze<=31;ze++,f>>>=1)if(f&1&&qe.dyn_ltree[ze*2]!==0)return Z_BINARY;if(qe.dyn_ltree[9*2]!==0||qe.dyn_ltree[10*2]!==0||qe.dyn_ltree[13*2]!==0)return Z_TEXT;for(ze=32;ze<LITERALS$1;ze++)if(qe.dyn_ltree[ze*2]!==0)return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=qe=>{static_init_done||(tr_static_init(),static_init_done=!0),qe.l_desc=new TreeDesc(qe.dyn_ltree,static_l_desc),qe.d_desc=new TreeDesc(qe.dyn_dtree,static_d_desc),qe.bl_desc=new TreeDesc(qe.bl_tree,static_bl_desc),qe.bi_buf=0,qe.bi_valid=0,init_block(qe)},_tr_stored_block$1=(qe,f,ze,Ke)=>{send_bits(qe,(STORED_BLOCK<<1)+(Ke?1:0),3),bi_windup(qe),put_short(qe,ze),put_short(qe,~ze),ze&&qe.pending_buf.set(qe.window.subarray(f,f+ze),qe.pending),qe.pending+=ze},_tr_align$1=qe=>{send_bits(qe,STATIC_TREES<<1,3),send_code(qe,END_BLOCK,static_ltree),bi_flush(qe)},_tr_flush_block$1=(qe,f,ze,Ke)=>{let Qe,Pi,nn=0;qe.level>0?(qe.strm.data_type===Z_UNKNOWN$1&&(qe.strm.data_type=detect_data_type(qe)),build_tree(qe,qe.l_desc),build_tree(qe,qe.d_desc),nn=build_bl_tree(qe),Qe=qe.opt_len+3+7>>>3,Pi=qe.static_len+3+7>>>3,Pi<=Qe&&(Qe=Pi)):Qe=Pi=ze+5,ze+4<=Qe&&f!==-1?_tr_stored_block$1(qe,f,ze,Ke):qe.strategy===Z_FIXED$1||Pi===Qe?(send_bits(qe,(STATIC_TREES<<1)+(Ke?1:0),3),compress_block(qe,static_ltree,static_dtree)):(send_bits(qe,(DYN_TREES<<1)+(Ke?1:0),3),send_all_trees(qe,qe.l_desc.max_code+1,qe.d_desc.max_code+1,nn+1),compress_block(qe,qe.dyn_ltree,qe.dyn_dtree)),init_block(qe),Ke&&bi_windup(qe)},_tr_tally$1=(qe,f,ze)=>(qe.pending_buf[qe.sym_buf+qe.sym_next++]=f,qe.pending_buf[qe.sym_buf+qe.sym_next++]=f>>8,qe.pending_buf[qe.sym_buf+qe.sym_next++]=ze,f===0?qe.dyn_ltree[ze*2]++:(qe.matches++,f--,qe.dyn_ltree[(_length_code[ze]+LITERALS$1+1)*2]++,qe.dyn_dtree[d_code(f)*2]++),qe.sym_next===qe.sym_end);var _tr_init_1=_tr_init$1,_tr_stored_block_1=_tr_stored_block$1,_tr_flush_block_1=_tr_flush_block$1,_tr_tally_1=_tr_tally$1,_tr_align_1=_tr_align$1,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};const adler32=(qe,f,ze,Ke)=>{let Qe=qe&65535|0,Pi=qe>>>16&65535|0,nn=0;for(;ze!==0;){nn=ze>2e3?2e3:ze,ze-=nn;do Qe=Qe+f[Ke++]|0,Pi=Pi+Qe|0;while(--nn);Qe%=65521,Pi%=65521}return Qe|Pi<<16|0};var adler32_1=adler32;const makeTable=()=>{let qe,f=[];for(var ze=0;ze<256;ze++){qe=ze;for(var Ke=0;Ke<8;Ke++)qe=qe&1?3988292384^qe>>>1:qe>>>1;f[ze]=qe}return f},crcTable$1=new Uint32Array(makeTable()),crc32=(qe,f,ze,Ke)=>{const Qe=crcTable$1,Pi=Ke+ze;qe^=-1;for(let nn=Ke;nn<Pi;nn++)qe=qe>>>8^Qe[(qe^f[nn])&255];return qe^-1};var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init,_tr_stored_block,_tr_flush_block,_tr_tally,_tr_align}=trees,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$2,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,GZIP_STATE=57,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(qe,f)=>(qe.msg=messages[f],f),rank=qe=>qe*2-(qe>4?9:0),zero=qe=>{let f=qe.length;for(;--f>=0;)qe[f]=0},slide_hash=qe=>{let f,ze,Ke,Qe=qe.w_size;f=qe.hash_size,Ke=f;do ze=qe.head[--Ke],qe.head[Ke]=ze>=Qe?ze-Qe:0;while(--f);f=Qe,Ke=f;do ze=qe.prev[--Ke],qe.prev[Ke]=ze>=Qe?ze-Qe:0;while(--f)};let HASH_ZLIB=(qe,f,ze)=>(f<<qe.hash_shift^ze)&qe.hash_mask,HASH=HASH_ZLIB;const flush_pending=qe=>{const f=qe.state;let ze=f.pending;ze>qe.avail_out&&(ze=qe.avail_out),ze!==0&&(qe.output.set(f.pending_buf.subarray(f.pending_out,f.pending_out+ze),qe.next_out),qe.next_out+=ze,f.pending_out+=ze,qe.total_out+=ze,qe.avail_out-=ze,f.pending-=ze,f.pending===0&&(f.pending_out=0))},flush_block_only=(qe,f)=>{_tr_flush_block(qe,qe.block_start>=0?qe.block_start:-1,qe.strstart-qe.block_start,f),qe.block_start=qe.strstart,flush_pending(qe.strm)},put_byte=(qe,f)=>{qe.pending_buf[qe.pending++]=f},putShortMSB=(qe,f)=>{qe.pending_buf[qe.pending++]=f>>>8&255,qe.pending_buf[qe.pending++]=f&255},read_buf=(qe,f,ze,Ke)=>{let Qe=qe.avail_in;return Qe>Ke&&(Qe=Ke),Qe===0?0:(qe.avail_in-=Qe,f.set(qe.input.subarray(qe.next_in,qe.next_in+Qe),ze),qe.state.wrap===1?qe.adler=adler32_1(qe.adler,f,Qe,ze):qe.state.wrap===2&&(qe.adler=crc32_1(qe.adler,f,Qe,ze)),qe.next_in+=Qe,qe.total_in+=Qe,Qe)},longest_match=(qe,f)=>{let ze=qe.max_chain_length,Ke=qe.strstart,Qe,Pi,nn=qe.prev_length,ln=qe.nice_match;const cn=qe.strstart>qe.w_size-MIN_LOOKAHEAD?qe.strstart-(qe.w_size-MIN_LOOKAHEAD):0,hn=qe.window,un=qe.w_mask,zn=qe.prev,Xn=qe.strstart+MAX_MATCH;let Un=hn[Ke+nn-1],qn=hn[Ke+nn];qe.prev_length>=qe.good_match&&(ze>>=2),ln>qe.lookahead&&(ln=qe.lookahead);do if(Qe=f,!(hn[Qe+nn]!==qn||hn[Qe+nn-1]!==Un||hn[Qe]!==hn[Ke]||hn[++Qe]!==hn[Ke+1])){Ke+=2,Qe++;do;while(hn[++Ke]===hn[++Qe]&&hn[++Ke]===hn[++Qe]&&hn[++Ke]===hn[++Qe]&&hn[++Ke]===hn[++Qe]&&hn[++Ke]===hn[++Qe]&&hn[++Ke]===hn[++Qe]&&hn[++Ke]===hn[++Qe]&&hn[++Ke]===hn[++Qe]&&Ke<Xn);if(Pi=MAX_MATCH-(Xn-Ke),Ke=Xn-MAX_MATCH,Pi>nn){if(qe.match_start=f,nn=Pi,Pi>=ln)break;Un=hn[Ke+nn-1],qn=hn[Ke+nn]}}while((f=zn[f&un])>cn&&--ze!==0);return nn<=qe.lookahead?nn:qe.lookahead},fill_window=qe=>{const f=qe.w_size;let ze,Ke,Qe;do{if(Ke=qe.window_size-qe.lookahead-qe.strstart,qe.strstart>=f+(f-MIN_LOOKAHEAD)&&(qe.window.set(qe.window.subarray(f,f+f-Ke),0),qe.match_start-=f,qe.strstart-=f,qe.block_start-=f,qe.insert>qe.strstart&&(qe.insert=qe.strstart),slide_hash(qe),Ke+=f),qe.strm.avail_in===0)break;if(ze=read_buf(qe.strm,qe.window,qe.strstart+qe.lookahead,Ke),qe.lookahead+=ze,qe.lookahead+qe.insert>=MIN_MATCH)for(Qe=qe.strstart-qe.insert,qe.ins_h=qe.window[Qe],qe.ins_h=HASH(qe,qe.ins_h,qe.window[Qe+1]);qe.insert&&(qe.ins_h=HASH(qe,qe.ins_h,qe.window[Qe+MIN_MATCH-1]),qe.prev[Qe&qe.w_mask]=qe.head[qe.ins_h],qe.head[qe.ins_h]=Qe,Qe++,qe.insert--,!(qe.lookahead+qe.insert<MIN_MATCH)););}while(qe.lookahead<MIN_LOOKAHEAD&&qe.strm.avail_in!==0)},deflate_stored=(qe,f)=>{let ze=qe.pending_buf_size-5>qe.w_size?qe.w_size:qe.pending_buf_size-5,Ke,Qe,Pi,nn=0,ln=qe.strm.avail_in;do{if(Ke=65535,Pi=qe.bi_valid+42>>3,qe.strm.avail_out<Pi||(Pi=qe.strm.avail_out-Pi,Qe=qe.strstart-qe.block_start,Ke>Qe+qe.strm.avail_in&&(Ke=Qe+qe.strm.avail_in),Ke>Pi&&(Ke=Pi),Ke<ze&&(Ke===0&&f!==Z_FINISH$3||f===Z_NO_FLUSH$2||Ke!==Qe+qe.strm.avail_in)))break;nn=f===Z_FINISH$3&&Ke===Qe+qe.strm.avail_in?1:0,_tr_stored_block(qe,0,0,nn),qe.pending_buf[qe.pending-4]=Ke,qe.pending_buf[qe.pending-3]=Ke>>8,qe.pending_buf[qe.pending-2]=~Ke,qe.pending_buf[qe.pending-1]=~Ke>>8,flush_pending(qe.strm),Qe&&(Qe>Ke&&(Qe=Ke),qe.strm.output.set(qe.window.subarray(qe.block_start,qe.block_start+Qe),qe.strm.next_out),qe.strm.next_out+=Qe,qe.strm.avail_out-=Qe,qe.strm.total_out+=Qe,qe.block_start+=Qe,Ke-=Qe),Ke&&(read_buf(qe.strm,qe.strm.output,qe.strm.next_out,Ke),qe.strm.next_out+=Ke,qe.strm.avail_out-=Ke,qe.strm.total_out+=Ke)}while(nn===0);return ln-=qe.strm.avail_in,ln&&(ln>=qe.w_size?(qe.matches=2,qe.window.set(qe.strm.input.subarray(qe.strm.next_in-qe.w_size,qe.strm.next_in),0),qe.strstart=qe.w_size,qe.insert=qe.strstart):(qe.window_size-qe.strstart<=ln&&(qe.strstart-=qe.w_size,qe.window.set(qe.window.subarray(qe.w_size,qe.w_size+qe.strstart),0),qe.matches<2&&qe.matches++,qe.insert>qe.strstart&&(qe.insert=qe.strstart)),qe.window.set(qe.strm.input.subarray(qe.strm.next_in-ln,qe.strm.next_in),qe.strstart),qe.strstart+=ln,qe.insert+=ln>qe.w_size-qe.insert?qe.w_size-qe.insert:ln),qe.block_start=qe.strstart),qe.high_water<qe.strstart&&(qe.high_water=qe.strstart),nn?BS_FINISH_DONE:f!==Z_NO_FLUSH$2&&f!==Z_FINISH$3&&qe.strm.avail_in===0&&qe.strstart===qe.block_start?BS_BLOCK_DONE:(Pi=qe.window_size-qe.strstart,qe.strm.avail_in>Pi&&qe.block_start>=qe.w_size&&(qe.block_start-=qe.w_size,qe.strstart-=qe.w_size,qe.window.set(qe.window.subarray(qe.w_size,qe.w_size+qe.strstart),0),qe.matches<2&&qe.matches++,Pi+=qe.w_size,qe.insert>qe.strstart&&(qe.insert=qe.strstart)),Pi>qe.strm.avail_in&&(Pi=qe.strm.avail_in),Pi&&(read_buf(qe.strm,qe.window,qe.strstart,Pi),qe.strstart+=Pi,qe.insert+=Pi>qe.w_size-qe.insert?qe.w_size-qe.insert:Pi),qe.high_water<qe.strstart&&(qe.high_water=qe.strstart),Pi=qe.bi_valid+42>>3,Pi=qe.pending_buf_size-Pi>65535?65535:qe.pending_buf_size-Pi,ze=Pi>qe.w_size?qe.w_size:Pi,Qe=qe.strstart-qe.block_start,(Qe>=ze||(Qe||f===Z_FINISH$3)&&f!==Z_NO_FLUSH$2&&qe.strm.avail_in===0&&Qe<=Pi)&&(Ke=Qe>Pi?Pi:Qe,nn=f===Z_FINISH$3&&qe.strm.avail_in===0&&Ke===Qe?1:0,_tr_stored_block(qe,qe.block_start,Ke,nn),qe.block_start+=Ke,flush_pending(qe.strm)),nn?BS_FINISH_STARTED:BS_NEED_MORE)},deflate_fast=(qe,f)=>{let ze,Ke;for(;;){if(qe.lookahead<MIN_LOOKAHEAD){if(fill_window(qe),qe.lookahead<MIN_LOOKAHEAD&&f===Z_NO_FLUSH$2)return BS_NEED_MORE;if(qe.lookahead===0)break}if(ze=0,qe.lookahead>=MIN_MATCH&&(qe.ins_h=HASH(qe,qe.ins_h,qe.window[qe.strstart+MIN_MATCH-1]),ze=qe.prev[qe.strstart&qe.w_mask]=qe.head[qe.ins_h],qe.head[qe.ins_h]=qe.strstart),ze!==0&&qe.strstart-ze<=qe.w_size-MIN_LOOKAHEAD&&(qe.match_length=longest_match(qe,ze)),qe.match_length>=MIN_MATCH)if(Ke=_tr_tally(qe,qe.strstart-qe.match_start,qe.match_length-MIN_MATCH),qe.lookahead-=qe.match_length,qe.match_length<=qe.max_lazy_match&&qe.lookahead>=MIN_MATCH){qe.match_length--;do qe.strstart++,qe.ins_h=HASH(qe,qe.ins_h,qe.window[qe.strstart+MIN_MATCH-1]),ze=qe.prev[qe.strstart&qe.w_mask]=qe.head[qe.ins_h],qe.head[qe.ins_h]=qe.strstart;while(--qe.match_length!==0);qe.strstart++}else qe.strstart+=qe.match_length,qe.match_length=0,qe.ins_h=qe.window[qe.strstart],qe.ins_h=HASH(qe,qe.ins_h,qe.window[qe.strstart+1]);else Ke=_tr_tally(qe,0,qe.window[qe.strstart]),qe.lookahead--,qe.strstart++;if(Ke&&(flush_block_only(qe,!1),qe.strm.avail_out===0))return BS_NEED_MORE}return qe.insert=qe.strstart<MIN_MATCH-1?qe.strstart:MIN_MATCH-1,f===Z_FINISH$3?(flush_block_only(qe,!0),qe.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):qe.sym_next&&(flush_block_only(qe,!1),qe.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(qe,f)=>{let ze,Ke,Qe;for(;;){if(qe.lookahead<MIN_LOOKAHEAD){if(fill_window(qe),qe.lookahead<MIN_LOOKAHEAD&&f===Z_NO_FLUSH$2)return BS_NEED_MORE;if(qe.lookahead===0)break}if(ze=0,qe.lookahead>=MIN_MATCH&&(qe.ins_h=HASH(qe,qe.ins_h,qe.window[qe.strstart+MIN_MATCH-1]),ze=qe.prev[qe.strstart&qe.w_mask]=qe.head[qe.ins_h],qe.head[qe.ins_h]=qe.strstart),qe.prev_length=qe.match_length,qe.prev_match=qe.match_start,qe.match_length=MIN_MATCH-1,ze!==0&&qe.prev_length<qe.max_lazy_match&&qe.strstart-ze<=qe.w_size-MIN_LOOKAHEAD&&(qe.match_length=longest_match(qe,ze),qe.match_length<=5&&(qe.strategy===Z_FILTERED||qe.match_length===MIN_MATCH&&qe.strstart-qe.match_start>4096)&&(qe.match_length=MIN_MATCH-1)),qe.prev_length>=MIN_MATCH&&qe.match_length<=qe.prev_length){Qe=qe.strstart+qe.lookahead-MIN_MATCH,Ke=_tr_tally(qe,qe.strstart-1-qe.prev_match,qe.prev_length-MIN_MATCH),qe.lookahead-=qe.prev_length-1,qe.prev_length-=2;do++qe.strstart<=Qe&&(qe.ins_h=HASH(qe,qe.ins_h,qe.window[qe.strstart+MIN_MATCH-1]),ze=qe.prev[qe.strstart&qe.w_mask]=qe.head[qe.ins_h],qe.head[qe.ins_h]=qe.strstart);while(--qe.prev_length!==0);if(qe.match_available=0,qe.match_length=MIN_MATCH-1,qe.strstart++,Ke&&(flush_block_only(qe,!1),qe.strm.avail_out===0))return BS_NEED_MORE}else if(qe.match_available){if(Ke=_tr_tally(qe,0,qe.window[qe.strstart-1]),Ke&&flush_block_only(qe,!1),qe.strstart++,qe.lookahead--,qe.strm.avail_out===0)return BS_NEED_MORE}else qe.match_available=1,qe.strstart++,qe.lookahead--}return qe.match_available&&(Ke=_tr_tally(qe,0,qe.window[qe.strstart-1]),qe.match_available=0),qe.insert=qe.strstart<MIN_MATCH-1?qe.strstart:MIN_MATCH-1,f===Z_FINISH$3?(flush_block_only(qe,!0),qe.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):qe.sym_next&&(flush_block_only(qe,!1),qe.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(qe,f)=>{let ze,Ke,Qe,Pi;const nn=qe.window;for(;;){if(qe.lookahead<=MAX_MATCH){if(fill_window(qe),qe.lookahead<=MAX_MATCH&&f===Z_NO_FLUSH$2)return BS_NEED_MORE;if(qe.lookahead===0)break}if(qe.match_length=0,qe.lookahead>=MIN_MATCH&&qe.strstart>0&&(Qe=qe.strstart-1,Ke=nn[Qe],Ke===nn[++Qe]&&Ke===nn[++Qe]&&Ke===nn[++Qe])){Pi=qe.strstart+MAX_MATCH;do;while(Ke===nn[++Qe]&&Ke===nn[++Qe]&&Ke===nn[++Qe]&&Ke===nn[++Qe]&&Ke===nn[++Qe]&&Ke===nn[++Qe]&&Ke===nn[++Qe]&&Ke===nn[++Qe]&&Qe<Pi);qe.match_length=MAX_MATCH-(Pi-Qe),qe.match_length>qe.lookahead&&(qe.match_length=qe.lookahead)}if(qe.match_length>=MIN_MATCH?(ze=_tr_tally(qe,1,qe.match_length-MIN_MATCH),qe.lookahead-=qe.match_length,qe.strstart+=qe.match_length,qe.match_length=0):(ze=_tr_tally(qe,0,qe.window[qe.strstart]),qe.lookahead--,qe.strstart++),ze&&(flush_block_only(qe,!1),qe.strm.avail_out===0))return BS_NEED_MORE}return qe.insert=0,f===Z_FINISH$3?(flush_block_only(qe,!0),qe.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):qe.sym_next&&(flush_block_only(qe,!1),qe.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(qe,f)=>{let ze;for(;;){if(qe.lookahead===0&&(fill_window(qe),qe.lookahead===0)){if(f===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(qe.match_length=0,ze=_tr_tally(qe,0,qe.window[qe.strstart]),qe.lookahead--,qe.strstart++,ze&&(flush_block_only(qe,!1),qe.strm.avail_out===0))return BS_NEED_MORE}return qe.insert=0,f===Z_FINISH$3?(flush_block_only(qe,!0),qe.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):qe.sym_next&&(flush_block_only(qe,!1),qe.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(qe,f,ze,Ke,Qe){this.good_length=qe,this.max_lazy=f,this.nice_length=ze,this.max_chain=Ke,this.func=Qe}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=qe=>{qe.window_size=2*qe.w_size,zero(qe.head),qe.max_lazy_match=configuration_table[qe.level].max_lazy,qe.good_match=configuration_table[qe.level].good_length,qe.nice_match=configuration_table[qe.level].nice_length,qe.max_chain_length=configuration_table[qe.level].max_chain,qe.strstart=0,qe.block_start=0,qe.lookahead=0,qe.insert=0,qe.match_length=qe.prev_length=MIN_MATCH-1,qe.match_available=0,qe.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE*2),this.dyn_dtree=new Uint16Array((2*D_CODES+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateStateCheck=qe=>{if(!qe)return 1;const f=qe.state;return!f||f.strm!==qe||f.status!==INIT_STATE&&f.status!==GZIP_STATE&&f.status!==EXTRA_STATE&&f.status!==NAME_STATE&&f.status!==COMMENT_STATE&&f.status!==HCRC_STATE&&f.status!==BUSY_STATE&&f.status!==FINISH_STATE?1:0},deflateResetKeep=qe=>{if(deflateStateCheck(qe))return err(qe,Z_STREAM_ERROR$2);qe.total_in=qe.total_out=0,qe.data_type=Z_UNKNOWN;const f=qe.state;return f.pending=0,f.pending_out=0,f.wrap<0&&(f.wrap=-f.wrap),f.status=f.wrap===2?GZIP_STATE:f.wrap?INIT_STATE:BUSY_STATE,qe.adler=f.wrap===2?0:1,f.last_flush=-2,_tr_init(f),Z_OK$3},deflateReset=qe=>{const f=deflateResetKeep(qe);return f===Z_OK$3&&lm_init(qe.state),f},deflateSetHeader=(qe,f)=>deflateStateCheck(qe)||qe.state.wrap!==2?Z_STREAM_ERROR$2:(qe.state.gzhead=f,Z_OK$3),deflateInit2=(qe,f,ze,Ke,Qe,Pi)=>{if(!qe)return Z_STREAM_ERROR$2;let nn=1;if(f===Z_DEFAULT_COMPRESSION$1&&(f=6),Ke<0?(nn=0,Ke=-Ke):Ke>15&&(nn=2,Ke-=16),Qe<1||Qe>MAX_MEM_LEVEL||ze!==Z_DEFLATED$2||Ke<8||Ke>15||f<0||f>9||Pi<0||Pi>Z_FIXED||Ke===8&&nn!==1)return err(qe,Z_STREAM_ERROR$2);Ke===8&&(Ke=9);const ln=new DeflateState;return qe.state=ln,ln.strm=qe,ln.status=INIT_STATE,ln.wrap=nn,ln.gzhead=null,ln.w_bits=Ke,ln.w_size=1<<ln.w_bits,ln.w_mask=ln.w_size-1,ln.hash_bits=Qe+7,ln.hash_size=1<<ln.hash_bits,ln.hash_mask=ln.hash_size-1,ln.hash_shift=~~((ln.hash_bits+MIN_MATCH-1)/MIN_MATCH),ln.window=new Uint8Array(ln.w_size*2),ln.head=new Uint16Array(ln.hash_size),ln.prev=new Uint16Array(ln.w_size),ln.lit_bufsize=1<<Qe+6,ln.pending_buf_size=ln.lit_bufsize*4,ln.pending_buf=new Uint8Array(ln.pending_buf_size),ln.sym_buf=ln.lit_bufsize,ln.sym_end=(ln.lit_bufsize-1)*3,ln.level=f,ln.strategy=Pi,ln.method=ze,deflateReset(qe)},deflateInit=(qe,f)=>deflateInit2(qe,f,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(qe,f)=>{if(deflateStateCheck(qe)||f>Z_BLOCK$1||f<0)return qe?err(qe,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const ze=qe.state;if(!qe.output||qe.avail_in!==0&&!qe.input||ze.status===FINISH_STATE&&f!==Z_FINISH$3)return err(qe,qe.avail_out===0?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);const Ke=ze.last_flush;if(ze.last_flush=f,ze.pending!==0){if(flush_pending(qe),qe.avail_out===0)return ze.last_flush=-1,Z_OK$3}else if(qe.avail_in===0&&rank(f)<=rank(Ke)&&f!==Z_FINISH$3)return err(qe,Z_BUF_ERROR$1);if(ze.status===FINISH_STATE&&qe.avail_in!==0)return err(qe,Z_BUF_ERROR$1);if(ze.status===INIT_STATE&&ze.wrap===0&&(ze.status=BUSY_STATE),ze.status===INIT_STATE){let Qe=Z_DEFLATED$2+(ze.w_bits-8<<4)<<8,Pi=-1;if(ze.strategy>=Z_HUFFMAN_ONLY||ze.level<2?Pi=0:ze.level<6?Pi=1:ze.level===6?Pi=2:Pi=3,Qe|=Pi<<6,ze.strstart!==0&&(Qe|=PRESET_DICT),Qe+=31-Qe%31,putShortMSB(ze,Qe),ze.strstart!==0&&(putShortMSB(ze,qe.adler>>>16),putShortMSB(ze,qe.adler&65535)),qe.adler=1,ze.status=BUSY_STATE,flush_pending(qe),ze.pending!==0)return ze.last_flush=-1,Z_OK$3}if(ze.status===GZIP_STATE){if(qe.adler=0,put_byte(ze,31),put_byte(ze,139),put_byte(ze,8),ze.gzhead)put_byte(ze,(ze.gzhead.text?1:0)+(ze.gzhead.hcrc?2:0)+(ze.gzhead.extra?4:0)+(ze.gzhead.name?8:0)+(ze.gzhead.comment?16:0)),put_byte(ze,ze.gzhead.time&255),put_byte(ze,ze.gzhead.time>>8&255),put_byte(ze,ze.gzhead.time>>16&255),put_byte(ze,ze.gzhead.time>>24&255),put_byte(ze,ze.level===9?2:ze.strategy>=Z_HUFFMAN_ONLY||ze.level<2?4:0),put_byte(ze,ze.gzhead.os&255),ze.gzhead.extra&&ze.gzhead.extra.length&&(put_byte(ze,ze.gzhead.extra.length&255),put_byte(ze,ze.gzhead.extra.length>>8&255)),ze.gzhead.hcrc&&(qe.adler=crc32_1(qe.adler,ze.pending_buf,ze.pending,0)),ze.gzindex=0,ze.status=EXTRA_STATE;else if(put_byte(ze,0),put_byte(ze,0),put_byte(ze,0),put_byte(ze,0),put_byte(ze,0),put_byte(ze,ze.level===9?2:ze.strategy>=Z_HUFFMAN_ONLY||ze.level<2?4:0),put_byte(ze,OS_CODE),ze.status=BUSY_STATE,flush_pending(qe),ze.pending!==0)return ze.last_flush=-1,Z_OK$3}if(ze.status===EXTRA_STATE){if(ze.gzhead.extra){let Qe=ze.pending,Pi=(ze.gzhead.extra.length&65535)-ze.gzindex;for(;ze.pending+Pi>ze.pending_buf_size;){let ln=ze.pending_buf_size-ze.pending;if(ze.pending_buf.set(ze.gzhead.extra.subarray(ze.gzindex,ze.gzindex+ln),ze.pending),ze.pending=ze.pending_buf_size,ze.gzhead.hcrc&&ze.pending>Qe&&(qe.adler=crc32_1(qe.adler,ze.pending_buf,ze.pending-Qe,Qe)),ze.gzindex+=ln,flush_pending(qe),ze.pending!==0)return ze.last_flush=-1,Z_OK$3;Qe=0,Pi-=ln}let nn=new Uint8Array(ze.gzhead.extra);ze.pending_buf.set(nn.subarray(ze.gzindex,ze.gzindex+Pi),ze.pending),ze.pending+=Pi,ze.gzhead.hcrc&&ze.pending>Qe&&(qe.adler=crc32_1(qe.adler,ze.pending_buf,ze.pending-Qe,Qe)),ze.gzindex=0}ze.status=NAME_STATE}if(ze.status===NAME_STATE){if(ze.gzhead.name){let Qe=ze.pending,Pi;do{if(ze.pending===ze.pending_buf_size){if(ze.gzhead.hcrc&&ze.pending>Qe&&(qe.adler=crc32_1(qe.adler,ze.pending_buf,ze.pending-Qe,Qe)),flush_pending(qe),ze.pending!==0)return ze.last_flush=-1,Z_OK$3;Qe=0}ze.gzindex<ze.gzhead.name.length?Pi=ze.gzhead.name.charCodeAt(ze.gzindex++)&255:Pi=0,put_byte(ze,Pi)}while(Pi!==0);ze.gzhead.hcrc&&ze.pending>Qe&&(qe.adler=crc32_1(qe.adler,ze.pending_buf,ze.pending-Qe,Qe)),ze.gzindex=0}ze.status=COMMENT_STATE}if(ze.status===COMMENT_STATE){if(ze.gzhead.comment){let Qe=ze.pending,Pi;do{if(ze.pending===ze.pending_buf_size){if(ze.gzhead.hcrc&&ze.pending>Qe&&(qe.adler=crc32_1(qe.adler,ze.pending_buf,ze.pending-Qe,Qe)),flush_pending(qe),ze.pending!==0)return ze.last_flush=-1,Z_OK$3;Qe=0}ze.gzindex<ze.gzhead.comment.length?Pi=ze.gzhead.comment.charCodeAt(ze.gzindex++)&255:Pi=0,put_byte(ze,Pi)}while(Pi!==0);ze.gzhead.hcrc&&ze.pending>Qe&&(qe.adler=crc32_1(qe.adler,ze.pending_buf,ze.pending-Qe,Qe))}ze.status=HCRC_STATE}if(ze.status===HCRC_STATE){if(ze.gzhead.hcrc){if(ze.pending+2>ze.pending_buf_size&&(flush_pending(qe),ze.pending!==0))return ze.last_flush=-1,Z_OK$3;put_byte(ze,qe.adler&255),put_byte(ze,qe.adler>>8&255),qe.adler=0}if(ze.status=BUSY_STATE,flush_pending(qe),ze.pending!==0)return ze.last_flush=-1,Z_OK$3}if(qe.avail_in!==0||ze.lookahead!==0||f!==Z_NO_FLUSH$2&&ze.status!==FINISH_STATE){let Qe=ze.level===0?deflate_stored(ze,f):ze.strategy===Z_HUFFMAN_ONLY?deflate_huff(ze,f):ze.strategy===Z_RLE?deflate_rle(ze,f):configuration_table[ze.level].func(ze,f);if((Qe===BS_FINISH_STARTED||Qe===BS_FINISH_DONE)&&(ze.status=FINISH_STATE),Qe===BS_NEED_MORE||Qe===BS_FINISH_STARTED)return qe.avail_out===0&&(ze.last_flush=-1),Z_OK$3;if(Qe===BS_BLOCK_DONE&&(f===Z_PARTIAL_FLUSH?_tr_align(ze):f!==Z_BLOCK$1&&(_tr_stored_block(ze,0,0,!1),f===Z_FULL_FLUSH$1&&(zero(ze.head),ze.lookahead===0&&(ze.strstart=0,ze.block_start=0,ze.insert=0))),flush_pending(qe),qe.avail_out===0))return ze.last_flush=-1,Z_OK$3}return f!==Z_FINISH$3?Z_OK$3:ze.wrap<=0?Z_STREAM_END$3:(ze.wrap===2?(put_byte(ze,qe.adler&255),put_byte(ze,qe.adler>>8&255),put_byte(ze,qe.adler>>16&255),put_byte(ze,qe.adler>>24&255),put_byte(ze,qe.total_in&255),put_byte(ze,qe.total_in>>8&255),put_byte(ze,qe.total_in>>16&255),put_byte(ze,qe.total_in>>24&255)):(putShortMSB(ze,qe.adler>>>16),putShortMSB(ze,qe.adler&65535)),flush_pending(qe),ze.wrap>0&&(ze.wrap=-ze.wrap),ze.pending!==0?Z_OK$3:Z_STREAM_END$3)},deflateEnd=qe=>{if(deflateStateCheck(qe))return Z_STREAM_ERROR$2;const f=qe.state.status;return qe.state=null,f===BUSY_STATE?err(qe,Z_DATA_ERROR$2):Z_OK$3},deflateSetDictionary=(qe,f)=>{let ze=f.length;if(deflateStateCheck(qe))return Z_STREAM_ERROR$2;const Ke=qe.state,Qe=Ke.wrap;if(Qe===2||Qe===1&&Ke.status!==INIT_STATE||Ke.lookahead)return Z_STREAM_ERROR$2;if(Qe===1&&(qe.adler=adler32_1(qe.adler,f,ze,0)),Ke.wrap=0,ze>=Ke.w_size){Qe===0&&(zero(Ke.head),Ke.strstart=0,Ke.block_start=0,Ke.insert=0);let cn=new Uint8Array(Ke.w_size);cn.set(f.subarray(ze-Ke.w_size,ze),0),f=cn,ze=Ke.w_size}const Pi=qe.avail_in,nn=qe.next_in,ln=qe.input;for(qe.avail_in=ze,qe.next_in=0,qe.input=f,fill_window(Ke);Ke.lookahead>=MIN_MATCH;){let cn=Ke.strstart,hn=Ke.lookahead-(MIN_MATCH-1);do Ke.ins_h=HASH(Ke,Ke.ins_h,Ke.window[cn+MIN_MATCH-1]),Ke.prev[cn&Ke.w_mask]=Ke.head[Ke.ins_h],Ke.head[Ke.ins_h]=cn,cn++;while(--hn);Ke.strstart=cn,Ke.lookahead=MIN_MATCH-1,fill_window(Ke)}return Ke.strstart+=Ke.lookahead,Ke.block_start=Ke.strstart,Ke.insert=Ke.lookahead,Ke.lookahead=0,Ke.match_length=Ke.prev_length=MIN_MATCH-1,Ke.match_available=0,qe.next_in=nn,qe.input=ln,qe.avail_in=Pi,Ke.wrap=Qe,Z_OK$3};var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2$1=deflate$2,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1$2={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2$1,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo};const _has=(qe,f)=>Object.prototype.hasOwnProperty.call(qe,f);var assign=function(qe){const f=Array.prototype.slice.call(arguments,1);for(;f.length;){const ze=f.shift();if(ze){if(typeof ze!="object")throw new TypeError(ze+"must be non-object");for(const Ke in ze)_has(ze,Ke)&&(qe[Ke]=ze[Ke])}}return qe},flattenChunks=qe=>{let f=0;for(let Ke=0,Qe=qe.length;Ke<Qe;Ke++)f+=qe[Ke].length;const ze=new Uint8Array(f);for(let Ke=0,Qe=0,Pi=qe.length;Ke<Pi;Ke++){let nn=qe[Ke];ze.set(nn,Qe),Qe+=nn.length}return ze},common={assign,flattenChunks};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let qe=0;qe<256;qe++)_utf8len[qe]=qe>=252?6:qe>=248?5:qe>=240?4:qe>=224?3:qe>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=qe=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(qe);let f,ze,Ke,Qe,Pi,nn=qe.length,ln=0;for(Qe=0;Qe<nn;Qe++)ze=qe.charCodeAt(Qe),(ze&64512)===55296&&Qe+1<nn&&(Ke=qe.charCodeAt(Qe+1),(Ke&64512)===56320&&(ze=65536+(ze-55296<<10)+(Ke-56320),Qe++)),ln+=ze<128?1:ze<2048?2:ze<65536?3:4;for(f=new Uint8Array(ln),Pi=0,Qe=0;Pi<ln;Qe++)ze=qe.charCodeAt(Qe),(ze&64512)===55296&&Qe+1<nn&&(Ke=qe.charCodeAt(Qe+1),(Ke&64512)===56320&&(ze=65536+(ze-55296<<10)+(Ke-56320),Qe++)),ze<128?f[Pi++]=ze:ze<2048?(f[Pi++]=192|ze>>>6,f[Pi++]=128|ze&63):ze<65536?(f[Pi++]=224|ze>>>12,f[Pi++]=128|ze>>>6&63,f[Pi++]=128|ze&63):(f[Pi++]=240|ze>>>18,f[Pi++]=128|ze>>>12&63,f[Pi++]=128|ze>>>6&63,f[Pi++]=128|ze&63);return f};const buf2binstring=(qe,f)=>{if(f<65534&&qe.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,qe.length===f?qe:qe.subarray(0,f));let ze="";for(let Ke=0;Ke<f;Ke++)ze+=String.fromCharCode(qe[Ke]);return ze};var buf2string=(qe,f)=>{const ze=f||qe.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(qe.subarray(0,f));let Ke,Qe;const Pi=new Array(ze*2);for(Qe=0,Ke=0;Ke<ze;){let nn=qe[Ke++];if(nn<128){Pi[Qe++]=nn;continue}let ln=_utf8len[nn];if(ln>4){Pi[Qe++]=65533,Ke+=ln-1;continue}for(nn&=ln===2?31:ln===3?15:7;ln>1&&Ke<ze;)nn=nn<<6|qe[Ke++]&63,ln--;if(ln>1){Pi[Qe++]=65533;continue}nn<65536?Pi[Qe++]=nn:(nn-=65536,Pi[Qe++]=55296|nn>>10&1023,Pi[Qe++]=56320|nn&1023)}return buf2binstring(Pi,Qe)},utf8border=(qe,f)=>{f=f||qe.length,f>qe.length&&(f=qe.length);let ze=f-1;for(;ze>=0&&(qe[ze]&192)===128;)ze--;return ze<0||ze===0?f:ze+_utf8len[qe[ze]]>f?ze:f},strings={string2buf,buf2string,utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream;const toString$1$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$2;function Deflate$1(qe){this.options=common.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},qe||{});let f=this.options;f.raw&&f.windowBits>0?f.windowBits=-f.windowBits:f.gzip&&f.windowBits>0&&f.windowBits<16&&(f.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let ze=deflate_1$2.deflateInit2(this.strm,f.level,f.method,f.windowBits,f.memLevel,f.strategy);if(ze!==Z_OK$2)throw new Error(messages[ze]);if(f.header&&deflate_1$2.deflateSetHeader(this.strm,f.header),f.dictionary){let Ke;if(typeof f.dictionary=="string"?Ke=strings.string2buf(f.dictionary):toString$1$1.call(f.dictionary)==="[object ArrayBuffer]"?Ke=new Uint8Array(f.dictionary):Ke=f.dictionary,ze=deflate_1$2.deflateSetDictionary(this.strm,Ke),ze!==Z_OK$2)throw new Error(messages[ze]);this._dict_set=!0}}Deflate$1.prototype.push=function(qe,f){const ze=this.strm,Ke=this.options.chunkSize;let Qe,Pi;if(this.ended)return!1;for(f===~~f?Pi=f:Pi=f===!0?Z_FINISH$2:Z_NO_FLUSH$1,typeof qe=="string"?ze.input=strings.string2buf(qe):toString$1$1.call(qe)==="[object ArrayBuffer]"?ze.input=new Uint8Array(qe):ze.input=qe,ze.next_in=0,ze.avail_in=ze.input.length;;){if(ze.avail_out===0&&(ze.output=new Uint8Array(Ke),ze.next_out=0,ze.avail_out=Ke),(Pi===Z_SYNC_FLUSH||Pi===Z_FULL_FLUSH)&&ze.avail_out<=6){this.onData(ze.output.subarray(0,ze.next_out)),ze.avail_out=0;continue}if(Qe=deflate_1$2.deflate(ze,Pi),Qe===Z_STREAM_END$2)return ze.next_out>0&&this.onData(ze.output.subarray(0,ze.next_out)),Qe=deflate_1$2.deflateEnd(this.strm),this.onEnd(Qe),this.ended=!0,Qe===Z_OK$2;if(ze.avail_out===0){this.onData(ze.output);continue}if(Pi>0&&ze.next_out>0){this.onData(ze.output.subarray(0,ze.next_out)),ze.avail_out=0;continue}if(ze.avail_in===0)break}return!0};Deflate$1.prototype.onData=function(qe){this.chunks.push(qe)};Deflate$1.prototype.onEnd=function(qe){qe===Z_OK$2&&(this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=qe,this.msg=this.strm.msg};function deflate$1(qe,f){const ze=new Deflate$1(f);if(ze.push(qe,!0),ze.err)throw ze.msg||messages[ze.err];return ze.result}var deflate_2=deflate$1,deflate_1$1={deflate:deflate_2};const BAD$1=16209,TYPE$1=16191;var inffast=function(f,ze){let Ke,Qe,Pi,nn,ln,cn,hn,un,zn,Xn,Un,qn,ys,vs,ea,na,ta,ra,oa,fa,ca,la,ua,ga;const da=f.state;Ke=f.next_in,ua=f.input,Qe=Ke+(f.avail_in-5),Pi=f.next_out,ga=f.output,nn=Pi-(ze-f.avail_out),ln=Pi+(f.avail_out-257),cn=da.dmax,hn=da.wsize,un=da.whave,zn=da.wnext,Xn=da.window,Un=da.hold,qn=da.bits,ys=da.lencode,vs=da.distcode,ea=(1<<da.lenbits)-1,na=(1<<da.distbits)-1;e:do{qn<15&&(Un+=ua[Ke++]<<qn,qn+=8,Un+=ua[Ke++]<<qn,qn+=8),ta=ys[Un&ea];t:for(;;){if(ra=ta>>>24,Un>>>=ra,qn-=ra,ra=ta>>>16&255,ra===0)ga[Pi++]=ta&65535;else if(ra&16){oa=ta&65535,ra&=15,ra&&(qn<ra&&(Un+=ua[Ke++]<<qn,qn+=8),oa+=Un&(1<<ra)-1,Un>>>=ra,qn-=ra),qn<15&&(Un+=ua[Ke++]<<qn,qn+=8,Un+=ua[Ke++]<<qn,qn+=8),ta=vs[Un&na];r:for(;;){if(ra=ta>>>24,Un>>>=ra,qn-=ra,ra=ta>>>16&255,ra&16){if(fa=ta&65535,ra&=15,qn<ra&&(Un+=ua[Ke++]<<qn,qn+=8,qn<ra&&(Un+=ua[Ke++]<<qn,qn+=8)),fa+=Un&(1<<ra)-1,fa>cn){f.msg="invalid distance too far back",da.mode=BAD$1;break e}if(Un>>>=ra,qn-=ra,ra=Pi-nn,fa>ra){if(ra=fa-ra,ra>un&&da.sane){f.msg="invalid distance too far back",da.mode=BAD$1;break e}if(ca=0,la=Xn,zn===0){if(ca+=hn-ra,ra<oa){oa-=ra;do ga[Pi++]=Xn[ca++];while(--ra);ca=Pi-fa,la=ga}}else if(zn<ra){if(ca+=hn+zn-ra,ra-=zn,ra<oa){oa-=ra;do ga[Pi++]=Xn[ca++];while(--ra);if(ca=0,zn<oa){ra=zn,oa-=ra;do ga[Pi++]=Xn[ca++];while(--ra);ca=Pi-fa,la=ga}}}else if(ca+=zn-ra,ra<oa){oa-=ra;do ga[Pi++]=Xn[ca++];while(--ra);ca=Pi-fa,la=ga}for(;oa>2;)ga[Pi++]=la[ca++],ga[Pi++]=la[ca++],ga[Pi++]=la[ca++],oa-=3;oa&&(ga[Pi++]=la[ca++],oa>1&&(ga[Pi++]=la[ca++]))}else{ca=Pi-fa;do ga[Pi++]=ga[ca++],ga[Pi++]=ga[ca++],ga[Pi++]=ga[ca++],oa-=3;while(oa>2);oa&&(ga[Pi++]=ga[ca++],oa>1&&(ga[Pi++]=ga[ca++]))}}else if((ra&64)===0){ta=vs[(ta&65535)+(Un&(1<<ra)-1)];continue r}else{f.msg="invalid distance code",da.mode=BAD$1;break e}break}}else if((ra&64)===0){ta=ys[(ta&65535)+(Un&(1<<ra)-1)];continue t}else if(ra&32){da.mode=TYPE$1;break e}else{f.msg="invalid literal/length code",da.mode=BAD$1;break e}break}}while(Ke<Qe&&Pi<ln);oa=qn>>3,Ke-=oa,qn-=oa<<3,Un&=(1<<qn)-1,f.next_in=Ke,f.next_out=Pi,f.avail_in=Ke<Qe?5+(Qe-Ke):5-(Ke-Qe),f.avail_out=Pi<ln?257+(ln-Pi):257-(Pi-ln),da.hold=Un,da.bits=qn};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table=(qe,f,ze,Ke,Qe,Pi,nn,ln)=>{const cn=ln.bits;let hn=0,un=0,zn=0,Xn=0,Un=0,qn=0,ys=0,vs=0,ea=0,na=0,ta,ra,oa,fa,ca,la=null,ua;const ga=new Uint16Array(MAXBITS+1),da=new Uint16Array(MAXBITS+1);let qa=null,tl,ol,hl;for(hn=0;hn<=MAXBITS;hn++)ga[hn]=0;for(un=0;un<Ke;un++)ga[f[ze+un]]++;for(Un=cn,Xn=MAXBITS;Xn>=1&&ga[Xn]===0;Xn--);if(Un>Xn&&(Un=Xn),Xn===0)return Qe[Pi++]=1<<24|64<<16|0,Qe[Pi++]=1<<24|64<<16|0,ln.bits=1,0;for(zn=1;zn<Xn&&ga[zn]===0;zn++);for(Un<zn&&(Un=zn),vs=1,hn=1;hn<=MAXBITS;hn++)if(vs<<=1,vs-=ga[hn],vs<0)return-1;if(vs>0&&(qe===CODES$1||Xn!==1))return-1;for(da[1]=0,hn=1;hn<MAXBITS;hn++)da[hn+1]=da[hn]+ga[hn];for(un=0;un<Ke;un++)f[ze+un]!==0&&(nn[da[f[ze+un]]++]=un);if(qe===CODES$1?(la=qa=nn,ua=20):qe===LENS$1?(la=lbase,qa=lext,ua=257):(la=dbase,qa=dext,ua=0),na=0,un=0,hn=zn,ca=Pi,qn=Un,ys=0,oa=-1,ea=1<<Un,fa=ea-1,qe===LENS$1&&ea>ENOUGH_LENS$1||qe===DISTS$1&&ea>ENOUGH_DISTS$1)return 1;for(;;){tl=hn-ys,nn[un]+1<ua?(ol=0,hl=nn[un]):nn[un]>=ua?(ol=qa[nn[un]-ua],hl=la[nn[un]-ua]):(ol=96,hl=0),ta=1<<hn-ys,ra=1<<qn,zn=ra;do ra-=ta,Qe[ca+(na>>ys)+ra]=tl<<24|ol<<16|hl|0;while(ra!==0);for(ta=1<<hn-1;na&ta;)ta>>=1;if(ta!==0?(na&=ta-1,na+=ta):na=0,un++,--ga[hn]===0){if(hn===Xn)break;hn=f[ze+nn[un]]}if(hn>Un&&(na&fa)!==oa){for(ys===0&&(ys=Un),ca+=zn,qn=hn-ys,vs=1<<qn;qn+ys<Xn&&(vs-=ga[qn+ys],!(vs<=0));)qn++,vs<<=1;if(ea+=1<<qn,qe===LENS$1&&ea>ENOUGH_LENS$1||qe===DISTS$1&&ea>ENOUGH_DISTS$1)return 1;oa=na&fa,Qe[oa]=Un<<24|qn<<16|ca-Pi|0}}return na!==0&&(Qe[ca+na]=hn-ys<<24|64<<16|0),ln.bits=Un,0};var inftrees=inflate_table;const CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK,Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR,Z_DEFLATED}=constants$2,HEAD=16180,FLAGS=16181,TIME=16182,OS=16183,EXLEN=16184,EXTRA=16185,NAME=16186,COMMENT=16187,HCRC=16188,DICTID=16189,DICT=16190,TYPE=16191,TYPEDO=16192,STORED=16193,COPY_=16194,COPY=16195,TABLE=16196,LENLENS=16197,CODELENS=16198,LEN_=16199,LEN=16200,LENEXT=16201,DIST=16202,DISTEXT=16203,MATCH=16204,LIT=16205,CHECK=16206,LENGTH=16207,DONE=16208,BAD=16209,MEM=16210,SYNC=16211,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=qe=>(qe>>>24&255)+(qe>>>8&65280)+((qe&65280)<<8)+((qe&255)<<24);function InflateState(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateStateCheck=qe=>{if(!qe)return 1;const f=qe.state;return!f||f.strm!==qe||f.mode<HEAD||f.mode>SYNC?1:0},inflateResetKeep=qe=>{if(inflateStateCheck(qe))return Z_STREAM_ERROR$1;const f=qe.state;return qe.total_in=qe.total_out=f.total=0,qe.msg="",f.wrap&&(qe.adler=f.wrap&1),f.mode=HEAD,f.last=0,f.havedict=0,f.flags=-1,f.dmax=32768,f.head=null,f.hold=0,f.bits=0,f.lencode=f.lendyn=new Int32Array(ENOUGH_LENS),f.distcode=f.distdyn=new Int32Array(ENOUGH_DISTS),f.sane=1,f.back=-1,Z_OK$1},inflateReset=qe=>{if(inflateStateCheck(qe))return Z_STREAM_ERROR$1;const f=qe.state;return f.wsize=0,f.whave=0,f.wnext=0,inflateResetKeep(qe)},inflateReset2=(qe,f)=>{let ze;if(inflateStateCheck(qe))return Z_STREAM_ERROR$1;const Ke=qe.state;return f<0?(ze=0,f=-f):(ze=(f>>4)+5,f<48&&(f&=15)),f&&(f<8||f>15)?Z_STREAM_ERROR$1:(Ke.window!==null&&Ke.wbits!==f&&(Ke.window=null),Ke.wrap=ze,Ke.wbits=f,inflateReset(qe))},inflateInit2=(qe,f)=>{if(!qe)return Z_STREAM_ERROR$1;const ze=new InflateState;qe.state=ze,ze.strm=qe,ze.window=null,ze.mode=HEAD;const Ke=inflateReset2(qe,f);return Ke!==Z_OK$1&&(qe.state=null),Ke},inflateInit=qe=>inflateInit2(qe,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=qe=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let f=0;for(;f<144;)qe.lens[f++]=8;for(;f<256;)qe.lens[f++]=9;for(;f<280;)qe.lens[f++]=7;for(;f<288;)qe.lens[f++]=8;for(inftrees(LENS,qe.lens,0,288,lenfix,0,qe.work,{bits:9}),f=0;f<32;)qe.lens[f++]=5;inftrees(DISTS,qe.lens,0,32,distfix,0,qe.work,{bits:5}),virgin=!1}qe.lencode=lenfix,qe.lenbits=9,qe.distcode=distfix,qe.distbits=5},updatewindow=(qe,f,ze,Ke)=>{let Qe;const Pi=qe.state;return Pi.window===null&&(Pi.wsize=1<<Pi.wbits,Pi.wnext=0,Pi.whave=0,Pi.window=new Uint8Array(Pi.wsize)),Ke>=Pi.wsize?(Pi.window.set(f.subarray(ze-Pi.wsize,ze),0),Pi.wnext=0,Pi.whave=Pi.wsize):(Qe=Pi.wsize-Pi.wnext,Qe>Ke&&(Qe=Ke),Pi.window.set(f.subarray(ze-Ke,ze-Ke+Qe),Pi.wnext),Ke-=Qe,Ke?(Pi.window.set(f.subarray(ze-Ke,ze),0),Pi.wnext=Ke,Pi.whave=Pi.wsize):(Pi.wnext+=Qe,Pi.wnext===Pi.wsize&&(Pi.wnext=0),Pi.whave<Pi.wsize&&(Pi.whave+=Qe))),0},inflate$2=(qe,f)=>{let ze,Ke,Qe,Pi,nn,ln,cn,hn,un,zn,Xn,Un,qn,ys,vs=0,ea,na,ta,ra,oa,fa,ca,la;const ua=new Uint8Array(4);let ga,da;const qa=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck(qe)||!qe.output||!qe.input&&qe.avail_in!==0)return Z_STREAM_ERROR$1;ze=qe.state,ze.mode===TYPE&&(ze.mode=TYPEDO),nn=qe.next_out,Qe=qe.output,cn=qe.avail_out,Pi=qe.next_in,Ke=qe.input,ln=qe.avail_in,hn=ze.hold,un=ze.bits,zn=ln,Xn=cn,la=Z_OK$1;e:for(;;)switch(ze.mode){case HEAD:if(ze.wrap===0){ze.mode=TYPEDO;break}for(;un<16;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}if(ze.wrap&2&&hn===35615){ze.wbits===0&&(ze.wbits=15),ze.check=0,ua[0]=hn&255,ua[1]=hn>>>8&255,ze.check=crc32_1(ze.check,ua,2,0),hn=0,un=0,ze.mode=FLAGS;break}if(ze.head&&(ze.head.done=!1),!(ze.wrap&1)||(((hn&255)<<8)+(hn>>8))%31){qe.msg="incorrect header check",ze.mode=BAD;break}if((hn&15)!==Z_DEFLATED){qe.msg="unknown compression method",ze.mode=BAD;break}if(hn>>>=4,un-=4,ca=(hn&15)+8,ze.wbits===0&&(ze.wbits=ca),ca>15||ca>ze.wbits){qe.msg="invalid window size",ze.mode=BAD;break}ze.dmax=1<<ze.wbits,ze.flags=0,qe.adler=ze.check=1,ze.mode=hn&512?DICTID:TYPE,hn=0,un=0;break;case FLAGS:for(;un<16;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}if(ze.flags=hn,(ze.flags&255)!==Z_DEFLATED){qe.msg="unknown compression method",ze.mode=BAD;break}if(ze.flags&57344){qe.msg="unknown header flags set",ze.mode=BAD;break}ze.head&&(ze.head.text=hn>>8&1),ze.flags&512&&ze.wrap&4&&(ua[0]=hn&255,ua[1]=hn>>>8&255,ze.check=crc32_1(ze.check,ua,2,0)),hn=0,un=0,ze.mode=TIME;case TIME:for(;un<32;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}ze.head&&(ze.head.time=hn),ze.flags&512&&ze.wrap&4&&(ua[0]=hn&255,ua[1]=hn>>>8&255,ua[2]=hn>>>16&255,ua[3]=hn>>>24&255,ze.check=crc32_1(ze.check,ua,4,0)),hn=0,un=0,ze.mode=OS;case OS:for(;un<16;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}ze.head&&(ze.head.xflags=hn&255,ze.head.os=hn>>8),ze.flags&512&&ze.wrap&4&&(ua[0]=hn&255,ua[1]=hn>>>8&255,ze.check=crc32_1(ze.check,ua,2,0)),hn=0,un=0,ze.mode=EXLEN;case EXLEN:if(ze.flags&1024){for(;un<16;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}ze.length=hn,ze.head&&(ze.head.extra_len=hn),ze.flags&512&&ze.wrap&4&&(ua[0]=hn&255,ua[1]=hn>>>8&255,ze.check=crc32_1(ze.check,ua,2,0)),hn=0,un=0}else ze.head&&(ze.head.extra=null);ze.mode=EXTRA;case EXTRA:if(ze.flags&1024&&(Un=ze.length,Un>ln&&(Un=ln),Un&&(ze.head&&(ca=ze.head.extra_len-ze.length,ze.head.extra||(ze.head.extra=new Uint8Array(ze.head.extra_len)),ze.head.extra.set(Ke.subarray(Pi,Pi+Un),ca)),ze.flags&512&&ze.wrap&4&&(ze.check=crc32_1(ze.check,Ke,Un,Pi)),ln-=Un,Pi+=Un,ze.length-=Un),ze.length))break e;ze.length=0,ze.mode=NAME;case NAME:if(ze.flags&2048){if(ln===0)break e;Un=0;do ca=Ke[Pi+Un++],ze.head&&ca&&ze.length<65536&&(ze.head.name+=String.fromCharCode(ca));while(ca&&Un<ln);if(ze.flags&512&&ze.wrap&4&&(ze.check=crc32_1(ze.check,Ke,Un,Pi)),ln-=Un,Pi+=Un,ca)break e}else ze.head&&(ze.head.name=null);ze.length=0,ze.mode=COMMENT;case COMMENT:if(ze.flags&4096){if(ln===0)break e;Un=0;do ca=Ke[Pi+Un++],ze.head&&ca&&ze.length<65536&&(ze.head.comment+=String.fromCharCode(ca));while(ca&&Un<ln);if(ze.flags&512&&ze.wrap&4&&(ze.check=crc32_1(ze.check,Ke,Un,Pi)),ln-=Un,Pi+=Un,ca)break e}else ze.head&&(ze.head.comment=null);ze.mode=HCRC;case HCRC:if(ze.flags&512){for(;un<16;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}if(ze.wrap&4&&hn!==(ze.check&65535)){qe.msg="header crc mismatch",ze.mode=BAD;break}hn=0,un=0}ze.head&&(ze.head.hcrc=ze.flags>>9&1,ze.head.done=!0),qe.adler=ze.check=0,ze.mode=TYPE;break;case DICTID:for(;un<32;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}qe.adler=ze.check=zswap32(hn),hn=0,un=0,ze.mode=DICT;case DICT:if(ze.havedict===0)return qe.next_out=nn,qe.avail_out=cn,qe.next_in=Pi,qe.avail_in=ln,ze.hold=hn,ze.bits=un,Z_NEED_DICT$1;qe.adler=ze.check=1,ze.mode=TYPE;case TYPE:if(f===Z_BLOCK||f===Z_TREES)break e;case TYPEDO:if(ze.last){hn>>>=un&7,un-=un&7,ze.mode=CHECK;break}for(;un<3;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}switch(ze.last=hn&1,hn>>>=1,un-=1,hn&3){case 0:ze.mode=STORED;break;case 1:if(fixedtables(ze),ze.mode=LEN_,f===Z_TREES){hn>>>=2,un-=2;break e}break;case 2:ze.mode=TABLE;break;case 3:qe.msg="invalid block type",ze.mode=BAD}hn>>>=2,un-=2;break;case STORED:for(hn>>>=un&7,un-=un&7;un<32;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}if((hn&65535)!==(hn>>>16^65535)){qe.msg="invalid stored block lengths",ze.mode=BAD;break}if(ze.length=hn&65535,hn=0,un=0,ze.mode=COPY_,f===Z_TREES)break e;case COPY_:ze.mode=COPY;case COPY:if(Un=ze.length,Un){if(Un>ln&&(Un=ln),Un>cn&&(Un=cn),Un===0)break e;Qe.set(Ke.subarray(Pi,Pi+Un),nn),ln-=Un,Pi+=Un,cn-=Un,nn+=Un,ze.length-=Un;break}ze.mode=TYPE;break;case TABLE:for(;un<14;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}if(ze.nlen=(hn&31)+257,hn>>>=5,un-=5,ze.ndist=(hn&31)+1,hn>>>=5,un-=5,ze.ncode=(hn&15)+4,hn>>>=4,un-=4,ze.nlen>286||ze.ndist>30){qe.msg="too many length or distance symbols",ze.mode=BAD;break}ze.have=0,ze.mode=LENLENS;case LENLENS:for(;ze.have<ze.ncode;){for(;un<3;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}ze.lens[qa[ze.have++]]=hn&7,hn>>>=3,un-=3}for(;ze.have<19;)ze.lens[qa[ze.have++]]=0;if(ze.lencode=ze.lendyn,ze.lenbits=7,ga={bits:ze.lenbits},la=inftrees(CODES,ze.lens,0,19,ze.lencode,0,ze.work,ga),ze.lenbits=ga.bits,la){qe.msg="invalid code lengths set",ze.mode=BAD;break}ze.have=0,ze.mode=CODELENS;case CODELENS:for(;ze.have<ze.nlen+ze.ndist;){for(;vs=ze.lencode[hn&(1<<ze.lenbits)-1],ea=vs>>>24,na=vs>>>16&255,ta=vs&65535,!(ea<=un);){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}if(ta<16)hn>>>=ea,un-=ea,ze.lens[ze.have++]=ta;else{if(ta===16){for(da=ea+2;un<da;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}if(hn>>>=ea,un-=ea,ze.have===0){qe.msg="invalid bit length repeat",ze.mode=BAD;break}ca=ze.lens[ze.have-1],Un=3+(hn&3),hn>>>=2,un-=2}else if(ta===17){for(da=ea+3;un<da;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}hn>>>=ea,un-=ea,ca=0,Un=3+(hn&7),hn>>>=3,un-=3}else{for(da=ea+7;un<da;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}hn>>>=ea,un-=ea,ca=0,Un=11+(hn&127),hn>>>=7,un-=7}if(ze.have+Un>ze.nlen+ze.ndist){qe.msg="invalid bit length repeat",ze.mode=BAD;break}for(;Un--;)ze.lens[ze.have++]=ca}}if(ze.mode===BAD)break;if(ze.lens[256]===0){qe.msg="invalid code -- missing end-of-block",ze.mode=BAD;break}if(ze.lenbits=9,ga={bits:ze.lenbits},la=inftrees(LENS,ze.lens,0,ze.nlen,ze.lencode,0,ze.work,ga),ze.lenbits=ga.bits,la){qe.msg="invalid literal/lengths set",ze.mode=BAD;break}if(ze.distbits=6,ze.distcode=ze.distdyn,ga={bits:ze.distbits},la=inftrees(DISTS,ze.lens,ze.nlen,ze.ndist,ze.distcode,0,ze.work,ga),ze.distbits=ga.bits,la){qe.msg="invalid distances set",ze.mode=BAD;break}if(ze.mode=LEN_,f===Z_TREES)break e;case LEN_:ze.mode=LEN;case LEN:if(ln>=6&&cn>=258){qe.next_out=nn,qe.avail_out=cn,qe.next_in=Pi,qe.avail_in=ln,ze.hold=hn,ze.bits=un,inffast(qe,Xn),nn=qe.next_out,Qe=qe.output,cn=qe.avail_out,Pi=qe.next_in,Ke=qe.input,ln=qe.avail_in,hn=ze.hold,un=ze.bits,ze.mode===TYPE&&(ze.back=-1);break}for(ze.back=0;vs=ze.lencode[hn&(1<<ze.lenbits)-1],ea=vs>>>24,na=vs>>>16&255,ta=vs&65535,!(ea<=un);){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}if(na&&(na&240)===0){for(ra=ea,oa=na,fa=ta;vs=ze.lencode[fa+((hn&(1<<ra+oa)-1)>>ra)],ea=vs>>>24,na=vs>>>16&255,ta=vs&65535,!(ra+ea<=un);){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}hn>>>=ra,un-=ra,ze.back+=ra}if(hn>>>=ea,un-=ea,ze.back+=ea,ze.length=ta,na===0){ze.mode=LIT;break}if(na&32){ze.back=-1,ze.mode=TYPE;break}if(na&64){qe.msg="invalid literal/length code",ze.mode=BAD;break}ze.extra=na&15,ze.mode=LENEXT;case LENEXT:if(ze.extra){for(da=ze.extra;un<da;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}ze.length+=hn&(1<<ze.extra)-1,hn>>>=ze.extra,un-=ze.extra,ze.back+=ze.extra}ze.was=ze.length,ze.mode=DIST;case DIST:for(;vs=ze.distcode[hn&(1<<ze.distbits)-1],ea=vs>>>24,na=vs>>>16&255,ta=vs&65535,!(ea<=un);){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}if((na&240)===0){for(ra=ea,oa=na,fa=ta;vs=ze.distcode[fa+((hn&(1<<ra+oa)-1)>>ra)],ea=vs>>>24,na=vs>>>16&255,ta=vs&65535,!(ra+ea<=un);){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}hn>>>=ra,un-=ra,ze.back+=ra}if(hn>>>=ea,un-=ea,ze.back+=ea,na&64){qe.msg="invalid distance code",ze.mode=BAD;break}ze.offset=ta,ze.extra=na&15,ze.mode=DISTEXT;case DISTEXT:if(ze.extra){for(da=ze.extra;un<da;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}ze.offset+=hn&(1<<ze.extra)-1,hn>>>=ze.extra,un-=ze.extra,ze.back+=ze.extra}if(ze.offset>ze.dmax){qe.msg="invalid distance too far back",ze.mode=BAD;break}ze.mode=MATCH;case MATCH:if(cn===0)break e;if(Un=Xn-cn,ze.offset>Un){if(Un=ze.offset-Un,Un>ze.whave&&ze.sane){qe.msg="invalid distance too far back",ze.mode=BAD;break}Un>ze.wnext?(Un-=ze.wnext,qn=ze.wsize-Un):qn=ze.wnext-Un,Un>ze.length&&(Un=ze.length),ys=ze.window}else ys=Qe,qn=nn-ze.offset,Un=ze.length;Un>cn&&(Un=cn),cn-=Un,ze.length-=Un;do Qe[nn++]=ys[qn++];while(--Un);ze.length===0&&(ze.mode=LEN);break;case LIT:if(cn===0)break e;Qe[nn++]=ze.length,cn--,ze.mode=LEN;break;case CHECK:if(ze.wrap){for(;un<32;){if(ln===0)break e;ln--,hn|=Ke[Pi++]<<un,un+=8}if(Xn-=cn,qe.total_out+=Xn,ze.total+=Xn,ze.wrap&4&&Xn&&(qe.adler=ze.check=ze.flags?crc32_1(ze.check,Qe,Xn,nn-Xn):adler32_1(ze.check,Qe,Xn,nn-Xn)),Xn=cn,ze.wrap&4&&(ze.flags?hn:zswap32(hn))!==ze.check){qe.msg="incorrect data check",ze.mode=BAD;break}hn=0,un=0}ze.mode=LENGTH;case LENGTH:if(ze.wrap&&ze.flags){for(;un<32;){if(ln===0)break e;ln--,hn+=Ke[Pi++]<<un,un+=8}if(ze.wrap&4&&hn!==(ze.total&4294967295)){qe.msg="incorrect length check",ze.mode=BAD;break}hn=0,un=0}ze.mode=DONE;case DONE:la=Z_STREAM_END$1;break e;case BAD:la=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return qe.next_out=nn,qe.avail_out=cn,qe.next_in=Pi,qe.avail_in=ln,ze.hold=hn,ze.bits=un,(ze.wsize||Xn!==qe.avail_out&&ze.mode<BAD&&(ze.mode<CHECK||f!==Z_FINISH$1))&&updatewindow(qe,qe.output,qe.next_out,Xn-qe.avail_out),zn-=qe.avail_in,Xn-=qe.avail_out,qe.total_in+=zn,qe.total_out+=Xn,ze.total+=Xn,ze.wrap&4&&Xn&&(qe.adler=ze.check=ze.flags?crc32_1(ze.check,Qe,Xn,qe.next_out-Xn):adler32_1(ze.check,Qe,Xn,qe.next_out-Xn)),qe.data_type=ze.bits+(ze.last?64:0)+(ze.mode===TYPE?128:0)+(ze.mode===LEN_||ze.mode===COPY_?256:0),(zn===0&&Xn===0||f===Z_FINISH$1)&&la===Z_OK$1&&(la=Z_BUF_ERROR),la},inflateEnd=qe=>{if(inflateStateCheck(qe))return Z_STREAM_ERROR$1;let f=qe.state;return f.window&&(f.window=null),qe.state=null,Z_OK$1},inflateGetHeader=(qe,f)=>{if(inflateStateCheck(qe))return Z_STREAM_ERROR$1;const ze=qe.state;return(ze.wrap&2)===0?Z_STREAM_ERROR$1:(ze.head=f,f.done=!1,Z_OK$1)},inflateSetDictionary=(qe,f)=>{const ze=f.length;let Ke,Qe,Pi;return inflateStateCheck(qe)||(Ke=qe.state,Ke.wrap!==0&&Ke.mode!==DICT)?Z_STREAM_ERROR$1:Ke.mode===DICT&&(Qe=1,Qe=adler32_1(Qe,f,ze,0),Qe!==Ke.check)?Z_DATA_ERROR$1:(Pi=updatewindow(qe,f,ze,ze),Pi?(Ke.mode=MEM,Z_MEM_ERROR$1):(Ke.havedict=1,Z_OK$1))};var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2$1=inflate$2,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1$2={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2$1,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader;const toString$2=Object.prototype.toString,{Z_NO_FLUSH,Z_FINISH,Z_OK,Z_STREAM_END,Z_NEED_DICT,Z_STREAM_ERROR,Z_DATA_ERROR,Z_MEM_ERROR}=constants$2;function Inflate$1(qe){this.options=common.assign({chunkSize:1024*64,windowBits:15,to:""},qe||{});const f=this.options;f.raw&&f.windowBits>=0&&f.windowBits<16&&(f.windowBits=-f.windowBits,f.windowBits===0&&(f.windowBits=-15)),f.windowBits>=0&&f.windowBits<16&&!(qe&&qe.windowBits)&&(f.windowBits+=32),f.windowBits>15&&f.windowBits<48&&(f.windowBits&15)===0&&(f.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let ze=inflate_1$2.inflateInit2(this.strm,f.windowBits);if(ze!==Z_OK)throw new Error(messages[ze]);if(this.header=new gzheader,inflate_1$2.inflateGetHeader(this.strm,this.header),f.dictionary&&(typeof f.dictionary=="string"?f.dictionary=strings.string2buf(f.dictionary):toString$2.call(f.dictionary)==="[object ArrayBuffer]"&&(f.dictionary=new Uint8Array(f.dictionary)),f.raw&&(ze=inflate_1$2.inflateSetDictionary(this.strm,f.dictionary),ze!==Z_OK)))throw new Error(messages[ze])}Inflate$1.prototype.push=function(qe,f){const ze=this.strm,Ke=this.options.chunkSize,Qe=this.options.dictionary;let Pi,nn,ln;if(this.ended)return!1;for(f===~~f?nn=f:nn=f===!0?Z_FINISH:Z_NO_FLUSH,toString$2.call(qe)==="[object ArrayBuffer]"?ze.input=new Uint8Array(qe):ze.input=qe,ze.next_in=0,ze.avail_in=ze.input.length;;){for(ze.avail_out===0&&(ze.output=new Uint8Array(Ke),ze.next_out=0,ze.avail_out=Ke),Pi=inflate_1$2.inflate(ze,nn),Pi===Z_NEED_DICT&&Qe&&(Pi=inflate_1$2.inflateSetDictionary(ze,Qe),Pi===Z_OK?Pi=inflate_1$2.inflate(ze,nn):Pi===Z_DATA_ERROR&&(Pi=Z_NEED_DICT));ze.avail_in>0&&Pi===Z_STREAM_END&&ze.state.wrap>0&&qe[ze.next_in]!==0;)inflate_1$2.inflateReset(ze),Pi=inflate_1$2.inflate(ze,nn);switch(Pi){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(Pi),this.ended=!0,!1}if(ln=ze.avail_out,ze.next_out&&(ze.avail_out===0||Pi===Z_STREAM_END))if(this.options.to==="string"){let cn=strings.utf8border(ze.output,ze.next_out),hn=ze.next_out-cn,un=strings.buf2string(ze.output,cn);ze.next_out=hn,ze.avail_out=Ke-hn,hn&&ze.output.set(ze.output.subarray(cn,cn+hn),0),this.onData(un)}else this.onData(ze.output.length===ze.next_out?ze.output:ze.output.subarray(0,ze.next_out));if(!(Pi===Z_OK&&ln===0)){if(Pi===Z_STREAM_END)return Pi=inflate_1$2.inflateEnd(this.strm),this.onEnd(Pi),this.ended=!0,!0;if(ze.avail_in===0)break}}return!0};Inflate$1.prototype.onData=function(qe){this.chunks.push(qe)};Inflate$1.prototype.onEnd=function(qe){qe===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=qe,this.msg=this.strm.msg};function inflate$1(qe,f){const ze=new Inflate$1(f);if(ze.push(qe),ze.err)throw ze.msg||messages[ze.err];return ze.result}var Inflate_1$1=Inflate$1,inflate_2=inflate$1,inflate_1$1={Inflate:Inflate_1$1,inflate:inflate_2};const{deflate}=deflate_1$1,{Inflate,inflate}=inflate_1$1;var deflate_1=deflate,Inflate_1=Inflate,inflate_1=inflate;const crcTable=[];for(let qe=0;qe<256;qe++){let f=qe;for(let ze=0;ze<8;ze++)f&1?f=3988292384^f>>>1:f=f>>>1;crcTable[qe]=f}const initialCrc=4294967295;function updateCrc(qe,f,ze){let Ke=qe;for(let Qe=0;Qe<ze;Qe++)Ke=crcTable[(Ke^f[Qe])&255]^Ke>>>8;return Ke}function crc(qe,f){return(updateCrc(initialCrc,qe,f)^initialCrc)>>>0}function checkCrc(qe,f,ze){const Ke=qe.readUint32(),Qe=crc(new Uint8Array(qe.buffer,qe.byteOffset+qe.offset-f-4,f),f);if(Qe!==Ke)throw new Error(`CRC mismatch for chunk ${ze}. Expected ${Ke}, found ${Qe}`)}function writeCrc(qe,f){qe.writeUint32(crc(new Uint8Array(qe.buffer,qe.byteOffset+qe.offset-f,f),f))}function unfilterNone(qe,f,ze){for(let Ke=0;Ke<ze;Ke++)f[Ke]=qe[Ke]}function unfilterSub(qe,f,ze,Ke){let Qe=0;for(;Qe<Ke;Qe++)f[Qe]=qe[Qe];for(;Qe<ze;Qe++)f[Qe]=qe[Qe]+f[Qe-Ke]&255}function unfilterUp(qe,f,ze,Ke){let Qe=0;if(ze.length===0)for(;Qe<Ke;Qe++)f[Qe]=qe[Qe];else for(;Qe<Ke;Qe++)f[Qe]=qe[Qe]+ze[Qe]&255}function unfilterAverage(qe,f,ze,Ke,Qe){let Pi=0;if(ze.length===0){for(;Pi<Qe;Pi++)f[Pi]=qe[Pi];for(;Pi<Ke;Pi++)f[Pi]=qe[Pi]+(f[Pi-Qe]>>1)&255}else{for(;Pi<Qe;Pi++)f[Pi]=qe[Pi]+(ze[Pi]>>1)&255;for(;Pi<Ke;Pi++)f[Pi]=qe[Pi]+(f[Pi-Qe]+ze[Pi]>>1)&255}}function unfilterPaeth(qe,f,ze,Ke,Qe){let Pi=0;if(ze.length===0){for(;Pi<Qe;Pi++)f[Pi]=qe[Pi];for(;Pi<Ke;Pi++)f[Pi]=qe[Pi]+f[Pi-Qe]&255}else{for(;Pi<Qe;Pi++)f[Pi]=qe[Pi]+ze[Pi]&255;for(;Pi<Ke;Pi++)f[Pi]=qe[Pi]+paethPredictor(f[Pi-Qe],ze[Pi],ze[Pi-Qe])&255}}function paethPredictor(qe,f,ze){const Ke=qe+f-ze,Qe=Math.abs(Ke-qe),Pi=Math.abs(Ke-f),nn=Math.abs(Ke-ze);return Qe<=Pi&&Qe<=nn?qe:Pi<=nn?f:ze}const uint16=new Uint16Array([255]),uint8=new Uint8Array(uint16.buffer),osIsLittleEndian=uint8[0]===255,empty=new Uint8Array(0);function decodeInterlaceNull(qe){const{data:f,width:ze,height:Ke,channels:Qe,depth:Pi}=qe,nn=Qe*Pi/8,ln=ze*nn,cn=new Uint8Array(Ke*ln);let hn=empty,un=0,zn,Xn;for(let Un=0;Un<Ke;Un++){switch(zn=f.subarray(un+1,un+1+ln),Xn=cn.subarray(Un*ln,(Un+1)*ln),f[un]){case 0:unfilterNone(zn,Xn,ln);break;case 1:unfilterSub(zn,Xn,ln,nn);break;case 2:unfilterUp(zn,Xn,hn,ln);break;case 3:unfilterAverage(zn,Xn,hn,ln,nn);break;case 4:unfilterPaeth(zn,Xn,hn,ln,nn);break;default:throw new Error(`Unsupported filter: ${f[un]}`)}hn=Xn,un+=ln+1}if(Pi===16){const Un=new Uint16Array(cn.buffer);if(osIsLittleEndian)for(let qn=0;qn<Un.length;qn++)Un[qn]=swap16(Un[qn]);return Un}else return cn}function swap16(qe){return(qe&255)<<8|qe>>8&255}const pngSignature=Uint8Array.of(137,80,78,71,13,10,26,10);function writeSignature(qe){qe.writeBytes(pngSignature)}function checkSignature(qe){if(!hasPngSignature(qe.readBytes(pngSignature.length)))throw new Error("wrong PNG signature")}function hasPngSignature(qe){if(qe.length<pngSignature.length)return!1;for(let f=0;f<pngSignature.length;f++)if(qe[f]!==pngSignature[f])return!1;return!0}const textChunkName="tEXt",NULL=0,latin1Decoder=new TextDecoder("latin1");function validateKeyword(qe){if(validateLatin1(qe),qe.length===0||qe.length>79)throw new Error("keyword length must be between 1 and 79")}const latin1Regex=/^[\u0000-\u00FF]*$/;function validateLatin1(qe){if(!latin1Regex.test(qe))throw new Error("invalid latin1 text")}function decodetEXt(qe,f,ze){const Ke=readKeyword(f);qe[Ke]=readLatin1(f,ze-Ke.length-1)}function encodetEXt(qe,f,ze){validateKeyword(f),validateLatin1(ze);const Ke=f.length+1+ze.length;qe.writeUint32(Ke),qe.writeChars(textChunkName),qe.writeChars(f),qe.writeByte(NULL),qe.writeChars(ze),writeCrc(qe,Ke+4)}function readKeyword(qe){for(qe.mark();qe.readByte()!==NULL;);const f=qe.offset;qe.reset();const ze=latin1Decoder.decode(qe.readBytes(f-qe.offset-1));return qe.skip(1),validateKeyword(ze),ze}function readLatin1(qe,f){return latin1Decoder.decode(qe.readBytes(f))}const ColorType={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},CompressionMethod={UNKNOWN:-1,DEFLATE:0},FilterMethod={UNKNOWN:-1,ADAPTIVE:0},InterlaceMethod={UNKNOWN:-1,NO_INTERLACE:0};class PngDecoder extends IOBuffer{constructor(ze,Ke={}){super(ze);hc(this,"_checkCrc");hc(this,"_inflator");hc(this,"_png");hc(this,"_end");hc(this,"_hasPalette");hc(this,"_palette");hc(this,"_hasTransparency");hc(this,"_transparency");hc(this,"_compressionMethod");hc(this,"_filterMethod");hc(this,"_interlaceMethod");hc(this,"_colorType");const{checkCrc:Qe=!1}=Ke;this._checkCrc=Qe,this._inflator=new Inflate_1,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=CompressionMethod.UNKNOWN,this._filterMethod=FilterMethod.UNKNOWN,this._interlaceMethod=InterlaceMethod.UNKNOWN,this._colorType=ColorType.UNKNOWN,this.setBigEndian()}decode(){for(checkSignature(this);!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeChunk(){const ze=this.readUint32(),Ke=this.readChars(4),Qe=this.offset;switch(Ke){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(ze);break;case"IDAT":this.decodeIDAT(ze);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(ze);break;case"iCCP":this.decodeiCCP(ze);break;case textChunkName:decodetEXt(this._png.text,this,ze);break;case"pHYs":this.decodepHYs();break;default:this.skip(ze);break}if(this.offset-Qe!==ze)throw new Error(`Length mismatch while decoding chunk ${Ke}`);this._checkCrc?checkCrc(this,ze+4,Ke):this.skip(4)}decodeIHDR(){const ze=this._png;ze.width=this.readUint32(),ze.height=this.readUint32(),ze.depth=checkBitDepth(this.readUint8());const Ke=this.readUint8();this._colorType=Ke;let Qe;switch(Ke){case ColorType.GREYSCALE:Qe=1;break;case ColorType.TRUECOLOUR:Qe=3;break;case ColorType.INDEXED_COLOUR:Qe=1;break;case ColorType.GREYSCALE_ALPHA:Qe=2;break;case ColorType.TRUECOLOUR_ALPHA:Qe=4;break;case ColorType.UNKNOWN:default:throw new Error(`Unknown color type: ${Ke}`)}if(this._png.channels=Qe,this._compressionMethod=this.readUint8(),this._compressionMethod!==CompressionMethod.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(ze){if(ze%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${ze}`);const Ke=ze/3;this._hasPalette=!0;const Qe=[];this._palette=Qe;for(let Pi=0;Pi<Ke;Pi++)Qe.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(ze){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,ze)),this.skip(ze)}decodetRNS(ze){switch(this._colorType){case ColorType.GREYSCALE:case ColorType.TRUECOLOUR:{if(ze%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${ze}`);if(ze/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${ze/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(ze/2);for(let Ke=0;Ke<ze/2;Ke++)this._transparency[Ke]=this.readUint16();break}case ColorType.INDEXED_COLOUR:{if(ze>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${ze} vs ${this._palette.length})`);let Ke=0;for(;Ke<ze;Ke++){const Qe=this.readByte();this._palette[Ke].push(Qe)}for(;Ke<this._palette.length;Ke++)this._palette[Ke].push(255);break}case ColorType.UNKNOWN:case ColorType.GREYSCALE_ALPHA:case ColorType.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(ze){const Ke=readKeyword(this),Qe=this.readUint8();if(Qe!==CompressionMethod.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${Qe}`);const Pi=this.readBytes(ze-Ke.length-2);this._png.iccEmbeddedProfile={name:Ke,profile:inflate_1(Pi)}}decodepHYs(){const ze=this.readUint32(),Ke=this.readUint32(),Qe=this.readByte();this._png.resolution={x:ze,y:Ke,unit:Qe}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const ze=this._inflator.result;if(this._filterMethod!==FilterMethod.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===InterlaceMethod.NO_INTERLACE)this._png.data=decodeInterlaceNull({data:ze,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}}function checkBitDepth(qe){if(qe!==1&&qe!==2&&qe!==4&&qe!==8&&qe!==16)throw new Error(`invalid bit depth: ${qe}`);return qe}const defaultZlibOptions={level:3};class PngEncoder extends IOBuffer{constructor(ze,Ke={}){super();hc(this,"_png");hc(this,"_zlibOptions");hc(this,"_colorType");this._colorType=ColorType.UNKNOWN,this._zlibOptions={...defaultZlibOptions,...Ke.zlib},this._png=this._checkData(ze),this.setBigEndian()}encode(){if(writeSignature(this),this.encodeIHDR(),this.encodeData(),this._png.text)for(const[ze,Ke]of Object.entries(this._png.text))encodetEXt(this,ze,Ke);return this.encodeIEND(),this.toArray()}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(CompressionMethod.DEFLATE),this.writeByte(FilterMethod.ADAPTIVE),this.writeByte(InterlaceMethod.NO_INTERLACE),writeCrc(this,17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),writeCrc(this,4)}encodeIDAT(ze){this.writeUint32(ze.length),this.writeChars("IDAT"),this.writeBytes(ze),writeCrc(this,ze.length+4)}encodeData(){const{width:ze,height:Ke,channels:Qe,depth:Pi,data:nn}=this._png,ln=Qe*ze,cn=new IOBuffer().setBigEndian();let hn=0;for(let Xn=0;Xn<Ke;Xn++)if(cn.writeByte(0),Pi===8)hn=writeDataBytes(nn,cn,ln,hn);else if(Pi===16)hn=writeDataUint16(nn,cn,ln,hn);else throw new Error("unreachable");const un=cn.toArray(),zn=deflate_1(un,this._zlibOptions);this.encodeIDAT(zn)}_checkData(ze){const{colorType:Ke,channels:Qe,depth:Pi}=getColorType(ze),nn={width:checkInteger(ze.width,"width"),height:checkInteger(ze.height,"height"),channels:Qe,data:ze.data,depth:Pi,text:ze.text};this._colorType=Ke;const ln=nn.width*nn.height*Qe;if(nn.data.length!==ln)throw new RangeError(`wrong data size. Found ${nn.data.length}, expected ${ln}`);return nn}}function checkInteger(qe,f){if(Number.isInteger(qe)&&qe>0)return qe;throw new TypeError(`${f} must be a positive integer`)}function getColorType(qe){const{channels:f=4,depth:ze=8}=qe;if(f!==4&&f!==3&&f!==2&&f!==1)throw new RangeError(`unsupported number of channels: ${f}`);if(ze!==8&&ze!==16)throw new RangeError(`unsupported bit depth: ${ze}`);const Ke={channels:f,depth:ze,colorType:ColorType.UNKNOWN};switch(f){case 4:Ke.colorType=ColorType.TRUECOLOUR_ALPHA;break;case 3:Ke.colorType=ColorType.TRUECOLOUR;break;case 1:Ke.colorType=ColorType.GREYSCALE;break;case 2:Ke.colorType=ColorType.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return Ke}function writeDataBytes(qe,f,ze,Ke){for(let Qe=0;Qe<ze;Qe++)f.writeByte(qe[Ke++]);return Ke}function writeDataUint16(qe,f,ze,Ke){for(let Qe=0;Qe<ze;Qe++)f.writeUint16(qe[Ke++]);return Ke}var ResolutionUnitSpecifier;(function(qe){qe[qe.UNKNOWN=0]="UNKNOWN",qe[qe.METRE=1]="METRE"})(ResolutionUnitSpecifier||(ResolutionUnitSpecifier={}));function decodePng(qe,f){return new PngDecoder(qe,f).decode()}function encodePng$1(qe,f){return new PngEncoder(qe,f).encode()}var encoder={exports:{}},hasRequiredEncoder;function requireEncoder(){return hasRequiredEncoder||(hasRequiredEncoder=1,function(qe){function f(Ke){var Qe=Math.floor,Pi=new Array(64),nn=new Array(64),ln=new Array(64),cn=new Array(64),hn,un,zn,Xn,Un=new Array(65535),qn=new Array(65535),ys=new Array(64),vs=new Array(64),ea=[],na=0,ta=7,ra=new Array(64),oa=new Array(64),fa=new Array(64),ca=new Array(256),la=new Array(2048),ua,ga=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],da=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],qa=[0,1,2,3,4,5,6,7,8,9,10,11],tl=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],ol=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],hl=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],wl=[0,1,2,3,4,5,6,7,8,9,10,11],_l=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],gl=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function dl(ml){for(var Vl=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],jl=0;jl<64;jl++){var Xl=Qe((Vl[jl]*ml+50)/100);Xl<1?Xl=1:Xl>255&&(Xl=255),Pi[ga[jl]]=Xl}for(var yl=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Yl=0;Yl<64;Yl++){var Rl=Qe((yl[Yl]*ml+50)/100);Rl<1?Rl=1:Rl>255&&(Rl=255),nn[ga[Yl]]=Rl}for(var Hl=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Wl=0,zl=0;zl<8;zl++)for(var Gl=0;Gl<8;Gl++)ln[Wl]=1/(Pi[ga[Wl]]*Hl[zl]*Hl[Gl]*8),cn[Wl]=1/(nn[ga[Wl]]*Hl[zl]*Hl[Gl]*8),Wl++}function sl(ml,Vl){for(var jl=0,Xl=0,yl=new Array,Yl=1;Yl<=16;Yl++){for(var Rl=1;Rl<=ml[Yl];Rl++)yl[Vl[Xl]]=[],yl[Vl[Xl]][0]=jl,yl[Vl[Xl]][1]=Yl,Xl++,jl++;jl*=2}return yl}function kl(){hn=sl(da,qa),un=sl(hl,wl),zn=sl(tl,ol),Xn=sl(_l,gl)}function pl(){for(var ml=1,Vl=2,jl=1;jl<=15;jl++){for(var Xl=ml;Xl<Vl;Xl++)qn[32767+Xl]=jl,Un[32767+Xl]=[],Un[32767+Xl][1]=jl,Un[32767+Xl][0]=Xl;for(var yl=-(Vl-1);yl<=-ml;yl++)qn[32767+yl]=jl,Un[32767+yl]=[],Un[32767+yl][1]=jl,Un[32767+yl][0]=Vl-1+yl;ml<<=1,Vl<<=1}}function Al(){for(var ml=0;ml<256;ml++)la[ml]=19595*ml,la[ml+256>>0]=38470*ml,la[ml+512>>0]=7471*ml+32768,la[ml+768>>0]=-11059*ml,la[ml+1024>>0]=-21709*ml,la[ml+1280>>0]=32768*ml+8421375,la[ml+1536>>0]=-27439*ml,la[ml+1792>>0]=-5329*ml}function xl(ml){for(var Vl=ml[0],jl=ml[1]-1;jl>=0;)Vl&1<<jl&&(na|=1<<ta),jl--,ta--,ta<0&&(na==255?(al(255),al(0)):al(na),ta=7,na=0)}function al(ml){ea.push(ml)}function Fl(ml){al(ml>>8&255),al(ml&255)}function Ol(ml,Vl){var jl,Xl,yl,Yl,Rl,Hl,Wl,zl,Gl=0,Jl,ql=8,Zl=64;for(Jl=0;Jl<ql;++Jl){jl=ml[Gl],Xl=ml[Gl+1],yl=ml[Gl+2],Yl=ml[Gl+3],Rl=ml[Gl+4],Hl=ml[Gl+5],Wl=ml[Gl+6],zl=ml[Gl+7];var Ql=jl+zl,ec=jl-zl,tc=Xl+Wl,ac=Xl-Wl,oc=yl+Hl,fc=yl-Hl,yc=Yl+Rl,Cc=Yl-Rl,pc=Ql+yc,xc=Ql-yc,bc=tc+oc,mc=tc-oc;ml[Gl]=pc+bc,ml[Gl+4]=pc-bc;var uc=(mc+xc)*.707106781;ml[Gl+2]=xc+uc,ml[Gl+6]=xc-uc,pc=Cc+fc,bc=fc+ac,mc=ac+ec;var Sc=(pc-mc)*.382683433,sa=.5411961*pc+Sc,bs=1.306562965*mc+Sc,xs=bc*.707106781,Kn=ec+xs,Cs=ec-xs;ml[Gl+5]=Cs+sa,ml[Gl+3]=Cs-sa,ml[Gl+1]=Kn+bs,ml[Gl+7]=Kn-bs,Gl+=8}for(Gl=0,Jl=0;Jl<ql;++Jl){jl=ml[Gl],Xl=ml[Gl+8],yl=ml[Gl+16],Yl=ml[Gl+24],Rl=ml[Gl+32],Hl=ml[Gl+40],Wl=ml[Gl+48],zl=ml[Gl+56];var ia=jl+zl,Za=jl-zl,Ja=Xl+Wl,Qa=Xl-Wl,aa=yl+Hl,pa=yl-Hl,ha=Yl+Rl,Ma=Yl-Rl,Ka=ia+ha,Na=ia-ha,el=Ja+aa,fl=Ja-aa;ml[Gl]=Ka+el,ml[Gl+32]=Ka-el;var Ua=(fl+Na)*.707106781;ml[Gl+16]=Na+Ua,ml[Gl+48]=Na-Ua,Ka=Ma+pa,el=pa+Qa,fl=Qa+Za;var il=(Ka-fl)*.382683433,ll=.5411961*Ka+il,Tl=1.306562965*fl+il,Dl=el*.707106781,Nl=Za+Dl,bl=Za-Dl;ml[Gl+40]=bl+ll,ml[Gl+24]=bl-ll,ml[Gl+8]=Nl+Tl,ml[Gl+56]=Nl-Tl,Gl++}var Cl;for(Jl=0;Jl<Zl;++Jl)Cl=ml[Jl]*Vl[Jl],ys[Jl]=Cl>0?Cl+.5|0:Cl-.5|0;return ys}function Jo(){Fl(65504),Fl(16),al(74),al(70),al(73),al(70),al(0),al(1),al(1),al(0),Fl(1),Fl(1),al(0),al(0)}function cl(ml){if(ml){Fl(65505),ml[0]===69&&ml[1]===120&&ml[2]===105&&ml[3]===102?Fl(ml.length+2):(Fl(ml.length+5+2),al(69),al(120),al(105),al(102),al(0));for(var Vl=0;Vl<ml.length;Vl++)al(ml[Vl])}}function rl(ml,Vl){Fl(65472),Fl(17),al(8),Fl(Vl),Fl(ml),al(3),al(1),al(17),al(0),al(2),al(17),al(1),al(3),al(17),al(1)}function nl(){Fl(65499),Fl(132),al(0);for(var ml=0;ml<64;ml++)al(Pi[ml]);al(1);for(var Vl=0;Vl<64;Vl++)al(nn[Vl])}function vl(){Fl(65476),Fl(418),al(0);for(var ml=0;ml<16;ml++)al(da[ml+1]);for(var Vl=0;Vl<=11;Vl++)al(qa[Vl]);al(16);for(var jl=0;jl<16;jl++)al(tl[jl+1]);for(var Xl=0;Xl<=161;Xl++)al(ol[Xl]);al(1);for(var yl=0;yl<16;yl++)al(hl[yl+1]);for(var Yl=0;Yl<=11;Yl++)al(wl[Yl]);al(17);for(var Rl=0;Rl<16;Rl++)al(_l[Rl+1]);for(var Hl=0;Hl<=161;Hl++)al(gl[Hl])}function Pl(ml){typeof ml>"u"||ml.constructor!==Array||ml.forEach(Vl=>{if(typeof Vl=="string"){Fl(65534);var jl=Vl.length;Fl(jl+2);var Xl;for(Xl=0;Xl<jl;Xl++)al(Vl.charCodeAt(Xl))}})}function Sl(){Fl(65498),Fl(12),al(3),al(1),al(0),al(2),al(17),al(3),al(17),al(0),al(63),al(0)}function El(ml,Vl,jl,Xl,yl){for(var Yl=yl[0],Rl=yl[240],Hl,Wl=16,zl=63,Gl=64,Jl=Ol(ml,Vl),ql=0;ql<Gl;++ql)vs[ga[ql]]=Jl[ql];var Zl=vs[0]-jl;jl=vs[0],Zl==0?xl(Xl[0]):(Hl=32767+Zl,xl(Xl[qn[Hl]]),xl(Un[Hl]));for(var Ql=63;Ql>0&&vs[Ql]==0;Ql--);if(Ql==0)return xl(Yl),jl;for(var ec=1,tc;ec<=Ql;){for(var ac=ec;vs[ec]==0&&ec<=Ql;++ec);var oc=ec-ac;if(oc>=Wl){tc=oc>>4;for(var fc=1;fc<=tc;++fc)xl(Rl);oc=oc&15}Hl=32767+vs[ec],xl(yl[(oc<<4)+qn[Hl]]),xl(Un[Hl]),ec++}return Ql!=zl&&xl(Yl),jl}function Il(){for(var ml=String.fromCharCode,Vl=0;Vl<256;Vl++)ca[Vl]=ml(Vl)}this.encode=function(ml,Vl){new Date().getTime(),Vl&&$l(Vl),ea=new Array,na=0,ta=7,Fl(65496),Jo(),Pl(ml.comments),cl(ml.exifBuffer),nl(),rl(ml.width,ml.height),vl(),Sl();var jl=0,Xl=0,yl=0;na=0,ta=7,this.encode.displayName="_encode_";for(var Yl=ml.data,Rl=ml.width,Hl=ml.height,Wl=Rl*4,zl,Gl=0,Jl,ql,Zl,Ql,ec,tc,ac,oc;Gl<Hl;){for(zl=0;zl<Wl;){for(Ql=Wl*Gl+zl,ec=Ql,tc=-1,ac=0,oc=0;oc<64;oc++)ac=oc>>3,tc=(oc&7)*4,ec=Ql+ac*Wl+tc,Gl+ac>=Hl&&(ec-=Wl*(Gl+1+ac-Hl)),zl+tc>=Wl&&(ec-=zl+tc-Wl+4),Jl=Yl[ec++],ql=Yl[ec++],Zl=Yl[ec++],ra[oc]=(la[Jl]+la[ql+256>>0]+la[Zl+512>>0]>>16)-128,oa[oc]=(la[Jl+768>>0]+la[ql+1024>>0]+la[Zl+1280>>0]>>16)-128,fa[oc]=(la[Jl+1280>>0]+la[ql+1536>>0]+la[Zl+1792>>0]>>16)-128;jl=El(ra,ln,jl,hn,zn),Xl=El(oa,cn,Xl,un,Xn),yl=El(fa,cn,yl,un,Xn),zl+=32}Gl+=8}if(ta>=0){var fc=[];fc[1]=ta+1,fc[0]=(1<<ta+1)-1,xl(fc)}return Fl(65497),Buffer.from(ea)};function $l(ml){if(ml<=0&&(ml=1),ml>100&&(ml=100),ua!=ml){var Vl=0;ml<50?Vl=Math.floor(5e3/ml):Vl=Math.floor(200-ml*2),dl(Vl),ua=ml}}function Ll(){var ml=new Date().getTime();Ke||(Ke=50),Il(),kl(),pl(),Al(),$l(Ke),new Date().getTime()-ml}Ll()}qe.exports=ze;function ze(Ke,Qe){typeof Qe>"u"&&(Qe=50);var Pi=new f(Qe),nn=Pi.encode(Ke,Qe);return{data:nn,width:Ke.width,height:Ke.height}}}(encoder)),encoder.exports}var decoder={exports:{}},hasRequiredDecoder;function requireDecoder(){return hasRequiredDecoder||(hasRequiredDecoder=1,function(qe){var f=function(){var Qe=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),Pi=4017,nn=799,ln=3406,cn=2276,hn=1567,un=3784,zn=5793,Xn=2896;function Un(){}function qn(oa,fa){for(var ca=0,la=[],ua,ga,da=16;da>0&&!oa[da-1];)da--;la.push({children:[],index:0});var qa=la[0],tl;for(ua=0;ua<da;ua++){for(ga=0;ga<oa[ua];ga++){for(qa=la.pop(),qa.children[qa.index]=fa[ca];qa.index>0;){if(la.length===0)throw new Error("Could not recreate Huffman Table");qa=la.pop()}for(qa.index++,la.push(qa);la.length<=ua;)la.push(tl={children:[],index:0}),qa.children[qa.index]=tl.children,qa=tl;ca++}ua+1<da&&(la.push(tl={children:[],index:0}),qa.children[qa.index]=tl.children,qa=tl)}return la[0].children}function ys(oa,fa,ca,la,ua,ga,da,qa,tl,ol){ca.precision,ca.samplesPerLine,ca.scanLines;var hl=ca.mcusPerLine,wl=ca.progressive;ca.maxH,ca.maxV;var _l=fa,gl=0,dl=0;function sl(){if(dl>0)return dl--,gl>>dl&1;if(gl=oa[fa++],gl==255){var Hl=oa[fa++];if(Hl)throw new Error("unexpected marker: "+(gl<<8|Hl).toString(16))}return dl=7,gl>>>7}function kl(Hl){for(var Wl=Hl,zl;(zl=sl())!==null;){if(Wl=Wl[zl],typeof Wl=="number")return Wl;if(typeof Wl!="object")throw new Error("invalid huffman sequence")}return null}function pl(Hl){for(var Wl=0;Hl>0;){var zl=sl();if(zl===null)return;Wl=Wl<<1|zl,Hl--}return Wl}function Al(Hl){var Wl=pl(Hl);return Wl>=1<<Hl-1?Wl:Wl+(-1<<Hl)+1}function xl(Hl,Wl){var zl=kl(Hl.huffmanTableDC),Gl=zl===0?0:Al(zl);Wl[0]=Hl.pred+=Gl;for(var Jl=1;Jl<64;){var ql=kl(Hl.huffmanTableAC),Zl=ql&15,Ql=ql>>4;if(Zl===0){if(Ql<15)break;Jl+=16;continue}Jl+=Ql;var ec=Qe[Jl];Wl[ec]=Al(Zl),Jl++}}function al(Hl,Wl){var zl=kl(Hl.huffmanTableDC),Gl=zl===0?0:Al(zl)<<tl;Wl[0]=Hl.pred+=Gl}function Fl(Hl,Wl){Wl[0]|=sl()<<tl}var Ol=0;function Jo(Hl,Wl){if(Ol>0){Ol--;return}for(var zl=ga,Gl=da;zl<=Gl;){var Jl=kl(Hl.huffmanTableAC),ql=Jl&15,Zl=Jl>>4;if(ql===0){if(Zl<15){Ol=pl(Zl)+(1<<Zl)-1;break}zl+=16;continue}zl+=Zl;var Ql=Qe[zl];Wl[Ql]=Al(ql)*(1<<tl),zl++}}var cl=0,rl;function nl(Hl,Wl){for(var zl=ga,Gl=da,Jl=0;zl<=Gl;){var ql=Qe[zl],Zl=Wl[ql]<0?-1:1;switch(cl){case 0:var Ql=kl(Hl.huffmanTableAC),ec=Ql&15,Jl=Ql>>4;if(ec===0)Jl<15?(Ol=pl(Jl)+(1<<Jl),cl=4):(Jl=16,cl=1);else{if(ec!==1)throw new Error("invalid ACn encoding");rl=Al(ec),cl=Jl?2:3}continue;case 1:case 2:Wl[ql]?Wl[ql]+=(sl()<<tl)*Zl:(Jl--,Jl===0&&(cl=cl==2?3:0));break;case 3:Wl[ql]?Wl[ql]+=(sl()<<tl)*Zl:(Wl[ql]=rl<<tl,cl=0);break;case 4:Wl[ql]&&(Wl[ql]+=(sl()<<tl)*Zl);break}zl++}cl===4&&(Ol--,Ol===0&&(cl=0))}function vl(Hl,Wl,zl,Gl,Jl){var ql=zl/hl|0,Zl=zl%hl,Ql=ql*Hl.v+Gl,ec=Zl*Hl.h+Jl;Hl.blocks[Ql]===void 0&&ol.tolerantDecoding||Wl(Hl,Hl.blocks[Ql][ec])}function Pl(Hl,Wl,zl){var Gl=zl/Hl.blocksPerLine|0,Jl=zl%Hl.blocksPerLine;Hl.blocks[Gl]===void 0&&ol.tolerantDecoding||Wl(Hl,Hl.blocks[Gl][Jl])}var Sl=la.length,El,Il,$l,Ll,ml,Vl;wl?ga===0?Vl=qa===0?al:Fl:Vl=qa===0?Jo:nl:Vl=xl;var jl=0,Xl,yl;Sl==1?yl=la[0].blocksPerLine*la[0].blocksPerColumn:yl=hl*ca.mcusPerColumn,ua||(ua=yl);for(var Yl,Rl;jl<yl;){for(Il=0;Il<Sl;Il++)la[Il].pred=0;if(Ol=0,Sl==1)for(El=la[0],ml=0;ml<ua;ml++)Pl(El,Vl,jl),jl++;else for(ml=0;ml<ua;ml++){for(Il=0;Il<Sl;Il++)for(El=la[Il],Yl=El.h,Rl=El.v,$l=0;$l<Rl;$l++)for(Ll=0;Ll<Yl;Ll++)vl(El,Vl,jl,$l,Ll);if(jl++,jl===yl)break}if(jl===yl)do{if(oa[fa]===255&&oa[fa+1]!==0)break;fa+=1}while(fa<oa.length-2);if(dl=0,Xl=oa[fa]<<8|oa[fa+1],Xl<65280)throw new Error("marker was not found");if(Xl>=65488&&Xl<=65495)fa+=2;else break}return fa-_l}function vs(oa,fa){var ca=[],la=fa.blocksPerLine,ua=fa.blocksPerColumn,ga=la<<3,da=new Int32Array(64),qa=new Uint8Array(64);function tl(pl,Al,xl){var al=fa.quantizationTable,Fl,Ol,Jo,cl,rl,nl,vl,Pl,Sl,El=xl,Il;for(Il=0;Il<64;Il++)El[Il]=pl[Il]*al[Il];for(Il=0;Il<8;++Il){var $l=8*Il;if(El[1+$l]==0&&El[2+$l]==0&&El[3+$l]==0&&El[4+$l]==0&&El[5+$l]==0&&El[6+$l]==0&&El[7+$l]==0){Sl=zn*El[0+$l]+512>>10,El[0+$l]=Sl,El[1+$l]=Sl,El[2+$l]=Sl,El[3+$l]=Sl,El[4+$l]=Sl,El[5+$l]=Sl,El[6+$l]=Sl,El[7+$l]=Sl;continue}Fl=zn*El[0+$l]+128>>8,Ol=zn*El[4+$l]+128>>8,Jo=El[2+$l],cl=El[6+$l],rl=Xn*(El[1+$l]-El[7+$l])+128>>8,Pl=Xn*(El[1+$l]+El[7+$l])+128>>8,nl=El[3+$l]<<4,vl=El[5+$l]<<4,Sl=Fl-Ol+1>>1,Fl=Fl+Ol+1>>1,Ol=Sl,Sl=Jo*un+cl*hn+128>>8,Jo=Jo*hn-cl*un+128>>8,cl=Sl,Sl=rl-vl+1>>1,rl=rl+vl+1>>1,vl=Sl,Sl=Pl+nl+1>>1,nl=Pl-nl+1>>1,Pl=Sl,Sl=Fl-cl+1>>1,Fl=Fl+cl+1>>1,cl=Sl,Sl=Ol-Jo+1>>1,Ol=Ol+Jo+1>>1,Jo=Sl,Sl=rl*cn+Pl*ln+2048>>12,rl=rl*ln-Pl*cn+2048>>12,Pl=Sl,Sl=nl*nn+vl*Pi+2048>>12,nl=nl*Pi-vl*nn+2048>>12,vl=Sl,El[0+$l]=Fl+Pl,El[7+$l]=Fl-Pl,El[1+$l]=Ol+vl,El[6+$l]=Ol-vl,El[2+$l]=Jo+nl,El[5+$l]=Jo-nl,El[3+$l]=cl+rl,El[4+$l]=cl-rl}for(Il=0;Il<8;++Il){var Ll=Il;if(El[8+Ll]==0&&El[16+Ll]==0&&El[24+Ll]==0&&El[32+Ll]==0&&El[40+Ll]==0&&El[48+Ll]==0&&El[56+Ll]==0){Sl=zn*xl[Il+0]+8192>>14,El[0+Ll]=Sl,El[8+Ll]=Sl,El[16+Ll]=Sl,El[24+Ll]=Sl,El[32+Ll]=Sl,El[40+Ll]=Sl,El[48+Ll]=Sl,El[56+Ll]=Sl;continue}Fl=zn*El[0+Ll]+2048>>12,Ol=zn*El[32+Ll]+2048>>12,Jo=El[16+Ll],cl=El[48+Ll],rl=Xn*(El[8+Ll]-El[56+Ll])+2048>>12,Pl=Xn*(El[8+Ll]+El[56+Ll])+2048>>12,nl=El[24+Ll],vl=El[40+Ll],Sl=Fl-Ol+1>>1,Fl=Fl+Ol+1>>1,Ol=Sl,Sl=Jo*un+cl*hn+2048>>12,Jo=Jo*hn-cl*un+2048>>12,cl=Sl,Sl=rl-vl+1>>1,rl=rl+vl+1>>1,vl=Sl,Sl=Pl+nl+1>>1,nl=Pl-nl+1>>1,Pl=Sl,Sl=Fl-cl+1>>1,Fl=Fl+cl+1>>1,cl=Sl,Sl=Ol-Jo+1>>1,Ol=Ol+Jo+1>>1,Jo=Sl,Sl=rl*cn+Pl*ln+2048>>12,rl=rl*ln-Pl*cn+2048>>12,Pl=Sl,Sl=nl*nn+vl*Pi+2048>>12,nl=nl*Pi-vl*nn+2048>>12,vl=Sl,El[0+Ll]=Fl+Pl,El[56+Ll]=Fl-Pl,El[8+Ll]=Ol+vl,El[48+Ll]=Ol-vl,El[16+Ll]=Jo+nl,El[40+Ll]=Jo-nl,El[24+Ll]=cl+rl,El[32+Ll]=cl-rl}for(Il=0;Il<64;++Il){var ml=128+(El[Il]+8>>4);Al[Il]=ml<0?0:ml>255?255:ml}}ra(ga*ua*8);for(var ol,hl,wl=0;wl<ua;wl++){var _l=wl<<3;for(ol=0;ol<8;ol++)ca.push(new Uint8Array(ga));for(var gl=0;gl<la;gl++){tl(fa.blocks[wl][gl],qa,da);var dl=0,sl=gl<<3;for(hl=0;hl<8;hl++){var kl=ca[_l+hl];for(ol=0;ol<8;ol++)kl[sl+ol]=qa[dl++]}}}return ca}function ea(oa){return oa<0?0:oa>255?255:oa}Un.prototype={load:function(fa){var ca=new XMLHttpRequest;ca.open("GET",fa,!0),ca.responseType="arraybuffer",ca.onload=(function(){var la=new Uint8Array(ca.response||ca.mozResponseArrayBuffer);this.parse(la),this.onload&&this.onload()}).bind(this),ca.send(null)},parse:function(fa){var ca=this.opts.maxResolutionInMP*1e3*1e3,la=0;fa.length;function ua(){var Zl=fa[la]<<8|fa[la+1];return la+=2,Zl}function ga(){var Zl=ua(),Ql=fa.subarray(la,la+Zl-2);return la+=Ql.length,Ql}function da(Zl){var Ql=1,ec=1,tc,ac;for(ac in Zl.components)Zl.components.hasOwnProperty(ac)&&(tc=Zl.components[ac],Ql<tc.h&&(Ql=tc.h),ec<tc.v&&(ec=tc.v));var oc=Math.ceil(Zl.samplesPerLine/8/Ql),fc=Math.ceil(Zl.scanLines/8/ec);for(ac in Zl.components)if(Zl.components.hasOwnProperty(ac)){tc=Zl.components[ac];var yc=Math.ceil(Math.ceil(Zl.samplesPerLine/8)*tc.h/Ql),Cc=Math.ceil(Math.ceil(Zl.scanLines/8)*tc.v/ec),pc=oc*tc.h,xc=fc*tc.v,bc=xc*pc,mc=[];ra(bc*256);for(var uc=0;uc<xc;uc++){for(var Sc=[],sa=0;sa<pc;sa++)Sc.push(new Int32Array(64));mc.push(Sc)}tc.blocksPerLine=yc,tc.blocksPerColumn=Cc,tc.blocks=mc}Zl.maxH=Ql,Zl.maxV=ec,Zl.mcusPerLine=oc,Zl.mcusPerColumn=fc}var qa=null,tl=null,ol,hl,wl=[],_l=[],gl=[],dl=[],sl=ua(),kl=-1;if(this.comments=[],sl!=65496)throw new Error("SOI not found");for(sl=ua();sl!=65497;){var pl,Al;switch(sl){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var xl=ga();if(sl===65534){var al=String.fromCharCode.apply(null,xl);this.comments.push(al)}sl===65504&&xl[0]===74&&xl[1]===70&&xl[2]===73&&xl[3]===70&&xl[4]===0&&(qa={version:{major:xl[5],minor:xl[6]},densityUnits:xl[7],xDensity:xl[8]<<8|xl[9],yDensity:xl[10]<<8|xl[11],thumbWidth:xl[12],thumbHeight:xl[13],thumbData:xl.subarray(14,14+3*xl[12]*xl[13])}),sl===65505&&xl[0]===69&&xl[1]===120&&xl[2]===105&&xl[3]===102&&xl[4]===0&&(this.exifBuffer=xl.subarray(5,xl.length)),sl===65518&&xl[0]===65&&xl[1]===100&&xl[2]===111&&xl[3]===98&&xl[4]===101&&xl[5]===0&&(tl={version:xl[6],flags0:xl[7]<<8|xl[8],flags1:xl[9]<<8|xl[10],transformCode:xl[11]});break;case 65499:for(var Fl=ua(),Ol=Fl+la-2;la<Ol;){var Jo=fa[la++];ra(256);var cl=new Int32Array(64);if(Jo>>4===0)for(Al=0;Al<64;Al++){var rl=Qe[Al];cl[rl]=fa[la++]}else if(Jo>>4===1)for(Al=0;Al<64;Al++){var rl=Qe[Al];cl[rl]=ua()}else throw new Error("DQT: invalid table spec");wl[Jo&15]=cl}break;case 65472:case 65473:case 65474:ua(),ol={},ol.extended=sl===65473,ol.progressive=sl===65474,ol.precision=fa[la++],ol.scanLines=ua(),ol.samplesPerLine=ua(),ol.components={},ol.componentsOrder=[];var nl=ol.scanLines*ol.samplesPerLine;if(nl>ca){var vl=Math.ceil((nl-ca)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${vl}MP`)}var Pl=fa[la++],Sl;for(pl=0;pl<Pl;pl++){Sl=fa[la];var El=fa[la+1]>>4,Il=fa[la+1]&15,$l=fa[la+2];if(El<=0||Il<=0)throw new Error("Invalid sampling factor, expected values above 0");ol.componentsOrder.push(Sl),ol.components[Sl]={h:El,v:Il,quantizationIdx:$l},la+=3}da(ol),_l.push(ol);break;case 65476:var Ll=ua();for(pl=2;pl<Ll;){var ml=fa[la++],Vl=new Uint8Array(16),jl=0;for(Al=0;Al<16;Al++,la++)jl+=Vl[Al]=fa[la];ra(16+jl);var Xl=new Uint8Array(jl);for(Al=0;Al<jl;Al++,la++)Xl[Al]=fa[la];pl+=17+jl,(ml>>4===0?dl:gl)[ml&15]=qn(Vl,Xl)}break;case 65501:ua(),hl=ua();break;case 65500:ua(),ua();break;case 65498:ua();var yl=fa[la++],Yl=[],Rl;for(pl=0;pl<yl;pl++){Rl=ol.components[fa[la++]];var Hl=fa[la++];Rl.huffmanTableDC=dl[Hl>>4],Rl.huffmanTableAC=gl[Hl&15],Yl.push(Rl)}var Wl=fa[la++],zl=fa[la++],Gl=fa[la++],Jl=ys(fa,la,ol,Yl,hl,Wl,zl,Gl>>4,Gl&15,this.opts);la+=Jl;break;case 65535:fa[la]!==255&&la--;break;default:if(fa[la-3]==255&&fa[la-2]>=192&&fa[la-2]<=254){la-=3;break}else if(sl===224||sl==225){if(kl!==-1)throw new Error(`first unknown JPEG marker at offset ${kl.toString(16)}, second unknown JPEG marker ${sl.toString(16)} at offset ${(la-1).toString(16)}`);kl=la-1;const Zl=ua();if(fa[la+Zl-2]===255){la+=Zl-2;break}}throw new Error("unknown JPEG marker "+sl.toString(16))}sl=ua()}if(_l.length!=1)throw new Error("only single frame JPEGs supported");for(var pl=0;pl<_l.length;pl++){var ql=_l[pl].components;for(var Al in ql)ql[Al].quantizationTable=wl[ql[Al].quantizationIdx],delete ql[Al].quantizationIdx}this.width=ol.samplesPerLine,this.height=ol.scanLines,this.jfif=qa,this.adobe=tl,this.components=[];for(var pl=0;pl<ol.componentsOrder.length;pl++){var Rl=ol.components[ol.componentsOrder[pl]];this.components.push({lines:vs(ol,Rl),scaleX:Rl.h/ol.maxH,scaleY:Rl.v/ol.maxV})}},getData:function(fa,ca){var la=this.width/fa,ua=this.height/ca,ga,da,qa,tl,ol,hl,wl,_l,gl,dl,sl=0,kl,pl,Al,xl,al,Fl,Ol,Jo,cl,rl,nl,vl=fa*ca*this.components.length;ra(vl);var Pl=new Uint8Array(vl);switch(this.components.length){case 1:for(ga=this.components[0],dl=0;dl<ca;dl++)for(ol=ga.lines[0|dl*ga.scaleY*ua],gl=0;gl<fa;gl++)kl=ol[0|gl*ga.scaleX*la],Pl[sl++]=kl;break;case 2:for(ga=this.components[0],da=this.components[1],dl=0;dl<ca;dl++)for(ol=ga.lines[0|dl*ga.scaleY*ua],hl=da.lines[0|dl*da.scaleY*ua],gl=0;gl<fa;gl++)kl=ol[0|gl*ga.scaleX*la],Pl[sl++]=kl,kl=hl[0|gl*da.scaleX*la],Pl[sl++]=kl;break;case 3:for(nl=!0,this.adobe&&this.adobe.transformCode?nl=!0:typeof this.opts.colorTransform<"u"&&(nl=!!this.opts.colorTransform),ga=this.components[0],da=this.components[1],qa=this.components[2],dl=0;dl<ca;dl++)for(ol=ga.lines[0|dl*ga.scaleY*ua],hl=da.lines[0|dl*da.scaleY*ua],wl=qa.lines[0|dl*qa.scaleY*ua],gl=0;gl<fa;gl++)nl?(kl=ol[0|gl*ga.scaleX*la],pl=hl[0|gl*da.scaleX*la],Al=wl[0|gl*qa.scaleX*la],Jo=ea(kl+1.402*(Al-128)),cl=ea(kl-.3441363*(pl-128)-.71413636*(Al-128)),rl=ea(kl+1.772*(pl-128))):(Jo=ol[0|gl*ga.scaleX*la],cl=hl[0|gl*da.scaleX*la],rl=wl[0|gl*qa.scaleX*la]),Pl[sl++]=Jo,Pl[sl++]=cl,Pl[sl++]=rl;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(nl=!1,this.adobe&&this.adobe.transformCode?nl=!0:typeof this.opts.colorTransform<"u"&&(nl=!!this.opts.colorTransform),ga=this.components[0],da=this.components[1],qa=this.components[2],tl=this.components[3],dl=0;dl<ca;dl++)for(ol=ga.lines[0|dl*ga.scaleY*ua],hl=da.lines[0|dl*da.scaleY*ua],wl=qa.lines[0|dl*qa.scaleY*ua],_l=tl.lines[0|dl*tl.scaleY*ua],gl=0;gl<fa;gl++)nl?(kl=ol[0|gl*ga.scaleX*la],pl=hl[0|gl*da.scaleX*la],Al=wl[0|gl*qa.scaleX*la],xl=_l[0|gl*tl.scaleX*la],al=255-ea(kl+1.402*(Al-128)),Fl=255-ea(kl-.3441363*(pl-128)-.71413636*(Al-128)),Ol=255-ea(kl+1.772*(pl-128))):(al=ol[0|gl*ga.scaleX*la],Fl=hl[0|gl*da.scaleX*la],Ol=wl[0|gl*qa.scaleX*la],xl=_l[0|gl*tl.scaleX*la]),Pl[sl++]=255-al,Pl[sl++]=255-Fl,Pl[sl++]=255-Ol,Pl[sl++]=255-xl;break;default:throw new Error("Unsupported color mode")}return Pl},copyToImageData:function(fa,ca){var la=fa.width,ua=fa.height,ga=fa.data,da=this.getData(la,ua),qa=0,tl=0,ol,hl,wl,_l,gl,dl,sl,kl,pl;switch(this.components.length){case 1:for(hl=0;hl<ua;hl++)for(ol=0;ol<la;ol++)wl=da[qa++],ga[tl++]=wl,ga[tl++]=wl,ga[tl++]=wl,ca&&(ga[tl++]=255);break;case 3:for(hl=0;hl<ua;hl++)for(ol=0;ol<la;ol++)sl=da[qa++],kl=da[qa++],pl=da[qa++],ga[tl++]=sl,ga[tl++]=kl,ga[tl++]=pl,ca&&(ga[tl++]=255);break;case 4:for(hl=0;hl<ua;hl++)for(ol=0;ol<la;ol++)gl=da[qa++],dl=da[qa++],wl=da[qa++],_l=da[qa++],sl=255-ea(gl*(1-_l/255)+_l),kl=255-ea(dl*(1-_l/255)+_l),pl=255-ea(wl*(1-_l/255)+_l),ga[tl++]=sl,ga[tl++]=kl,ga[tl++]=pl,ca&&(ga[tl++]=255);break;default:throw new Error("Unsupported color mode")}}};var na=0,ta=0;function ra(oa=0){var fa=na+oa;if(fa>ta){var ca=Math.ceil((fa-ta)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${ca}MB`)}na=fa}return Un.resetMaxMemoryUsage=function(oa){na=0,ta=oa},Un.getBytesAllocated=function(){return na},Un.requestMemoryAllocation=ra,Un}();qe.exports=ze;function ze(Ke,Qe={}){var Pi={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},nn={...Pi,...Qe},ln=new Uint8Array(Ke),cn=new f;cn.opts=nn,f.resetMaxMemoryUsage(nn.maxMemoryUsageInMB*1024*1024),cn.parse(ln);var hn=nn.formatAsRGBA?4:3,un=cn.width*cn.height*hn;try{f.requestMemoryAllocation(un);var zn={width:cn.width,height:cn.height,exifBuffer:cn.exifBuffer,data:nn.useTArray?new Uint8Array(un):Buffer.alloc(un)};cn.comments.length>0&&(zn.comments=cn.comments)}catch(Xn){throw Xn instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+un):Xn instanceof ReferenceError&&Xn.message==="Buffer is not defined"?new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true"):Xn}return cn.copyToImageData(zn,nn.formatAsRGBA),zn}}(decoder)),decoder.exports}var jpegJs,hasRequiredJpegJs;function requireJpegJs(){if(hasRequiredJpegJs)return jpegJs;hasRequiredJpegJs=1;var qe=requireEncoder(),f=requireDecoder();return jpegJs={encode:qe,decode:f},jpegJs}var jpegJsExports=requireJpegJs();let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256);for(let qe=0;qe<chars.length;qe++)lookup[chars.charCodeAt(qe)]=qe;function encode$2(qe){let f,ze=qe.length,Ke="";for(f=0;f<ze;f+=3)Ke+=chars[qe[f]>>2],Ke+=chars[(qe[f]&3)<<4|qe[f+1]>>4],Ke+=chars[(qe[f+1]&15)<<2|qe[f+2]>>6],Ke+=chars[qe[f+2]&63];return ze%3===2?Ke=`${Ke.substring(0,Ke.length-1)}=`:ze%3===1&&(Ke=`${Ke.substring(0,Ke.length-2)}==`),Ke}function decode$1(qe){let f=qe.length*.75,ze=qe.length,Ke=0,Qe,Pi,nn,ln;qe[qe.length-1]==="="&&(f--,qe[qe.length-2]==="="&&f--);const cn=new Uint8Array(f);for(let hn=0;hn<ze;hn+=4)Qe=lookup[qe.charCodeAt(hn)],Pi=lookup[qe.charCodeAt(hn+1)],nn=lookup[qe.charCodeAt(hn+2)],ln=lookup[qe.charCodeAt(hn+3)],cn[Ke++]=Qe<<2|Pi>>4,cn[Ke++]=(Pi&15)<<4|nn>>2,cn[Ke++]=(nn&3)<<6|ln&63;return cn}function toBase64URL(qe,f){const ze=encode$2(qe);return`data:${f};base64,${ze}`}const ImageData$1=self.ImageData,DOMImage=self.Image;function createCanvas(qe,f){let ze=self.document.createElement("canvas");return ze.width=qe,ze.height=f,ze}function fetchBinary(qe,{withCredentials:f=!1}={}){return new Promise(function(ze,Ke){let Qe=new self.XMLHttpRequest;Qe.open("GET",qe,!0),Qe.responseType="arraybuffer",Qe.withCredentials=f,Qe.onload=function(Pi){this.status!==200?Ke(Pi):ze(this.response)},Qe.onerror=Ke,Qe.send()})}function createWriteStream(){throw new Error("createWriteStream does not exist in the browser")}function writeFile(){throw new Error("writeFile does not exist in the browser")}function getType(qe){return qe.includes("/")||(qe=`image/${qe}`),qe}function encodeJpeg(qe,f={}){const ze={width:qe.width,height:qe.height,data:qe.getRGBAData()};return jpegJsExports.encode(ze,f.quality).data}function encodePng(qe,f){const ze={width:qe.width,height:qe.height,channels:qe.channels,depth:qe.bitDepth,data:qe.data};return(ze.depth===1||ze.depth===32)&&(ze.depth=8,ze.channels=4,ze.data=qe.getRGBAData()),encodePng$1(ze,f)}const exportMethods={save(qe,f={}){const{useCanvas:ze=!1,encoder:Ke=void 0}=f;let{format:Qe}=f;if(!Qe){const Pi=/\.(?<format>[a-zA-Z]+)$/.exec(qe);Pi&&(Qe=Pi.groups.format.toLowerCase())}if(!Qe)throw new Error("file format not provided");return new Promise((Pi,nn)=>{let ln,cn;switch(Qe.toLowerCase()){case"png":{ze?ln=this.getCanvas().pngStream():cn=encodePng(this,Ke);break}case"jpg":case"jpeg":ze?ln=this.getCanvas().jpegStream():cn=encodeJpeg(this,Ke);break;case"bmp":cn=srcExports$3.encode(this,Ke);break;default:throw new RangeError(`invalid output format: ${Qe}`)}if(ln){let hn=createWriteStream();hn.on("finish",Pi),hn.on("error",nn),ln.pipe(hn)}else cn&&writeFile()})},toDataURL(qe="image/png",f={}){typeof qe=="object"&&(f=qe,qe="image/png");const{useCanvas:ze=!1,encoder:Ke=void 0}=f;qe=getType(qe);function Qe(Pi,nn){const ln=Pi(nn,Ke);return toBase64URL(ln,qe)}return qe==="image/bmp"?Qe(srcExports$3.encode,this):qe==="image/png"&&!ze?Qe(encodePng,this):qe==="image/jpeg"&&!ze?Qe(encodeJpeg,this):this.getCanvas().toDataURL(qe)},toBuffer(qe={}){const{format:f="png",encoder:ze=void 0}=qe;switch(f.toLowerCase()){case"png":return encodePng(this,ze);case"jpeg":case"jpg":return encodeJpeg(this,ze);case"bmp":return srcExports$3.encode(this,ze);default:throw new RangeError(`invalid output format: ${f}`)}},toBase64(qe="image/png",f={}){if(f.async)return this.toDataURL(qe,f).then(function(ze){return ze.substring(ze.indexOf(",")+1)});{const ze=this.toDataURL(qe,f);return ze.substring(ze.indexOf(",")+1)}},toBlob(qe="image/png",f=.8){return canvasToBlob(this.getCanvas(),qe,f)},getCanvas(){const qe=new ImageData$1(this.getRGBAData({clamped:!0}),this.width,this.height);let f=createCanvas(this.width,this.height);return f.getContext("2d").putImageData(qe,0,0),f}};function setExportMethods(qe){for(const f in exportMethods)qe.prototype[f]=exportMethods[f]}var hasOwn$1={exports:{}};const version="1.0.1",require$$0$2={version};var hasRequiredHasOwn;function requireHasOwn(){return hasRequiredHasOwn||(hasRequiredHasOwn=1,function(qe,f){var ze=Object.prototype.hasOwnProperty;qe.exports=f=function(Qe,Pi){return ze.call(Pi,Qe)},f.version=require$$0$2.version}(hasOwn$1,hasOwn$1.exports)),hasOwn$1.exports}var hasOwnExports=requireHasOwn();const hasOwn=getDefaultExportFromCjs(hasOwnExports);let computedPropertyDescriptor$1={configurable:!0,enumerable:!1,get:void 0};function extendMethod(qe,f,ze={}){let{inPlace:Ke=!1,returnThis:Qe=!0,partialArgs:Pi=[]}=ze;return Ke?Image$1.prototype[qe]=function(...nn){this.computed=null;let ln=f.apply(this,[...Pi,...nn]);return Qe?this:ln}:Image$1.prototype[qe]=function(...nn){return f.apply(this,[...Pi,...nn])},Image$1}function extendProperty(qe,f,ze={}){let{partialArgs:Ke=[]}=ze;return computedPropertyDescriptor$1.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(qe,this.computed))return this.computed[qe];let Qe=f.apply(this,Ke);return this.computed[qe]=Qe,Qe},Object.defineProperty(Image$1.prototype,qe,computedPropertyDescriptor$1),Image$1}const GREY$1="GREY",RGB$1="RGB",HSL="HSL",HSV="HSV",CMYK$1="CMYK",ColorModel=Object.freeze(Object.defineProperty({__proto__:null,CMYK:CMYK$1,GREY:GREY$1,HSL,HSV,RGB:RGB$1},Symbol.toStringTag,{value:"Module"}));function getRGBAData(qe={}){const{clamped:f}=qe;this.checkProcessable("getRGBAData",{components:[1,3],bitDepth:[1,8,16,32]});const ze=this.width*this.height*4;let Ke=f?new Uint8ClampedArray(ze):new Uint8Array(ze);return this.bitDepth===1?fillDataFromBinary(this,Ke):this.bitDepth===32?(this.checkProcessable("getRGBAData",{alpha:0}),this.components===1?fillDataFromGrey32(this,Ke):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB32(this,Ke))):this.components===1?fillDataFromGrey(this,Ke):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB(this,Ke)),this.alpha===1?(this.checkProcessable("getRGBAData",{bitDepth:[8,16]}),copyAlpha(this,Ke)):fillAlpha(this,Ke),Ke}function fillDataFromBinary(qe,f){for(let ze=0;ze<qe.size;ze++){const Ke=qe.getBit(ze);f[ze*4]=Ke*255,f[ze*4+1]=Ke*255,f[ze*4+2]=Ke*255}}function fillDataFromGrey32(qe,f){const ze=qe.min[0],Qe=qe.max[0]-ze;for(let Pi=0;Pi<qe.size;Pi++){const nn=Math.floor(255*(qe.data[Pi]-ze)/Qe);f[Pi*4]=nn,f[Pi*4+1]=nn,f[Pi*4+2]=nn}}function fillDataFromRGB32(qe,f){const ze=Math.min(...qe.min),Qe=Math.max(...qe.max)-ze;for(let Pi=0;Pi<qe.size;Pi++){const nn=Math.floor(255*(qe.data[Pi*3]-ze)/Qe),ln=Math.floor(255*(qe.data[Pi*3+1]-ze)/Qe),cn=Math.floor(255*(qe.data[Pi*3+2]-ze)/Qe);f[Pi*4]=nn,f[Pi*4+1]=ln,f[Pi*4+2]=cn}}function fillDataFromGrey(qe,f){for(let ze=0;ze<qe.size;ze++)f[ze*4]=qe.data[ze*qe.channels]>>>qe.bitDepth-8,f[ze*4+1]=qe.data[ze*qe.channels]>>>qe.bitDepth-8,f[ze*4+2]=qe.data[ze*qe.channels]>>>qe.bitDepth-8}function fillDataFromRGB(qe,f){for(let ze=0;ze<qe.size;ze++)f[ze*4]=qe.data[ze*qe.channels]>>>qe.bitDepth-8,f[ze*4+1]=qe.data[ze*qe.channels+1]>>>qe.bitDepth-8,f[ze*4+2]=qe.data[ze*qe.channels+2]>>>qe.bitDepth-8}function copyAlpha(qe,f){for(let ze=0;ze<qe.size;ze++)f[ze*4+3]=qe.data[ze*qe.channels+qe.components]>>qe.bitDepth-8}function fillAlpha(qe,f){for(let ze=0;ze<qe.size;ze++)f[ze*4+3]=255}const BINARY="BINARY",GREY="GREY",GREYA="GREYA",RGB="RGB",RGBA="RGBA",CMYK="CMYK",CMYKA="CMYKA",kinds={};kinds[BINARY]={components:1,alpha:0,bitDepth:1,colorModel:GREY$1};kinds[GREYA]={components:1,alpha:1,bitDepth:8,colorModel:GREY$1};kinds[GREY]={components:1,alpha:0,bitDepth:8,colorModel:GREY$1};kinds[RGBA]={components:3,alpha:1,bitDepth:8,colorModel:RGB$1};kinds[RGB]={components:3,alpha:0,bitDepth:8,colorModel:RGB$1};kinds[CMYK]={components:4,alpha:0,bitDepth:8,colorModel:CMYK$1};kinds[CMYKA]={components:4,alpha:1,bitDepth:8,colorModel:CMYK$1};function getKind(qe){const f=kinds[qe];if(!f)throw new RangeError(`invalid image kind: ${qe}`);return f}const validBitDepth=[1,8,16,32];function verifyKindDefinition(qe){const{components:f,alpha:ze,bitDepth:Ke,colorModel:Qe}=qe;if(!Number.isInteger(f)||f<=0)throw new RangeError(`invalid components: ${f}. Must be a positive integer`);if(ze!==0&&ze!==1&&typeof ze!="boolean")throw new TypeError(`invalid alpha: ${ze}: must be a boolean, 0 or 1`);if(!validBitDepth.includes(Ke))throw new RangeError(`invalid bitDepth: ${Ke}. Must be one of ${validBitDepth.join(", ")}`);if(!ColorModel[Qe])throw new RangeError(`invalid colorModel: ${Qe}. Must be one of ${Object.keys(ColorModel).join(", ")}`)}function getTheoreticalPixelArraySize(qe,f,ze){let Ke=f*qe;return ze===1&&(Ke=Math.ceil(Ke/8)),Ke}function createPixelArray(qe,f,ze,Ke,Qe,Pi){const nn=Ke*qe;let ln;switch(Qe){case 1:ln=new Uint8Array(Math.ceil(nn/8));break;case 8:ln=new Uint8Array(nn);break;case 16:ln=new Uint16Array(nn);break;case 32:ln=new Float32Array(nn);break;default:throw new Error(`Cannot create pixel array for bit depth ${Qe}`)}if(ze)for(let cn=f;cn<ln.length;cn+=Ke)ln[cn]=Pi;return ln}var src$4={},IOBuffer_1,hasRequiredIOBuffer;function requireIOBuffer(){if(hasRequiredIOBuffer)return IOBuffer_1;hasRequiredIOBuffer=1;const qe=1024*8,f=[];class ze{constructor(Qe,Pi){Pi=Pi||{},Qe===void 0&&(Qe=qe),typeof Qe=="number"&&(Qe=new ArrayBuffer(Qe));let nn=Qe.byteLength;const ln=Pi.offset?Pi.offset>>>0:0;Qe.buffer&&(nn=Qe.byteLength-ln,Qe.byteLength!==Qe.buffer.byteLength?Qe=Qe.buffer.slice(Qe.byteOffset+ln,Qe.byteOffset+Qe.byteLength):ln?Qe=Qe.buffer.slice(ln):Qe=Qe.buffer),this.buffer=Qe,this.length=nn,this.byteLength=nn,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=nn||qe,this._mark=0}available(Qe){return Qe===void 0&&(Qe=1),this.offset+Qe<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(Qe){Qe===void 0&&(Qe=1),this.offset+=Qe}seek(Qe){this.offset=Qe}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(Qe){if(Qe===void 0&&(Qe=1),!this.available(Qe)){const Pi=this._increment+this._increment;this._increment=Pi;const nn=this.length+Pi,ln=new Uint8Array(nn);ln.set(new Uint8Array(this.buffer)),this.buffer=ln.buffer,this.length=nn,this._data=new DataView(this.buffer)}}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(Qe){Qe===void 0&&(Qe=1);for(var Pi=new Uint8Array(Qe),nn=0;nn<Qe;nn++)Pi[nn]=this.readByte();return Pi}readInt16(){var Qe=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,Qe}readUint16(){var Qe=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,Qe}readInt32(){var Qe=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,Qe}readUint32(){var Qe=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,Qe}readFloat32(){var Qe=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,Qe}readFloat64(){var Qe=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,Qe}readChar(){return String.fromCharCode(this.readInt8())}readChars(Qe){Qe===void 0&&(Qe=1),f.length=Qe;for(var Pi=0;Pi<Qe;Pi++)f[Pi]=this.readChar();return f.join("")}writeBoolean(Qe){this.writeUint8(Qe?255:0)}writeInt8(Qe){this.ensureAvailable(1),this._data.setInt8(this.offset++,Qe)}writeUint8(Qe){this.ensureAvailable(1),this._data.setUint8(this.offset++,Qe)}writeByte(Qe){this.writeUint8(Qe)}writeBytes(Qe){this.ensureAvailable(Qe.length);for(var Pi=0;Pi<Qe.length;Pi++)this._data.setUint8(this.offset++,Qe[Pi])}writeInt16(Qe){this.ensureAvailable(2),this._data.setInt16(this.offset,Qe,this.littleEndian),this.offset+=2}writeUint16(Qe){this.ensureAvailable(2),this._data.setUint16(this.offset,Qe,this.littleEndian),this.offset+=2}writeInt32(Qe){this.ensureAvailable(4),this._data.setInt32(this.offset,Qe,this.littleEndian),this.offset+=4}writeUint32(Qe){this.ensureAvailable(4),this._data.setUint32(this.offset,Qe,this.littleEndian),this.offset+=4}writeFloat32(Qe){this.ensureAvailable(4),this._data.setFloat32(this.offset,Qe,this.littleEndian),this.offset+=4}writeFloat64(Qe){this.ensureAvailable(8),this._data.setFloat64(this.offset,Qe,this.littleEndian),this.offset+=8}writeChar(Qe){this.writeUint8(Qe.charCodeAt(0))}writeChars(Qe){for(var Pi=0;Pi<Qe.length;Pi++)this.writeUint8(Qe.charCodeAt(Pi))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}}return IOBuffer_1=ze,IOBuffer_1}var src$3={},standard$1,hasRequiredStandard;function requireStandard(){if(hasRequiredStandard)return standard$1;hasRequiredStandard=1;const qe={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},f={};for(var ze in qe)f[qe[ze]]=ze;return standard$1={tagsById:qe,tagsByName:f},standard$1}var exif$1,hasRequiredExif;function requireExif(){if(hasRequiredExif)return exif$1;hasRequiredExif=1;const qe={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},f={};for(var ze in qe)f[qe[ze]]=ze;return exif$1={tagsById:qe,tagsByName:f},exif$1}var gps$1,hasRequiredGps;function requireGps(){if(hasRequiredGps)return gps$1;hasRequiredGps=1;const qe={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},f={};for(var ze in qe)f[qe[ze]]=ze;return gps$1={tagsById:qe,tagsByName:f},gps$1}var ifd,hasRequiredIfd;function requireIfd(){if(hasRequiredIfd)return ifd;hasRequiredIfd=1;const qe={standard:requireStandard(),exif:requireExif(),gps:requireGps()};class f{constructor(Ke){if(!Ke)throw new Error("missing kind");this.data=null,this.fields=new Map,this.kind=Ke,this._map=null}get(Ke){if(typeof Ke=="number")return this.fields.get(Ke);if(typeof Ke=="string")return this.fields.get(qe[this.kind].tagsByName[Ke]);throw new Error("expected a number or string")}get map(){if(!this._map){this._map={};const Qe=qe[this.kind].tagsById;for(var Ke of this.fields.keys())Qe[Ke]&&(this._map[Qe[Ke]]=this.fields.get(Ke))}return this._map}}return ifd=f,ifd}var tiffIfd,hasRequiredTiffIfd;function requireTiffIfd(){if(hasRequiredTiffIfd)return tiffIfd;hasRequiredTiffIfd=1;const qe=requireIfd(),f=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class ze extends qe{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var Pi=new Date,nn=f.exec(this.dateTime);return Pi.setFullYear(nn[1],nn[2]-1,nn[3]),Pi.setHours(nn[4],nn[5],nn[6]),Pi}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return Ke(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return Ke(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}}function Ke(Qe){return typeof Qe=="number"?[Qe]:Qe}return tiffIfd=ze,tiffIfd}var ifdValue={},hasRequiredIfdValue;function requireIfdValue(){if(hasRequiredIfdValue)return ifdValue;hasRequiredIfdValue=1;var qe=new Map([[1,[1,f]],[2,[1,ze]],[3,[2,Ke]],[4,[4,Qe]],[5,[8,Pi]],[6,[1,nn]],[7,[1,f]],[8,[2,ln]],[9,[4,cn]],[10,[8,hn]],[11,[4,un]],[12,[8,zn]]]);ifdValue.getByteLength=function(Xn,Un){return qe.get(Xn)[0]*Un},ifdValue.readData=function(Xn,Un,qn){return qe.get(Un)[1](Xn,qn)};function f(Xn,Un){if(Un===1)return Xn.readUint8();for(var qn=new Uint8Array(Un),ys=0;ys<Un;ys++)qn[ys]=Xn.readUint8();return qn}function ze(Xn,Un){for(var qn=[],ys="",vs=0;vs<Un;vs++){var ea=String.fromCharCode(Xn.readUint8());ea==="\0"?(qn.push(ys),ys=""):ys+=ea}return qn.length===1?qn[0]:qn}function Ke(Xn,Un){if(Un===1)return Xn.readUint16();for(var qn=new Uint16Array(Un),ys=0;ys<Un;ys++)qn[ys]=Xn.readUint16();return qn}function Qe(Xn,Un){if(Un===1)return Xn.readUint32();for(var qn=new Uint32Array(Un),ys=0;ys<Un;ys++)qn[ys]=Xn.readUint32();return qn}function Pi(Xn,Un){if(Un===1)return Xn.readUint32()/Xn.readUint32();for(var qn=new Array(Un),ys=0;ys<Un;ys++)qn[ys]=Xn.readUint32()/Xn.readUint32();return qn}function nn(Xn,Un){if(Un===1)return Xn.readInt8();for(var qn=new Int8Array(Un),ys=0;ys<Un;ys++)qn[ys]=Xn.readInt8();return qn}function ln(Xn,Un){if(Un===1)return Xn.readInt16();for(var qn=new Int16Array(Un),ys=0;ys<Un;ys++)qn[ys]=Xn.readInt16();return qn}function cn(Xn,Un){if(Un===1)return Xn.readInt32();for(var qn=new Int32Array(Un),ys=0;ys<Un;ys++)qn[ys]=Xn.readInt32();return qn}function hn(Xn,Un){if(Un===1)return Xn.readInt32()/Xn.readInt32();for(var qn=new Array(Un),ys=0;ys<Un;ys++)qn[ys]=Xn.readInt32()/Xn.readInt32();return qn}function un(Xn,Un){if(Un===1)return Xn.readFloat32();for(var qn=new Float32Array(Un),ys=0;ys<Un;ys++)qn[ys]=Xn.readFloat32();return qn}function zn(Xn,Un){if(Un===1)return Xn.readFloat64();for(var qn=new Float64Array(Un),ys=0;ys<Un;ys++)qn[ys]=Xn.readFloat64();return qn}return ifdValue}var tiffDecoder,hasRequiredTiffDecoder;function requireTiffDecoder(){if(hasRequiredTiffDecoder)return tiffDecoder;hasRequiredTiffDecoder=1;const qe=requireIOBuffer(),f=requireIfd(),ze=requireTiffIfd(),Ke=requireIfdValue(),Qe={ignoreImageData:!1,onlyFirst:!1};class Pi extends qe{constructor(Un,qn){super(Un,qn),this._nextIFD=0}decode(Un){Un=Object.assign({},Qe,Un);const qn=[];for(this.decodeHeader();this._nextIFD;)if(qn.push(this.decodeIFD(Un)),Un.onlyFirst)return qn[0];return qn}decodeHeader(){let Un=this.readUint16();if(Un===18761)this.setLittleEndian();else if(Un===19789)this.setBigEndian();else throw new Error("invalid byte order: 0x"+Un.toString(16));if(Un=this.readUint16(),Un!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(Un){this.seek(this._nextIFD);var qn;Un.kind?qn=new f(Un.kind):qn=new ze;const ys=this.readUint16();for(var vs=0;vs<ys;vs++)this.decodeIFDEntry(qn);return Un.ignoreImageData||this.decodeImageData(qn),this._nextIFD=this.readUint32(),qn}decodeIFDEntry(Un){const qn=this.offset,ys=this.readUint16(),vs=this.readUint16(),ea=this.readUint32();if(vs<1||vs>12){this.skip(4);return}Ke.getByteLength(vs,ea)>4&&this.seek(this.readUint32());const ta=Ke.readData(this,vs,ea);if(Un.fields.set(ys,ta),ys===34665||ys===34853){let ra=this.offset,oa;ys===34665?oa="exif":ys===34853&&(oa="gps"),this._nextIFD=ta,Un[oa]=this.decodeIFD({kind:oa,ignoreImageData:!0}),this.offset=ra}this.seek(qn),this.skip(12)}decodeImageData(Un){const qn=Un.orientation;switch(qn&&qn!==1&&un("orientation",qn),Un.type){case 1:case 2:this.readStripData(Un);break;default:un("image type",Un.type);break}}readStripData(Un){const qn=Un.width,ys=Un.height,vs=zn(Un.bitsPerSample),ea=Un.sampleFormat;let na=qn*ys;const ta=nn(na,1,vs,ea),ra=Un.compression,fa=Un.rowsPerStrip*qn,ca=Un.stripOffsets,la=Un.stripByteCounts;for(var ua=0,ga=0;ga<ca.length;ga++){var da=this.getStripData(ra,ca[ga],la[ga]),qa=na>fa?fa:na;na-=qa,vs===8?ua=ln(ta,da,ua,qa):vs===16?ua=cn(ta,da,ua,qa,this.isLittleEndian()):vs===32&&ea===3?ua=hn(ta,da,ua,qa,this.isLittleEndian()):un("bitDepth",vs)}Un.data=ta}getStripData(Un,qn,ys){switch(Un){case 1:return new DataView(this.buffer,qn,ys);case 2:case 32773:return un("Compression",Un);default:throw new Error("invalid compression: "+Un)}}}tiffDecoder=Pi;function nn(Xn,Un,qn,ys){return qn===8?new Uint8Array(Xn*Un):qn===16?new Uint16Array(Xn*Un):qn===32&&ys===3?new Float32Array(Xn*Un):un("bit depth / sample format",qn+" / "+ys)}function ln(Xn,Un,qn,ys){for(var vs=0;vs<ys;vs++)Xn[qn++]=Un.getUint8(vs);return qn}function cn(Xn,Un,qn,ys,vs){for(var ea=0;ea<ys*2;ea+=2)Xn[qn++]=Un.getUint16(ea,vs);return qn}function hn(Xn,Un,qn,ys,vs){for(var ea=0;ea<ys*4;ea+=4)Xn[qn++]=Un.getFloat32(ea,vs);return qn}function un(Xn,Un){throw new Error("Unsupported "+Xn+": "+Un)}function zn(Xn){if(Xn.length){const qn=Xn;Xn=qn[0];for(var Un=0;Un<qn.length;Un++)qn[Un]!==Xn&&un("bit depth",qn)}return Xn}return tiffDecoder}var decode,hasRequiredDecode$1;function requireDecode$1(){if(hasRequiredDecode$1)return decode;hasRequiredDecode$1=1;const qe=requireTiffDecoder();return decode=function(ze,Ke){return new qe(ze,Ke).decode(Ke)},decode}var hasRequiredSrc$4;function requireSrc$4(){return hasRequiredSrc$4||(hasRequiredSrc$4=1,src$3.decode=requireDecode$1()),src$3}var decode_1,hasRequiredDecode;function requireDecode(){if(hasRequiredDecode)return decode_1;hasRequiredDecode=1;const qe=requireIOBuffer(),f=requireSrc$4();function ze(Ke){const Qe=new qe(Ke),Pi={};if(Qe.setBigEndian(),Qe.readUint16()!==65496)throw new Error("SOI marker not found. Not a valid JPEG file");if(Qe.readUint16()===65505){Qe.readUint16();const cn=Qe.readBytes(6);if(cn[0]===69&&cn[1]===120&&cn[2]===105&&cn[3]===102&&cn[4]===0&&cn[5]===0){const hn=f.decode(Qe,{onlyFirst:!0,ignoreImageData:!0,offset:Qe.offset});Pi.exif=hn}}return Pi}return decode_1=ze,decode_1}var hasRequiredSrc$3;function requireSrc$3(){return hasRequiredSrc$3||(hasRequiredSrc$3=1,src$4.decode=requireDecode()),src$4}var srcExports$2=requireSrc$3(),imageType$1={exports:{}},fileType={exports:{}},hasRequiredFileType;function requireFileType(){return hasRequiredFileType||(hasRequiredFileType=1,function(module){const toBytes=qe=>[...qe].map(f=>f.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(qe,f=0){let ze=qe[f],Ke=1,Qe=0;for(;++Qe<8;)Ke*=256,ze+=qe[f+Qe]*Ke;return ze}const fileType=qe=>{if(!(qe instanceof Uint8Array||qe instanceof ArrayBuffer||Buffer.isBuffer(qe)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof qe}\``);const f=qe instanceof Uint8Array?qe:new Uint8Array(qe);if(!(f&&f.length>1))return null;const ze=(Qe,Pi)=>{Pi=Object.assign({offset:0},Pi);for(let nn=0;nn<Qe.length;nn++)if(Pi.mask){if(Qe[nn]!==(Pi.mask[nn]&f[nn+Pi.offset]))return!1}else if(Qe[nn]!==f[nn+Pi.offset])return!1;return!0},Ke=(Qe,Pi)=>ze(toBytes(Qe),Pi);if(ze([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(ze([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(ze([71,73,70]))return{ext:"gif",mime:"image/gif"};if(ze([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(ze([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((ze([73,73,42,0])||ze([77,77,0,42]))&&ze([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(ze([73,73,42,0])||ze([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(ze([66,77]))return{ext:"bmp",mime:"image/bmp"};if(ze([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(ze([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(ze([80,75,3,4])){if(ze([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(ze(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(Ke("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(Ke("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(Ke("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const Qe=(cn,hn=0)=>cn.findIndex((un,zn,Xn)=>zn>=hn&&Xn[zn]===80&&Xn[zn+1]===75&&Xn[zn+2]===3&&Xn[zn+3]===4);let Pi=0,nn=!1,ln=null;do{const cn=Pi+30;if(nn||(nn=ze(oxmlContentTypes,{offset:cn})||ze(oxmlRels,{offset:cn})),ln||(Ke("word/",{offset:cn})?ln={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:Ke("ppt/",{offset:cn})?ln={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:Ke("xl/",{offset:cn})&&(ln={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),nn&&ln)return ln;Pi=Qe(f,cn)}while(Pi>=0);if(ln)return ln}if(ze([80,75])&&(f[2]===3||f[2]===5||f[2]===7)&&(f[3]===4||f[3]===6||f[3]===8))return{ext:"zip",mime:"application/zip"};if(ze([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(ze([82,97,114,33,26,7])&&(f[6]===0||f[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(ze([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(ze([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(ze([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(ze([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(ze([51,103,112,53])||ze([0,0,0])&&ze([102,116,121,112],{offset:4})&&(ze([109,112,52,49],{offset:8})||ze([109,112,52,50],{offset:8})||ze([105,115,111,109],{offset:8})||ze([105,115,111,50],{offset:8})||ze([109,109,112,52],{offset:8})||ze([77,52,86],{offset:8})||ze([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(ze([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(ze([26,69,223,163])){const Qe=f.subarray(4,4100),Pi=Qe.findIndex((nn,ln,cn)=>cn[ln]===66&&cn[ln+1]===130);if(Pi!==-1){const nn=Pi+3,ln=cn=>[...cn].every((hn,un)=>Qe[nn+un]===hn.charCodeAt(0));if(ln("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(ln("webm"))return{ext:"webm",mime:"video/webm"}}}if(ze([0,0,0,20,102,116,121,112,113,116,32,32])||ze([102,114,101,101],{offset:4})||ze([102,116,121,112,113,116,32,32],{offset:4})||ze([109,100,97,116],{offset:4})||ze([109,111,111,118],{offset:4})||ze([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(ze([82,73,70,70])){if(ze([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(ze([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(ze([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(ze([48,38,178,117,142,102,207,17,166,217])){let Qe=30;do{const Pi=readUInt64LE(f,Qe+16);if(ze([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:Qe})){if(ze([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:Qe+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(ze([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:Qe+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}Qe+=Pi}while(Qe+24<=f.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(ze([0,0,1,186])||ze([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(ze([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let Qe=0;Qe<2&&Qe<f.length-16;Qe++){if(ze([73,68,51],{offset:Qe})||ze([255,226],{offset:Qe,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(ze([255,228],{offset:Qe,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(ze([255,248],{offset:Qe,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(ze([255,240],{offset:Qe,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(ze([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(ze([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(ze([79,103,103,83]))return ze([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:ze([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:ze([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:ze([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:ze([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(ze([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(ze([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(ze([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(ze([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(ze([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(ze([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((f[0]===67||f[0]===70)&&ze([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(ze([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(ze([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(ze([119,79,70,70])&&(ze([0,1,0,0],{offset:4})||ze([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(ze([119,79,70,50])&&(ze([0,1,0,0],{offset:4})||ze([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(ze([76,80],{offset:34})&&(ze([0,0,1],{offset:8})||ze([1,0,2],{offset:8})||ze([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(ze([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(ze([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(ze([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(ze([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(ze([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(ze([37,33]))return{ext:"ps",mime:"application/postscript"};if(ze([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(ze([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(ze([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(ze([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(ze([77,83,67,70])||ze([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(ze([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(ze([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(ze([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(ze([31,160])||ze([31,157]))return{ext:"Z",mime:"application/x-compress"};if(ze([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(ze([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(ze([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(ze([71],{offset:4})&&(ze([71],{offset:192})||ze([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(ze([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(ze([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(ze([0,0,0,12,106,80,32,32,13,10,135,10])){if(ze([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(ze([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(ze([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(ze([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(ze([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(Ke("<?xml "))return{ext:"xml",mime:"application/xml"};if(ze([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(ze([102,116,121,112],{offset:4})){if(ze([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(ze([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(ze([104,101,105,99],{offset:8})||ze([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(ze([104,101,118,99],{offset:8})||ze([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return ze([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:ze([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:ze([77,80,43])?{ext:"mpc",mime:"audio/x-musepack"}:ze([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:ze([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:ze([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:ze([212,195,178,161])||ze([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",()=>{const qe=new stream.PassThrough,f=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{qe.fileType=fileType(f)}catch(ze){reject(ze)}readableStream.unshift(f),stream.pipeline?resolve(stream.pipeline(readableStream,qe,()=>{})):resolve(readableStream.pipe(qe))})})}(fileType)),fileType.exports}var hasRequiredImageType;function requireImageType(){if(hasRequiredImageType)return imageType$1.exports;hasRequiredImageType=1;const qe=requireFileType(),f=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),ze=Ke=>{const Qe=qe(Ke);return f.has(Qe&&Qe.ext)?Qe:null};return imageType$1.exports=ze,imageType$1.exports.default=ze,Object.defineProperty(ze,"minimumBytes",{value:qe.minimumBytes}),imageType$1.exports}var imageTypeExports=requireImageType();const imageType=getDefaultExportFromCjs(imageTypeExports);function guessStripByteCounts(qe){if(qe.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");const f=qe.rowsPerStrip*qe.width*qe.samplesPerPixel*(qe.bitsPerSample/8);return new Array(qe.stripOffsets.length).fill(f)}function applyHorizontalDifferencing8Bit(qe,f,ze){let Ke=0;for(;Ke<qe.length;){for(let Qe=ze;Qe<f*ze;Qe+=ze)for(let Pi=0;Pi<ze;Pi++)qe[Ke+Qe+Pi]=qe[Ke+Qe+Pi]+qe[Ke+Qe-(ze-Pi)]&255;Ke+=f*ze}}function applyHorizontalDifferencing16Bit(qe,f,ze){let Ke=0;for(;Ke<qe.length;){for(let Qe=ze;Qe<f*ze;Qe+=ze)for(let Pi=0;Pi<ze;Pi++)qe[Ke+Qe+Pi]=qe[Ke+Qe+Pi]+qe[Ke+Qe-(ze-Pi)]&65535;Ke+=f*ze}}const tagsById$2={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$2={};for(let qe in tagsById$2)tagsByName$2[tagsById$2[qe]]=Number(qe);const exif=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$2,tagsByName:tagsByName$2},Symbol.toStringTag,{value:"Module"})),tagsById$1={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$1={};for(let qe in tagsById$1)tagsByName$1[tagsById$1[qe]]=Number(qe);const gps=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$1,tagsByName:tagsByName$1},Symbol.toStringTag,{value:"Module"})),tagsById={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName={};for(let qe in tagsById)tagsByName[tagsById[qe]]=Number(qe);const standard=Object.freeze(Object.defineProperty({__proto__:null,tagsById,tagsByName},Symbol.toStringTag,{value:"Module"})),tags={standard,exif,gps};class IFD{constructor(f){if(!f)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=f,this._hasMap=!1,this._map={}}get(f){if(typeof f=="number")return this.fields.get(f);if(typeof f=="string")return this.fields.get(tags[this.kind].tagsByName[f]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const f=tags[this.kind].tagsById;for(let ze of this.fields.keys())f[ze]&&(this._map[f[ze]]=this.fields.get(ze));this._hasMap=!0}return this._map}}let types=new Map([[1,[1,readByte]],[2,[1,readASCII]],[3,[2,readShort]],[4,[4,readLong]],[5,[8,readRational]],[6,[1,readSByte]],[7,[1,readByte]],[8,[2,readSShort]],[9,[4,readSLong]],[10,[8,readSRational]],[11,[4,readFloat]],[12,[8,readDouble]]]);function getByteLength(qe,f){const ze=types.get(qe);if(!ze)throw new Error(`type not found: ${qe}`);return ze[0]*f}function readData(qe,f,ze){const Ke=types.get(f);if(!Ke)throw new Error(`type not found: ${f}`);return Ke[1](qe,ze)}function readByte(qe,f){if(f===1)return qe.readUint8();let ze=new Uint8Array(f);for(let Ke=0;Ke<f;Ke++)ze[Ke]=qe.readUint8();return ze}function readASCII(qe,f){let ze=[],Ke="";for(let Qe=0;Qe<f;Qe++){let Pi=String.fromCharCode(qe.readUint8());Pi==="\0"?(ze.push(Ke),Ke=""):Ke+=Pi}return ze.length===1?ze[0]:ze}function readShort(qe,f){if(f===1)return qe.readUint16();let ze=new Uint16Array(f);for(let Ke=0;Ke<f;Ke++)ze[Ke]=qe.readUint16();return ze}function readLong(qe,f){if(f===1)return qe.readUint32();let ze=new Uint32Array(f);for(let Ke=0;Ke<f;Ke++)ze[Ke]=qe.readUint32();return ze}function readRational(qe,f){if(f===1)return qe.readUint32()/qe.readUint32();let ze=new Array(f);for(let Ke=0;Ke<f;Ke++)ze[Ke]=qe.readUint32()/qe.readUint32();return ze}function readSByte(qe,f){if(f===1)return qe.readInt8();let ze=new Int8Array(f);for(let Ke=0;Ke<f;Ke++)ze[Ke]=qe.readInt8();return ze}function readSShort(qe,f){if(f===1)return qe.readInt16();let ze=new Int16Array(f);for(let Ke=0;Ke<f;Ke++)ze[Ke]=qe.readInt16();return ze}function readSLong(qe,f){if(f===1)return qe.readInt32();let ze=new Int32Array(f);for(let Ke=0;Ke<f;Ke++)ze[Ke]=qe.readInt32();return ze}function readSRational(qe,f){if(f===1)return qe.readInt32()/qe.readInt32();let ze=new Array(f);for(let Ke=0;Ke<f;Ke++)ze[Ke]=qe.readInt32()/qe.readInt32();return ze}function readFloat(qe,f){if(f===1)return qe.readFloat32();let ze=new Float32Array(f);for(let Ke=0;Ke<f;Ke++)ze[Ke]=qe.readFloat32();return ze}function readDouble(qe,f){if(f===1)return qe.readFloat64();let ze=new Float64Array(f);for(let Ke=0;Ke<f;Ke++)ze[Ke]=qe.readFloat64();return ze}const CLEAR_CODE=256,EOI_CODE=257,TABLE_START=258,MIN_BIT_LENGTH=9;let stringTable=[];function initializeStringTable(){if(stringTable.length===0){for(let f=0;f<256;f++)stringTable.push([f]);const qe=[];for(let f=256;f<4096;f++)stringTable.push(qe)}}const andTable=[511,1023,2047,4095],bitJumps=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class LzwDecoder{constructor(f){this.nextData=0,this.nextBits=0,this.bytePointer=0,this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH,this.stripArray=new Uint8Array(f.buffer,f.byteOffset,f.byteLength),this.outData=new IOBuffer(f.byteLength),this.initializeTable()}decode(){let f=0,ze=0;for(;(f=this.getNextCode())!==EOI_CODE;)if(f===CLEAR_CODE){if(this.initializeTable(),f=this.getNextCode(),f===EOI_CODE)break;this.writeString(this.stringFromCode(f)),ze=f}else if(this.isInTable(f))this.writeString(this.stringFromCode(f)),this.addStringToTable(this.stringFromCode(ze).concat(this.stringFromCode(f)[0])),ze=f;else{const Qe=this.stringFromCode(ze).concat(this.stringFromCode(ze)[0]);this.writeString(Qe),this.addStringToTable(Qe),ze=f}const Ke=this.outData.toArray();return new DataView(Ke.buffer,Ke.byteOffset,Ke.byteLength)}initializeTable(){initializeStringTable(),this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH}writeString(f){this.outData.writeBytes(f)}stringFromCode(f){return stringTable[f]}isInTable(f){return f<this.tableLength}addStringToTable(f){if(stringTable[this.tableLength++]=f,stringTable.length>4096)throw stringTable=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===bitJumps[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);const f=this.nextData>>this.nextBits-this.currentBitLength&andTable[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:f}}function decompressLzw(qe){return new LzwDecoder(qe).decode()}const dateTimeRegex=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd extends IFD{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let f=new Date,ze=dateTimeRegex.exec(this.dateTime);if(ze===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return f.setFullYear(Number(ze[1]),Number(ze[2])-1,Number(ze[3])),f.setHours(Number(ze[4]),Number(ze[5]),Number(ze[6])),f}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const f=this.get("BitsPerSample");return f&&typeof f!="number"?f[0]:f}get alpha(){const f=this.extraSamples;return f?f[0]!==0:!1}get associatedAlpha(){const f=this.extraSamples;return f?f[0]===1:!1}get extraSamples(){return alwaysArray(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return alwaysArray(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")}get stripByteCounts(){return alwaysArray(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return this.get("SampleFormat")||1}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const f=2**this.bitsPerSample,ze=this.get("ColorMap");if(!ze)return;if(ze.length!==3*f)throw new Error(`ColorMap size must be ${f}`);const Ke=[];for(let Qe=0;Qe<f;Qe++)Ke.push([ze[Qe],ze[Qe+f],ze[Qe+2*f]]);return Ke}}function alwaysArray(qe){return typeof qe=="number"?[qe]:qe}function decompressZlib(qe){const f=new Uint8Array(qe.buffer,qe.byteOffset,qe.byteLength),ze=inflate_1(f);return new DataView(ze.buffer,ze.byteOffset,ze.byteLength)}const defaultOptions$3={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder extends IOBuffer{constructor(f){super(f),this._nextIFD=0}get isMultiPage(){let f=0;for(this.decodeHeader();this._nextIFD;)if(f++,this.decodeIFD({ignoreImageData:!0},!0),f===2)return!0;if(f===1)return!1;throw unsupported("ifdCount",f)}get pageCount(){let f=0;for(this.decodeHeader();this._nextIFD;)f++,this.decodeIFD({ignoreImageData:!0},!0);if(f>0)return f;throw unsupported("ifdCount",f)}decode(f={}){f=Object.assign({},defaultOptions$3,f);const ze=[];for(this.decodeHeader();this._nextIFD;)if(ze.push(this.decodeIFD(f,!0)),f.onlyFirst)return[ze[0]];return ze}decodeHeader(){const f=this.readUint16();if(f===18761)this.setLittleEndian();else if(f===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${f.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(f,ze){this.seek(this._nextIFD);let Ke;if(ze)Ke=new TiffIfd;else{if(!f.kind)throw new Error("kind is missing");Ke=new IFD(f.kind)}const Qe=this.readUint16();for(let Pi=0;Pi<Qe;Pi++)this.decodeIFDEntry(Ke);if(!f.ignoreImageData){if(!(Ke instanceof TiffIfd))throw new Error("must be a tiff ifd");this.decodeImageData(Ke)}return this._nextIFD=this.readUint32(),Ke}decodeIFDEntry(f){const ze=this.offset,Ke=this.readUint16(),Qe=this.readUint16(),Pi=this.readUint32();if(Qe<1||Qe>12){this.skip(4);return}getByteLength(Qe,Pi)>4&&this.seek(this.readUint32());const ln=readData(this,Qe,Pi);if(f.fields.set(Ke,ln),Ke===34665||Ke===34853){let cn=this.offset,hn="exif";Ke===34665?hn="exif":Ke===34853&&(hn="gps"),this._nextIFD=ln,f[hn]=this.decodeIFD({kind:hn,ignoreImageData:!0},!1),this.offset=cn}this.seek(ze),this.skip(12)}decodeImageData(f){const ze=f.orientation;if(ze&&ze!==1)throw unsupported("orientation",ze);switch(f.type){case 0:case 1:case 2:case 3:this.readStripData(f);break;default:throw unsupported("image type",f.type)}if(this.applyPredictor(f),this.convertAlpha(f),f.type===0){const Ke=f.bitsPerSample,Qe=Math.pow(2,Ke)-1;for(let Pi=0;Pi<f.data.length;Pi++)f.data[Pi]=Qe-f.data[Pi]}}readStripData(f){const ze=f.width,Ke=f.height,Qe=f.bitsPerSample,Pi=f.sampleFormat,nn=ze*Ke*f.samplesPerPixel,ln=getDataArray(nn,Qe,Pi),hn=f.rowsPerStrip*ze*f.samplesPerPixel,un=f.stripOffsets,zn=f.stripByteCounts||guessStripByteCounts(f);let Xn=nn,Un=0;for(let qn=0;qn<un.length;qn++){let ys=new DataView(this.buffer,this.byteOffset+un[qn],zn[qn]),vs=Xn>hn?hn:Xn;Xn-=vs;let ea=ys;switch(f.compression){case 1:break;case 5:{ea=decompressLzw(ys);break}case 8:{ea=decompressZlib(ys);break}case 2:throw unsupported("Compression","CCITT Group 3");case 32773:throw unsupported("Compression","PackBits");default:throw unsupported("Compression",f.compression)}Un=this.fillUncompressed(Qe,Pi,ln,ea,Un,vs)}f.data=ln}fillUncompressed(f,ze,Ke,Qe,Pi,nn){if(f===8)return fill8bit(Ke,Qe,Pi,nn);if(f===16)return fill16bit(Ke,Qe,Pi,nn,this.isLittleEndian());if(f===32&&ze===3)return fillFloat32(Ke,Qe,Pi,nn,this.isLittleEndian());throw unsupported("bitDepth",f)}applyPredictor(f){const ze=f.bitsPerSample;switch(f.predictor){case 1:break;case 2:{if(ze===8)applyHorizontalDifferencing8Bit(f.data,f.width,f.components);else if(ze===16)applyHorizontalDifferencing16Bit(f.data,f.width,f.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${ze}`);break}default:throw new Error(`invalid predictor: ${f.predictor}`)}}convertAlpha(f){if(f.alpha&&f.associatedAlpha){const{data:ze,components:Ke,maxSampleValue:Qe}=f;for(let Pi=0;Pi<ze.length;Pi+=Ke){const nn=ze[Pi+Ke-1];for(let ln=0;ln<Ke-1;ln++)ze[Pi+ln]=Math.round(ze[Pi+ln]*Qe/nn)}}}}function getDataArray(qe,f,ze){if(f===8)return new Uint8Array(qe);if(f===16)return new Uint16Array(qe);if(f===32&&ze===3)return new Float32Array(qe);throw unsupported("bit depth / sample format",`${f} / ${ze}`)}function fill8bit(qe,f,ze,Ke){for(let Qe=0;Qe<Ke;Qe++)qe[ze++]=f.getUint8(Qe);return ze}function fill16bit(qe,f,ze,Ke,Qe){for(let Pi=0;Pi<Ke*2;Pi+=2)qe[ze++]=f.getUint16(Pi,Qe);return ze}function fillFloat32(qe,f,ze,Ke,Qe){for(let Pi=0;Pi<Ke*4;Pi+=4)qe[ze++]=f.getFloat32(Pi,Qe);return ze}function unsupported(qe,f){return new Error(`Unsupported ${qe}: ${f}`)}function decodeTIFF(qe,f){return new TIFFDecoder(qe).decode(f)}function matchAndCrop(qe={}){let{algorithm:f="matchToPrevious",ignoreBorder:ze=[0,0]}=qe;this.checkProcessable("matchAndCrop",{bitDepth:[8,16]});let Ke=f==="matchToPrevious",Qe=this[0],Pi=[];Pi[0]={position:[0,0],image:this[0]};let nn=[0,0];for(let Xn=1;Xn<this.length;Xn++){let Un=Qe.getBestMatch(this[Xn],{border:ze});Pi[Xn]={position:[Un[0]+nn[0],Un[1]+nn[1]],image:this[Xn]},Ke&&(nn[0]+=Un[0],nn[1]+=Un[1],Qe=this[Xn])}let ln=0,cn=0,hn=0,un=0;for(let Xn=0;Xn<Pi.length;Xn++){let Un=Pi[Xn];Un.position[0]>ln&&(ln=Un.position[0]),Un.position[0]<cn&&(cn=Un.position[0]),Un.position[1]>hn&&(hn=Un.position[1]),Un.position[1]<un&&(un=Un.position[1])}cn=0-cn,un=0-un;for(let Xn=0;Xn<Pi.length;Xn++){let Un=Pi[Xn];Un.crop=Un.image.crop({x:ln-Un.position[0],y:hn-Un.position[1],width:Qe.width-cn-ln,height:Qe.height-un-hn})}let zn=[];for(let Xn=0;Xn<Pi.length;Xn++)zn[Xn]=Pi[Xn].crop;return new Stack(zn)}function min$2(){this.checkProcessable("min",{bitDepth:[8,16]});let qe=this[0].min;for(let f=1;f<this.length;f++)for(let ze=0;ze<qe.length;ze++)qe[ze]=Math.min(qe[ze],this[f].min[ze]);return qe}function max$2(){this.checkProcessable("min",{bitDepth:[8,16]});let qe=this[0].max;for(let f=1;f<this.length;f++)for(let ze=0;ze<qe.length;ze++)qe[ze]=Math.max(qe[ze],this[f].max[ze]);return qe}function median$2(qe){let f=qe.reduce((nn,ln)=>nn+ln);if(f===0)throw new Error("unreachable");let ze=0,Ke=0,Qe=f/2,Pi;for(;;){if(qe[ze]>0){if(Pi!==void 0)return(Pi+ze)/2;if(Ke+=qe[ze],Ke>Qe)return ze;Ke===Qe&&(Pi=ze)}ze++}}function mean$2(qe){let f=0,ze=0;for(let Ke=0;Ke<qe.length;Ke++)f+=qe[Ke],ze+=qe[Ke]*Ke;return f===0?0:ze/f}function median$1(){this.checkProcessable("median",{bitDepth:[8,16]});let qe=this.getHistograms({maxSlots:this[0].maxValue+1}),f=new Array(qe.length);for(let ze=0;ze<qe.length;ze++){let Ke=qe[ze];f[ze]=median$2(Ke)}return f}function histogram(qe){this.checkProcessable("min",{bitDepth:[8,16]});let f=this[0].getHistogram(qe);for(let ze=1;ze<this.length;ze++){let Ke=this[ze].getHistogram(qe);for(let Qe=0;Qe<f.length;Qe++)f[Qe]+=Ke[Qe]}return f}function histograms(qe){this.checkProcessable("min",{bitDepth:[8,16]});let f=this[0].getHistograms(qe),ze=f[0].length;for(let Ke=1;Ke<this.length;Ke++){let Qe=this[Ke].getHistograms(qe);for(let Pi=0;Pi<f.length;Pi++)for(let nn=0;nn<ze;nn++)f[Pi][nn]+=Qe[Pi][nn]}return f}function averageImage(){this.checkProcessable("averageImage",{bitDepth:[8,16]});let qe=new Uint32Array(this[0].data.length);for(let Ke=0;Ke<this.length;Ke++){let Qe=this[Ke];for(let Pi=0;Pi<this[0].data.length;Pi++)qe[Pi]+=Qe.data[Pi]}let f=Image$1.createFrom(this[0]),ze=f.data;for(let Ke=0;Ke<this[0].data.length;Ke++)ze[Ke]=qe[Ke]/this.length;return f}function maxImage(){this.checkProcessable("max",{bitDepth:[8,16]});let qe=Image$1.createFrom(this[0]);qe.data.fill(0);for(const f of this)for(let ze=0;ze<qe.data.length;ze++)qe.data[ze]=Math.max(f.data[ze],qe.data[ze]);return qe}function minImage(){this.checkProcessable("max",{bitDepth:[8,16]});let qe=Image$1.createFrom(this[0]);qe.data.fill(qe.maxValue);for(const f of this)for(let ze=0;ze<qe.data.length;ze++)qe.data[ze]=Math.min(f.data[ze],qe.data[ze]);return qe}function extend$3(qe){qe.extendMethod("matchAndCrop",matchAndCrop),qe.extendMethod("getMin",min$2),qe.extendMethod("getMax",max$2),qe.extendMethod("getMedian",median$1),qe.extendMethod("getHistogram",histogram),qe.extendMethod("getHistograms",histograms),qe.extendMethod("getAverage",averageImage),qe.extendMethod("getAverageImage",averageImage),qe.extendMethod("getMaxImage",maxImage),qe.extendMethod("getMinImage",minImage)}let computedPropertyDescriptor={configurable:!0,enumerable:!1,get:void 0};class Stack extends Array{constructor(f){if(Array.isArray(f)){super(f.length);for(let ze=0;ze<f.length;ze++)this[ze]=f[ze]}else typeof f=="number"?super(f):super();this.computed=null}static load(f){return Promise.all(f.map(Image$1.load)).then(ze=>new Stack(ze))}static extendMethod(f,ze,Ke={}){let{inPlace:Qe=!1,returnThis:Pi=!0,partialArgs:nn=[]}=Ke;return Qe?Stack.prototype[f]=function(...ln){this.computed=null;let cn=ze.apply(this,[...nn,...ln]);return Pi?this:cn}:Stack.prototype[f]=function(...ln){return ze.apply(this,[...nn,...ln])},Stack}static extendProperty(f,ze,Ke={}){let{partialArgs:Qe=[]}=Ke;return computedPropertyDescriptor.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(f,this.computed))return this.computed[f];let Pi=ze.apply(this,Qe);return this.computed[f]=Pi,Pi},Object.defineProperty(Stack.prototype,f,computedPropertyDescriptor),Stack}checkProcessable(f,ze={}){if(typeof f!="string")throw new TypeError("checkProcessable requires as first parameter the processName (a string)");if(this.size===0)throw new TypeError(`The process: ${f} can not be applied on an empty stack`);this[0].checkProcessable(f,ze);for(let Ke=1;Ke<this.length;Ke++){if((ze.sameSize===void 0||ze.sameSize)&&this[0].width!==this[Ke].width)throw new TypeError(`The process: ${f} can not be applied if width is not identical in all images`);if((ze.sameSize===void 0||ze.sameSize)&&this[0].height!==this[Ke].height)throw new TypeError(`The process: ${f} can not be applied if height is not identical in all images`);if((ze.sameAlpha===void 0||ze.sameAlpha)&&this[0].alpha!==this[Ke].alpha)throw new TypeError(`The process: ${f} can not be applied if alpha is not identical in all images`);if((ze.sameBitDepth===void 0||ze.sameBitDepth)&&this[0].bitDepth!==this[Ke].bitDepth)throw new TypeError(`The process: ${f} can not be applied if bitDepth is not identical in all images`);if((ze.sameColorModel===void 0||ze.sameColorModel)&&this[0].colorModel!==this[Ke].colorModel)throw new TypeError(`The process: ${f} can not be applied if colorModel is not identical in all images`);if((ze.sameNumberChannels===void 0||ze.sameNumberChannels)&&this[0].channels!==this[Ke].channels)throw new TypeError(`The process: ${f} can not be applied if channels is not identical in all images`)}}}Array[Symbol.species]||(Stack.prototype.map=function(qe,f){if(typeof qe!="function")throw new TypeError(`${qe} is not a function`);let ze=new Stack(this.length);for(let Ke=0;Ke<this.length;Ke++)ze[Ke]=qe.call(f,this[Ke],Ke,this);return ze});extend$3(Stack);const isDataURL=/^data:[a-z]+\/(?:[a-z]+);base64,/;function load(qe,f){if(typeof qe=="string")return loadURL(qe,f);if(qe instanceof ArrayBuffer)return Promise.resolve(loadBinary(new Uint8Array(qe),void 0,f&&f.ignorePalette));if(qe.buffer)return Promise.resolve(loadBinary(qe,void 0,f&&f.ignorePalette));throw new Error('argument to "load" must be a string or buffer.')}function loadBinary(qe,f,ze){const Ke=imageType(qe);if(Ke)switch(Ke.mime){case"image/png":return loadPNG(qe);case"image/jpeg":return loadJPEG(qe);case"image/tiff":return loadTIFF(qe,ze);default:return loadGeneric(Qe(Ke.mime))}return loadGeneric(Qe("application/octet-stream"));function Qe(Pi){return f||toBase64URL(qe,Pi)}}function loadURL(qe,f){const ze=qe.slice(0,64).match(isDataURL);let Ke;return ze!==null?Ke=Promise.resolve(decode$1(qe.slice(ze[0].length))):Ke=fetchBinary(qe,f),Ke.then(Qe=>{const Pi=new Uint8Array(Qe);return loadBinary(Pi,ze?qe:void 0,f&&f.ignorePalette)})}function loadPNG(qe){const f=decodePng(qe);let ze=f.channels,Ke,Qe=0;return ze===2||ze===4?(Ke=ze-1,Qe=1):Ke=ze,f.palette?loadPNGFromPalette(f):new Image$1(f.width,f.height,f.data,{components:Ke,alpha:Qe,bitDepth:f.depth,meta:{text:f.text}})}function loadPNGFromPalette(qe){const f=qe.width*qe.height,ze=qe.palette[0].length,Ke=new Uint8Array(f*ze),Qe=8/qe.depth,Pi=qe.depth<8?Qe:1,nn=parseInt("1".repeat(qe.depth),2),ln=ze===4;let cn=0;for(let hn=0;hn<f;hn++){const un=Math.floor(hn/Pi);let zn=qe.data[un];qe.depth<8&&(zn=zn>>>qe.depth*(Qe-1-hn%Qe)&nn);const Xn=qe.palette[zn];Ke[cn++]=Xn[0],Ke[cn++]=Xn[1],Ke[cn++]=Xn[2],ln&&(Ke[cn++]=Xn[3])}return new Image$1(qe.width,qe.height,Ke,{components:3,alpha:ln,bitDepth:8})}function loadJPEG(qe){const f=srcExports$2.decode(qe);let ze;f.exif&&(ze=getMetadata(f.exif));const Ke=jpegJsExports.decode(qe,{useTArray:!0,maxMemoryUsageInMB:1024});let Qe=new Image$1(Ke.width,Ke.height,Ke.data,{meta:ze});if(ze&&ze.tiff.tags.Orientation){const Pi=ze.tiff.tags.Orientation;Pi>2&&(Qe=Qe.rotate({3:180,4:180,5:90,6:90,7:270,8:270}[Pi])),[2,4,5,7].includes(Pi)&&(Qe=Qe.flipX())}return Qe}function loadTIFF(qe,f){let ze=decodeTIFF(qe);return ze.length===1?getImageFromIFD(ze[0],f):new Stack(ze.map(function(Ke){return getImageFromIFD(Ke,f)}))}function getMetadata(qe){const f={tiff:{fields:qe.fields,tags:qe.map}};return qe.exif&&(f.exif=qe.exif),qe.gps&&(f.gps=qe.gps),f}function getImageFromIFD(qe,f){if(!f&&qe.type===3){const ze=new Uint16Array(3*qe.width*qe.height),Ke=qe.palette;let Qe=0;for(let Pi=0;Pi<qe.data.length;Pi++){const nn=qe.data[Pi],ln=Ke[nn];ze[Qe++]=ln[0],ze[Qe++]=ln[1],ze[Qe++]=ln[2]}return new Image$1(qe.width,qe.height,ze,{components:3,alpha:qe.alpha,colorModel:RGB$1,bitDepth:16,meta:getMetadata(qe)})}else return new Image$1(qe.width,qe.height,qe.data,{components:qe.type===2?3:1,alpha:qe.alpha,colorModel:qe.type===2?RGB$1:GREY$1,bitDepth:qe.bitsPerSample.length?qe.bitsPerSample[0]:qe.bitsPerSample,meta:getMetadata(qe)})}function loadGeneric(qe,f){return f=f||{},new Promise(function(ze,Ke){let Qe=new DOMImage;Qe.onload=function(){let Pi=Qe.width,nn=Qe.height,cn=createCanvas(Pi,nn).getContext("2d");cn.drawImage(Qe,0,0,Pi,nn);let hn=cn.getImageData(0,0,Pi,nn).data;ze(new Image$1(Pi,nn,hn,f))},Qe.onerror=function(){Ke(new Error(`Could not load ${qe}`))},Qe.src=qe})}const valueMethods={getValueXY(qe,f,ze){return this.data[(f*this.width+qe)*this.channels+ze]},setValueXY(qe,f,ze,Ke){return this.data[(f*this.width+qe)*this.channels+ze]=Ke,this.computed=null,this},getValue(qe,f){return this.data[qe*this.channels+f]},setValue(qe,f,ze){return this.data[qe*this.channels+f]=ze,this.computed=null,this},getPixelXY(qe,f){return this.getPixel(f*this.width+qe)},setPixelXY(qe,f,ze){return this.setPixel(f*this.width+qe,ze)},getPixel(qe){const f=new Array(this.channels),ze=qe*this.channels;for(let Ke=0;Ke<this.channels;Ke++)f[Ke]=this.data[ze+Ke];return f},setPixel(qe,f){const ze=qe*this.channels;for(let Ke=0;Ke<f.length;Ke++)this.data[ze+Ke]=f[Ke];return this.computed=null,this}};function setValueMethods(qe){for(const f in valueMethods)qe.prototype[f]=valueMethods[f]}function getImageParameters(qe){return{width:qe.width,height:qe.height,components:qe.components,alpha:qe.alpha,colorModel:qe.colorModel,bitDepth:qe.bitDepth}}function getOutputImage(qe,f,ze,Ke={}){const{out:Qe}=f;if(Qe===void 0)return Ke.copy?qe.clone():Image$1.createFrom(qe,ze);{if(!Image$1.isImage(Qe))throw new TypeError("out must be an Image object");const Pi=Object.assign(getImageParameters(qe),ze);for(const nn in Pi)if(Qe[nn]!==Pi[nn])throw new RangeError(`cannot use out. Its ${nn} must be "${Pi[nn]}" (found "${Qe[nn]}")`);return Qe}}function getOutputImageOrInPlace(qe,f,ze){if(f.inPlace!==void 0&&typeof f.inPlace!="boolean")throw new TypeError("inPlace option must be a boolean");if(f.inPlace){if(f.out!==void 0)throw new TypeError("out option must not be set if inPlace option is true");return qe}return getOutputImage(qe,f,null,ze)}function abs(qe={}){this.checkProcessable("abs",{bitDepth:[32]});const f=getOutputImageOrInPlace(this,qe);return absolute(this,f),f}function absolute(qe,f){for(let ze=0;ze<qe.data.length;ze++)f.data[ze]=Math.abs(qe.data[ze])}function copyAlphaChannel(qe,f){if(qe.alpha===1&&f.alpha===1)for(let ze=0;ze<qe.size;ze++)f.data[ze*f.channels+f.components]=qe.data[ze*qe.channels+qe.components]}function invert(qe={}){this.checkProcessable("invert",{bitDepth:[1,8,16]});const f=getOutputImageOrInPlace(this,qe);return this.bitDepth===1?invertBinary(this,f):(invertColor(this,f),this!==f&&copyAlphaChannel(this,f)),f}function invertBinary(qe,f){for(let ze=0;ze<qe.data.length;ze++)f.data[ze]=~qe.data[ze]}function invertColor(qe,f){for(let ze=0;ze<qe.data.length;ze+=qe.channels)for(let Ke=0;Ke<qe.components;Ke++)f.data[ze+Ke]=qe.maxValue-qe.data[ze+Ke]}function flipX(){this.checkProcessable("flipX",{bitDepth:[8,16]});for(let qe=0;qe<this.height;qe++){let f=qe*this.width*this.channels;for(let ze=0;ze<Math.floor(this.width/2);ze++){let Ke=ze*this.channels+f,Qe=(this.width-ze-1)*this.channels+f;for(let Pi=0;Pi<this.channels;Pi++){let nn=this.data[Ke+Pi];this.data[Ke+Pi]=this.data[Qe+Pi],this.data[Qe+Pi]=nn}}}return this}function flipY(){this.checkProcessable("flipY",{bitDepth:[8,16]});for(let qe=0;qe<Math.floor(this.height/2);qe++)for(let f=0;f<this.width;f++){let ze=f*this.channels+qe*this.width*this.channels,Ke=f*this.channels+(this.height-1-qe)*this.channels*this.width;for(let Qe=0;Qe<this.channels;Qe++){let Pi=this.data[ze+Qe];this.data[ze+Qe]=this.data[Ke+Qe],this.data[Ke+Qe]=Pi}}return this}function blurFilter(qe={}){const{radius:f=1}=qe;if(f<1)throw new Error("radius must be greater than 1");const ze=2*f+1,Ke=new Array(ze);for(let Qe=0;Qe<ze;Qe++){Ke[Qe]=new Array(ze);for(let Pi=0;Pi<ze;Pi++)Ke[Qe][Pi]=1/(ze*ze)}return this.convolution(Ke)}var medianQuickselect_min={exports:{}},hasRequiredMedianQuickselect_min;function requireMedianQuickselect_min(){return hasRequiredMedianQuickselect_min||(hasRequiredMedianQuickselect_min=1,function(qe){(function(){function f(Qe){for(var Pi=0,nn=Qe.length-1,ln=void 0,cn=void 0,hn=void 0,un=Ke(Pi,nn);;){if(nn<=Pi)return Qe[un];if(nn==Pi+1)return Qe[Pi]>Qe[nn]&&ze(Qe,Pi,nn),Qe[un];for(ln=Ke(Pi,nn),Qe[ln]>Qe[nn]&&ze(Qe,ln,nn),Qe[Pi]>Qe[nn]&&ze(Qe,Pi,nn),Qe[ln]>Qe[Pi]&&ze(Qe,ln,Pi),ze(Qe,ln,Pi+1),cn=Pi+1,hn=nn;;){do cn++;while(Qe[Pi]>Qe[cn]);do hn--;while(Qe[hn]>Qe[Pi]);if(hn<cn)break;ze(Qe,cn,hn)}ze(Qe,Pi,hn),hn<=un&&(Pi=cn),hn>=un&&(nn=hn-1)}}var ze=function(Pi,nn,ln){var cn;return cn=[Pi[ln],Pi[nn]],Pi[nn]=cn[0],Pi[ln]=cn[1],cn},Ke=function(Pi,nn){return~~((Pi+nn)/2)};qe.exports?qe.exports=f:window.median=f})()}(medianQuickselect_min)),medianQuickselect_min.exports}var medianQuickselect_minExports=requireMedianQuickselect_min();const quickSelectMedian=getDefaultExportFromCjs(medianQuickselect_minExports);function validateArrayOfChannels(qe,f={}){let{channels:ze,allowAlpha:Ke,defaultAlpha:Qe}=f;return typeof Ke!="boolean"&&(Ke=!0),typeof ze>"u"?allChannels(qe,Qe):validateChannels(qe,ze,Ke)}function allChannels(qe,f){let ze=f?qe.channels:qe.components,Ke=new Array(ze);for(let Qe=0;Qe<ze;Qe++)Ke[Qe]=Qe;return Ke}function validateChannels(qe,f,ze){Array.isArray(f)||(f=[f]);for(let Ke=0;Ke<f.length;Ke++)f[Ke]=validateChannel(qe,f[Ke],ze);return f}function validateChannel(qe,f,ze=!0){if(f===void 0)throw new RangeError(`validateChannel : the channel has to be >=0 and <${qe.channels}`);if(typeof f=="string"){switch(qe.colorModel){case GREY$1:break;case RGB$1:if("rgb".includes(f))switch(f){case"r":f=0;break;case"g":f=1;break;case"b":f=2;break}break;case HSL:if("hsl".includes(f))switch(f){case"h":f=0;break;case"s":f=1;break;case"l":f=2;break}break;case HSV:if("hsv".includes(f))switch(f){case"h":f=0;break;case"s":f=1;break;case"v":f=2;break}break;case CMYK$1:if("cmyk".includes(f))switch(f){case"c":f=0;break;case"m":f=1;break;case"y":f=2;break;case"k":f=3;break}break;default:throw new Error(`Unexpected color model: ${qe.colorModel}`)}if(f==="a"){if(!qe.alpha)throw new Error("validateChannel : the image does not contain alpha channel");f=qe.components}if(typeof f=="string")throw new Error(`validateChannel : undefined channel: ${f}`)}if(f>=qe.channels)throw new RangeError(`validateChannel : the channel has to be >=0 and <${qe.channels}`);if(!ze&&f>=qe.components)throw new RangeError("validateChannel : alpha channel may not be selected");return f}function medianFilter(qe={}){let{radius:f=1,border:ze="copy",channels:Ke}=qe;if(this.checkProcessable("medianFilter",{bitDepth:[8,16]}),f<1)throw new Error("radius must be greater than 0");Ke=validateArrayOfChannels(this,Ke);let Qe=f,Pi=f,nn=Image$1.createFrom(this),ln=(Qe*2+1)*(Pi*2+1),cn=new Array(ln);for(let hn=0;hn<Ke.length;hn++){let un=Ke[hn];for(let zn=Pi;zn<this.height-Pi;zn++)for(let Xn=Qe;Xn<this.width-Qe;Xn++){let Un=0;for(let ys=-Pi;ys<=Pi;ys++)for(let vs=-Qe;vs<=Qe;vs++){let ea=((zn+ys)*this.width+Xn+vs)*this.channels+un;cn[Un++]=this.data[ea]}let qn=(zn*this.width+Xn)*this.channels+un;nn.data[qn]=quickSelectMedian(cn)}}if(this.alpha&&!Ke.includes(this.channels))for(let hn=this.components;hn<this.data.length;hn=hn+this.channels)nn.data[hn]=this.data[hn];return nn.setBorder({size:[Qe,Pi],algorithm:ze}),nn}function gaussianFilter(qe={}){let{radius:f=1,sigma:ze,channels:Ke,border:Qe="copy"}=qe;this.checkProcessable("gaussian",{bitDepth:[8,16]});const Pi=getKernel(f,ze);return this.convolution([Pi,Pi],{border:Qe,channels:Ke,algorithm:"separable"})}function getKernel(qe,f){const ze=qe*2+1,Ke=new Array(ze),Qe=f||((ze-1)*.5-1)*.3+.8,Pi=-.5/(Qe*Qe);let nn=0;for(let ln=0;ln<ze;ln++){const cn=ln-qe,hn=Math.exp(Pi*cn*cn);Ke[ln]=hn,nn+=hn}for(let ln=0;ln<ze;ln++)Ke[ln]/=nn;return Ke}const SOBEL_X=[[-1,0,1],[-2,0,2],[-1,0,1]],SOBEL_Y=[[-1,-2,-1],[0,0,0],[1,2,1]],SCHARR_X=[[3,0,-3],[10,0,-10],[3,0,-3]],SCHARR_Y=[[3,10,3],[0,0,0],[-3,-10,-3]];var src$2={},fftlib={},hasRequiredFftlib;function requireFftlib(){return hasRequiredFftlib||(hasRequiredFftlib=1,function(qe){(function(){var f;f=qe;var ze={release:"0.3.0",date:"2013-03"};f.toString=function(){return"version "+ze.release+", released "+ze.date};for(var Ke=0,Qe=null,Pi=null,nn={init:function(hn){if(hn!==0&&(hn&hn-1)===0)Ke=hn,nn._initArray(),nn._makeBitReversalTable(),nn._makeCosSinTable();else throw new Error("init: radix-2 required")},fft1d:function(hn,un){nn.fft(hn,un,1)},ifft1d:function(hn,un){var zn=1/Ke;nn.fft(hn,un,-1);for(var Xn=0;Xn<Ke;Xn++)hn[Xn]*=zn,un[Xn]*=zn},bt1d:function(hn,un){nn.fft(hn,un,-1)},fft2d:function(hn,un){for(var zn=[],Xn=[],Un=0,qn=0;qn<Ke;qn++){Un=qn*Ke;for(var ys=0;ys<Ke;ys++)zn[ys]=hn[ys+Un],Xn[ys]=un[ys+Un];nn.fft1d(zn,Xn);for(var vs=0;vs<Ke;vs++)hn[vs+Un]=zn[vs],un[vs+Un]=Xn[vs]}for(var ea=0;ea<Ke;ea++){for(var na=0;na<Ke;na++)Un=ea+na*Ke,zn[na]=hn[Un],Xn[na]=un[Un];nn.fft1d(zn,Xn);for(var ta=0;ta<Ke;ta++)Un=ea+ta*Ke,hn[Un]=zn[ta],un[Un]=Xn[ta]}},ifft2d:function(hn,un){for(var zn=[],Xn=[],Un=0,qn=0;qn<Ke;qn++){Un=qn*Ke;for(var ys=0;ys<Ke;ys++)zn[ys]=hn[ys+Un],Xn[ys]=un[ys+Un];nn.ifft1d(zn,Xn);for(var vs=0;vs<Ke;vs++)hn[vs+Un]=zn[vs],un[vs+Un]=Xn[vs]}for(var ea=0;ea<Ke;ea++){for(var na=0;na<Ke;na++)Un=ea+na*Ke,zn[na]=hn[Un],Xn[na]=un[Un];nn.ifft1d(zn,Xn);for(var ta=0;ta<Ke;ta++)Un=ea+ta*Ke,hn[Un]=zn[ta],un[Un]=Xn[ta]}},fft:function(hn,un,zn){for(var Xn,Un,qn,ys,vs,ea,na,ta,ra,oa=Ke>>2,fa=0;fa<Ke;fa++)ys=Qe[fa],fa<ys&&(vs=hn[fa],hn[fa]=hn[ys],hn[ys]=vs,vs=un[fa],un[fa]=un[ys],un[ys]=vs);for(var ca=1;ca<Ke;ca<<=1){Un=0,Xn=Ke/(ca<<1);for(var la=0;la<ca;la++){ea=Pi[Un+oa],na=zn*Pi[Un];for(var ua=la;ua<Ke;ua+=ca<<1)qn=ua+ca,ta=ea*hn[qn]+na*un[qn],ra=ea*un[qn]-na*hn[qn],hn[qn]=hn[ua]-ta,hn[ua]+=ta,un[qn]=un[ua]-ra,un[ua]+=ra;Un+=Xn}}},_initArray:function(){typeof Uint32Array<"u"?Qe=new Uint32Array(Ke):Qe=[],typeof Float64Array<"u"?Pi=new Float64Array(Ke*1.25):Pi=[]},_paddingZero:function(){},_makeBitReversalTable:function(){var hn=0,un=0,zn=0;for(Qe[0]=0;++hn<Ke;){for(zn=Ke>>1;zn<=un;)un-=zn,zn>>=1;un+=zn,Qe[hn]=un}},_makeCosSinTable:function(){var hn=Ke>>1,un=Ke>>2,zn=Ke>>3,Xn=hn+un,Un=Math.sin(Math.PI/Ke),qn=2*Un*Un,ys=Math.sqrt(qn*(2-qn)),vs=Pi[un]=1,ea=Pi[0]=0;Un=2*qn;for(var na=1;na<zn;na++)vs-=qn,qn+=Un*vs,ea+=ys,ys-=Un*ea,Pi[na]=ea,Pi[un-na]=vs;zn!==0&&(Pi[zn]=Math.sqrt(.5));for(var ta=0;ta<un;ta++)Pi[hn-ta]=Pi[ta];for(var ra=0;ra<Xn;ra++)Pi[ra+hn]=-Pi[ra]}},ln=["init","fft1d","ifft1d","fft2d","ifft2d"],cn=0;cn<ln.length;cn++)f[ln[cn]]=nn[ln[cn]];return f.bt=nn.bt1d,f.fft=nn.fft1d,f.ifft=nn.ifft1d,f}).call(fftlib)}(fftlib)),fftlib}var FFTUtils_1,hasRequiredFFTUtils;function requireFFTUtils(){if(hasRequiredFFTUtils)return FFTUtils_1;hasRequiredFFTUtils=1;var qe=requireFftlib(),f={DEBUG:!1,ifft2DArray:function(ze,Ke,Qe){var Pi=new Array(Ke*Qe),nn=Ke/2,ln=(Qe-1)*2;qe.init(nn);for(var cn={re:new Array(nn),im:new Array(nn)},hn=0;hn<Qe;hn++){for(var un=nn-1;un>=0;un--)cn.re[un]=ze[un*2*Qe+hn],cn.im[un]=ze[(un*2+1)*Qe+hn];qe.bt(cn.re,cn.im);for(var un=nn-1;un>=0;un--)Pi[un*2*Qe+hn]=cn.re[un],Pi[(un*2+1)*Qe+hn]=cn.im[un]}var zn=new Array(nn*ln);qe.init(ln);for(var Xn={re:new Array(ln),im:new Array(ln)},Un=ln*nn,un=0;un<Ke;un+=2){Xn.re[0]=Pi[un*Qe],Xn.im[0]=Pi[(un+1)*Qe];for(var hn=1;hn<Qe;hn++)Xn.re[hn]=Pi[un*Qe+hn],Xn.im[hn]=Pi[(un+1)*Qe+hn],Xn.re[ln-hn]=Pi[un*Qe+hn],Xn.im[ln-hn]=-Pi[(un+1)*Qe+hn];qe.bt(Xn.re,Xn.im);for(var qn=un/2*ln,hn=ln-1;hn>=0;hn--)zn[qn+hn]=Xn.re[hn]/Un}return zn},fft2DArray:function(ze,Ke,Qe,Pi){Object.assign({},{inplace:!0});var nn=Qe/2+1,ln=Ke*2,cn=new Array(ln*nn);qe.init(Qe);for(var hn={re:new Array(Qe),im:new Array(Qe)},un={re:new Array(Qe),im:new Array(Qe)},zn={re:new Array(Qe),im:new Array(Qe)},Xn,Un,qn,ys,vs,ea=0;ea<Ke/2;ea++){Xn=ea*2*Qe,hn.re=ze.slice(Xn,Xn+Qe),Xn=(ea*2+1)*Qe,hn.im=ze.slice(Xn,Xn+Qe),qe.fft1d(hn.re,hn.im),this.reconstructTwoRealFFT(hn,un,zn),Un=ea*4*nn,qn=(ea*4+1)*nn,ys=(ea*4+2)*nn,vs=(ea*4+3)*nn;for(var na=nn-1;na>=0;na--)cn[Un+na]=un.re[na],cn[qn+na]=un.im[na],cn[ys+na]=zn.re[na],cn[vs+na]=zn.im[na]}un=null,zn=null;var ta=new Array(ln*nn);qe.init(Ke);for(var ra={re:new Array(Ke),im:new Array(Ke)},oa=nn-1;oa>=0;oa--){for(var ea=Ke-1;ea>=0;ea--)ra.re[ea]=cn[ea*2*nn+oa],ra.im[ea]=cn[(ea*2+1)*nn+oa],isNaN(ra.re[ea])&&(ra.re[ea]=0),isNaN(ra.im[ea])&&(ra.im[ea]=0);qe.fft1d(ra.re,ra.im);for(var ea=Ke-1;ea>=0;ea--)ta[ea*2*nn+oa]=ra.re[ea],ta[(ea*2+1)*nn+oa]=ra.im[ea]}return ta},reconstructTwoRealFFT:function(ze,Ke,Qe){var Pi=ze.re.length;Ke.re[0]=ze.re[0],Ke.im[0]=0,Qe.re[0]=ze.im[0],Qe.im[0]=0;for(var nn,ln,cn,hn,un,zn=Pi/2;zn>0;zn--)un=Pi-zn,nn=.5*(ze.re[zn]-ze.re[un]),ln=.5*(ze.re[zn]+ze.re[un]),cn=.5*(ze.im[zn]-ze.im[un]),hn=.5*(ze.im[zn]+ze.im[un]),Ke.re[zn]=ln,Ke.im[zn]=cn,Ke.re[un]=ln,Ke.im[un]=-cn,Qe.re[zn]=hn,Qe.im[zn]=-nn,Qe.re[un]=hn,Qe.im[un]=nn},convolute2DI:function(ze,Ke,Qe,Pi){for(var nn,ln,cn=0;cn<Qe/2;cn++)for(var hn=0;hn<Pi;hn++)nn=ze[cn*2*Pi+hn]*Ke[cn*2*Pi+hn]-ze[(cn*2+1)*Pi+hn]*Ke[(cn*2+1)*Pi+hn],ln=ze[cn*2*Pi+hn]*Ke[(cn*2+1)*Pi+hn]+ze[(cn*2+1)*Pi+hn]*Ke[cn*2*Pi+hn],ze[cn*2*Pi+hn]=nn,ze[(cn*2+1)*Pi+hn]=ln},convolute:function(ze,Ke,Qe,Pi,nn){for(var ln=new Array(Pi*Qe),cn=0;cn<Qe*Pi;cn++)ln[cn]=ze[cn];ln=this.fft2DArray(ln,Qe,Pi);for(var hn=Ke.length,un=Ke[0].length,zn=new Array(Pi*Qe),cn=0;cn<Pi*Qe;cn++)zn[cn]=0;for(var Xn,Un,qn=Math.floor((hn-1)/2),ys=Math.floor((un-1)/2),vs=0;vs<hn;vs++){Xn=(vs-qn+Qe)%Qe;for(var ea=0;ea<un;ea++)Un=(ea-ys+Pi)%Pi,zn[Xn*Pi+Un]=Ke[vs][ea]}zn=this.fft2DArray(zn,Qe,Pi);var na=Qe*2,ta=Pi/2+1;return this.convolute2DI(ln,zn,na,ta),this.ifft2DArray(ln,na,ta)},toRadix2:function(ze,Ke,Qe){var Pi,nn,ln,cn,hn=Qe,un=Ke;if(!(Qe!==0&&(Qe&Qe-1)===0)){for(hn=0;Qe>>++hn!=0;);hn=1<<hn}if(!(Ke!==0&&(Ke&Ke-1)===0)){for(un=0;Ke>>++un!=0;);un=1<<un}if(un==Ke&&hn==Qe)return{data:ze,rows:Ke,cols:Qe};var zn=new Array(un*hn),Xn=Math.floor((un-Ke)/2)-Ke,Un=Math.floor((hn-Qe)/2)-Qe;for(Pi=0;Pi<un;Pi++)for(ln=Pi*hn,cn=(Pi-Xn)%Ke*Qe,nn=0;nn<hn;nn++)zn[ln+nn]=ze[cn+(nn-Un)%Qe];return{data:zn,rows:un,cols:hn}},crop:function(ze,Ke,Qe,Pi,nn,ln){if(Ke==Pi&&Qe==nn)return ze;Object.assign({},ln);var cn=new Array(nn*Pi),hn=Math.floor((Ke-Pi)/2),un=Math.floor((Qe-nn)/2),zn,Xn,Un,qn;for(Un=0;Un<Pi;Un++)for(zn=Un*nn,Xn=(Un+hn)*Qe,qn=0;qn<nn;qn++)cn[zn+qn]=ze[Xn+(qn+un)];return cn}};return FFTUtils_1=f,FFTUtils_1}var hasRequiredSrc$2;function requireSrc$2(){return hasRequiredSrc$2||(hasRequiredSrc$2=1,src$2.FFTUtils=requireFFTUtils(),src$2.FFT=requireFftlib()),src$2}var src$1,hasRequiredSrc$1;function requireSrc$1(){if(hasRequiredSrc$1)return src$1;hasRequiredSrc$1=1;var qe=requireSrc$2().FFTUtils;function f(Pi,nn,ln){var cn=Qe(Pi),hn=cn.data,un=Object.assign({normalize:!1,divisor:1,rows:cn.rows,cols:cn.cols},ln),zn,Xn;if(un.rows&&un.cols)zn=un.rows,Xn=un.cols;else throw new Error("Invalid number of rows or columns "+zn+" "+Xn);var Un=un.divisor,qn,ys,vs=nn.length,ea=nn[0].length;if(un.normalize)for(Un=0,qn=0;qn<vs;qn++)for(ys=0;ys<ea;ys++)Un+=nn[qn][ys];if(Un===0)throw new RangeError("convolution: The divisor is equal to zero");var na=qe.toRadix2(hn,zn,Xn),ta=qe.convolute(na.data,nn,na.rows,na.cols);if(ta=qe.crop(ta,na.rows,na.cols,zn,Xn),Un!=0&&Un!=1)for(qn=0;qn<ta.length;qn++)ta[qn]/=Un;return ta}function ze(Pi,nn,ln){var cn=Qe(Pi),hn=cn.data,un=Object.assign({normalize:!1,divisor:1,rows:cn.rows,cols:cn.cols},ln),zn,Xn;if(un.rows&&un.cols)zn=un.rows,Xn=un.cols;else throw new Error("Invalid number of rows or columns "+zn+" "+Xn);var Un=un.divisor,qn=nn.length,ys=nn[0].length,vs,ea,na,ta,ra,oa,fa,ca,la;if(un.normalize)for(Un=0,vs=0;vs<qn;vs++)for(ea=0;ea<ys;ea++)Un+=nn[vs][ea];if(Un===0)throw new RangeError("convolution: The divisor is equal to zero");var ua=new Array(zn*Xn),ga=Math.floor(qn/2),da=Math.floor(ys/2);for(ta=0;ta<zn;ta++)for(na=0;na<Xn;na++){for(oa=0,ea=0;ea<qn;ea++)for(vs=0;vs<ys;vs++)fa=nn[qn-ea-1][ys-vs-1],ca=(ta+ea-ga+zn)%zn,la=(na+vs-da+Xn)%Xn,ra=ca*Xn+la,oa+=hn[ra]*fa;ra=ta*Xn+na,ua[ra]=oa/Un}return ua}function Ke(Pi,nn,ln){var cn=1e3;ln&&ln.factor&&(cn=ln.factor);var hn=new Array(nn),un,zn,Xn,Un;cn*=-1;var qn=(nn-1)/2,ys=2*Pi*Pi;for(un=0;un<nn;un++)for(hn[un]=new Array(nn),Un=(un-qn)*(un-qn),zn=0;zn<nn;zn++)Xn=-((zn-qn)*(zn-qn)+Un)/ys,hn[un][zn]=Math.round(cn*(1+Xn)*Math.exp(Xn));return hn}function Qe(Pi){var nn=Pi,ln,cn;if(typeof Pi[0]!="number"){ln=Pi.length,cn=Pi[0].length,nn=new Array(ln*cn);for(var hn=0;hn<ln;hn++)for(var un=0;un<cn;un++)nn[hn*cn+un]=Pi[hn][un]}else{var zn=Math.sqrt(Pi.length);Number.isInteger(zn)&&(ln=zn,cn=zn)}return{data:nn,rows:ln,cols:cn}}return src$1={fft:f,direct:ze,kernelFactory:{LoG:Ke},matrix2Array:Qe},src$1}var srcExports$1=requireSrc$1(),_isFinite,hasRequired_isFinite;function require_isFinite(){return hasRequired_isFinite||(hasRequired_isFinite=1,_isFinite=Number.isFinite||function(qe){return!(typeof qe!="number"||qe!==qe||qe===1/0||qe===-1/0)}),_isFinite}var isInteger$1,hasRequiredIsInteger;function requireIsInteger(){if(hasRequiredIsInteger)return isInteger$1;hasRequiredIsInteger=1;var qe=require_isFinite();return isInteger$1=Number.isInteger||function(f){return typeof f=="number"&&qe(f)&&Math.floor(f)===f},isInteger$1}var isIntegerExports=requireIsInteger();const isInteger=getDefaultExportFromCjs(isIntegerExports);function validateKernel(qe){let f,ze;if(Array.isArray(qe))if(Array.isArray(qe[0])){if((qe.length&1)===0||(qe[0].length&1)===0)throw new RangeError("validateKernel: Kernel rows and columns should be odd numbers");f=Math.floor(qe.length/2),ze=Math.floor(qe[0].length/2)}else{let Ke=Math.sqrt(qe.length);if(isInteger(Ke))ze=f=Math.floor(Math.sqrt(qe.length)/2);else throw new RangeError("validateKernel: Kernel array should be a square");let Qe=new Array(Ke);for(let Pi=0;Pi<Ke;Pi++){Qe[Pi]=new Array(Ke);for(let nn=0;nn<Ke;nn++)Qe[Pi][nn]=qe[Pi*Ke+nn]}qe=Qe}else throw new Error(`validateKernel: Invalid Kernel: ${qe}`);return{kernel:qe,kWidth:ze,kHeight:f}}function clamp(qe,f){return Math.round(Math.min(Math.max(qe,0),f.maxValue))}function directConvolution(qe,f,ze){if(ze===void 0){const Pi=qe.length+f.length-1;ze=new Array(Pi)}fill(ze);for(var Ke=0;Ke<qe.length;Ke++)for(var Qe=0;Qe<f.length;Qe++)ze[Ke+Qe]+=qe[Ke]*f[Qe];return ze}function fill(qe){for(var f=0;f<qe.length;f++)qe[f]=0}var fft,hasRequiredFft;function requireFft(){if(hasRequiredFft)return fft;hasRequiredFft=1;function qe(f){if(this.size=f|0,this.size<=1||(this.size&this.size-1)!==0)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=f<<1;for(var ze=new Array(this.size*2),Ke=0;Ke<ze.length;Ke+=2){const hn=Math.PI*Ke/this.size;ze[Ke]=Math.cos(hn),ze[Ke+1]=-Math.sin(hn)}this.table=ze;for(var Qe=0,Pi=1;this.size>Pi;Pi<<=1)Qe++;this._width=Qe%2===0?Qe-1:Qe,this._bitrev=new Array(1<<this._width);for(var nn=0;nn<this._bitrev.length;nn++){this._bitrev[nn]=0;for(var ln=0;ln<this._width;ln+=2){var cn=this._width-ln-2;this._bitrev[nn]|=(nn>>>ln&3)<<cn}}this._out=null,this._data=null,this._inv=0}return fft=qe,qe.prototype.fromComplexArray=function(ze,Ke){for(var Qe=Ke||new Array(ze.length>>>1),Pi=0;Pi<ze.length;Pi+=2)Qe[Pi>>>1]=ze[Pi];return Qe},qe.prototype.createComplexArray=function(){const ze=new Array(this._csize);for(var Ke=0;Ke<ze.length;Ke++)ze[Ke]=0;return ze},qe.prototype.toComplexArray=function(ze,Ke){for(var Qe=Ke||this.createComplexArray(),Pi=0;Pi<Qe.length;Pi+=2)Qe[Pi]=ze[Pi>>>1],Qe[Pi+1]=0;return Qe},qe.prototype.completeSpectrum=function(ze){for(var Ke=this._csize,Qe=Ke>>>1,Pi=2;Pi<Qe;Pi+=2)ze[Ke-Pi]=ze[Pi],ze[Ke-Pi+1]=-ze[Pi+1]},qe.prototype.transform=function(ze,Ke){if(ze===Ke)throw new Error("Input and output buffers must be different");this._out=ze,this._data=Ke,this._inv=0,this._transform4(),this._out=null,this._data=null},qe.prototype.realTransform=function(ze,Ke){if(ze===Ke)throw new Error("Input and output buffers must be different");this._out=ze,this._data=Ke,this._inv=0,this._realTransform4(),this._out=null,this._data=null},qe.prototype.inverseTransform=function(ze,Ke){if(ze===Ke)throw new Error("Input and output buffers must be different");this._out=ze,this._data=Ke,this._inv=1,this._transform4();for(var Qe=0;Qe<ze.length;Qe++)ze[Qe]/=this.size;this._out=null,this._data=null},qe.prototype._transform4=function(){var ze=this._out,Ke=this._csize,Qe=this._width,Pi=1<<Qe,nn=Ke/Pi<<1,ln,cn,hn=this._bitrev;if(nn===4)for(ln=0,cn=0;ln<Ke;ln+=nn,cn++){const vs=hn[cn];this._singleTransform2(ln,vs,Pi)}else for(ln=0,cn=0;ln<Ke;ln+=nn,cn++){const vs=hn[cn];this._singleTransform4(ln,vs,Pi)}var un=this._inv?-1:1,zn=this.table;for(Pi>>=2;Pi>=2;Pi>>=2){nn=Ke/Pi<<1;var Xn=nn>>>2;for(ln=0;ln<Ke;ln+=nn)for(var Un=ln+Xn,qn=ln,ys=0;qn<Un;qn+=2,ys+=Pi){const vs=qn,ea=vs+Xn,na=ea+Xn,ta=na+Xn,ra=ze[vs],oa=ze[vs+1],fa=ze[ea],ca=ze[ea+1],la=ze[na],ua=ze[na+1],ga=ze[ta],da=ze[ta+1],qa=ra,tl=oa,ol=zn[ys],hl=un*zn[ys+1],wl=fa*ol-ca*hl,_l=fa*hl+ca*ol,gl=zn[2*ys],dl=un*zn[2*ys+1],sl=la*gl-ua*dl,kl=la*dl+ua*gl,pl=zn[3*ys],Al=un*zn[3*ys+1],xl=ga*pl-da*Al,al=ga*Al+da*pl,Fl=qa+sl,Ol=tl+kl,Jo=qa-sl,cl=tl-kl,rl=wl+xl,nl=_l+al,vl=un*(wl-xl),Pl=un*(_l-al),Sl=Fl+rl,El=Ol+nl,Il=Fl-rl,$l=Ol-nl,Ll=Jo+Pl,ml=cl-vl,Vl=Jo-Pl,jl=cl+vl;ze[vs]=Sl,ze[vs+1]=El,ze[ea]=Ll,ze[ea+1]=ml,ze[na]=Il,ze[na+1]=$l,ze[ta]=Vl,ze[ta+1]=jl}}},qe.prototype._singleTransform2=function(ze,Ke,Qe){const Pi=this._out,nn=this._data,ln=nn[Ke],cn=nn[Ke+1],hn=nn[Ke+Qe],un=nn[Ke+Qe+1],zn=ln+hn,Xn=cn+un,Un=ln-hn,qn=cn-un;Pi[ze]=zn,Pi[ze+1]=Xn,Pi[ze+2]=Un,Pi[ze+3]=qn},qe.prototype._singleTransform4=function(ze,Ke,Qe){const Pi=this._out,nn=this._data,ln=this._inv?-1:1,cn=Qe*2,hn=Qe*3,un=nn[Ke],zn=nn[Ke+1],Xn=nn[Ke+Qe],Un=nn[Ke+Qe+1],qn=nn[Ke+cn],ys=nn[Ke+cn+1],vs=nn[Ke+hn],ea=nn[Ke+hn+1],na=un+qn,ta=zn+ys,ra=un-qn,oa=zn-ys,fa=Xn+vs,ca=Un+ea,la=ln*(Xn-vs),ua=ln*(Un-ea),ga=na+fa,da=ta+ca,qa=ra+ua,tl=oa-la,ol=na-fa,hl=ta-ca,wl=ra-ua,_l=oa+la;Pi[ze]=ga,Pi[ze+1]=da,Pi[ze+2]=qa,Pi[ze+3]=tl,Pi[ze+4]=ol,Pi[ze+5]=hl,Pi[ze+6]=wl,Pi[ze+7]=_l},qe.prototype._realTransform4=function(){var ze=this._out,Ke=this._csize,Qe=this._width,Pi=1<<Qe,nn=Ke/Pi<<1,ln,cn,hn=this._bitrev;if(nn===4)for(ln=0,cn=0;ln<Ke;ln+=nn,cn++){const tc=hn[cn];this._singleRealTransform2(ln,tc>>>1,Pi>>>1)}else for(ln=0,cn=0;ln<Ke;ln+=nn,cn++){const tc=hn[cn];this._singleRealTransform4(ln,tc>>>1,Pi>>>1)}var un=this._inv?-1:1,zn=this.table;for(Pi>>=2;Pi>=2;Pi>>=2){nn=Ke/Pi<<1;var Xn=nn>>>1,Un=Xn>>>1,qn=Un>>>1;for(ln=0;ln<Ke;ln+=nn)for(var ys=0,vs=0;ys<=qn;ys+=2,vs+=Pi){var ea=ln+ys,na=ea+Un,ta=na+Un,ra=ta+Un,oa=ze[ea],fa=ze[ea+1],ca=ze[na],la=ze[na+1],ua=ze[ta],ga=ze[ta+1],da=ze[ra],qa=ze[ra+1],tl=oa,ol=fa,hl=zn[vs],wl=un*zn[vs+1],_l=ca*hl-la*wl,gl=ca*wl+la*hl,dl=zn[2*vs],sl=un*zn[2*vs+1],kl=ua*dl-ga*sl,pl=ua*sl+ga*dl,Al=zn[3*vs],xl=un*zn[3*vs+1],al=da*Al-qa*xl,Fl=da*xl+qa*Al,Ol=tl+kl,Jo=ol+pl,cl=tl-kl,rl=ol-pl,nl=_l+al,vl=gl+Fl,Pl=un*(_l-al),Sl=un*(gl-Fl),El=Ol+nl,Il=Jo+vl,$l=cl+Sl,Ll=rl-Pl;if(ze[ea]=El,ze[ea+1]=Il,ze[na]=$l,ze[na+1]=Ll,ys===0){var ml=Ol-nl,Vl=Jo-vl;ze[ta]=ml,ze[ta+1]=Vl;continue}if(ys!==qn){var jl=cl,Xl=-rl,yl=Ol,Yl=-Jo,Rl=-un*Sl,Hl=-un*Pl,Wl=-un*vl,zl=-un*nl,Gl=jl+Rl,Jl=Xl+Hl,ql=yl+zl,Zl=Yl-Wl,Ql=ln+Un-ys,ec=ln+Xn-ys;ze[Ql]=Gl,ze[Ql+1]=Jl,ze[ec]=ql,ze[ec+1]=Zl}}}},qe.prototype._singleRealTransform2=function(ze,Ke,Qe){const Pi=this._out,nn=this._data,ln=nn[Ke],cn=nn[Ke+Qe],hn=ln+cn,un=ln-cn;Pi[ze]=hn,Pi[ze+1]=0,Pi[ze+2]=un,Pi[ze+3]=0},qe.prototype._singleRealTransform4=function(ze,Ke,Qe){const Pi=this._out,nn=this._data,ln=this._inv?-1:1,cn=Qe*2,hn=Qe*3,un=nn[Ke],zn=nn[Ke+Qe],Xn=nn[Ke+cn],Un=nn[Ke+hn],qn=un+Xn,ys=un-Xn,vs=zn+Un,ea=ln*(zn-Un),na=qn+vs,ta=ys,ra=-ea,oa=qn-vs,fa=ys,ca=ea;Pi[ze]=na,Pi[ze+1]=0,Pi[ze+2]=ta,Pi[ze+3]=ra,Pi[ze+4]=oa,Pi[ze+5]=0,Pi[ze+6]=fa,Pi[ze+7]=ca},fft}requireFft();function convolutionSeparable(qe,f,ze,Ke){const Qe=new Array(qe.length);let Pi,nn,ln,cn;cn=f[1],ln=(cn.length-1)/2,nn=new Array(ze+cn.length-1),Pi=new Array(ze);for(let hn=0;hn<Ke;hn++){for(let un=0;un<ze;un++)Pi[un]=qe[hn*ze+un];directConvolution(Pi,cn,nn);for(let un=0;un<ze;un++)Qe[hn*ze+un]=nn[ln+un]}cn=f[0],ln=(cn.length-1)/2,nn=new Array(Ke+cn.length-1),Pi=new Array(Ke);for(let hn=0;hn<ze;hn++){for(let un=0;un<Ke;un++)Pi[un]=Qe[un*ze+hn];directConvolution(Pi,cn,nn);for(let un=0;un<Ke;un++)Qe[un*ze+hn]=nn[ln+un]}return Qe}var matrix$1={};const toString$1=Object.prototype.toString;function isAnyArray(qe){const f=toString$1.call(qe);return f.endsWith("Array]")&&!f.includes("Big")}const libEsm=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray},Symbol.toStringTag,{value:"Module"})),require$$0$1=getAugmentedNamespace(libEsm);function max$1(qe){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(qe))throw new TypeError("input must be an array");if(qe.length===0)throw new TypeError("input must not be empty");var ze=f.fromIndex,Ke=ze===void 0?0:ze,Qe=f.toIndex,Pi=Qe===void 0?qe.length:Qe;if(Ke<0||Ke>=qe.length||!Number.isInteger(Ke))throw new Error("fromIndex must be a positive integer smaller than length");if(Pi<=Ke||Pi>qe.length||!Number.isInteger(Pi))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var nn=qe[Ke],ln=Ke+1;ln<Pi;ln++)qe[ln]>nn&&(nn=qe[ln]);return nn}function min$1(qe){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray(qe))throw new TypeError("input must be an array");if(qe.length===0)throw new TypeError("input must not be empty");var ze=f.fromIndex,Ke=ze===void 0?0:ze,Qe=f.toIndex,Pi=Qe===void 0?qe.length:Qe;if(Ke<0||Ke>=qe.length||!Number.isInteger(Ke))throw new Error("fromIndex must be a positive integer smaller than length");if(Pi<=Ke||Pi>qe.length||!Number.isInteger(Pi))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var nn=qe[Ke],ln=Ke+1;ln<Pi;ln++)qe[ln]<nn&&(nn=qe[ln]);return nn}function rescale(qe){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(isAnyArray(qe)){if(qe.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var ze;if(f.output!==void 0){if(!isAnyArray(f.output))throw new TypeError("output option must be an array if specified");ze=f.output}else ze=new Array(qe.length);var Ke=min$1(qe),Qe=max$1(qe);if(Ke===Qe)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var Pi=f.min,nn=Pi===void 0?f.autoMinMax?Ke:0:Pi,ln=f.max,cn=ln===void 0?f.autoMinMax?Qe:1:ln;if(nn>=cn)throw new RangeError("min option must be smaller than max option");for(var hn=(cn-nn)/(Qe-Ke),un=0;un<qe.length;un++)ze[un]=(qe[un]-Ke)*hn+nn;return ze}const libEs6=Object.freeze(Object.defineProperty({__proto__:null,default:rescale},Symbol.toStringTag,{value:"Module"})),require$$1=getAugmentedNamespace(libEs6);var hasRequiredMatrix;function requireMatrix(){var xc,Lc,uc;if(hasRequiredMatrix)return matrix$1;hasRequiredMatrix=1,Object.defineProperty(matrix$1,"__esModule",{value:!0});var qe=require$$0$1,f=require$$1;const ze=" ".repeat(2),Ke=" ".repeat(4);function Qe(){return Pi(this)}function Pi(sa,bs={}){const{maxRows:xs=15,maxColumns:Kn=10,maxNumSize:Cs=8,padMinus:ia="auto"}=bs;return`${sa.constructor.name} {
${ze}[
${Ke}${nn(sa,xs,Kn,Cs,ia)}
${ze}]
${ze}rows: ${sa.rows}
${ze}columns: ${sa.columns}
}`}function nn(sa,bs,xs,Kn,Cs){const{rows:ia,columns:Za}=sa,Ja=Math.min(ia,bs),Qa=Math.min(Za,xs),aa=[];if(Cs==="auto"){Cs=!1;e:for(let pa=0;pa<Ja;pa++)for(let ha=0;ha<Qa;ha++)if(sa.get(pa,ha)<0){Cs=!0;break e}}for(let pa=0;pa<Ja;pa++){let ha=[];for(let Ma=0;Ma<Qa;Ma++)ha.push(ln(sa.get(pa,Ma),Kn,Cs));aa.push(`${ha.join(" ")}`)}return Qa!==Za&&(aa[aa.length-1]+=` ... ${Za-xs} more columns`),Ja!==ia&&aa.push(`... ${ia-bs} more rows`),aa.join(`
${Ke}`)}function ln(sa,bs,xs){return(sa>=0&&xs?` ${cn(sa,bs-1)}`:cn(sa,bs)).padEnd(bs)}function cn(sa,bs){let xs=sa.toString();if(xs.length<=bs)return xs;let Kn=sa.toFixed(bs);if(Kn.length>bs&&(Kn=sa.toFixed(Math.max(0,bs-(Kn.length-bs)))),Kn.length<=bs&&!Kn.startsWith("0.000")&&!Kn.startsWith("-0.000"))return Kn;let Cs=sa.toExponential(bs);return Cs.length>bs&&(Cs=sa.toExponential(Math.max(0,bs-(Cs.length-bs)))),Cs.slice(0)}function hn(sa,bs){sa.prototype.add=function(Kn){return typeof Kn=="number"?this.addS(Kn):this.addM(Kn)},sa.prototype.addS=function(Kn){for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)+Kn);return this},sa.prototype.addM=function(Kn){if(Kn=bs.checkMatrix(Kn),this.rows!==Kn.rows||this.columns!==Kn.columns)throw new RangeError("Matrices dimensions must be equal");for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)+Kn.get(Cs,ia));return this},sa.add=function(Kn,Cs){return new bs(Kn).add(Cs)},sa.prototype.sub=function(Kn){return typeof Kn=="number"?this.subS(Kn):this.subM(Kn)},sa.prototype.subS=function(Kn){for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)-Kn);return this},sa.prototype.subM=function(Kn){if(Kn=bs.checkMatrix(Kn),this.rows!==Kn.rows||this.columns!==Kn.columns)throw new RangeError("Matrices dimensions must be equal");for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)-Kn.get(Cs,ia));return this},sa.sub=function(Kn,Cs){return new bs(Kn).sub(Cs)},sa.prototype.subtract=sa.prototype.sub,sa.prototype.subtractS=sa.prototype.subS,sa.prototype.subtractM=sa.prototype.subM,sa.subtract=sa.sub,sa.prototype.mul=function(Kn){return typeof Kn=="number"?this.mulS(Kn):this.mulM(Kn)},sa.prototype.mulS=function(Kn){for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)*Kn);return this},sa.prototype.mulM=function(Kn){if(Kn=bs.checkMatrix(Kn),this.rows!==Kn.rows||this.columns!==Kn.columns)throw new RangeError("Matrices dimensions must be equal");for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)*Kn.get(Cs,ia));return this},sa.mul=function(Kn,Cs){return new bs(Kn).mul(Cs)},sa.prototype.multiply=sa.prototype.mul,sa.prototype.multiplyS=sa.prototype.mulS,sa.prototype.multiplyM=sa.prototype.mulM,sa.multiply=sa.mul,sa.prototype.div=function(Kn){return typeof Kn=="number"?this.divS(Kn):this.divM(Kn)},sa.prototype.divS=function(Kn){for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)/Kn);return this},sa.prototype.divM=function(Kn){if(Kn=bs.checkMatrix(Kn),this.rows!==Kn.rows||this.columns!==Kn.columns)throw new RangeError("Matrices dimensions must be equal");for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)/Kn.get(Cs,ia));return this},sa.div=function(Kn,Cs){return new bs(Kn).div(Cs)},sa.prototype.divide=sa.prototype.div,sa.prototype.divideS=sa.prototype.divS,sa.prototype.divideM=sa.prototype.divM,sa.divide=sa.div,sa.prototype.mod=function(Kn){return typeof Kn=="number"?this.modS(Kn):this.modM(Kn)},sa.prototype.modS=function(Kn){for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)%Kn);return this},sa.prototype.modM=function(Kn){if(Kn=bs.checkMatrix(Kn),this.rows!==Kn.rows||this.columns!==Kn.columns)throw new RangeError("Matrices dimensions must be equal");for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)%Kn.get(Cs,ia));return this},sa.mod=function(Kn,Cs){return new bs(Kn).mod(Cs)},sa.prototype.modulus=sa.prototype.mod,sa.prototype.modulusS=sa.prototype.modS,sa.prototype.modulusM=sa.prototype.modM,sa.modulus=sa.mod,sa.prototype.and=function(Kn){return typeof Kn=="number"?this.andS(Kn):this.andM(Kn)},sa.prototype.andS=function(Kn){for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)&Kn);return this},sa.prototype.andM=function(Kn){if(Kn=bs.checkMatrix(Kn),this.rows!==Kn.rows||this.columns!==Kn.columns)throw new RangeError("Matrices dimensions must be equal");for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)&Kn.get(Cs,ia));return this},sa.and=function(Kn,Cs){return new bs(Kn).and(Cs)},sa.prototype.or=function(Kn){return typeof Kn=="number"?this.orS(Kn):this.orM(Kn)},sa.prototype.orS=function(Kn){for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)|Kn);return this},sa.prototype.orM=function(Kn){if(Kn=bs.checkMatrix(Kn),this.rows!==Kn.rows||this.columns!==Kn.columns)throw new RangeError("Matrices dimensions must be equal");for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)|Kn.get(Cs,ia));return this},sa.or=function(Kn,Cs){return new bs(Kn).or(Cs)},sa.prototype.xor=function(Kn){return typeof Kn=="number"?this.xorS(Kn):this.xorM(Kn)},sa.prototype.xorS=function(Kn){for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)^Kn);return this},sa.prototype.xorM=function(Kn){if(Kn=bs.checkMatrix(Kn),this.rows!==Kn.rows||this.columns!==Kn.columns)throw new RangeError("Matrices dimensions must be equal");for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)^Kn.get(Cs,ia));return this},sa.xor=function(Kn,Cs){return new bs(Kn).xor(Cs)},sa.prototype.leftShift=function(Kn){return typeof Kn=="number"?this.leftShiftS(Kn):this.leftShiftM(Kn)},sa.prototype.leftShiftS=function(Kn){for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)<<Kn);return this},sa.prototype.leftShiftM=function(Kn){if(Kn=bs.checkMatrix(Kn),this.rows!==Kn.rows||this.columns!==Kn.columns)throw new RangeError("Matrices dimensions must be equal");for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)<<Kn.get(Cs,ia));return this},sa.leftShift=function(Kn,Cs){return new bs(Kn).leftShift(Cs)},sa.prototype.signPropagatingRightShift=function(Kn){return typeof Kn=="number"?this.signPropagatingRightShiftS(Kn):this.signPropagatingRightShiftM(Kn)},sa.prototype.signPropagatingRightShiftS=function(Kn){for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)>>Kn);return this},sa.prototype.signPropagatingRightShiftM=function(Kn){if(Kn=bs.checkMatrix(Kn),this.rows!==Kn.rows||this.columns!==Kn.columns)throw new RangeError("Matrices dimensions must be equal");for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)>>Kn.get(Cs,ia));return this},sa.signPropagatingRightShift=function(Kn,Cs){return new bs(Kn).signPropagatingRightShift(Cs)},sa.prototype.rightShift=function(Kn){return typeof Kn=="number"?this.rightShiftS(Kn):this.rightShiftM(Kn)},sa.prototype.rightShiftS=function(Kn){for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)>>>Kn);return this},sa.prototype.rightShiftM=function(Kn){if(Kn=bs.checkMatrix(Kn),this.rows!==Kn.rows||this.columns!==Kn.columns)throw new RangeError("Matrices dimensions must be equal");for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)>>>Kn.get(Cs,ia));return this},sa.rightShift=function(Kn,Cs){return new bs(Kn).rightShift(Cs)},sa.prototype.zeroFillRightShift=sa.prototype.rightShift,sa.prototype.zeroFillRightShiftS=sa.prototype.rightShiftS,sa.prototype.zeroFillRightShiftM=sa.prototype.rightShiftM,sa.zeroFillRightShift=sa.rightShift,sa.prototype.not=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,~this.get(Kn,Cs));return this},sa.not=function(Kn){return new bs(Kn).not()},sa.prototype.abs=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.abs(this.get(Kn,Cs)));return this},sa.abs=function(Kn){return new bs(Kn).abs()},sa.prototype.acos=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.acos(this.get(Kn,Cs)));return this},sa.acos=function(Kn){return new bs(Kn).acos()},sa.prototype.acosh=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.acosh(this.get(Kn,Cs)));return this},sa.acosh=function(Kn){return new bs(Kn).acosh()},sa.prototype.asin=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.asin(this.get(Kn,Cs)));return this},sa.asin=function(Kn){return new bs(Kn).asin()},sa.prototype.asinh=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.asinh(this.get(Kn,Cs)));return this},sa.asinh=function(Kn){return new bs(Kn).asinh()},sa.prototype.atan=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.atan(this.get(Kn,Cs)));return this},sa.atan=function(Kn){return new bs(Kn).atan()},sa.prototype.atanh=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.atanh(this.get(Kn,Cs)));return this},sa.atanh=function(Kn){return new bs(Kn).atanh()},sa.prototype.cbrt=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.cbrt(this.get(Kn,Cs)));return this},sa.cbrt=function(Kn){return new bs(Kn).cbrt()},sa.prototype.ceil=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.ceil(this.get(Kn,Cs)));return this},sa.ceil=function(Kn){return new bs(Kn).ceil()},sa.prototype.clz32=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.clz32(this.get(Kn,Cs)));return this},sa.clz32=function(Kn){return new bs(Kn).clz32()},sa.prototype.cos=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.cos(this.get(Kn,Cs)));return this},sa.cos=function(Kn){return new bs(Kn).cos()},sa.prototype.cosh=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.cosh(this.get(Kn,Cs)));return this},sa.cosh=function(Kn){return new bs(Kn).cosh()},sa.prototype.exp=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.exp(this.get(Kn,Cs)));return this},sa.exp=function(Kn){return new bs(Kn).exp()},sa.prototype.expm1=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.expm1(this.get(Kn,Cs)));return this},sa.expm1=function(Kn){return new bs(Kn).expm1()},sa.prototype.floor=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.floor(this.get(Kn,Cs)));return this},sa.floor=function(Kn){return new bs(Kn).floor()},sa.prototype.fround=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.fround(this.get(Kn,Cs)));return this},sa.fround=function(Kn){return new bs(Kn).fround()},sa.prototype.log=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.log(this.get(Kn,Cs)));return this},sa.log=function(Kn){return new bs(Kn).log()},sa.prototype.log1p=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.log1p(this.get(Kn,Cs)));return this},sa.log1p=function(Kn){return new bs(Kn).log1p()},sa.prototype.log10=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.log10(this.get(Kn,Cs)));return this},sa.log10=function(Kn){return new bs(Kn).log10()},sa.prototype.log2=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.log2(this.get(Kn,Cs)));return this},sa.log2=function(Kn){return new bs(Kn).log2()},sa.prototype.round=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.round(this.get(Kn,Cs)));return this},sa.round=function(Kn){return new bs(Kn).round()},sa.prototype.sign=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.sign(this.get(Kn,Cs)));return this},sa.sign=function(Kn){return new bs(Kn).sign()},sa.prototype.sin=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.sin(this.get(Kn,Cs)));return this},sa.sin=function(Kn){return new bs(Kn).sin()},sa.prototype.sinh=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.sinh(this.get(Kn,Cs)));return this},sa.sinh=function(Kn){return new bs(Kn).sinh()},sa.prototype.sqrt=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.sqrt(this.get(Kn,Cs)));return this},sa.sqrt=function(Kn){return new bs(Kn).sqrt()},sa.prototype.tan=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.tan(this.get(Kn,Cs)));return this},sa.tan=function(Kn){return new bs(Kn).tan()},sa.prototype.tanh=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.tanh(this.get(Kn,Cs)));return this},sa.tanh=function(Kn){return new bs(Kn).tanh()},sa.prototype.trunc=function(){for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.set(Kn,Cs,Math.trunc(this.get(Kn,Cs)));return this},sa.trunc=function(Kn){return new bs(Kn).trunc()},sa.pow=function(Kn,Cs){return new bs(Kn).pow(Cs)},sa.prototype.pow=function(Kn){return typeof Kn=="number"?this.powS(Kn):this.powM(Kn)},sa.prototype.powS=function(Kn){for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)**Kn);return this},sa.prototype.powM=function(Kn){if(Kn=bs.checkMatrix(Kn),this.rows!==Kn.rows||this.columns!==Kn.columns)throw new RangeError("Matrices dimensions must be equal");for(let Cs=0;Cs<this.rows;Cs++)for(let ia=0;ia<this.columns;ia++)this.set(Cs,ia,this.get(Cs,ia)**Kn.get(Cs,ia));return this}}function un(sa,bs,xs){let Kn=xs?sa.rows:sa.rows-1;if(bs<0||bs>Kn)throw new RangeError("Row index out of range")}function zn(sa,bs,xs){let Kn=xs?sa.columns:sa.columns-1;if(bs<0||bs>Kn)throw new RangeError("Column index out of range")}function Xn(sa,bs){if(bs.to1DArray&&(bs=bs.to1DArray()),bs.length!==sa.columns)throw new RangeError("vector size must be the same as the number of columns");return bs}function Un(sa,bs){if(bs.to1DArray&&(bs=bs.to1DArray()),bs.length!==sa.rows)throw new RangeError("vector size must be the same as the number of rows");return bs}function qn(sa,bs){if(!qe.isAnyArray(bs))throw new TypeError("row indices must be an array");for(let xs=0;xs<bs.length;xs++)if(bs[xs]<0||bs[xs]>=sa.rows)throw new RangeError("row indices are out of range")}function ys(sa,bs){if(!qe.isAnyArray(bs))throw new TypeError("column indices must be an array");for(let xs=0;xs<bs.length;xs++)if(bs[xs]<0||bs[xs]>=sa.columns)throw new RangeError("column indices are out of range")}function vs(sa,bs,xs,Kn,Cs){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(na("startRow",bs),na("endRow",xs),na("startColumn",Kn),na("endColumn",Cs),bs>xs||Kn>Cs||bs<0||bs>=sa.rows||xs<0||xs>=sa.rows||Kn<0||Kn>=sa.columns||Cs<0||Cs>=sa.columns)throw new RangeError("Submatrix indices are out of range")}function ea(sa,bs=0){let xs=[];for(let Kn=0;Kn<sa;Kn++)xs.push(bs);return xs}function na(sa,bs){if(typeof bs!="number")throw new TypeError(`${sa} must be a number`)}function ta(sa){if(sa.isEmpty())throw new Error("Empty matrix has no elements to index")}function ra(sa){let bs=ea(sa.rows);for(let xs=0;xs<sa.rows;++xs)for(let Kn=0;Kn<sa.columns;++Kn)bs[xs]+=sa.get(xs,Kn);return bs}function oa(sa){let bs=ea(sa.columns);for(let xs=0;xs<sa.rows;++xs)for(let Kn=0;Kn<sa.columns;++Kn)bs[Kn]+=sa.get(xs,Kn);return bs}function fa(sa){let bs=0;for(let xs=0;xs<sa.rows;xs++)for(let Kn=0;Kn<sa.columns;Kn++)bs+=sa.get(xs,Kn);return bs}function ca(sa){let bs=ea(sa.rows,1);for(let xs=0;xs<sa.rows;++xs)for(let Kn=0;Kn<sa.columns;++Kn)bs[xs]*=sa.get(xs,Kn);return bs}function la(sa){let bs=ea(sa.columns,1);for(let xs=0;xs<sa.rows;++xs)for(let Kn=0;Kn<sa.columns;++Kn)bs[Kn]*=sa.get(xs,Kn);return bs}function ua(sa){let bs=1;for(let xs=0;xs<sa.rows;xs++)for(let Kn=0;Kn<sa.columns;Kn++)bs*=sa.get(xs,Kn);return bs}function ga(sa,bs,xs){const Kn=sa.rows,Cs=sa.columns,ia=[];for(let Za=0;Za<Kn;Za++){let Ja=0,Qa=0,aa=0;for(let pa=0;pa<Cs;pa++)aa=sa.get(Za,pa)-xs[Za],Ja+=aa,Qa+=aa*aa;bs?ia.push((Qa-Ja*Ja/Cs)/(Cs-1)):ia.push((Qa-Ja*Ja/Cs)/Cs)}return ia}function da(sa,bs,xs){const Kn=sa.rows,Cs=sa.columns,ia=[];for(let Za=0;Za<Cs;Za++){let Ja=0,Qa=0,aa=0;for(let pa=0;pa<Kn;pa++)aa=sa.get(pa,Za)-xs[Za],Ja+=aa,Qa+=aa*aa;bs?ia.push((Qa-Ja*Ja/Kn)/(Kn-1)):ia.push((Qa-Ja*Ja/Kn)/Kn)}return ia}function qa(sa,bs,xs){const Kn=sa.rows,Cs=sa.columns,ia=Kn*Cs;let Za=0,Ja=0,Qa=0;for(let aa=0;aa<Kn;aa++)for(let pa=0;pa<Cs;pa++)Qa=sa.get(aa,pa)-xs,Za+=Qa,Ja+=Qa*Qa;return bs?(Ja-Za*Za/ia)/(ia-1):(Ja-Za*Za/ia)/ia}function tl(sa,bs){for(let xs=0;xs<sa.rows;xs++)for(let Kn=0;Kn<sa.columns;Kn++)sa.set(xs,Kn,sa.get(xs,Kn)-bs[xs])}function ol(sa,bs){for(let xs=0;xs<sa.rows;xs++)for(let Kn=0;Kn<sa.columns;Kn++)sa.set(xs,Kn,sa.get(xs,Kn)-bs[Kn])}function hl(sa,bs){for(let xs=0;xs<sa.rows;xs++)for(let Kn=0;Kn<sa.columns;Kn++)sa.set(xs,Kn,sa.get(xs,Kn)-bs)}function wl(sa){const bs=[];for(let xs=0;xs<sa.rows;xs++){let Kn=0;for(let Cs=0;Cs<sa.columns;Cs++)Kn+=sa.get(xs,Cs)**2/(sa.columns-1);bs.push(Math.sqrt(Kn))}return bs}function _l(sa,bs){for(let xs=0;xs<sa.rows;xs++)for(let Kn=0;Kn<sa.columns;Kn++)sa.set(xs,Kn,sa.get(xs,Kn)/bs[xs])}function gl(sa){const bs=[];for(let xs=0;xs<sa.columns;xs++){let Kn=0;for(let Cs=0;Cs<sa.rows;Cs++)Kn+=sa.get(Cs,xs)**2/(sa.rows-1);bs.push(Math.sqrt(Kn))}return bs}function dl(sa,bs){for(let xs=0;xs<sa.rows;xs++)for(let Kn=0;Kn<sa.columns;Kn++)sa.set(xs,Kn,sa.get(xs,Kn)/bs[Kn])}function sl(sa){const bs=sa.size-1;let xs=0;for(let Kn=0;Kn<sa.columns;Kn++)for(let Cs=0;Cs<sa.rows;Cs++)xs+=sa.get(Cs,Kn)**2/bs;return Math.sqrt(xs)}function kl(sa,bs){for(let xs=0;xs<sa.rows;xs++)for(let Kn=0;Kn<sa.columns;Kn++)sa.set(xs,Kn,sa.get(xs,Kn)/bs)}class pl{static from1DArray(bs,xs,Kn){if(bs*xs!==Kn.length)throw new RangeError("data length does not match given dimensions");let ia=new al(bs,xs);for(let Za=0;Za<bs;Za++)for(let Ja=0;Ja<xs;Ja++)ia.set(Za,Ja,Kn[Za*xs+Ja]);return ia}static rowVector(bs){let xs=new al(1,bs.length);for(let Kn=0;Kn<bs.length;Kn++)xs.set(0,Kn,bs[Kn]);return xs}static columnVector(bs){let xs=new al(bs.length,1);for(let Kn=0;Kn<bs.length;Kn++)xs.set(Kn,0,bs[Kn]);return xs}static zeros(bs,xs){return new al(bs,xs)}static ones(bs,xs){return new al(bs,xs).fill(1)}static rand(bs,xs,Kn={}){if(typeof Kn!="object")throw new TypeError("options must be an object");const{random:Cs=Math.random}=Kn;let ia=new al(bs,xs);for(let Za=0;Za<bs;Za++)for(let Ja=0;Ja<xs;Ja++)ia.set(Za,Ja,Cs());return ia}static randInt(bs,xs,Kn={}){if(typeof Kn!="object")throw new TypeError("options must be an object");const{min:Cs=0,max:ia=1e3,random:Za=Math.random}=Kn;if(!Number.isInteger(Cs))throw new TypeError("min must be an integer");if(!Number.isInteger(ia))throw new TypeError("max must be an integer");if(Cs>=ia)throw new RangeError("min must be smaller than max");let Ja=ia-Cs,Qa=new al(bs,xs);for(let aa=0;aa<bs;aa++)for(let pa=0;pa<xs;pa++){let ha=Cs+Math.round(Za()*Ja);Qa.set(aa,pa,ha)}return Qa}static eye(bs,xs,Kn){xs===void 0&&(xs=bs),Kn===void 0&&(Kn=1);let Cs=Math.min(bs,xs),ia=this.zeros(bs,xs);for(let Za=0;Za<Cs;Za++)ia.set(Za,Za,Kn);return ia}static diag(bs,xs,Kn){let Cs=bs.length;xs===void 0&&(xs=Cs),Kn===void 0&&(Kn=xs);let ia=Math.min(Cs,xs,Kn),Za=this.zeros(xs,Kn);for(let Ja=0;Ja<ia;Ja++)Za.set(Ja,Ja,bs[Ja]);return Za}static min(bs,xs){bs=this.checkMatrix(bs),xs=this.checkMatrix(xs);let Kn=bs.rows,Cs=bs.columns,ia=new al(Kn,Cs);for(let Za=0;Za<Kn;Za++)for(let Ja=0;Ja<Cs;Ja++)ia.set(Za,Ja,Math.min(bs.get(Za,Ja),xs.get(Za,Ja)));return ia}static max(bs,xs){bs=this.checkMatrix(bs),xs=this.checkMatrix(xs);let Kn=bs.rows,Cs=bs.columns,ia=new this(Kn,Cs);for(let Za=0;Za<Kn;Za++)for(let Ja=0;Ja<Cs;Ja++)ia.set(Za,Ja,Math.max(bs.get(Za,Ja),xs.get(Za,Ja)));return ia}static checkMatrix(bs){return pl.isMatrix(bs)?bs:new al(bs)}static isMatrix(bs){return bs!=null&&bs.klass==="Matrix"}get size(){return this.rows*this.columns}apply(bs){if(typeof bs!="function")throw new TypeError("callback must be a function");for(let xs=0;xs<this.rows;xs++)for(let Kn=0;Kn<this.columns;Kn++)bs.call(this,xs,Kn);return this}to1DArray(){let bs=[];for(let xs=0;xs<this.rows;xs++)for(let Kn=0;Kn<this.columns;Kn++)bs.push(this.get(xs,Kn));return bs}to2DArray(){let bs=[];for(let xs=0;xs<this.rows;xs++){bs.push([]);for(let Kn=0;Kn<this.columns;Kn++)bs[xs].push(this.get(xs,Kn))}return bs}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let bs=0;bs<this.rows;bs++)for(let xs=0;xs<=bs;xs++)if(this.get(bs,xs)!==this.get(xs,bs))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let bs=0;bs<this.rows;bs++)if(this.get(bs,bs)!==0)return!1;return!0}isEchelonForm(){let bs=0,xs=0,Kn=-1,Cs=!0,ia=!1;for(;bs<this.rows&&Cs;){for(xs=0,ia=!1;xs<this.columns&&ia===!1;)this.get(bs,xs)===0?xs++:this.get(bs,xs)===1&&xs>Kn?(ia=!0,Kn=xs):(Cs=!1,ia=!0);bs++}return Cs}isReducedEchelonForm(){let bs=0,xs=0,Kn=-1,Cs=!0,ia=!1;for(;bs<this.rows&&Cs;){for(xs=0,ia=!1;xs<this.columns&&ia===!1;)this.get(bs,xs)===0?xs++:this.get(bs,xs)===1&&xs>Kn?(ia=!0,Kn=xs):(Cs=!1,ia=!0);for(let Za=xs+1;Za<this.rows;Za++)this.get(bs,Za)!==0&&(Cs=!1);bs++}return Cs}echelonForm(){let bs=this.clone(),xs=0,Kn=0;for(;xs<bs.rows&&Kn<bs.columns;){let Cs=xs;for(let ia=xs;ia<bs.rows;ia++)bs.get(ia,Kn)>bs.get(Cs,Kn)&&(Cs=ia);if(bs.get(Cs,Kn)===0)Kn++;else{bs.swapRows(xs,Cs);let ia=bs.get(xs,Kn);for(let Za=Kn;Za<bs.columns;Za++)bs.set(xs,Za,bs.get(xs,Za)/ia);for(let Za=xs+1;Za<bs.rows;Za++){let Ja=bs.get(Za,Kn)/bs.get(xs,Kn);bs.set(Za,Kn,0);for(let Qa=Kn+1;Qa<bs.columns;Qa++)bs.set(Za,Qa,bs.get(Za,Qa)-bs.get(xs,Qa)*Ja)}xs++,Kn++}}return bs}reducedEchelonForm(){let bs=this.echelonForm(),xs=bs.columns,Kn=bs.rows,Cs=Kn-1;for(;Cs>=0;)if(bs.maxRow(Cs)===0)Cs--;else{let ia=0,Za=!1;for(;ia<Kn&&Za===!1;)bs.get(Cs,ia)===1?Za=!0:ia++;for(let Ja=0;Ja<Cs;Ja++){let Qa=bs.get(Ja,ia);for(let aa=ia;aa<xs;aa++){let pa=bs.get(Ja,aa)-Qa*bs.get(Cs,aa);bs.set(Ja,aa,pa)}}Cs--}return bs}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(bs={}){if(typeof bs!="object")throw new TypeError("options must be an object");const{rows:xs=1,columns:Kn=1}=bs;if(!Number.isInteger(xs)||xs<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(Kn)||Kn<=0)throw new TypeError("columns must be a positive integer");let Cs=new al(this.rows*xs,this.columns*Kn);for(let ia=0;ia<xs;ia++)for(let Za=0;Za<Kn;Za++)Cs.setSubMatrix(this,this.rows*ia,this.columns*Za);return Cs}fill(bs){for(let xs=0;xs<this.rows;xs++)for(let Kn=0;Kn<this.columns;Kn++)this.set(xs,Kn,bs);return this}neg(){return this.mulS(-1)}getRow(bs){un(this,bs);let xs=[];for(let Kn=0;Kn<this.columns;Kn++)xs.push(this.get(bs,Kn));return xs}getRowVector(bs){return al.rowVector(this.getRow(bs))}setRow(bs,xs){un(this,bs),xs=Xn(this,xs);for(let Kn=0;Kn<this.columns;Kn++)this.set(bs,Kn,xs[Kn]);return this}swapRows(bs,xs){un(this,bs),un(this,xs);for(let Kn=0;Kn<this.columns;Kn++){let Cs=this.get(bs,Kn);this.set(bs,Kn,this.get(xs,Kn)),this.set(xs,Kn,Cs)}return this}getColumn(bs){zn(this,bs);let xs=[];for(let Kn=0;Kn<this.rows;Kn++)xs.push(this.get(Kn,bs));return xs}getColumnVector(bs){return al.columnVector(this.getColumn(bs))}setColumn(bs,xs){zn(this,bs),xs=Un(this,xs);for(let Kn=0;Kn<this.rows;Kn++)this.set(Kn,bs,xs[Kn]);return this}swapColumns(bs,xs){zn(this,bs),zn(this,xs);for(let Kn=0;Kn<this.rows;Kn++){let Cs=this.get(Kn,bs);this.set(Kn,bs,this.get(Kn,xs)),this.set(Kn,xs,Cs)}return this}addRowVector(bs){bs=Xn(this,bs);for(let xs=0;xs<this.rows;xs++)for(let Kn=0;Kn<this.columns;Kn++)this.set(xs,Kn,this.get(xs,Kn)+bs[Kn]);return this}subRowVector(bs){bs=Xn(this,bs);for(let xs=0;xs<this.rows;xs++)for(let Kn=0;Kn<this.columns;Kn++)this.set(xs,Kn,this.get(xs,Kn)-bs[Kn]);return this}mulRowVector(bs){bs=Xn(this,bs);for(let xs=0;xs<this.rows;xs++)for(let Kn=0;Kn<this.columns;Kn++)this.set(xs,Kn,this.get(xs,Kn)*bs[Kn]);return this}divRowVector(bs){bs=Xn(this,bs);for(let xs=0;xs<this.rows;xs++)for(let Kn=0;Kn<this.columns;Kn++)this.set(xs,Kn,this.get(xs,Kn)/bs[Kn]);return this}addColumnVector(bs){bs=Un(this,bs);for(let xs=0;xs<this.rows;xs++)for(let Kn=0;Kn<this.columns;Kn++)this.set(xs,Kn,this.get(xs,Kn)+bs[xs]);return this}subColumnVector(bs){bs=Un(this,bs);for(let xs=0;xs<this.rows;xs++)for(let Kn=0;Kn<this.columns;Kn++)this.set(xs,Kn,this.get(xs,Kn)-bs[xs]);return this}mulColumnVector(bs){bs=Un(this,bs);for(let xs=0;xs<this.rows;xs++)for(let Kn=0;Kn<this.columns;Kn++)this.set(xs,Kn,this.get(xs,Kn)*bs[xs]);return this}divColumnVector(bs){bs=Un(this,bs);for(let xs=0;xs<this.rows;xs++)for(let Kn=0;Kn<this.columns;Kn++)this.set(xs,Kn,this.get(xs,Kn)/bs[xs]);return this}mulRow(bs,xs){un(this,bs);for(let Kn=0;Kn<this.columns;Kn++)this.set(bs,Kn,this.get(bs,Kn)*xs);return this}mulColumn(bs,xs){zn(this,bs);for(let Kn=0;Kn<this.rows;Kn++)this.set(Kn,bs,this.get(Kn,bs)*xs);return this}max(bs){if(this.isEmpty())return NaN;switch(bs){case"row":{const xs=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.get(Kn,Cs)>xs[Kn]&&(xs[Kn]=this.get(Kn,Cs));return xs}case"column":{const xs=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.get(Kn,Cs)>xs[Cs]&&(xs[Cs]=this.get(Kn,Cs));return xs}case void 0:{let xs=this.get(0,0);for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.get(Kn,Cs)>xs&&(xs=this.get(Kn,Cs));return xs}default:throw new Error(`invalid option: ${bs}`)}}maxIndex(){ta(this);let bs=this.get(0,0),xs=[0,0];for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.get(Kn,Cs)>bs&&(bs=this.get(Kn,Cs),xs[0]=Kn,xs[1]=Cs);return xs}min(bs){if(this.isEmpty())return NaN;switch(bs){case"row":{const xs=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.get(Kn,Cs)<xs[Kn]&&(xs[Kn]=this.get(Kn,Cs));return xs}case"column":{const xs=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.get(Kn,Cs)<xs[Cs]&&(xs[Cs]=this.get(Kn,Cs));return xs}case void 0:{let xs=this.get(0,0);for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.get(Kn,Cs)<xs&&(xs=this.get(Kn,Cs));return xs}default:throw new Error(`invalid option: ${bs}`)}}minIndex(){ta(this);let bs=this.get(0,0),xs=[0,0];for(let Kn=0;Kn<this.rows;Kn++)for(let Cs=0;Cs<this.columns;Cs++)this.get(Kn,Cs)<bs&&(bs=this.get(Kn,Cs),xs[0]=Kn,xs[1]=Cs);return xs}maxRow(bs){if(un(this,bs),this.isEmpty())return NaN;let xs=this.get(bs,0);for(let Kn=1;Kn<this.columns;Kn++)this.get(bs,Kn)>xs&&(xs=this.get(bs,Kn));return xs}maxRowIndex(bs){un(this,bs),ta(this);let xs=this.get(bs,0),Kn=[bs,0];for(let Cs=1;Cs<this.columns;Cs++)this.get(bs,Cs)>xs&&(xs=this.get(bs,Cs),Kn[1]=Cs);return Kn}minRow(bs){if(un(this,bs),this.isEmpty())return NaN;let xs=this.get(bs,0);for(let Kn=1;Kn<this.columns;Kn++)this.get(bs,Kn)<xs&&(xs=this.get(bs,Kn));return xs}minRowIndex(bs){un(this,bs),ta(this);let xs=this.get(bs,0),Kn=[bs,0];for(let Cs=1;Cs<this.columns;Cs++)this.get(bs,Cs)<xs&&(xs=this.get(bs,Cs),Kn[1]=Cs);return Kn}maxColumn(bs){if(zn(this,bs),this.isEmpty())return NaN;let xs=this.get(0,bs);for(let Kn=1;Kn<this.rows;Kn++)this.get(Kn,bs)>xs&&(xs=this.get(Kn,bs));return xs}maxColumnIndex(bs){zn(this,bs),ta(this);let xs=this.get(0,bs),Kn=[0,bs];for(let Cs=1;Cs<this.rows;Cs++)this.get(Cs,bs)>xs&&(xs=this.get(Cs,bs),Kn[0]=Cs);return Kn}minColumn(bs){if(zn(this,bs),this.isEmpty())return NaN;let xs=this.get(0,bs);for(let Kn=1;Kn<this.rows;Kn++)this.get(Kn,bs)<xs&&(xs=this.get(Kn,bs));return xs}minColumnIndex(bs){zn(this,bs),ta(this);let xs=this.get(0,bs),Kn=[0,bs];for(let Cs=1;Cs<this.rows;Cs++)this.get(Cs,bs)<xs&&(xs=this.get(Cs,bs),Kn[0]=Cs);return Kn}diag(){let bs=Math.min(this.rows,this.columns),xs=[];for(let Kn=0;Kn<bs;Kn++)xs.push(this.get(Kn,Kn));return xs}norm(bs="frobenius"){switch(bs){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${bs}`)}}cumulativeSum(){let bs=0;for(let xs=0;xs<this.rows;xs++)for(let Kn=0;Kn<this.columns;Kn++)bs+=this.get(xs,Kn),this.set(xs,Kn,bs);return this}dot(bs){pl.isMatrix(bs)&&(bs=bs.to1DArray());let xs=this.to1DArray();if(xs.length!==bs.length)throw new RangeError("vectors do not have the same size");let Kn=0;for(let Cs=0;Cs<xs.length;Cs++)Kn+=xs[Cs]*bs[Cs];return Kn}mmul(bs){bs=al.checkMatrix(bs);let xs=this.rows,Kn=this.columns,Cs=bs.columns,ia=new al(xs,Cs),Za=new Float64Array(Kn);for(let Ja=0;Ja<Cs;Ja++){for(let Qa=0;Qa<Kn;Qa++)Za[Qa]=bs.get(Qa,Ja);for(let Qa=0;Qa<xs;Qa++){let aa=0;for(let pa=0;pa<Kn;pa++)aa+=this.get(Qa,pa)*Za[pa];ia.set(Qa,Ja,aa)}}return ia}mpow(bs){if(!this.isSquare())throw new RangeError("Matrix must be square");if(!Number.isInteger(bs)||bs<0)throw new RangeError("Exponent must be a non-negative integer");let xs=al.eye(this.rows),Kn=this;for(let Cs=bs;Cs>=1;Cs/=2)(Cs&1)!==0&&(xs=xs.mmul(Kn)),Kn=Kn.mmul(Kn);return xs}strassen2x2(bs){bs=al.checkMatrix(bs);let xs=new al(2,2);const Kn=this.get(0,0),Cs=bs.get(0,0),ia=this.get(0,1),Za=bs.get(0,1),Ja=this.get(1,0),Qa=bs.get(1,0),aa=this.get(1,1),pa=bs.get(1,1),ha=(Kn+aa)*(Cs+pa),Ma=(Ja+aa)*Cs,Ka=Kn*(Za-pa),Na=aa*(Qa-Cs),el=(Kn+ia)*pa,fl=(Ja-Kn)*(Cs+Za),Ua=(ia-aa)*(Qa+pa),il=ha+Na-el+Ua,ll=Ka+el,Tl=Ma+Na,Dl=ha-Ma+Ka+fl;return xs.set(0,0,il),xs.set(0,1,ll),xs.set(1,0,Tl),xs.set(1,1,Dl),xs}strassen3x3(bs){bs=al.checkMatrix(bs);let xs=new al(3,3);const Kn=this.get(0,0),Cs=this.get(0,1),ia=this.get(0,2),Za=this.get(1,0),Ja=this.get(1,1),Qa=this.get(1,2),aa=this.get(2,0),pa=this.get(2,1),ha=this.get(2,2),Ma=bs.get(0,0),Ka=bs.get(0,1),Na=bs.get(0,2),el=bs.get(1,0),fl=bs.get(1,1),Ua=bs.get(1,2),il=bs.get(2,0),ll=bs.get(2,1),Tl=bs.get(2,2),Dl=(Kn+Cs+ia-Za-Ja-pa-ha)*fl,Nl=(Kn-Za)*(-Ka+fl),bl=Ja*(-Ma+Ka+el-fl-Ua-il+Tl),Cl=(-Kn+Za+Ja)*(Ma-Ka+fl),Kl=(Za+Ja)*(-Ma+Ka),ul=Kn*Ma,Ml=(-Kn+aa+pa)*(Ma-Na+Ua),Ul=(-Kn+aa)*(Na-Ua),Bl=(aa+pa)*(-Ma+Na),sc=(Kn+Cs+ia-Ja-Qa-aa-pa)*Ua,ic=pa*(-Ma+Na+el-fl-Ua-il+ll),nc=(-ia+pa+ha)*(fl+il-ll),lc=(ia-ha)*(fl-ll),cc=ia*il,Ac=(pa+ha)*(-il+ll),dc=(-ia+Ja+Qa)*(Ua+il-Tl),Fc=(ia-Qa)*(Ua-Tl),Dc=(Ja+Qa)*(-il+Tl),rc=Cs*el,_c=Qa*ll,Tc=Za*Na,Ec=aa*Ka,gc=ha*Tl,jc=ul+cc+rc,Xc=Dl+Cl+Kl+ul+nc+cc+Ac,Hc=ul+Ml+Bl+sc+cc+dc+Dc,Wc=Nl+bl+Cl+ul+cc+dc+Fc,zc=Nl+Cl+Kl+ul+_c,Yc=cc+dc+Fc+Dc+Tc,Gc=ul+Ml+Ul+ic+nc+lc+cc,qc=nc+lc+cc+Ac+Ec,Kc=ul+Ml+Ul+Bl+gc;return xs.set(0,0,jc),xs.set(0,1,Xc),xs.set(0,2,Hc),xs.set(1,0,Wc),xs.set(1,1,zc),xs.set(1,2,Yc),xs.set(2,0,Gc),xs.set(2,1,qc),xs.set(2,2,Kc),xs}mmulStrassen(bs){bs=al.checkMatrix(bs);let xs=this.clone(),Kn=xs.rows,Cs=xs.columns,ia=bs.rows,Za=bs.columns;Cs!==ia&&console.warn(`Multiplying ${Kn} x ${Cs} and ${ia} x ${Za} matrix: dimensions do not match.`);function Ja(ha,Ma,Ka){let Na=ha.rows,el=ha.columns;if(Na===Ma&&el===Ka)return ha;{let fl=pl.zeros(Ma,Ka);return fl=fl.setSubMatrix(ha,0,0),fl}}let Qa=Math.max(Kn,ia),aa=Math.max(Cs,Za);xs=Ja(xs,Qa,aa),bs=Ja(bs,Qa,aa);function pa(ha,Ma,Ka,Na){if(Ka<=512||Na<=512)return ha.mmul(Ma);Ka%2===1&&Na%2===1?(ha=Ja(ha,Ka+1,Na+1),Ma=Ja(Ma,Ka+1,Na+1)):Ka%2===1?(ha=Ja(ha,Ka+1,Na),Ma=Ja(Ma,Ka+1,Na)):Na%2===1&&(ha=Ja(ha,Ka,Na+1),Ma=Ja(Ma,Ka,Na+1));let el=parseInt(ha.rows/2,10),fl=parseInt(ha.columns/2,10),Ua=ha.subMatrix(0,el-1,0,fl-1),il=Ma.subMatrix(0,el-1,0,fl-1),ll=ha.subMatrix(0,el-1,fl,ha.columns-1),Tl=Ma.subMatrix(0,el-1,fl,Ma.columns-1),Dl=ha.subMatrix(el,ha.rows-1,0,fl-1),Nl=Ma.subMatrix(el,Ma.rows-1,0,fl-1),bl=ha.subMatrix(el,ha.rows-1,fl,ha.columns-1),Cl=Ma.subMatrix(el,Ma.rows-1,fl,Ma.columns-1),Kl=pa(pl.add(Ua,bl),pl.add(il,Cl),el,fl),ul=pa(pl.add(Dl,bl),il,el,fl),Ml=pa(Ua,pl.sub(Tl,Cl),el,fl),Ul=pa(bl,pl.sub(Nl,il),el,fl),Bl=pa(pl.add(Ua,ll),Cl,el,fl),sc=pa(pl.sub(Dl,Ua),pl.add(il,Tl),el,fl),ic=pa(pl.sub(ll,bl),pl.add(Nl,Cl),el,fl),nc=pl.add(Kl,Ul);nc.sub(Bl),nc.add(ic);let lc=pl.add(Ml,Bl),cc=pl.add(ul,Ul),Ac=pl.sub(Kl,ul);Ac.add(Ml),Ac.add(sc);let dc=pl.zeros(2*nc.rows,2*nc.columns);return dc=dc.setSubMatrix(nc,0,0),dc=dc.setSubMatrix(lc,nc.rows,0),dc=dc.setSubMatrix(cc,0,nc.columns),dc=dc.setSubMatrix(Ac,nc.rows,nc.columns),dc.subMatrix(0,Ka-1,0,Na-1)}return pa(xs,bs,Qa,aa)}scaleRows(bs={}){if(typeof bs!="object")throw new TypeError("options must be an object");const{min:xs=0,max:Kn=1}=bs;if(!Number.isFinite(xs))throw new TypeError("min must be a number");if(!Number.isFinite(Kn))throw new TypeError("max must be a number");if(xs>=Kn)throw new RangeError("min must be smaller than max");let Cs=new al(this.rows,this.columns);for(let ia=0;ia<this.rows;ia++){const Za=this.getRow(ia);Za.length>0&&f(Za,{min:xs,max:Kn,output:Za}),Cs.setRow(ia,Za)}return Cs}scaleColumns(bs={}){if(typeof bs!="object")throw new TypeError("options must be an object");const{min:xs=0,max:Kn=1}=bs;if(!Number.isFinite(xs))throw new TypeError("min must be a number");if(!Number.isFinite(Kn))throw new TypeError("max must be a number");if(xs>=Kn)throw new RangeError("min must be smaller than max");let Cs=new al(this.rows,this.columns);for(let ia=0;ia<this.columns;ia++){const Za=this.getColumn(ia);Za.length&&f(Za,{min:xs,max:Kn,output:Za}),Cs.setColumn(ia,Za)}return Cs}flipRows(){const bs=Math.ceil(this.columns/2);for(let xs=0;xs<this.rows;xs++)for(let Kn=0;Kn<bs;Kn++){let Cs=this.get(xs,Kn),ia=this.get(xs,this.columns-1-Kn);this.set(xs,Kn,ia),this.set(xs,this.columns-1-Kn,Cs)}return this}flipColumns(){const bs=Math.ceil(this.rows/2);for(let xs=0;xs<this.columns;xs++)for(let Kn=0;Kn<bs;Kn++){let Cs=this.get(Kn,xs),ia=this.get(this.rows-1-Kn,xs);this.set(Kn,xs,ia),this.set(this.rows-1-Kn,xs,Cs)}return this}kroneckerProduct(bs){bs=al.checkMatrix(bs);let xs=this.rows,Kn=this.columns,Cs=bs.rows,ia=bs.columns,Za=new al(xs*Cs,Kn*ia);for(let Ja=0;Ja<xs;Ja++)for(let Qa=0;Qa<Kn;Qa++)for(let aa=0;aa<Cs;aa++)for(let pa=0;pa<ia;pa++)Za.set(Cs*Ja+aa,ia*Qa+pa,this.get(Ja,Qa)*bs.get(aa,pa));return Za}kroneckerSum(bs){if(bs=al.checkMatrix(bs),!this.isSquare()||!bs.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let xs=this.rows,Kn=bs.rows,Cs=this.kroneckerProduct(al.eye(Kn,Kn)),ia=al.eye(xs,xs).kroneckerProduct(bs);return Cs.add(ia)}transpose(){let bs=new al(this.columns,this.rows);for(let xs=0;xs<this.rows;xs++)for(let Kn=0;Kn<this.columns;Kn++)bs.set(Kn,xs,this.get(xs,Kn));return bs}sortRows(bs=Al){for(let xs=0;xs<this.rows;xs++)this.setRow(xs,this.getRow(xs).sort(bs));return this}sortColumns(bs=Al){for(let xs=0;xs<this.columns;xs++)this.setColumn(xs,this.getColumn(xs).sort(bs));return this}subMatrix(bs,xs,Kn,Cs){vs(this,bs,xs,Kn,Cs);let ia=new al(xs-bs+1,Cs-Kn+1);for(let Za=bs;Za<=xs;Za++)for(let Ja=Kn;Ja<=Cs;Ja++)ia.set(Za-bs,Ja-Kn,this.get(Za,Ja));return ia}subMatrixRow(bs,xs,Kn){if(xs===void 0&&(xs=0),Kn===void 0&&(Kn=this.columns-1),xs>Kn||xs<0||xs>=this.columns||Kn<0||Kn>=this.columns)throw new RangeError("Argument out of range");let Cs=new al(bs.length,Kn-xs+1);for(let ia=0;ia<bs.length;ia++)for(let Za=xs;Za<=Kn;Za++){if(bs[ia]<0||bs[ia]>=this.rows)throw new RangeError(`Row index out of range: ${bs[ia]}`);Cs.set(ia,Za-xs,this.get(bs[ia],Za))}return Cs}subMatrixColumn(bs,xs,Kn){if(xs===void 0&&(xs=0),Kn===void 0&&(Kn=this.rows-1),xs>Kn||xs<0||xs>=this.rows||Kn<0||Kn>=this.rows)throw new RangeError("Argument out of range");let Cs=new al(Kn-xs+1,bs.length);for(let ia=0;ia<bs.length;ia++)for(let Za=xs;Za<=Kn;Za++){if(bs[ia]<0||bs[ia]>=this.columns)throw new RangeError(`Column index out of range: ${bs[ia]}`);Cs.set(Za-xs,ia,this.get(Za,bs[ia]))}return Cs}setSubMatrix(bs,xs,Kn){if(bs=al.checkMatrix(bs),bs.isEmpty())return this;let Cs=xs+bs.rows-1,ia=Kn+bs.columns-1;vs(this,xs,Cs,Kn,ia);for(let Za=0;Za<bs.rows;Za++)for(let Ja=0;Ja<bs.columns;Ja++)this.set(xs+Za,Kn+Ja,bs.get(Za,Ja));return this}selection(bs,xs){qn(this,bs),ys(this,xs);let Kn=new al(bs.length,xs.length);for(let Cs=0;Cs<bs.length;Cs++){let ia=bs[Cs];for(let Za=0;Za<xs.length;Za++){let Ja=xs[Za];Kn.set(Cs,Za,this.get(ia,Ja))}}return Kn}trace(){let bs=Math.min(this.rows,this.columns),xs=0;for(let Kn=0;Kn<bs;Kn++)xs+=this.get(Kn,Kn);return xs}clone(){return this.constructor.copy(this,new al(this.rows,this.columns))}static copy(bs,xs){for(const[Kn,Cs,ia]of bs.entries())xs.set(Kn,Cs,ia);return xs}sum(bs){switch(bs){case"row":return ra(this);case"column":return oa(this);case void 0:return fa(this);default:throw new Error(`invalid option: ${bs}`)}}product(bs){switch(bs){case"row":return ca(this);case"column":return la(this);case void 0:return ua(this);default:throw new Error(`invalid option: ${bs}`)}}mean(bs){const xs=this.sum(bs);switch(bs){case"row":{for(let Kn=0;Kn<this.rows;Kn++)xs[Kn]/=this.columns;return xs}case"column":{for(let Kn=0;Kn<this.columns;Kn++)xs[Kn]/=this.rows;return xs}case void 0:return xs/this.size;default:throw new Error(`invalid option: ${bs}`)}}variance(bs,xs={}){if(typeof bs=="object"&&(xs=bs,bs=void 0),typeof xs!="object")throw new TypeError("options must be an object");const{unbiased:Kn=!0,mean:Cs=this.mean(bs)}=xs;if(typeof Kn!="boolean")throw new TypeError("unbiased must be a boolean");switch(bs){case"row":{if(!qe.isAnyArray(Cs))throw new TypeError("mean must be an array");return ga(this,Kn,Cs)}case"column":{if(!qe.isAnyArray(Cs))throw new TypeError("mean must be an array");return da(this,Kn,Cs)}case void 0:{if(typeof Cs!="number")throw new TypeError("mean must be a number");return qa(this,Kn,Cs)}default:throw new Error(`invalid option: ${bs}`)}}standardDeviation(bs,xs){typeof bs=="object"&&(xs=bs,bs=void 0);const Kn=this.variance(bs,xs);if(bs===void 0)return Math.sqrt(Kn);for(let Cs=0;Cs<Kn.length;Cs++)Kn[Cs]=Math.sqrt(Kn[Cs]);return Kn}center(bs,xs={}){if(typeof bs=="object"&&(xs=bs,bs=void 0),typeof xs!="object")throw new TypeError("options must be an object");const{center:Kn=this.mean(bs)}=xs;switch(bs){case"row":{if(!qe.isAnyArray(Kn))throw new TypeError("center must be an array");return tl(this,Kn),this}case"column":{if(!qe.isAnyArray(Kn))throw new TypeError("center must be an array");return ol(this,Kn),this}case void 0:{if(typeof Kn!="number")throw new TypeError("center must be a number");return hl(this,Kn),this}default:throw new Error(`invalid option: ${bs}`)}}scale(bs,xs={}){if(typeof bs=="object"&&(xs=bs,bs=void 0),typeof xs!="object")throw new TypeError("options must be an object");let Kn=xs.scale;switch(bs){case"row":{if(Kn===void 0)Kn=wl(this);else if(!qe.isAnyArray(Kn))throw new TypeError("scale must be an array");return _l(this,Kn),this}case"column":{if(Kn===void 0)Kn=gl(this);else if(!qe.isAnyArray(Kn))throw new TypeError("scale must be an array");return dl(this,Kn),this}case void 0:{if(Kn===void 0)Kn=sl(this);else if(typeof Kn!="number")throw new TypeError("scale must be a number");return kl(this,Kn),this}default:throw new Error(`invalid option: ${bs}`)}}toString(bs){return Pi(this,bs)}[Symbol.iterator](){return this.entries()}*entries(){for(let bs=0;bs<this.rows;bs++)for(let xs=0;xs<this.columns;xs++)yield[bs,xs,this.get(bs,xs)]}*values(){for(let bs=0;bs<this.rows;bs++)for(let xs=0;xs<this.columns;xs++)yield this.get(bs,xs)}}pl.prototype.klass="Matrix",typeof Symbol<"u"&&(pl.prototype[Symbol.for("nodejs.util.inspect.custom")]=Qe);function Al(sa,bs){return sa-bs}function xl(sa){return sa.every(bs=>typeof bs=="number")}pl.random=pl.rand,pl.randomInt=pl.randInt,pl.diagonal=pl.diag,pl.prototype.diagonal=pl.prototype.diag,pl.identity=pl.eye,pl.prototype.negate=pl.prototype.neg,pl.prototype.tensorProduct=pl.prototype.kroneckerProduct;const mc=class mc extends pl{constructor(xs,Kn){super();Oc(this,xc);hc(this,"data");if(mc.isMatrix(xs))Bc(this,xc,Lc).call(this,xs.rows,xs.columns),mc.copy(xs,this);else if(Number.isInteger(xs)&&xs>=0)Bc(this,xc,Lc).call(this,xs,Kn);else if(qe.isAnyArray(xs)){const Cs=xs;if(xs=Cs.length,Kn=xs?Cs[0].length:0,typeof Kn!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let ia=0;ia<xs;ia++){if(Cs[ia].length!==Kn)throw new RangeError("Inconsistent array dimensions");if(!xl(Cs[ia]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(Cs[ia]))}this.rows=xs,this.columns=Kn}else throw new TypeError("First argument must be a positive number or an array")}set(xs,Kn,Cs){return this.data[xs][Kn]=Cs,this}get(xs,Kn){return this.data[xs][Kn]}removeRow(xs){return un(this,xs),this.data.splice(xs,1),this.rows-=1,this}addRow(xs,Kn){return Kn===void 0&&(Kn=xs,xs=this.rows),un(this,xs,!0),Kn=Float64Array.from(Xn(this,Kn)),this.data.splice(xs,0,Kn),this.rows+=1,this}removeColumn(xs){zn(this,xs);for(let Kn=0;Kn<this.rows;Kn++){const Cs=new Float64Array(this.columns-1);for(let ia=0;ia<xs;ia++)Cs[ia]=this.data[Kn][ia];for(let ia=xs+1;ia<this.columns;ia++)Cs[ia-1]=this.data[Kn][ia];this.data[Kn]=Cs}return this.columns-=1,this}addColumn(xs,Kn){typeof Kn>"u"&&(Kn=xs,xs=this.columns),zn(this,xs,!0),Kn=Un(this,Kn);for(let Cs=0;Cs<this.rows;Cs++){const ia=new Float64Array(this.columns+1);let Za=0;for(;Za<xs;Za++)ia[Za]=this.data[Cs][Za];for(ia[Za++]=Kn[Cs];Za<this.columns+1;Za++)ia[Za]=this.data[Cs][Za-1];this.data[Cs]=ia}return this.columns+=1,this}};xc=new WeakSet,Lc=function(xs,Kn){if(this.data=[],Number.isInteger(Kn)&&Kn>=0)for(let Cs=0;Cs<xs;Cs++)this.data.push(new Float64Array(Kn));else throw new TypeError("nColumns must be a positive integer");this.rows=xs,this.columns=Kn};let al=mc;hn(pl,al);const Sc=class Sc extends pl{constructor(xs){super();Oc(this,uc);if(al.isMatrix(xs)){if(!xs.isSymmetric())throw new TypeError("not symmetric data");Mc(this,uc,al.copy(xs,new al(xs.rows,xs.rows)))}else if(Number.isInteger(xs)&&xs>=0)Mc(this,uc,new al(xs,xs));else if(Mc(this,uc,new al(xs)),!this.isSymmetric())throw new TypeError("not symmetric data")}get size(){return kc(this,uc).size}get rows(){return kc(this,uc).rows}get columns(){return kc(this,uc).columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(xs){return al.isMatrix(xs)&&xs.klassType==="SymmetricMatrix"}static zeros(xs){return new this(xs)}static ones(xs){return new this(xs).fill(1)}clone(){const xs=new Sc(this.diagonalSize);for(const[Kn,Cs,ia]of this.upperRightEntries())xs.set(Kn,Cs,ia);return xs}toMatrix(){return new al(this)}get(xs,Kn){return kc(this,uc).get(xs,Kn)}set(xs,Kn,Cs){return kc(this,uc).set(xs,Kn,Cs),kc(this,uc).set(Kn,xs,Cs),this}removeCross(xs){return kc(this,uc).removeRow(xs),kc(this,uc).removeColumn(xs),this}addCross(xs,Kn){Kn===void 0&&(Kn=xs,xs=this.diagonalSize);const Cs=Kn.slice();return Cs.splice(xs,1),kc(this,uc).addRow(xs,Cs),kc(this,uc).addColumn(xs,Kn),this}applyMask(xs){if(xs.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const Kn=[];for(const[Cs,ia]of xs.entries())ia||Kn.push(Cs);Kn.reverse();for(const Cs of Kn)this.removeCross(Cs);return this}toCompact(){const{diagonalSize:xs}=this,Kn=new Array(xs*(xs+1)/2);for(let Cs=0,ia=0,Za=0;Za<Kn.length;Za++)Kn[Za]=this.get(ia,Cs),++Cs>=xs&&(Cs=++ia);return Kn}static fromCompact(xs){const Kn=xs.length,Cs=(Math.sqrt(8*Kn+1)-1)/2;if(!Number.isInteger(Cs))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(xs)}`);const ia=new Sc(Cs);for(let Za=0,Ja=0,Qa=0;Qa<Kn;Qa++)ia.set(Za,Ja,xs[Qa]),++Za>=Cs&&(Za=++Ja);return ia}*upperRightEntries(){for(let xs=0,Kn=0;xs<this.diagonalSize;void 0){const Cs=this.get(xs,Kn);yield[xs,Kn,Cs],++Kn>=this.diagonalSize&&(Kn=++xs)}}*upperRightValues(){for(let xs=0,Kn=0;xs<this.diagonalSize;void 0)yield this.get(xs,Kn),++Kn>=this.diagonalSize&&(Kn=++xs)}};uc=new WeakMap;let Fl=Sc;Fl.prototype.klassType="SymmetricMatrix";class Ol extends Fl{static isDistanceMatrix(bs){return Fl.isSymmetricMatrix(bs)&&bs.klassSubType==="DistanceMatrix"}constructor(bs){if(super(bs),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(bs,xs,Kn){return bs===xs&&(Kn=0),super.set(bs,xs,Kn)}addCross(bs,xs){return xs===void 0&&(xs=bs,bs=this.diagonalSize),xs=xs.slice(),xs[bs]=0,super.addCross(bs,xs)}toSymmetricMatrix(){return new Fl(this)}clone(){const bs=new Ol(this.diagonalSize);for(const[xs,Kn,Cs]of this.upperRightEntries())xs!==Kn&&bs.set(xs,Kn,Cs);return bs}toCompact(){const{diagonalSize:bs}=this,xs=(bs-1)*bs/2,Kn=new Array(xs);for(let Cs=1,ia=0,Za=0;Za<Kn.length;Za++)Kn[Za]=this.get(ia,Cs),++Cs>=bs&&(Cs=++ia+1);return Kn}static fromCompact(bs){const xs=bs.length;if(xs===0)return new this(0);const Kn=(Math.sqrt(8*xs+1)+1)/2;if(!Number.isInteger(Kn))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(bs)}`);const Cs=new this(Kn);for(let ia=1,Za=0,Ja=0;Ja<xs;Ja++)Cs.set(ia,Za,bs[Ja]),++ia>=Kn&&(ia=++Za+1);return Cs}}Ol.prototype.klassSubType="DistanceMatrix";class Jo extends pl{constructor(bs,xs,Kn){super(),this.matrix=bs,this.rows=xs,this.columns=Kn}}class cl extends Jo{constructor(bs,xs){zn(bs,xs),super(bs,bs.rows,1),this.column=xs}set(bs,xs,Kn){return this.matrix.set(bs,this.column,Kn),this}get(bs){return this.matrix.get(bs,this.column)}}class rl extends Jo{constructor(bs,xs){ys(bs,xs),super(bs,bs.rows,xs.length),this.columnIndices=xs}set(bs,xs,Kn){return this.matrix.set(bs,this.columnIndices[xs],Kn),this}get(bs,xs){return this.matrix.get(bs,this.columnIndices[xs])}}class nl extends Jo{constructor(bs){super(bs,bs.rows,bs.columns)}set(bs,xs,Kn){return this.matrix.set(bs,this.columns-xs-1,Kn),this}get(bs,xs){return this.matrix.get(bs,this.columns-xs-1)}}class vl extends Jo{constructor(bs){super(bs,bs.rows,bs.columns)}set(bs,xs,Kn){return this.matrix.set(this.rows-bs-1,xs,Kn),this}get(bs,xs){return this.matrix.get(this.rows-bs-1,xs)}}class Pl extends Jo{constructor(bs,xs){un(bs,xs),super(bs,1,bs.columns),this.row=xs}set(bs,xs,Kn){return this.matrix.set(this.row,xs,Kn),this}get(bs,xs){return this.matrix.get(this.row,xs)}}class Sl extends Jo{constructor(bs,xs){qn(bs,xs),super(bs,xs.length,bs.columns),this.rowIndices=xs}set(bs,xs,Kn){return this.matrix.set(this.rowIndices[bs],xs,Kn),this}get(bs,xs){return this.matrix.get(this.rowIndices[bs],xs)}}class El extends Jo{constructor(bs,xs,Kn){qn(bs,xs),ys(bs,Kn),super(bs,xs.length,Kn.length),this.rowIndices=xs,this.columnIndices=Kn}set(bs,xs,Kn){return this.matrix.set(this.rowIndices[bs],this.columnIndices[xs],Kn),this}get(bs,xs){return this.matrix.get(this.rowIndices[bs],this.columnIndices[xs])}}class Il extends Jo{constructor(bs,xs,Kn,Cs,ia){vs(bs,xs,Kn,Cs,ia),super(bs,Kn-xs+1,ia-Cs+1),this.startRow=xs,this.startColumn=Cs}set(bs,xs,Kn){return this.matrix.set(this.startRow+bs,this.startColumn+xs,Kn),this}get(bs,xs){return this.matrix.get(this.startRow+bs,this.startColumn+xs)}}class $l extends Jo{constructor(bs){super(bs,bs.columns,bs.rows)}set(bs,xs,Kn){return this.matrix.set(xs,bs,Kn),this}get(bs,xs){return this.matrix.get(xs,bs)}}class Ll extends pl{constructor(bs,xs={}){const{rows:Kn=1}=xs;if(bs.length%Kn!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=Kn,this.columns=bs.length/Kn,this.data=bs}set(bs,xs,Kn){let Cs=this._calculateIndex(bs,xs);return this.data[Cs]=Kn,this}get(bs,xs){let Kn=this._calculateIndex(bs,xs);return this.data[Kn]}_calculateIndex(bs,xs){return bs*this.columns+xs}}class ml extends pl{constructor(bs){super(),this.data=bs,this.rows=bs.length,this.columns=bs[0].length}set(bs,xs,Kn){return this.data[bs][xs]=Kn,this}get(bs,xs){return this.data[bs][xs]}}function Vl(sa,bs){if(qe.isAnyArray(sa))return sa[0]&&qe.isAnyArray(sa[0])?new ml(sa):new Ll(sa,bs);throw new Error("the argument is not an array")}class jl{constructor(bs){bs=ml.checkMatrix(bs);let xs=bs.clone(),Kn=xs.rows,Cs=xs.columns,ia=new Float64Array(Kn),Za=1,Ja,Qa,aa,pa,ha,Ma,Ka,Na,el;for(Ja=0;Ja<Kn;Ja++)ia[Ja]=Ja;for(Na=new Float64Array(Kn),Qa=0;Qa<Cs;Qa++){for(Ja=0;Ja<Kn;Ja++)Na[Ja]=xs.get(Ja,Qa);for(Ja=0;Ja<Kn;Ja++){for(el=Math.min(Ja,Qa),ha=0,aa=0;aa<el;aa++)ha+=xs.get(Ja,aa)*Na[aa];Na[Ja]-=ha,xs.set(Ja,Qa,Na[Ja])}for(pa=Qa,Ja=Qa+1;Ja<Kn;Ja++)Math.abs(Na[Ja])>Math.abs(Na[pa])&&(pa=Ja);if(pa!==Qa){for(aa=0;aa<Cs;aa++)Ma=xs.get(pa,aa),xs.set(pa,aa,xs.get(Qa,aa)),xs.set(Qa,aa,Ma);Ka=ia[pa],ia[pa]=ia[Qa],ia[Qa]=Ka,Za=-Za}if(Qa<Kn&&xs.get(Qa,Qa)!==0)for(Ja=Qa+1;Ja<Kn;Ja++)xs.set(Ja,Qa,xs.get(Ja,Qa)/xs.get(Qa,Qa))}this.LU=xs,this.pivotVector=ia,this.pivotSign=Za}isSingular(){let bs=this.LU,xs=bs.columns;for(let Kn=0;Kn<xs;Kn++)if(bs.get(Kn,Kn)===0)return!0;return!1}solve(bs){bs=al.checkMatrix(bs);let xs=this.LU;if(xs.rows!==bs.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let Cs=bs.columns,ia=bs.subMatrixRow(this.pivotVector,0,Cs-1),Za=xs.columns,Ja,Qa,aa;for(aa=0;aa<Za;aa++)for(Ja=aa+1;Ja<Za;Ja++)for(Qa=0;Qa<Cs;Qa++)ia.set(Ja,Qa,ia.get(Ja,Qa)-ia.get(aa,Qa)*xs.get(Ja,aa));for(aa=Za-1;aa>=0;aa--){for(Qa=0;Qa<Cs;Qa++)ia.set(aa,Qa,ia.get(aa,Qa)/xs.get(aa,aa));for(Ja=0;Ja<aa;Ja++)for(Qa=0;Qa<Cs;Qa++)ia.set(Ja,Qa,ia.get(Ja,Qa)-ia.get(aa,Qa)*xs.get(Ja,aa))}return ia}get determinant(){let bs=this.LU;if(!bs.isSquare())throw new Error("Matrix must be square");let xs=this.pivotSign,Kn=bs.columns;for(let Cs=0;Cs<Kn;Cs++)xs*=bs.get(Cs,Cs);return xs}get lowerTriangularMatrix(){let bs=this.LU,xs=bs.rows,Kn=bs.columns,Cs=new al(xs,Kn);for(let ia=0;ia<xs;ia++)for(let Za=0;Za<Kn;Za++)ia>Za?Cs.set(ia,Za,bs.get(ia,Za)):ia===Za?Cs.set(ia,Za,1):Cs.set(ia,Za,0);return Cs}get upperTriangularMatrix(){let bs=this.LU,xs=bs.rows,Kn=bs.columns,Cs=new al(xs,Kn);for(let ia=0;ia<xs;ia++)for(let Za=0;Za<Kn;Za++)ia<=Za?Cs.set(ia,Za,bs.get(ia,Za)):Cs.set(ia,Za,0);return Cs}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function Xl(sa,bs){let xs=0;return Math.abs(sa)>Math.abs(bs)?(xs=bs/sa,Math.abs(sa)*Math.sqrt(1+xs*xs)):bs!==0?(xs=sa/bs,Math.abs(bs)*Math.sqrt(1+xs*xs)):0}class yl{constructor(bs){bs=ml.checkMatrix(bs);let xs=bs.clone(),Kn=bs.rows,Cs=bs.columns,ia=new Float64Array(Cs),Za,Ja,Qa,aa;for(Qa=0;Qa<Cs;Qa++){let pa=0;for(Za=Qa;Za<Kn;Za++)pa=Xl(pa,xs.get(Za,Qa));if(pa!==0){for(xs.get(Qa,Qa)<0&&(pa=-pa),Za=Qa;Za<Kn;Za++)xs.set(Za,Qa,xs.get(Za,Qa)/pa);for(xs.set(Qa,Qa,xs.get(Qa,Qa)+1),Ja=Qa+1;Ja<Cs;Ja++){for(aa=0,Za=Qa;Za<Kn;Za++)aa+=xs.get(Za,Qa)*xs.get(Za,Ja);for(aa=-aa/xs.get(Qa,Qa),Za=Qa;Za<Kn;Za++)xs.set(Za,Ja,xs.get(Za,Ja)+aa*xs.get(Za,Qa))}}ia[Qa]=-pa}this.QR=xs,this.Rdiag=ia}solve(bs){bs=al.checkMatrix(bs);let xs=this.QR,Kn=xs.rows;if(bs.rows!==Kn)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let Cs=bs.columns,ia=bs.clone(),Za=xs.columns,Ja,Qa,aa,pa;for(aa=0;aa<Za;aa++)for(Qa=0;Qa<Cs;Qa++){for(pa=0,Ja=aa;Ja<Kn;Ja++)pa+=xs.get(Ja,aa)*ia.get(Ja,Qa);for(pa=-pa/xs.get(aa,aa),Ja=aa;Ja<Kn;Ja++)ia.set(Ja,Qa,ia.get(Ja,Qa)+pa*xs.get(Ja,aa))}for(aa=Za-1;aa>=0;aa--){for(Qa=0;Qa<Cs;Qa++)ia.set(aa,Qa,ia.get(aa,Qa)/this.Rdiag[aa]);for(Ja=0;Ja<aa;Ja++)for(Qa=0;Qa<Cs;Qa++)ia.set(Ja,Qa,ia.get(Ja,Qa)-ia.get(aa,Qa)*xs.get(Ja,aa))}return ia.subMatrix(0,Za-1,0,Cs-1)}isFullRank(){let bs=this.QR.columns;for(let xs=0;xs<bs;xs++)if(this.Rdiag[xs]===0)return!1;return!0}get upperTriangularMatrix(){let bs=this.QR,xs=bs.columns,Kn=new al(xs,xs),Cs,ia;for(Cs=0;Cs<xs;Cs++)for(ia=0;ia<xs;ia++)Cs<ia?Kn.set(Cs,ia,bs.get(Cs,ia)):Cs===ia?Kn.set(Cs,ia,this.Rdiag[Cs]):Kn.set(Cs,ia,0);return Kn}get orthogonalMatrix(){let bs=this.QR,xs=bs.rows,Kn=bs.columns,Cs=new al(xs,Kn),ia,Za,Ja,Qa;for(Ja=Kn-1;Ja>=0;Ja--){for(ia=0;ia<xs;ia++)Cs.set(ia,Ja,0);for(Cs.set(Ja,Ja,1),Za=Ja;Za<Kn;Za++)if(bs.get(Ja,Ja)!==0){for(Qa=0,ia=Ja;ia<xs;ia++)Qa+=bs.get(ia,Ja)*Cs.get(ia,Za);for(Qa=-Qa/bs.get(Ja,Ja),ia=Ja;ia<xs;ia++)Cs.set(ia,Za,Cs.get(ia,Za)+Qa*bs.get(ia,Ja))}}return Cs}}class Yl{constructor(bs,xs={}){if(bs=ml.checkMatrix(bs),bs.isEmpty())throw new Error("Matrix must be non-empty");let Kn=bs.rows,Cs=bs.columns;const{computeLeftSingularVectors:ia=!0,computeRightSingularVectors:Za=!0,autoTranspose:Ja=!1}=xs;let Qa=!!ia,aa=!!Za,pa=!1,ha;if(Kn<Cs)if(!Ja)ha=bs.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{ha=bs.transpose(),Kn=ha.rows,Cs=ha.columns,pa=!0;let ul=Qa;Qa=aa,aa=ul}else ha=bs.clone();let Ma=Math.min(Kn,Cs),Ka=Math.min(Kn+1,Cs),Na=new Float64Array(Ka),el=new al(Kn,Ma),fl=new al(Cs,Cs),Ua=new Float64Array(Cs),il=new Float64Array(Kn),ll=new Float64Array(Ka);for(let ul=0;ul<Ka;ul++)ll[ul]=ul;let Tl=Math.min(Kn-1,Cs),Dl=Math.max(0,Math.min(Cs-2,Kn)),Nl=Math.max(Tl,Dl);for(let ul=0;ul<Nl;ul++){if(ul<Tl){Na[ul]=0;for(let Ml=ul;Ml<Kn;Ml++)Na[ul]=Xl(Na[ul],ha.get(Ml,ul));if(Na[ul]!==0){ha.get(ul,ul)<0&&(Na[ul]=-Na[ul]);for(let Ml=ul;Ml<Kn;Ml++)ha.set(Ml,ul,ha.get(Ml,ul)/Na[ul]);ha.set(ul,ul,ha.get(ul,ul)+1)}Na[ul]=-Na[ul]}for(let Ml=ul+1;Ml<Cs;Ml++){if(ul<Tl&&Na[ul]!==0){let Ul=0;for(let Bl=ul;Bl<Kn;Bl++)Ul+=ha.get(Bl,ul)*ha.get(Bl,Ml);Ul=-Ul/ha.get(ul,ul);for(let Bl=ul;Bl<Kn;Bl++)ha.set(Bl,Ml,ha.get(Bl,Ml)+Ul*ha.get(Bl,ul))}Ua[Ml]=ha.get(ul,Ml)}if(Qa&&ul<Tl)for(let Ml=ul;Ml<Kn;Ml++)el.set(Ml,ul,ha.get(Ml,ul));if(ul<Dl){Ua[ul]=0;for(let Ml=ul+1;Ml<Cs;Ml++)Ua[ul]=Xl(Ua[ul],Ua[Ml]);if(Ua[ul]!==0){Ua[ul+1]<0&&(Ua[ul]=0-Ua[ul]);for(let Ml=ul+1;Ml<Cs;Ml++)Ua[Ml]/=Ua[ul];Ua[ul+1]+=1}if(Ua[ul]=-Ua[ul],ul+1<Kn&&Ua[ul]!==0){for(let Ml=ul+1;Ml<Kn;Ml++)il[Ml]=0;for(let Ml=ul+1;Ml<Kn;Ml++)for(let Ul=ul+1;Ul<Cs;Ul++)il[Ml]+=Ua[Ul]*ha.get(Ml,Ul);for(let Ml=ul+1;Ml<Cs;Ml++){let Ul=-Ua[Ml]/Ua[ul+1];for(let Bl=ul+1;Bl<Kn;Bl++)ha.set(Bl,Ml,ha.get(Bl,Ml)+Ul*il[Bl])}}if(aa)for(let Ml=ul+1;Ml<Cs;Ml++)fl.set(Ml,ul,Ua[Ml])}}let bl=Math.min(Cs,Kn+1);if(Tl<Cs&&(Na[Tl]=ha.get(Tl,Tl)),Kn<bl&&(Na[bl-1]=0),Dl+1<bl&&(Ua[Dl]=ha.get(Dl,bl-1)),Ua[bl-1]=0,Qa){for(let ul=Tl;ul<Ma;ul++){for(let Ml=0;Ml<Kn;Ml++)el.set(Ml,ul,0);el.set(ul,ul,1)}for(let ul=Tl-1;ul>=0;ul--)if(Na[ul]!==0){for(let Ml=ul+1;Ml<Ma;Ml++){let Ul=0;for(let Bl=ul;Bl<Kn;Bl++)Ul+=el.get(Bl,ul)*el.get(Bl,Ml);Ul=-Ul/el.get(ul,ul);for(let Bl=ul;Bl<Kn;Bl++)el.set(Bl,Ml,el.get(Bl,Ml)+Ul*el.get(Bl,ul))}for(let Ml=ul;Ml<Kn;Ml++)el.set(Ml,ul,-el.get(Ml,ul));el.set(ul,ul,1+el.get(ul,ul));for(let Ml=0;Ml<ul-1;Ml++)el.set(Ml,ul,0)}else{for(let Ml=0;Ml<Kn;Ml++)el.set(Ml,ul,0);el.set(ul,ul,1)}}if(aa)for(let ul=Cs-1;ul>=0;ul--){if(ul<Dl&&Ua[ul]!==0)for(let Ml=ul+1;Ml<Cs;Ml++){let Ul=0;for(let Bl=ul+1;Bl<Cs;Bl++)Ul+=fl.get(Bl,ul)*fl.get(Bl,Ml);Ul=-Ul/fl.get(ul+1,ul);for(let Bl=ul+1;Bl<Cs;Bl++)fl.set(Bl,Ml,fl.get(Bl,Ml)+Ul*fl.get(Bl,ul))}for(let Ml=0;Ml<Cs;Ml++)fl.set(Ml,ul,0);fl.set(ul,ul,1)}let Cl=bl-1,Kl=Number.EPSILON;for(;bl>0;){let ul,Ml;for(ul=bl-2;ul>=-1&&ul!==-1;ul--){const Ul=Number.MIN_VALUE+Kl*Math.abs(Na[ul]+Math.abs(Na[ul+1]));if(Math.abs(Ua[ul])<=Ul||Number.isNaN(Ua[ul])){Ua[ul]=0;break}}if(ul===bl-2)Ml=4;else{let Ul;for(Ul=bl-1;Ul>=ul&&Ul!==ul;Ul--){let Bl=(Ul!==bl?Math.abs(Ua[Ul]):0)+(Ul!==ul+1?Math.abs(Ua[Ul-1]):0);if(Math.abs(Na[Ul])<=Kl*Bl){Na[Ul]=0;break}}Ul===ul?Ml=3:Ul===bl-1?Ml=1:(Ml=2,ul=Ul)}switch(ul++,Ml){case 1:{let Ul=Ua[bl-2];Ua[bl-2]=0;for(let Bl=bl-2;Bl>=ul;Bl--){let sc=Xl(Na[Bl],Ul),ic=Na[Bl]/sc,nc=Ul/sc;if(Na[Bl]=sc,Bl!==ul&&(Ul=-nc*Ua[Bl-1],Ua[Bl-1]=ic*Ua[Bl-1]),aa)for(let lc=0;lc<Cs;lc++)sc=ic*fl.get(lc,Bl)+nc*fl.get(lc,bl-1),fl.set(lc,bl-1,-nc*fl.get(lc,Bl)+ic*fl.get(lc,bl-1)),fl.set(lc,Bl,sc)}break}case 2:{let Ul=Ua[ul-1];Ua[ul-1]=0;for(let Bl=ul;Bl<bl;Bl++){let sc=Xl(Na[Bl],Ul),ic=Na[Bl]/sc,nc=Ul/sc;if(Na[Bl]=sc,Ul=-nc*Ua[Bl],Ua[Bl]=ic*Ua[Bl],Qa)for(let lc=0;lc<Kn;lc++)sc=ic*el.get(lc,Bl)+nc*el.get(lc,ul-1),el.set(lc,ul-1,-nc*el.get(lc,Bl)+ic*el.get(lc,ul-1)),el.set(lc,Bl,sc)}break}case 3:{const Ul=Math.max(Math.abs(Na[bl-1]),Math.abs(Na[bl-2]),Math.abs(Ua[bl-2]),Math.abs(Na[ul]),Math.abs(Ua[ul])),Bl=Na[bl-1]/Ul,sc=Na[bl-2]/Ul,ic=Ua[bl-2]/Ul,nc=Na[ul]/Ul,lc=Ua[ul]/Ul,cc=((sc+Bl)*(sc-Bl)+ic*ic)/2,Ac=Bl*ic*(Bl*ic);let dc=0;(cc!==0||Ac!==0)&&(cc<0?dc=0-Math.sqrt(cc*cc+Ac):dc=Math.sqrt(cc*cc+Ac),dc=Ac/(cc+dc));let Fc=(nc+Bl)*(nc-Bl)+dc,Dc=nc*lc;for(let rc=ul;rc<bl-1;rc++){let _c=Xl(Fc,Dc);_c===0&&(_c=Number.MIN_VALUE);let Tc=Fc/_c,Ec=Dc/_c;if(rc!==ul&&(Ua[rc-1]=_c),Fc=Tc*Na[rc]+Ec*Ua[rc],Ua[rc]=Tc*Ua[rc]-Ec*Na[rc],Dc=Ec*Na[rc+1],Na[rc+1]=Tc*Na[rc+1],aa)for(let gc=0;gc<Cs;gc++)_c=Tc*fl.get(gc,rc)+Ec*fl.get(gc,rc+1),fl.set(gc,rc+1,-Ec*fl.get(gc,rc)+Tc*fl.get(gc,rc+1)),fl.set(gc,rc,_c);if(_c=Xl(Fc,Dc),_c===0&&(_c=Number.MIN_VALUE),Tc=Fc/_c,Ec=Dc/_c,Na[rc]=_c,Fc=Tc*Ua[rc]+Ec*Na[rc+1],Na[rc+1]=-Ec*Ua[rc]+Tc*Na[rc+1],Dc=Ec*Ua[rc+1],Ua[rc+1]=Tc*Ua[rc+1],Qa&&rc<Kn-1)for(let gc=0;gc<Kn;gc++)_c=Tc*el.get(gc,rc)+Ec*el.get(gc,rc+1),el.set(gc,rc+1,-Ec*el.get(gc,rc)+Tc*el.get(gc,rc+1)),el.set(gc,rc,_c)}Ua[bl-2]=Fc;break}case 4:{if(Na[ul]<=0&&(Na[ul]=Na[ul]<0?-Na[ul]:0,aa))for(let Ul=0;Ul<=Cl;Ul++)fl.set(Ul,ul,-fl.get(Ul,ul));for(;ul<Cl&&!(Na[ul]>=Na[ul+1]);){let Ul=Na[ul];if(Na[ul]=Na[ul+1],Na[ul+1]=Ul,aa&&ul<Cs-1)for(let Bl=0;Bl<Cs;Bl++)Ul=fl.get(Bl,ul+1),fl.set(Bl,ul+1,fl.get(Bl,ul)),fl.set(Bl,ul,Ul);if(Qa&&ul<Kn-1)for(let Bl=0;Bl<Kn;Bl++)Ul=el.get(Bl,ul+1),el.set(Bl,ul+1,el.get(Bl,ul)),el.set(Bl,ul,Ul);ul++}bl--;break}}}if(pa){let ul=fl;fl=el,el=ul}this.m=Kn,this.n=Cs,this.s=Na,this.U=el,this.V=fl}solve(bs){let xs=bs,Kn=this.threshold,Cs=this.s.length,ia=al.zeros(Cs,Cs);for(let Ma=0;Ma<Cs;Ma++)Math.abs(this.s[Ma])<=Kn?ia.set(Ma,Ma,0):ia.set(Ma,Ma,1/this.s[Ma]);let Za=this.U,Ja=this.rightSingularVectors,Qa=Ja.mmul(ia),aa=Ja.rows,pa=Za.rows,ha=al.zeros(aa,pa);for(let Ma=0;Ma<aa;Ma++)for(let Ka=0;Ka<pa;Ka++){let Na=0;for(let el=0;el<Cs;el++)Na+=Qa.get(Ma,el)*Za.get(Ka,el);ha.set(Ma,Ka,Na)}return ha.mmul(xs)}solveForDiagonal(bs){return this.solve(al.diag(bs))}inverse(){let bs=this.V,xs=this.threshold,Kn=bs.rows,Cs=bs.columns,ia=new al(Kn,this.s.length);for(let pa=0;pa<Kn;pa++)for(let ha=0;ha<Cs;ha++)Math.abs(this.s[ha])>xs&&ia.set(pa,ha,bs.get(pa,ha)/this.s[ha]);let Za=this.U,Ja=Za.rows,Qa=Za.columns,aa=new al(Kn,Ja);for(let pa=0;pa<Kn;pa++)for(let ha=0;ha<Ja;ha++){let Ma=0;for(let Ka=0;Ka<Qa;Ka++)Ma+=ia.get(pa,Ka)*Za.get(ha,Ka);aa.set(pa,ha,Ma)}return aa}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let bs=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,xs=0,Kn=this.s;for(let Cs=0,ia=Kn.length;Cs<ia;Cs++)Kn[Cs]>bs&&xs++;return xs}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return al.diag(this.s)}}function Rl(sa,bs=!1){return sa=ml.checkMatrix(sa),bs?new Yl(sa).inverse():Hl(sa,al.eye(sa.rows))}function Hl(sa,bs,xs=!1){return sa=ml.checkMatrix(sa),bs=ml.checkMatrix(bs),xs?new Yl(sa).solve(bs):sa.isSquare()?new jl(sa).solve(bs):new yl(sa).solve(bs)}function Wl(sa){if(sa=al.checkMatrix(sa),sa.isSquare()){if(sa.columns===0)return 1;let bs,xs,Kn,Cs;if(sa.columns===2)return bs=sa.get(0,0),xs=sa.get(0,1),Kn=sa.get(1,0),Cs=sa.get(1,1),bs*Cs-xs*Kn;if(sa.columns===3){let ia,Za,Ja;return ia=new El(sa,[1,2],[1,2]),Za=new El(sa,[1,2],[0,2]),Ja=new El(sa,[1,2],[0,1]),bs=sa.get(0,0),xs=sa.get(0,1),Kn=sa.get(0,2),bs*Wl(ia)-xs*Wl(Za)+Kn*Wl(Ja)}else return new jl(sa).determinant}else throw Error("determinant can only be calculated for a square matrix")}function zl(sa,bs){let xs=[];for(let Kn=0;Kn<sa;Kn++)Kn!==bs&&xs.push(Kn);return xs}function Gl(sa,bs,xs,Kn=1e-9,Cs=1e-9){if(sa>Cs)return new Array(bs.rows+1).fill(0);{let ia=bs.addRow(xs,[0]);for(let Za=0;Za<ia.rows;Za++)Math.abs(ia.get(Za,0))<Kn&&ia.set(Za,0,0);return ia.to1DArray()}}function Jl(sa,bs={}){const{thresholdValue:xs=1e-9,thresholdError:Kn=1e-9}=bs;sa=al.checkMatrix(sa);let Cs=sa.rows,ia=new al(Cs,Cs);for(let Za=0;Za<Cs;Za++){let Ja=al.columnVector(sa.getRow(Za)),Qa=sa.subMatrixRow(zl(Cs,Za)).transpose(),pa=new Yl(Qa).solve(Ja),ha=al.sub(Ja,Qa.mmul(pa)).abs().max();ia.setRow(Za,Gl(ha,pa,Za,xs,Kn))}return ia}function ql(sa,bs=Number.EPSILON){if(sa=al.checkMatrix(sa),sa.isEmpty())return sa.transpose();let xs=new Yl(sa,{autoTranspose:!0}),Kn=xs.leftSingularVectors,Cs=xs.rightSingularVectors,ia=xs.diagonal;for(let Za=0;Za<ia.length;Za++)Math.abs(ia[Za])>bs?ia[Za]=1/ia[Za]:ia[Za]=0;return Cs.mmul(al.diag(ia).mmul(Kn.transpose()))}function Zl(sa,bs=sa,xs={}){sa=new al(sa);let Kn=!1;if(typeof bs=="object"&&!al.isMatrix(bs)&&!qe.isAnyArray(bs)?(xs=bs,bs=sa,Kn=!0):bs=new al(bs),sa.rows!==bs.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:Cs=!0}=xs;Cs&&(sa=sa.center("column"),Kn||(bs=bs.center("column")));const ia=sa.transpose().mmul(bs);for(let Za=0;Za<ia.rows;Za++)for(let Ja=0;Ja<ia.columns;Ja++)ia.set(Za,Ja,ia.get(Za,Ja)*(1/(sa.rows-1)));return ia}function Ql(sa,bs=sa,xs={}){sa=new al(sa);let Kn=!1;if(typeof bs=="object"&&!al.isMatrix(bs)&&!qe.isAnyArray(bs)?(xs=bs,bs=sa,Kn=!0):bs=new al(bs),sa.rows!==bs.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:Cs=!0,scale:ia=!0}=xs;Cs&&(sa.center("column"),Kn||bs.center("column")),ia&&(sa.scale("column"),Kn||bs.scale("column"));const Za=sa.standardDeviation("column",{unbiased:!0}),Ja=Kn?Za:bs.standardDeviation("column",{unbiased:!0}),Qa=sa.transpose().mmul(bs);for(let aa=0;aa<Qa.rows;aa++)for(let pa=0;pa<Qa.columns;pa++)Qa.set(aa,pa,Qa.get(aa,pa)*(1/(Za[aa]*Ja[pa]))*(1/(sa.rows-1)));return Qa}class ec{constructor(bs,xs={}){const{assumeSymmetric:Kn=!1}=xs;if(bs=ml.checkMatrix(bs),!bs.isSquare())throw new Error("Matrix is not a square matrix");if(bs.isEmpty())throw new Error("Matrix must be non-empty");let Cs=bs.columns,ia=new al(Cs,Cs),Za=new Float64Array(Cs),Ja=new Float64Array(Cs),Qa=bs,aa,pa,ha=!1;if(Kn?ha=!0:ha=bs.isSymmetric(),ha){for(aa=0;aa<Cs;aa++)for(pa=0;pa<Cs;pa++)ia.set(aa,pa,Qa.get(aa,pa));tc(Cs,Ja,Za,ia),ac(Cs,Ja,Za,ia)}else{let Ma=new al(Cs,Cs),Ka=new Float64Array(Cs);for(pa=0;pa<Cs;pa++)for(aa=0;aa<Cs;aa++)Ma.set(aa,pa,Qa.get(aa,pa));oc(Cs,Ma,Ka,ia),fc(Cs,Ja,Za,ia,Ma)}this.n=Cs,this.e=Ja,this.d=Za,this.V=ia}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let bs=this.n,xs=this.e,Kn=this.d,Cs=new al(bs,bs),ia,Za;for(ia=0;ia<bs;ia++){for(Za=0;Za<bs;Za++)Cs.set(ia,Za,0);Cs.set(ia,ia,Kn[ia]),xs[ia]>0?Cs.set(ia,ia+1,xs[ia]):xs[ia]<0&&Cs.set(ia,ia-1,xs[ia])}return Cs}}function tc(sa,bs,xs,Kn){let Cs,ia,Za,Ja,Qa,aa,pa,ha;for(Qa=0;Qa<sa;Qa++)xs[Qa]=Kn.get(sa-1,Qa);for(Ja=sa-1;Ja>0;Ja--){for(ha=0,Za=0,aa=0;aa<Ja;aa++)ha=ha+Math.abs(xs[aa]);if(ha===0)for(bs[Ja]=xs[Ja-1],Qa=0;Qa<Ja;Qa++)xs[Qa]=Kn.get(Ja-1,Qa),Kn.set(Ja,Qa,0),Kn.set(Qa,Ja,0);else{for(aa=0;aa<Ja;aa++)xs[aa]/=ha,Za+=xs[aa]*xs[aa];for(Cs=xs[Ja-1],ia=Math.sqrt(Za),Cs>0&&(ia=-ia),bs[Ja]=ha*ia,Za=Za-Cs*ia,xs[Ja-1]=Cs-ia,Qa=0;Qa<Ja;Qa++)bs[Qa]=0;for(Qa=0;Qa<Ja;Qa++){for(Cs=xs[Qa],Kn.set(Qa,Ja,Cs),ia=bs[Qa]+Kn.get(Qa,Qa)*Cs,aa=Qa+1;aa<=Ja-1;aa++)ia+=Kn.get(aa,Qa)*xs[aa],bs[aa]+=Kn.get(aa,Qa)*Cs;bs[Qa]=ia}for(Cs=0,Qa=0;Qa<Ja;Qa++)bs[Qa]/=Za,Cs+=bs[Qa]*xs[Qa];for(pa=Cs/(Za+Za),Qa=0;Qa<Ja;Qa++)bs[Qa]-=pa*xs[Qa];for(Qa=0;Qa<Ja;Qa++){for(Cs=xs[Qa],ia=bs[Qa],aa=Qa;aa<=Ja-1;aa++)Kn.set(aa,Qa,Kn.get(aa,Qa)-(Cs*bs[aa]+ia*xs[aa]));xs[Qa]=Kn.get(Ja-1,Qa),Kn.set(Ja,Qa,0)}}xs[Ja]=Za}for(Ja=0;Ja<sa-1;Ja++){if(Kn.set(sa-1,Ja,Kn.get(Ja,Ja)),Kn.set(Ja,Ja,1),Za=xs[Ja+1],Za!==0){for(aa=0;aa<=Ja;aa++)xs[aa]=Kn.get(aa,Ja+1)/Za;for(Qa=0;Qa<=Ja;Qa++){for(ia=0,aa=0;aa<=Ja;aa++)ia+=Kn.get(aa,Ja+1)*Kn.get(aa,Qa);for(aa=0;aa<=Ja;aa++)Kn.set(aa,Qa,Kn.get(aa,Qa)-ia*xs[aa])}}for(aa=0;aa<=Ja;aa++)Kn.set(aa,Ja+1,0)}for(Qa=0;Qa<sa;Qa++)xs[Qa]=Kn.get(sa-1,Qa),Kn.set(sa-1,Qa,0);Kn.set(sa-1,sa-1,1),bs[0]=0}function ac(sa,bs,xs,Kn){let Cs,ia,Za,Ja,Qa,aa,pa,ha,Ma,Ka,Na,el,fl,Ua,il,ll;for(Za=1;Za<sa;Za++)bs[Za-1]=bs[Za];bs[sa-1]=0;let Tl=0,Dl=0,Nl=Number.EPSILON;for(aa=0;aa<sa;aa++){for(Dl=Math.max(Dl,Math.abs(xs[aa])+Math.abs(bs[aa])),pa=aa;pa<sa&&!(Math.abs(bs[pa])<=Nl*Dl);)pa++;if(pa>aa)do{for(Cs=xs[aa],ha=(xs[aa+1]-Cs)/(2*bs[aa]),Ma=Xl(ha,1),ha<0&&(Ma=-Ma),xs[aa]=bs[aa]/(ha+Ma),xs[aa+1]=bs[aa]*(ha+Ma),Ka=xs[aa+1],ia=Cs-xs[aa],Za=aa+2;Za<sa;Za++)xs[Za]-=ia;for(Tl=Tl+ia,ha=xs[pa],Na=1,el=Na,fl=Na,Ua=bs[aa+1],il=0,ll=0,Za=pa-1;Za>=aa;Za--)for(fl=el,el=Na,ll=il,Cs=Na*bs[Za],ia=Na*ha,Ma=Xl(ha,bs[Za]),bs[Za+1]=il*Ma,il=bs[Za]/Ma,Na=ha/Ma,ha=Na*xs[Za]-il*Cs,xs[Za+1]=ia+il*(Na*Cs+il*xs[Za]),Qa=0;Qa<sa;Qa++)ia=Kn.get(Qa,Za+1),Kn.set(Qa,Za+1,il*Kn.get(Qa,Za)+Na*ia),Kn.set(Qa,Za,Na*Kn.get(Qa,Za)-il*ia);ha=-il*ll*fl*Ua*bs[aa]/Ka,bs[aa]=il*ha,xs[aa]=Na*ha}while(Math.abs(bs[aa])>Nl*Dl);xs[aa]=xs[aa]+Tl,bs[aa]=0}for(Za=0;Za<sa-1;Za++){for(Qa=Za,ha=xs[Za],Ja=Za+1;Ja<sa;Ja++)xs[Ja]<ha&&(Qa=Ja,ha=xs[Ja]);if(Qa!==Za)for(xs[Qa]=xs[Za],xs[Za]=ha,Ja=0;Ja<sa;Ja++)ha=Kn.get(Ja,Za),Kn.set(Ja,Za,Kn.get(Ja,Qa)),Kn.set(Ja,Qa,ha)}}function oc(sa,bs,xs,Kn){let Cs=0,ia=sa-1,Za,Ja,Qa,aa,pa,ha,Ma;for(ha=Cs+1;ha<=ia-1;ha++){for(Ma=0,aa=ha;aa<=ia;aa++)Ma=Ma+Math.abs(bs.get(aa,ha-1));if(Ma!==0){for(Qa=0,aa=ia;aa>=ha;aa--)xs[aa]=bs.get(aa,ha-1)/Ma,Qa+=xs[aa]*xs[aa];for(Ja=Math.sqrt(Qa),xs[ha]>0&&(Ja=-Ja),Qa=Qa-xs[ha]*Ja,xs[ha]=xs[ha]-Ja,pa=ha;pa<sa;pa++){for(Za=0,aa=ia;aa>=ha;aa--)Za+=xs[aa]*bs.get(aa,pa);for(Za=Za/Qa,aa=ha;aa<=ia;aa++)bs.set(aa,pa,bs.get(aa,pa)-Za*xs[aa])}for(aa=0;aa<=ia;aa++){for(Za=0,pa=ia;pa>=ha;pa--)Za+=xs[pa]*bs.get(aa,pa);for(Za=Za/Qa,pa=ha;pa<=ia;pa++)bs.set(aa,pa,bs.get(aa,pa)-Za*xs[pa])}xs[ha]=Ma*xs[ha],bs.set(ha,ha-1,Ma*Ja)}}for(aa=0;aa<sa;aa++)for(pa=0;pa<sa;pa++)Kn.set(aa,pa,aa===pa?1:0);for(ha=ia-1;ha>=Cs+1;ha--)if(bs.get(ha,ha-1)!==0){for(aa=ha+1;aa<=ia;aa++)xs[aa]=bs.get(aa,ha-1);for(pa=ha;pa<=ia;pa++){for(Ja=0,aa=ha;aa<=ia;aa++)Ja+=xs[aa]*Kn.get(aa,pa);for(Ja=Ja/xs[ha]/bs.get(ha,ha-1),aa=ha;aa<=ia;aa++)Kn.set(aa,pa,Kn.get(aa,pa)+Ja*xs[aa])}}}function fc(sa,bs,xs,Kn,Cs){let ia=sa-1,Za=0,Ja=sa-1,Qa=Number.EPSILON,aa=0,pa=0,ha=0,Ma=0,Ka=0,Na=0,el=0,fl=0,Ua,il,ll,Tl,Dl,Nl,bl,Cl,Kl,ul,Ml,Ul,Bl,sc,ic;for(Ua=0;Ua<sa;Ua++)for((Ua<Za||Ua>Ja)&&(xs[Ua]=Cs.get(Ua,Ua),bs[Ua]=0),il=Math.max(Ua-1,0);il<sa;il++)pa=pa+Math.abs(Cs.get(Ua,il));for(;ia>=Za;){for(Tl=ia;Tl>Za&&(Na=Math.abs(Cs.get(Tl-1,Tl-1))+Math.abs(Cs.get(Tl,Tl)),Na===0&&(Na=pa),!(Math.abs(Cs.get(Tl,Tl-1))<Qa*Na));)Tl--;if(Tl===ia)Cs.set(ia,ia,Cs.get(ia,ia)+aa),xs[ia]=Cs.get(ia,ia),bs[ia]=0,ia--,fl=0;else if(Tl===ia-1){if(bl=Cs.get(ia,ia-1)*Cs.get(ia-1,ia),ha=(Cs.get(ia-1,ia-1)-Cs.get(ia,ia))/2,Ma=ha*ha+bl,el=Math.sqrt(Math.abs(Ma)),Cs.set(ia,ia,Cs.get(ia,ia)+aa),Cs.set(ia-1,ia-1,Cs.get(ia-1,ia-1)+aa),Cl=Cs.get(ia,ia),Ma>=0){for(el=ha>=0?ha+el:ha-el,xs[ia-1]=Cl+el,xs[ia]=xs[ia-1],el!==0&&(xs[ia]=Cl-bl/el),bs[ia-1]=0,bs[ia]=0,Cl=Cs.get(ia,ia-1),Na=Math.abs(Cl)+Math.abs(el),ha=Cl/Na,Ma=el/Na,Ka=Math.sqrt(ha*ha+Ma*Ma),ha=ha/Ka,Ma=Ma/Ka,il=ia-1;il<sa;il++)el=Cs.get(ia-1,il),Cs.set(ia-1,il,Ma*el+ha*Cs.get(ia,il)),Cs.set(ia,il,Ma*Cs.get(ia,il)-ha*el);for(Ua=0;Ua<=ia;Ua++)el=Cs.get(Ua,ia-1),Cs.set(Ua,ia-1,Ma*el+ha*Cs.get(Ua,ia)),Cs.set(Ua,ia,Ma*Cs.get(Ua,ia)-ha*el);for(Ua=Za;Ua<=Ja;Ua++)el=Kn.get(Ua,ia-1),Kn.set(Ua,ia-1,Ma*el+ha*Kn.get(Ua,ia)),Kn.set(Ua,ia,Ma*Kn.get(Ua,ia)-ha*el)}else xs[ia-1]=Cl+ha,xs[ia]=Cl+ha,bs[ia-1]=el,bs[ia]=-el;ia=ia-2,fl=0}else{if(Cl=Cs.get(ia,ia),Kl=0,bl=0,Tl<ia&&(Kl=Cs.get(ia-1,ia-1),bl=Cs.get(ia,ia-1)*Cs.get(ia-1,ia)),fl===10){for(aa+=Cl,Ua=Za;Ua<=ia;Ua++)Cs.set(Ua,Ua,Cs.get(Ua,Ua)-Cl);Na=Math.abs(Cs.get(ia,ia-1))+Math.abs(Cs.get(ia-1,ia-2)),Cl=Kl=.75*Na,bl=-.4375*Na*Na}if(fl===30&&(Na=(Kl-Cl)/2,Na=Na*Na+bl,Na>0)){for(Na=Math.sqrt(Na),Kl<Cl&&(Na=-Na),Na=Cl-bl/((Kl-Cl)/2+Na),Ua=Za;Ua<=ia;Ua++)Cs.set(Ua,Ua,Cs.get(Ua,Ua)-Na);aa+=Na,Cl=Kl=bl=.964}for(fl=fl+1,Dl=ia-2;Dl>=Tl&&(el=Cs.get(Dl,Dl),Ka=Cl-el,Na=Kl-el,ha=(Ka*Na-bl)/Cs.get(Dl+1,Dl)+Cs.get(Dl,Dl+1),Ma=Cs.get(Dl+1,Dl+1)-el-Ka-Na,Ka=Cs.get(Dl+2,Dl+1),Na=Math.abs(ha)+Math.abs(Ma)+Math.abs(Ka),ha=ha/Na,Ma=Ma/Na,Ka=Ka/Na,!(Dl===Tl||Math.abs(Cs.get(Dl,Dl-1))*(Math.abs(Ma)+Math.abs(Ka))<Qa*(Math.abs(ha)*(Math.abs(Cs.get(Dl-1,Dl-1))+Math.abs(el)+Math.abs(Cs.get(Dl+1,Dl+1))))));)Dl--;for(Ua=Dl+2;Ua<=ia;Ua++)Cs.set(Ua,Ua-2,0),Ua>Dl+2&&Cs.set(Ua,Ua-3,0);for(ll=Dl;ll<=ia-1&&(sc=ll!==ia-1,ll!==Dl&&(ha=Cs.get(ll,ll-1),Ma=Cs.get(ll+1,ll-1),Ka=sc?Cs.get(ll+2,ll-1):0,Cl=Math.abs(ha)+Math.abs(Ma)+Math.abs(Ka),Cl!==0&&(ha=ha/Cl,Ma=Ma/Cl,Ka=Ka/Cl)),Cl!==0);ll++)if(Na=Math.sqrt(ha*ha+Ma*Ma+Ka*Ka),ha<0&&(Na=-Na),Na!==0){for(ll!==Dl?Cs.set(ll,ll-1,-Na*Cl):Tl!==Dl&&Cs.set(ll,ll-1,-Cs.get(ll,ll-1)),ha=ha+Na,Cl=ha/Na,Kl=Ma/Na,el=Ka/Na,Ma=Ma/ha,Ka=Ka/ha,il=ll;il<sa;il++)ha=Cs.get(ll,il)+Ma*Cs.get(ll+1,il),sc&&(ha=ha+Ka*Cs.get(ll+2,il),Cs.set(ll+2,il,Cs.get(ll+2,il)-ha*el)),Cs.set(ll,il,Cs.get(ll,il)-ha*Cl),Cs.set(ll+1,il,Cs.get(ll+1,il)-ha*Kl);for(Ua=0;Ua<=Math.min(ia,ll+3);Ua++)ha=Cl*Cs.get(Ua,ll)+Kl*Cs.get(Ua,ll+1),sc&&(ha=ha+el*Cs.get(Ua,ll+2),Cs.set(Ua,ll+2,Cs.get(Ua,ll+2)-ha*Ka)),Cs.set(Ua,ll,Cs.get(Ua,ll)-ha),Cs.set(Ua,ll+1,Cs.get(Ua,ll+1)-ha*Ma);for(Ua=Za;Ua<=Ja;Ua++)ha=Cl*Kn.get(Ua,ll)+Kl*Kn.get(Ua,ll+1),sc&&(ha=ha+el*Kn.get(Ua,ll+2),Kn.set(Ua,ll+2,Kn.get(Ua,ll+2)-ha*Ka)),Kn.set(Ua,ll,Kn.get(Ua,ll)-ha),Kn.set(Ua,ll+1,Kn.get(Ua,ll+1)-ha*Ma)}}}if(pa!==0){for(ia=sa-1;ia>=0;ia--)if(ha=xs[ia],Ma=bs[ia],Ma===0)for(Tl=ia,Cs.set(ia,ia,1),Ua=ia-1;Ua>=0;Ua--){for(bl=Cs.get(Ua,Ua)-ha,Ka=0,il=Tl;il<=ia;il++)Ka=Ka+Cs.get(Ua,il)*Cs.get(il,ia);if(bs[Ua]<0)el=bl,Na=Ka;else if(Tl=Ua,bs[Ua]===0?Cs.set(Ua,ia,bl!==0?-Ka/bl:-Ka/(Qa*pa)):(Cl=Cs.get(Ua,Ua+1),Kl=Cs.get(Ua+1,Ua),Ma=(xs[Ua]-ha)*(xs[Ua]-ha)+bs[Ua]*bs[Ua],Nl=(Cl*Na-el*Ka)/Ma,Cs.set(Ua,ia,Nl),Cs.set(Ua+1,ia,Math.abs(Cl)>Math.abs(el)?(-Ka-bl*Nl)/Cl:(-Na-Kl*Nl)/el)),Nl=Math.abs(Cs.get(Ua,ia)),Qa*Nl*Nl>1)for(il=Ua;il<=ia;il++)Cs.set(il,ia,Cs.get(il,ia)/Nl)}else if(Ma<0)for(Tl=ia-1,Math.abs(Cs.get(ia,ia-1))>Math.abs(Cs.get(ia-1,ia))?(Cs.set(ia-1,ia-1,Ma/Cs.get(ia,ia-1)),Cs.set(ia-1,ia,-(Cs.get(ia,ia)-ha)/Cs.get(ia,ia-1))):(ic=yc(0,-Cs.get(ia-1,ia),Cs.get(ia-1,ia-1)-ha,Ma),Cs.set(ia-1,ia-1,ic[0]),Cs.set(ia-1,ia,ic[1])),Cs.set(ia,ia-1,0),Cs.set(ia,ia,1),Ua=ia-2;Ua>=0;Ua--){for(ul=0,Ml=0,il=Tl;il<=ia;il++)ul=ul+Cs.get(Ua,il)*Cs.get(il,ia-1),Ml=Ml+Cs.get(Ua,il)*Cs.get(il,ia);if(bl=Cs.get(Ua,Ua)-ha,bs[Ua]<0)el=bl,Ka=ul,Na=Ml;else if(Tl=Ua,bs[Ua]===0?(ic=yc(-ul,-Ml,bl,Ma),Cs.set(Ua,ia-1,ic[0]),Cs.set(Ua,ia,ic[1])):(Cl=Cs.get(Ua,Ua+1),Kl=Cs.get(Ua+1,Ua),Ul=(xs[Ua]-ha)*(xs[Ua]-ha)+bs[Ua]*bs[Ua]-Ma*Ma,Bl=(xs[Ua]-ha)*2*Ma,Ul===0&&Bl===0&&(Ul=Qa*pa*(Math.abs(bl)+Math.abs(Ma)+Math.abs(Cl)+Math.abs(Kl)+Math.abs(el))),ic=yc(Cl*Ka-el*ul+Ma*Ml,Cl*Na-el*Ml-Ma*ul,Ul,Bl),Cs.set(Ua,ia-1,ic[0]),Cs.set(Ua,ia,ic[1]),Math.abs(Cl)>Math.abs(el)+Math.abs(Ma)?(Cs.set(Ua+1,ia-1,(-ul-bl*Cs.get(Ua,ia-1)+Ma*Cs.get(Ua,ia))/Cl),Cs.set(Ua+1,ia,(-Ml-bl*Cs.get(Ua,ia)-Ma*Cs.get(Ua,ia-1))/Cl)):(ic=yc(-Ka-Kl*Cs.get(Ua,ia-1),-Na-Kl*Cs.get(Ua,ia),el,Ma),Cs.set(Ua+1,ia-1,ic[0]),Cs.set(Ua+1,ia,ic[1]))),Nl=Math.max(Math.abs(Cs.get(Ua,ia-1)),Math.abs(Cs.get(Ua,ia))),Qa*Nl*Nl>1)for(il=Ua;il<=ia;il++)Cs.set(il,ia-1,Cs.get(il,ia-1)/Nl),Cs.set(il,ia,Cs.get(il,ia)/Nl)}for(Ua=0;Ua<sa;Ua++)if(Ua<Za||Ua>Ja)for(il=Ua;il<sa;il++)Kn.set(Ua,il,Cs.get(Ua,il));for(il=sa-1;il>=Za;il--)for(Ua=Za;Ua<=Ja;Ua++){for(el=0,ll=Za;ll<=Math.min(il,Ja);ll++)el=el+Kn.get(Ua,ll)*Cs.get(ll,il);Kn.set(Ua,il,el)}}}function yc(sa,bs,xs,Kn){let Cs,ia;return Math.abs(xs)>Math.abs(Kn)?(Cs=Kn/xs,ia=xs+Cs*Kn,[(sa+Cs*bs)/ia,(bs-Cs*sa)/ia]):(Cs=xs/Kn,ia=Kn+Cs*xs,[(Cs*sa+bs)/ia,(Cs*bs-sa)/ia])}class Cc{constructor(bs){if(bs=ml.checkMatrix(bs),!bs.isSymmetric())throw new Error("Matrix is not symmetric");let xs=bs,Kn=xs.rows,Cs=new al(Kn,Kn),ia=!0,Za,Ja,Qa;for(Ja=0;Ja<Kn;Ja++){let aa=0;for(Qa=0;Qa<Ja;Qa++){let pa=0;for(Za=0;Za<Qa;Za++)pa+=Cs.get(Qa,Za)*Cs.get(Ja,Za);pa=(xs.get(Ja,Qa)-pa)/Cs.get(Qa,Qa),Cs.set(Ja,Qa,pa),aa=aa+pa*pa}for(aa=xs.get(Ja,Ja)-aa,ia&&(ia=aa>0),Cs.set(Ja,Ja,Math.sqrt(Math.max(aa,0))),Qa=Ja+1;Qa<Kn;Qa++)Cs.set(Ja,Qa,0)}this.L=Cs,this.positiveDefinite=ia}isPositiveDefinite(){return this.positiveDefinite}solve(bs){bs=ml.checkMatrix(bs);let xs=this.L,Kn=xs.rows;if(bs.rows!==Kn)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let Cs=bs.columns,ia=bs.clone(),Za,Ja,Qa;for(Qa=0;Qa<Kn;Qa++)for(Ja=0;Ja<Cs;Ja++){for(Za=0;Za<Qa;Za++)ia.set(Qa,Ja,ia.get(Qa,Ja)-ia.get(Za,Ja)*xs.get(Qa,Za));ia.set(Qa,Ja,ia.get(Qa,Ja)/xs.get(Qa,Qa))}for(Qa=Kn-1;Qa>=0;Qa--)for(Ja=0;Ja<Cs;Ja++){for(Za=Qa+1;Za<Kn;Za++)ia.set(Qa,Ja,ia.get(Qa,Ja)-ia.get(Za,Ja)*xs.get(Za,Qa));ia.set(Qa,Ja,ia.get(Qa,Ja)/xs.get(Qa,Qa))}return ia}get lowerTriangularMatrix(){return this.L}}class pc{constructor(bs,xs={}){bs=ml.checkMatrix(bs);let{Y:Kn}=xs;const{scaleScores:Cs=!1,maxIterations:ia=1e3,terminationCriteria:Za=1e-10}=xs;let Ja;if(Kn){if(qe.isAnyArray(Kn)&&typeof Kn[0]=="number"?Kn=al.columnVector(Kn):Kn=ml.checkMatrix(Kn),Kn.rows!==bs.rows)throw new Error("Y should have the same number of rows as X");Ja=Kn.getColumnVector(0)}else Ja=bs.getColumnVector(0);let Qa=1,aa,pa,ha,Ma;for(let Ka=0;Ka<ia&&Qa>Za;Ka++)ha=bs.transpose().mmul(Ja).div(Ja.transpose().mmul(Ja).get(0,0)),ha=ha.div(ha.norm()),aa=bs.mmul(ha).div(ha.transpose().mmul(ha).get(0,0)),Ka>0&&(Qa=aa.clone().sub(Ma).pow(2).sum()),Ma=aa.clone(),Kn?(pa=Kn.transpose().mmul(aa).div(aa.transpose().mmul(aa).get(0,0)),pa=pa.div(pa.norm()),Ja=Kn.mmul(pa).div(pa.transpose().mmul(pa).get(0,0))):Ja=aa;if(Kn){let Ka=bs.transpose().mmul(aa).div(aa.transpose().mmul(aa).get(0,0));Ka=Ka.div(Ka.norm());let Na=bs.clone().sub(aa.clone().mmul(Ka.transpose())),el=Ja.transpose().mmul(aa).div(aa.transpose().mmul(aa).get(0,0)),fl=Kn.clone().sub(aa.clone().mulS(el.get(0,0)).mmul(pa.transpose()));this.t=aa,this.p=Ka.transpose(),this.w=ha.transpose(),this.q=pa,this.u=Ja,this.s=aa.transpose().mmul(aa),this.xResidual=Na,this.yResidual=fl,this.betas=el}else this.w=ha.transpose(),this.s=aa.transpose().mmul(aa).sqrt(),Cs?this.t=aa.clone().div(this.s.get(0,0)):this.t=aa,this.xResidual=bs.sub(aa.mmul(ha.transpose()))}}return matrix$1.AbstractMatrix=pl,matrix$1.CHO=Cc,matrix$1.CholeskyDecomposition=Cc,matrix$1.DistanceMatrix=Ol,matrix$1.EVD=ec,matrix$1.EigenvalueDecomposition=ec,matrix$1.LU=jl,matrix$1.LuDecomposition=jl,matrix$1.Matrix=al,matrix$1.MatrixColumnSelectionView=rl,matrix$1.MatrixColumnView=cl,matrix$1.MatrixFlipColumnView=nl,matrix$1.MatrixFlipRowView=vl,matrix$1.MatrixRowSelectionView=Sl,matrix$1.MatrixRowView=Pl,matrix$1.MatrixSelectionView=El,matrix$1.MatrixSubView=Il,matrix$1.MatrixTransposeView=$l,matrix$1.NIPALS=pc,matrix$1.Nipals=pc,matrix$1.QR=yl,matrix$1.QrDecomposition=yl,matrix$1.SVD=Yl,matrix$1.SingularValueDecomposition=Yl,matrix$1.SymmetricMatrix=Fl,matrix$1.WrapperMatrix1D=Ll,matrix$1.WrapperMatrix2D=ml,matrix$1.correlation=Ql,matrix$1.covariance=Zl,matrix$1.default=al,matrix$1.determinant=Wl,matrix$1.inverse=Rl,matrix$1.linearDependencies=Jl,matrix$1.pseudoInverse=ql,matrix$1.solve=Hl,matrix$1.wrap=Vl,matrix$1}var matrixExports=requireMatrix();const matrix=getDefaultExportFromCjs(matrixExports),Matrix$1=matrixExports.Matrix,SVD=matrixExports.SVD,SingularValueDecomposition=matrixExports.SingularValueDecomposition;matrix.Matrix?matrix.Matrix:matrixExports.Matrix;const inverse=matrixExports.inverse,solve=matrixExports.solve;function getSeparatedKernel(qe){const f=new SVD(qe,{autoTranspose:!0});if(f.rank!==1)return null;const ze=Math.sqrt(f.s[0]),Ke=f.U.to2DArray().map(Pi=>Pi[0]*ze),Qe=f.V.to2DArray().map(Pi=>Pi[0]*ze);return[Ke,Qe]}function convolution(qe,f={}){let{channels:ze,bitDepth:Ke,normalize:Qe=!1,divisor:Pi=1,border:nn="copy",algorithm:ln="auto"}=f,cn={};Ke&&(cn.bitDepth=Ke);let hn=Image$1.createFrom(this,cn);if(ze=validateArrayOfChannels(this,ze),ln!=="separable")({kernel:qe}=validateKernel(qe));else if(!Array.isArray(qe)||qe.length!==2)throw new RangeError("separable convolution requires two arrays of numbers to represent the kernel");if(ln==="auto"){let ra=getSeparatedKernel(qe);ra!==null?(ln="separable",qe=ra):(qe.length>9||qe[0].length>9)&&this.width<=4096&&this.height<=4096?ln="fft":ln="direct"}let un,zn;ln==="separable"?(un=Math.floor(qe[0].length/2),zn=Math.floor(qe[1].length/2)):(un=Math.floor(qe.length/2),zn=Math.floor(qe[0].length/2));let Xn=hn.isClamped,Un=new Array(this.height*this.width),qn,ys,vs,ea,na,ta;for(ea=0;ea<ze.length;ea++){for(na=ze[ea],vs=0;vs<this.height;vs++)for(ys=0;ys<this.width;ys++)qn=vs*this.width+ys,Un[qn]=this.data[qn*this.channels+na];if(ln==="direct")ta=srcExports$1.direct(Un,qe,{rows:this.height,cols:this.width,normalize:Qe,divisor:Pi});else if(ln==="separable"){if(ta=convolutionSeparable(Un,qe,this.width,this.height),Qe){Pi=0;for(let ra=0;ra<qe[0].length;ra++)for(let oa=0;oa<qe[1].length;oa++)Pi+=qe[0][ra]*qe[1][oa]}if(Pi!==1)for(let ra=0;ra<ta.length;ra++)ta[ra]/=Pi}else ta=srcExports$1.fft(Un,qe,{rows:this.height,cols:this.width,normalize:Qe,divisor:Pi});for(vs=0;vs<this.height;vs++)for(ys=0;ys<this.width;ys++)qn=vs*this.width+ys,Xn?hn.data[qn*this.channels+na]=clamp(ta[qn],hn):hn.data[qn*this.channels+na]=ta[qn]}if(this.alpha&&!ze.includes(this.channels))for(ys=this.components;ys<this.data.length;ys=ys+this.channels)hn.data[ys]=this.data[ys];return nn!=="periodic"&&hn.setBorder({size:[zn,un],algorithm:nn}),hn}function gradientFilter(qe={}){let{direction:f="xy",border:ze="copy",kernelX:Ke,kernelY:Qe,channels:Pi,bitDepth:nn=this.bitDepth}=qe;switch(this.checkProcessable("gradientFilter",{bitDepth:[8,16]}),f){case"x":if(!Ke)throw new Error("kernelX option is missing");return convolution.call(this,Ke,{channels:Pi,border:ze,bitDepth:nn});case"y":if(!Qe)throw new Error("kernelY option is missing");return convolution.call(this,Qe,{channels:Pi,border:ze,bitDepth:nn});case"xy":{if(!Ke)throw new Error("kernelX option is missing");if(!Qe)throw new Error("kernelY option is missing");const ln=convolution.call(this,Ke,{channels:Pi,border:ze,bitDepth:32}),cn=convolution.call(this,Qe,{channels:Pi,border:ze,bitDepth:32});return ln.hypotenuse(cn,{bitDepth:nn,channels:Pi})}default:throw new Error(`Unknown parameter direction: ${f}`)}}function sobelFilter(qe){return gradientFilter.call(this,Object.assign({},qe,{kernelX:SOBEL_X,kernelY:SOBEL_Y}))}function scharrFilter(qe){return gradientFilter.call(this,Object.assign({},qe,{kernelX:SCHARR_X,kernelY:SCHARR_Y}))}var newArray_1,hasRequiredNewArray;function requireNewArray(){if(hasRequiredNewArray)return newArray_1;hasRequiredNewArray=1,newArray_1=qe;function qe(f,ze){f=f||0;for(var Ke=new Array(f),Qe=0;Qe<f;Qe++)Ke[Qe]=ze;return Ke}return newArray_1}var newArrayExports=requireNewArray();const newArray=getDefaultExportFromCjs(newArrayExports);function level(qe={}){let{algorithm:f="range",channels:ze,min:Ke=this.min,max:Qe=this.max}=qe;switch(this.checkProcessable("level",{bitDepth:[8,16,32]}),ze=validateArrayOfChannels(this,{channels:ze}),ze.length!==this.channel&&(Array.isArray(Ke)&&Ke.length===this.channels&&(Ke=Ke.filter((Pi,nn)=>ze.includes(nn))),Array.isArray(Qe)&&Qe.length===this.channels&&(Qe=Qe.filter((Pi,nn)=>ze.includes(nn)))),f){case"range":Ke<0&&(Ke=0),Qe>this.maxValue&&(Qe=this.maxValue),Array.isArray(Ke)||(Ke=newArray(ze.length,Ke)),Array.isArray(Qe)||(Qe=newArray(ze.length,Qe)),processImage(this,Ke,Qe,ze);break;default:throw new Error(`level: algorithm not implement: ${f}`)}return this}function processImage(qe,f,ze,Ke){let Qe=1e-5,Pi=new Array(Ke.length);for(let nn=0;nn<Ke.length;nn++)f[nn]===0&&ze[nn]===qe.maxValue||ze[nn]===f[nn]?Pi[nn]=0:Pi[nn]=(qe.maxValue+1-Qe)/(ze[nn]-f[nn]),f[nn]+=(.5-Qe/2)/Pi[nn];for(let nn=0;nn<Ke.length;nn++){let ln=Ke[nn];if(Pi[nn]!==0)for(let cn=0;cn<qe.data.length;cn+=qe.channels)qe.data[cn+ln]=Math.min(Math.max(0,(qe.data[cn+ln]-f[nn])*Pi[nn]+.5|0),qe.maxValue)}}var isArrayType,hasRequiredIsArrayType;function requireIsArrayType(){if(hasRequiredIsArrayType)return isArrayType;hasRequiredIsArrayType=1;var qe=Object.prototype.toString;return isArrayType=function(ze){return qe.call(ze).substr(-6,5)==="Array"},isArrayType}var isArrayTypeExports=requireIsArrayType();const isArray$1=getDefaultExportFromCjs(isArrayTypeExports);function checkNumberArray(qe){if(isNaN(qe)){if(qe instanceof Image$1)return qe.data;if(!isArray$1(qe))throw new Error("checkNumberArray: the value should be either a number, array or Image");return qe}else{if(qe<=0)throw new Error("checkNumberArray: the value must be greater than 0");return qe}}function add(qe,f={}){let{channels:ze}=f;if(this.checkProcessable("add",{bitDepth:[8,16]}),ze=validateArrayOfChannels(this,{channels:ze}),qe=checkNumberArray(qe),isNaN(qe)){if(this.data.length!==qe.length)throw new Error("add: the data size is different");for(let Ke=0;Ke<ze.length;Ke++){let Qe=ze[Ke];for(let Pi=0;Pi<this.data.length;Pi+=this.channels)this.data[Pi+Qe]=Math.max(0,Math.min(this.maxValue,this.data[Pi+Qe]+qe[Pi+Qe]>>0))}}else for(let Ke=0;Ke<ze.length;Ke++){let Qe=ze[Ke];for(let Pi=0;Pi<this.data.length;Pi+=this.channels)this.data[Pi+Qe]=Math.min(this.maxValue,this.data[Pi+Qe]+qe>>0)}return this}function subtract(qe,f={}){let{channels:ze}=f;if(this.checkProcessable("subtract",{bitDepth:[8,16]}),ze=validateArrayOfChannels(this,{channels:ze}),qe=checkNumberArray(qe),isNaN(qe)){if(this.data.length!==qe.length)throw new Error("subtract: the data size is different");for(let Ke=0;Ke<ze.length;Ke++){let Qe=ze[Ke];for(let Pi=0;Pi<this.data.length;Pi+=this.channels)this.data[Pi+Qe]=Math.max(0,Math.min(this.maxValue,this.data[Pi+Qe]-qe[Pi+Qe]>>0))}}else for(let Ke=0;Ke<ze.length;Ke++){let Qe=ze[Ke];for(let Pi=0;Pi<this.data.length;Pi+=this.channels)this.data[Pi+Qe]=Math.max(0,this.data[Pi+Qe]-qe>>0)}return this}function subtractImage(qe,f={}){let{channels:ze,absolute:Ke=!1}=f;if(this.checkProcessable("subtractImage",{bitDepth:[8,16]}),this.width!==qe.width||this.height!==qe.height)throw new Error("subtractImage: both images must have the same size");if(this.alpha!==qe.alpha||this.bitDepth!==qe.bitDepth)throw new Error("subtractImage: both images must have the same alpha and bitDepth");if(this.channels!==qe.channels)throw new Error("subtractImage: both images must have the same number of channels");let Qe=this.clone();ze=validateArrayOfChannels(this,{channels:ze});for(let Pi=0;Pi<ze.length;Pi++){let nn=ze[Pi];for(let ln=nn;ln<this.data.length;ln+=this.channels){let cn=this.data[ln]-qe.data[ln];Ke?Qe.data[ln]=Math.abs(cn):Qe.data[ln]=Math.max(cn,0)}}return Qe}function hypotenuse(qe,f={}){let{bitDepth:ze=this.bitDepth,channels:Ke}=f;if(this.checkProcessable("hypotenuse",{bitDepth:[8,16,32]}),this.width!==qe.width||this.height!==qe.height)throw new Error("hypotenuse: both images must have the same size");if(this.alpha!==qe.alpha||this.bitDepth!==qe.bitDepth)throw new Error("hypotenuse: both images must have the same alpha and bitDepth");if(this.channels!==qe.channels)throw new Error("hypotenuse: both images must have the same number of channels");let Qe=Image$1.createFrom(this,{bitDepth:ze});Ke=validateArrayOfChannels(this,{channels:Ke});let Pi=Qe.isClamped;for(let nn=0;nn<Ke.length;nn++){let ln=Ke[nn];for(let cn=ln;cn<this.data.length;cn+=this.channels){let hn=Math.hypot(this.data[cn],qe.data[cn]);Pi?Qe.data[cn]=Math.min(Math.max(Math.round(hn),0),Qe.maxValue):Qe.data[cn]=hn}}return Qe}function multiply(qe,f={}){let{channels:ze}=f;if(this.checkProcessable("multiply",{bitDepth:[8,16]}),qe<=0)throw new Error("multiply: the value must be greater than 0");if(ze=validateArrayOfChannels(this,{channels:ze}),qe=checkNumberArray(qe),isNaN(qe)){if(this.data.length!==qe.length)throw new Error("multiply: the data size is different");for(let Ke=0;Ke<ze.length;Ke++){let Qe=ze[Ke];for(let Pi=0;Pi<this.data.length;Pi+=this.channels)this.data[Pi+Qe]=Math.max(0,Math.min(this.maxValue,this.data[Pi+Qe]*qe[Pi+Qe]>>0))}}else for(let Ke=0;Ke<ze.length;Ke++){let Qe=ze[Ke];for(let Pi=0;Pi<this.data.length;Pi+=this.channels)this.data[Pi+Qe]=Math.min(this.maxValue,this.data[Pi+Qe]*qe>>0)}return this}function divide(qe,f={}){let{channels:ze}=f;if(this.checkProcessable("divide",{bitDepth:[8,16]}),ze=validateArrayOfChannels(this,{channels:ze}),qe=checkNumberArray(qe),isNaN(qe)){if(this.data.length!==qe.length)throw new Error("divide: the: the data size is different");for(let Ke=0;Ke<ze.length;Ke++){let Qe=ze[Ke];for(let Pi=0;Pi<this.data.length;Pi+=this.channels)this.data[Pi+Qe]=Math.max(0,Math.min(this.maxValue,this.data[Pi+Qe]/qe[Pi+Qe]>>0))}}else for(let Ke=0;Ke<ze.length;Ke++){let Qe=ze[Ke];for(let Pi=0;Pi<this.data.length;Pi+=this.channels)this.data[Pi+Qe]=Math.min(this.maxValue,this.data[Pi+Qe]/qe>>0)}return this}class BaseRegression{constructor(){if(new.target===BaseRegression)throw new Error("BaseRegression must be subclassed")}predict(f){if(typeof f=="number")return this._predict(f);if(isAnyArray(f)){const ze=[];for(let Ke=0;Ke<f.length;Ke++)ze.push(this._predict(f[Ke]));return ze}else throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(f,ze){if(!isAnyArray(f)||!isAnyArray(ze)||f.length!==ze.length)throw new Error("x and y must be arrays of the same length");const Ke=f.length,Qe=new Array(Ke);for(let Un=0;Un<Ke;Un++)Qe[Un]=this._predict(f[Un]);let Pi=0,nn=0,ln=0,cn=0,hn=0,un=0,zn=0;for(let Un=0;Un<Ke;Un++)Pi+=Qe[Un],nn+=ze[Un],hn+=Qe[Un]*Qe[Un],un+=ze[Un]*ze[Un],zn+=Qe[Un]*ze[Un],ze[Un]!==0&&(ln+=(ze[Un]-Qe[Un])*(ze[Un]-Qe[Un])/ze[Un]),cn+=(ze[Un]-Qe[Un])*(ze[Un]-Qe[Un]);const Xn=(Ke*zn-Pi*nn)/Math.sqrt((Ke*hn-Pi*Pi)*(Ke*un-nn*nn));return{r:Xn,r2:Xn*Xn,chi2:ln,rmsd:Math.sqrt(cn/Ke)}}}function squaredEuclidean(qe,f){let ze=0;for(let Ke=0;Ke<qe.length;Ke++)ze+=(qe[Ke]-f[Ke])*(qe[Ke]-f[Ke]);return ze}function euclidean(qe,f){return Math.sqrt(squaredEuclidean(qe,f))}const euclidean$1=Object.freeze(Object.defineProperty({__proto__:null,euclidean,squaredEuclidean},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(euclidean$1);var gaussianKernel,hasRequiredGaussianKernel;function requireGaussianKernel(){if(hasRequiredGaussianKernel)return gaussianKernel;hasRequiredGaussianKernel=1;const{squaredEuclidean:qe}=require$$0,f={sigma:1};class ze{constructor(Qe){Qe=Object.assign({},f,Qe),this.sigma=Qe.sigma,this.divisor=2*Qe.sigma*Qe.sigma}compute(Qe,Pi){const nn=qe(Qe,Pi);return Math.exp(-nn/this.divisor)}}return gaussianKernel=ze,gaussianKernel}var polynomialKernel,hasRequiredPolynomialKernel;function requirePolynomialKernel(){if(hasRequiredPolynomialKernel)return polynomialKernel;hasRequiredPolynomialKernel=1;const qe={degree:1,constant:1,scale:1};class f{constructor(Ke){Ke=Object.assign({},qe,Ke),this.degree=Ke.degree,this.constant=Ke.constant,this.scale=Ke.scale}compute(Ke,Qe){for(var Pi=0,nn=0;nn<Ke.length;nn++)Pi+=Ke[nn]*Qe[nn];return Math.pow(this.scale*Pi+this.constant,this.degree)}}return polynomialKernel=f,polynomialKernel}var sigmoidKernel,hasRequiredSigmoidKernel;function requireSigmoidKernel(){if(hasRequiredSigmoidKernel)return sigmoidKernel;hasRequiredSigmoidKernel=1;const qe={alpha:.01,constant:-Math.E};class f{constructor(Ke){Ke=Object.assign({},qe,Ke),this.alpha=Ke.alpha,this.constant=Ke.constant}compute(Ke,Qe){for(var Pi=0,nn=0;nn<Ke.length;nn++)Pi+=Ke[nn]*Qe[nn];return Math.tanh(this.alpha*Pi+this.constant)}}return sigmoidKernel=f,sigmoidKernel}var anovaKernel,hasRequiredAnovaKernel;function requireAnovaKernel(){if(hasRequiredAnovaKernel)return anovaKernel;hasRequiredAnovaKernel=1;const qe={sigma:1,degree:1};class f{constructor(Ke){Ke=Object.assign({},qe,Ke),this.sigma=Ke.sigma,this.degree=Ke.degree}compute(Ke,Qe){for(var Pi=0,nn=Math.min(Ke.length,Qe.length),ln=1;ln<=nn;++ln)Pi+=Math.pow(Math.exp(-this.sigma*Math.pow(Math.pow(Ke[ln-1],ln)-Math.pow(Qe[ln-1],ln),2)),this.degree);return Pi}}return anovaKernel=f,anovaKernel}var cauchyKernel,hasRequiredCauchyKernel;function requireCauchyKernel(){if(hasRequiredCauchyKernel)return cauchyKernel;hasRequiredCauchyKernel=1;const{squaredEuclidean:qe}=require$$0,f={sigma:1};class ze{constructor(Qe){Qe=Object.assign({},f,Qe),this.sigma=Qe.sigma}compute(Qe,Pi){return 1/(1+qe(Qe,Pi)/(this.sigma*this.sigma))}}return cauchyKernel=ze,cauchyKernel}var exponentialKernel,hasRequiredExponentialKernel;function requireExponentialKernel(){if(hasRequiredExponentialKernel)return exponentialKernel;hasRequiredExponentialKernel=1;const{euclidean:qe}=require$$0,f={sigma:1};class ze{constructor(Qe){Qe=Object.assign({},f,Qe),this.sigma=Qe.sigma,this.divisor=2*Qe.sigma*Qe.sigma}compute(Qe,Pi){const nn=qe(Qe,Pi);return Math.exp(-nn/this.divisor)}}return exponentialKernel=ze,exponentialKernel}var histogramIntersectionKernel,hasRequiredHistogramIntersectionKernel;function requireHistogramIntersectionKernel(){if(hasRequiredHistogramIntersectionKernel)return histogramIntersectionKernel;hasRequiredHistogramIntersectionKernel=1;class qe{compute(ze,Ke){for(var Qe=Math.min(ze.length,Ke.length),Pi=0,nn=0;nn<Qe;++nn)Pi+=Math.min(ze[nn],Ke[nn]);return Pi}}return histogramIntersectionKernel=qe,histogramIntersectionKernel}var laplacianKernel,hasRequiredLaplacianKernel;function requireLaplacianKernel(){if(hasRequiredLaplacianKernel)return laplacianKernel;hasRequiredLaplacianKernel=1;const{euclidean:qe}=require$$0,f={sigma:1};class ze{constructor(Qe){Qe=Object.assign({},f,Qe),this.sigma=Qe.sigma}compute(Qe,Pi){const nn=qe(Qe,Pi);return Math.exp(-nn/this.sigma)}}return laplacianKernel=ze,laplacianKernel}var multiquadraticKernel,hasRequiredMultiquadraticKernel;function requireMultiquadraticKernel(){if(hasRequiredMultiquadraticKernel)return multiquadraticKernel;hasRequiredMultiquadraticKernel=1;const{squaredEuclidean:qe}=require$$0,f={constant:1};class ze{constructor(Qe){Qe=Object.assign({},f,Qe),this.constant=Qe.constant}compute(Qe,Pi){return Math.sqrt(qe(Qe,Pi)+this.constant*this.constant)}}return multiquadraticKernel=ze,multiquadraticKernel}var rationalQuadraticKernel,hasRequiredRationalQuadraticKernel;function requireRationalQuadraticKernel(){if(hasRequiredRationalQuadraticKernel)return rationalQuadraticKernel;hasRequiredRationalQuadraticKernel=1;const{squaredEuclidean:qe}=require$$0,f={constant:1};class ze{constructor(Qe){Qe=Object.assign({},f,Qe),this.constant=Qe.constant}compute(Qe,Pi){const nn=qe(Qe,Pi);return 1-nn/(nn+this.constant)}}return rationalQuadraticKernel=ze,rationalQuadraticKernel}var kernel,hasRequiredKernel;function requireKernel(){if(hasRequiredKernel)return kernel;hasRequiredKernel=1;const{Matrix:qe,MatrixTransposeView:f}=requireMatrix(),ze=requireGaussianKernel(),Ke=requirePolynomialKernel(),Qe=requireSigmoidKernel(),Pi=requireAnovaKernel(),nn=requireCauchyKernel(),ln=requireExponentialKernel(),cn=requireHistogramIntersectionKernel(),hn=requireLaplacianKernel(),un=requireMultiquadraticKernel(),zn=requireRationalQuadraticKernel(),Xn={gaussian:ze,rbf:ze,polynomial:Ke,poly:Ke,anova:Pi,cauchy:nn,exponential:ln,histogram:cn,min:cn,laplacian:hn,multiquadratic:un,rational:zn,sigmoid:Qe,mlp:Qe};class Un{constructor(ys,vs){if(this.kernelType=ys,ys!=="linear")if(typeof ys=="string"){ys=ys.toLowerCase();var ea=Xn[ys];if(ea)this.kernelFunction=new ea(vs);else throw new Error(`unsupported kernel type: ${ys}`)}else if(typeof ys=="object"&&typeof ys.compute=="function")this.kernelFunction=ys;else throw new TypeError("first argument must be a valid kernel type or instance")}compute(ys,vs){if(ys=qe.checkMatrix(ys),vs===void 0?vs=ys:vs=qe.checkMatrix(vs),this.kernelType==="linear")return ys.mmul(new f(vs));const ea=new qe(ys.rows,vs.rows);if(ys===vs)for(let na=0;na<ys.rows;na++)for(let ta=na;ta<ys.rows;ta++){const ra=this.kernelFunction.compute(ys.getRow(na),ys.getRow(ta));ea.set(na,ta,ra),ea.set(ta,na,ra)}else for(let na=0;na<ys.rows;na++)for(let ta=0;ta<vs.rows;ta++)ea.set(na,ta,this.kernelFunction.compute(ys.getRow(na),vs.getRow(ta)));return ea}}return kernel=Un,kernel}var kernelExports=requireKernel();const Kernel=getDefaultExportFromCjs(kernelExports),defaultOptions$2={lambda:.1,kernelType:"gaussian",kernelOptions:{},computeCoefficient:!1};class KernelRidgeRegression extends BaseRegression{constructor(f,ze,Ke){if(super(),f===!0)this.alpha=ze.alpha,this.inputs=ze.inputs,this.kernelType=ze.kernelType,this.kernelOptions=ze.kernelOptions,this.kernel=new Kernel(ze.kernelType,ze.kernelOptions);else{f=Matrix$1.checkMatrix(f),Ke=Object.assign({},defaultOptions$2,Ke);const Qe=new Kernel(Ke.kernelType,Ke.kernelOptions),Pi=Qe.compute(f),nn=f.rows;Pi.add(Matrix$1.eye(nn,nn).mul(Ke.lambda)),this.alpha=solve(Pi,ze),this.inputs=f,this.kernelType=Ke.kernelType,this.kernelOptions=Ke.kernelOptions,this.kernel=Qe}}_predict(f){return this.kernel.compute([f],this.inputs).mmul(this.alpha).getRow(0)}toJSON(){return{name:"kernelRidgeRegression",alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions}}static load(f){if(f.name!=="kernelRidgeRegression")throw new TypeError("not a KRR model");return new KernelRidgeRegression(!0,f)}}function background$1(qe,f,ze){const Ke=new KernelRidgeRegression(qe,f,ze),Qe=new Array(this.size);for(let ln=0;ln<this.width;ln++)for(let cn=0;cn<this.height;cn++)Qe[cn*this.width+ln]=[ln,cn];const Pi=Ke.predict(Qe),nn=Image$1.createFrom(this);for(let ln=0;ln<this.size;ln++)nn.data[ln]=Math.min(this.maxValue,Math.max(0,Pi[ln][0]));return nn}function dilate(qe={}){let{kernel:f=[[1,1,1],[1,1,1],[1,1,1]],iterations:ze=1}=qe;if(this.checkProcessable("dilate",{bitDepth:[1,8,16],components:1,alpha:0}),f.columns%2===0||f.rows%2===0)throw new TypeError("dilate: The number of rows and columns of the kernel must be odd");let Ke=!0;e:for(const Pi of f)for(const nn of Pi)if(nn!==1){Ke=!1;break e}let Qe=this;for(let Pi=0;Pi<ze;Pi++)if(this.bitDepth===1)if(Ke){const nn=Qe.clone();Qe=dilateOnceBinaryOnlyOnes(Qe,nn,f.length,f[0].length)}else{const nn=Image$1.createFrom(Qe);Qe=dilateOnceBinary(Qe,nn,f)}else if(Ke){const nn=Image$1.createFrom(Qe);Qe=dilateOnceGreyOnlyOnes(Qe,nn,f.length,f[0].length)}else{const nn=Image$1.createFrom(Qe);Qe=dilateOnceGrey(Qe,nn,f)}return Qe}function dilateOnceGrey(qe,f,ze){const Ke=ze.length,Qe=ze[0].length;let Pi=(Ke-1)/2,nn=(Qe-1)/2;for(let ln=0;ln<qe.height;ln++)for(let cn=0;cn<qe.width;cn++){let hn=0;for(let un=0;un<Qe;un++)for(let zn=0;zn<Ke;zn++){if(ze[zn][un]!==1)continue;let Xn=zn-Pi+cn,Un=un-nn+ln;if(Xn<0||Un<0||Xn>=qe.width||Un>=qe.height)continue;const qn=qe.getValueXY(Xn,Un,0);qn>hn&&(hn=qn)}f.setValueXY(cn,ln,0,hn)}return f}function dilateOnceGreyOnlyOnes(qe,f,ze,Ke){const Qe=(ze-1)/2,Pi=(Ke-1)/2,nn=[];for(let ln=0;ln<qe.width;ln++)nn.push(0);for(let ln=0;ln<qe.height;ln++){for(let cn=0;cn<qe.width;cn++){let hn=0;for(let un=Math.max(0,ln-Pi);un<Math.min(qe.height,ln+Pi+1);un++){const zn=qe.getValueXY(cn,un,0);zn>hn&&(hn=zn)}nn[cn]=hn}for(let cn=0;cn<qe.width;cn++){let hn=0;for(let un=Math.max(0,cn-Qe);un<Math.min(qe.width,cn+Qe+1);un++)nn[un]>hn&&(hn=nn[un]);f.setValueXY(cn,ln,0,hn)}}return f}function dilateOnceBinary(qe,f,ze){const Ke=ze.length,Qe=ze[0].length;let Pi=(Ke-1)/2,nn=(Qe-1)/2;for(let ln=0;ln<qe.height;ln++)for(let cn=0;cn<qe.width;cn++){let hn=0;e:for(let un=0;un<Qe;un++)for(let zn=0;zn<Ke;zn++){if(ze[zn][un]!==1)continue;let Xn=zn-Pi+cn,Un=un-nn+ln;if(Un<0||Xn<0||Xn>=qe.width||Un>=qe.height)continue;if(qe.getBitXY(Xn,Un)===1){hn=1;break e}}hn===1&&f.setBitXY(cn,ln)}return f}function dilateOnceBinaryOnlyOnes(qe,f,ze,Ke){const Qe=(ze-1)/2,Pi=(Ke-1)/2,nn=[];for(let ln=0;ln<qe.width;ln++)nn.push(1);for(let ln=0;ln<qe.height;ln++){for(let cn=0;cn<qe.width;cn++){nn[cn]=0;for(let hn=Math.max(0,ln-Pi);hn<Math.min(qe.height,ln+Pi+1);hn++)if(qe.getBitXY(cn,hn)===1){nn[cn]=1;break}}for(let cn=0;cn<qe.width;cn++)if(f.getBitXY(cn,ln)!==1){for(let hn=Math.max(0,cn-Qe);hn<Math.min(qe.width,cn+Qe+1);hn++)if(nn[hn]===1){f.setBitXY(cn,ln);break}}}return f}function erode(qe={}){let{kernel:f=[[1,1,1],[1,1,1],[1,1,1]],iterations:ze=1}=qe;if(this.checkProcessable("erode",{bitDepth:[1,8,16],components:1,alpha:0}),f.columns%2===0||f.rows%2===0)throw new TypeError("erode: The number of rows and columns of the kernel must be odd");let Ke=!0;e:for(const Pi of f)for(const nn of Pi)if(nn!==1){Ke=!1;break e}let Qe=this;for(let Pi=0;Pi<ze;Pi++)if(this.bitDepth===1)if(Ke){const nn=Qe.clone();Qe=erodeOnceBinaryOnlyOnes(Qe,nn,f.length,f[0].length)}else{const nn=Image$1.createFrom(Qe);Qe=erodeOnceBinary(Qe,nn,f)}else if(Ke){const nn=Image$1.createFrom(Qe);Qe=erodeOnceGreyOnlyOnes(Qe,nn,f.length,f[0].length)}else{const nn=Image$1.createFrom(Qe);Qe=erodeOnceGrey(Qe,nn,f)}return Qe}function erodeOnceGrey(qe,f,ze){const Ke=ze.length,Qe=ze[0].length;let Pi=(Ke-1)/2,nn=(Qe-1)/2;for(let ln=0;ln<qe.height;ln++)for(let cn=0;cn<qe.width;cn++){let hn=qe.maxValue;for(let un=0;un<Qe;un++)for(let zn=0;zn<Ke;zn++){if(ze[zn][un]!==1)continue;let Xn=zn-Pi+cn,Un=un-nn+ln;if(Xn<0||Un<0||Xn>=qe.width||Un>=qe.height)continue;const qn=qe.getValueXY(Xn,Un,0);qn<hn&&(hn=qn)}f.setValueXY(cn,ln,0,hn)}return f}function erodeOnceGreyOnlyOnes(qe,f,ze,Ke){const Qe=(ze-1)/2,Pi=(Ke-1)/2,nn=[];for(let ln=0;ln<qe.width;ln++)nn.push(0);for(let ln=0;ln<qe.height;ln++){for(let cn=0;cn<qe.width;cn++){let hn=qe.maxValue;for(let un=Math.max(0,ln-Pi);un<Math.min(qe.height,ln+Pi+1);un++){const zn=qe.getValueXY(cn,un,0);zn<hn&&(hn=zn)}nn[cn]=hn}for(let cn=0;cn<qe.width;cn++){let hn=qe.maxValue;for(let un=Math.max(0,cn-Qe);un<Math.min(qe.width,cn+Qe+1);un++)nn[un]<hn&&(hn=nn[un]);f.setValueXY(cn,ln,0,hn)}}return f}function erodeOnceBinary(qe,f,ze){const Ke=ze.length,Qe=ze[0].length;let Pi=(Ke-1)/2,nn=(Qe-1)/2;for(let ln=0;ln<qe.height;ln++)for(let cn=0;cn<qe.width;cn++){let hn=1;e:for(let un=0;un<Qe;un++)for(let zn=0;zn<Ke;zn++){if(ze[zn][un]!==1)continue;let Xn=zn-Pi+cn,Un=un-nn+ln;if(Un<0||Xn<0||Xn>=qe.width||Un>=qe.height)continue;if(qe.getBitXY(Xn,Un)===0){hn=0;break e}}hn===1&&f.setBitXY(cn,ln)}return f}function erodeOnceBinaryOnlyOnes(qe,f,ze,Ke){const Qe=(ze-1)/2,Pi=(Ke-1)/2,nn=[];for(let ln=0;ln<qe.width;ln++)nn.push(0);for(let ln=0;ln<qe.height;ln++){for(let cn=0;cn<qe.width;cn++){nn[cn]=1;for(let hn=Math.max(0,ln-Pi);hn<Math.min(qe.height,ln+Pi+1);hn++)if(qe.getBitXY(cn,hn)===0){nn[cn]=0;break}}for(let cn=0;cn<qe.width;cn++)if(f.getBitXY(cn,ln)!==0){for(let hn=Math.max(0,cn-Qe);hn<Math.min(qe.width,cn+Qe+1);hn++)if(nn[hn]===0){f.clearBitXY(cn,ln);break}}}return f}function open(qe={}){let{kernel:f=[[1,1,1],[1,1,1],[1,1,1]],iterations:ze=1}=qe;if(this.checkProcessable("open",{bitDepth:[8,16],components:1,alpha:0}),f.columns%2===0||f.rows%2===0)throw new TypeError("open: The number of rows and columns of the kernel must be odd");let Ke=this;for(let Qe=0;Qe<ze;Qe++)Ke=Ke.erode({kernel:f}),Ke=Ke.dilate({kernel:f});return Ke}function close(qe={}){let{kernel:f=[[1,1,1],[1,1,1],[1,1,1]],iterations:ze=1}=qe;if(this.checkProcessable("close",{bitDepth:[1,8,16],components:1,alpha:0}),f.columns%2===0||f.rows%2===0)throw new TypeError("close: The number of rows and columns of the kernel must be odd");let Ke=this;for(let Qe=0;Qe<ze;Qe++)Ke=Ke.dilate({kernel:f}).erode({kernel:f});return Ke}function topHat(qe={}){let{kernel:f=[[1,1,1],[1,1,1],[1,1,1]],iterations:ze=1}=qe;if(this.checkProcessable("topHat",{bitDepth:[8,16],components:1,alpha:0}),f.length%2===0||f[0].length%2===0)throw new TypeError("topHat: The number of rows and columns of the kernel must be odd");let Ke=this;for(let Qe=0;Qe<ze;Qe++)Ke=Ke.open({kernel:f}).subtractImage(Ke,{absolute:!0});return Ke}function blackHat(qe={}){let{kernel:f=[[1,1,1],[1,1,1],[1,1,1]],iterations:ze=1}=qe;if(this.checkProcessable("blackHat",{bitDepth:[8,16],components:1,alpha:0}),f.columns%2===0||f.rows%2===0)throw new TypeError("blackHat: The number of rows and columns of the kernel must be odd");let Ke=this;for(let Qe=0;Qe<ze;Qe++)Ke=Ke.close({kernel:f}).subtractImage(Ke,{absolute:!0});return Ke}function morphologicalGradient(qe={}){let{kernel:f=[[1,1,1],[1,1,1],[1,1,1]],iterations:ze=1}=qe;if(this.checkProcessable("morphologicalGradient",{bitDepth:[8,16],components:1,alpha:0}),f.columns%2===0||f.rows%2===0)throw new TypeError("morphologicalGradient: The number of rows and columns of the kernel must be odd");let Ke=this;for(let Qe=0;Qe<ze;Qe++){let Pi=Ke.dilate({kernel:f}),nn=Ke.erode({kernel:f});Ke=Pi.subtractImage(nn,{absolute:!0})}return Ke}function order4Points(qe){let f=0,ze=0,Ke=0,Qe=0,Pi=qe[0][0],nn=0;for(let hn=1;hn<qe.length;hn++)qe[hn][0]<Pi&&(Pi=qe[hn][0],nn=hn);let ln=qe[(nn+1)%qe.length][0],cn=(nn+1)%qe.length;for(let hn=1;hn<qe.length;hn++)qe[hn][0]<ln&&hn!==nn&&(ln=qe[hn][0],cn=hn);return qe[cn][1]<qe[nn][1]?(f=qe[cn],Qe=qe[nn],nn!==(cn+1)%4?(ze=qe[(cn+1)%4],Ke=qe[(cn+2)%4]):(ze=qe[(cn+2)%4],Ke=qe[(cn+3)%4])):(Qe=qe[cn],f=qe[nn],cn!==(nn+1)%4?(ze=qe[(nn+1)%4],Ke=qe[(nn+2)%4]):(ze=qe[(nn+2)%4],Ke=qe[(nn+3)%4])),[f,ze,Ke,Qe]}function distance2Points(qe,f){return Math.sqrt(Math.pow(qe[0]-f[0],2)+Math.pow(qe[1]-f[1],2))}function crossVect(qe,f){return[qe[1]*f[2]-qe[2]*f[1],qe[2]*f[0]-qe[0]*f[2],qe[0]*f[1]-qe[1]*f[0]]}function dotVect(qe,f){return qe[0]*f[0]+qe[1]*f[1]+qe[2]*f[2]}function computeWidthAndHeigth(qe,f,ze,Ke,Qe,Pi){let nn=Math.max(distance2Points(qe,f),distance2Points(Ke,ze)),ln=Math.max(distance2Points(qe,Ke),distance2Points(f,ze)),cn=0,hn=0,un=Math.ceil(Qe/2),zn=Math.ceil(Pi/2),Xn=nn/ln,Un=[qe[0],qe[1],1],qn=[f[0],f[1],1],ys=[Ke[0],Ke[1],1],vs=[ze[0],ze[1],1],ea=dotVect(crossVect(Un,vs),ys)/dotVect(crossVect(qn,vs),ys),na=dotVect(crossVect(Un,vs),qn)/dotVect(crossVect(ys,vs),qn),ta=[ea*qn[0]-Un[0],ea*qn[1]-Un[1],ea*qn[2]-Un[2]],ra=[na*ys[0]-Un[0],na*ys[1]-Un[1],na*ys[2]-Un[2]],oa=ta[0],fa=ta[1],ca=ta[2],la=ra[0],ua=ra[1],ga=ra[2],da=1/(ca*ga)*(oa*la-(oa*ga+ca*la)*un+ca*ga*un*un+(fa*ua-(fa*ga+ca*ua)*zn+ca*ga*zn*zn));da>=0?da=Math.sqrt(da):da=Math.sqrt(-da);let qa=new Matrix$1([[da,0,un],[0,da,zn],[0,0,1]]),tl=qa.transpose(),ol=inverse(tl),hl=inverse(qa),wl=Matrix$1.rowVector(ta),_l=Matrix$1.rowVector(ra),gl=Math.sqrt(dotVect(wl.mmul(ol).mmul(hl).to1DArray(),ta)/dotVect(_l.mmul(ol).mmul(hl).to1DArray(),ra));return gl===0||Xn===0?(cn=Math.ceil(nn),hn=Math.ceil(ln)):gl<Xn?(cn=Math.ceil(nn),hn=Math.ceil(cn/gl)):(hn=Math.ceil(ln),cn=Math.ceil(gl*hn)),[cn,hn]}function projectionPoint(qe,f,ze,Ke,Qe,Pi,nn,ln,cn,hn,un,zn){let[Xn,Un]=[(ze*qe+Ke*f+Qe)/(cn*qe+hn*f+1),(Pi*qe+nn*f+ln)/(cn*qe+hn*f+1)];return un.getValueXY(Math.floor(Xn),Math.floor(Un),zn)}function warpingFourPoints(qe,f={}){let{calculateRatio:ze=!0}=f;if(qe.length!==4)throw new Error(`The array pts must have four elements, which are the four corners. Currently, pts have ${qe.length} elements`);let[Ke,Qe,Pi,nn]=qe,ln=[Ke,Qe,Pi,nn],[cn,hn,un,zn]=order4Points(ln),Xn,Un;ze?[Xn,Un]=computeWidthAndHeigth(cn,hn,un,zn,this.width,this.height):(Xn=Math.ceil(Math.max(distance2Points(cn,hn),distance2Points(zn,un))),Un=Math.ceil(Math.max(distance2Points(cn,zn),distance2Points(hn,un))));let qn=Image$1.createFrom(this,{width:Xn,height:Un}),[ys,vs]=cn,[ea,na]=hn,[ta,ra]=un,[oa,fa]=zn,[ca,la]=[0,0],[ua,ga]=[0,Xn-1],[da,qa]=[Un-1,Xn-1],[tl,ol]=[Un-1,0],hl=new Matrix$1([[ca,la,1,0,0,0,-ca*ys,-la*ys],[ua,ga,1,0,0,0,-ua*ea,-ga*ea],[da,qa,1,0,0,0,-da*ta,-la*ta],[tl,ol,1,0,0,0,-tl*oa,-ol*oa],[0,0,0,ca,la,1,-ca*vs,-la*vs],[0,0,0,ua,ga,1,-ua*na,-ga*na],[0,0,0,da,qa,1,-da*ra,-qa*ra],[0,0,0,tl,ol,1,-tl*fa,-ol*fa]]),wl=Matrix$1.columnVector([ys,ea,ta,oa,vs,na,ra,fa]),gl=new SingularValueDecomposition(hl).solve(wl),[dl,sl,kl,pl,Al,xl,al,Fl]=gl.to1DArray(),Ol=new Matrix$1(Un,Xn);for(let Jo=0;Jo<this.channels;Jo++){for(let cl=0;cl<Un;cl++)for(let rl=0;rl<Xn;rl++)Ol.set(cl,rl,projectionPoint(cl,rl,dl,sl,kl,pl,Al,xl,al,Fl,this,Jo));qn.setMatrix(Ol,{channel:Jo})}return qn}function crop(qe={}){let{x:f=0,y:ze=0,width:Ke=this.width-f,height:Qe=this.height-ze}=qe;if(this.checkProcessable("crop",{bitDepth:[1,8,16]}),f=Math.round(f),ze=Math.round(ze),Ke=Math.round(Ke),Qe=Math.round(Qe),f>this.width-1||ze>this.height-1)throw new RangeError(`crop: origin (x:${f}, y:${ze}) out of range (${this.width-1}; ${this.height-1})`);if(Ke<=0||Qe<=0)throw new RangeError(`crop: width and height (width:${Ke}; height:${Qe}) must be positive numbers`);if(f<0||ze<0)throw new RangeError(`crop: x and y (x:${f}, y:${ze}) must be positive numbers`);if(Ke>this.width-f||Qe>this.height-ze)throw new RangeError(`crop: (x: ${f}, y:${ze}, width:${Ke}, height:${Qe}) size is out of range`);let Pi=this;if(this.bitDepth===1){const nn=new Image$1(Ke,Qe,{kind:"BINARY",parent:this});Pi=cropBinary(this,nn,f,ze,Ke,Qe)}else{const nn=Image$1.createFrom(this,{width:Ke,height:Qe,position:[f,ze]});Pi=cropDefault(this,nn,f,ze,Ke,Qe)}return Pi}function cropDefault(qe,f,ze,Ke,Qe,Pi){let nn=Qe*qe.channels,ln=Ke+Pi,cn=0,hn=ze*qe.channels;for(let un=Ke;un<ln;un++){let zn=un*qe.width*qe.channels+hn,Xn=zn+nn;for(;zn<Xn;zn++)f.data[cn++]=qe.data[zn]}return f}function cropBinary(qe,f,ze,Ke,Qe,Pi){let nn=Qe*qe.channels,ln=Ke+Pi,cn=0,hn=ze*qe.channels;for(let un=Ke;un<ln;un++){let zn=un*qe.width*qe.channels+hn,Xn=zn+nn;for(;zn<Xn;zn++)qe.getBit(zn)&&f.setBit(cn),++cn}return f}function cropAlpha(qe={}){this.checkProcessable("cropAlpha",{alpha:1});const{threshold:f=this.maxValue}=qe;let ze=findLeft(this,f,this.components);if(ze===-1)throw new Error("Could not find new dimensions. Threshold may be too high.");let Ke=findTop(this,f,this.components,ze),Qe=findBottom(this,f,this.components,ze),Pi=findRight(this,f,this.components,ze,Ke,Qe);return this.crop({x:ze,y:Ke,width:Pi-ze+1,height:Qe-Ke+1})}function findLeft(qe,f,ze){for(let Ke=0;Ke<qe.width;Ke++)for(let Qe=0;Qe<qe.height;Qe++)if(qe.getValueXY(Ke,Qe,ze)>=f)return Ke;return-1}function findTop(qe,f,ze,Ke){for(let Qe=0;Qe<qe.height;Qe++)for(let Pi=Ke;Pi<qe.width;Pi++)if(qe.getValueXY(Pi,Qe,ze)>=f)return Qe;return-1}function findBottom(qe,f,ze,Ke){for(let Qe=qe.height-1;Qe>=0;Qe--)for(let Pi=Ke;Pi<qe.width;Pi++)if(qe.getValueXY(Pi,Qe,ze)>=f)return Qe;return-1}function findRight(qe,f,ze,Ke,Qe,Pi){for(let nn=qe.width-1;nn>=Ke;nn--)for(let ln=Qe;ln<=Pi;ln++)if(qe.getValueXY(nn,ln,ze)>=f)return nn;return-1}function getFactor(qe){if(typeof qe=="string"){const f=qe[qe.length-1];qe=parseFloat(qe),f==="%"&&(qe/=100)}return qe}function getThreshold$1(qe,f){if(!f)throw Error("getThreshold : the maxValue should be specified");if(typeof qe=="string"){if(qe[qe.length-1]!=="%")throw Error("getThreshold : if the value is a string it must finish by %");return parseFloat(qe)/100*f}else{if(typeof qe=="number")return qe<1?qe*f:qe;throw Error("getThreshold : the value is not valid")}}function factorDimensions(qe,f,ze){qe=getFactor(qe);let Ke=Math.round(qe*f),Qe=Math.round(qe*ze);return Ke<=0&&(Ke=1),Qe<=0&&(Qe=1),{width:Ke,height:Qe}}function checkRow(qe,f){if(f<0||f>=qe.height)throw new RangeError(`row must be included between 0 and ${qe.height-1}. Current value: ${f}`)}function checkColumn(qe,f){if(f<0||f>=qe.width)throw new RangeError(`column must be included between 0 and ${qe.width-1}. Current value: ${f}`)}function checkChannel(qe,f){if(f<0||f>=qe.channels)throw new RangeError(`channel must be included between 0 and ${qe.channels-1}. Current value: ${f}`)}const validInterpolations={nearestneighbor:"nearestNeighbor",nearestneighbour:"nearestNeighbor",bilinear:"bilinear"};function checkInterpolation(qe){if(typeof qe!="string")throw new TypeError("interpolation must be a string");if(qe=qe.toLowerCase(),!validInterpolations[qe])throw new RangeError(`invalid interpolation algorithm: ${qe}`);return validInterpolations[qe]}function nearestNeighbor(qe,f,ze){const Ke=this.width/f,Qe=this.height/ze;if(this.bitDepth>1)for(let Pi=0;Pi<f;Pi++){const nn=Math.floor((Pi+.5)*Ke);for(let ln=0;ln<ze;ln++){const cn=Math.floor((ln+.5)*Qe);for(let hn=0;hn<this.channels;hn++)qe.setValueXY(Pi,ln,hn,this.getValueXY(nn,cn,hn))}}else for(let Pi=0;Pi<f;Pi++){const nn=Math.floor((Pi+.5)*Ke);for(let ln=0;ln<ze;ln++){const cn=Math.floor((ln+.5)*Qe);this.getBitXY(nn,cn)&&qe.setBitXY(Pi,ln)}}}function resize(qe={}){const{factor:f=1,interpolation:ze=validInterpolations.nearestneighbor,preserveAspectRatio:Ke=!0}=qe,Qe=checkInterpolation(ze);let Pi=qe.width,nn=qe.height;if(Pi||(nn&&Ke?Pi=Math.round(nn*(this.width/this.height)):Pi=this.width),nn||(Ke?nn=Math.round(Pi*(this.height/this.width)):nn=this.height),{width:Pi,height:nn}=factorDimensions(f,Pi,nn),Pi===this.width&&nn===this.height){const un=this.clone();return un.position=[0,0],un}let ln=Math.round((this.width-Pi)/2),cn=Math.round((this.height-nn)/2);const hn=Image$1.createFrom(this,{width:Pi,height:nn,position:[ln,cn]});switch(Qe){case validInterpolations.nearestneighbor:nearestNeighbor.call(this,hn,Pi,nn);break;default:throw new Error(`unsupported resize interpolation: ${Qe}`)}return hn}function hsv(){this.checkProcessable("hsv",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let qe=Image$1.createFrom(this,{colorModel:HSV}),f=0,ze=this.data;for(let Ke=0;Ke<ze.length;Ke+=this.channels){let Qe=ze[Ke],Pi=ze[Ke+1],nn=ze[Ke+2],ln=Math.min(Qe,Pi,nn),cn=Math.max(Qe,Pi,nn),hn=cn-ln,un=0,zn=cn===0?0:hn/cn,Xn=cn;if(cn!==ln){switch(cn){case Qe:un=(Pi-nn)/hn+(Pi<nn?6:0);break;case Pi:un=(nn-Qe)/hn+2;break;case nn:un=(Qe-Pi)/hn+4;break;default:throw new Error("unreachable")}un/=6}qe.data[f++]=un*this.maxValue,qe.data[f++]=zn*this.maxValue,qe.data[f++]=Xn,this.alpha&&(qe.data[f++]=ze[Ke+3])}return qe}function hsl$1(){this.checkProcessable("hsl",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let qe=Image$1.createFrom(this,{colorModel:HSL}),f=Math.floor(this.maxValue/2),ze=0,Ke=this.data;for(let Qe=0;Qe<Ke.length;Qe+=this.channels){let Pi=Ke[Qe],nn=Ke[Qe+1],ln=Ke[Qe+2],cn=Math.max(Pi,nn,ln),hn=Math.min(Pi,nn,ln),un=0,zn=0,Xn=(cn+hn)/2;if(cn!==hn){let Un=cn-hn;switch(zn=Xn>f?Un/(2-cn-hn):Un/(cn+hn),cn){case Pi:un=(nn-ln)/Un+(nn<ln?6:0);break;case nn:un=(ln-Pi)/Un+2;break;case ln:un=(Pi-nn)/Un+4;break;default:throw new Error("unreachable")}un/=6}qe.data[ze++]=un*this.maxValue,qe.data[ze++]=zn*this.maxValue,qe.data[ze++]=Xn,this.alpha&&(qe.data[ze++]=Ke[Qe+3])}return qe}function cmyk(){this.checkProcessable("cmyk",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let qe=Image$1.createFrom(this,{components:4,colorModel:CMYK$1}),f=0,ze=this.data;for(let Ke=0;Ke<ze.length;Ke+=this.channels){let Qe=ze[Ke],Pi=ze[Ke+1],nn=ze[Ke+2],ln=Math.min(this.maxValue-Qe,this.maxValue-Pi,this.maxValue-nn),cn=(this.maxValue-Qe-ln)/(1-ln/this.maxValue),hn=(this.maxValue-Pi-ln)/(1-ln/this.maxValue),un=(this.maxValue-nn-ln)/(1-ln/this.maxValue);qe.data[f++]=Math.round(cn),qe.data[f++]=Math.round(hn),qe.data[f++]=Math.round(un),qe.data[f++]=Math.round(ln),this.alpha&&(qe.data[f++]=ze[Ke+3])}return qe}function rgba8(){return new Image$1(this.width,this.height,this.getRGBAData(),{kind:"RGBA",parent:this})}const methods$1={luma709(qe,f,ze){return qe*6966+f*23436+ze*2366>>15},luma601(qe,f,ze){return qe*9798+f*19235+ze*3735>>15},maximum(qe,f,ze){return Math.max(qe,f,ze)},minimum(qe,f,ze){return Math.min(qe,f,ze)},average(qe,f,ze){return(qe+f+ze)/3>>0},minmax(qe,f,ze){return(Math.max(qe,f,ze)+Math.min(qe,f,ze))/2},red(qe){return qe},green(qe,f){return f},blue(qe,f,ze){return ze},cyan(qe,f,ze,Ke){let Qe=methods$1.black(qe,f,ze,Ke);return(Ke.maxValue-qe-Qe)/(1-Qe/Ke.maxValue)>>0},magenta(qe,f,ze,Ke){let Qe=methods$1.black(qe,f,ze,Ke);return(Ke.maxValue-f-Qe)/(1-Qe/Ke.maxValue)>>0},yellow(qe,f,ze,Ke){let Qe=methods$1.black(qe,f,ze,Ke);return(Ke.maxValue-ze-Qe)/(1-Qe/Ke.maxValue)>>0},black(qe,f,ze,Ke){return Math.min(Ke.maxValue-qe,Ke.maxValue-f,Ke.maxValue-ze)},hue(qe,f,ze,Ke){let Qe=methods$1.min(qe,f,ze),Pi=methods$1.max(qe,f,ze);if(Pi===Qe)return 0;let nn=0,ln=Pi-Qe;switch(Pi){case qe:nn=(f-ze)/ln+(f<ze?6:0);break;case f:nn=(ze-qe)/ln+2;break;case ze:nn=(qe-f)/ln+4;break;default:throw new Error("unreachable")}return nn/6*Ke.maxValue>>0},saturation(qe,f,ze,Ke){let Qe=methods$1.min(qe,f,ze),Pi=methods$1.max(qe,f,ze),nn=Pi-Qe;return Pi===0?0:nn/Pi*Ke.maxValue},lightness(qe,f,ze){let Ke=methods$1.min(qe,f,ze);return(methods$1.max(qe,f,ze)+Ke)/2}};Object.defineProperty(methods$1,"luminosity",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"luminance",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"min",{enumerable:!1,value:methods$1.minimum});Object.defineProperty(methods$1,"max",{enumerable:!1,value:methods$1.maximum});Object.defineProperty(methods$1,"brightness",{enumerable:!1,value:methods$1.maximum});Object.keys(methods$1).forEach(qe=>{});function grey(qe={}){let{algorithm:f="luma709",keepAlpha:ze=!1,mergeAlpha:Ke=!0}=qe;if(typeof f!="string"&&typeof f!="function")throw new TypeError("algorithm must be a string or a function");this.checkProcessable("grey",{bitDepth:[8,16],alpha:[0,1]}),this.components===1&&(f="red"),ze&=this.alpha,Ke&=this.alpha,ze&&(Ke=!1);let Qe=getOutputImage(this,qe,{components:1,alpha:ze,colorModel:GREY$1}),Pi;if(typeof f=="function")Pi=f;else if(Pi=methods$1[f.toLowerCase()],!Pi)throw new Error(`unsupported grey algorithm: ${f}`);let nn=0;for(let ln=0;ln<this.data.length;ln+=this.channels)Ke?Qe.data[nn++]=clamp(Pi(this.data[ln],this.data[ln+1],this.data[ln+2],this)*this.data[ln+this.components]/this.maxValue,this):(Qe.data[nn++]=clamp(Pi(this.data[ln],this.data[ln+1],this.data[ln+2],this),this),Qe.alpha&&(Qe.data[nn++]=this.data[ln+this.components]));return Qe}function huang(qe){let f=0;for(let un=0;un<qe.length;un++)if(qe[un]!==0){f=un;break}let ze=qe.length-1;for(let un=qe.length-1;un>=f;un--)if(qe[un]!==0){ze=un;break}let Ke=1/(ze-f),Qe=new Array(qe.length),Pi=0,nn=0;for(let un=f;un<qe.length;un++)Pi+=un*qe[un],nn+=qe[un],Qe[un]=Pi/nn;let ln=new Array(qe.length);Pi=nn=0;for(let un=ze;un>0;un--)Pi+=un*qe[un],nn+=qe[un],ln[un-1]=Pi/nn;let cn=-1,hn=Number.MAX_VALUE;for(let un=0;un<qe.length;un++){let zn=0,Xn;for(let Un=0;Un<=un;Un++)Xn=1/(1+Ke*Math.abs(Un-Qe[un])),Xn<1e-6||Xn>.999999||(zn+=qe[Un]*(-Xn*Math.log(Xn)-(1-Xn)*Math.log(1-Xn)));for(let Un=un+1;Un<qe.length;Un++)Xn=1/(1+Ke*Math.abs(Un-ln[un])),Xn<1e-6||Xn>.999999||(zn+=qe[Un]*(-Xn*Math.log(Xn)-(1-Xn)*Math.log(1-Xn)));zn<hn&&(hn=zn,cn=un)}return cn}function intermodes(qe){let f=qe.slice(),ze=0;for(;!bimodalTest$1(f);){let Qe=0,Pi=0,nn=f[0];for(let ln=0;ln<qe.length-1;ln++)Qe=Pi,Pi=nn,nn=f[ln+1],f[ln]=(Qe+Pi+nn)/3;if(f[qe.length-1]=(Pi+nn)/3,ze++,ze>1e4)throw new Error("Intermodes Threshold not found after 10000 iterations")}let Ke=0;for(let Qe=1;Qe<qe.length-1;Qe++)f[Qe-1]<f[Qe]&&f[Qe+1]<f[Qe]&&(Ke+=Qe);return Math.floor(Ke/2)}function bimodalTest$1(qe){let f=!1,ze=0;for(let Ke=1;Ke<qe.length-1;Ke++)if(qe[Ke-1]<qe[Ke]&&qe[Ke+1]<qe[Ke]&&(ze++,ze>2))return!1;return ze===2&&(f=!0),f}function isodata(qe){let f,ze,Ke,Qe,Pi=0;for(let nn=1;nn<qe.length;nn++)if(qe[nn]>0){Pi=nn+1;break}for(;;){f=0,Ke=0;for(let nn=0;nn<Pi;nn++)Ke=Ke+qe[nn],f=f+qe[nn]*nn;Qe=0,ze=0;for(let nn=Pi+1;nn<qe.length;nn++)ze+=qe[nn],Qe+=qe[nn]*nn;if(Ke>0&&ze>0&&(f/=Ke,Qe/=ze,Pi===Math.round((f+Qe)/2)))break;if(Pi++,Pi>qe.length-2)throw new Error("Threshold not found")}return Pi}function li(qe,f){let ze,Ke,Qe,Pi,nn,ln,cn,hn,un,zn,Xn,Un;Xn=.5,zn=0;for(let qn=0;qn<qe.length;qn++)zn+=qn*qe[qn];zn/=f,cn=zn;do{ln=cn,ze=ln+.5|0,Ke=0,Pi=0;for(let qn=0;qn<=ze;qn++)Ke+=qn*qe[qn],Pi+=qe[qn];hn=Pi===0?0:Ke/Pi,Qe=0,nn=0;for(let qn=ze+1;qn<qe.length;qn++)Qe+=qn*qe[qn],nn+=qe[qn];un=nn===0?0:Qe/nn,Un=(hn-un)/(Math.log(hn)-Math.log(un)),Un<-Number.EPSILON?cn=Un-.5|0:cn=Un+.5|0}while(Math.abs(cn-ln)>Xn);return ze}function maxEntropy(qe,f){let ze=new Array(qe.length);for(let Xn=0;Xn<qe.length;Xn++)ze[Xn]=qe[Xn]/f;let Ke=new Array(qe.length),Qe=new Array(qe.length);Ke[0]=ze[0],Qe[0]=1-Ke[0];for(let Xn=1;Xn<qe.length;Xn++)Ke[Xn]=Ke[Xn-1]+ze[Xn],Qe[Xn]=1-Ke[Xn];let Pi=0;for(let Xn=0;Xn<qe.length;Xn++)if(Math.abs(Ke[Xn])>=Number.EPSILON){Pi=Xn;break}let nn=qe.length-1;for(let Xn=qe.length-1;Xn>=Pi;Xn--)if(Math.abs(Qe[Xn])>=Number.EPSILON){nn=Xn;break}let ln=-1,cn,hn=Number.MIN_VALUE,un,zn;for(let Xn=Pi;Xn<=nn;Xn++){un=0;for(let Un=0;Un<=Xn;Un++)qe[Un]!==0&&(un-=ze[Un]/Ke[Xn]*Math.log(ze[Un]/Ke[Xn]));zn=0;for(let Un=Xn+1;Un<qe.length;Un++)qe[Un]!==0&&(zn-=ze[Un]/Qe[Xn]*Math.log(ze[Un]/Qe[Xn]));cn=un+zn,hn<cn&&(hn=cn,ln=Xn)}return ln}function mean$1(qe,f){let ze=0;for(let Ke=0;Ke<qe.length;Ke++)ze+=Ke*qe[Ke];return Math.floor(ze/f)}function minError(qe,f){let ze,Ke=-2,Qe,Pi,nn,ln,cn,hn,un,zn,Xn,Un,qn,ys=0;for(let vs=0;vs<qe.length;vs++)ys+=vs*qe[vs];for(ys/=f,ze=ys;ze!==Ke;){let vs=sumA(qe,ze),ea=sumA(qe,qe.length-1),na=sumB(qe,ze),ta=sumB(qe,qe.length-1),ra=sumC(qe,ze),oa=sumC(qe,qe.length-1);if(Qe=na/vs,Pi=(ta-na)/(ea-vs),nn=vs/ea,ln=(ea-vs)/ea,cn=ra/vs-Qe*Qe,hn=(oa-ra)/(ea-vs)-Pi*Pi,un=1/cn-1/hn,zn=Qe/cn-Pi/hn,Xn=Qe*Qe/cn-Pi*Pi/hn+Math.log10(cn*(ln*ln)/(hn*(nn*nn))),Un=zn*zn-un*Xn,Un<0)return ze;Ke=ze,qn=(zn+Math.sqrt(Un))/un,isNaN(qn)?ze=Ke:ze=Math.floor(qn)}return ze}function sumA(qe,f){let ze=0;for(let Ke=0;Ke<=f;Ke++)ze+=qe[Ke];return ze}function sumB(qe,f){let ze=0;for(let Ke=0;Ke<=f;Ke++)ze+=Ke*qe[Ke];return ze}function sumC(qe,f){let ze=0;for(let Ke=0;Ke<=f;Ke++)ze+=Ke*Ke*qe[Ke];return ze}function minimum(qe){if(qe.length<2)return 0;let f=0,ze=-1,Ke=-1,Qe=new Array(qe.length);for(let Pi=0;Pi<qe.length;Pi++)Qe[Pi]=qe[Pi],qe[Pi]>0&&(Ke=Pi);for(;!bimodalTest(Qe);)if(Qe=smoothed(Qe),f++,f>1e4)return ze;return ze=minimumBetweenPeeks(Qe,Ke),ze}function smoothed(qe){let f=new Array(qe.length);for(let ze=1;ze<qe.length-1;ze++)f[ze]=(qe[ze-1]+qe[ze]+qe[ze+1])/3;return f[0]=(qe[0]+qe[1])/3,f[qe.length-1]=(qe[qe.length-2]+qe[qe.length-1])/3,f}function minimumBetweenPeeks(qe,f){let ze;for(let Ke=1;Ke<f;Ke++)if(qe[Ke-1]>qe[Ke]&&qe[Ke+1]>=qe[Ke]){ze=Ke;break}return ze}function bimodalTest(qe){let f=qe.length,ze=!1,Ke=0;for(let Qe=1;Qe<f-1;Qe++)if(qe[Qe-1]<qe[Qe]&&qe[Qe+1]<qe[Qe]&&(Ke++,Ke>2))return!1;return Ke===2&&(ze=!0),ze}function moments(qe,f){let ze=1,Ke=0,Qe=0,Pi=0,nn=0,ln,cn,hn,un,zn,Xn,Un=-1,qn=qe.length,ys=new Array(qn);for(let vs=0;vs<qn;vs++)ys[vs]=qe[vs]/f;for(let vs=0;vs<qn;vs++)Ke+=vs*ys[vs],Qe+=vs*vs*ys[vs],Pi+=vs*vs*vs*ys[vs];cn=ze*Qe-Ke*Ke,hn=(-Qe*Qe+Ke*Pi)/cn,un=(ze*-Pi+Qe*Ke)/cn,zn=.5*(-un-Math.sqrt(un*un-4*hn)),Xn=.5*(-un+Math.sqrt(un*un-4*hn)),ln=(Xn-Ke)/(Xn-zn);for(let vs=0;vs<qn;vs++)if(nn+=ys[vs],nn>ln){Un=vs;break}return Un}function otsu(qe,f){let ze=0,Ke=0,Qe=0,Pi=0,nn=0;for(let ln=0;ln<qe.length;ln++)nn+=ln*qe[ln];for(let ln=0;ln<qe.length;ln++){Ke=Ke+qe[ln];const cn=f-Ke;if(Ke===0||cn===0)continue;ze=ze+ln*qe[ln];const hn=(nn-ze)/cn,un=Ke*cn*(ze/Ke-hn)*(ze/Ke-hn);un>=Qe&&(Pi=ln,Qe=un)}return Pi}function percentile(qe){let f=-1,ze=.5,Ke=new Array(qe.length),Qe=partialSum(qe,qe.length-1),Pi=1;for(let nn=0;nn<qe.length;nn++)Ke[nn]=Math.abs(partialSum(qe,nn)/Qe-ze),Ke[nn]<Pi&&(Pi=Ke[nn],f=nn);return f}function partialSum(qe,f){let ze=0;for(let Ke=0;Ke<=f;Ke++)ze+=qe[Ke];return ze}function renyiEntropy(qe,f){let ze,Ke,Qe,Pi=new Array(qe.length),nn=new Array(qe.length),ln=new Array(qe.length),cn=0,hn=0,un=0,zn=0,Xn=0,Un=0,ys=1/(1-.5),ea=1/(1-2);for(let oa=0;oa<qe.length;oa++)Pi[oa]=qe[oa]/f;nn[0]=Pi[0],ln[0]=1-nn[0];for(let oa=1;oa<qe.length;oa++)nn[oa]=nn[oa-1]+Pi[oa],ln[oa]=1-nn[oa];Ke=0;for(let oa=0;oa<qe.length;oa++)if(Math.abs(nn[oa])>=Number.EPSILON){Ke=oa;break}Qe=qe.length-1;for(let oa=qe.length-1;oa>=Ke;oa--)if(Math.abs(ln[oa])>=Number.EPSILON){Qe=oa;break}for(let oa=Ke;oa<=Qe;oa++){let fa=0,ca=0,la=0;for(let hl=0;hl<=oa;hl++)qe[hl]!==0&&(fa-=Pi[hl]/nn[oa]*Math.log(Pi[hl]/nn[oa])),ca+=Math.sqrt(Pi[hl]/nn[oa]),la+=Pi[hl]*Pi[hl]/(nn[oa]*nn[oa]);let ua=0,ga=0,da=0;for(let hl=oa+1;hl<qe.length;hl++)qe[hl]!==0&&(ua-=Pi[hl]/ln[oa]*Math.log(Pi[hl]/ln[oa])),ga+=Math.sqrt(Pi[hl]/ln[oa]),da+=Pi[hl]*Pi[hl]/(ln[oa]*ln[oa]);let qa=fa+ua,tl=ys*(ca*ga>0?Math.log(ca*ga):0),ol=ea*(la*da>0?Math.log(la*da):0);qa>zn&&(zn=qa,cn=oa),tl>Xn&&(Xn=tl,hn=oa),ol>Un&&(Un=ol,un=oa)}let na=[cn,hn,un];na.sort((oa,fa)=>oa-fa);let ta;Math.abs(na[0]-na[1])<=5?Math.abs(na[1]-na[2])<=5?ta=[1,2,1]:ta=[0,1,3]:Math.abs(na[1]-na[2])<=5?ta=[3,1,0]:ta=[1,2,1];let ra=nn[na[2]]-nn[na[0]];return ze=Math.round(na[0]*(nn[na[0]]+.25*ra*ta[0])+.25*na[1]*ra*ta[1]+na[2]*(ln[na[2]]+.25*ra*ta[2])),ze}function shanbhag(qe,f){let ze=new Array(qe.length);for(let Un=0;Un<qe.length;Un++)ze[Un]=qe[Un]/f;let Ke=new Array(qe.length),Qe=new Array(qe.length);Ke[0]=ze[0],Qe[0]=1-Ke[0];for(let Un=1;Un<qe.length;Un++)Ke[Un]=Ke[Un-1]+ze[Un],Qe[Un]=1-Ke[Un];let Pi=0;for(let Un=0;Un<qe.length;Un++)if(Math.abs(Ke[Un])>=Number.EPSILON){Pi=Un;break}let nn=qe.length-1;for(let Un=qe.length-1;Un>=Pi;Un--)if(Math.abs(Qe[Un])>=Number.EPSILON){nn=Un;break}let ln=-1,cn=Number.MAX_VALUE,hn,un,zn,Xn;for(let Un=Pi;Un<=nn;Un++){zn=0,hn=.5/Ke[Un];for(let qn=1;qn<=Un;qn++)zn-=ze[qn]*Math.log(1-hn*Ke[qn-1]);zn*=hn,Xn=0,hn=.5/Qe[Un];for(let qn=Un+1;qn<qe.length;qn++)Xn-=ze[qn]*Math.log(1-hn*Qe[qn]);Xn*=hn,un=Math.abs(zn-Xn),un<cn&&(cn=un,ln=Un)}return ln}function triangle$1(qe){let f=0,ze=0,Ke=0,Qe=0;for(let zn=0;zn<qe.length;zn++)if(qe[zn]>0){f=zn;break}f>0&&f--;for(let zn=qe.length-1;zn>0;zn--)if(qe[zn]>0){Qe=zn;break}Qe<qe.length-1&&Qe++;for(let zn=0;zn<qe.length;zn++)qe[zn]>ze&&(Ke=zn,ze=qe[zn]);let Pi=!1;if(Ke-f<Qe-Ke){Pi=!0;let zn=0,Xn=qe.length-1;for(;zn<Xn;){let Un=qe[zn];qe[zn]=qe[Xn],qe[Xn]=Un,zn++,Xn--}f=qe.length-1-Qe,Ke=qe.length-1-Ke}if(f===Ke)return f;let nn,ln,cn;nn=qe[Ke],ln=f-Ke,cn=Math.sqrt(nn*nn+ln*ln),nn/=cn,ln/=cn,cn=nn*f+ln*qe[f];let hn=f,un=0;for(let zn=f+1;zn<=Ke;zn++){let Xn=nn*zn+ln*qe[zn]-cn;Xn>un&&(hn=zn,un=Xn)}if(hn--,Pi){let zn=0,Xn=qe.length-1;for(;zn<Xn;){let Un=qe[zn];qe[zn]=qe[Xn],qe[Xn]=Un,zn++,Xn--}return qe.length-1-hn}else return hn}function yen(qe,f){let ze=new Array(qe.length);for(let hn=0;hn<qe.length;hn++)ze[hn]=qe[hn]/f;let Ke=new Array(qe.length);Ke[0]=ze[0];for(let hn=1;hn<qe.length;hn++)Ke[hn]=Ke[hn-1]+ze[hn];let Qe=new Array(qe.length);Qe[0]=ze[0]*ze[0];for(let hn=1;hn<qe.length;hn++)Qe[hn]=Qe[hn-1]+ze[hn]*ze[hn];let Pi=new Array(qe.length);Pi[qe.length-1]=0;for(let hn=qe.length-2;hn>=0;hn--)Pi[hn]=Pi[hn+1]+ze[hn+1]*ze[hn+1];let nn=-1,ln=Number.MIN_VALUE,cn;for(let hn=0;hn<qe.length;hn++)cn=-1*(Qe[hn]*Pi[hn]>0?Math.log(Qe[hn]*Pi[hn]):0)+2*(Ke[hn]*(1-Ke[hn])>0?Math.log(Ke[hn]*(1-Ke[hn])):0),cn>ln&&(ln=cn,nn=hn);return nn}const methods={huang,intermodes,isodata,li,maxentropy:maxEntropy,mean:mean$1,minerror:minError,minimum,moments,otsu,percentile,renyientropy:renyiEntropy,shanbhag,triangle:triangle$1,yen},names={};Object.keys(methods).forEach(qe=>{names[qe]=qe});function getThreshold(qe={}){let{algorithm:f=names.otsu}=qe;this.checkProcessable("getThreshold",{components:1,bitDepth:[8,16]});let ze=methods[f.toLowerCase()];if(ze){let Ke=this.getHistogram();return ze(Ke,this.size)}else throw new Error(`unknown thresholding algorithm: ${f}`)}const THRESHOLD="threshold";function mask(qe={}){let{algorithm:f=THRESHOLD,threshold:ze=.5,useAlpha:Ke=!0,invert:Qe=!1}=qe;this.checkProcessable("mask",{components:1,bitDepth:[8,16]}),f===THRESHOLD?ze=getThreshold$1(ze,this.maxValue):ze=getThreshold.call(this,qe);let Pi=new Image$1(this.width,this.height,{kind:"BINARY",parent:this}),nn=0;if(this.alpha&&Ke)for(let ln=0;ln<this.data.length;ln+=this.channels){let cn=this.data[ln]+(this.maxValue-this.data[ln])*(this.maxValue-this.data[ln+1])/this.maxValue;(Qe&&cn<=ze||!Qe&&cn>=ze)&&Pi.setBit(nn),nn++}else for(let ln=0;ln<this.data.length;ln+=this.channels)(Qe&&this.data[ln]<=ze||!Qe&&this.data[ln]>=ze)&&Pi.setBit(nn),nn++;return Pi}function copyImage(qe,f,ze,Ke){let Qe=qe.width,Pi=qe.height,nn=f.width,ln=qe.channels;for(let cn=0;cn<Qe;cn++)for(let hn=0;hn<Pi;hn++)for(let un=0;un<ln;un++){let zn=(hn*Qe+cn)*ln+un,Xn=((Ke+hn)*nn+ze+cn)*ln+un;f.data[Xn]=qe.data[zn]}}function pad(qe={}){let{size:f=0,algorithm:ze="copy",color:Ke}=qe;if(this.checkProcessable("pad",{bitDepth:[8,16]}),ze==="set"){if(Ke.length!==this.channels)throw new Error(`pad: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let cn=0;cn<Ke.length;cn++)Ke[cn]===0&&(Ke[cn]=.001)}else Ke=newArray(this.channels,null);Array.isArray(f)||(f=[f,f]);let Qe=this.width+f[0]*2,Pi=this.height+f[1]*2,nn=this.channels,ln=Image$1.createFrom(this,{width:Qe,height:Pi});copyImage(this,ln,f[0],f[1]);for(let cn=f[0];cn<Qe-f[0];cn++)for(let hn=0;hn<nn;hn++){let un=Ke[hn]||ln.data[(f[1]*Qe+cn)*nn+hn];for(let zn=0;zn<f[1];zn++)ln.data[(zn*Qe+cn)*nn+hn]=un;un=Ke[hn]||ln.data[((Pi-f[1]-1)*Qe+cn)*nn+hn];for(let zn=Pi-f[1];zn<Pi;zn++)ln.data[(zn*Qe+cn)*nn+hn]=un}for(let cn=0;cn<Pi;cn++)for(let hn=0;hn<nn;hn++){let un=Ke[hn]||ln.data[(cn*Qe+f[0])*nn+hn];for(let zn=0;zn<f[0];zn++)ln.data[(cn*Qe+zn)*nn+hn]=un;un=Ke[hn]||ln.data[(cn*Qe+Qe-f[0]-1)*nn+hn];for(let zn=Qe-f[0];zn<Qe;zn++)ln.data[(cn*Qe+zn)*nn+hn]=un}return ln}function colorDepth(qe=8){if(this.checkProcessable("colorDepth",{bitDepth:[1,8,16]}),![8,16].includes(qe))throw Error("You need to specify the new colorDepth as 8 or 16");if(this.bitDepth===qe)return this.clone();let f=Image$1.createFrom(this,{bitDepth:qe});switch(qe){case 8:if(this.bitDepth===1)for(let ze=0;ze<this.size;ze++)this.getBit(ze)&&(f.data[ze]=255);else for(let ze=0;ze<this.data.length;ze++)f.data[ze]=this.data[ze]>>8;break;case 16:if(this.bitDepth===1)for(let ze=0;ze<this.size;ze++)this.getBit(ze)&&(f.data[ze]=65535);else for(let ze=0;ze<this.data.length;ze++)f.data[ze]=this.data[ze]<<8|this.data[ze];break;default:throw new Error("colorDepth conversion unexpected case")}return f}function rotateFree(qe,f={}){const{interpolation:ze=validInterpolations.nearestneighbor,width:Ke=this.width,height:Qe=this.height}=f;if(typeof qe!="number")throw new TypeError("degrees must be a number");const Pi=checkInterpolation(ze),nn=qe*Math.PI/180,ln=Math.floor(Math.abs(Ke*Math.cos(nn))+Math.abs(Qe*Math.sin(nn))),cn=Math.floor(Math.abs(Qe*Math.cos(nn))+Math.abs(Ke*Math.sin(nn))),hn=Math.cos(-nn),un=Math.sin(-nn);let zn=ln/2,Xn=cn/2;ln%2===0?(zn=zn-.5,cn%2===0?Xn=Xn-.5:Xn=Math.floor(Xn)):(zn=Math.floor(zn),cn%2===0?Xn=Xn-.5:Xn=Math.floor(Xn));const Un=Math.floor(Ke/2-zn),qn=Math.floor(Qe/2-Xn);if(this.bitDepth===1){const ys=new Image$1(ln,cn,{kind:"BINARY",parent:this});switch(Pi){case validInterpolations.nearestneighbor:return rotateBinaryNearestNeighbor(this,ys,Un,qn,zn,Xn,hn,un);case validInterpolations.bilinear:return rotateBinaryBilinear(this,ys,Un,qn,zn,Xn,hn,un);default:throw new Error(`unsupported rotate interpolation: ${Pi}`)}}else{const ys=Image$1.createFrom(this,{width:ln,height:cn});switch(Pi){case validInterpolations.nearestneighbor:return rotateNearestNeighbor(this,ys,Un,qn,zn,Xn,hn,un);case validInterpolations.bilinear:return rotateBilinear(this,ys,Un,qn,zn,Xn,hn,un);default:throw new Error(`unsupported rotate interpolation: ${Pi}`)}}}function rotateNearestNeighbor(qe,f,ze,Ke,Qe,Pi,nn,ln){for(let cn=0;cn<f.width;cn+=1)for(let hn=0;hn<f.height;hn+=1)for(let un=0;un<qe.channels;un++){let zn=Math.round((cn-Qe)*nn-(hn-Pi)*ln+Qe)+ze,Xn=Math.round((hn-Pi)*nn+(cn-Qe)*ln+Pi)+Ke;zn<0||zn>=qe.width||Xn<0||Xn>=qe.height?qe.alpha===1&&un===qe.channels-1?f.setValueXY(cn,hn,un,0):f.setValueXY(cn,hn,un,qe.maxValue):f.setValueXY(cn,hn,un,qe.getValueXY(zn,Xn,un))}return f}function rotateBinaryNearestNeighbor(qe,f,ze,Ke,Qe,Pi,nn,ln){for(let cn=0;cn<f.width;cn+=1)for(let hn=0;hn<f.height;hn+=1){let un=Math.round((cn-Qe)*nn-(hn-Pi)*ln+Qe)+ze,zn=Math.round((hn-Pi)*nn+(cn-Qe)*ln+Pi)+Ke;(un<0||un>=qe.width||zn<0||zn>=qe.height||qe.getBitXY(un,zn))&&f.setBitXY(cn,hn)}return f}function rotateBilinear(qe,f,ze,Ke,Qe,Pi,nn,ln){let cn=qe.width*qe.channels;for(let hn=0;hn<f.height;hn++)for(let un=0;un<f.width;un++){let zn=(un-Qe)*nn-(hn-Pi)*ln+Qe+ze,Xn=(hn-Pi)*nn+(un-Qe)*ln+Pi+Ke,Un=zn|0,qn=Xn|0,ys=zn-Un,vs=Xn-qn;for(let ea=0;ea<qe.channels;ea++)if(zn<0||zn>=qe.width||Xn<0||Xn>=qe.height)qe.alpha===1&&ea===qe.channels-1?f.setValueXY(un,hn,ea,0):f.setValueXY(un,hn,ea,qe.maxValue);else{let na=(qn*qe.width+Un)*qe.channels+ea,ta=qe.data[na],ra=qe.data[na+qe.channels],oa=qe.data[na+cn],fa=qe.data[na+cn+qe.channels],ca=ta+ys*(ra-ta)+vs*(oa-ta)+ys*vs*(ta-ra-oa+fa)|0;f.setValueXY(un,hn,ea,ca)}}return f}function rotateBinaryBilinear(qe,f,ze,Ke,Qe,Pi,nn,ln){let cn=qe.width;for(let hn=0;hn<f.height;hn++)for(let un=0;un<f.width;un++){let zn=(un-Qe)*nn-(hn-Pi)*ln+Qe+ze,Xn=(hn-Pi)*nn+(un-Qe)*ln+Pi+Ke,Un=zn|0,qn=Xn|0,ys=zn-Un,vs=Xn-qn;if(zn<0||zn>=qe.width||Xn<0||Xn>=qe.height)f.setBitXY(un,hn);else{let ea=qn*qe.width+Un,na=qe.getBit(ea),ta=qe.getBit(ea+1),ra=qe.getBit(ea+cn),oa=qe.getBit(ea+1+cn);(na|ys&ta-na|vs&ra-na|ys&vs&na-ta-ra+oa)>0&&f.setBitXY(un,hn)}}return f}function rotate$1(qe,f){if(this.checkProcessable("rotate",{bitDepth:[1,8,16]}),typeof qe!="number")throw new TypeError("angle must be a number");switch(qe<0&&(qe=Math.ceil(-qe/360)*360+qe),qe%360){case 0:return this.clone();case 90:return rotateRight.call(this);case 180:return rotate180.call(this);case 270:return rotateLeft.call(this);default:return rotateFree.call(this,qe,f)}}function rotateLeft(){if(this.bitDepth===1){const qe=new Image$1(this.height,this.width,{kind:"BINARY",parent:this}),f=qe.height-1;for(let ze=0;ze<this.height;ze++)for(let Ke=0;Ke<this.width;Ke++)this.getBitXY(Ke,ze)&&qe.setBitXY(ze,f-Ke);return qe}else{const qe=Image$1.createFrom(this,{width:this.height,height:this.width}),f=qe.height-1;for(let ze=0;ze<this.height;ze++)for(let Ke=0;Ke<this.width;Ke++)for(let Qe=0;Qe<this.channels;Qe++)qe.setValueXY(ze,f-Ke,Qe,this.getValueXY(Ke,ze,Qe));return qe}}function rotateRight(){if(this.bitDepth===1){const qe=new Image$1(this.height,this.width,{kind:"BINARY",parent:this}),f=qe.width-1;for(let ze=0;ze<this.height;ze++)for(let Ke=0;Ke<this.width;Ke++)this.getBitXY(Ke,ze)&&qe.setBitXY(f-ze,Ke);return qe}else{const qe=Image$1.createFrom(this,{width:this.height,height:this.width}),f=qe.width-1;for(let ze=0;ze<this.height;ze++)for(let Ke=0;Ke<this.width;Ke++)for(let Qe=0;Qe<this.channels;Qe++)qe.setValueXY(f-ze,Ke,Qe,this.getValueXY(Ke,ze,Qe));return qe}}function rotate180(){if(this.bitDepth===1){const qe=new Image$1(this.width,this.height,{kind:"BINARY",parent:this}),f=qe.width-1,ze=qe.height-1;for(let Ke=0;Ke<this.height;Ke++)for(let Qe=0;Qe<this.width;Qe++)this.getBitXY(Qe,Ke)&&qe.setBitXY(f-Qe,ze-Ke);return qe}else{const qe=Image$1.createFrom(this),f=qe.width-1,ze=qe.height-1;for(let Ke=0;Ke<this.height;Ke++)for(let Qe=0;Qe<this.width;Qe++)for(let Pi=0;Pi<this.channels;Pi++)qe.setValueXY(f-Qe,ze-Ke,Pi,this.getValueXY(Qe,Ke,Pi));return qe}}function insert(qe,f={}){const ze=getImageParameters(qe);this.checkProcessable("insert",ze);let{x:Ke=0,y:Qe=0}=f;const Pi=getOutputImageOrInPlace(this,f,{copy:!0}),nn=Math.min(Pi.height,Qe+qe.height),ln=Math.min(Pi.width,Ke+qe.width);if(Pi.bitDepth===1)for(let cn=Qe;cn<nn;cn++)for(let hn=Ke;hn<ln;hn++)qe.getBitXY(hn-Ke,cn-Qe)?Pi.setBitXY(hn,cn):Pi.clearBitXY(hn,cn);else for(let cn=Qe;cn<nn;cn++)for(let hn=Ke;hn<ln;hn++)Pi.setPixelXY(hn,cn,qe.getPixelXY(hn-Ke,cn-Qe));return Pi}function setBorder(qe={}){let{size:f=0,algorithm:ze="copy",color:Ke}=qe;if(this.checkProcessable("setBorder",{bitDepth:[8,16,32,64]}),ze==="set"){if(Ke.length!==this.channels)throw new Error(`setBorder: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let ln=0;ln<Ke.length;ln++)Ke[ln]===0&&(Ke[ln]=.001)}else Ke=newArray(this.channels,null);Array.isArray(f)||(f=[f,f]);let Qe=f[0],Pi=f[1],nn=this.channels;for(let ln=Qe;ln<this.width-Qe;ln++)for(let cn=0;cn<nn;cn++){let hn=Ke[cn]||this.data[(ln+this.width*Pi)*nn+cn];for(let un=0;un<Pi;un++)this.data[(un*this.width+ln)*nn+cn]=hn;hn=Ke[cn]||this.data[(ln+this.width*(this.height-Pi-1))*nn+cn];for(let un=this.height-Pi;un<this.height;un++)this.data[(un*this.width+ln)*nn+cn]=hn}for(let ln=0;ln<this.height;ln++)for(let cn=0;cn<nn;cn++){let hn=Ke[cn]||this.data[(ln*this.width+Qe)*nn+cn];for(let un=0;un<Qe;un++)this.data[(ln*this.width+un)*nn+cn]=hn;hn=Ke[cn]||this.data[(ln*this.width+this.width-Qe-1)*nn+cn];for(let un=this.width-Qe;un<this.width;un++)this.data[(ln*this.width+un)*nn+cn]=hn}return this}function split(qe={}){let{preserveAlpha:f=!0}=qe;if(this.checkProcessable("split",{bitDepth:[8,16]}),this.components===1)return new Stack([this.clone()]);let ze=new Stack,Ke=this.data;if(this.alpha&&f)for(let Qe=0;Qe<this.components;Qe++){let Pi=Image$1.createFrom(this,{components:1,alpha:!0,colorModel:GREY$1}),nn=0;for(let ln=0;ln<Ke.length;ln+=this.channels)Pi.data[nn++]=Ke[ln+Qe],Pi.data[nn++]=Ke[ln+this.components];ze.push(Pi)}else for(let Qe=0;Qe<this.channels;Qe++){let Pi=Image$1.createFrom(this,{components:1,alpha:!1,colorModel:GREY$1}),nn=0;for(let ln=0;ln<Ke.length;ln+=this.channels)Pi.data[nn++]=Ke[ln+Qe];ze.push(Pi)}return ze}function getChannel(qe,f={}){let{keepAlpha:ze=!1,mergeAlpha:Ke=!1}=f;ze&=this.alpha,Ke&=this.alpha,this.checkProcessable("getChannel",{bitDepth:[8,16]}),qe=validateChannel(this,qe);let Qe=Image$1.createFrom(this,{components:1,alpha:ze,colorModel:GREY$1}),Pi=0;for(let nn=0;nn<this.data.length;nn+=this.channels)Ke?Qe.data[Pi++]=this.data[nn+qe]*this.data[nn+this.components]/this.maxValue:(Qe.data[Pi++]=this.data[nn+qe],ze&&(Qe.data[Pi++]=this.data[nn+this.components]));return Qe}function combineChannels(qe=defaultCombineMethod,f={}){let{mergeAlpha:ze=!1,keepAlpha:Ke=!1}=f;ze&=this.alpha,Ke&=this.alpha,this.checkProcessable("combineChannels",{bitDepth:[8,16]});let Qe=Image$1.createFrom(this,{components:1,alpha:Ke,colorModel:GREY$1}),Pi=0;for(let nn=0;nn<this.size;nn++){let ln=qe(this.getPixel(nn));ze?Qe.data[Pi++]=ln*this.data[nn*this.channels+this.components]/this.maxValue:(Qe.data[Pi++]=ln,Ke&&(Qe.data[Pi++]=this.data[nn*this.channels+this.components]))}return Qe}function defaultCombineMethod(qe){return(qe[0]+qe[1]+qe[2])/3}function setChannel(qe,f){if(this.checkProcessable("setChannel",{bitDepth:[8,16]}),f.checkProcessable("setChannel (image parameter check)",{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),f.width!==this.width||f.height!==this.height)throw new Error("Images must have exactly the same width and height");qe=validateChannel(this,qe);let ze=qe;for(let Ke=0;Ke<f.data.length;Ke++)this.data[ze]=f.data[Ke],ze+=this.channels;return this}function getSimilarity(qe,f={}){let{shift:ze=[0,0],average:Ke,channels:Qe,defaultAlpha:Pi,normalize:nn,border:ln=[0,0]}=f;if(this.checkProcessable("getSimilarity",{bitDepth:[8,16]}),Array.isArray(ln)||(ln=[ln,ln]),Qe=validateArrayOfChannels(this,{channels:Qe,defaultAlpha:Pi}),this.bitDepth!==qe.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==qe.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==qe.colorModel)throw new Error("Both images must have the same colorModel");typeof Ke>"u"&&(Ke=!0);let cn=Math.max(ln[0],-ze[0]),hn=Math.min(this.width-ln[0],this.width-ze[0]),un=Math.max(ln[1],-ze[1]),zn=Math.min(this.height-ln[1],this.height-ze[1]),Xn=newArray(Qe.length,0);for(let Un=0;Un<Qe.length;Un++){let qn=Qe[Un],ys=nn?this.sum[qn]:Math.max(this.sum[qn],qe.sum[qn]),vs=nn?qe.sum[qn]:Math.max(this.sum[qn],qe.sum[qn]);if(ys!==0&&vs!==0)for(let ea=cn;ea<hn;ea++)for(let na=un;na<zn;na++){let ta=ea*this.multiplierX+na*this.multiplierY+qn,ra=ta+ze[0]*this.multiplierX+ze[1]*this.multiplierY;Xn[Un]+=Math.min(this.data[ta]/ys,qe.data[ra]/vs)}}return Ke?Xn.reduce((Un,qn)=>Un+qn)/Xn.length:Xn}function getPixelsGrid(qe={}){let{sampling:f=[10,10],painted:ze=!1,mask:Ke}=qe;this.checkProcessable("getPixelsGrid",{bitDepth:[8,16],channels:1}),Array.isArray(f)||(f=[f,f]);const Qe=f[0],Pi=f[1],nn=[],ln=[],cn=this.width/Qe,hn=this.height/Pi;let un=Math.floor(cn/2);for(let Xn=0;Xn<Qe;Xn++){let Un=Math.floor(hn/2);for(let qn=0;qn<Pi;qn++){let ys=Math.round(un),vs=Math.round(Un);(!Ke||Ke.getBitXY(ys,vs))&&(nn.push([ys,vs]),ln.push(this.getPixelXY(ys,vs))),Un+=hn}un+=cn}const zn={xyS:nn,zS:ln};return ze&&(zn.painted=this.rgba8().paintPoints(nn)),zn}function Matrix(qe,f,ze){const Ke=new Array(qe);for(let Qe=0;Qe<qe;Qe++)Ke[Qe]=new Array(f);if(ze)for(let Qe=0;Qe<qe;Qe++)for(let Pi=0;Pi<f;Pi++)Ke[Qe][Pi]=ze;return Ke.width=qe,Ke.height=f,Object.setPrototypeOf(Ke,Matrix.prototype),Ke}Matrix.prototype.localMin=function(qe,f){let ze=this[qe][f],Ke=[qe,f];for(let Qe=Math.max(0,qe-1);Qe<Math.min(this.length,qe+2);Qe++)for(let Pi=Math.max(0,f-1);Pi<Math.min(this[0].length,f+2);Pi++)this[Qe][Pi]<ze&&(ze=this[Qe][Pi],Ke=[Qe,Pi]);return{position:Ke,value:ze}};Matrix.prototype.localMax=function(qe,f){let ze=this[qe][f],Ke=[qe,f];for(let Qe=Math.max(0,qe-1);Qe<Math.min(this.length,qe+2);Qe++)for(let Pi=Math.max(0,f-1);Pi<Math.min(this[0].length,f+2);Pi++)this[Qe][Pi]>ze&&(ze=this[Qe][Pi],Ke=[Qe,Pi]);return{position:Ke,value:ze}};Matrix.prototype.localSearch=function(qe,f,ze){let Ke=[];for(let Qe=Math.max(0,qe-1);Qe<Math.min(this.length,qe+2);Qe++)for(let Pi=Math.max(0,f-1);Pi<Math.min(this[0].length,f+2);Pi++)this[Qe][Pi]===ze&&Ke.push([Qe,Pi]);return Ke};function getBestMatch(qe,f={}){let{border:ze}=f;if(this.checkProcessable("getChannel",{bitDepth:[8,16]}),this.bitDepth!==qe.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==qe.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==qe.colorModel)throw new Error("Both images must have the same colorModel");let Ke=new Matrix(qe.width,qe.height,-1/0),Qe=Math.floor(qe.width/2),Pi=Math.floor(qe.height/2),nn=Qe,ln=Pi,cn=!1;for(;!cn;){let hn=Ke.localSearch(Qe,Pi,-1/0);for(let zn=0;zn<hn.length;zn++){let Xn=hn[zn],Un=this.getSimilarity(qe,{border:ze,shift:[nn-Xn[0],ln-Xn[1]]});Ke[Xn[0]][Xn[1]]=Un}let un=Ke.localMax(Qe,Pi);un.position[0]!==Qe||un.position[1]!==Pi?(Qe=un.position[0],Pi=un.position[1]):cn=!0}return[Qe-nn,Pi-ln]}function getRow(qe,f=0){this.checkProcessable("getRow",{bitDepth:[8,16]}),checkRow(this,qe),checkChannel(this,f);let ze=new Array(this.width),Ke=0,Qe=qe*this.width*this.channels+f,Pi=Qe+this.width*this.channels;for(let nn=Qe;nn<Pi;nn+=this.channels)ze[Ke++]=this.data[nn];return ze}function getColumn(qe,f=0){this.checkProcessable("getColumn",{bitDepth:[8,16]}),checkColumn(this,qe),checkChannel(this,f);let ze=new Array(this.height),Ke=0,Qe=this.width*this.channels;for(let Pi=f+qe*this.channels;Pi<this.data.length;Pi+=Qe)ze[Ke++]=this.data[Pi];return ze}function getMatrix(qe={}){let{channel:f}=qe;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),f===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");f=0}let ze=new Matrix$1(this.height,this.width);for(let Ke=0;Ke<this.height;Ke++)for(let Qe=0;Qe<this.width;Qe++)ze.set(Ke,Qe,this.getValueXY(Qe,Ke,f));return ze}function setMatrix(qe,f={}){qe=new Matrix$1(qe);let{channel:ze}=f;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),ze===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");ze=0}if(this.width!==qe.columns||this.height!==qe.rows)throw new RangeError("The size of the matrix must be equal to the size of the image");for(let Ke=0;Ke<this.height;Ke++)for(let Qe=0;Qe<this.width;Qe++)this.setValueXY(Qe,Ke,ze,qe.get(Ke,Qe));return this}function getPixelsArray(){this.checkProcessable("getPixelsArray",{bitDepth:[8,16,32]});let qe=new Array(this.size),f=0;for(let ze=0;ze<this.data.length;ze+=this.channels){let Ke=new Array(this.components);for(let Qe=0;Qe<this.components;Qe++)Ke[Qe]=this.data[ze+Qe];qe[f++]=Ke}return qe}function getIntersection(qe){let f=this,ze=f.getClosestCommonParent(qe),Ke=f.getRelativePosition(ze,{defaultFurther:!0}),Qe=getRelativePositionForAllPixels(f,Ke),Pi=qe.getRelativePosition(ze,{defaultFurther:!0}),nn=getRelativePositionForAllPixels(qe,Pi),ln=getCommonSurface(Qe,nn),cn={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]};for(let hn=0;hn<ln.length;hn++){let un=ln[hn],zn=[un[0]-Ke[0],un[1]-Ke[1]],Xn=[un[0]-Pi[0],un[1]-Pi[1]],Un=f.getBitXY(zn[0],zn[1]),qn=qe.getBitXY(Xn[0],Xn[1]);Un===1&&qn===1&&cn.commonWhitePixels.push(un)}for(let hn=0;hn<Qe.length;hn++){let un,zn;hn!==0&&(un=Math.floor(hn/f.width),zn=hn%f.width),f.getBitXY(un,zn)===1&&cn.whitePixelsMask1.push(Qe[hn])}for(let hn=0;hn<nn.length;hn++){let un=0,zn=0;hn!==0&&(un=Math.floor(hn/qe.width),zn=hn%qe.width),qe.getBitXY(un,zn)===1&&cn.whitePixelsMask2.push(nn[hn])}return cn}function getRelativePositionForAllPixels(qe,f){let ze=[];for(let Ke=0;Ke<qe.height;Ke++)for(let Qe=0;Qe<qe.width;Qe++){let Pi=[Ke,Qe];ze.push([Pi[0]+f[0],Pi[1]+f[1]])}return ze}function getCommonSurface(qe,f){let ze=0,Ke=0,Qe=[];for(;ze<qe.length&&Ke<f.length;)qe[ze][0]===f[Ke][0]&&qe[ze][1]===f[Ke][1]?(Qe.push(qe[ze]),ze++,Ke++):qe[ze][0]<f[Ke][0]||qe[ze][0]===f[Ke][0]&&qe[ze][1]<f[Ke][1]?ze++:Ke++;return Qe}function getClosestCommonParent(qe){let f=getDepth(this),ze=getDepth(qe),Ke;if(f>=ze?Ke=getFurthestParent(this,f):Ke=getFurthestParent(qe,ze),f===0||ze===0)return Ke;let Qe=this,Pi=qe;for(;f!==ze;)if(f>ze){if(Qe=Qe.parent,Qe===null)return Ke;f=f-1}else{if(Pi=Pi.parent,Pi===null)return Ke;ze=ze-1}for(;Qe!==Pi&&Qe!==null&&Pi!==null;)if(Qe=Qe.parent,Pi=Pi.parent,Qe===null||Pi===null)return Ke;return Qe!==Pi?Ke:Qe}function getDepth(qe){let f=0,ze=qe;for(;ze.parent!=null;)ze=ze.parent,f++;return f}function getFurthestParent(qe,f){let ze=qe;for(;f>0;)ze=ze.parent,f=f-1;return ze}const defaultOptions$1={lowThreshold:10,highThreshold:30,gaussianBlur:1.1},Gx=[[-1,0,1],[-2,0,2],[-1,0,1]],Gy=[[-1,-2,-1],[0,0,0],[1,2,1]],convOptions={bitDepth:32,mode:"periodic"};function cannyEdgeDetector(qe,f){qe.checkProcessable("Canny edge detector",{bitDepth:8,channels:1,components:1}),f=Object.assign({},defaultOptions$1,f);const ze=qe.width,Ke=qe.height,Qe=qe.maxValue,Pi={sigma:f.gaussianBlur,radius:3},nn=qe.gaussianFilter(Pi),ln=nn.convolution(Gy,convOptions),cn=nn.convolution(Gx,convOptions),hn=cn.hypotenuse(ln),un=qe.constructor,zn=new un(ze,Ke,{kind:"GREY",bitDepth:32}),Xn=new un(ze,Ke,{kind:"GREY",bitDepth:32}),Un=new un(ze,Ke,{kind:"GREY"});for(var qn=1;qn<ze-1;qn++)for(var ys=1;ys<Ke-1;ys++){var vs=(Math.round(Math.atan2(cn.getValueXY(qn,ys,0),ln.getValueXY(qn,ys,0))*(5/Math.PI))+5)%5;vs===0&&(hn.getValueXY(qn,ys,0)<=hn.getValueXY(qn,ys-1,0)||hn.getValueXY(qn,ys,0)<=hn.getValueXY(qn,ys+1,0))||vs===1&&(hn.getValueXY(qn,ys,0)<=hn.getValueXY(qn-1,ys+1,0)||hn.getValueXY(qn,ys,0)<=hn.getValueXY(qn+1,ys-1,0))||vs===2&&(hn.getValueXY(qn,ys,0)<=hn.getValueXY(qn-1,ys,0)||hn.getValueXY(qn,ys,0)<=hn.getValueXY(qn+1,ys,0))||vs===3&&(hn.getValueXY(qn,ys,0)<=hn.getValueXY(qn-1,ys-1,0)||hn.getValueXY(qn,ys,0)<=hn.getValueXY(qn+1,ys+1,0))||zn.setValueXY(qn,ys,0,hn.getValueXY(qn,ys,0))}for(qn=0;qn<ze*Ke;++qn){var ea=zn.data[qn],na=0;ea>f.highThreshold&&(na++,Un.data[qn]=Qe),ea>f.lowThreshold&&na++,Xn.data[qn]=na}var ta=[];for(qn=1;qn<ze-1;++qn)for(ys=1;ys<Ke-1;++ys)if(Xn.getValueXY(qn,ys,0)===1){e:for(var ra=qn-1;ra<qn+2;++ra)for(var oa=ys-1;oa<ys+2;++oa)if(Xn.getValueXY(ra,oa,0)===2){ta.push([qn,ys]),Un.setValueXY(qn,ys,0,Qe);break e}}for(;ta.length>0;){var fa=[];for(qn=0;qn<ta.length;++qn)for(ys=-1;ys<2;++ys)for(ra=-1;ra<2;++ra)if(!(ys===0&&ra===0)){var ca=ta[qn][0]+ys,la=ta[qn][1]+ra;Xn.getValueXY(ca,la,0)===1&&Un.getValueXY(ca,la,0)===0&&(fa.push([ca,la]),Un.setValueXY(ca,la,0,Qe))}ta=fa}return Un}function cannyEdge(qe){return cannyEdgeDetector(this,qe)}function extract(qe,f={}){let{position:ze}=f;if(this.checkProcessable("extract",{bitDepth:[1,8,16]}),!ze&&(ze=qe.getRelativePosition(this),!ze))throw new Error("extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].");if(this.bitDepth>1){let Ke=Image$1.createFrom(this,{width:qe.width,height:qe.height,alpha:1,position:ze,parent:this});for(let Qe=0;Qe<qe.width;Qe++)for(let Pi=0;Pi<qe.height;Pi++){for(let nn=0;nn<this.channels;nn++){let ln=this.getValueXY(Qe+ze[0],Pi+ze[1],nn);Ke.setValueXY(Qe,Pi,nn,ln)}qe.getBitXY(Qe,Pi)||Ke.setValueXY(Qe,Pi,this.components,0)}return Ke}else{let Ke=Image$1.createFrom(this,{width:qe.width,height:qe.height,position:ze,parent:this});for(let Qe=0;Qe<qe.height;Qe++)for(let Pi=0;Pi<qe.width;Pi++)qe.getBitXY(Pi,Qe)&&this.getBitXY(Pi+ze[0],Qe+ze[1])&&Ke.setBitXY(Pi,Qe);return Ke}}var fastList={exports:{}},hasRequiredFastList;function requireFastList(){return hasRequiredFastList||(hasRequiredFastList=1,function(qe,f){(function(){function ze(Qe,Pi,nn){this.next=nn,nn&&(nn.prev=this),this.prev=Pi,Pi&&(Pi.next=this),this.data=Qe}function Ke(){if(!(this instanceof Ke))return new Ke;this._head=null,this._tail=null,this.length=0}Ke.prototype={push:function(Qe){this._tail=new ze(Qe,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(this.length!==0){var Qe=this._tail;return this._tail=Qe.prev,Qe.prev&&(Qe.prev=this._tail.next=null),this.length--,this.length===1?this._head=this._tail:this.length===0&&(this._head=this._tail=null),Qe.data}},unshift:function(Qe){this._head=new ze(Qe,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(this.length!==0){var Qe=this._head;return this._head=Qe.next,Qe.next&&(Qe.next=this._head.prev=null),this.length--,this.length===1?this._tail=this._head:this.length===0&&(this._head=this._tail=null),Qe.data}},item:function(Qe){Qe<0&&(Qe=this.length+Qe);for(var Pi=this._head;Qe-- >0&&Pi;)Pi=Pi.next;return Pi?Pi.data:void 0},slice:function(Qe,Pi){if(Qe||(Qe=0),Pi||(Pi=this.length),Pi<0&&(Pi=this.length+Pi),Qe<0&&(Qe=this.length+Qe),Pi===Qe)return[];if(Pi<Qe)throw new Error("invalid offset: "+Qe+","+Pi+" (length="+this.length+")");for(var nn=Pi-Qe,ln=new Array(nn),cn=0,hn=this._head;Qe-- >0&&hn;)hn=hn.next;for(;cn<nn&&hn;)ln[cn++]=hn.data,hn=hn.next;return ln},drop:function(){Ke.call(this)},forEach:function(Qe,Pi){for(var nn=this._head,ln=0,cn=this.length;ln<cn&&nn;)Qe.call(Pi||this,nn.data,ln,this),nn=nn.next,ln++},map:function(Qe,Pi){var nn=new Ke;return this.forEach(function(ln,cn,hn){nn.push(Qe.call(Pi||hn,ln,cn,hn))}),nn},filter:function(Qe,Pi){var nn=new Ke;return this.forEach(function(ln,cn,hn){Qe.call(Pi||hn,ln,cn,hn)&&nn.push(ln)}),nn},reduce:function(Qe,Pi,nn){var ln=0,cn=this._head,hn=this.length;for(Pi||(ln=1,Pi=cn&&cn.data,cn=cn&&cn.next);ln<hn&&cn;)Pi=Qe.call(nn||this,Pi,cn.data,this),ln++,cn=cn.next;return Pi}},qe.exports=Ke})()}(fastList)),fastList.exports}var fastListExports=requireFastList();const LinkedList=getDefaultExportFromCjs(fastListExports);function floodFill(qe={}){const{x:f=0,y:ze=0,inPlace:Ke=!0}=qe,Qe=Ke?this:Image$1.createFrom(this);if(this.checkProcessable("floodFill",{bitDepth:1}),this.getBitXY(f,ze))return Qe;const nn=new LinkedList;for(nn.push(new Node(f,ze));nn.length>0;){const ln=nn.shift();Qe.setBitXY(ln.x,ln.y);for(let cn=ln.x+1;cn<this.width&&(!Qe.getBitXY(cn,ln.y)&&!this.getBitXY(cn,ln.y));cn++)Qe.setBitXY(cn,ln.y),ln.y+1<this.height&&!this.getBitXY(cn,ln.y+1)&&nn.push(new Node(cn,ln.y+1)),ln.y-1>=0&&!this.getBitXY(cn,ln.y-1)&&nn.push(new Node(cn,ln.y-1));for(let cn=ln.x-1;cn>=0&&(!Qe.getBitXY(cn,ln.y)&&!this.getBitXY(cn,ln.y));cn++)Qe.setBitXY(cn,ln.y),ln.y+1<this.height&&!this.getBitXY(cn,ln.y+1)&&nn.push(new Node(cn,ln.y+1)),ln.y-1>=0&&!this.getBitXY(cn,ln.y-1)&&nn.push(new Node(cn,ln.y-1))}return Qe}function Node(qe,f){this.x=qe,this.y=f}function _extends(){return _extends=Object.assign?Object.assign.bind():function(qe){for(var f=1;f<arguments.length;f++){var ze=arguments[f];for(var Ke in ze)({}).hasOwnProperty.call(ze,Ke)&&(qe[Ke]=ze[Ke])}return qe},_extends.apply(null,arguments)}function hsv2rgb(qe,f,ze){f=f/100,ze=ze/100;var Ke=[],Qe=ze*f,Pi=qe/60,nn=Qe*(1-Math.abs(Pi%2-1)),ln=ze-Qe;return Pi>=0&&Pi<1?Ke=[Qe,nn,0]:Pi>=1&&Pi<2?Ke=[nn,Qe,0]:Pi>=2&&Pi<3?Ke=[0,Qe,nn]:qe>=3&&Pi<4?Ke=[0,nn,Qe]:qe>=4&&Pi<5?Ke=[nn,0,Qe]:qe>=5&&Pi<=6?Ke=[Qe,0,nn]:Ke=[0,0,0],{r:Math.round(255*(Ke[0]+ln)),g:Math.round(255*(Ke[1]+ln)),b:Math.round(255*(Ke[2]+ln))}}function hsl2hsv(qe,f,ze){return f*=(ze<50?ze:100-ze)/100,{h:qe,s:2*f/(ze+f)*100,v:ze+f}}function hsl2rgb$1(qe,f,ze){var Ke=hsl2hsv(qe,f,ze);return hsv2rgb(Ke.h,Ke.s,Ke.v)}var colors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]};function parse(qe){return named(qe)||hex3(qe)||hex6(qe)||rgb(qe)||rgba$1(qe)||hsl(qe)||hsla(qe)}function named(qe){var f=colors[qe.toLowerCase()];if(f)return{r:f[0],g:f[1],b:f[2],a:100}}function rgb(qe){var f=qe.match(/rgb\(([^)]+)\)/);if(f){var ze=f[1].split(/ *, */).map(Number);return{r:ze[0],g:ze[1],b:ze[2],a:100}}}function rgba$1(qe){var f=qe.match(/rgba\(([^)]+)\)/);if(f){var ze=f[1].split(/ *, */).map(Number);return{r:ze[0],g:ze[1],b:ze[2],a:ze[3]*100}}}function hex6(qe){if(qe[0]==="#"&&qe.length===7)return{r:parseInt(qe.slice(1,3),16),g:parseInt(qe.slice(3,5),16),b:parseInt(qe.slice(5,7),16),a:100}}function hex3(qe){if(qe[0]==="#"&&qe.length===4)return{r:parseInt(qe[1]+qe[1],16),g:parseInt(qe[2]+qe[2],16),b:parseInt(qe[3]+qe[3],16),a:100}}function hsl(qe){var f=qe.match(/hsl\(([^)]+)\)/);if(f){var ze=f[1].split(/ *, */),Ke=parseInt(ze[0],10),Qe=parseInt(ze[1],10),Pi=parseInt(ze[2],10),nn=hsl2rgb$1(Ke,Qe,Pi);return _extends({},nn,{a:100})}}function hsla(qe){var f=qe.match(/hsla\(([^)]+)\)/);if(f){var ze=f[1].split(/ *, */),Ke=parseInt(ze[0],10),Qe=parseInt(ze[1],10),Pi=parseInt(ze[2],10),nn=parseInt(parseFloat(ze[3])*100,10),ln=hsl2rgb$1(Ke,Qe,Pi);return _extends({},ln,{a:nn})}}function css2array(qe){let f=parse(qe);return[f.r,f.g,f.b,Math.round(f.a*255/100)]}function hue2rgb(qe,f,ze){return ze<0&&(ze+=1),ze>1&&(ze-=1),ze<1/6?qe+(f-qe)*6*ze:ze<1/2?f:ze<2/3?qe+(f-qe)*(2/3-ze)*6:qe}function hsl2rgb(qe,f,ze){let Ke,Qe,Pi,nn,ln,cn;return f/=100,ze/=100,f===0?nn=ln=cn=ze*255:(ze<=.5?Qe=ze*(f+1):Qe=ze+f-ze*f,Ke=ze*2-Qe,Pi=qe/360,nn=hue2rgb(Ke,Qe,Pi+1/3),ln=hue2rgb(Ke,Qe,Pi),cn=hue2rgb(Ke,Qe,Pi-1/3)),{r:nn,g:ln,b:cn}}function getDistinctColors(qe){let f=new Array(qe),ze=0;for(let Ke=0;Ke<360;Ke+=360/qe){ze++;let Qe=hsl2rgb(Ke,100,30+ze%4*15);f[ze-1]=[Math.round(Qe.r*255),Math.round(Qe.g*255),Math.round(Qe.b*255)]}return f}function getRandomColor(){return[Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)]}function getColors(qe){let{color:f,colors:ze,randomColors:Ke,numberColors:Qe=50}=qe;if(f&&!Array.isArray(f)&&(f=css2array(f)),f)return[f];if(ze)return ze=ze.map(function(Pi){return Array.isArray(Pi)?Pi:css2array(Pi)}),ze;if(Ke){ze=new Array(Qe);for(let Pi=0;Pi<Qe;Pi++)ze[Pi]=getRandomColor()}return getDistinctColors(Qe)}function paintLabels(qe,f,ze={}){let{color:Ke="blue",colors:Qe,font:Pi="12px Helvetica",rotate:nn=0}=ze;if(this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1}),!Array.isArray(qe))throw Error("paintLabels: labels must be an array");if(!Array.isArray(f))throw Error("paintLabels: positions must be an array");if(Ke&&!Array.isArray(Ke)&&(Ke=css2array(Ke)),Qe?Qe=Qe.map(function(hn){return Array.isArray(hn)?hn:css2array(hn)}):Qe=[Ke],qe.length!==f.length)throw Error("paintLabels: positions and labels must be arrays from the same size");Array.isArray(Pi)||(Pi=[Pi]),Array.isArray(nn)||(nn=[nn]);let cn=this.getCanvas().getContext("2d");for(let hn=0;hn<qe.length;hn++){cn.save();let un=Qe[hn%Qe.length];cn.fillStyle=`rgba(${un[0]},${un[1]},${un[2]},${un[3]/this.maxValue})`,cn.font=Pi[hn%Pi.length];let zn=f[hn];cn.translate(zn[0],zn[1]),cn.rotate(nn[hn%nn.length]/180*Math.PI),cn.fillText(qe[hn],0,0),cn.restore()}return this.data=Uint8Array.from(cn.getImageData(0,0,this.width,this.height).data),this}function paintMasks(qe,f={}){let{alpha:ze=255,labels:Ke=[],labelsPosition:Qe=[],labelColor:Pi="blue",labelFont:nn="12px Helvetica"}=f;this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1});let ln=getColors(Object.assign({},f,{numberColors:qe.length}));Array.isArray(qe)||(qe=[qe]);for(let cn=0;cn<qe.length;cn++){let hn=qe[cn],un=ln[cn%ln.length];for(let zn=0;zn<hn.width;zn++)for(let Xn=0;Xn<hn.height;Xn++)if(hn.getBitXY(zn,Xn))for(let Un=0;Un<Math.min(this.components,un.length);Un++)if(ze===255)this.setValueXY(zn+hn.position[0],Xn+hn.position[1],Un,un[Un]);else{let qn=this.getValueXY(zn+hn.position[0],Xn+hn.position[1],Un);qn=Math.round((qn*(255-ze)+un[Un]*ze)/255),this.setValueXY(zn+hn.position[0],Xn+hn.position[1],Un,qn)}}if(Array.isArray(Ke)&&Ke.length>0){let hn=this.getCanvas().getContext("2d");hn.fillStyle=Pi,hn.font=nn;for(let un=0;un<Math.min(qe.length,Ke.length);un++){let zn=Qe[un]?Qe[un]:qe[un].position;hn.fillText(Ke[un],zn[0],zn[1])}this.data=Uint8Array.from(hn.getImageData(0,0,this.width,this.height).data)}return this}function zerosMatrix(qe,f){let ze=new Array(qe);for(let Ke=0;Ke<qe;Ke++)ze[Ke]=new Array(f).fill(0);return ze}const cross=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],smallCross=[[0,1,0],[1,1,1],[0,1,0]];class Shape{constructor(f={}){let{kind:ze="cross",shape:Ke,size:Qe,width:Pi,height:nn,filled:ln=!0}=f;if(Qe&&(Pi=Qe,nn=Qe),Ke)switch(Ke.toLowerCase()){case"square":case"rectangle":this.matrix=rectangle(Pi,nn,{filled:ln});break;case"circle":case"ellipse":this.matrix=ellipse(Pi,nn,{filled:ln});break;case"triangle":this.matrix=triangle(Pi,nn,{filled:ln});break;default:throw new Error(`Shape: unexpected shape: ${Ke}`)}else if(ze)switch(ze.toLowerCase()){case"cross":this.matrix=cross;break;case"smallcross":this.matrix=smallCross;break;default:throw new Error(`Shape: unexpected kind: ${ze}`)}else throw new Error("Shape: expected a kind or a shape option");this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){let f=this.matrix,ze=[];for(let Ke=0;Ke<f.length;Ke++)for(let Qe=0;Qe<f[0].length;Qe++)f[Ke][Qe]&&ze.push([Qe-this.halfWidth,Ke-this.halfHeight]);return ze}getMask(){let f=new Image$1(this.width,this.height,{kind:BINARY});for(let ze=0;ze<this.matrix.length;ze++)for(let Ke=0;Ke<this.matrix[0].length;Ke++)this.matrix[ze][Ke]&&f.setBitXY(Ke,ze);return f}}function rectangle(qe,f,ze){const Ke=zerosMatrix(f,qe);if(ze.filled)for(let Qe=0;Qe<f;Qe++)for(let Pi=0;Pi<qe;Pi++)Ke[Qe][Pi]=1;else{for(let Qe of[0,f-1])for(let Pi=0;Pi<qe;Pi++)Ke[Qe][Pi]=1;for(let Qe=0;Qe<f;Qe++)for(let Pi of[0,qe-1])Ke[Qe][Pi]=1}return Ke}function ellipse(qe,f,ze){const Ke=zerosMatrix(f,qe);let Qe=1-f%2,Pi=1-qe%2,nn=Math.floor((qe-1)/2),ln=Math.floor((f-1)/2),cn=nn*nn,hn=ln*ln;if(ze.filled)for(let un=0;un<=ln;un++){let zn=Math.floor(Math.sqrt(cn-cn*un*un/hn));for(let Xn=nn-zn;Xn<=nn;Xn++)Ke[ln-un][Xn]=1,Ke[ln+un+Qe][Xn]=1,Ke[ln-un][qe-Xn-1]=1,Ke[ln+un+Qe][qe-Xn-1]=1}else{for(let un=0;un<=ln;un++){let zn=Math.floor(Math.sqrt(cn-cn*un*un/hn)),Xn=nn-zn;Ke[ln-un][Xn]=1,Ke[ln+un+Qe][Xn]=1,Ke[ln-un][qe-Xn-1]=1,Ke[ln+un+Qe][qe-Xn-1]=1}for(let un=0;un<=nn;un++){let zn=Math.floor(Math.sqrt(hn-hn*un*un/cn)),Xn=ln-zn;Ke[Xn][nn-un]=1,Ke[Xn][nn+un+Pi]=1,Ke[f-Xn-1][nn-un]=1,Ke[f-Xn-1][nn+un+Pi]=1}}return Ke}function triangle(qe,f,ze){if(!ze.filled)throw new Error("Non filled triangle is not implemented");const Ke=zerosMatrix(f,qe);for(let Qe=0;Qe<f;Qe++){let Pi=Math.floor((1-Qe/f)*qe/2);for(let nn=Pi;nn<qe-Pi;nn++)Ke[Qe][nn]=1}return Ke}function paintPoints(qe,f={}){let{shape:ze}=f;this.checkProcessable("paintPoints",{bitDepth:[8,16]});let Ke=getColors(Object.assign({},f,{numberColors:qe.length})),Qe=new Shape(ze).getPoints(),Pi=Math.min(this.channels,Ke[0].length);for(let nn=0;nn<qe.length;nn++){let ln=Ke[nn%Ke.length],cn=qe[nn][0],hn=qe[nn][1];for(let un=0;un<Qe.length;un++){let zn=Qe[un][0],Xn=Qe[un][1];if(cn+zn>=0&&hn+Xn>=0&&cn+zn<this.width&&hn+Xn<this.height){let Un=(cn+zn+(hn+Xn)*this.width)*this.channels;for(let qn=0;qn<Pi;qn++)this.data[Un+qn]=ln[qn]}}}return this}function paintPolyline(qe,f={}){let{color:ze=[this.maxValue,0,0],closed:Ke=!1}=f;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]});let Qe=Math.min(this.channels,ze.length);for(let Pi=0;Pi<qe.length-1+Ke;Pi++){let nn=qe[Pi],ln=qe[(Pi+1)%qe.length],cn=ln[0]-nn[0],hn=ln[1]-nn[1],un=Math.max(Math.abs(cn),Math.abs(hn)),zn=cn/un,Xn=hn/un,Un=nn[0],qn=nn[1];for(let ys=0;ys<=un;ys++){let vs=Math.round(Un),ea=Math.round(qn);if(vs>=0&&ea>=0&&vs<this.width&&ea<this.height)if(this.bitDepth===1)this.setBitXY(vs,ea);else{let na=(vs+ea*this.width)*this.channels;for(let ta=0;ta<Qe;ta++)this.data[na+ta]=ze[ta]}Un=Un+zn,qn=qn+Xn}}return this}function paintPolylines(qe,f={}){let ze=Object.assign({},f);this.checkProcessable("paintPolylines",{bitDepth:[8,16]});let Ke=getColors(Object.assign({},f,{numberColors:qe.length}));for(let Qe=0;Qe<qe.length;Qe++)ze.color=Ke[Qe%Ke.length],this.paintPolyline(qe[Qe],ze);return this}function paintPolygon(qe,f={}){let{color:ze=[this.maxValue,0,0],filled:Ke=!1}=f;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]}),f.closed=!0;let Qe=deleteDouble(qe);if(Ke===!1)return this.paintPolyline(qe,f);{let Pi=Array(this.height);for(let nn=0;nn<this.height;nn++){Pi[nn]=[];for(let ln=0;ln<this.width;ln++)Pi[nn].push(0)}for(let nn=0;nn<Qe.length;nn++){const ln=lineBetweenTwoPoints(Qe[nn],Qe[(nn+1)%Qe.length]);for(let cn=0;cn<this.height;cn++)for(let hn=0;hn<this.width;hn++)isAtTheRightOfTheLine(hn,cn,ln,this.height)&&(Pi[cn][hn]=Pi[cn][hn]===0?1:0)}for(let nn=0;nn<this.height;nn++)for(let ln=0;ln<this.width;ln++)if(Pi[nn][ln]===1)if(this.bitDepth===1)this.setBitXY(ln,nn);else{let cn=Math.min(this.channels,ze.length),hn=(ln+nn*this.width)*this.channels;for(let un=0;un<cn;un++)this.data[hn+un]=ze[un]}return this.paintPolyline(qe,f)}}function deleteDouble(qe){let f=[];for(let ze=0;ze<qe.length;ze++)if(!(qe[ze][0]===qe[(ze+1)%qe.length][0]&&qe[ze][1]===qe[(ze+1)%qe.length][1])){if(qe[ze][0]===qe[(ze-1+qe.length)%qe.length][0]&&qe[ze][1]===qe[(ze-1+qe.length)%qe.length][1])continue;if(qe[(ze+1)%qe.length][0]===qe[(ze-1+qe.length)%qe.length][0]&&qe[(ze-1+qe.length)%qe.length][1]===qe[(ze+1)%qe.length][1])continue;f.push(qe[ze])}return f}function lineBetweenTwoPoints(qe,f){if(qe[0]===f[0])return{a:0,b:qe[0],vertical:!0};{const ze=(f[1]-qe[1])/(f[0]-qe[0]),Ke=qe[1]-ze*qe[0];return{a:ze,b:Ke,vertical:!1}}}function isAtTheRightOfTheLine(qe,f,ze,Ke){if(ze.vertical===!0)return ze.b<=qe;if(ze.a===0)return!1;{const Qe=(f-ze.b)/ze.a;return Qe<qe&&Qe>=0&&Qe<=Ke}}function paintPolygons(qe,f={}){let ze=Object.assign({},f);this.checkProcessable("paintPolygons",{bitDepth:[8,16]});let Ke=getColors(Object.assign({},f,{numberColors:qe.length}));for(let Qe=0;Qe<qe.length;Qe++)ze.color=Ke[Qe%Ke.length],this.paintPolygon(qe[Qe],ze);return this}function getHistogram(qe={}){let{maxSlots:f=256,channel:ze,useAlpha:Ke=!0}=qe;if(this.checkProcessable("getHistogram",{bitDepth:[1,8,16]}),ze===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");ze=0}return getChannelHistogram.call(this,ze,{useAlpha:Ke,maxSlots:f})}function getHistograms(qe={}){const{maxSlots:f=256,useAlpha:ze=!0}=qe;this.checkProcessable("getHistograms",{bitDepth:[8,16]});let Ke=new Array(ze?this.components:this.channels);for(let Qe=0;Qe<Ke.length;Qe++)Ke[Qe]=getChannelHistogram.call(this,Qe,{useAlpha:ze,maxSlots:f});return Ke}function getChannelHistogram(qe,f){let{useAlpha:ze,maxSlots:Ke}=f;if(this.bitDepth===1){let cn=[0,0];for(let hn=0;hn<this.height;hn++)for(let un=0;un<this.width;un++){let zn=this.getBitXY(hn,un);zn===0?cn[0]+=1:zn===1&&(cn[1]+=1)}return cn}let Qe=Math.log2(Ke);if(!isInteger(Qe))throw new RangeError("maxSlots must be a power of 2, for example: 64, 256, 1024");let Pi=0;this.bitDepth>Qe&&(Pi=this.bitDepth-Qe);let nn=this.data,ln=newArray(Math.pow(2,Math.min(this.bitDepth,Qe)),0);if(ze&&this.alpha){let cn=this.channels-qe-1;for(let hn=qe;hn<nn.length;hn+=this.channels)ln[nn[hn]>>Pi]+=nn[hn+cn]/this.maxValue}else for(let cn=qe;cn<nn.length;cn+=this.channels)ln[nn[cn]>>Pi]++;return ln}function getColorHistogram(qe={}){let{useAlpha:f=!0,nbSlots:ze=512}=qe;this.checkProcessable("getColorHistogram",{bitDepth:[8,16],components:[3]});let Ke=Math.log(ze)/Math.log(8);if(Ke!==Math.floor(Ke))throw new RangeError("nbSlots must be a power of 8. Usually 8, 64, 512 or 4096");let Qe=this.bitDepth-Ke,Pi=this.data,nn=newArray(Math.pow(8,Ke),0),ln=Math.pow(2,Ke*2),cn=Math.pow(2,Ke);for(let hn=0;hn<Pi.length;hn+=this.channels){let un=(Pi[hn]>>Qe)*ln+(Pi[hn+1]>>Qe)*cn+(Pi[hn+2]>>Qe);f&&this.alpha?nn[un]+=Pi[hn+this.channels-1]/this.maxValue:nn[un]++}return nn}function min(){this.checkProcessable("min",{bitDepth:[8,16,32]});let qe=newArray(this.channels,1/0);for(let f=0;f<this.data.length;f+=this.channels)for(let ze=0;ze<this.channels;ze++)this.data[f+ze]<qe[ze]&&(qe[ze]=this.data[f+ze]);return qe}function max(){this.checkProcessable("max",{bitDepth:[8,16,32]});let qe=newArray(this.channels,-1/0);for(let f=0;f<this.data.length;f+=this.channels)for(let ze=0;ze<this.channels;ze++)this.data[f+ze]>qe[ze]&&(qe[ze]=this.data[f+ze]);return qe}function sum(){this.checkProcessable("sum",{bitDepth:[8,16]});let qe=newArray(this.channels,0);for(let f=0;f<this.data.length;f+=this.channels)for(let ze=0;ze<this.channels;ze++)qe[ze]+=this.data[f+ze];return qe}function getMoment(qe=0,f=0){this.checkProcessable("getMoment",{bitDepth:[1]});let ze=0;for(let Ke=0;Ke<this.width;Ke++)for(let Qe=0;Qe<this.height;Qe++)this.getBitXY(Ke,Qe)===1&&(ze+=Ke**qe*Qe**f);return ze}function localMaxima(qe={}){let{mask:f,region:ze=3,removeClosePoints:Ke=0,invert:Qe=!1,maxEquals:Pi=2}=qe,nn=this;this.checkProcessable("localMaxima",{bitDepth:[8,16],components:1}),ze*=4;let ln=Qe?0:1,cn=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],hn=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],un=ze<=8?1:2,zn=[];for(let Xn=un;Xn<nn.height-un;Xn++)for(let Un=un;Un<nn.width-un;Un++){if(f&&f.getBitXY(Un,Xn)!==ln)continue;let qn=0,ys=0,vs=nn.data[Un+Xn*nn.width];for(let ea=0;ea<ze;ea++)Qe?nn.data[Un+cn[ea]+(Xn+hn[ea])*nn.width]>vs&&qn++:nn.data[Un+cn[ea]+(Xn+hn[ea])*nn.width]<vs&&qn++,nn.data[Un+cn[ea]+(Xn+hn[ea])*nn.width]===vs&&ys++;qn+ys===ze&&ys<=Pi&&zn.push([Un,Xn])}if(Ke>0)for(let Xn=0;Xn<zn.length;Xn++)for(let Un=Xn+1;Un<zn.length;Un++)Math.sqrt(Math.pow(zn[Xn][0]-zn[Un][0],2)+Math.pow(zn[Xn][1]-zn[Un][1],2))<Ke&&(zn[Xn][0]=zn[Xn][0]+zn[Un][0]>>1,zn[Xn][1]=zn[Xn][1]+zn[Un][1]>>1,zn.splice(Un,1),Un--);return zn}function mean(){let qe=this.getHistograms({maxSlots:this.maxValue+1}),f=new Array(qe.length);for(let ze=0;ze<qe.length;ze++){let Ke=qe[ze];f[ze]=mean$2(Ke)}return f}function median(){let qe=this.getHistograms({maxSlots:this.maxValue+1}),f=new Array(qe.length);for(let ze=0;ze<qe.length;ze++){let Ke=qe[ze];f[ze]=median$2(Ke)}return f}function points(){this.checkProcessable("points",{bitDepth:[1]});const qe=[];for(let f=0;f<this.width;f++)for(let ze=0;ze<this.height;ze++)this.getBitXY(f,ze)===1&&qe.push([f,ze]);return qe}function extendedPoints(){this.checkProcessable("extendedPoints",{bitDepth:[1]});const qe=[];for(let f=0;f<this.height;f++)for(let ze=0;ze<this.width;ze++)if(this.getBitXY(ze,f)===1)for(qe.push([ze,f]),this.getBitXY(ze+1,f)!==1?(qe.push([ze+1,f]),qe.push([ze+1,f+1]),this.getBitXY(ze,f+1)!==1&&qe.push([ze,f+1])):this.getBitXY(ze,f+1)!==1&&(qe.push([ze,f+1]),qe.push([ze+1,f+1]));ze<this.width-2&&this.getBitXY(ze+1,f)===1&&this.getBitXY(ze+2,f)===1;)ze++;return qe}function getRelativePosition(qe,f={}){if(this===qe)return[0,0];let ze=[0,0],Ke=this;for(;Ke;){if(Ke===qe)return ze;Ke.position&&(ze[0]+=Ke.position[0],ze[1]+=Ke.position[1]),Ke=Ke.parent}return f.defaultFurther?ze:!1}function countAlphaPixels(qe={}){let{alpha:f=1}=qe;this.checkProcessable("countAlphaPixels",{bitDepth:[8,16],alpha:1});let ze=0;if(f!==void 0){for(let Ke=this.components;Ke<this.data.length;Ke+=this.channels)this.data[Ke]===f&&ze++;return ze}else return this.size}function monotoneChainConvexHull$1(qe,f={}){const{sorted:ze}=f;ze||(qe=qe.slice().sort(byXThenY));const Ke=qe.length,Qe=new Array(Ke*2);let Pi=0;for(let ln=0;ln<Ke;ln++){const cn=qe[ln];for(;Pi>=2&&cw(Qe[Pi-2],Qe[Pi-1],cn)<=0;)Pi--;Qe[Pi++]=cn}const nn=Pi+1;for(let ln=Ke-2;ln>=0;ln--){const cn=qe[ln];for(;Pi>=nn&&cw(Qe[Pi-2],Qe[Pi-1],cn)<=0;)Pi--;Qe[Pi++]=cn}return Qe.slice(0,Pi-1)}function cw(qe,f,ze){return(f[1]-qe[1])*(ze[0]-qe[0])-(f[0]-qe[0])*(ze[1]-qe[1])}function byXThenY(qe,f){return qe[0]===f[0]?qe[1]-f[1]:qe[0]-f[0]}function monotoneChainConvexHull(){return monotoneChainConvexHull$1(this.extendedPoints,{sorted:!1})}function round(qe){for(let f=0;f<qe.length;f++)qe[f][0]=Math.round(qe[f][0]),qe[f][1]=Math.round(qe[f][1]);return qe}function difference(qe,f){return[qe[0]-f[0],qe[1]-f[1]]}function normalize(qe){let f=Math.sqrt(qe[0]**2+qe[1]**2);return[qe[0]/f,qe[1]/f]}function rotate(qe,f,ze){ze===void 0&&(ze=new Array(f.length));let Ke=Math.cos(qe),Qe=Math.sin(qe);for(let Pi=0;Pi<ze.length;++Pi)ze[Pi]=[Ke*f[Pi][0]-Qe*f[Pi][1],Qe*f[Pi][0]+Ke*f[Pi][1]];return ze}function perimeter(qe){let f=0;for(let ze=0;ze<qe.length;ze++){let Ke=qe[ze][0],Qe=qe[ze][1],Pi=qe[ze===qe.length-1?0:ze+1][0],nn=qe[ze===qe.length-1?0:ze+1][1];f+=Math.sqrt((Pi-Ke)**2+(nn-Qe)**2)}return f}function surface(qe){let f=0;for(let ze=0;ze<qe.length;ze++){let Ke=qe[ze][0],Qe=qe[ze===qe.length-1?0:ze+1][1],Pi=qe[ze===qe.length-1?0:ze+1][0],nn=qe[ze][1];f+=Ke*Qe*.5,f-=Pi*nn*.5}return Math.abs(f)}function minMax(qe){let f=1/0,ze=1/0,Ke=-1/0,Qe=-1/0;for(let Pi=0;Pi<qe.length;Pi++)qe[Pi][0]<f&&(f=qe[Pi][0]),qe[Pi][0]>Ke&&(Ke=qe[Pi][0]),qe[Pi][1]<ze&&(ze=qe[Pi][1]),qe[Pi][1]>Qe&&(Qe=qe[Pi][1]);return[[f,ze],[Ke,Qe]]}function moveToZeroZero(qe,f){f===void 0&&(f=new Array(qe.length).fill(0).map(()=>[]));let ze=minMax(qe),Ke=ze[0][0],Qe=ze[0][1];for(let Pi=0;Pi<qe.length;Pi++)f[Pi][0]=qe[Pi][0]-Ke,f[Pi][1]=qe[Pi][1]-Qe;return f}function minimalBoundingRectangle(qe={}){const{originalPoints:f=monotoneChainConvexHull.call(this)}=qe;if(f.length===0)return[];if(f.length===1)return[f[0],f[0],f[0],f[0]];const ze=new Array(f.length);let Ke=1/0,Qe=0,Pi;for(let nn=0;nn<ze.length;nn++){let ln=getAngle$1(f[nn],f[(nn+1)%ze.length]);rotate(-ln,f,ze);let cn=ze[nn][0],hn=ze[nn][1],un=ze[(nn+1)%ze.length][0],zn=ze[(nn+1)%ze.length][1],Xn=!0,Un=0,qn=0,ys=0;for(let ta=0;ta<ze.length;ta++){let ra=ze[ta][0],oa=ze[ta][1],fa=(ra-cn)/(un-cn);Xn===!0?(Xn=!1,Un=fa,qn=fa):(fa<Un&&(Un=fa),fa>qn&&(qn=fa));let ca=(-(un-cn)*oa+un*hn-zn*cn)/(un-cn);Math.abs(ca)>Math.abs(ys)&&(ys=ca)}let vs=[cn+Un*(un-cn),hn],ea=[cn+qn*(un-cn),hn],na=Math.abs(ys*(Un-qn)*(un-cn));na<Ke&&(Qe=ln,Ke=na,Pi=[vs,ea,[ea[0],ea[1]-ys],[vs[0],vs[1]-ys]])}return rotate(Qe,Pi,Pi),Pi}function getAngle$1(qe,f){let ze=difference(f,qe),Ke=normalize(ze),Qe=Math.acos(Ke[0]);return Ke[1]<0?-Qe:Qe}function extend$2(qe){let f={inPlace:!0};qe.extendMethod("invert",invert),qe.extendMethod("abs",abs),qe.extendMethod("level",level,f),qe.extendMethod("add",add,f),qe.extendMethod("subtract",subtract,f),qe.extendMethod("subtractImage",subtractImage),qe.extendMethod("multiply",multiply,f),qe.extendMethod("divide",divide,f),qe.extendMethod("hypotenuse",hypotenuse),qe.extendMethod("background",background$1),qe.extendMethod("flipX",flipX),qe.extendMethod("flipY",flipY),qe.extendMethod("blurFilter",blurFilter),qe.extendMethod("medianFilter",medianFilter),qe.extendMethod("gaussianFilter",gaussianFilter),qe.extendMethod("sobelFilter",sobelFilter),qe.extendMethod("gradientFilter",gradientFilter),qe.extendMethod("scharrFilter",scharrFilter),qe.extendMethod("dilate",dilate),qe.extendMethod("erode",erode),qe.extendMethod("open",open),qe.extendMethod("close",close),qe.extendMethod("topHat",topHat),qe.extendMethod("blackHat",blackHat),qe.extendMethod("morphologicalGradient",morphologicalGradient),qe.extendMethod("warpingFourPoints",warpingFourPoints),qe.extendMethod("crop",crop),qe.extendMethod("cropAlpha",cropAlpha),qe.extendMethod("resize",resize).extendMethod("scale",resize),qe.extendMethod("hsv",hsv),qe.extendMethod("hsl",hsl$1),qe.extendMethod("cmyk",cmyk),qe.extendMethod("rgba8",rgba8),qe.extendMethod("grey",grey).extendMethod("gray",grey),qe.extendMethod("mask",mask),qe.extendMethod("pad",pad),qe.extendMethod("colorDepth",colorDepth),qe.extendMethod("setBorder",setBorder,f),qe.extendMethod("rotate",rotate$1),qe.extendMethod("rotateLeft",rotateLeft),qe.extendMethod("rotateRight",rotateRight),qe.extendMethod("insert",insert),qe.extendMethod("getRow",getRow),qe.extendMethod("getColumn",getColumn),qe.extendMethod("getMatrix",getMatrix),qe.extendMethod("setMatrix",setMatrix),qe.extendMethod("getPixelsArray",getPixelsArray),qe.extendMethod("getIntersection",getIntersection),qe.extendMethod("getClosestCommonParent",getClosestCommonParent),qe.extendMethod("getThreshold",getThreshold),qe.extendMethod("split",split),qe.extendMethod("getChannel",getChannel),qe.extendMethod("combineChannels",combineChannels),qe.extendMethod("setChannel",setChannel),qe.extendMethod("getSimilarity",getSimilarity),qe.extendMethod("getPixelsGrid",getPixelsGrid),qe.extendMethod("getBestMatch",getBestMatch),qe.extendMethod("cannyEdge",cannyEdge),qe.extendMethod("convolution",convolution),qe.extendMethod("extract",extract),qe.extendMethod("floodFill",floodFill),qe.extendMethod("paintLabels",paintLabels,f),qe.extendMethod("paintMasks",paintMasks,f),qe.extendMethod("paintPoints",paintPoints,f),qe.extendMethod("paintPolyline",paintPolyline,f),qe.extendMethod("paintPolylines",paintPolylines,f),qe.extendMethod("paintPolygon",paintPolygon,f),qe.extendMethod("paintPolygons",paintPolygons,f),qe.extendMethod("countAlphaPixels",countAlphaPixels),qe.extendMethod("monotoneChainConvexHull",monotoneChainConvexHull),qe.extendMethod("minimalBoundingRectangle",minimalBoundingRectangle),qe.extendMethod("getHistogram",getHistogram).extendProperty("histogram",getHistogram),qe.extendMethod("getHistograms",getHistograms).extendProperty("histograms",getHistograms),qe.extendMethod("getColorHistogram",getColorHistogram).extendProperty("colorHistogram",getColorHistogram),qe.extendMethod("getMin",min).extendProperty("min",min),qe.extendMethod("getMax",max).extendProperty("max",max),qe.extendMethod("getSum",sum).extendProperty("sum",sum),qe.extendMethod("getMoment",getMoment).extendProperty("moment",getMoment),qe.extendMethod("getLocalMaxima",localMaxima),qe.extendMethod("getMedian",median).extendProperty("median",median),qe.extendMethod("getMean",mean).extendProperty("mean",mean),qe.extendMethod("getPoints",points).extendProperty("points",points),qe.extendMethod("getExtendedPoints",extendedPoints).extendProperty("extendedPoints",extendedPoints),qe.extendMethod("getRelativePosition",getRelativePosition)}var quantities$1={exports:{}},quantities=quantities$1.exports,hasRequiredQuantities;function requireQuantities(){return hasRequiredQuantities||(hasRequiredQuantities=1,function(qe,f){(function(ze,Ke){qe.exports=Ke()})(quantities,function(){function ze(sa){return typeof sa=="string"||sa instanceof String}var Ke=Number.isFinite||window.isFinite;function Qe(sa){return Ke(sa)}function Pi(sa){return sa}function nn(sa){var bs={};return sa.filter(function(xs){return bs.hasOwnProperty(xs)?!1:bs[xs]=!0})}function ln(sa,bs){if(bs.length!==sa.length)return!1;for(var xs=0;xs<sa.length;xs++)if(bs[xs].compareArray&&!bs[xs].compareArray(sa[xs])||bs[xs]!==sa[xs])return!1;return!0}function cn(sa,bs){Object.keys(bs).forEach(function(xs){sa[xs]=bs[xs]})}function hn(){for(var sa=1,bs=0,xs=0;xs<arguments.length;xs++){var Kn=arguments[xs];bs=bs+Xn(Kn),sa*=Kn}return bs!==0?zn(sa,bs):sa}function un(sa,bs){if(bs===0)throw new Error("Divide by zero");var xs=Math.pow(10,Xn(bs)),Kn=xs/(xs*bs);return hn(sa,Kn)}function zn(sa,bs){return Math.round(sa*Math.pow(10,bs))/Math.pow(10,bs)}function Xn(sa){if(!isFinite(sa))return 0;for(var bs=0;sa%1!==0;)sa*=10,bs++;return bs}function Un(){var sa;if(!this)return sa=Object.create(Un.prototype),Un.apply(sa,arguments),sa;sa=Error.apply(this,arguments),this.name="QtyError",this.message=sa.message,this.stack=sa.stack}Un.prototype=Object.create(Error.prototype,{constructor:{value:Un}});function qn(sa,bs){throw new Un("Incompatible units: "+sa+" and "+bs)}var ys={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","","","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["t","tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oilbarrel","oilbarrels","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beerbarrel","beerbarrels","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beerbarrel-imp","beerbarrels-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<Gal>":[["Gal"],.01,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],3600*24,"time",["<second>"]],"<week>":[["wk","week","weeks"],7*3600*24,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"molar_concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"molar_concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","",""],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules","Joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<electronvolt>":[["eV","electronvolt","electronvolts"],1602176634e-28,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<arcminute>":[["arcmin","arcminute","arcminutes"],Math.PI/10800,"angle",["<radian>"]],"<arcsecond>":[["arcsec","arcsecond","arcseconds"],Math.PI/648e3,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppb>":[["ppb"],1e-9,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-12,"prefix_only",["<1>"]],"<ppq>":[["ppq"],1e-15,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},vs=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],ea="<1>",na=[ea];function ta(sa,bs){var xs=bs[1],Kn=bs[3]||[],Cs=bs[4]||[];if(!Qe(xs))throw new Un(sa+": Invalid unit definition. 'scalar' must be a number");Kn.forEach(function(ia){if(ys[ia]===void 0)throw new Un(sa+": Invalid unit definition. Unit "+ia+" in 'numerator' is not recognized")}),Cs.forEach(function(ia){if(ys[ia]===void 0)throw new Un(sa+": Invalid unit definition. Unit "+ia+" in 'denominator' is not recognized")})}var ra={},oa={},fa={},ca={},la={};for(var ua in ys)if(ys.hasOwnProperty(ua)){var ga=ys[ua];if(ga[2]==="prefix"){ra[ua]=ga[1];for(var da=0;da<ga[0].length;da++)oa[ga[0][da]]=ua}else{ta(ua,ga),fa[ua]={scalar:ga[1],numerator:ga[3],denominator:ga[4]};for(var qa=0;qa<ga[0].length;qa++)ca[ga[0][qa]]=ua}la[ua]=ga[0][0]}function tl(sa){var bs,xs=[],Kn=Object.keys(ys);if(typeof sa>"u")for(bs=0;bs<Kn.length;bs++)["","prefix"].indexOf(ys[Kn[bs]][2])===-1&&xs.push(Kn[bs].substr(1,Kn[bs].length-2));else{if(this.getKinds().indexOf(sa)===-1)throw new Un("Kind not recognized");for(bs=0;bs<Kn.length;bs++)ys[Kn[bs]][2]===sa&&xs.push(Kn[bs].substr(1,Kn[bs].length-2))}return xs.sort(function(Cs,ia){return Cs.toLowerCase()<ia.toLowerCase()?-1:Cs.toLowerCase()>ia.toLowerCase()?1:0})}function ol(sa){if(!ca[sa])throw new Un("Unit not recognized");return ys[ca[sa]][0]}var hl=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function wl(){if(this.signature)return this.signature;for(var sa=_l.call(this),bs=0;bs<sa.length;bs++)sa[bs]*=Math.pow(20,bs);return sa.reduce(function(xs,Kn){return xs+Kn},0)}function _l(){if(!this.isBase())return _l.call(this.toBase());for(var sa=new Array(hl.length),bs=0;bs<sa.length;bs++)sa[bs]=0;for(var xs,Kn,Cs=0;Cs<this.numerator.length;Cs++)(xs=ys[this.numerator[Cs]])&&(Kn=hl.indexOf(xs[2]),Kn>=0&&(sa[Kn]=sa[Kn]+1));for(var ia=0;ia<this.denominator.length;ia++)(xs=ys[this.denominator[ia]])&&(Kn=hl.indexOf(xs[2]),Kn>=0&&(sa[Kn]=sa[Kn]-1));return sa}var gl="[+-]",dl="\\d+",sl=gl+"?"+dl,kl="\\."+dl,pl="(?:"+dl+"(?:"+kl+")?)|(?:"+kl+")",Al="[Ee]"+sl,xl="(?:"+pl+")(?:"+Al+")?",al=gl+"?\\s*"+xl,Fl="("+al+")?\\s*([^/]*)(?:/(.+))?",Ol=new RegExp("^"+Fl+"$"),Jo="\\^|\\*{2}",cl="[01234]",rl=new RegExp("([^ \\*\\d]+?)(?:"+Jo+")?(-?"+cl+"(?![a-zA-Z]))"),nl=new RegExp("([^ \\*\\d]+?)(?:"+Jo+")?("+cl+"(?![a-zA-Z]))");function vl(sa){ze(sa)||(sa=sa.toString()),sa=sa.trim();var bs=Ol.exec(sa);if(!bs)throw new Un(sa+": Quantity not recognized");var xs=bs[1];xs?(xs=xs.replace(/\s/g,""),this.scalar=parseFloat(xs)):this.scalar=1;for(var Kn=bs[2],Cs=bs[3],ia,Za,Ja;bs=rl.exec(Kn);){if(ia=parseFloat(bs[2]),isNaN(ia))throw new Un("Unit exponent is not a number");if(ia===0&&!$l.test(bs[1]))throw new Un("Unit not recognized");Za=bs[1]+" ",Ja="";for(var Qa=0;Qa<Math.abs(ia);Qa++)Ja+=Za;ia>=0?Kn=Kn.replace(bs[0],Ja):(Cs=Cs?Cs+Ja:Ja,Kn=Kn.replace(bs[0],""))}for(;bs=nl.exec(Cs);){if(ia=parseFloat(bs[2]),isNaN(ia))throw new Un("Unit exponent is not a number");if(ia===0&&!$l.test(bs[1]))throw new Un("Unit not recognized");Za=bs[1]+" ",Ja="";for(var aa=0;aa<ia;aa++)Ja+=Za;Cs=Cs.replace(bs[0],Ja)}Kn&&(this.numerator=Vl(Kn.trim())),Cs&&(this.denominator=Vl(Cs.trim()))}var Pl=Object.keys(oa).sort(function(sa,bs){return bs.length-sa.length}).join("|"),Sl=Object.keys(ca).sort(function(sa,bs){return bs.length-sa.length}).join("|"),El="\\b|$",Il="("+Pl+")??("+Sl+")(?:"+El+")",$l=new RegExp("^\\s*("+Il+"[\\s\\*]*)+$"),Ll=new RegExp(Il,"g"),ml={};function Vl(sa){var bs=ml[sa];if(bs)return bs;var xs,Kn=[];if(!$l.test(sa))throw new Un("Unit not recognized");for(;xs=Ll.exec(sa);)Kn.push(xs.slice(1));return Kn=Kn.map(function(Cs){return oa[Cs[0]]?[oa[Cs[0]],ca[Cs[1]]]:[ca[Cs[1]]]}),Kn=Kn.reduce(function(Cs,ia){return Cs.concat(ia)},[]),Kn=Kn.filter(function(Cs){return Cs}),ml[sa]=Kn,Kn}function jl(sa){if(!ze(sa))throw new Un("Argument should be a string");try{return this(sa)}catch{return null}}function Xl(sa){return sa instanceof yl}function yl(sa,bs){if(Yl.apply(null,arguments),!Xl(this))return new yl(sa,bs);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=na,this.denominator=na,Rl(sa)?(this.scalar=sa.scalar,this.numerator=sa.numerator&&sa.numerator.length!==0?sa.numerator:na,this.denominator=sa.denominator&&sa.denominator.length!==0?sa.denominator:na):bs?(vl.call(this,bs),this.scalar=sa):vl.call(this,sa),this.denominator.join("*").indexOf("temp")>=0)throw new Un("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new Un("Cannot multiply by temperatures");if(!ln(this.denominator,na))throw new Un("Cannot divide with temperatures")}if(this.initValue=sa,Hl.call(this),this.isTemperature()&&this.baseScalar<0)throw new Un("Temperatures must not be less than absolute zero")}yl.prototype={constructor:yl};function Yl(sa,bs){if(bs){if(!(Qe(sa)&&ze(bs)))throw new Un("Only number accepted as initialization value when units are explicitly provided")}else if(!(ze(sa)||Qe(sa)||Xl(sa)||Rl(sa)))throw new Un("Only string, number or quantity accepted as single initialization value")}function Rl(sa){return sa&&typeof sa=="object"&&sa.hasOwnProperty("scalar")}function Hl(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=wl.call(this);else{var sa=this.toBase();this.baseScalar=sa.scalar,this.signature=sa.signature}}var Wl={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber",0:"unitless",1:"length",2:"area",3:"volume",20:"time",400:"temperature",7941:"yank",7942:"power",7959:"pressure",7961:"force",7962:"energy",7979:"viscosity",7981:"momentum",7982:"angular_momentum",7997:"density",7998:"area_density",8e3:"mass",152020:"radiation_exposure",159999:"magnetism",16e4:"current",160020:"charge",312058:"conductance",312078:"capacitance",3199980:"activity",3199997:"molar_concentration",32e5:"substance",63999998:"illuminance",64e6:"luminous_power",128e7:"currency","25599999980":"information_rate","25600000000":"information","511999999980":"angular_velocity","512000000000":"angle"};function zl(){return nn(Object.keys(Wl).map(function(sa){return Wl[sa]}))}yl.prototype.kind=function(){return Wl[this.signature.toString()]},cn(yl.prototype,{isDegrees:function(){return(this.signature===null||this.signature===400)&&this.numerator.length===1&&ln(this.denominator,na)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}});function Gl(sa,bs){var xs=sa.units(),Kn=bs.to(xs),Cs=yl(Zl(xs));return yl({scalar:sa.scalar-Kn.scalar,numerator:Cs.numerator,denominator:Cs.denominator})}function Jl(sa,bs){var xs=bs.to(Zl(sa.units()));return yl({scalar:sa.scalar-xs.scalar,numerator:sa.numerator,denominator:sa.denominator})}function ql(sa,bs){var xs=bs.to(Zl(sa.units()));return yl({scalar:sa.scalar+xs.scalar,numerator:sa.numerator,denominator:sa.denominator})}function Zl(sa){if(sa==="tempK")return"degK";if(sa==="tempC")return"degC";if(sa==="tempF")return"degF";if(sa==="tempR")return"degR";throw new Un("Unknown type for temp conversion from: "+sa)}function Ql(sa,bs){var xs=ec(sa),Kn=bs.units(),Cs;if(Kn==="degK")Cs=xs.scalar;else if(Kn==="degC")Cs=xs.scalar;else if(Kn==="degF")Cs=xs.scalar*9/5;else if(Kn==="degR")Cs=xs.scalar*9/5;else throw new Un("Unknown type for degree conversion to: "+Kn);return yl({scalar:Cs,numerator:bs.numerator,denominator:bs.denominator})}function ec(sa){var bs=sa.units(),xs;if(bs.match(/(deg)[CFRK]/))xs=sa.baseScalar;else if(bs==="tempK")xs=sa.scalar;else if(bs==="tempC")xs=sa.scalar;else if(bs==="tempF")xs=sa.scalar*5/9;else if(bs==="tempR")xs=sa.scalar*5/9;else throw new Un("Unknown type for temp conversion from: "+bs);return yl({scalar:xs,numerator:["<kelvin>"],denominator:na})}function tc(sa,bs){var xs=bs.units(),Kn;if(xs==="tempK")Kn=sa.baseScalar;else if(xs==="tempC")Kn=sa.baseScalar-273.15;else if(xs==="tempF")Kn=sa.baseScalar*9/5-459.67;else if(xs==="tempR")Kn=sa.baseScalar*9/5;else throw new Un("Unknown type for temp conversion to: "+xs);return yl({scalar:Kn,numerator:bs.numerator,denominator:bs.denominator})}function ac(sa){var bs=sa.units(),xs;if(bs.match(/(deg)[CFRK]/))xs=sa.baseScalar;else if(bs==="tempK")xs=sa.scalar;else if(bs==="tempC")xs=sa.scalar+273.15;else if(bs==="tempF")xs=(sa.scalar+459.67)*5/9;else if(bs==="tempR")xs=sa.scalar*5/9;else throw new Un("Unknown type for temp conversion from: "+bs);return yl({scalar:xs,numerator:["<temp-K>"],denominator:na})}cn(yl.prototype,{to:function(sa){var bs,xs;if(sa==null)return this;if(!ze(sa))return this.to(sa.units());if(bs=this._conversionCache[sa],bs)return bs;if(xs=yl(sa),xs.units()===this.units())return this;if(!this.isCompatible(xs))this.isInverse(xs)?xs=this.inverse().to(sa):qn(this.units(),xs.units());else if(xs.isTemperature())xs=tc(this,xs);else if(xs.isDegrees())xs=Ql(this,xs);else{var Kn=un(this.baseScalar,xs.baseScalar);xs=yl({scalar:Kn,numerator:xs.numerator,denominator:xs.denominator})}return this._conversionCache[sa]=xs,xs},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return ac(this);var sa=fc[this.units()];return sa||(sa=yc(this.numerator,this.denominator),fc[this.units()]=sa),sa.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new Un("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function(sa){if(ze(sa)&&(sa=yl(sa)),Qe(sa)&&(sa=yl(sa+" "+this.units())),this.isUnitless()?sa.isUnitless()||qn(this.units(),sa.units()):sa=sa.to(this.units()),sa.scalar===0)throw new Un("Divide by zero");var bs=hn(Math.round(this.scalar/sa.scalar),sa.scalar);return yl(bs+this.units())}});function oc(sa,bs){var xs=yl(sa),Kn=yl(bs);if(xs.eq(Kn))return Pi;var Cs;return xs.isTemperature()?Cs=function(ia){return xs.mul(ia).to(Kn).scalar}:Cs=function(ia){return ia*xs.baseScalar/Kn.baseScalar},function(Za){var Ja,Qa,aa;if(Array.isArray(Za)){for(Qa=Za.length,aa=[],Ja=0;Ja<Qa;Ja++)aa.push(Cs(Za[Ja]));return aa}else return Cs(Za)}}var fc={};function yc(sa,bs){for(var xs=[],Kn=[],Cs=1,ia,Za=0;Za<sa.length;Za++)ia=sa[Za],ra[ia]?Cs=hn(Cs,ra[ia]):fa[ia]&&(Cs*=fa[ia].scalar,fa[ia].numerator&&xs.push(fa[ia].numerator),fa[ia].denominator&&Kn.push(fa[ia].denominator));for(var Ja=0;Ja<bs.length;Ja++)ia=bs[Ja],ra[ia]?Cs/=ra[ia]:fa[ia]&&(Cs/=fa[ia].scalar,fa[ia].numerator&&Kn.push(fa[ia].numerator),fa[ia].denominator&&xs.push(fa[ia].denominator));return xs=xs.reduce(function(Qa,aa){return Qa.concat(aa)},[]),Kn=Kn.reduce(function(Qa,aa){return Qa.concat(aa)},[]),yl({scalar:Cs,numerator:xs,denominator:Kn})}yl.parse=jl,yl.getUnits=tl,yl.getAliases=ol,yl.mulSafe=hn,yl.divSafe=un,yl.getKinds=zl,yl.swiftConverter=oc,yl.Error=Un,cn(yl.prototype,{add:function(sa){if(ze(sa)&&(sa=yl(sa)),this.isCompatible(sa)||qn(this.units(),sa.units()),this.isTemperature()&&sa.isTemperature())throw new Un("Cannot add two temperatures");return this.isTemperature()?ql(this,sa):sa.isTemperature()?ql(sa,this):yl({scalar:this.scalar+sa.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function(sa){if(ze(sa)&&(sa=yl(sa)),this.isCompatible(sa)||qn(this.units(),sa.units()),this.isTemperature()&&sa.isTemperature())return Gl(this,sa);if(this.isTemperature())return Jl(this,sa);if(sa.isTemperature())throw new Un("Cannot subtract a temperature from a differential degree unit");return yl({scalar:this.scalar-sa.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function(sa){if(Qe(sa))return yl({scalar:hn(this.scalar,sa),numerator:this.numerator,denominator:this.denominator});if(ze(sa)&&(sa=yl(sa)),(this.isTemperature()||sa.isTemperature())&&!(this.isUnitless()||sa.isUnitless()))throw new Un("Cannot multiply by temperatures");var bs=this,xs=sa;bs.isCompatible(xs)&&bs.signature!==400&&(xs=xs.to(bs));var Kn=Cc(bs.numerator,bs.denominator,xs.numerator,xs.denominator);return yl({scalar:hn(bs.scalar,xs.scalar,Kn[2]),numerator:Kn[0],denominator:Kn[1]})},div:function(sa){if(Qe(sa)){if(sa===0)throw new Un("Divide by zero");return yl({scalar:this.scalar/sa,numerator:this.numerator,denominator:this.denominator})}else ze(sa)&&(sa=yl(sa));if(sa.scalar===0)throw new Un("Divide by zero");if(sa.isTemperature())throw new Un("Cannot divide with temperatures");if(this.isTemperature()&&!sa.isUnitless())throw new Un("Cannot divide with temperatures");var bs=this,xs=sa;bs.isCompatible(xs)&&bs.signature!==400&&(xs=xs.to(bs));var Kn=Cc(bs.numerator,bs.denominator,xs.denominator,xs.numerator);return yl({scalar:hn(bs.scalar,Kn[2])/xs.scalar,numerator:Kn[0],denominator:Kn[1]})},inverse:function(){if(this.isTemperature())throw new Un("Cannot divide with temperatures");if(this.scalar===0)throw new Un("Divide by zero");return yl({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}});function Cc(sa,bs,xs,Kn){function Cs(Ka){return Ka!==ea}sa=sa.filter(Cs),xs=xs.filter(Cs),bs=bs.filter(Cs),Kn=Kn.filter(Cs);var ia={};function Za(Ka,Na){for(var el,fl,Ua,il=0;il<Ka.length;il++)if(ra[Ka[il]]?(el=Ka[il+1],fl=Ka[il],Ua=ra[fl],il++):(el=Ka[il],fl=null,Ua=1),el&&el!==ea)if(ia[el]){ia[el][0]+=Na;var ll=ia[el][2]?ra[ia[el][2]]:1;ia[el][Na===1?3:4]*=un(Ua,ll)}else ia[el]=[Na,el,fl,1,1]}Za(sa,1),Za(bs,-1),Za(xs,1),Za(Kn,-1);var Ja=[],Qa=[],aa=1;for(var pa in ia)if(ia.hasOwnProperty(pa)){var ha=ia[pa],Ma;if(ha[0]>0)for(Ma=0;Ma<ha[0];Ma++)Ja.push(ha[2]===null?ha[1]:[ha[2],ha[1]]);else if(ha[0]<0)for(Ma=0;Ma<-ha[0];Ma++)Qa.push(ha[2]===null?ha[1]:[ha[2],ha[1]]);aa*=un(ha[3],ha[4])}return Ja.length===0&&(Ja=na),Qa.length===0&&(Qa=na),Ja=Ja.reduce(function(Ka,Na){return Ka.concat(Na)},[]),Qa=Qa.reduce(function(Ka,Na){return Ka.concat(Na)},[]),[Ja,Qa,aa]}cn(yl.prototype,{eq:function(sa){return this.compareTo(sa)===0},lt:function(sa){return this.compareTo(sa)===-1},lte:function(sa){return this.eq(sa)||this.lt(sa)},gt:function(sa){return this.compareTo(sa)===1},gte:function(sa){return this.eq(sa)||this.gt(sa)},compareTo:function(sa){if(ze(sa))return this.compareTo(yl(sa));if(this.isCompatible(sa)||qn(this.units(),sa.units()),this.baseScalar<sa.baseScalar)return-1;if(this.baseScalar===sa.baseScalar)return 0;if(this.baseScalar>sa.baseScalar)return 1},same:function(sa){return this.scalar===sa.scalar&&this.units()===sa.units()}}),cn(yl.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every(function(sa){return ln(sa,na)})},isCompatible:function(sa){return ze(sa)?this.isCompatible(yl(sa)):Xl(sa)&&sa.signature!==void 0?this.signature===sa.signature:!1},isInverse:function(sa){return this.inverse().isCompatible(sa)},isBase:function(){return this._isBase!==void 0?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach(function(sa){sa!==ea&&vs.indexOf(sa)===-1&&(this._isBase=!1)},this),this._isBase===!1?this._isBase:(this._isBase=!0,this._isBase))}});function pc(){}pc.prototype.get=function(sa){return arguments.length>1&&(sa=Array.apply(null,arguments)),sa.reduce(function(bs,xs,Kn){if(bs){var Cs=bs[xs];return Kn===sa.length-1?Cs?Cs.data:void 0:Cs}},this)},pc.prototype.set=function(sa,bs){return arguments.length>2&&(sa=Array.prototype.slice.call(arguments,0,-1),bs=arguments[arguments.length-1]),sa.reduce(function(xs,Kn,Cs){var ia=xs[Kn];return ia===void 0&&(ia=xs[Kn]={}),Cs===sa.length-1?(ia.data=bs,bs):ia},this)};function xc(sa,bs){return(sa+" "+bs).trim()}yl.formatter=xc,cn(yl.prototype,{units:function(){if(this._units!==void 0)return this._units;var sa=ln(this.numerator,na),bs=ln(this.denominator,na);if(sa&&bs)return this._units="",this._units;var xs=mc(this.numerator),Kn=mc(this.denominator);return this._units=xs+(bs?"":"/"+Kn),this._units},toString:function(sa,bs){var xs;if(Qe(sa))xs=this.units(),bs=sa;else if(ze(sa))xs=sa;else if(Xl(sa))return this.toPrec(sa).toString(bs);var Kn=this.to(xs),Cs=bs!==void 0?zn(Kn.scalar,bs):Kn.scalar;return Kn=(Cs+" "+Kn.units()).trim(),Kn},format:function(sa,bs){arguments.length===1&&typeof sa=="function"&&(bs=sa,sa=void 0),bs=bs||yl.formatter;var xs=this.to(sa);return bs.call(this,xs.scalar,xs.units())}});var bc=new pc;function mc(sa){var bs=bc.get(sa);if(bs)return bs;var xs=ln(sa,na);return xs?bs="1":bs=Sc(uc(sa)).join("*"),bc.set(sa,bs),bs}function uc(sa){for(var bs=[],xs,Kn,Cs=0;Cs<sa.length;Cs++)xs=sa[Cs],Kn=sa[Cs+1],ra[xs]?(bs.push(la[xs]+la[Kn]),Cs++):bs.push(la[xs]);return bs}function Sc(sa){var bs=sa.reduce(function(xs,Kn){var Cs=xs[Kn];return Cs||xs.push(Cs=xs[Kn]=[Kn,0]),Cs[1]++,xs},[]);return bs.map(function(xs){return xs[0]+(xs[1]>1?xs[1]:"")})}return yl.version="1.8.0",yl})}(quantities$1)),quantities$1.exports}var quantitiesExports=requireQuantities();const Qty=getDefaultExportFromCjs(quantitiesExports);function deepValue(qe,f=""){let ze=f.split(".");for(let Ke of ze){if(qe[Ke]===void 0)return;qe=qe[Ke]}return qe}var orientation={exports:{}},twoProduct_1,hasRequiredTwoProduct;function requireTwoProduct(){if(hasRequiredTwoProduct)return twoProduct_1;hasRequiredTwoProduct=1,twoProduct_1=f;var qe=+(Math.pow(2,27)+1);function f(ze,Ke,Qe){var Pi=ze*Ke,nn=qe*ze,ln=nn-ze,cn=nn-ln,hn=ze-cn,un=qe*Ke,zn=un-Ke,Xn=un-zn,Un=Ke-Xn,qn=Pi-cn*Xn,ys=qn-hn*Xn,vs=ys-cn*Un,ea=hn*Un-vs;return Qe?(Qe[0]=ea,Qe[1]=Pi,Qe):[ea,Pi]}return twoProduct_1}var robustSum,hasRequiredRobustSum;function requireRobustSum(){if(hasRequiredRobustSum)return robustSum;hasRequiredRobustSum=1,robustSum=f;function qe(ze,Ke){var Qe=ze+Ke,Pi=Qe-ze,nn=Qe-Pi,ln=Ke-Pi,cn=ze-nn,hn=cn+ln;return hn?[hn,Qe]:[Qe]}function f(ze,Ke){var Qe=ze.length|0,Pi=Ke.length|0;if(Qe===1&&Pi===1)return qe(ze[0],Ke[0]);var nn=Qe+Pi,ln=new Array(nn),cn=0,hn=0,un=0,zn=Math.abs,Xn=ze[hn],Un=zn(Xn),qn=Ke[un],ys=zn(qn),vs,ea;Un<ys?(ea=Xn,hn+=1,hn<Qe&&(Xn=ze[hn],Un=zn(Xn))):(ea=qn,un+=1,un<Pi&&(qn=Ke[un],ys=zn(qn))),hn<Qe&&Un<ys||un>=Pi?(vs=Xn,hn+=1,hn<Qe&&(Xn=ze[hn],Un=zn(Xn))):(vs=qn,un+=1,un<Pi&&(qn=Ke[un],ys=zn(qn)));for(var na=vs+ea,ta=na-vs,ra=ea-ta,oa=ra,fa=na,ca,la,ua,ga,da;hn<Qe&&un<Pi;)Un<ys?(vs=Xn,hn+=1,hn<Qe&&(Xn=ze[hn],Un=zn(Xn))):(vs=qn,un+=1,un<Pi&&(qn=Ke[un],ys=zn(qn))),ea=oa,na=vs+ea,ta=na-vs,ra=ea-ta,ra&&(ln[cn++]=ra),ca=fa+na,la=ca-fa,ua=ca-la,ga=na-la,da=fa-ua,oa=da+ga,fa=ca;for(;hn<Qe;)vs=Xn,ea=oa,na=vs+ea,ta=na-vs,ra=ea-ta,ra&&(ln[cn++]=ra),ca=fa+na,la=ca-fa,ua=ca-la,ga=na-la,da=fa-ua,oa=da+ga,fa=ca,hn+=1,hn<Qe&&(Xn=ze[hn]);for(;un<Pi;)vs=qn,ea=oa,na=vs+ea,ta=na-vs,ra=ea-ta,ra&&(ln[cn++]=ra),ca=fa+na,la=ca-fa,ua=ca-la,ga=na-la,da=fa-ua,oa=da+ga,fa=ca,un+=1,un<Pi&&(qn=Ke[un]);return oa&&(ln[cn++]=oa),fa&&(ln[cn++]=fa),cn||(ln[cn++]=0),ln.length=cn,ln}return robustSum}var twoSum,hasRequiredTwoSum;function requireTwoSum(){if(hasRequiredTwoSum)return twoSum;hasRequiredTwoSum=1,twoSum=qe;function qe(f,ze,Ke){var Qe=f+ze,Pi=Qe-f,nn=Qe-Pi,ln=ze-Pi,cn=f-nn;return Ke?(Ke[0]=cn+ln,Ke[1]=Qe,Ke):[cn+ln,Qe]}return twoSum}var robustScale,hasRequiredRobustScale;function requireRobustScale(){if(hasRequiredRobustScale)return robustScale;hasRequiredRobustScale=1;var qe=requireTwoProduct(),f=requireTwoSum();robustScale=ze;function ze(Ke,Qe){var Pi=Ke.length;if(Pi===1){var nn=qe(Ke[0],Qe);return nn[0]?nn:[nn[1]]}var ln=new Array(2*Pi),cn=[.1,.1],hn=[.1,.1],un=0;qe(Ke[0],Qe,cn),cn[0]&&(ln[un++]=cn[0]);for(var zn=1;zn<Pi;++zn){qe(Ke[zn],Qe,hn);var Xn=cn[1];f(Xn,hn[0],cn),cn[0]&&(ln[un++]=cn[0]);var Un=hn[1],qn=cn[1],ys=Un+qn,vs=ys-Un,ea=qn-vs;cn[1]=ys,ea&&(ln[un++]=ea)}return cn[1]&&(ln[un++]=cn[1]),un===0&&(ln[un++]=0),ln.length=un,ln}return robustScale}var robustDiff,hasRequiredRobustDiff;function requireRobustDiff(){if(hasRequiredRobustDiff)return robustDiff;hasRequiredRobustDiff=1,robustDiff=f;function qe(ze,Ke){var Qe=ze+Ke,Pi=Qe-ze,nn=Qe-Pi,ln=Ke-Pi,cn=ze-nn,hn=cn+ln;return hn?[hn,Qe]:[Qe]}function f(ze,Ke){var Qe=ze.length|0,Pi=Ke.length|0;if(Qe===1&&Pi===1)return qe(ze[0],-Ke[0]);var nn=Qe+Pi,ln=new Array(nn),cn=0,hn=0,un=0,zn=Math.abs,Xn=ze[hn],Un=zn(Xn),qn=-Ke[un],ys=zn(qn),vs,ea;Un<ys?(ea=Xn,hn+=1,hn<Qe&&(Xn=ze[hn],Un=zn(Xn))):(ea=qn,un+=1,un<Pi&&(qn=-Ke[un],ys=zn(qn))),hn<Qe&&Un<ys||un>=Pi?(vs=Xn,hn+=1,hn<Qe&&(Xn=ze[hn],Un=zn(Xn))):(vs=qn,un+=1,un<Pi&&(qn=-Ke[un],ys=zn(qn)));for(var na=vs+ea,ta=na-vs,ra=ea-ta,oa=ra,fa=na,ca,la,ua,ga,da;hn<Qe&&un<Pi;)Un<ys?(vs=Xn,hn+=1,hn<Qe&&(Xn=ze[hn],Un=zn(Xn))):(vs=qn,un+=1,un<Pi&&(qn=-Ke[un],ys=zn(qn))),ea=oa,na=vs+ea,ta=na-vs,ra=ea-ta,ra&&(ln[cn++]=ra),ca=fa+na,la=ca-fa,ua=ca-la,ga=na-la,da=fa-ua,oa=da+ga,fa=ca;for(;hn<Qe;)vs=Xn,ea=oa,na=vs+ea,ta=na-vs,ra=ea-ta,ra&&(ln[cn++]=ra),ca=fa+na,la=ca-fa,ua=ca-la,ga=na-la,da=fa-ua,oa=da+ga,fa=ca,hn+=1,hn<Qe&&(Xn=ze[hn]);for(;un<Pi;)vs=qn,ea=oa,na=vs+ea,ta=na-vs,ra=ea-ta,ra&&(ln[cn++]=ra),ca=fa+na,la=ca-fa,ua=ca-la,ga=na-la,da=fa-ua,oa=da+ga,fa=ca,un+=1,un<Pi&&(qn=-Ke[un]);return oa&&(ln[cn++]=oa),fa&&(ln[cn++]=fa),cn||(ln[cn++]=0),ln.length=cn,ln}return robustDiff}var hasRequiredOrientation;function requireOrientation(){return hasRequiredOrientation||(hasRequiredOrientation=1,function(qe){var f=requireTwoProduct(),ze=requireRobustSum(),Ke=requireRobustScale(),Qe=requireRobustDiff(),Pi=5,nn=11102230246251565e-32,ln=(3+16*nn)*nn,cn=(7+56*nn)*nn;function hn(ta,ra,oa,fa){return function(la,ua,ga){var da=ta(ta(ra(ua[1],ga[0]),ra(-ga[1],ua[0])),ta(ra(la[1],ua[0]),ra(-ua[1],la[0]))),qa=ta(ra(la[1],ga[0]),ra(-ga[1],la[0])),tl=fa(da,qa);return tl[tl.length-1]}}function un(ta,ra,oa,fa){return function(la,ua,ga,da){var qa=ta(ta(oa(ta(ra(ga[1],da[0]),ra(-da[1],ga[0])),ua[2]),ta(oa(ta(ra(ua[1],da[0]),ra(-da[1],ua[0])),-ga[2]),oa(ta(ra(ua[1],ga[0]),ra(-ga[1],ua[0])),da[2]))),ta(oa(ta(ra(ua[1],da[0]),ra(-da[1],ua[0])),la[2]),ta(oa(ta(ra(la[1],da[0]),ra(-da[1],la[0])),-ua[2]),oa(ta(ra(la[1],ua[0]),ra(-ua[1],la[0])),da[2])))),tl=ta(ta(oa(ta(ra(ga[1],da[0]),ra(-da[1],ga[0])),la[2]),ta(oa(ta(ra(la[1],da[0]),ra(-da[1],la[0])),-ga[2]),oa(ta(ra(la[1],ga[0]),ra(-ga[1],la[0])),da[2]))),ta(oa(ta(ra(ua[1],ga[0]),ra(-ga[1],ua[0])),la[2]),ta(oa(ta(ra(la[1],ga[0]),ra(-ga[1],la[0])),-ua[2]),oa(ta(ra(la[1],ua[0]),ra(-ua[1],la[0])),ga[2])))),ol=fa(qa,tl);return ol[ol.length-1]}}function zn(ta,ra,oa,fa){return function(la,ua,ga,da,qa){var tl=ta(ta(ta(oa(ta(oa(ta(ra(da[1],qa[0]),ra(-qa[1],da[0])),ga[2]),ta(oa(ta(ra(ga[1],qa[0]),ra(-qa[1],ga[0])),-da[2]),oa(ta(ra(ga[1],da[0]),ra(-da[1],ga[0])),qa[2]))),ua[3]),ta(oa(ta(oa(ta(ra(da[1],qa[0]),ra(-qa[1],da[0])),ua[2]),ta(oa(ta(ra(ua[1],qa[0]),ra(-qa[1],ua[0])),-da[2]),oa(ta(ra(ua[1],da[0]),ra(-da[1],ua[0])),qa[2]))),-ga[3]),oa(ta(oa(ta(ra(ga[1],qa[0]),ra(-qa[1],ga[0])),ua[2]),ta(oa(ta(ra(ua[1],qa[0]),ra(-qa[1],ua[0])),-ga[2]),oa(ta(ra(ua[1],ga[0]),ra(-ga[1],ua[0])),qa[2]))),da[3]))),ta(oa(ta(oa(ta(ra(ga[1],da[0]),ra(-da[1],ga[0])),ua[2]),ta(oa(ta(ra(ua[1],da[0]),ra(-da[1],ua[0])),-ga[2]),oa(ta(ra(ua[1],ga[0]),ra(-ga[1],ua[0])),da[2]))),-qa[3]),ta(oa(ta(oa(ta(ra(da[1],qa[0]),ra(-qa[1],da[0])),ua[2]),ta(oa(ta(ra(ua[1],qa[0]),ra(-qa[1],ua[0])),-da[2]),oa(ta(ra(ua[1],da[0]),ra(-da[1],ua[0])),qa[2]))),la[3]),oa(ta(oa(ta(ra(da[1],qa[0]),ra(-qa[1],da[0])),la[2]),ta(oa(ta(ra(la[1],qa[0]),ra(-qa[1],la[0])),-da[2]),oa(ta(ra(la[1],da[0]),ra(-da[1],la[0])),qa[2]))),-ua[3])))),ta(ta(oa(ta(oa(ta(ra(ua[1],qa[0]),ra(-qa[1],ua[0])),la[2]),ta(oa(ta(ra(la[1],qa[0]),ra(-qa[1],la[0])),-ua[2]),oa(ta(ra(la[1],ua[0]),ra(-ua[1],la[0])),qa[2]))),da[3]),ta(oa(ta(oa(ta(ra(ua[1],da[0]),ra(-da[1],ua[0])),la[2]),ta(oa(ta(ra(la[1],da[0]),ra(-da[1],la[0])),-ua[2]),oa(ta(ra(la[1],ua[0]),ra(-ua[1],la[0])),da[2]))),-qa[3]),oa(ta(oa(ta(ra(ga[1],da[0]),ra(-da[1],ga[0])),ua[2]),ta(oa(ta(ra(ua[1],da[0]),ra(-da[1],ua[0])),-ga[2]),oa(ta(ra(ua[1],ga[0]),ra(-ga[1],ua[0])),da[2]))),la[3]))),ta(oa(ta(oa(ta(ra(ga[1],da[0]),ra(-da[1],ga[0])),la[2]),ta(oa(ta(ra(la[1],da[0]),ra(-da[1],la[0])),-ga[2]),oa(ta(ra(la[1],ga[0]),ra(-ga[1],la[0])),da[2]))),-ua[3]),ta(oa(ta(oa(ta(ra(ua[1],da[0]),ra(-da[1],ua[0])),la[2]),ta(oa(ta(ra(la[1],da[0]),ra(-da[1],la[0])),-ua[2]),oa(ta(ra(la[1],ua[0]),ra(-ua[1],la[0])),da[2]))),ga[3]),oa(ta(oa(ta(ra(ua[1],ga[0]),ra(-ga[1],ua[0])),la[2]),ta(oa(ta(ra(la[1],ga[0]),ra(-ga[1],la[0])),-ua[2]),oa(ta(ra(la[1],ua[0]),ra(-ua[1],la[0])),ga[2]))),-da[3]))))),ol=ta(ta(ta(oa(ta(oa(ta(ra(da[1],qa[0]),ra(-qa[1],da[0])),ga[2]),ta(oa(ta(ra(ga[1],qa[0]),ra(-qa[1],ga[0])),-da[2]),oa(ta(ra(ga[1],da[0]),ra(-da[1],ga[0])),qa[2]))),la[3]),oa(ta(oa(ta(ra(da[1],qa[0]),ra(-qa[1],da[0])),la[2]),ta(oa(ta(ra(la[1],qa[0]),ra(-qa[1],la[0])),-da[2]),oa(ta(ra(la[1],da[0]),ra(-da[1],la[0])),qa[2]))),-ga[3])),ta(oa(ta(oa(ta(ra(ga[1],qa[0]),ra(-qa[1],ga[0])),la[2]),ta(oa(ta(ra(la[1],qa[0]),ra(-qa[1],la[0])),-ga[2]),oa(ta(ra(la[1],ga[0]),ra(-ga[1],la[0])),qa[2]))),da[3]),oa(ta(oa(ta(ra(ga[1],da[0]),ra(-da[1],ga[0])),la[2]),ta(oa(ta(ra(la[1],da[0]),ra(-da[1],la[0])),-ga[2]),oa(ta(ra(la[1],ga[0]),ra(-ga[1],la[0])),da[2]))),-qa[3]))),ta(ta(oa(ta(oa(ta(ra(ga[1],qa[0]),ra(-qa[1],ga[0])),ua[2]),ta(oa(ta(ra(ua[1],qa[0]),ra(-qa[1],ua[0])),-ga[2]),oa(ta(ra(ua[1],ga[0]),ra(-ga[1],ua[0])),qa[2]))),la[3]),oa(ta(oa(ta(ra(ga[1],qa[0]),ra(-qa[1],ga[0])),la[2]),ta(oa(ta(ra(la[1],qa[0]),ra(-qa[1],la[0])),-ga[2]),oa(ta(ra(la[1],ga[0]),ra(-ga[1],la[0])),qa[2]))),-ua[3])),ta(oa(ta(oa(ta(ra(ua[1],qa[0]),ra(-qa[1],ua[0])),la[2]),ta(oa(ta(ra(la[1],qa[0]),ra(-qa[1],la[0])),-ua[2]),oa(ta(ra(la[1],ua[0]),ra(-ua[1],la[0])),qa[2]))),ga[3]),oa(ta(oa(ta(ra(ua[1],ga[0]),ra(-ga[1],ua[0])),la[2]),ta(oa(ta(ra(la[1],ga[0]),ra(-ga[1],la[0])),-ua[2]),oa(ta(ra(la[1],ua[0]),ra(-ua[1],la[0])),ga[2]))),-qa[3])))),hl=fa(tl,ol);return hl[hl.length-1]}}function Xn(ta){var ra=ta===3?hn:ta===4?un:zn;return ra(ze,f,Ke,Qe)}var Un=Xn(3),qn=Xn(4),ys=[function(){return 0},function(){return 0},function(ra,oa){return oa[0]-ra[0]},function(ra,oa,fa){var ca=(ra[1]-fa[1])*(oa[0]-fa[0]),la=(ra[0]-fa[0])*(oa[1]-fa[1]),ua=ca-la,ga;if(ca>0){if(la<=0)return ua;ga=ca+la}else if(ca<0){if(la>=0)return ua;ga=-(ca+la)}else return ua;var da=ln*ga;return ua>=da||ua<=-da?ua:Un(ra,oa,fa)},function(ra,oa,fa,ca){var la=ra[0]-ca[0],ua=oa[0]-ca[0],ga=fa[0]-ca[0],da=ra[1]-ca[1],qa=oa[1]-ca[1],tl=fa[1]-ca[1],ol=ra[2]-ca[2],hl=oa[2]-ca[2],wl=fa[2]-ca[2],_l=ua*tl,gl=ga*qa,dl=ga*da,sl=la*tl,kl=la*qa,pl=ua*da,Al=ol*(_l-gl)+hl*(dl-sl)+wl*(kl-pl),xl=(Math.abs(_l)+Math.abs(gl))*Math.abs(ol)+(Math.abs(dl)+Math.abs(sl))*Math.abs(hl)+(Math.abs(kl)+Math.abs(pl))*Math.abs(wl),al=cn*xl;return Al>al||-Al>al?Al:qn(ra,oa,fa,ca)}];function vs(ta){var ra=ys[ta.length];return ra||(ra=ys[ta.length]=Xn(ta.length)),ra.apply(void 0,ta)}function ea(ta,ra,oa,fa,ca,la,ua){return function(da,qa,tl,ol,hl){switch(arguments.length){case 0:case 1:return 0;case 2:return fa(da,qa);case 3:return ca(da,qa,tl);case 4:return la(da,qa,tl,ol);case 5:return ua(da,qa,tl,ol,hl)}for(var wl=new Array(arguments.length),_l=0;_l<arguments.length;++_l)wl[_l]=arguments[_l];return ta(wl)}}function na(){for(;ys.length<=Pi;)ys.push(Xn(ys.length));qe.exports=ea.apply(void 0,[vs].concat(ys));for(var ta=0;ta<=Pi;++ta)qe.exports[ta]=ys[ta]}na()}(orientation)),orientation.exports}var robustPnp,hasRequiredRobustPnp;function requireRobustPnp(){if(hasRequiredRobustPnp)return robustPnp;hasRequiredRobustPnp=1,robustPnp=f;var qe=requireOrientation();function f(ze,Ke){for(var Qe=Ke[0],Pi=Ke[1],nn=ze.length,ln=1,cn=nn,hn=0,un=nn-1;hn<cn;un=hn++){var zn=ze[hn],Xn=ze[un],Un=zn[1],qn=Xn[1];if(qn<Un){if(qn<Pi&&Pi<Un){var ys=qe(zn,Xn,Ke);if(ys===0)return 0;ln^=0<ys|0}else if(Pi===Un){var vs=ze[(hn+1)%nn],ea=vs[1];if(Un<ea){var ys=qe(zn,Xn,Ke);if(ys===0)return 0;ln^=0<ys|0}}}else if(Un<qn){if(Un<Pi&&Pi<qn){var ys=qe(zn,Xn,Ke);if(ys===0)return 0;ln^=ys<0|0}else if(Pi===Un){var vs=ze[(hn+1)%nn],ea=vs[1];if(ea<Un){var ys=qe(zn,Xn,Ke);if(ys===0)return 0;ln^=ys<0|0}}}else if(Pi===Un){var na=Math.min(zn[0],Xn[0]),ta=Math.max(zn[0],Xn[0]);if(hn===0){for(;un>0;){var ra=(un+nn-1)%nn,oa=ze[ra];if(oa[1]!==Pi)break;var fa=oa[0];na=Math.min(na,fa),ta=Math.max(ta,fa),un=ra}if(un===0)return na<=Qe&&Qe<=ta?0:1;cn=un+1}for(var ca=ze[(un+nn-1)%nn][1];hn+1<cn;){var oa=ze[hn+1];if(oa[1]!==Pi)break;var fa=oa[0];na=Math.min(na,fa),ta=Math.max(ta,fa),hn+=1}if(na<=Qe&&Qe<=ta)return 0;var la=ze[(hn+1)%nn][1];Qe<na&&ca<Pi!=la<Pi&&(ln^=1)}}return 2*ln-1}return robustPnp}var robustPnpExports=requireRobustPnp();const robustPointInPolygon=getDefaultExportFromCjs(robustPnpExports);function feretDiameters(qe={}){const{originalPoints:f=monotoneChainConvexHull.call(this)}=qe;if(f.length===0)return{min:0,max:0,minLine:[],maxLine:[],aspectRatio:1};if(f.length===1)return{min:1,max:1,minLine:[f[0],f[0]],maxLine:[f[0],f[0]],aspectRatio:1};const ze=new Array(f.length);let Ke=1/0,Qe=0,Pi=[];for(let hn=0;hn<f.length;hn++){let un=getAngle(f[hn],f[(hn+1)%f.length]);rotate(-un,f,ze);let zn=0,Xn=[];for(let Un=0;Un<f.length;Un++){let qn=Math.abs(ze[hn][1]-ze[Un][1]);qn>zn&&(zn=qn,Xn=[],Xn.push([ze[Un][0],ze[hn][1]],[ze[Un][0],ze[Un][1]]))}zn<Ke&&(Ke=zn,Qe=un,Pi=Xn)}rotate(Qe,Pi,Pi);let nn=0,ln=[],cn=0;for(let hn=0;hn<f.length-1;hn++)for(let un=hn+1;un<f.length;un++){let zn=(f[hn][0]-f[un][0])**2+(f[hn][1]-f[un][1])**2;zn>cn&&(cn=zn,nn=Math.sqrt(zn),ln=[f[hn],f[un]])}return{min:Ke,minLine:Pi,max:nn,maxLine:ln,aspectRatio:Ke/nn}}function getAngle(qe,f){let ze=difference(f,qe),Ke=normalize(ze),Qe=Math.acos(Ke[0]);return Ke[1]<0?-Qe:Qe}class Roi{constructor(f,ze){this.map=f,this.id=ze,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(f={}){const{scale:ze=1,kind:Ke=""}=f;let Qe;switch(Ke){case"contour":Qe=this.contourMask;break;case"box":Qe=this.boxMask;break;case"filled":Qe=this.filledMask;break;case"center":Qe=this.centerMask;break;case"mbr":Qe=this.mbrFilledMask;break;case"hull":Qe=this.convexHullFilledMask;break;case"hullContour":Qe=this.convexHullMask;break;case"mbrContour":Qe=this.mbrMask;break;case"feret":Qe=this.feretMask;break;default:Qe=this.mask}return ze<1&&(Qe=Qe.resize({factor:ze}),Qe.parent=this.mask.parent,Qe.position[0]+=this.minX,Qe.position[1]+=this.minY),Qe}get mean(){throw new Error("Roi mean not implemented yet")}get center(){return this.computed.center||(this.computed.center=[this.width/2>>0,this.height/2>>0]),this.computed.center}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){let f=this.borderIDs,ze=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];let Ke=this.internalIDs;for(let Qe=0;Qe<f.length;Qe++)Ke.includes(f[Qe])||(this.computed.externalIDs.push(f[Qe]),this.computed.externalLengths.push(ze[Qe]))}get externalIDs(){return this.computed.externalIDs?this.computed.externalIDs:(this._computExternalIDs(),this.computed.externalIDs)}get externalLengths(){return this.computed.externalLengths?this.computed.externalLengths:(this._computExternalIDs(),this.computed.externalLengths)}_computeBorderIDs(){let f=getBorders(this);this.computed.borderIDs=f.ids,this.computed.borderLengths=f.lengths}get borderIDs(){return this.computed.borderIDs?this.computed.borderIDs:(this._computeBorderIDs(),this.computed.borderIDs)}get borderLengths(){return this.computed.borderLengths?this.computed.borderLengths:(this._computeBorderIDs(),this.computed.borderLengths)}get boxIDs(){return this.computed.boxIDs||(this.computed.boxIDs=getBoxIDs(this)),this.computed.boxIDs}get internalIDs(){return this.computed.internalIDs||(this.computed.internalIDs=getInternalIDs(this)),this.computed.internalIDs}get box(){return this.computed.box||(this.computed.box=getBox(this)),this.computed.box}get external(){return this.computed.external||(this.computed.external=getExternal(this)),this.computed.external}get holesInfo(){return this.computed.holesInfo||(this.computed.holesInfo=getHolesInfo(this)),this.computed.holesInfo}get border(){return this.computed.border||(this.computed.border=getBorder(this)),this.computed.border}get contourMask(){if(!this.computed.contourMask){let f=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let ze=0;ze<this.width;ze++)for(let Ke=0;Ke<this.height;Ke++)this.map.data[ze+this.minX+(Ke+this.minY)*this.map.width]===this.id&&(ze>0&&ze<this.width-1&&Ke>0&&Ke<this.height-1?(this.map.data[ze-1+this.minX+(Ke+this.minY)*this.map.width]!==this.id||this.map.data[ze+1+this.minX+(Ke+this.minY)*this.map.width]!==this.id||this.map.data[ze+this.minX+(Ke-1+this.minY)*this.map.width]!==this.id||this.map.data[ze+this.minX+(Ke+1+this.minY)*this.map.width]!==this.id)&&f.setBitXY(ze,Ke):f.setBitXY(ze,Ke));this.computed.contourMask=f}return this.computed.contourMask}get boxMask(){if(!this.computed.boxMask){let f=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let ze=0;ze<this.width;ze++)f.setBitXY(ze,0),f.setBitXY(ze,this.height-1);for(let ze=0;ze<this.height;ze++)f.setBitXY(0,ze),f.setBitXY(this.width-1,ze);this.computed.boxMask=f}return this.computed.boxMask}get mask(){if(!this.computed.mask){let f=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let ze=0;ze<this.width;ze++)for(let Ke=0;Ke<this.height;Ke++)this.map.data[ze+this.minX+(Ke+this.minY)*this.map.width]===this.id&&f.setBitXY(ze,Ke);this.computed.mask=f}return this.computed.mask}get filledMask(){if(!this.computed.filledMask){let f=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let ze=0;ze<this.width;ze++)for(let Ke=0;Ke<this.height;Ke++){let Qe=ze+this.minX+(Ke+this.minY)*this.map.width;this.internalIDs.includes(this.map.data[Qe])&&f.setBitXY(ze,Ke)}this.computed.filledMask=f}return this.computed.filledMask}get centerMask(){if(!this.computed.centerMask){let f=new Shape({kind:"smallCross"}).getMask();f.parent=this.map.parent,f.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=f}return this.computed.centerMask}get convexHull(){if(!this.computed.convexHull){const f=[];for(let Ke=0;Ke<this.width;Ke++)for(let Qe=0;Qe<this.height;Qe++)this.map.data[Ke+this.minX+(Qe+this.minY)*this.map.width]===this.id&&(Ke>0&&Ke<this.width-1&&Qe>0&&Qe<this.height-1?(this.map.data[Ke-1+this.minX+(Qe+this.minY)*this.map.width]!==this.id||this.map.data[Ke+1+this.minX+(Qe+this.minY)*this.map.width]!==this.id||this.map.data[Ke+this.minX+(Qe-1+this.minY)*this.map.width]!==this.id||this.map.data[Ke+this.minX+(Qe+1+this.minY)*this.map.width]!==this.id)&&(f.push([Ke,Qe]),f.push([Ke+1,Qe]),f.push([Ke,Qe+1]),f.push([Ke+1,Qe+1])):(f.push([Ke,Qe]),f.push([Ke+1,Qe]),f.push([Ke,Qe+1]),f.push([Ke+1,Qe+1])));const ze=monotoneChainConvexHull$1(f);this.computed.convexHull={polyline:ze,surface:surface(ze),perimeter:perimeter(ze)}}return this.computed.convexHull}get convexHullMask(){if(!this.computed.convexHullMask){const f=this.convexHull,ze=new Image$1(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});ze.paintPolyline(f.polyline,{closed:!0}),this.computed.convexHullMask=ze}return this.computed.convexHullMask}get convexHullFilledMask(){if(!this.computed.convexHullFilledMask){const f=this.convexHull,ze=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let Ke=0;Ke<this.width;Ke++)for(let Qe=0;Qe<this.height;Qe++)robustPointInPolygon(f.polyline,[Ke,Qe])!==1&&ze.setBitXY(Ke,Qe);this.computed.convexHullFilledMask=ze}return this.computed.convexHullFilledMask}get mbr(){if(!this.computed.mbr){let f=minimalBoundingRectangle({originalPoints:this.convexHull.polyline});if(f.length===0)this.computed.mbr={width:0,height:0,surface:0,perimeter:0,rectangle:f};else{let ze=f[0],Ke=f[1],Qe=f[2],Pi=Math.sqrt((ze[0]-Ke[0])**2+(ze[1]-Ke[1])**2),nn=Math.sqrt((Qe[0]-Ke[0])**2+(Qe[1]-Ke[1])**2);this.computed.mbr={width:Pi,height:nn,elongation:1-Pi/nn,aspectRatio:Pi/nn,surface:Pi*nn,perimeter:(Pi+nn)*2,rectangle:f}}}return this.computed.mbr}get filledSurface(){return this.surface+this.holesInfo.surface}get fillRatio(){return this.surface/(this.surface+this.holesInfo.surface)}get feretDiameters(){return this.computed.feretDiameters||(this.computed.feretDiameters=feretDiameters({originalPoints:this.convexHull.polyline})),this.computed.feretDiameters}get eqpc(){return this.computed.eqpc||(this.computed.eqpc=2*Math.sqrt(this.surface/Math.PI)),this.computed.eqpc}get perimeterInfo(){return this.computed.perimeterInfo||(this.computed.perimeterInfo=getPerimeterInfo(this)),this.computed.perimeterInfo}get perimeter(){let f=this.perimeterInfo,ze=2-Math.sqrt(2);return f.one+f.two*2+f.three*3+f.four*4-ze*(f.two+f.three*2+f.four)}get ped(){return this.computed.ped||(this.computed.ped=this.perimeter/Math.PI),this.computed.ped}get feretMask(){if(!this.computed.feretMask){const f=new Image$1(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});f.paintPolyline(this.feretDiameters.minLine),f.paintPolyline(this.feretDiameters.maxLine),this.computed.feretMask=f}return this.computed.feretMask}get mbrMask(){if(!this.computed.mbrMask){let f=round(this.mbr.rectangle);if(f.length>0){const ze=minMax(f),Ke=new Image$1(ze[1][0]-ze[0][0]+1,ze[1][1]-ze[0][1]+1,{kind:BINARY,position:[this.minX+ze[0][0],this.minY+ze[0][1]],parent:this.map.parent});f=moveToZeroZero(f),Ke.paintPolyline(f,{closed:!0}),this.computed.mbrMask=Ke}else this.computed.mbrMask=new Image$1(1,1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent})}return this.computed.mbrMask}get mbrFilledMask(){if(!this.computed.mbrFilledMask){const f=new Image$1(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),ze=this.mask.minimalBoundingRectangle();for(let Ke=0;Ke<this.width;Ke++)for(let Qe=0;Qe<this.height;Qe++)robustPointInPolygon(ze,[Ke,Qe])!==1&&f.setBitXY(Ke,Qe);this.computed.mbrFilledMask=f}return this.computed.mbrFilledMask}get points(){if(!this.computed.points){let f=[];for(let ze=0;ze<this.height;ze++)for(let Ke=0;Ke<this.width;Ke++){let Qe=(ze+this.minY)*this.map.width+Ke+this.minX;this.map.data[Qe]===this.id&&f.push([Ke,ze])}this.computed.points=f}return this.computed.points}get maxLengthPoints(){if(!this.computed.maxLengthPoints){let f=0,ze;const Ke=this.points;for(let Qe=0;Qe<Ke.length;Qe++)for(let Pi=Qe+1;Pi<Ke.length;Pi++){let nn=Math.pow(Ke[Qe][0]-Ke[Pi][0],2)+Math.pow(Ke[Qe][1]-Ke[Pi][1],2);nn>=f&&(f=nn,ze=[Ke[Qe],Ke[Pi]])}this.computed.maxLengthPoints=ze}return this.computed.maxLengthPoints}get maxLength(){if(!this.computed.maxLength){let f=Math.sqrt(Math.pow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+Math.pow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));this.computed.maxLength=f}return this.computed.maxLength}get roundness(){return 4*this.surface/(Math.PI*this.feretDiameters.max**2)}get sphericity(){return 2*Math.sqrt(this.surface*Math.PI)/this.perimeter}get solidity(){return this.surface/this.convexHull.surface}get angle(){if(!this.computed.angle){let f=this.maxLengthPoints,ze=-Math.atan2(f[0][1]-f[1][1],f[0][0]-f[1][0])*180/Math.PI;this.computed.angle=ze}return this.computed.angle}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,filledSurface:this.filledSurface,surface:this.surface,hullSurface:this.convexHull.surface,hullPerimeter:this.convexHull.perimeter,mbrWidth:this.mbr.width,mbrHeight:this.mbr.height,mbrSurface:this.mbr.surface,eqpc:this.eqpc,ped:this.ped,feretDiameterMin:this.feretDiameters.min,feretDiameterMax:this.feretDiameters.max,aspectRatio:this.feretDiameters.aspectRatio,fillRatio:this.fillRatio,sphericity:this.sphericity,roundness:this.roundness,solidity:this.solidity,perimeter:this.perimeter}}}function getBorders(qe){let f=qe.map,ze=f.data,Ke=new Set,Qe=new Map,Pi=new Set,nn=[1,0,-1,0],ln=[0,1,0,-1];for(let un=qe.minX;un<=qe.maxX;un++)for(let zn=qe.minY;zn<=qe.maxY;zn++){let Xn=un+zn*f.width;if(ze[Xn]===qe.id)for(let Un=0;Un<4;Un++){let qn=un+nn[Un],ys=zn+ln[Un];if(qn>=0&&ys>=0&&qn<f.width&&ys<f.height){let vs=qn+ys*f.width;if(ze[vs]!==qe.id&&!Pi.has(vs)){Pi.add(vs),Ke.add(ze[vs]);let ea=Qe.get(ze[vs]);ea?Qe.set(ze[vs],++ea):Qe.set(ze[vs],1)}}}}let cn=Array.from(Ke),hn=cn.map(function(un){return Qe.get(un)});return{ids:cn,lengths:hn}}function getBoxIDs(qe){let f=new Set,ze=qe.map,Ke=ze.data;for(let Qe of[0,qe.height-1])for(let Pi=0;Pi<qe.width;Pi++){let nn=(Qe+qe.minY)*ze.width+Pi+qe.minX;if(Pi-qe.minX>0&&Ke[nn]===qe.id&&Ke[nn-1]!==qe.id){let ln=Ke[nn-1];f.add(ln)}if(ze.width-Pi-qe.minX>1&&Ke[nn]===qe.id&&Ke[nn+1]!==qe.id){let ln=Ke[nn+1];f.add(ln)}}for(let Qe of[0,qe.width-1])for(let Pi=0;Pi<qe.height;Pi++){let nn=(Pi+qe.minY)*ze.width+Qe+qe.minX;if(Pi-qe.minY>0&&Ke[nn]===qe.id&&Ke[nn-ze.width]!==qe.id){let ln=Ke[nn-ze.width];f.add(ln)}if(ze.height-Pi-qe.minY>1&&Ke[nn]===qe.id&&Ke[nn+ze.width]!==qe.id){let ln=Ke[nn+ze.width];f.add(ln)}}return Array.from(f)}function getBox(qe){let f=0,ze=qe.map,Ke=ze.data,Qe=[0];qe.height>1&&(Qe[1]=qe.height-1);for(let nn of Qe)for(let ln=1;ln<qe.width-1;ln++){let cn=(nn+qe.minY)*ze.width+ln+qe.minX;Ke[cn]===qe.id&&f++}let Pi=[0];qe.width>1&&(Pi[1]=qe.width-1);for(let nn of Pi)for(let ln=0;ln<qe.height;ln++){let cn=(ln+qe.minY)*ze.width+nn+qe.minX;Ke[cn]===qe.id&&f++}return f}function getBorder(qe){let f=0,ze=qe.map,Ke=ze.data;for(let Qe=1;Qe<qe.width-1;Qe++)for(let Pi=1;Pi<qe.height-1;Pi++){let nn=(Pi+qe.minY)*ze.width+Qe+qe.minX;Ke[nn]===qe.id&&(Ke[nn-1]!==qe.id||Ke[nn+1]!==qe.id||Ke[nn-ze.width]!==qe.id||Ke[nn+ze.width]!==qe.id)&&f++}return f+qe.box}function getPerimeterInfo(qe){let f=qe.map,ze=f.data,Ke=0,Qe=0,Pi=0,nn=0;for(let ln=0;ln<qe.width;ln++)for(let cn=0;cn<qe.height;cn++){let hn=(cn+qe.minY)*f.width+ln+qe.minX;if(ze[hn]===qe.id){let un=0;switch((ln===0||qe.externalIDs.includes(ze[hn-1]))&&un++,(ln===qe.width-1||qe.externalIDs.includes(ze[hn+1]))&&un++,(cn===0||qe.externalIDs.includes(ze[hn-f.width]))&&un++,(cn===qe.height-1||qe.externalIDs.includes(ze[hn+f.width]))&&un++,un){case 1:Ke++;break;case 2:Qe++;break;case 3:Pi++;break;case 4:nn++;break}}}return{one:Ke,two:Qe,three:Pi,four:nn}}function getExternal(qe){let f=0,ze=qe.map,Ke=ze.data;for(let Qe=1;Qe<qe.width-1;Qe++)for(let Pi=1;Pi<qe.height-1;Pi++){let nn=(Pi+qe.minY)*ze.width+Qe+qe.minX;Ke[nn]===qe.id&&(qe.externalIDs.includes(Ke[nn-1])||qe.externalIDs.includes(Ke[nn+1])||qe.externalIDs.includes(Ke[nn-ze.width])||qe.externalIDs.includes(Ke[nn+ze.width]))&&f++}return f+qe.box}function getHolesInfo(qe){let f=0,ze=qe.map.width,Ke=qe.map.data;for(let Qe=1;Qe<qe.width-1;Qe++)for(let Pi=1;Pi<qe.height-1;Pi++){let nn=(Pi+qe.minY)*ze+Qe+qe.minX;qe.internalIDs.includes(Ke[nn])&&Ke[nn]!==qe.id&&f++}return{number:qe.internalIDs.length-1,surface:f}}function getInternalIDs(qe){let f=[qe.id],ze=qe.map,Ke=ze.data;if(qe.height>2)for(let Pi=0;Pi<qe.width;Pi++){let nn=qe.minY*ze.width+Pi+qe.minX;if(f.includes(Ke[nn])){let ln=Ke[nn+ze.width];!f.includes(ln)&&!qe.boxIDs.includes(ln)&&f.push(ln)}}let Qe=new Array(4);for(let Pi=1;Pi<qe.width-1;Pi++)for(let nn=1;nn<qe.height-1;nn++){let ln=(nn+qe.minY)*ze.width+Pi+qe.minX;if(f.includes(Ke[ln])){Qe[0]=Ke[ln-1],Qe[1]=Ke[ln+1],Qe[2]=Ke[ln-ze.width],Qe[3]=Ke[ln+ze.width];for(let cn=0;cn<4;cn++){let hn=Qe[cn];!f.includes(hn)&&!qe.boxIDs.includes(hn)&&f.push(hn)}}}return f}class RoiLayer{constructor(f,ze){this.roiMap=f,this.options=ze,this.roi=this.createRoi()}createRoi(){let f=this.roiMap.data,ze={};this.roiMap.positive=0,this.roiMap.negative=0;for(let ln=0;ln<f.length;ln++)f[ln]&&!ze[f[ln]]&&(ze[f[ln]]=!0,f[ln]>0?this.roiMap.positive++:this.roiMap.negative++);let Ke={};for(let ln in ze)Ke[ln]=new Roi(this.roiMap,ln*1);let Qe=this.roiMap.width,Pi=this.roiMap.height;for(let ln=0;ln<Pi;ln++)for(let cn=0;cn<Qe;cn++){let hn=ln*Qe+cn;if(f[hn]!==0){const un=f[hn],zn=Ke[un];cn<zn.minX&&(zn.minX=cn),cn>zn.maxX&&(zn.maxX=cn),ln<zn.minY&&(zn.minY=ln),ln>zn.maxY&&(zn.maxY=ln),zn.meanX+=cn,zn.meanY+=ln,zn.surface++}}let nn=[];for(let ln in ze)Ke[ln].meanX/=Ke[ln].surface,Ke[ln].meanY/=Ke[ln].surface,nn.push(Ke[ln]);return nn}}function commonBorderLength(qe){let f=qe.data,ze=[1,0,-1,0],Ke=[0,1,0,-1],Qe=qe.minMax,Pi=-Qe.min,nn=Qe.max+Pi,ln=[];for(let hn=0;hn<=nn;hn++)ln.push(Object.create(null));for(let hn=0;hn<qe.width;hn++)for(let un=0;un<qe.height;un++){let zn=hn+un*qe.width,Xn=f[zn];if(Xn!==0){let Un=Object.create(null),qn=!1;for(let ys=0;ys<4;ys++){let vs=hn+ze[ys],ea=un+Ke[ys];if(vs>=0&&ea>=0&&vs<qe.width&&ea<qe.height){let na=f[vs+ea*qe.width];Xn!==na&&(qn=!0,na!==0&&Un[na]===void 0&&(Un[na]=!0,ln[na+Pi][Xn]?ln[na+Pi][Xn]++:ln[na+Pi][Xn]=1))}else qn=!0}qn&&(ln[Xn+Pi][Xn]?ln[Xn+Pi][Xn]++:ln[Xn+Pi][Xn]=1)}}let cn={};for(let hn=0;hn<ln.length;hn++)Object.keys(ln[hn]).length>0&&(cn[hn-Pi]=ln[hn]);return cn}function mergeRoi(qe={}){const{algorithm:f="commonBorderLength",minCommonBorderLength:ze=5,maxCommonBorderLength:Ke=100,minCommonBorderRatio:Qe=.3,maxCommonBorderRatio:Pi=1}=qe;let nn=function(vs,ea,na){return vs[na]>=ze&&vs[na]<=Ke};typeof f=="function"&&(nn=f),f.toLowerCase()==="commonborderratio"&&(nn=function(vs,ea,na){let ta=Math.min(vs[na]/vs[ea],1);return ta>=Qe&&ta<=Pi});const ln=this,cn=ln.commonBorderLength;let hn={},un={};for(let vs of Object.keys(cn)){let ea=cn[vs],na=Object.keys(ea);for(let ta of na)if(ta!==vs&&nn(ea,vs,ta)){let ra=ta;un[ta]&&(ra=un[ta]);let oa=vs;if(un[vs]&&(oa=un[vs]),Number(ra)!==oa){let fa=Math.min(ra,oa),ca=Math.max(ra,oa);if(hn[fa]||(hn[fa]={}),hn[fa][ca]=!0,un[ca]=fa,hn[ca]){for(let la of Object.keys(hn[ca]))hn[fa][la]=!0,un[la]=fa;delete hn[ca]}}}}let zn=ln.minMax,Xn=-zn.min,Un=zn.max+Xn,qn=new Array(Un+1).fill(0);for(let vs of Object.keys(un))qn[Number(vs)+Xn]=un[vs];let ys=ln.data;for(let vs=0;vs<ys.length;vs++){let ea=ys[vs];if(ea!==0){let na=qn[ea+Xn];na!==0&&(ys[vs]=na)}}return ln.computed={},ln}class RoiMap{constructor(f,ze){this.parent=f,this.width=f.width,this.height=f.height,this.data=ze,this.negative=0,this.positive=0}get total(){return this.negative+this.positive}get minMax(){let f=Number.MAX_SAFE_INTEGER,ze=Number.MIN_SAFE_INTEGER;for(let Ke=0;Ke<this.data.length;Ke++)this.data[Ke]<f&&(f=this.data[Ke]),this.data[Ke]>ze&&(ze=this.data[Ke]);return{min:f,max:ze}}get commonBorderLength(){return commonBorderLength(this)}mergeRoi(f={}){return mergeRoi.call(this,f)}mergeRois(f){const ze=f[0],Ke=f.slice(1);for(let Qe=0;Qe<this.data.length;Qe++)Ke.includes(this.data[Qe])&&(this.data[Qe]=ze)}rowsInfo(){let f=new Array(this.height),ze=0;for(let Ke=0;Ke<this.data.length;Ke+=this.width){let Qe={row:ze,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};f[ze++]=Qe;let Pi={},nn={},ln=[],cn=this.data[Ke],hn=0;for(let un=Ke;un<Ke+this.width;un++){let zn=this.data[un];cn!==zn&&(cn=zn,ln.push(hn),hn=0),hn++,zn>0?(Qe.positivePixel++,Pi[zn]||(Pi[zn]=!0)):zn<0?(Qe.negativePixel++,nn[zn]||(nn[zn]=!0)):Qe.zeroPixel++}ln.push(hn),Qe.medianChange=ln.sort((un,zn)=>un-zn)[Math.floor(ln.length/2)],Qe.positiveRoiIDs=Object.keys(Pi),Qe.negativeRoiIDs=Object.keys(nn),Qe.positiveRoi=Qe.positiveRoiIDs.length,Qe.negativeRoi=Qe.negativeRoiIDs.length}return f}colsInfo(){let f=new Array(this.width),ze=0;for(let Ke=0;Ke<this.width;Ke++){let Qe={col:ze,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};f[ze++]=Qe;let Pi={},nn={},ln=[],cn=this.data[Ke],hn=0;for(let un=Ke;un<Ke+this.data.length;un+=this.width){let zn=this.data[un];cn!==zn&&(cn=zn,ln.push(hn),hn=0),hn++,zn>0?(Qe.positivePixel++,Pi[zn]||(Pi[zn]=!0)):zn<0?(Qe.negativePixel++,nn[zn]||(nn[zn]=!0)):Qe.zeroPixel++}ln.push(hn),Qe.medianChange=ln.sort((un,zn)=>un-zn)[Math.floor(ln.length/2)],Qe.positiveRoiIDs=Object.keys(Pi),Qe.negativeRoiIDs=Object.keys(nn),Qe.positiveRoi=Qe.positiveRoiIDs.length,Qe.negativeRoi=Qe.negativeRoiIDs.length}return f}}function fromMask(qe,f={}){const{allowCorners:ze=!1}=f,Ke=65535;let Qe=new Int16Array(qe.size),Pi=0,nn=0,ln=new Uint16Array(Ke+1),cn=new Uint16Array(Ke+1);for(let un=0;un<qe.width;un++)for(let zn=0;zn<qe.height;zn++)Qe[zn*qe.width+un]===0&&hn(un,zn);function hn(un,zn){let Xn=0,Un=0,qn=qe.getBitXY(un,zn),ys=qn?++Pi:--nn;if(Pi>32767||nn<-32768)throw new Error("Too many regions of interest");for(ln[0]=un,cn[0]=zn;Xn<=Un;){let vs=ln[Xn&Ke],ea=cn[Xn&Ke];if(Qe[ea*qe.width+vs]=ys,vs>0&&Qe[ea*qe.width+vs-1]===0&&qe.getBitXY(vs-1,ea)===qn&&(Un++,ln[Un&Ke]=vs-1,cn[Un&Ke]=ea,Qe[ea*qe.width+vs-1]=-32768),ea>0&&Qe[(ea-1)*qe.width+vs]===0&&qe.getBitXY(vs,ea-1)===qn&&(Un++,ln[Un&Ke]=vs,cn[Un&Ke]=ea-1,Qe[(ea-1)*qe.width+vs]=-32768),vs<qe.width-1&&Qe[ea*qe.width+vs+1]===0&&qe.getBitXY(vs+1,ea)===qn&&(Un++,ln[Un&Ke]=vs+1,cn[Un&Ke]=ea,Qe[ea*qe.width+vs+1]=-32768),ea<qe.height-1&&Qe[(ea+1)*qe.width+vs]===0&&qe.getBitXY(vs,ea+1)===qn&&(Un++,ln[Un&Ke]=vs,cn[Un&Ke]=ea+1,Qe[(ea+1)*qe.width+vs]=-32768),ze&&(vs>0&&ea>0&&Qe[(ea-1)*qe.width+vs-1]===0&&qe.getBitXY(vs-1,ea-1)===qn&&(Un++,ln[Un&Ke]=vs-1,cn[Un&Ke]=ea-1,Qe[(ea-1)*qe.width+vs-1]=-32768),vs<qe.width-1&&ea>0&&Qe[(ea-1)*qe.width+vs+1]===0&&qe.getBitXY(vs+1,ea-1)===qn&&(Un++,ln[Un&Ke]=vs+1,cn[Un&Ke]=ea-1,Qe[(ea-1)*qe.width+vs+1]=-32768),vs>0&&ea<qe.height-1&&Qe[(ea+1)*qe.width+vs-1]===0&&qe.getBitXY(vs-1,ea+1)===qn&&(Un++,ln[Un&Ke]=vs-1,cn[Un&Ke]=ea+1,Qe[(ea+1)*qe.width+vs-1]=-32768),vs<qe.width-1&&ea<qe.height-1&&Qe[(ea+1)*qe.width+vs+1]===0&&qe.getBitXY(vs+1,ea+1)===qn&&(Un++,ln[Un&Ke]=vs+1,cn[Un&Ke]=ea+1,Qe[(ea+1)*qe.width+vs+1]=-32768)),Xn++,Un-Xn>Ke)throw new Error("analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY")}}return new RoiMap(qe,Qe)}var DisjointSet_1,hasRequiredDisjointSet;function requireDisjointSet(){if(hasRequiredDisjointSet)return DisjointSet_1;hasRequiredDisjointSet=1;class qe{constructor(){this.nodes=new Map}add(Ke){var Qe=this.nodes.get(Ke);return Qe||(Qe=new f(Ke),this.nodes.set(Ke,Qe)),Qe}union(Ke,Qe){const Pi=this.find(Ke),nn=this.find(Qe);Pi!==nn&&(Pi.rank<nn.rank?Pi.parent=nn:Pi.rank>nn.rank?nn.parent=Pi:(nn.parent=Pi,Pi.rank++))}find(Ke){for(var Qe=Ke;Qe.parent!==null;)Qe=Qe.parent;for(var Pi=Ke;Pi.parent!==null;){var nn=Pi;Pi=Pi.parent,nn.parent=Qe}return Qe}connected(Ke,Qe){return this.find(Ke)===this.find(Qe)}}DisjointSet_1=qe;function f(ze){this.value=ze,this.parent=null,this.rank=0}return DisjointSet_1}var DisjointSetExports=requireDisjointSet();const DisjointSet=getDefaultExportFromCjs(DisjointSetExports),direction4X=[-1,0],direction4Y=[0,-1],neighbours4=[null,null],direction8X=[-1,-1,0,1],direction8Y=[0,-1,-1,-1],neighbours8=[null,null,null,null];function fromMaskConnectedComponentLabelingAlgorithm(qe,f={}){const{allowCorners:ze=!1}=f;let Ke=4;ze&&(Ke=8);let Qe,Pi,nn;if(Ke===8)Qe=direction8X,Pi=direction8Y,nn=neighbours8;else if(Ke===4)Qe=direction4X,Pi=direction4Y,nn=neighbours4;else throw new RangeError(`unsupported neighbours count: ${Ke}`);const ln=qe.size,cn=qe.width,hn=qe.height,un=new Array(ln),zn=new Uint32Array(ln),Xn=new DisjointSet;let Un=1;for(let qn=0;qn<hn;qn++)for(let ys=0;ys<cn;ys++){const vs=ys+qn*cn;if(qe.getBit(vs)){let ea=null;for(let na=0;na<nn.length;na++){const ta=ys+Qe[na],ra=qn+Pi[na];if(ta>=0&&ra>=0&&ta<cn&&ra<hn){const oa=ta+ra*cn;let fa=un[oa];fa?(nn[na]=fa,(!ea||nn[na].value<ea.value)&&(ea=nn[na])):nn[na]=null}}if(!ea)un[vs]=Xn.add(Un++);else{un[vs]=ea;for(let na=0;na<nn.length;na++)nn[na]&&nn[na]!==ea&&Xn.union(ea,nn[na])}}}for(let qn=0;qn<hn;qn++)for(let ys=0;ys<cn;ys++){const vs=ys+qn*cn;qe.getBit(vs)&&(zn[vs]=Xn.find(un[vs]).value)}return new RoiMap(qe,zn)}function fromMaxima(qe={}){let{allowCorner:f=!0,onlyTop:ze=!1,invert:Ke=!1}=qe,Qe=this;Qe.checkProcessable("fromMaxima",{components:[1]});const Pi=1,nn=2;let ln=0,cn=0,hn=new Int16Array(Qe.size),un=new Int8Array(Qe.size),zn=new Float32Array(Qe.size),Xn=1048575,Un=new Uint16Array(Xn+1),qn=new Uint16Array(Xn+1),ys=0,vs=0,ea=new Uint16Array(Xn+1),na=new Uint16Array(Xn+1),ta=0,ra=0;for(oa(Qe);ys<vs;){let la=Un[ys&Xn],ua=qn[ys&Xn];ca(la,ua,nn),ys++}return new RoiMap(Qe,hn);function oa({maxima:la=!0}){for(let ua=1;ua<Qe.height-1;ua++)for(let ga=1;ga<Qe.width-1;ga++){let da=ga+ua*Qe.width;if(un[da]===0){let qa=la?Qe.data[da]:-Qe.data[ga+ua*Qe.width];if(Qe.data[ua*Qe.width+ga-1]>qa||Qe.data[ua*Qe.width+ga+1]>qa||Qe.data[(ua-1)*Qe.width+ga]>qa||Qe.data[(ua+1)*Qe.width+ga]>qa||f&&(Qe.data[(ua-1)*Qe.width+ga-1]>qa||Qe.data[(ua-1)*Qe.width+ga+1]>qa||Qe.data[(ua+1)*Qe.width+ga-1]>qa||Qe.data[(ua+1)*Qe.width+ga+1]>qa))continue;hn[da]=la?++ln:--cn,fa(ga,ua)||(la?--ln:++cn)}}}function fa(la,ua){let ga=vs;ta=0,ra=1,ea[0]=la,na[0]=ua;let da=!0;for(;ta<ra;){let qa=ea[ta&Xn],tl=na[ta&Xn];da&=ca(qa,tl,Pi),ta++}if(!da){for(let qa=0;qa<ra;qa++){let tl=ea[qa&Xn],hl=na[qa&Xn]*Qe.width+tl;hn[hl]=0}vs=ga}return da}function ca(la,ua,ga){let da=hn[ua*Qe.width+la],qa=Qe.data[ua*Qe.width+la];for(let tl=ua-1;tl<=ua+1;tl++)for(let ol=la-1;ol<=la+1;ol++){let hl=tl*Qe.width+ol;if(un[hl]===0)switch(un[hl]=1,zn[hl]=Qe.data[hl]-qa,ga){case Pi:if(zn[hl]===0){if(ol===0||tl===0||ol===Qe.width-1||tl===Qe.height-1)return!1;hn[hl]=da,ea[ra&Xn]=ol,na[ra&Xn]=tl,ra++}else{if(zn[hl]>0)return!1;ze||(hn[hl]=da,Un[vs&Xn]=ol,qn[vs&Xn]=tl,vs++)}break;case nn:zn[hl]<=0&&(hn[hl]=da,Un[vs&Xn]=ol,qn[vs&Xn]=tl,vs++);break;default:throw new Error("unreachable")}}return!0}}function fromPoints(qe,f={}){let ze=new Shape(f),Ke=new Int16Array(this.size),Qe=0,Pi=ze.getPoints();for(let nn=0;nn<qe.length;nn++){Qe++;let ln=qe[nn][0],cn=qe[nn][1];for(let hn=0;hn<Pi.length;hn++){let un=Pi[hn][0],zn=Pi[hn][1];ln+un>=0&&cn+zn>=0&&ln+un<this.width&&cn+zn<this.height&&(Ke[ln+un+(cn+zn)*this.width]=Qe)}}return new RoiMap(this,Ke)}function commonjsRequire(qe){throw new Error('Could not dynamically require "'+qe+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var priorityQueue={exports:{}},hasRequiredPriorityQueue;function requirePriorityQueue(){return hasRequiredPriorityQueue||(hasRequiredPriorityQueue=1,function(qe,f){(function(ze){qe.exports=ze()})(function(){return function ze(Ke,Qe,Pi){function nn(hn,un){if(!Qe[hn]){if(!Ke[hn]){var zn=typeof commonjsRequire=="function"&&commonjsRequire;if(!un&&zn)return zn(hn,!0);if(ln)return ln(hn,!0);var Xn=new Error("Cannot find module '"+hn+"'");throw Xn.code="MODULE_NOT_FOUND",Xn}var Un=Qe[hn]={exports:{}};Ke[hn][0].call(Un.exports,function(qn){var ys=Ke[hn][1][qn];return nn(ys||qn)},Un,Un.exports,ze,Ke,Qe,Pi)}return Qe[hn].exports}for(var ln=typeof commonjsRequire=="function"&&commonjsRequire,cn=0;cn<Pi.length;cn++)nn(Pi[cn]);return nn}({1:[function(ze,Ke,Qe){var Pi,nn,ln,cn,hn,un=function(Xn,Un){for(var qn in Un)zn.call(Un,qn)&&(Xn[qn]=Un[qn]);function ys(){this.constructor=Xn}return ys.prototype=Un.prototype,Xn.prototype=new ys,Xn.__super__=Un.prototype,Xn},zn={}.hasOwnProperty;Pi=ze("./PriorityQueue/AbstractPriorityQueue"),nn=ze("./PriorityQueue/ArrayStrategy"),cn=ze("./PriorityQueue/BinaryHeapStrategy"),ln=ze("./PriorityQueue/BHeapStrategy"),hn=function(Xn){un(Un,Xn);function Un(qn){qn||(qn={}),qn.strategy||(qn.strategy=cn),qn.comparator||(qn.comparator=function(ys,vs){return(ys||0)-(vs||0)}),Un.__super__.constructor.call(this,qn)}return Un}(Pi),hn.ArrayStrategy=nn,hn.BinaryHeapStrategy=cn,hn.BHeapStrategy=ln,Ke.exports=hn},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(ze,Ke,Qe){Ke.exports=function(){function Pi(nn){var ln;if((nn!=null?nn.strategy:void 0)==null)throw"Must pass options.strategy, a strategy";if((nn!=null?nn.comparator:void 0)==null)throw"Must pass options.comparator, a comparator";this.priv=new nn.strategy(nn),this.length=(nn!=null&&(ln=nn.initialValues)!=null?ln.length:void 0)||0}return Pi.prototype.queue=function(nn){this.length++,this.priv.queue(nn)},Pi.prototype.dequeue=function(nn){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},Pi.prototype.peek=function(nn){if(!this.length)throw"Empty queue";return this.priv.peek()},Pi.prototype.clear=function(){return this.length=0,this.priv.clear()},Pi}()},{}],3:[function(ze,Ke,Qe){var Pi;Pi=function(nn,ln,cn){var hn,un,zn;for(un=0,hn=nn.length;un<hn;)zn=un+hn>>>1,cn(nn[zn],ln)>=0?un=zn+1:hn=zn;return un},Ke.exports=function(){function nn(ln){var cn;this.options=ln,this.comparator=this.options.comparator,this.data=((cn=this.options.initialValues)!=null?cn.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return nn.prototype.queue=function(ln){var cn;cn=Pi(this.data,ln,this.comparator),this.data.splice(cn,0,ln)},nn.prototype.dequeue=function(){return this.data.pop()},nn.prototype.peek=function(){return this.data[this.data.length-1]},nn.prototype.clear=function(){this.data.length=0},nn}()},{}],4:[function(ze,Ke,Qe){Ke.exports=function(){function Pi(nn){var ln,cn,hn,un,zn,Xn,Un,qn;for(this.comparator=(nn!=null?nn.comparator:void 0)||function(ys,vs){return ys-vs},this.pageSize=(nn!=null?nn.pageSize:void 0)||512,this.length=0,Un=0;1<<Un<this.pageSize;)Un+=1;if(1<<Un!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=Un,this._emptyMemoryPageTemplate=ln=[],cn=0,zn=this.pageSize;0<=zn?cn<zn:cn>zn;0<=zn?++cn:--cn)ln.push(null);if(this._memory=[],this._mask=this.pageSize-1,nn.initialValues)for(Xn=nn.initialValues,hn=0,un=Xn.length;hn<un;hn++)qn=Xn[hn],this.queue(qn)}return Pi.prototype.queue=function(nn){this.length+=1,this._write(this.length,nn),this._bubbleUp(this.length,nn)},Pi.prototype.dequeue=function(){var nn,ln;return nn=this._read(1),ln=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,ln),this._bubbleDown(1,ln)),nn},Pi.prototype.peek=function(){return this._read(1)},Pi.prototype.clear=function(){this.length=0,this._memory.length=0},Pi.prototype._write=function(nn,ln){var cn;for(cn=nn>>this._shift;cn>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[cn][nn&this._mask]=ln},Pi.prototype._read=function(nn){return this._memory[nn>>this._shift][nn&this._mask]},Pi.prototype._bubbleUp=function(nn,ln){var cn,hn,un,zn;for(cn=this.comparator;nn>1&&(hn=nn&this._mask,nn<this.pageSize||hn>3?un=nn&~this._mask|hn>>1:hn<2?(un=nn-this.pageSize>>this._shift,un+=un&~(this._mask>>1),un|=this.pageSize>>1):un=nn-2,zn=this._read(un),!(cn(zn,ln)<0));)this._write(un,ln),this._write(nn,zn),nn=un},Pi.prototype._bubbleDown=function(nn,ln){var cn,hn,un,zn,Xn;for(Xn=this.comparator;nn<this.length;)if(nn>this._mask&&!(nn&this._mask-1)?cn=hn=nn+2:nn&this.pageSize>>1?(cn=(nn&~this._mask)>>1,cn|=nn&this._mask>>1,cn=cn+1<<this._shift,hn=cn+1):(cn=nn+(nn&this._mask),hn=cn+1),cn!==hn&&hn<=this.length)if(un=this._read(cn),zn=this._read(hn),Xn(un,ln)<0&&Xn(un,zn)<=0)this._write(cn,ln),this._write(nn,un),nn=cn;else if(Xn(zn,ln)<0)this._write(hn,ln),this._write(nn,zn),nn=hn;else break;else if(cn<=this.length)if(un=this._read(cn),Xn(un,ln)<0)this._write(cn,ln),this._write(nn,un),nn=cn;else break;else break},Pi}()},{}],5:[function(ze,Ke,Qe){Ke.exports=function(){function Pi(nn){var ln;this.comparator=(nn!=null?nn.comparator:void 0)||function(cn,hn){return cn-hn},this.length=0,this.data=((ln=nn.initialValues)!=null?ln.slice(0):void 0)||[],this._heapify()}return Pi.prototype._heapify=function(){var nn,ln,cn;if(this.data.length>0)for(nn=ln=1,cn=this.data.length;1<=cn?ln<cn:ln>cn;nn=1<=cn?++ln:--ln)this._bubbleUp(nn)},Pi.prototype.queue=function(nn){this.data.push(nn),this._bubbleUp(this.data.length-1)},Pi.prototype.dequeue=function(){var nn,ln;return ln=this.data[0],nn=this.data.pop(),this.data.length>0&&(this.data[0]=nn,this._bubbleDown(0)),ln},Pi.prototype.peek=function(){return this.data[0]},Pi.prototype.clear=function(){this.length=0,this.data.length=0},Pi.prototype._bubbleUp=function(nn){for(var ln,cn;nn>0&&(ln=nn-1>>>1,this.comparator(this.data[nn],this.data[ln])<0);)cn=this.data[ln],this.data[ln]=this.data[nn],this.data[nn]=cn,nn=ln},Pi.prototype._bubbleDown=function(nn){var ln,cn,hn,un,zn;for(ln=this.data.length-1;cn=(nn<<1)+1,un=cn+1,hn=nn,cn<=ln&&this.comparator(this.data[cn],this.data[hn])<0&&(hn=cn),un<=ln&&this.comparator(this.data[un],this.data[hn])<0&&(hn=un),hn!==nn;)zn=this.data[hn],this.data[hn]=this.data[nn],this.data[nn]=zn,nn=hn},Pi}()},{}]},{},[1])(1)})}(priorityQueue)),priorityQueue.exports}var priorityQueueExports=requirePriorityQueue();const PriorityQueue=getDefaultExportFromCjs(priorityQueueExports),dxs=[1,0,-1,0,1,1,-1,-1],dys=[0,1,0,-1,1,-1,1,-1];function fromWaterShed(qe={}){let{points:f,mask:ze,image:Ke,fillMaxValue:Qe=this.maxValue,invert:Pi=!1}=qe,nn=Ke||this;nn.checkProcessable("fromWaterShed",{bitDepth:[8,16],components:1}),Pi=!Pi,f||(f=nn.getLocalMaxima({invert:Pi,mask:ze}));let ln=Pi?0:1,cn=new Int16Array(nn.size),hn=nn.width,un=nn.height,zn=new PriorityQueue({comparator:(Xn,Un)=>Xn[2]-Un[2],strategy:PriorityQueue.BinaryHeapStrategy});for(let Xn=0;Xn<f.length;Xn++){let Un=f[Xn][0]+f[Xn][1]*hn;cn[Un]=Xn+1;let qn=nn.data[Un];(Pi&&qn<=Qe||!Pi&&qn>=Qe)&&zn.queue([f[Xn][0],f[Xn][1],qn])}for(;zn.length>0;){let Xn=zn.dequeue(),Un=Xn[0]+Xn[1]*hn;for(let qn=0;qn<4;qn++){let ys=Xn[0]+dxs[qn],vs=Xn[1]+dys[qn];if(ys>=0&&vs>=0&&ys<hn&&vs<un){let ea=ys+vs*hn;if(!ze||ze.getBit(ea)===ln){let na=nn.data[ea];(Pi&&na<=Qe||!Pi&&na>=Qe)&&cn[ea]===0&&(cn[ea]=cn[Un],zn.queue([Xn[0]+dxs[qn],Xn[1]+dys[qn],na]))}}}}return new RoiMap(nn,cn)}class RoiManager{constructor(f,ze={}){this._image=f,this._options=ze,this._options.label||(this._options.label="default"),this._layers={},this._painted=null}fromMaxima(f={}){let ze=Object.assign({},this._options,f),Ke=fromMaxima.call(this._image,f);this._layers[ze.label]=new RoiLayer(Ke,ze)}fromPoints(f,ze={}){let Ke=Object.assign({},this._options,ze),Qe=fromPoints.call(this._image,f,ze);return this._layers[Ke.label]=new RoiLayer(Qe,Ke),this}putMap(f,ze={}){let Ke=new RoiMap(this._image,f),Qe=Object.assign({},this._options,ze);return this._layers[Qe.label]=new RoiLayer(Ke,Qe),this}fromWaterShed(f={}){let ze=Object.assign({},this._options,f),Ke=fromWaterShed.call(this._image,f);this._layers[ze.label]=new RoiLayer(Ke,ze)}fromMask(f,ze={}){let Ke=Object.assign({},this._options,ze),Qe=fromMask.call(this._image,f,ze);return this._layers[Ke.label]=new RoiLayer(Qe,Ke),this}fromMaskConnectedComponentLabelingAlgorithm(f,ze={}){let Ke=Object.assign({},this._options,ze),Qe=fromMaskConnectedComponentLabelingAlgorithm.call(this._image,f,ze);return this._layers[Ke.label]=new RoiLayer(Qe,Ke),this}getMap(f={}){let ze=Object.assign({},this._options,f);return this._assertLayerWithLabel(ze.label),this._layers[ze.label].roiMap}rowsInfo(f={}){return this.getMap(f).rowsInfo()}colsInfo(f={}){return this.getMap(f).rowsInfo()}getRoiIds(f={}){let ze=this.getRois(f);if(ze){let Ke=new Array(ze.length);for(let Qe=0;Qe<ze.length;Qe++)Ke[Qe]=ze[Qe].id;return Ke}throw new Error("ROIs not found")}getRois(f={}){let{label:ze=this._options.label,positive:Ke=!0,negative:Qe=!0,minSurface:Pi=0,maxSurface:nn=Number.POSITIVE_INFINITY,minWidth:ln=0,maxWidth:cn=Number.POSITIVE_INFINITY,minHeight:hn=0,maxHeight:un=Number.POSITIVE_INFINITY,minRatio:zn=0,maxRatio:Xn=Number.POSITIVE_INFINITY}=f;if(!this._layers[ze])throw new Error(`this Roi layer (${ze}) does not exist`);const Un=this._layers[ze].roi,qn=[];for(const ys of Un)(ys.id<0&&Qe||ys.id>0&&Ke)&&ys.surface>=Pi&&ys.surface<=nn&&ys.width>=ln&&ys.width<=cn&&ys.height>=hn&&ys.height<=un&&ys.ratio>=zn&&ys.ratio<=Xn&&qn.push(ys);return qn}getRoi(f,ze={}){const{label:Ke=this._options.label}=ze;if(!this._layers[Ke])throw new Error(`this Roi layer (${Ke}) does not exist`);const Qe=this._layers[Ke].roi.find(Pi=>Pi.id===f);if(!Qe)throw new Error(`found no Roi with id ${f}`);return Qe}getMasks(f={}){let ze=this.getRois(f),Ke=new Array(ze.length);for(let Qe=0;Qe<ze.length;Qe++)Ke[Qe]=ze[Qe].getMask(f);return Ke}getAnalysisMasks(f={}){const{analysisProperty:ze}=f;let Ke=`${ze}Mask`,Qe=this.getRois(f);return Qe.length===0||!Qe[0][Ke]?[]:Qe.map(Pi=>Pi[Ke])}getData(f={}){let ze=Object.assign({},this._options,f);return this._assertLayerWithLabel(ze.label),this._layers[ze.label].roiMap.data}paint(f={}){let{labelProperty:ze,analysisProperty:Ke}=f;this._painted||(this._painted=this._image.rgba8());let Qe=this.getMasks(f);if(ze){const Pi=this.getRois(f);f.labels=Pi.map(hn=>deepValue(hn,ze));const nn=Math.max(...f.labels);let ln=!1,cn=!1;if(ze.includes("surface")?ln=!0:/(?:perimeter|min|max|external|width|height|length)/.test(ze)&&(cn=!0),isFinite(nn)){let hn="";if(f.unit!=="pixel"&&f.pixelSize&&(cn||ln)){hn=ln?`${f.unit}^2`:f.unit;let un=ln?"m^2":"m",zn=ln?f.pixelSize**2:f.pixelSize;const Xn=Qty.swiftConverter(un,hn);f.labels=f.labels.map(Un=>Xn(zn*Un))}nn>50?f.labels=f.labels.map(un=>Math.round(un)+hn):nn>10?f.labels=f.labels.map(un=>un.toFixed(1)+hn):f.labels=f.labels.map(un=>un.toFixed(2)+hn)}f.labelsPosition=Pi.map(hn=>[hn.meanX,hn.meanY])}if(this._painted.paintMasks(Qe,f),Ke){let Pi=this.getAnalysisMasks(f);this._painted.paintMasks(Pi,{color:f.analysisColor,alpha:f.analysisAlpha})}return this._painted}getMask(f={}){let ze=new Image$1(this._image.width,this._image.height,{kind:"BINARY"}),Ke=this.getMasks(f);for(let Qe=0;Qe<Ke.length;Qe++){let Pi=Ke[Qe];for(let nn=0;nn<Pi.width;nn++)for(let ln=0;ln<Pi.height;ln++)Pi.getBitXY(nn,ln)&&ze.setBitXY(nn+Pi.position[0],ln+Pi.position[1])}return ze}resetPainted(f={}){const{image:ze}=f;ze?this._painted=this.image.rgba8():this._painted=this._image.rgba8()}mergeRoi(f={}){const ze=this.getMap(f);return ze.mergeRoi(f),this.putMap(ze.data,f),this}mergeRois(f,ze={}){if(!Array.isArray(f)||f.some(Qe=>!Number.isInteger(Qe)))throw new Error("Roi ids must be an array of integers");if(f.length<2)throw new Error("Roi ids must have at least two elements");if(new Set(f).size!==f.length)throw new Error("Roi ids must be all different");f.forEach(Qe=>this.getRoi(Qe));const Ke=this.getMap(ze);return Ke.mergeRois(f),this.putMap(Ke.data,ze),this}findCorrespondingRoi(f,ze={}){let Ke=this.getRois(ze),Qe=[];for(let Pi=0;Pi<Ke.length;Pi++){let nn=Ke[Pi],ln=nn.minX,cn=nn.minY,hn=nn.points,un=Math.sign(nn.id),zn=correspondingRoisInformation(ln,cn,hn,f,un);Qe.push(zn)}return Qe}_assertLayerWithLabel(f){if(!this._layers[f])throw new Error(`no layer with label ${f}`)}}function correspondingRoisInformation(qe,f,ze,Ke,Qe){let Pi={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0};for(let nn=0;nn<ze.length;nn++){let ln=ze[nn],cn=ln[0],hn=ln[1],un=cn+qe+(hn+f)*Ke.width,zn=Ke.data[un];(zn>0||zn<0)&&(Pi.id.includes(zn)?Pi.surface[Pi.id.indexOf(zn)]+=1:(Pi.id.push(zn),Pi.surface.push(1)))}for(let nn=0;nn<Pi.id.length;nn++)Math.sign(Pi.id[nn])===Qe?Pi.same+=Pi.surface[nn]:Pi.opposite+=Pi.surface[nn],Pi.roiSurfaceCovered[nn]=Pi.surface[nn]/ze.length;return Pi.total=Pi.opposite+Pi.same,Pi}const objectToString=Object.prototype.toString;let Image$1=class Ic{constructor(f,ze,Ke,Qe){if(arguments.length===1?(Qe=f,{width:f,height:ze,data:Ke}=Qe):Ke&&!Ke.length&&(Qe=Ke,{data:Ke}=Qe),f===void 0&&(f=1),ze===void 0&&(ze=1),Qe===void 0&&(Qe={}),typeof Qe!="object"||Qe===null)throw new TypeError("options must be an object");if(!Number.isInteger(f)||f<=0)throw new RangeError("width must be a positive integer");if(!Number.isInteger(ze)||ze<=0)throw new RangeError("height must be a positive integer");const{kind:Pi=RGBA}=Qe;if(typeof Pi!="string")throw new TypeError("kind must be a string");const nn=getKind(Pi),ln=Object.assign({},Qe);for(const ys in nn)ln[ys]===void 0&&(ln[ys]=nn[ys]);verifyKindDefinition(ln);const{components:cn,bitDepth:hn,colorModel:un}=ln,zn=ln.alpha+0,Xn=f*ze,Un=cn+zn,qn=hn===32?Number.MAX_VALUE:2**hn-1;if(Ke===void 0)Ke=createPixelArray(Xn,cn,zn,Un,hn,qn);else{const ys=getTheoreticalPixelArraySize(Xn,Un,hn);if(Ke.length!==ys)throw new RangeError(`incorrect data size: ${Ke.length}. Should be ${ys}`)}this.width=f,this.height=ze,this.data=Ke,this.size=Xn,this.components=cn,this.alpha=zn,this.bitDepth=hn,this.maxValue=qn,this.colorModel=un,this.channels=Un,this.meta=Qe.meta||{},Object.defineProperty(this,"parent",{enumerable:!1,writable:!0,configurable:!0,value:Qe.parent||null}),this.position=Qe.position||[0,0],this.computed=null,this.sizes=[this.width,this.height],this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=this.bitDepth<32,this.borderSizes=[0,0]}get[Symbol.toStringTag](){return"IJSImage"}static isImage(f){return objectToString.call(f)==="[object IJSImage]"}static fromCanvas(f){const Ke=f.getContext("2d").getImageData(0,0,f.width,f.height);return new Ic(Ke.width,Ke.height,Ke.data)}static createFrom(f,ze){const Ke=getImageParameters(f);return Object.assign(Ke,{parent:f,position:[0,0]},ze),new Ic(Ke)}getRoiManager(f){return new RoiManager(this,f)}clone(){const f=this.data.slice();return new Ic(this.width,this.height,f,this)}apply(f){for(let ze=0;ze<this.height;ze++)for(let Ke=0;Ke<this.width;Ke++){let Qe=(ze*this.width+Ke)*this.channels;f.call(this,Qe)}}};setValueMethods(Image$1);setBitMethods(Image$1);setExportMethods(Image$1);Image$1.prototype.checkProcessable=checkProcessable;Image$1.prototype.getRGBAData=getRGBAData;Image$1.load=load;Image$1.extendMethod=extendMethod;Image$1.extendProperty=extendProperty;extend$2(Image$1);var workerTemplate={},hasRequiredWorkerTemplate;function requireWorkerTemplate(){if(hasRequiredWorkerTemplate)return workerTemplate;hasRequiredWorkerTemplate=1;var qe=function(){self.window=self;function ze(){this._listeners={}}ze.prototype.on=function(Qe,Pi){if(this._listeners[Qe])throw new RangeError("there is already a listener for "+Qe);if(typeof Pi!="function")throw new TypeError("callback argument must be a function");this._listeners[Qe]=Pi},ze.prototype._send=function(Qe,Pi,nn){nn===void 0?nn=[]:Array.isArray(nn)||(nn=[nn]),self.postMessage({id:Qe,data:Pi},nn)},ze.prototype._trigger=function(Qe,Pi){if(!this._listeners[Qe])throw new Error("event "+Qe+" is not defined");this._listeners[Qe].apply(null,Pi)};var Ke=new ze;self.onmessage=function(Qe){switch(Qe.data.action){case"exec":Qe.data.args.unshift(function(Pi,nn){Ke._send(Qe.data.id,Pi,nn)}),Ke._trigger(Qe.data.event,Qe.data.args);break;case"ping":Ke._send(Qe.data.id,"pong");break;default:throw new Error("unexpected action: "+Qe.data.action)}}},f=qe.toString().split('"CODE";');return workerTemplate.newWorkerURL=function(Ke,Qe){var Pi=new Blob(["(",f[0],"importScripts.apply(self, "+JSON.stringify(Qe)+`);
`,"(",Ke,")();",f[1],")();"],{type:"application/javascript"});return URL.createObjectURL(Pi)},workerTemplate}var src,hasRequiredSrc;function requireSrc(){if(hasRequiredSrc)return src;hasRequiredSrc=1;var qe=requireWorkerTemplate(),f=navigator.hardwareConcurrency||1;function ze(Ke,Qe){if(typeof Ke!="string"&&typeof Ke!="function")throw new TypeError("func argument must be a function");if(Qe===void 0&&(Qe={}),typeof Qe!="object"||Qe===null)throw new TypeError("options argument must be an object");this._workerCode=Ke.toString(),Qe.maxWorkers===void 0||Qe.maxWorkers==="auto"?this._numWorkers=Math.min(f-1,1):Qe.maxWorkers>0?this._numWorkers=Math.min(Qe.maxWorkers,f):this._numWorkers=f,this._workers=new Map,this._timeout=Qe.timeout||0,this._terminateOnError=!!Qe.terminateOnError;var Pi=Qe.deps;typeof Pi=="string"&&(Pi=[Pi]),Array.isArray(Pi)||(Pi=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(Pi)}return ze.prototype._init=function(Ke){for(var Qe=qe.newWorkerURL(this._workerCode,Ke),Pi=0;Pi<this._numWorkers;Pi++){var nn=new Worker(Qe);nn.onmessage=this._onmessage.bind(this,nn),nn.onerror=this._onerror.bind(this,nn),nn.running=!1,nn.id=Pi,this._workers.set(nn,null)}URL.revokeObjectURL(Qe)},ze.prototype._onerror=function(Ke,Qe){if(!this._terminated){this._working--,Ke.running=!1;var Pi=this._workers.get(Ke);Pi&&Pi[1](Qe.message),this._workers.set(Ke,null),this._terminateOnError?this.terminate():this._exec()}},ze.prototype._onmessage=function(Ke,Qe){if(!this._terminated){this._working--,Ke.running=!1;var Pi=this._workers.get(Ke);Pi&&Pi[0](Qe.data.data),this._workers.set(Ke,null),this._exec()}},ze.prototype._exec=function(){for(var Ke of this._workers.keys()){if(this._working===this._numWorkers||this._waiting.length===0)return;if(!Ke.running)for(var Qe=0;Qe<this._waiting.length;Qe++){var Pi=this._waiting[Qe];if(!(typeof Pi[4]=="number"&&Pi[4]!==Ke.id)){this._waiting.splice(Qe,1),Ke.postMessage({action:"exec",event:Pi[0],args:Pi[1]},Pi[2]),Ke.running=!0,Ke.time=Date.now(),this._workers.set(Ke,Pi[3]),this._working++;break}}}},ze.prototype.terminate=function(){if(!this._terminated){for(var Ke of this._workers)Ke[0].terminate(),Ke[1]&&Ke[1][1](new Error("Terminated"));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}},ze.prototype.postAll=function(Ke,Qe){if(this._terminated)throw new Error("Cannot post (terminated)");var Pi=[];for(var nn of this._workers.keys())Pi.push(this.post(Ke,Qe,[],nn.id));return Promise.all(Pi)},ze.prototype.post=function(Ke,Qe,Pi,nn){Qe===void 0&&(Qe=[]),Pi===void 0&&(Pi=[]),Array.isArray(Qe)||(Qe=[Qe]),Array.isArray(Pi)||(Pi=[Pi]);var ln=this;return new Promise(function(cn,hn){if(ln._terminated)throw new Error("Cannot post (terminated)");ln._waiting.push([Ke,Qe,Pi,[cn,hn],nn]),ln._exec()})},src=ze,src}var srcExports=requireSrc();const WorkerManager=getDefaultExportFromCjs(srcExports),defaultOptions={regression:{kernelType:"polynomial",kernelOptions:{degree:2,constant:1}},threshold:.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]};function run(qe,f,ze){f=Object.assign({},defaultOptions,f);const Ke=this.manager;return Array.isArray(qe)?Promise.all(qe.map(function(Qe){const Pi=runOnce(Ke,Qe,f);return typeof ze=="function"&&Pi.then(ze),Pi})):runOnce(Ke,qe,f)}function runOnce(qe,f,ze){return qe.post("data",[f,ze]).then(function(Ke){for(let Qe in Ke)Ke[Qe]=new Image$1(Ke[Qe]);return Ke})}function work(){worker.on("data",function(qe,f,ze){f=new IJS(f);const Ke={},Qe=[],Pi=f.grey(),nn=Pi.sobelFilter();Un("sobel",nn);const ln=nn.level().mask({threshold:ze.threshold});Un("mask",ln);const cn=nn.getRoiManager();cn.fromMask(ln);const hn=cn.getMask(ze.roi);Un("realMask",hn);const un=Pi.getPixelsGrid({sampling:ze.sampling,mask:hn}),zn=f.getBackground(un.xyS,un.zS,ze.regression);Un("background",zn);const Xn=f.subtract(zn);Ke.result=Xn,Qe.push(Xn.data.buffer),qe(Ke,Qe);function Un(qn,ys){ze.include.includes(qn)&&(Ke[qn]=ys,Qe.push(ys.data.buffer))}})}const background={run,work};function extend$1(qe){qe.extendMethod("background",background)}let Worker$1=class Vc{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(this._url===null)throw new Error("image worker must be initialized with an URL")}get url(){return this._url}set url(f){if(typeof f!="string")throw new TypeError("worker URL must be a string");this._url=f,this._deps[0]=f}static extendMethod(f,ze){let Ke,Qe,Pi={};function nn(...ln){return Ke||(this.checkUrl(),Qe=this.url,Ke=new WorkerManager(ze.work,{deps:Qe}),Pi.manager=Ke),ze.run.call(Pi,...ln)}nn.reset=function(){Ke&&(Ke.terminate(),Ke=new WorkerManager(ze.work,{deps:Qe}),Pi.manager=Ke)},Vc.prototype[f]=nn}};extend$1(Worker$1);/*! @alxcube/lens 2.0.1
 2020-2023 Alexander Alexandrov <alxcube@gmail.com>
License: Apache-2.0 */class et{constructor(f){if(this.neighborsCount=f,![2,3,4].includes(this.neighborsCount))throw new RangeError(`Neighbors count must be 2, 3 or 4. ${this.neighborsCount} given`)}interpolate(f,ze,Ke){let Qe,Pi;const nn=this.neighborsCount;switch(nn){case 2:Qe=Math.floor(ze),Pi=Math.floor(Ke);break;case 3:Qe=Math.floor(ze+.5)-1,Pi=Math.floor(Ke+.5)-1;break;case 4:Qe=Math.floor(ze)-1,Pi=Math.floor(Ke)-1}const ln=Qe+nn,cn=Pi+nn,hn=[0,0,0,0];for(let zn=Pi;zn<cn;zn++)for(let Xn=Qe;Xn<ln;Xn++){const Un=f.getPixelColor(Xn,zn);hn[0]+=Un[0],hn[1]+=Un[1],hn[2]+=Un[2],hn[3]+=Un[3]}const un=1/(nn*nn);return[Math.round(hn[0]*un),Math.round(hn[1]*un),Math.round(hn[2]*un),Math.round(hn[3]*un)]}}class At{interpolate(f){return f.getBackgroundColor()}}class Mt{interpolate(f,ze,Ke){return f.getPixelColor(Math.floor(ze),Math.floor(Ke))}}var w=(qe=>(qe[qe.AVERAGE=1]="AVERAGE",qe[qe.AVERAGE_9=2]="AVERAGE_9",qe[qe.AVERAGE_16=3]="AVERAGE_16",qe[qe.BACKGROUND=4]="BACKGROUND",qe[qe.INTEGER=8]="INTEGER",qe))(w||{});class Et{create(f){switch(f){case w.AVERAGE:return new et(2);case w.AVERAGE_9:return new et(3);case w.AVERAGE_16:return new et(4);case w.BACKGROUND:return new At;case w.INTEGER:return new Mt}throw new TypeError(`Unknown interpolation method: ${f}`)}}class Ft{constructor(f,ze){this.colorResamplerFactoriesPool=f,this.resampleFilterResolver=ze}resolve(f,ze,Ke={}){const{preferredResampler:Qe,filter:Pi,matteColor:nn,interpolationMethod:ln,virtualPixelMethod:cn}=Ke,hn=this.getColorResamplerFactory(Qe,Pi);let un;return Pi&&hn.supportsEwa&&(un=this.resampleFilterResolver.resolve(Pi,Ke)),hn.create(f,ze,{resampleFilter:un,matteColor:nn,interpolationMethod:ln,virtualPixelMethod:cn})}getColorResamplerFactory(f,ze){let Ke;if(f!==void 0){const Pi=this.colorResamplerFactoriesPool.get(f);if(Pi.requiresResampleFilter&&!ze)throw new TypeError(`Preferred color resampler "${f}" requires ResampleFilter`);return Pi}if(ze!==void 0&&(Ke=this.colorResamplerFactoriesPool.items().find(Pi=>Pi.supportsEwa),Ke))return Ke;const Qe=this.colorResamplerFactoriesPool.items().filter(Pi=>!Pi.requiresResampleFilter);if(!Qe.length)throw new Error("No color resampler factories in pool.");return Qe[0]}}function Vt(qe){return typeof qe=="object"&&qe!==null&&typeof qe.getResampledColor=="function"&&typeof qe.setScaling=="function"&&typeof qe.getScaling=="function"}class x{constructor(f){this.decorated=f,this.width=this.decorated.width,this.height=this.decorated.height,{x1:this.offsetX,y1:this.offsetY}=this.decorated.getViewport()}getPixelColor(f,ze){return f=Math.floor(f-this.offsetX),ze=Math.floor(ze-this.offsetY),f>=0&&f<this.width&&ze>=0&&ze<this.height?this.decorated.getPixelColor(f,ze):this.getVirtualPixelColor(f,ze)}setPixelColor(f,ze,Ke){f=Math.floor(f-this.offsetX),ze=Math.floor(ze-this.offsetY),f>=0&&f<this.width&&ze>=0&&ze<this.height&&this.decorated.setPixelColor(f,ze,Ke)}getQuantumRange(){return this.decorated.getQuantumRange()}getViewport(){return this.decorated.getViewport()}getAverageColor(){return this.decorated.getAverageColor()}getBackgroundColor(){return this.decorated.getBackgroundColor()}getDecorated(){return this.decorated}}class It extends x{getVirtualPixelColor(){return this.decorated.getBackgroundColor()}}class Q extends x{constructor(f,ze){super(f),this.color=ze}getVirtualPixelColor(){return this.color}}class Tt extends x{getVirtualPixelColor(f,ze){return this.decorated.getPixelColor(Math.max(0,Math.min(this.width-1,f)),Math.max(0,Math.min(this.height-1,ze)))}}class bt extends x{getVirtualPixelColor(f,ze){if(ze<0||ze>=this.height)return this.decorated.getPixelColor(Math.max(0,Math.min(this.width-1,f)),Math.max(0,Math.min(this.height-1,ze)));const Ke=f%this.width,Qe=ze%this.height;return this.decorated.getPixelColor(Ke<0?this.width+Ke:Ke,Qe<0?this.height+Qe:Qe)}}class Bt extends x{getVirtualPixelColor(f,ze){if(ze<0||ze>=this.height)return this.decorated.getBackgroundColor();const Ke=f%this.width,Qe=ze%this.height;return this.decorated.getPixelColor(Ke<0?this.width+Ke:Ke,Qe<0?this.height+Qe:Qe)}}class Lt extends x{getVirtualPixelColor(f,ze){const Ke=2*this.width,Qe=2*this.height,Pi=f%Ke,nn=ze%Qe;let ln=Pi<0?Ke+Pi:Pi,cn=nn<0?Qe+nn:nn;return ln>this.width-1&&(ln=this.width-(ln-this.width)-1),cn>this.height-1&&(cn=this.height-(cn-this.height)-1),this.decorated.getPixelColor(ln,cn)}}class St extends x{getVirtualPixelColor(){return this.decorated.getPixelColor(Math.floor(Math.random()*this.width),Math.floor(Math.random()*this.height))}}class Ot extends x{getVirtualPixelColor(f,ze){const Ke=f%this.width,Qe=ze%this.height;return this.decorated.getPixelColor(Ke<0?this.width+Ke:Ke,Qe<0?this.height+Qe:Qe)}}class Dt extends x{getVirtualPixelColor(f,ze){if(f<0||f>=this.width)return this.decorated.getPixelColor(Math.max(0,Math.min(this.width-1,f)),Math.max(0,Math.min(this.height-1,ze)));const Ke=f%this.width,Qe=ze%this.height;return this.decorated.getPixelColor(Ke<0?this.width+Ke:Ke,Qe<0?this.height+Qe:Qe)}}class kt extends x{getVirtualPixelColor(f,ze){if(f<0||f>=this.width)return this.decorated.getBackgroundColor();const Ke=f%this.width,Qe=ze%this.height;return this.decorated.getPixelColor(Ke<0?this.width+Ke:Ke,Qe<0?this.height+Qe:Qe)}}var p=(qe=>(qe[qe.BACKGROUND=1]="BACKGROUND",qe[qe.EDGE=3]="EDGE",qe[qe.MIRROR=4]="MIRROR",qe[qe.RANDOM=5]="RANDOM",qe[qe.TILE=6]="TILE",qe[qe.TRANSPARENT=7]="TRANSPARENT",qe[qe.BLACK=9]="BLACK",qe[qe.GRAY=10]="GRAY",qe[qe.WHITE=11]="WHITE",qe[qe.HORIZONTAL_TILE=12]="HORIZONTAL_TILE",qe[qe.VERTICAL_TILE=13]="VERTICAL_TILE",qe[qe.HORIZONTAL_TILE_EDGE=14]="HORIZONTAL_TILE_EDGE",qe[qe.VERTICAL_TILE_EDGE=15]="VERTICAL_TILE_EDGE",qe))(p||{});class Nt{decorate(f,ze){switch(ze){case p.BACKGROUND:return new It(f);case p.EDGE:return new Tt(f);case p.MIRROR:return new Lt(f);case p.RANDOM:return new St(f);case p.TILE:return new Ot(f);case p.TRANSPARENT:return new Q(f,[0,0,0,0]);case p.BLACK:return new Q(f,[0,0,0,f.getQuantumRange()]);case p.GRAY:return new Q(f,[Math.floor(f.getQuantumRange()/2),Math.floor(f.getQuantumRange()/2),Math.floor(f.getQuantumRange()/2),f.getQuantumRange()]);case p.WHITE:return new Q(f,[f.getQuantumRange(),f.getQuantumRange(),f.getQuantumRange(),f.getQuantumRange()]);case p.HORIZONTAL_TILE:return new Bt(f);case p.VERTICAL_TILE:return new kt(f);case p.HORIZONTAL_TILE_EDGE:return new bt(f);case p.VERTICAL_TILE_EDGE:return new Dt(f);default:throw new TypeError(`Unknown Virtual Pixel Method "${ze}" given.`)}}}function Gt(qe){return typeof qe=="object"&&qe!==null&&typeof qe.getAverageColor=="function"}function Wt(qe){return typeof qe=="object"&&qe!==null&&typeof qe.getBackgroundColor=="function"}function Ht(qe){return typeof qe=="object"&&qe!==null&&typeof qe.getPixelColor=="function"&&typeof qe.setPixelColor=="function"&&typeof qe.getQuantumRange=="function"}function _t(qe){return typeof Ht(qe)&&typeof qe.width=="number"&&typeof qe.height=="number"}class y{constructor(f,ze,Ke,Qe){this.x1=f,this.y1=ze,this.x2=Ke,this.y2=Qe}static fromLiteral(f){let ze,Ke,Qe,Pi;return"width"in f&&"height"in f?(ze=f.x||0,Ke=f.y||0,Qe=ze+f.width-1,Pi=Ke+f.height-1):(ze=f.x1,Ke=f.y1,Qe=f.x2,Pi=f.y2),new y(ze,Ke,Qe,Pi)}getWidth(){return this.x2-this.x1+1}getHeight(){return this.y2-this.y1+1}getArea(){return this.getWidth()*this.getHeight()}expand(f,ze){return this.x1=Math.min(this.x1,f),this.x2=Math.max(this.x2,f),this.y1=Math.min(this.y1,ze),this.y2=Math.max(this.y2,ze),this}clone(){return new y(this.x1,this.y1,this.x2,this.y2)}fixBounds(){return this.x1=Math.floor(this.x1-.5),this.y1=Math.floor(this.y1-.5),this.x2=Math.ceil(this.x2-.5),this.y2=Math.ceil(this.y2-.5),this}scale(f){const ze=this.getWidth()*f,Ke=this.getHeight()*f;return this.x1=this.x1*f,this.y1=this.y1*f,this.x2=this.x1+ze-1,this.y2=this.y1+Ke-1,this}reset(){const f=this.getWidth(),ze=this.getHeight();return this.x1=0,this.y1=0,this.x2=this.x1+f-1,this.y2=this.y1+ze-1,this}offset(f,ze){return this.x1+=f,this.y1+=ze,this.x2+=f,this.y2+=ze,this}}function j(qe){if(typeof qe!="object"||qe===null)return!1;const f=qe;return"x1"in f&&typeof f.x1=="number"&&"y1"in f&&typeof f.y1=="number"&&"x2"in f&&typeof f.x2=="number"&&"y2"in f&&typeof f.y2=="number"||"width"in f&&typeof f.width=="number"&&"height"in f&&typeof f.height=="number"&&(!("x"in f)||typeof f.x=="number")&&(!("y"in f)||typeof f.y=="number")}function qt(qe){return _t(qe)&&typeof qe.getViewport=="function"}function Ut(qe){return Vt(qe)&&typeof qe.getWeightLookupTable=="function"}const F=Number.EPSILON===void 0?Math.pow(2,-52):Number.EPSILON,Xt=Number.MAX_VALUE,D=Math.PI/2,k=2*Math.PI;function xt(qe,f,ze=.5){const Ke=1-ze,Qe=[0,0,0,0];for(let Pi=0;Pi<4;Pi++)Qe[Pi]=Math.round(qe[Pi]*ze+f[Pi]*Ke);return Qe}function Qt(){const qe={};return qe.promise=new Promise((f,ze)=>{qe.resolve=f,qe.reject=ze}),qe}function ut(qe){return Math.PI*qe/180}function st(qe){const f=qe<0?-1:1;return f*qe>=F?1/qe:f/F}function Yt(qe,f){(function(hn,un){const zn=hn.length;hn.forEach(Xn=>{if(Xn.length!==zn)throw new TypeError("Matrix must be square")}),un.forEach(Xn=>{if(Xn.length!==zn)throw new TypeError("Augment matrix vector length must be same as matrix rank")})})(qe,f),qe=gt(qe),f=gt(f);const ze=qe.length,Ke=f.length,Qe=new Array(ze).fill(0),Pi=new Array(ze).fill(0),nn=new Array(ze).fill(0);let ln=0,cn=0;for(let hn=0;hn<ze;hn++){let un=0;for(let Xn=0;Xn<ze;Xn++)if(nn[Xn]!==1)for(let Un=0;Un<ze;Un++)nn[Un]!==0?nn[Un]>1&&pt():Math.abs(qe[Xn][Un])>=un&&(un=Math.abs(qe[Xn][Un]),cn=Xn,ln=Un);if(nn[ln]++,cn!==ln){for(let Xn=0;Xn<ze;Xn++)rt(qe,cn,Xn,ln,Xn);for(let Xn=0;Xn<Ke;Xn++)rt(f,Xn,cn,Xn,ln)}Pi[hn]=cn,Qe[hn]=ln,qe[ln][ln]===0&&pt();const zn=st(qe[ln][ln]);qe[ln][ln]=1;for(let Xn=0;Xn<ze;Xn++)qe[ln][Xn]*=zn;for(let Xn=0;Xn<Ke;Xn++)f[Xn][ln]*=zn;for(let Xn=0;Xn<ze;Xn++)if(Xn!==ln){const Un=qe[Xn][ln];qe[Xn][ln]=0;for(let qn=0;qn<ze;qn++)qe[Xn][qn]-=Un*qe[ln][qn];for(let qn=0;qn<Ke;qn++)f[qn][Xn]-=Un*f[qn][ln]}}for(let hn=ze-1;hn>=0;hn--)if(Qe[hn]!==Pi[hn])for(let un=0;un<ze;un++)rt(qe,un,Pi[hn],un,Qe[hn]);return f}function rt(qe,f,ze,Ke,Qe){qe[f][ze]!==qe[Ke][Qe]&&(qe[f][ze]+=qe[Ke][Qe],qe[Ke][Qe]=qe[f][ze]-qe[Ke][Qe],qe[f][ze]-=qe[Ke][Qe])}function gt(qe){return qe.map(f=>f.slice())}function pt(){throw new TypeError("Can't solve given matrix using Gauss-Jordan method")}class ot{constructor(f,ze=1){this.coefficients=[],this.results=[];for(let Ke=0;Ke<f;Ke++)this.coefficients.push(new Array(f).fill(0));for(let Ke=0;Ke<ze;Ke++)this.results.push(new Array(f).fill(0))}addTerms(f,ze){const Ke=this.coefficients.length;for(let Qe=0;Qe<Ke;Qe++){for(let Pi=0;Pi<Ke;Pi++)this.coefficients[Pi][Qe]+=f[Pi]*f[Qe];for(let Pi=0;Pi<this.results.length;Pi++)this.results[Pi][Qe]+=ze[Pi]*f[Qe]}return this}solve(){return Yt(this.coefficients,this.results)}}function O(qe,f,ze=!1){if(ze){const Ke=document.createElement("canvas");return Ke.width=qe,Ke.height=f,Ke}return new OffscreenCanvas(qe,f)}function jt(qe,f=new Image){return new Promise((ze,Ke)=>{const Qe=()=>{f.onload=null,f.onerror=null};f.onload=()=>{Qe(),ze(f)},f.onerror=()=>{Qe(),Ke(new Error(`Couldn't load image "${qe}"`))},f.src=qe})}let $$1=class extends Error{constructor(f){super(f),this.name="LensException",typeof Error.captureStackTrace=="function"?Error.captureStackTrace(this,this.constructor):this.stack=new Error(f).stack}};class $t extends $$1{constructor(f){super(f),this.name="AbortException"}}class B extends $$1{constructor(f){super(f),this.name="InvalidArgument"}}class at extends $$1{constructor(f){super(f),this.name="InvalidArgumentsLength"}}function Kt(qe,f,ze){return[ze[0]*qe+ze[1]*f+ze[2],ze[3]*qe+ze[4]*f+ze[5]]}function dt(qe){const f=st(qe[0]*qe[4]-qe[1]*qe[3]);if(!f)throw new B("Given matrix can't be inverted");return[f*qe[4],f*-qe[1],f*(qe[1]*qe[5]-qe[2]*qe[4]),f*-qe[3],f*qe[0],f*(qe[2]*qe[3]-qe[0]*qe[5])]}class G{constructor(f){this.matrix=f,this.isConstantPartialDerivatives=!0,this.forwardMatrix=dt(f)}static fromForwardMatrix(f){return new G(dt(f))}reverseMap(f,ze){return[this.matrix[0]*f+this.matrix[1]*ze+this.matrix[2],this.matrix[3]*f+this.matrix[4]*ze+this.matrix[5]]}getValidity(){return 1}getPartialDerivatives(){return[this.matrix[0],this.matrix[1],this.matrix[3],this.matrix[4]]}forwardMap(f,ze){return Kt(f,ze,this.forwardMatrix)}getBestFitViewport(f){const ze=f.x1,Ke=f.y1,Qe=f.x2+1,Pi=f.y2+1,[nn,ln]=this.forwardMap(ze,Ke),cn=new y(nn,ln,nn,ln);return[[Qe,Ke],[Qe,Pi],[ze,Pi]].forEach(hn=>cn.expand(...this.forwardMap(...hn))),cn.fixBounds(),cn}}class Zt{create(f){if(!f.length||f.length%4!=0)throw new at(`Number of arguments must be multiple of 4 and at least 4 arguments (1 control point) expected.${f.length} arguments given.`);if(f.length===4)return new G([1,0,f[0]-f[2],0,1,f[1]-f[3]]);{const ze=new ot(3,2);for(let Qe=0;Qe<f.length;Qe+=4){const[Pi,nn,ln,cn]=f.slice(Qe,Qe+4);ze.addTerms([ln,cn,1],[Pi,nn])}f.length===8&&ze.addTerms([f[2]-(f[7]-f[3]),f[3]+(f[6]-f[2]),1],[f[0]-f[5]+f[1],f[1]+f[4]-f[0]]);const Ke=ze.solve();return new G(Ke[0].concat(Ke[1]))}}}class zt{create(f){const[ze,Ke,Qe,Pi,nn,ln]=f;return G.fromForwardMatrix([ze,Qe,nn,Ke,Pi,ln])}}class Jt{constructor(f,ze,Ke,Qe,Pi,nn){this.isConstantPartialDerivatives=!1,this.forceBestFit=!0,this.viewport=f,this.c0=ze,this.c1=Ke,this.c2=Qe,this.c3=Pi,this.c4=nn,this.angleToWidth=k*this.viewport.getWidth()/this.c1,this.radiusToHeight=this.viewport.getHeight()/this.c3,this.viewportWidthX2=2*this.viewport.getWidth()}reverseMap(f,ze){let[Ke,Qe]=this.getUV(f,ze);return Ke=Ke*this.angleToWidth+this.c4+this.viewport.x1+.5,Qe=(this.c2-Qe)*this.radiusToHeight+this.viewport.y1,[Ke,Qe]}getValidity(){return 1}getPartialDerivatives(f,ze){const[,Ke]=this.getUV(f,ze);return Ke>F?[this.angleToWidth/(k*Ke),0,0,this.radiusToHeight]:[this.viewportWidthX2,0,0,this.radiusToHeight]}getBestFitViewport(f){let ze=this.c0-this.c1/2,Ke=Math.cos(ze),Qe=Math.sin(ze),Pi=this.c2*Ke,nn=this.c2*Qe;const ln=new y(Pi,nn,Pi,nn);for(Pi=(this.c2-this.c3)*Ke,nn=(this.c2-this.c3)*Qe,ln.expand(Pi,nn),ze=this.c0+this.c1/2,Ke=Math.cos(ze),Qe=Math.sin(ze),Pi=this.c2*Ke,nn=this.c2*Qe,ln.expand(Pi,nn),Pi=(this.c2-this.c3)*Ke,nn=(this.c2-this.c3)*Qe,ln.expand(Pi,nn),ze=Math.ceil((this.c0-this.c1/2)/D)*D;ze<this.c0+this.c1/2;ze+=D)Ke=Math.cos(ze),Qe=Math.sin(ze),Pi=this.c2*Ke,nn=this.c2*Qe,ln.expand(Pi,nn);return ln.fixBounds(),ln}getUV(f,ze){let Ke=(Math.atan2(ze,f)-this.c0)/k;return Ke-=Math.round(Ke),[Ke,Math.hypot(f,ze)]}}class te{create(f,ze){if(f.length>=1&&f[0]<F)throw new B("Angle too small");if(f.length>=3&&f[2]!==void 0&&f[2]<F)throw new B("Outer radius too small");let Ke,Qe,Pi,nn;Ke=-D,Qe=f.length>=1?ut(f[0]):D,f.length>=2&&f[1]!==void 0&&(Ke+=ut(f[1])),Ke/=k,Ke-=Math.round(Ke),Ke*=k,nn=ze.getHeight()-1,Pi=ze.getWidth()/Qe+nn/2,f.length>=3&&f[2]!==void 0&&f[3]!==void 0&&(f.length>=4?nn=f[2]-f[3]:nn*=f[2]/Pi,Pi=f[2]);const ln=(ze.getWidth()-1)/2;return new Jt(ze,Ke,Qe,Pi,nn,ln)}}function ft(qe){const f=st(qe[0]*qe[4]-qe[3]*qe[1]);if(!f)throw new B("Given matrix can't be inverted");return[f*(qe[4]-qe[7]*qe[5]),f*(qe[7]*qe[2]-qe[1]),f*(qe[1]*qe[5]-qe[4]*qe[2]),f*(qe[6]*qe[5]-qe[3]),f*(qe[0]-qe[6]*qe[2]),f*(qe[3]*qe[2]-qe[0]*qe[5]),f*(qe[3]*qe[7]-qe[6]*qe[4]),f*(qe[6]*qe[1]-qe[0]*qe[7])]}function ee(qe,f,ze){const Ke=ze[0]*qe+ze[1]*f+ze[2],Qe=ze[3]*qe+ze[4]*f+ze[5],Pi=ze[6]*qe+ze[7]*f+1;return[Ke/Pi,Qe/Pi]}class K{constructor(f,ze){this.isConstantPartialDerivatives=!1,this.matrix=f,this.denominator=ze,this.forwardMatrix=ft(f),this.absC6=Math.abs(f[6]),this.absC7=Math.abs(f[7])}static fromForwardMatrix(f){const ze=ft(f),Ke=ze[6]*f[2]+ze[7]*f[5]+1<0?-1:1;return new K(ze,Ke)}reverseMap(f,ze){const Ke=this.matrix[0]*f+this.matrix[1]*ze+this.matrix[2],Qe=this.matrix[3]*f+this.matrix[4]*ze+this.matrix[5],Pi=this.matrix[6]*f+this.matrix[7]*ze+1;return[Ke/Pi,Qe/Pi]}getValidity(f,ze,Ke){const Qe=this.matrix[6]*f+this.matrix[7]*ze+1;let Pi=Qe*this.denominator<0?0:1;const nn=2*Math.abs(Qe);return this.absC6>this.absC7?nn<this.absC6&&(Pi=.5-this.denominator*Qe/(this.matrix[6]*Ke)):nn<this.absC7&&(Pi=.5-this.denominator*Qe/(this.matrix[7]*Ke)),Pi}getPartialDerivatives(f,ze){const Ke=this.matrix[0]*f+this.matrix[1]*ze+this.matrix[2],Qe=this.matrix[3]*f+this.matrix[4]*ze+this.matrix[5],Pi=this.matrix[6]*f+this.matrix[7]*ze+1,nn=Math.pow(1/Pi,2);return[(Pi*this.matrix[0]-Ke*this.matrix[6])*nn,(Pi*this.matrix[1]-Ke*this.matrix[7])*nn,(Pi*this.matrix[3]-Qe*this.matrix[6])*nn,(Pi*this.matrix[4]-Qe*this.matrix[7])*nn]}forwardMap(f,ze){return ee(f,ze,this.forwardMatrix)}getBestFitViewport(f){const ze=f.x1,Ke=f.y1,Qe=f.x2+1,Pi=f.y2+1,[nn,ln]=this.forwardMap(ze,Ke),cn=new y(nn,ln,nn,ln);return[[Qe,Ke],[Qe,Pi],[ze,Pi]].forEach(hn=>cn.expand(...this.forwardMap(...hn))),cn.fixBounds(),cn}}class re{create(f){if(f.length<16||f.length%4!=0)throw new at(`Number of arguments must be multiple of 4 and at least 16 arguments (4 control points) expected. ${f.length} arguments given.`);const ze=new ot(8,1);for(let Pi=0;Pi<f.length;Pi+=4){const[nn,ln,cn,hn]=f.slice(Pi,Pi+4);ze.addTerms([cn,hn,1,0,0,0,-cn*nn,-hn*nn],[nn]).addTerms([0,0,0,cn,hn,1,-cn*ln,-hn*ln],[ln])}const Ke=ze.solve()[0],Qe=Ke[6]*f[2]+Ke[7]*f[3]+1<0?-1:1;return new K(Ke,Qe)}}class ie{create(f){return K.fromForwardMatrix(f)}}class se{constructor(f){this.coeffs=f,this.isConstantPartialDerivatives=!1}reverseMap(f,ze){const Ke=this.coeffs[1];let Qe=0,Pi=0;for(let nn=0;nn<Ke;nn++){const ln=vt(nn,f,ze);Qe+=ln*this.coeffs[2+nn],Pi+=ln*this.coeffs[2+nn+Ke]}return[Qe,Pi]}getValidity(){return 1}getPartialDerivatives(f,ze){const Ke=this.coeffs[1];let Qe=0,Pi=0,nn=0,ln=0;for(let cn=0;cn<Ke;cn++){const hn=yt(cn,f,ze),un=ae(cn,f,ze),zn=2+cn,Xn=zn+Ke;Qe=hn*this.coeffs[zn],Pi=un*this.coeffs[zn],nn=hn*this.coeffs[Xn],ln=un*this.coeffs[Xn]}return[Qe,Pi,nn,ln]}}class oe{create(f){const ze=function(Qe){if(Qe<1||Qe>5||Qe!=Math.floor(Qe)&&Qe-1.5>F)throw new B(`Invalid polynomial order: ${Qe}`);return Math.floor((Qe+1)*(Qe+2)/2)}(f[0]);if(f.length<1+4*ze)throw new at(`Polynomial distortion of order ${f[0]} requires at least ${ze} control point pairs (1 + ${4*ze} arguments)`);const Ke=new ot(ze,2);for(let Qe=1;Qe<f.length;Qe+=4){const Pi=[];for(let nn=0;nn<ze;nn++)Pi[nn]=vt(nn,f[Qe+2],f[Qe+3]);Ke.addTerms(Pi,f.slice(Qe,Qe+2))}return new se([f[0],ze].concat(Ke.solve().flat()))}}function vt(qe,f,ze){switch(qe){case 0:return 1;case 1:return f;case 2:return ze;case 3:return f*ze;case 4:return f*f;case 5:return ze*ze;case 6:return f*f*f;case 7:return f*f*ze;case 8:return f*ze*ze;case 9:return ze*ze*ze;case 10:return f*f*f*f;case 11:return f*f*f*ze;case 12:return f*f*ze*ze;case 13:return f*ze*ze*ze;case 14:return ze*ze*ze*ze;case 15:return f*f*f*f*f;case 16:return f*f*f*f*ze;case 17:return f*f*f*ze*ze;case 18:return f*f*ze*ze*ze;case 19:return f*ze*ze*ze*ze;case 20:return ze*ze*ze*ze*ze}return 0}function yt(qe,f,ze){switch(qe){case 0:case 2:case 5:case 9:case 14:case 20:return 0;case 1:return 1;case 3:return ze;case 4:return f;case 6:return f*f;case 7:return f*ze;case 8:return ze*ze;case 10:return f*f*f;case 11:return f*f*ze;case 12:return f*ze*ze;case 13:return ze*ze*ze;case 15:return f*f*f*f;case 16:return f*f*f*ze;case 17:return f*f*ze*ze;case 18:return f*ze*ze*ze;case 19:return ze*ze*ze*ze}return 0}function ae(qe,f,ze){switch(qe){case 0:case 1:case 4:return 0;case 2:return 1;case 3:return f;case 5:return ze;default:return yt(qe-1,f,ze)}}class ne{constructor(f){this.reversePixelMapperFactoriesPool=f}resolve(f,ze,Ke){return this.reversePixelMapperFactoriesPool.get(f).create(ze,Ke)}}function nt(qe){return typeof qe=="object"&&qe!==null&&typeof qe.reverseMap=="function"&&typeof qe.getValidity=="function"}function mt(qe){return nt(qe)&&typeof qe.getBestFitViewport=="function"}var E=(qe=>(qe.AFFINE="Affine",qe.AFFINE_PROJECTION="AffineProjection",qe.PERSPECTIVE="Perspective",qe.PERSPECTIVE_PROJECTION="PerspectiveProjection",qe.ARC="Arc",qe.POLYNOMIAL="Polynomial",qe))(E||{});function he(qe){return nt(qe)&&typeof qe.getPartialDerivatives=="function"&&typeof qe.isConstantPartialDerivatives=="boolean"}function Y(qe,f){return Math.max(0,Math.min(f,qe))}class le{constructor(f,ze,Ke,Qe,Pi,nn,ln=[0,0,0,0],cn){if(!he(ze))throw new B("Pixel Mapper must implement ReversePixelMapperWithEwaSupport in order to use Elliptical Weighted Average re-sampling.");this.supportSq=Qe*Qe,this.matteColor=ln,this.weightLookupTable=Ke,this.weightLookupTableSize=Ke.length,this.image=f,this.pixelMapper=ze,this.imageViewport=this.image.getViewport(),this.imageArea=this.imageViewport.getArea(),this.imageVirtualPixelMethod=cn,this.imageAverageColor=null,this.A=0,this.B=0,this.C=0,this.F=0,this.uLimit=0,this.vLimit=0,this.uWidth=0,this.slope=0,this.ellipseIsSetUp=!1,this.limitReached=!1,this.scaling=1,this.quantumRange=f.getQuantumRange(),this.averageInterpolator=Pi,this.defaultInterpolator=nn}getWeightLookupTable(){return this.weightLookupTable}getScaling(){return this.scaling}setScaling(f){return this.scaling=f,this}getResampledColor(f,ze){f=(f+.5)*this.scaling,ze=(ze+.5)*this.scaling;const Ke=this.pixelMapper.getValidity(f,ze,this.scaling);if(Ke>0){const[Qe,Pi]=this.pixelMapper.reverseMap(f,ze);if(!this.pixelMapper.isConstantPartialDerivatives||!this.ellipseIsSetUp){const ln=this.pixelMapper.getPartialDerivatives(f,ze);this.setupEllipse(ln[0],ln[1],ln[2],ln[3]),this.ellipseIsSetUp=!0}const nn=this.getWeightedAverage(Qe-.5,Pi-.5);return Ke<1?xt(nn,this.matteColor,Ke):nn}return this.matteColor}setupEllipse(f,ze,Ke,Qe){this.limitReached=!1;const Pi=this.scaling;return this.initEllipse(f*Pi,ze*Pi,Ke*Pi,Qe*Pi).scaleEllipse()}initEllipse(f,ze,Ke,Qe){const[Pi,nn,ln,cn,hn,un]=function(zn,Xn,Un,qn){const ys=zn*zn+Xn*Xn,vs=zn*Un+Xn*qn,ea=vs,na=Un*Un+qn*qn,ta=zn*qn-Xn*Un,ra=ta+ta,oa=ys+na,fa=(oa+ra)*(oa-ra),ca=Math.sqrt(fa>0?fa:0),la=.5*(oa+ca),ua=.5*(oa-ca),ga=la-ys,da=la-na,qa=ga*ga,tl=da*da,ol=qa>=tl?vs:da,hl=qa>=tl?ga:ea,wl=Math.sqrt(ol*ol+hl*hl),_l=wl>0?ol/wl:1,gl=wl>0?hl/wl:0,dl=la<=1?1:Math.sqrt(la),sl=ua<=1?1:Math.sqrt(ua);return[_l*dl,gl*dl,-gl*sl,_l*sl,dl,sl]}(f,ze,Ke,Qe);return this.A=nn*nn+cn*cn,this.B=-2*(Pi*nn+ln*cn),this.C=Pi*Pi+ln*ln,this.F=hn*un,this.F*=this.F,this.limitReached=4*this.A*this.C-this.B*this.B>Xt,this}scaleEllipse(){if(!this.limitReached){if(this.F*=this.supportSq,this.uLimit=Math.sqrt(this.C*this.F/(this.A*this.C-.25*this.B*this.B)),this.vLimit=Math.sqrt(this.A*this.F/(this.A*this.C-.25*this.B*this.B)),this.uWidth=Math.sqrt(this.F/this.A),this.slope=-this.B/(2*this.A),this.uWidth*this.vLimit>4*this.imageArea)return this.limitReached=!0,this;const f=this.weightLookupTableSize/this.F;this.A*=f,this.B*=f,this.C*=f}return this}getWeightedAverage(f,ze){if(this.doesntNeedResampling(f,ze))return this.image.getPixelColor(f,ze);if(this.limitReached)switch(this.imageVirtualPixelMethod){case p.EDGE:case p.HORIZONTAL_TILE_EDGE:case p.VERTICAL_TILE_EDGE:return this.averageInterpolator.interpolate(this.image,f,ze);case p.HORIZONTAL_TILE:case p.VERTICAL_TILE:return this.image.getPixelColor(this.imageViewport.x1-1,this.imageViewport.y1-1);default:return this.getImageAverageColor()}let Ke=0,Qe=0,Pi=0,nn=0,ln=0,cn=0;const hn=Math.ceil(ze-this.vLimit),un=Math.floor(ze+this.vLimit);let zn=f+(hn-ze)*this.slope-this.uWidth;const Xn=2*this.uWidth+1,Un=this.A,qn=this.B,ys=this.image,vs=this.weightLookupTable,ea=2*Un;for(let na=hn;na<un;na++){const ta=Math.ceil(zn);zn+=this.slope;const ra=ta+Xn,oa=ta-f,fa=na-ze;let ca=(Un*oa+qn*fa)*oa+this.C*fa*fa,la=Un*(2*oa+1)+qn*fa;for(let ua=ta;ua<ra;ua++){if(ca<this.weightLookupTableSize){let ga=vs[Math.floor(ca)];const[da,qa,tl,ol]=ys.getPixelColor(ua,na);cn+=ga*ol,Ke+=ga,ga*=ol/this.quantumRange,Pi+=da*ga,nn+=qa*ga,ln+=tl*ga,Qe+=ga}ca+=la,la+=ea}}return Qe&&Ke?[Y(Math.round(Pi/Qe),this.quantumRange),Y(Math.round(nn/Qe),this.quantumRange),Y(Math.round(ln/Qe),this.quantumRange),Y(Math.round(cn/Ke),this.quantumRange)]:this.defaultInterpolator.interpolate(this.image,f,ze)}doesntNeedResampling(f,ze){switch(this.imageVirtualPixelMethod){case p.TRANSPARENT:case p.BACKGROUND:case p.BLACK:case p.WHITE:case p.GRAY:return this.limitReached||this.outOfImageBounds(f,ze);case p.EDGE:return f+this.uLimit<this.imageViewport.x1&&ze+this.vLimit<this.imageViewport.y1||f+this.uLimit<this.imageViewport.x1&&ze-this.vLimit>this.imageViewport.y2||f-this.uLimit>this.imageViewport.x2&&ze+this.vLimit<this.imageViewport.y1||f-this.uLimit>this.imageViewport.x2&&ze-this.vLimit>this.imageViewport.y2;case p.HORIZONTAL_TILE:return ze+this.vLimit<this.imageViewport.y1||ze-this.vLimit>this.imageViewport.y2;case p.VERTICAL_TILE:return f+this.uLimit<this.imageViewport.x1||f-this.uLimit>this.imageViewport.x2;default:return!1}}getImageAverageColor(){return this.imageAverageColor===null&&(this.imageAverageColor=this.image.getAverageColor()),this.imageAverageColor}outOfImageBounds(f,ze){return f+this.uLimit<this.imageViewport.x1||f-this.uLimit>this.imageViewport.x2||ze+this.vLimit<this.imageViewport.y1||ze-this.vLimit>this.imageViewport.y2}}class ce{constructor(f){this.colorInterpolatorFactory=f,this.supportsEwa=!0,this.requiresResampleFilter=!0}create(f,ze,Ke={}){const{resampleFilter:Qe,matteColor:Pi=[0,0,0,0],interpolationMethod:nn=w.AVERAGE,virtualPixelMethod:ln=p.TRANSPARENT}=Ke;if(!Qe)throw new TypeError("EWA resampler requires ResampleFilter.");const cn=function(Xn){const Un=[],qn=Xn.getWorkingSupport()*Math.sqrt(1/wt);for(let ys=0;ys<wt;ys++)Un[ys]=Xn.getWeight(Math.sqrt(ys)*qn);return Un}(Qe),hn=Qe.getWorkingSupport(),un=this.colorInterpolatorFactory.create(w.AVERAGE),zn=nn===w.AVERAGE?un:this.colorInterpolatorFactory.create(nn);return new le(f,ze,cn,hn,un,zn,Pi,ln)}}const wt=1024;class ue{constructor(f,ze,Ke,Qe=[0,0,0,0]){this.image=f,this.pixelMapper=ze,this.interpolator=Ke,this.matteColor=Qe,this.scaling=1}getScaling(){return this.scaling}setScaling(f){return this.scaling=f,this}getResampledColor(f,ze){f=(f+.5)*this.scaling,ze=(ze+.5)*this.scaling;const Ke=this.pixelMapper.getValidity(f,ze,this.scaling);if(Ke>0){const[Qe,Pi]=this.pixelMapper.reverseMap(f,ze),nn=this.interpolator.interpolate(this.image,Qe-.5,Pi-.5);return Ke<1?xt(nn,this.matteColor,Ke):nn}return this.matteColor}}class ge{constructor(f){this.colorInterpolatorFactory=f,this.supportsEwa=!1,this.requiresResampleFilter=!1}create(f,ze,Ke={}){const{matteColor:Qe=[0,0,0,0],interpolationMethod:Pi=w.AVERAGE}=Ke;return new ue(f,ze,this.colorInterpolatorFactory.create(Pi),Qe)}}class pe{constructor(f){this.parsersPool=f}parse(f,ze=255){for(const Ke of this.parsersPool.items()){const Qe=Ke.parse(f,ze);if(Qe)return Qe}}}class de{parse(f,ze=255){/^#[a-f\d]{3}$/i.test(f)&&(f="#"+f.slice(1).split("").map(Qe=>Qe.repeat(2)).join(""));const Ke=f.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i);if(Ke)return[Math.round(parseInt(Ke[1],16)/255*ze),Math.round(parseInt(Ke[2],16)/255*ze),Math.round(parseInt(Ke[3],16)/255*ze),Ke[4]?Math.round(parseInt(Ke[4],16)/255*ze):ze]}}function Rt(qe){return!!Array.isArray(qe)&&qe.length===4&&qe.every(f=>typeof f=="number")}function Ct(qe){return Array.isArray(qe)&&qe.length===2&&typeof qe[0]=="number"&&typeof qe[1]=="number"}class fe{parse(f,ze=255){if(!/^\s*rgba?/.test(f))return;const Ke=f.replace(/\s/g,"").match(/(\d+(\.\d+)?%?)|(\.\d+%?)/g);if(!Ke||Ke.length<3)return;Ke.length===3&&Ke.push("1");const Qe=Ke.map((Pi,nn)=>{const ln=parseFloat(Pi);return nn===3?Math.round(ln*ze):Pi.indexOf("%")!==-1?Math.round(ln/100*ze):Math.round(ln/255*ze)}).filter(Pi=>!isNaN(Pi));return Rt(Qe)?Qe:void 0}}class me{parse(f){if(f==="transparent")return[0,0,0,0]}}class we{constructor(f,ze){this.asyncTimeout=f,this.abortSignal=ze}async process(f,ze){const Ke=this.createProcessScope(f,ze);return this.doProcess(Ke,this.asyncTimeout),await Ke.deferred.promise,f.commit(),f}createProcessScope(f,ze){const Ke=f.getViewport(),Qe=Math.floor(Ke.x1),Pi=Math.floor(Ke.x2),nn=Math.floor(Ke.y2),ln=Qe,cn=Math.floor(Ke.y1);return{deferred:Qt(),image:f,resampler:ze,startX:Qe,endX:Pi,endY:nn,currentX:ln,currentY:cn}}doProcess(f,ze){if(this.abortSignal&&this.abortSignal.aborted)return void f.deferred.reject(this.abortSignal.reason instanceof Error?this.abortSignal.reason:new $t(String(this.abortSignal.reason)));const Ke=Date.now(),{image:Qe,resampler:Pi,startX:nn,endX:ln,endY:cn}=f;let{currentX:hn,currentY:un}=f;for(;un<=cn;){for(;hn<=ln;)if(Qe.setPixelColor(hn,un,Pi.getResampledColor(hn,un)),hn++,Date.now()-Ke>=ze)return f.currentX=hn,f.currentY=un,void setTimeout(this.doProcess.bind(this,f,ze),0);un++,hn=nn}f.deferred.resolve()}}class xe{constructor(f,ze){this.processor=f,this.superSamplingFactor=ze}async process(f,ze){this.superSamplingFactor!==1&&ze.setScaling(1/this.superSamplingFactor);const Ke=await this.processor.process(f,ze);return this.superSamplingFactor!==1?Ke.scale(1/this.superSamplingFactor):Ke}}class ve{constructor(f,ze){this.width=f,this.height=ze,this.viewport=new y(0,0,this.width-1,this.height-1),this.backgroundColor=[0,0,0,0],this.quantumRange=255}getViewport(){return this.viewport}setViewport(f){return this.viewport=f,this}getBackgroundColor(){return this.backgroundColor}setBackgroundColor(f){return this.backgroundColor=f,this}getQuantumRange(){return this.quantumRange}getBlank(f){const ze=this.prepareBlank(f.getWidth(),f.getHeight());return ze.setViewport(f),this.duplicateProps(ze)}scale(f){const ze=this.viewport.clone();ze.scale(f);const Ke=this.resize(ze.getWidth(),ze.getHeight());return Ke.setViewport(ze),this.duplicateProps(Ke)}duplicateProps(f){return f.setBackgroundColor(this.backgroundColor),f}}class ye{constructor(f){this.factoriesPool=f}resolve(f){const ze=this.factoriesPool.items().find(Qe=>Qe.match(f));if(ze)return ze.create(f);const Ke=Object.prototype.toString.call(f).slice(8,-1);throw new TypeError(`No matching image adapter factory for resource of type ${Ke}`)}}function S(qe){const f=qe.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("Couldn't get canvas context");return f}class N extends ve{constructor(f){super(f.width,f.height),this.canvas=f,this.imageData=S(f).getImageData(0,0,f.width,f.height),this.data=this.imageData.data}static createFromImage(f){const ze=O(f.width,f.height);return S(ze).drawImage(f,0,0),new N(ze)}static async createFromUrl(f){const ze=await jt(f);return this.createFromImage(ze)}static async createFromBlob(f){const ze=await createImageBitmap(f);return this.createFromImage(ze)}getPixelColor(f,ze){const Ke=4*(ze*this.width+f);return[this.data[Ke],this.data[Ke+1],this.data[Ke+2],this.data[Ke+3]]}setPixelColor(f,ze,Ke){const Qe=4*(ze*this.width+f);this.data[Qe]=Ke[0],this.data[Qe+1]=Ke[1],this.data[Qe+2]=Ke[2],this.data[Qe+3]=Ke[3]}getAverageColor(){const f=S(O(1,1));return f.drawImage(this.canvas,0,0,this.width,this.height,0,0,1,1),Array.prototype.slice.call(f.getImageData(0,0,1,1).data)}resize(f,ze){const Ke=O(f,ze,!this.isOffscreen());return S(Ke).drawImage(this.canvas,0,0,this.width,this.height,0,0,f,ze),new N(Ke)}getResource(){return this.canvas}prepareBlank(f,ze){return new N(O(f,ze,!this.isOffscreen()))}commit(){S(this.canvas).putImageData(this.imageData,0,0)}isOffscreen(){return typeof OffscreenCanvas!==void 0&&this.canvas instanceof OffscreenCanvas}}class Re{match(f){return typeof HTMLCanvasElement<"u"&&f instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&f instanceof OffscreenCanvas}create(f){return new N(f)}}function Ce(qe){return qt(qe)&&Gt(qe)&&Wt(qe)&&typeof qe.setViewport=="function"&&typeof qe.setBackgroundColor=="function"&&typeof qe.getBlank=="function"&&typeof qe.scale=="function"&&typeof qe.getResource=="function"&&typeof qe.commit=="function"}class W{constructor(f){this.adapter=f,{x1:this.offsetX,y1:this.offsetY}=f.getViewport(),{width:this.width,height:this.height}=f}getAdapter(){return this.adapter}getPixelColor(f,ze){return this.adapter.getPixelColor(Math.floor(f-this.offsetX),Math.floor(ze-this.offsetY))}setPixelColor(f,ze,Ke){this.adapter.setPixelColor(Math.floor(f-this.offsetX),Math.floor(ze-this.offsetY),Ke)}getViewport(){return this.adapter.getViewport()}setViewport(f){this.adapter.setViewport(f),{x1:this.offsetX,y1:this.offsetY}=f}getBackgroundColor(){return this.adapter.getBackgroundColor()}setBackgroundColor(f){this.adapter.setBackgroundColor(f)}getAverageColor(){return this.adapter.getAverageColor()}getQuantumRange(){return this.adapter.getQuantumRange()}getBlank(f){const ze=this.adapter.getBlank(f);return new W(ze)}scale(f){const ze=this.adapter.scale(f);return new W(ze)}getResource(){return this.adapter.getResource()}commit(){return this.adapter.commit()}}class Pe{constructor(f,ze){this.processor=f,this.repage=ze}async process(f,ze){const Ke=await this.processor.process(f,ze);return Ke.getViewport().reset(),Ct(this.repage)?Ke.getViewport().offset(...this.repage):j(this.repage)&&Ke.setViewport(y.fromLiteral(this.repage)),Ke}}class Ae{create(f={}){const{asyncTimeout:ze=50,outputScaling:Ke=1,repage:Qe=!1,abortSignal:Pi}=f;let nn=new we(ze,Pi);return Ke!==1&&(nn=new xe(nn,Ke)),Qe&&(nn=new Pe(nn,Ct(Qe)||j(Qe)?Qe:void 0)),nn}}class Me{constructor(f,ze){this.outputViewportResolver=f,this.distortionProcessorFactory=ze}async distort(f,ze,Ke,Qe={}){const{viewport:Pi=!1,outputScaling:nn=1,repage:ln,asyncTimeout:cn=50,abortSignal:hn}=Qe,un=this.createTargetImage(f,ze,Pi,nn),zn=new W(un),Xn=this.distortionProcessorFactory.create({outputScaling:nn,repage:ln,asyncTimeout:cn,abortSignal:hn}),Un=await Xn.process(zn,Ke);return Un instanceof W?Un.getAdapter():Un}createTargetImage(f,ze,Ke,Qe){const Pi=this.outputViewportResolver.resolve(f,ze,Ke);return Qe!==1&&Pi.scale(Qe),f.getBlank(Pi)}}class Ee{constructor(f,ze,Ke,Qe,Pi,nn){this.reversePixelMapperResolver=f,this.colorResamplerResolver=ze,this.distortionController=Ke,this.imageAdapterResolver=Qe,this.colorStringParser=Pi,this.virtualPixelDecoratorApplicator=nn}async distort(f,ze,Ke,Qe){const[Pi,nn,ln]=this.clarifyArguments(f,ze,Ke,Qe);this.setImageAdapterOptions(Pi,ln);const cn=this.getColorResampler(Pi,nn,ln),hn=Date.now(),un=await this.distortionController.distort(Pi,nn,cn,ln),zn=Date.now();return{image:un,distortion:nn,startTimestamp:hn,endTimestamp:zn,duration:zn-hn,weightLookupTable:Ut(cn)?cn.getWeightLookupTable():void 0}}resolveImageAdapter(f){return Ce(f)?f:this.imageAdapterResolver.resolve(f)}clarifyArguments(f,ze,Ke,Qe){const Pi=this.resolveImageAdapter(f);let nn,ln;if(nt(ze)){if(Array.isArray(Ke))throw new TypeError("Argument 3 should be options object or undefined when passing ReversePixelMapper as second argument");nn=ze,ln=Ke}else{if(!Array.isArray(Ke))throw new TypeError("Missing distortion arguments");nn=this.reversePixelMapperResolver.resolve(ze,Ke,Pi.getViewport()),ln=Qe}return[Pi,nn,ln||{}]}getColorResampler(f,ze,Ke){const{matteColor:Qe,filter:Pi="RobidouxSharp",preferredResampler:nn,virtualPixelMethod:ln=p.TRANSPARENT,interpolationMethod:cn=w.AVERAGE}=Ke,hn=this.resolveColor(Qe,f.getQuantumRange()),un=this.virtualPixelDecoratorApplicator.decorate(f,ln);return this.colorResamplerResolver.resolve(un,ze,{preferredResampler:nn,matteColor:hn,filter:Pi,interpolationMethod:cn,virtualPixelMethod:ln})}setImageAdapterOptions(f,ze){const{imageBackgroundColor:Ke,imageViewportOffset:Qe}=ze;f.setBackgroundColor(this.resolveColor(Ke,f.getQuantumRange())),Qe&&f.getViewport().offset(...Qe)}resolveColor(f,ze,Ke=[0,0,0,0]){return f===void 0?Ke:Rt(f)?f:this.colorStringParser.parse(f,ze)||Ke}}class Fe{constructor(f){this.outputViewportStrategiesPool=f}resolve(f,ze,Ke){const Qe=this.outputViewportStrategiesPool.items();Qe.sort((nn,ln)=>nn.priority-ln.priority);const Pi=Qe.find(nn=>nn.match(ze,Ke));if(!Pi)throw new Error("Couldn't find matching output viewport resolution strategy");return Pi.getOutputViewport(f,ze,Ke)}}class Ve{constructor(){this.priority=2}match(f,ze){return mt(f)&&(f.forceBestFit||ze==="bestFit"||ze===!0)}getOutputViewport(f,ze){if(mt(ze))return ze.getBestFitViewport(f.getViewport());throw new TypeError("Given ReversePixelMapper don't support best-fit output viewport")}}class Ie{constructor(){this.priority=3}getOutputViewport(f){return f.getViewport().clone()}match(){return!0}}class Te{constructor(){this.priority=1}match(f,ze){return j(ze)}getOutputViewport(f,ze,Ke){if(j(Ke))return y.fromLiteral(Ke);throw new TypeError("'viewport argument should be ViewportLiteral")}}class M{constructor(){this.storage=new Map}has(f){return this.storage.has(f)}get(f){const ze=this.storage.get(f);if(ze===void 0)throw new RangeError(`Item with key "${f}" was not found in pool.`);return ze}add(f,ze,Ke=!1){if(this.storage.has(f)&&!Ke)throw new TypeError(`Item with key "${f}" already exists in pool`);this.storage.set(f,ze)}remove(f){this.storage.delete(f)}keys(){return Array.from(this.storage.keys())}items(){return Array.from(this.storage.values())}}class be{constructor(f,ze,Ke,Qe,Pi=1,nn){this.filterFunction=f,this.windowingFunction=ze,this.support=Ke,this.scale=Qe,this.blur=Pi,this.windowSupport=nn!==void 0?nn:this.support}getWorkingSupport(){return this.support*this.blur}getWeight(f){const ze=f/this.blur;return(ze<F?1:this.window(this.scale*ze))*this.filter(ze)}filter(f){return this.filterFunction(f,this.support,this.windowSupport)}window(f){return this.windowingFunction(f,this.support,this.windowSupport)}}class Be{constructor(f){this.weightingFunctionFactoriesPool=f}create(f,ze,Ke,Qe,Pi,nn,ln=1,cn){const hn=this.weightingFunctionFactoriesPool.get(f).create(...ze),un=this.weightingFunctionFactoriesPool.get(Ke).create(...Qe);return new be(hn,un,Pi,nn,ln,cn)}}function Le(qe){return typeof qe=="object"&&qe!==null&&typeof qe.getWorkingSupport=="function"&&typeof qe.getWeight=="function"}function Se(qe){return typeof qe=="object"&&qe!==null&&typeof qe.filterFunctionFactory=="string"&&Array.isArray(qe.filterFunctionFactoryArgs)&&typeof qe.windowFunctionFactory=="string"&&Array.isArray(qe.windowFunctionFactoryArgs)&&typeof qe.support=="number"&&typeof qe.scale=="number"}class Oe{constructor(f,ze){this.filterPresetsPool=f,this.filterFactory=ze}resolve(f,ze={}){if(Le(f))return f;let Ke;Ke=Se(f)?f:this.filterPresetsPool.get(f);const{blur:Qe=1,windowSupport:Pi}=Ke,{filterBlur:nn=Qe,filterWindowSupport:ln=Pi}=ze;return this.filterFactory.create(Ke.filterFunctionFactory,Ke.filterFunctionFactoryArgs,Ke.windowFunctionFactory,Ke.windowFunctionFactoryArgs,Ke.support,Ke.scale,nn,ln)}}var De=(qe=>(qe.ROBIDOUX="Robidoux",qe.ROBIDOUX_SHARP="RobidouxSharp",qe.BOX="Box",qe))(De||{});class ht{constructor(){this.parent=null,this.services=new Map,this.backups=[]}register(f,ze){this.services.set(f,ze)}unregister(f){this.services.delete(f)}resolve(f){const ze=this.services.get(f);if(ze===void 0){if(this.parent)return this.parent.resolve(f);throw new RangeError(`Service "${f}" was not found in container.`)}return typeof ze=="function"?ze(this):ze}backup(){const f=new Map(this.services);this.backups.push(f)}restore(){const f=this.backups.pop();f&&(this.services.clear(),this.services=f)}createChild(){const f=new ht;return f.parent=this,f}}class ke{create(){return function(){return 1}}}class Ne{create(f,ze){const Ke=(6-2*f)/6,Qe=(12*f-18+6*ze)/6,Pi=(12-9*f-6*ze)/6,nn=(8*f+24*ze)/6,ln=(-12*f-48*ze)/6,cn=(6*f+30*ze)/6,hn=(-1*f-6*ze)/6;return function(un){if(typeof un=="number"){if(un<1)return Ke+un*(un*(Qe+un*Pi));if(un<2)return nn+un*(ln+un*(cn+un*hn))}return 0}}}var it=(qe=>(qe.BOX="Box",qe.CUBIC_BC="CubicBC",qe))(it||{});const Pt=function(qe=[]){const f=new ht;return qe.forEach(ze=>ze.register(f)),f}([{register(qe){let f=!1;qe.register("ColorResamplerResolver",ze=>{if(!f){const Ke=ze.resolve("ColorInterpolatorFactory"),Qe=new M;Qe.add("ewa",new ce(Ke)),Qe.add("point",new ge(Ke)),ze.register("ColorResamplerFactoriesPool",Qe),f=!0}return new Ft(ze.resolve("ColorResamplerFactoriesPool"),ze.resolve("ResampleFilterResolver"))})}},{register(qe){const f=new M;f.add("transparent",new me),f.add("hex",new de),f.add("rgba",new fe),qe.register("ColorStringParsersPool",f),qe.register("ColorStringParser",ze=>new pe(ze.resolve("ColorStringParsersPool")))}},{register(qe){qe.register("DistortionProcessorFactory",()=>new Ae),qe.register("DistortionController",f=>new Me(f.resolve("OutputViewportResolver"),f.resolve("DistortionProcessorFactory"))),qe.register("DistortionService",f=>new Ee(f.resolve("ReversePixelMapperResolver"),f.resolve("ColorResamplerResolver"),f.resolve("DistortionController"),f.resolve("ImageAdapterResolver"),f.resolve("ColorStringParser"),f.resolve("VirtualPixelDecoratorApplicator")))}},{register(qe){const f=new M;f.add("BrowserCanvas",new Re),qe.register("ImageAdapterFactoriesPool",f),qe.register("ImageAdapterResolver",ze=>new ye(ze.resolve("ImageAdapterFactoriesPool")))}},{register(qe){const f=new M;f.add("user-provided",new Te),f.add("best-fit",new Ve),f.add("source-image",new Ie),qe.register("OutputViewportStrategiesPool",f),qe.register("OutputViewportResolver",ze=>new Fe(ze.resolve("OutputViewportStrategiesPool")))}},{register(qe){const f=new M;f.add(E.ARC,new te),f.add(E.AFFINE,new Zt),f.add(E.AFFINE_PROJECTION,new zt),f.add(E.PERSPECTIVE,new re),f.add(E.PERSPECTIVE_PROJECTION,new ie),f.add(E.POLYNOMIAL,new oe),qe.register("ReversePixelMapperFactoriesPool",f),qe.register("ReversePixelMapperResolver",ze=>new ne(ze.resolve("ReversePixelMapperFactoriesPool")))}},{register(qe){const f=new M;f.add("Robidoux",{filterFunctionFactory:"CubicBC",filterFunctionFactoryArgs:[.3782157550939987,.3108921224530007],windowFunctionFactory:"Box",windowFunctionFactoryArgs:[],support:2,scale:1.1685777620836932}),f.add("RobidouxSharp",{filterFunctionFactory:"CubicBC",filterFunctionFactoryArgs:[.2620145123990142,.3689927438004929],windowFunctionFactory:"Box",windowFunctionFactoryArgs:[],support:2,scale:1.105822933719019}),f.add("Box",{filterFunctionFactory:"Box",filterFunctionFactoryArgs:[],windowFunctionFactory:"Box",windowFunctionFactoryArgs:[],support:.5,scale:.5}),qe.register("ResampleFilterPresetsPool",f),qe.register("ResampleFilterFactory",ze=>new Be(ze.resolve("WeightingFunctionFactoriesPool"))),qe.register("ResampleFilterResolver",ze=>new Oe(ze.resolve("ResampleFilterPresetsPool"),ze.resolve("ResampleFilterFactory")))}},{register(qe){const f=new M;f.add(it.BOX,new ke),f.add(it.CUBIC_BC,new Ne),qe.register("WeightingFunctionFactoriesPool",f)}},{register(qe){qe.register("ColorInterpolatorFactory",new Et)}},{register(qe){qe.register("VirtualPixelDecoratorApplicator",new Nt)}}]);function He(qe,f,ze,Ke){return Pt.resolve("DistortionService").distort(qe,f,ze,Ke)}var downscale$2={exports:{}},downscale$1=downscale$2.exports,hasRequiredDownscale;function requireDownscale(){return hasRequiredDownscale||(hasRequiredDownscale=1,function(qe){(function(f,ze){qe.exports?qe.exports=ze():f.downscale=ze()})(downscale$1,function(){function f(la,ea,na,ta,ra,oa,fa,ca){var la=document.createElement("canvas");la.width=na,la.height=ta;var ua=la.getContext("2d");return ua.mozImageSmoothingEnabled=!0,ua.imageSmoothingQuality="high",ua.webkitImageSmoothingEnabled=!0,ua.msImageSmoothingEnabled=!0,ua.imageSmoothingEnabled=!0,ua.drawImage(ea,ra,oa,fa,ca,0,0,na,ta),la}function ze(vs){return vs+.49<<0}function Ke(vs,ea,na,ta,ra,oa,fa){for(var ca=new ImageData(ea,na),la=new Int32Array(vs.data.buffer),ua=vs.width,ga=new Int32Array(ca.data.buffer),da=ca.width,qa=ea/oa,tl=na/fa,ol=ze(1/qa),hl=ze(1/tl),wl=ol*hl,_l=0;_l<ca.height;_l++)for(var gl=0;gl<da;gl++){for(var dl=ta+ze(gl/qa)+(ra+ze(_l/tl))*ua,sl=0,kl=0,pl=0,Al=0,xl=0;xl<hl;xl++)for(var al=0;al<ol;al++){var Fl=la[dl+al+xl*ua];sl+=Fl<<24>>>24,kl+=Fl<<16>>>24,pl+=Fl<<8>>>24,Al+=Fl>>>24}sl=ze(sl/wl),kl=ze(kl/wl),pl=ze(pl/wl),Al=ze(Al/wl),ga[gl+_l*da]=Al<<24|pl<<16|kl<<8|sl}return ca}function Qe(vs,ea,na,ta){var ra=new Date,oa={},fa=ra,ca="01";return{mark:vs?function(la){la=ca+". "+(la||"..."),oa[la]={"time (ms)":new Date-fa},fa=new Date,ca=("0"+((ca>>0)+1)).substr(-2)}:new Function,finish:vs?function(){oa[ca+" TOTAL"]={"time (ms)":new Date-ra},console.log("IMAGE SOURCE:",ea),console.log("DOWNSCALE TO:",na+"x"+ta),console.table(oa)}:new Function}}function Pi(){var vs=[],ea=[],na=[],ta=new Object;return{createSetter:function(ra){if(!this.get(ra)){var oa=vs.push(ra)-1;return ea.push(ta),na.push([]),function(fa){ea[oa]=fa,na[oa]=na[oa].reduce(function(ca,la){la(fa)},[])}}},get:function(ra,oa){var fa=vs.indexOf(ra);if(~fa){if(ea[fa]===ta){na[fa].push(oa);return}oa(ea[fa])}},has:function(ra){return!!~vs.indexOf(ra)}}}function nn(vs,ea,na,ta){vs.width=na,vs.height=ta;var ra=vs.getContext("2d");return ra.drawImage(ea,0,0),ra.getImageData(0,0,na,ta)}function ln(vs,ea){vs.width=ea.width,vs.height=ea.height;var na=vs.getContext("2d");return na.putImageData(ea,0,0),vs}function cn(vs,ea,ga,da,ra,oa){var fa=ra,ca=oa,la=ra/oa;vs===0&&(vs=ea*la>>0),ea===0&&(ea=vs/la>>0);var ua=vs/ea;ua>la?oa=ra/ua>>0:ra=oa*ua>>0;var ga=ga||(fa-ra)/2>>0,da=da||(ca-oa)/2>>0;return{destWidth:vs,destHeight:ea,sourceX:ga,sourceY:da,sourceWidth:ra,sourceHeight:oa}}function hn(vs,ea,na){if(ea.returnCanvas){na(vs);return}if(ea.returnBlob){vs.toBlob(na,"image/"+(ea.imageType||"jpeg"),ea.quality||.85);return}var ta=vs.toDataURL("image/"+(ea.imageType||"jpeg"),ea.quality||.85);na(ta)}function un(vs,ea){var na=new XMLHttpRequest;na.open("GET",vs),na.responseType="arraybuffer",na.addEventListener("load",function(){ea(this.response)}),na.send()}function zn(vs,ea){vs.complete?ea():vs.addEventListener("load",ea)}function Xn(vs,ea){vs.readyState>1?ea():vs.addEventListener("loadeddata",ea)}function Un(vs){if(vs instanceof File)return"File";if(vs instanceof HTMLImageElement)return"HTMLImageElement";if(vs instanceof HTMLVideoElement)return"HTMLVideoElement";if(typeof vs=="string")return"URL"}function qn(vs){if(vs.length<3)return new TypeError("3 arguments required, but only "+vs.length+" present.");if(!Un(vs[0]))return new TypeError("First argument should be HTMLImageElement, HTMLVideoElement, File of String");if(typeof vs[1]!="number")return new TypeError("Second argument should be a number");if(typeof vs[2]!="number")return new TypeError("Third argument should be a number")}function ys(vs,ea,na,ta){var ra=Qe(ta&&ta.debug||!1,vs,ea,na),oa=qn(arguments);if(oa instanceof TypeError)return Promise.reject(oa);ta=ta||{};var fa,ca=new Promise(function(tl,ol){fa=tl});ys.canvas=ys.canvas||document.createElement("canvas"),ys.cache=ys.cache||Pi();var la=ys.canvas,ua=ys.cache;if(ua.has(vs))return ra.mark(),ua.get(vs,function(tl){ra.mark("PENDING CACHE");var ol=tl[0],hl=tl[1],wl=cn(ea,na,ta.sourceX,ta.sourceY,hl.width,hl.height);if(wl.sourceWidth/wl.destWidth>=2&&wl.sourceHeight/wl.destHeight>=2){ra.mark();var _l=Ke(hl,wl.destWidth,wl.destHeight,wl.sourceX,wl.sourceY,wl.sourceWidth,wl.sourceHeight);ra.mark("DOWNSCALE"),la=ln(la,_l)}else la=f(la,ol,wl.destWidth,wl.destHeight,wl.sourceX,wl.sourceY,wl.sourceWidth,wl.sourceHeight),ra.mark("RESIZE WITH CANVAS");hn(la,ta,function(gl){ra.mark("PRODUCE RESULT"),fa(gl),ra.finish()})}),ca;var ga=function(tl,ol,hl){var wl=cn(ea,na,ta.sourceX,ta.sourceY,ol,hl);if(wl.sourceWidth/wl.destWidth>=2&&wl.sourceHeight/wl.destHeight>=2){ra.mark();var _l=nn(la,tl,ol,hl);ra.mark("GET IMAGE DATA");var gl=Ke(_l,wl.destWidth,wl.destHeight,wl.sourceX,wl.sourceY,wl.sourceWidth,wl.sourceHeight);ra.mark("DOWNSCALE"),la=ln(la,gl),Un(tl)!=="HTMLVideoElement"&&ua.createSetter(tl)([tl,_l])}else la=f(la,tl,wl.destWidth,wl.destHeight,wl.sourceX,wl.sourceY,wl.sourceWidth,wl.sourceHeight),ra.mark("RESIZE WITH CANVAS");hn(la,ta,function(dl){ra.mark("PRODUCE RESULT"),fa(dl),ra.finish()})},da=window.URL||window.webkitURL;switch(Un(vs)){case"File":var qa=document.createElement("img");ra.mark(),qa.src=da.createObjectURL(vs),ra.mark("READ FILE"),zn(qa,function(){ra.mark("LOAD IMAGE"),ga(qa,qa.naturalWidth,qa.naturalHeight)});break;case"HTMLImageElement":ra.mark(),zn(vs,function(){ra.mark("LOAD IMAGE"),ga(vs,vs.naturalWidth,vs.naturalHeight)});break;case"HTMLVideoElement":Xn(vs,function(){ga(vs,vs.videoWidth,vs.videoHeight)});break;case"URL":ra.mark(),setTimeout(function(){un(vs,function(tl){ra.mark("LOAD ARRAY BUFFER");var ol=new Uint8Array(tl),hl=new Blob([ol],{type:"image/jpeg"}),wl=document.createElement("img");wl.src=da.createObjectURL(hl),ra.mark(),zn(wl,function(){ra.mark("LOAD IMAGE"),ga(wl,wl.naturalWidth,wl.naturalHeight)})})});break}return ca}return ys})}(downscale$2)),downscale$2.exports}var downscaleExports=requireDownscale();const downscale=getDefaultExportFromCjs(downscaleExports);var shortUniqueId={exports:{}},hasRequiredShortUniqueId;function requireShortUniqueId(){return hasRequiredShortUniqueId||(hasRequiredShortUniqueId=1,function(qe){var f=(()=>{var ze=Object.defineProperty,Ke=Object.getOwnPropertyDescriptor,Qe=Object.getOwnPropertyNames,Pi=Object.getOwnPropertySymbols,nn=Object.prototype.hasOwnProperty,ln=Object.prototype.propertyIsEnumerable,cn=(ra,oa,fa)=>oa in ra?ze(ra,oa,{enumerable:!0,configurable:!0,writable:!0,value:fa}):ra[oa]=fa,hn=(ra,oa)=>{for(var fa in oa||(oa={}))nn.call(oa,fa)&&cn(ra,fa,oa[fa]);if(Pi)for(var fa of Pi(oa))ln.call(oa,fa)&&cn(ra,fa,oa[fa]);return ra},un=(ra,oa)=>{for(var fa in oa)ze(ra,fa,{get:oa[fa],enumerable:!0})},zn=(ra,oa,fa,ca)=>{if(oa&&typeof oa=="object"||typeof oa=="function")for(let la of Qe(oa))!nn.call(ra,la)&&la!==fa&&ze(ra,la,{get:()=>oa[la],enumerable:!(ca=Ke(oa,la))||ca.enumerable});return ra},Xn=ra=>zn(ze({},"__esModule",{value:!0}),ra),Un=(ra,oa,fa)=>cn(ra,typeof oa!="symbol"?oa+"":oa,fa),qn={};un(qn,{DEFAULT_OPTIONS:()=>ea,DEFAULT_UUID_LENGTH:()=>vs,default:()=>ta});var ys="5.3.2",vs=6,ea={dictionary:"alphanum",shuffle:!0,debug:!1,length:vs,counter:0},na=class{constructor(oa={}){Un(this,"counter"),Un(this,"debug"),Un(this,"dict"),Un(this,"version"),Un(this,"dictIndex",0),Un(this,"dictRange",[]),Un(this,"lowerBound",0),Un(this,"upperBound",0),Un(this,"dictLength",0),Un(this,"uuidLength"),Un(this,"_digit_first_ascii",48),Un(this,"_digit_last_ascii",58),Un(this,"_alpha_lower_first_ascii",97),Un(this,"_alpha_lower_last_ascii",123),Un(this,"_hex_last_ascii",103),Un(this,"_alpha_upper_first_ascii",65),Un(this,"_alpha_upper_last_ascii",91),Un(this,"_number_dict_ranges",{digits:[this._digit_first_ascii,this._digit_last_ascii]}),Un(this,"_alpha_dict_ranges",{lowerCase:[this._alpha_lower_first_ascii,this._alpha_lower_last_ascii],upperCase:[this._alpha_upper_first_ascii,this._alpha_upper_last_ascii]}),Un(this,"_alpha_lower_dict_ranges",{lowerCase:[this._alpha_lower_first_ascii,this._alpha_lower_last_ascii]}),Un(this,"_alpha_upper_dict_ranges",{upperCase:[this._alpha_upper_first_ascii,this._alpha_upper_last_ascii]}),Un(this,"_alphanum_dict_ranges",{digits:[this._digit_first_ascii,this._digit_last_ascii],lowerCase:[this._alpha_lower_first_ascii,this._alpha_lower_last_ascii],upperCase:[this._alpha_upper_first_ascii,this._alpha_upper_last_ascii]}),Un(this,"_alphanum_lower_dict_ranges",{digits:[this._digit_first_ascii,this._digit_last_ascii],lowerCase:[this._alpha_lower_first_ascii,this._alpha_lower_last_ascii]}),Un(this,"_alphanum_upper_dict_ranges",{digits:[this._digit_first_ascii,this._digit_last_ascii],upperCase:[this._alpha_upper_first_ascii,this._alpha_upper_last_ascii]}),Un(this,"_hex_dict_ranges",{decDigits:[this._digit_first_ascii,this._digit_last_ascii],alphaDigits:[this._alpha_lower_first_ascii,this._hex_last_ascii]}),Un(this,"_dict_ranges",{_number_dict_ranges:this._number_dict_ranges,_alpha_dict_ranges:this._alpha_dict_ranges,_alpha_lower_dict_ranges:this._alpha_lower_dict_ranges,_alpha_upper_dict_ranges:this._alpha_upper_dict_ranges,_alphanum_dict_ranges:this._alphanum_dict_ranges,_alphanum_lower_dict_ranges:this._alphanum_lower_dict_ranges,_alphanum_upper_dict_ranges:this._alphanum_upper_dict_ranges,_hex_dict_ranges:this._hex_dict_ranges}),Un(this,"log",(...da)=>{const qa=[...da];if(qa[0]="[short-unique-id] ".concat(da[0]),this.debug===!0&&typeof console<"u"&&console!==null){console.log(...qa);return}}),Un(this,"_normalizeDictionary",(da,qa)=>{let tl;if(da&&Array.isArray(da)&&da.length>1)tl=da;else{tl=[],this.dictIndex=0;const ol="_".concat(da,"_dict_ranges"),hl=this._dict_ranges[ol];let wl=0;for(const[,gl]of Object.entries(hl)){const[dl,sl]=gl;wl+=Math.abs(sl-dl)}tl=new Array(wl);let _l=0;for(const[,gl]of Object.entries(hl)){this.dictRange=gl,this.lowerBound=this.dictRange[0],this.upperBound=this.dictRange[1];const dl=this.lowerBound<=this.upperBound,sl=this.lowerBound,kl=this.upperBound;if(dl)for(let pl=sl;pl<kl;pl++)tl[_l++]=String.fromCharCode(pl),this.dictIndex=pl;else for(let pl=sl;pl>kl;pl--)tl[_l++]=String.fromCharCode(pl),this.dictIndex=pl}tl.length=_l}if(qa){const ol=tl.length;for(let hl=ol-1;hl>0;hl--){const wl=Math.floor(Math.random()*(hl+1));[tl[hl],tl[wl]]=[tl[wl],tl[hl]]}}return tl}),Un(this,"setDictionary",(da,qa)=>{this.dict=this._normalizeDictionary(da,qa),this.dictLength=this.dict.length,this.setCounter(0)}),Un(this,"seq",()=>this.sequentialUUID()),Un(this,"sequentialUUID",()=>{const da=this.dictLength,qa=this.dict;let tl=this.counter;const ol=[];do{const wl=tl%da;tl=Math.trunc(tl/da),ol.push(qa[wl])}while(tl!==0);const hl=ol.join("");return this.counter+=1,hl}),Un(this,"rnd",(da=this.uuidLength||vs)=>this.randomUUID(da)),Un(this,"randomUUID",(da=this.uuidLength||vs)=>{if(da===null||typeof da>"u"||da<1)throw new Error("Invalid UUID Length Provided");const qa=new Array(da),tl=this.dictLength,ol=this.dict;for(let hl=0;hl<da;hl++){const wl=Math.floor(Math.random()*tl);qa[hl]=ol[wl]}return qa.join("")}),Un(this,"fmt",(da,qa)=>this.formattedUUID(da,qa)),Un(this,"formattedUUID",(da,qa)=>{const tl={$r:this.randomUUID,$s:this.sequentialUUID,$t:this.stamp};return da.replace(/\$[rs]\d{0,}|\$t0|\$t[1-9]\d{1,}/g,hl=>{const wl=hl.slice(0,2),_l=Number.parseInt(hl.slice(2),10);return wl==="$s"?tl[wl]().padStart(_l,"0"):wl==="$t"&&qa?tl[wl](_l,qa):tl[wl](_l)})}),Un(this,"availableUUIDs",(da=this.uuidLength)=>Number.parseFloat(([...new Set(this.dict)].length**da).toFixed(0))),Un(this,"_collisionCache",new Map),Un(this,"approxMaxBeforeCollision",(da=this.availableUUIDs(this.uuidLength))=>{const qa=da,tl=this._collisionCache.get(qa);if(tl!==void 0)return tl;const ol=Number.parseFloat(Math.sqrt(Math.PI/2*da).toFixed(20));return this._collisionCache.set(qa,ol),ol}),Un(this,"collisionProbability",(da=this.availableUUIDs(this.uuidLength),qa=this.uuidLength)=>Number.parseFloat((this.approxMaxBeforeCollision(da)/this.availableUUIDs(qa)).toFixed(20))),Un(this,"uniqueness",(da=this.availableUUIDs(this.uuidLength))=>{const qa=Number.parseFloat((1-this.approxMaxBeforeCollision(da)/da).toFixed(20));return qa>1?1:qa<0?0:qa}),Un(this,"getVersion",()=>this.version),Un(this,"stamp",(da,qa)=>{const tl=Math.floor(+(qa||new Date)/1e3).toString(16);if(typeof da=="number"&&da===0)return tl;if(typeof da!="number"||da<10)throw new Error(["Param finalLength must be a number greater than or equal to 10,","or 0 if you want the raw hexadecimal timestamp"].join(`
`));const ol=da-9,hl=Math.round(Math.random()*(ol>15?15:ol)),wl=this.randomUUID(ol);return"".concat(wl.substring(0,hl)).concat(tl).concat(wl.substring(hl)).concat(hl.toString(16))}),Un(this,"parseStamp",(da,qa)=>{if(qa&&!/t0|t[1-9]\d{1,}/.test(qa))throw new Error("Cannot extract date from a formated UUID with no timestamp in the format");const tl=qa?qa.replace(/\$[rs]\d{0,}|\$t0|\$t[1-9]\d{1,}/g,hl=>{const wl={$r:dl=>[...Array(dl)].map(()=>"r").join(""),$s:dl=>[...Array(dl)].map(()=>"s").join(""),$t:dl=>[...Array(dl)].map(()=>"t").join("")},_l=hl.slice(0,2),gl=Number.parseInt(hl.slice(2),10);return wl[_l](gl)}).replace(/^(.*?)(t{8,})(.*)$/g,(hl,wl,_l)=>da.substring(wl.length,wl.length+_l.length)):da;if(tl.length===8)return new Date(Number.parseInt(tl,16)*1e3);if(tl.length<10)throw new Error("Stamp length invalid");const ol=Number.parseInt(tl.substring(tl.length-1),16);return new Date(Number.parseInt(tl.substring(ol,ol+8),16)*1e3)}),Un(this,"setCounter",da=>{this.counter=da}),Un(this,"validate",(da,qa)=>{const tl=qa?this._normalizeDictionary(qa):this.dict;return da.split("").every(ol=>tl.includes(ol))});const fa=hn(hn({},ea),oa);this.counter=0,this.debug=!1,this.dict=[],this.version=ys;const{dictionary:ca,shuffle:la,length:ua,counter:ga}=fa;this.uuidLength=ua,this.setDictionary(ca,la),this.setCounter(ga),this.debug=fa.debug,this.log(this.dict),this.log("Generator instantiated with Dictionary Size ".concat(this.dictLength," and counter set to ").concat(this.counter)),this.log=this.log.bind(this),this.setDictionary=this.setDictionary.bind(this),this.setCounter=this.setCounter.bind(this),this.seq=this.seq.bind(this),this.sequentialUUID=this.sequentialUUID.bind(this),this.rnd=this.rnd.bind(this),this.randomUUID=this.randomUUID.bind(this),this.fmt=this.fmt.bind(this),this.formattedUUID=this.formattedUUID.bind(this),this.availableUUIDs=this.availableUUIDs.bind(this),this.approxMaxBeforeCollision=this.approxMaxBeforeCollision.bind(this),this.collisionProbability=this.collisionProbability.bind(this),this.uniqueness=this.uniqueness.bind(this),this.getVersion=this.getVersion.bind(this),this.stamp=this.stamp.bind(this),this.parseStamp=this.parseStamp.bind(this)}};Un(na,"default",na);var ta=na;return Xn(qn)})();qe.exports=f.default,typeof window<"u"&&(f=f.default)}(shortUniqueId)),shortUniqueId.exports}var shortUniqueIdExports=requireShortUniqueId();const ShortUniqueId=getDefaultExportFromCjs(shortUniqueIdExports);var TruncationPosition=(qe=>(qe[qe.START=0]="START",qe[qe.MIDDLE=1]="MIDDLE",qe[qe.END=2]="END",qe))(TruncationPosition||{});const uid=new ShortUniqueId({dictionary:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","-","_"],length:16}),getId=()=>uid.randomUUID(),DIVISIONS=[{amount:60,name:"seconds"},{amount:60,name:"minutes"},{amount:24,name:"hours"},{amount:7,name:"days"},{amount:4.34524,name:"weeks"},{amount:12,name:"months"},{amount:Number.POSITIVE_INFINITY,name:"years"}],minkowskiDistance=(qe,f,ze=2)=>{const Ke=Math.min(qe.length,f.length);let Qe=0;for(let Pi=0;Pi<Ke;Pi++)Qe+=Math.pow(Math.abs(qe[Pi]-f[Pi]),ze);return Math.pow(Qe,1/ze)},limitDimensions=(qe,f,ze)=>{if(qe>ze||f>ze){const Ke=ze/f,Qe=ze/qe;let Pi,nn;return Ke>Qe?(Pi=ze,nn=f*Qe):(Pi=qe*Ke,nn=ze),{x:Pi,y:nn}}return{x:qe,y:f}},truncate=(qe,f,ze=0)=>{const Ke=qe.split("");if(Ke.length>f){const Qe=f-3;switch(ze){case 0:return`...${Ke.slice(Ke.length-Qe,Ke.length).join("")}`;case 1:const Pi=Math.floor(Qe/2);return`${Ke.slice(0,Pi).join("")}...${Ke.slice(Ke.length-Pi,Ke.length).join("")}`;case 2:return`${Ke.slice(0,Qe).join("")}...`}}else return qe},toLocalDateString=(qe=void 0)=>{const f=qe===void 0?new Date:new Date(qe),ze=padZerosTo(""+(f.getMonth()+1),2),Ke=padZerosTo(""+f.getDate(),2);return[f.getFullYear(),ze,Ke].join("-")},padZerosTo=(qe,f)=>{for(;qe.length<f;)qe="0"+qe;return qe},formatTimeAgo=qe=>{const f=new Intl.RelativeTimeFormat("en",{numeric:"always"});let ze=(new Date(qe).getTime()-new Date().getTime())/1e3;for(let Ke=0;Ke<=DIVISIONS.length;Ke++){const Qe=DIVISIONS[Ke];if(Math.abs(ze)<Qe.amount)return f.format(Math.round(ze),Qe.name);ze/=Qe.amount}},getGridScoreRowIndex=(qe,f)=>{if(!qe)return-1;let ze=-1;return qe.rowLabels&&qe.rowLabels.length===qe.rows&&(ze=qe.rowLabels.indexOf(f)),ze===-1&&(ze=qe.rowOrder==="TOP_TO_BOTTOM"?f-1:qe.rows-f),ze},getGridScoreColumnIndex=(qe,f)=>{if(!qe)return-1;let ze=-1;return qe.columnLabels&&qe.columnLabels.length===qe.columns&&(ze=qe.columnLabels.indexOf(f)),ze===-1&&(ze=qe.columnOrder==="LEFT_TO_RIGHT"?f-1:qe.columns-f),ze},_hoisted_1$2={key:0},_hoisted_2$1={class:"outer-canvas-container justify-center"},_hoisted_3$1=["src"],_hoisted_4$1={key:2},_hoisted_5$1={class:"d-flex justify-center"},_hoisted_6$1={slot:"first",class:"before"},_hoisted_7$1=["src"],_hoisted_8$1={slot:"second",class:"after"},_hoisted_9=["src"],_hoisted_10={key:3,class:"mt-3 d-flex justify-space-between"},p1=.95,p2=.95,p3=20,_sfc_main$3=defineComponent({__name:"ImageProcessor",props:{fileToLoad:{default:void 0},imageId:{default:""},neighborIds:{default:()=>[void 0,void 0]}},emits:["file-loaded","ratio-changed","title-changed"],setup(qe,{emit:f}){const ze=f,Ke=qe,Qe=coreStore(),Pi=useTemplateRef("wrapper"),nn=useTemplateRef("polygonCanvas"),ln=useTemplateRef("scaledImage"),cn=ref(),hn=ref(),un=ref(),zn=ref(),Xn=ref(),Un=ref(50),qn=ref();let ys=1440,vs=1440,ea;const na={x:0,y:0};let ta={x:0,y:0},ra={x:0,y:0};const oa=new ResizeObserver(ua);let fa=0,ca;function la(_l,gl){var dl;if(_l){const sl=document.createElement("a");sl.href=_l,sl.download=`${gl}-${(dl=cn.value)==null?void 0:dl.name}`,sl.click()}}function ua(){var _l,gl,dl,sl;cn.value&&((_l=Pi.value)!=null&&_l.clientWidth)&&fa!==((gl=Pi.value)==null?void 0:gl.clientWidth)&&(fa=(dl=Pi.value)==null?void 0:dl.clientWidth,ea==null||ea.dispose(),ea=void 0,qn.value=void 0,vs=((sl=Pi.value)==null?void 0:sl.clientWidth)||1440,nn.value&&(nn.value.width=0,nn.value.height=0),clearTimeout(ca),ca=setTimeout(()=>da(),100))}watch(()=>{var _l;return(_l=qn.value)==null?void 0:_l.points},_l=>{Qe.setLatestImagePoints(_l)},{deep:!0}),watch(cn,async _l=>{if(_l){emitter.emit("set-loading",!0,"Loading image file"),fa=0,ea==null||ea.dispose(),ea=void 0,qn.value=void 0,Xn.value=void 0,Un.value=50,un.value=void 0,zn.value=void 0,ze("title-changed",_l.name);const gl=new FileReader;gl.onload=dl=>{hn.value=dl.target.result,emitter.emit("set-loading",!1),nextTick(()=>tl())},gl.readAsDataURL(_l)}else hn.value=void 0});function ga(){var _l;qn.value&&(qn.value.points=[{x:0,y:0},{x:ra.x,y:0},{x:ra.x,y:ra.y},{x:0,y:ra.y}],qn.value.setCoords(),(_l=qn.value.canvas)==null||_l.renderAll())}function da(){if(nn.value&&ln.value){if(!ea){ra=limitDimensions(ln.value.clientWidth,ln.value.clientHeight,ys),ea=new Cn(nn.value);const _l=Math.min(vs,ra.x),gl=_l*(ra.y/ra.x);ra={x:_l,y:gl},ea.setDimensions({width:_l,height:gl}),ea.on("mouse:down",dl=>{na.x=dl.absolutePointer.x,na.y=dl.absolutePointer.y}),ea.on("mouse:up",dl=>{var sl;if(!(minkowskiDistance([na.x,na.y],[dl.absolutePointer.x,dl.absolutePointer.y])>1)&&qn.value&&qn.value.points){let kl=-1,pl=Number.MAX_VALUE;qn.value.points.forEach((Al,xl)=>{const al=minkowskiDistance([Al.x,Al.y],[dl.absolutePointer.x,dl.absolutePointer.y]);al<pl&&(pl=al,kl=xl)}),kl!==-1&&(qn.value.points[kl].x=dl.absolutePointer.x,qn.value.points[kl].y=dl.absolutePointer.y,qn.value.setCoords(),(sl=qn.value.canvas)==null||sl.renderAll())}}),ea.on("object:moving",dl=>{const sl=dl.target;sl.currentHeight>sl.canvas.height||sl.currentWidth>sl.canvas.width||(sl.setCoords(),(sl.getBoundingRect().top<0||sl.getBoundingRect().left<0)&&(sl.top=Math.max(sl.top,sl.top-sl.getBoundingRect().top),sl.left=Math.max(sl.left,sl.left-sl.getBoundingRect().left)),(sl.getBoundingRect().top+sl.getBoundingRect().height>sl.canvas.height||sl.getBoundingRect().left+sl.getBoundingRect().width>sl.canvas.width)&&(sl.top=Math.min(sl.top,sl.canvas.height-sl.getBoundingRect().height+sl.top-sl.getBoundingRect().top),sl.left=Math.min(sl.left,sl.canvas.width-sl.getBoundingRect().width+sl.left-sl.getBoundingRect().left)))})}if(!qn.value){const _l=Qe.latestImagePoints&&Qe.latestImagePoints.length===4&&Qe.latestImagePoints.every(gl=>gl.x>=0&&gl.x<=ra.x&&gl.y>=0&&gl.y<=ra.y);qn.value=new ao(_l?Qe.latestImagePoints:[{x:0,y:0},{x:ra.x,y:0},{x:ra.x,y:ra.y},{x:0,y:ra.y}],{fill:"white",opacity:.25,strokeWidth:1,stroke:"white",objectCaching:!1,transparentCorners:!1,cornerSize:20,cornerColor:"#6E1E41",hasBorders:!1}),ea.add(qn.value),qn.value.controls=ka.createPolyControls(qn.value),Object.keys(qn.value.controls).forEach(gl=>{if(qn.value){const dl=qn.value.controls[gl],sl=dl.actionHandler;dl.actionHandler=(kl,pl,Al,xl)=>{const al=pl.target.canvas;return sl(kl,pl,Math.min(Math.max(Al,0),(al==null?void 0:al.width)||0),Math.min(Math.max(xl,0),(al==null?void 0:al.height)||0))}}}),ea.setActiveObject(qn.value)}}}async function qa(){var dl;const _l=ta.x/ra.x,gl=(((dl=qn.value)==null?void 0:dl.points)||[]).concat().map(sl=>({x:sl.x*_l,y:sl.y*_l}));hn.value&&fetch(hn.value).then(sl=>sl.blob()).then(sl=>N.createFromBlob(sl)).then(sl=>He(sl,"Perspective",[gl[0].x,gl[0].y,0,0,gl[1].x,gl[1].y,sl.width,0,gl[3].x,gl[3].y,0,sl.height,gl[2].x,gl[2].y,sl.width,sl.height],{viewport:{width:sl.width,height:sl.height,x:0,y:0},virtualPixelMethod:p.TRANSPARENT})).then(sl=>sl.image.getResource().convertToBlob()).then(sl=>new Promise(kl=>{const pl=new FileReader;pl.onload=()=>{kl(pl.result)},pl.readAsDataURL(sl)})).then(sl=>{sl&&(un.value=sl,nextTick(()=>ol()))})}async function tl(){if(hn.value&&ln.value&&cn.value){emitter.emit("set-loading",!0,"Scaling image file");const _l=ln.value.naturalWidth,gl=ln.value.naturalHeight;_l>ys||gl>ys?ta=limitDimensions(_l,gl,ys):ta={x:_l,y:gl},hn.value=await downscale(cn.value,ta.x,ta.y),emitter.emit("set-loading",!1),nextTick(()=>da())}}async function ol(){if(un.value){emitter.emit("set-loading",!0,"Calculating vegetation index");const _l=await Image$1.load(un.value),gl=_l.grey({algorithm:(sl,kl,pl)=>sl/kl<p1&&pl/kl<p2&&2*kl-sl-pl>p3?255:0}),dl=gl.open().close().mask();Xn.value=gl.data.filter(sl=>sl!==0).length/gl.data.length,ze("ratio-changed",Xn.value),zn.value=_l.extract(dl).toDataURL(),emitter.emit("set-loading",!1)}}function hl(_l){_l&&emitter.emit("fetch-polygon",_l,gl=>{var dl;qn.value&&gl&&gl.length===4&&gl.every(sl=>sl.x>=0&&sl.x<=ra.x&&sl.y>=0&&sl.y<=ra.y)&&(qn.value.points=gl,qn.value.setCoords(),(dl=qn.value.canvas)==null||dl.renderAll())})}function wl(_l,gl){_l===Ke.imageId&&qn.value&&qn.value.points&&gl(qn.value.points)}return onMounted(()=>{var _l;Pi.value&&oa.observe(Pi.value),vs=((_l=Pi.value)==null?void 0:_l.clientWidth)||1440,ys=1440,Ke.fileToLoad&&(cn.value=Ke.fileToLoad,ze("file-loaded")),emitter.on("fetch-polygon",wl)}),onBeforeUnmount(()=>{Pi.value&&oa.unobserve(Pi.value),emitter.off("fetch-polygon",wl)}),(_l,gl)=>(openBlock(),createElementBlock("div",{ref_key:"wrapper",ref:Pi},[createVNode(VFileInput,{modelValue:unref(cn),"onUpdate:modelValue":gl[0]||(gl[0]=dl=>isRef(cn)?cn.value=dl:null),accept:"image/*",label:"File input"},null,8,["modelValue"]),unref(qn)?(openBlock(),createElementBlock("div",_hoisted_1$2,[createVNode(VBtn,{class:"me-3 mb-3",disabled:!Ke.neighborIds[0],"prepend-icon":"mdi-dock-left",onClick:gl[1]||(gl[1]=dl=>hl(Ke.neighborIds[0]))},{default:withCtx(()=>gl[5]||(gl[5]=[createTextVNode(" Copy from image to left ")])),_:1},8,["disabled"]),createVNode(VBtn,{class:"me-3 mb-3","prepend-icon":"mdi-overscan",onClick:ga},{default:withCtx(()=>gl[6]||(gl[6]=[createTextVNode(" Maximize selection ")])),_:1}),createVNode(VBtn,{class:"me-3 mb-3",disabled:!Ke.neighborIds[1],onClick:gl[2]||(gl[2]=dl=>hl(Ke.neighborIds[1]))},{prepend:withCtx(()=>[createVNode(VIcon,{class:"rotate-180",icon:"mdi-dock-left"})]),default:withCtx(()=>[gl[7]||(gl[7]=createTextVNode(" Copy from image to right "))]),_:1},8,["disabled"])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_2$1,[createBaseVNode("img",{ref_key:"scaledImage",ref:ln,class:"spriggles-img",src:unref(hn)},null,8,_hoisted_3$1),createBaseVNode("canvas",{ref_key:"polygonCanvas",ref:nn,height:"0",width:"0"},null,512)]),unref(qn)?(openBlock(),createBlock(VBtn,{key:1,class:"my-4","prepend-icon":"mdi-chevron-triple-down",onClick:qa},{default:withCtx(()=>gl[8]||(gl[8]=[createTextVNode(" Extract vegetation ")])),_:1})):createCommentVNode("",!0),unref(Xn)!==void 0?(openBlock(),createElementBlock("h2",_hoisted_4$1,"Vegetation ratio: "+toDisplayString((unref(Xn)*100).toFixed(2))+"%",1)):createCommentVNode("",!0),createBaseVNode("div",_hoisted_5$1,[createVNode(unref(ImgComparisonSlider),{value:unref(Un)},{default:withCtx(()=>[createBaseVNode("figure",_hoisted_6$1,[createBaseVNode("img",{class:"spriggles-img",src:unref(un)},null,8,_hoisted_7$1),gl[9]||(gl[9]=createBaseVNode("figcaption",null,"Original",-1))]),createBaseVNode("figure",_hoisted_8$1,[createBaseVNode("img",{class:"spriggles-img",src:unref(zn)},null,8,_hoisted_9),gl[10]||(gl[10]=createBaseVNode("figcaption",null,"Extracted",-1))])]),_:1},8,["value"])]),unref(Xn)!==void 0&&unref(un)&&unref(zn)?(openBlock(),createElementBlock("div",_hoisted_10,[createVNode(VBtn,{class:"download-button","prepend-icon":"mdi-download",text:"Download original",onClickCapture:gl[3]||(gl[3]=withModifiers(dl=>la(unref(un),"original"),["prevent","stop"]))}),createVNode(VBtn,{class:"download-button","prepend-icon":"mdi-download",text:"Download extracted",onClickCapture:gl[4]||(gl[4]=withModifiers(dl=>la(unref(zn),"extracted"),["prevent","stop"]))})])):createCommentVNode("",!0)],512))}}),VCardActions=genericComponent()({name:"VCardActions",props:makeComponentProps(),setup(qe,f){let{slots:ze}=f;return provideDefaults({VBtn:{slim:!0,variant:"text"}}),useRender(()=>{var Ke;return createVNode("div",{class:["v-card-actions",qe.class],style:qe.style},[(Ke=ze.default)==null?void 0:Ke.call(ze)])}),{}}}),makeVCardSubtitleProps=propsFactory({opacity:[Number,String],...makeComponentProps(),...makeTagProps()},"VCardSubtitle"),VCardSubtitle=genericComponent()({name:"VCardSubtitle",props:makeVCardSubtitleProps(),setup(qe,f){let{slots:ze}=f;return useRender(()=>createVNode(qe.tag,{class:["v-card-subtitle",qe.class],style:[{"--v-card-subtitle-opacity":qe.opacity},qe.style]},ze)),{}}}),VCardTitle=createSimpleFunctional("v-card-title"),makeCardItemProps=propsFactory({appendAvatar:String,appendIcon:IconValue,prependAvatar:String,prependIcon:IconValue,subtitle:{type:[String,Number,Boolean],default:void 0},title:{type:[String,Number,Boolean],default:void 0},...makeComponentProps(),...makeDensityProps()},"VCardItem"),VCardItem=genericComponent()({name:"VCardItem",props:makeCardItemProps(),setup(qe,f){let{slots:ze}=f;return useRender(()=>{var hn;const Ke=!!(qe.prependAvatar||qe.prependIcon),Qe=!!(Ke||ze.prepend),Pi=!!(qe.appendAvatar||qe.appendIcon),nn=!!(Pi||ze.append),ln=!!(qe.title!=null||ze.title),cn=!!(qe.subtitle!=null||ze.subtitle);return createVNode("div",{class:["v-card-item",qe.class],style:qe.style},[Qe&&createVNode("div",{key:"prepend",class:"v-card-item__prepend"},[ze.prepend?createVNode(VDefaultsProvider,{key:"prepend-defaults",disabled:!Ke,defaults:{VAvatar:{density:qe.density,image:qe.prependAvatar},VIcon:{density:qe.density,icon:qe.prependIcon}}},ze.prepend):createVNode(Fragment,null,[qe.prependAvatar&&createVNode(VAvatar,{key:"prepend-avatar",density:qe.density,image:qe.prependAvatar},null),qe.prependIcon&&createVNode(VIcon,{key:"prepend-icon",density:qe.density,icon:qe.prependIcon},null)])]),createVNode("div",{class:"v-card-item__content"},[ln&&createVNode(VCardTitle,{key:"title"},{default:()=>{var un;return[((un=ze.title)==null?void 0:un.call(ze))??toDisplayString(qe.title)]}}),cn&&createVNode(VCardSubtitle,{key:"subtitle"},{default:()=>{var un;return[((un=ze.subtitle)==null?void 0:un.call(ze))??toDisplayString(qe.subtitle)]}}),(hn=ze.default)==null?void 0:hn.call(ze)]),nn&&createVNode("div",{key:"append",class:"v-card-item__append"},[ze.append?createVNode(VDefaultsProvider,{key:"append-defaults",disabled:!Pi,defaults:{VAvatar:{density:qe.density,image:qe.appendAvatar},VIcon:{density:qe.density,icon:qe.appendIcon}}},ze.append):createVNode(Fragment,null,[qe.appendIcon&&createVNode(VIcon,{key:"append-icon",density:qe.density,icon:qe.appendIcon},null),qe.appendAvatar&&createVNode(VAvatar,{key:"append-avatar",density:qe.density,image:qe.appendAvatar},null)])])])}),{}}}),makeVCardTextProps=propsFactory({opacity:[Number,String],...makeComponentProps(),...makeTagProps()},"VCardText"),VCardText=genericComponent()({name:"VCardText",props:makeVCardTextProps(),setup(qe,f){let{slots:ze}=f;return useRender(()=>createVNode(qe.tag,{class:["v-card-text",qe.class],style:[{"--v-card-text-opacity":qe.opacity},qe.style]},ze)),{}}}),makeVCardProps=propsFactory({appendAvatar:String,appendIcon:IconValue,disabled:Boolean,flat:Boolean,hover:Boolean,image:String,link:{type:Boolean,default:void 0},prependAvatar:String,prependIcon:IconValue,ripple:{type:[Boolean,Object],default:!0},subtitle:{type:[String,Number,Boolean],default:void 0},text:{type:[String,Number,Boolean],default:void 0},title:{type:[String,Number,Boolean],default:void 0},...makeBorderProps(),...makeComponentProps(),...makeDensityProps(),...makeDimensionProps(),...makeElevationProps(),...makeLoaderProps(),...makeLocationProps(),...makePositionProps(),...makeRoundedProps(),...makeRouterProps(),...makeTagProps(),...makeThemeProps(),...makeVariantProps({variant:"elevated"})},"VCard"),VCard=genericComponent()({name:"VCard",directives:{Ripple},props:makeVCardProps(),setup(qe,f){let{attrs:ze,slots:Ke}=f;const{themeClasses:Qe}=provideTheme(qe),{borderClasses:Pi}=useBorder(qe),{colorClasses:nn,colorStyles:ln,variantClasses:cn}=useVariant(qe),{densityClasses:hn}=useDensity(qe),{dimensionStyles:un}=useDimension(qe),{elevationClasses:zn}=useElevation(qe),{loaderClasses:Xn}=useLoader(qe),{locationStyles:Un}=useLocation(qe),{positionClasses:qn}=usePosition(qe),{roundedClasses:ys}=useRounded(qe),vs=useLink(qe,ze);return useRender(()=>{const ea=qe.link!==!1&&vs.isLink.value,na=!qe.disabled&&qe.link!==!1&&(qe.link||vs.isClickable.value),ta=ea?"a":qe.tag,ra=!!(Ke.title||qe.title!=null),oa=!!(Ke.subtitle||qe.subtitle!=null),fa=ra||oa,ca=!!(Ke.append||qe.appendAvatar||qe.appendIcon),la=!!(Ke.prepend||qe.prependAvatar||qe.prependIcon),ua=!!(Ke.image||qe.image),ga=fa||la||ca,da=!!(Ke.text||qe.text!=null);return withDirectives(createVNode(ta,mergeProps({class:["v-card",{"v-card--disabled":qe.disabled,"v-card--flat":qe.flat,"v-card--hover":qe.hover&&!(qe.disabled||qe.flat),"v-card--link":na},Qe.value,Pi.value,nn.value,hn.value,zn.value,Xn.value,qn.value,ys.value,cn.value,qe.class],style:[ln.value,un.value,Un.value,qe.style],onClick:na&&vs.navigate,tabindex:qe.disabled?-1:void 0},vs.linkProps),{default:()=>{var qa;return[ua&&createVNode("div",{key:"image",class:"v-card__image"},[Ke.image?createVNode(VDefaultsProvider,{key:"image-defaults",disabled:!qe.image,defaults:{VImg:{cover:!0,src:qe.image}}},Ke.image):createVNode(VImg,{key:"image-img",cover:!0,src:qe.image},null)]),createVNode(LoaderSlot,{name:"v-card",active:!!qe.loading,color:typeof qe.loading=="boolean"?void 0:qe.loading},{default:Ke.loader}),ga&&createVNode(VCardItem,{key:"item",prependAvatar:qe.prependAvatar,prependIcon:qe.prependIcon,title:qe.title,subtitle:qe.subtitle,appendAvatar:qe.appendAvatar,appendIcon:qe.appendIcon},{default:Ke.item,prepend:Ke.prepend,title:Ke.title,subtitle:Ke.subtitle,append:Ke.append}),da&&createVNode(VCardText,{key:"text"},{default:()=>{var tl;return[((tl=Ke.text)==null?void 0:tl.call(Ke))??qe.text]}}),(qa=Ke.default)==null?void 0:qa.call(Ke),Ke.actions&&createVNode(VCardActions,null,{default:Ke.actions}),genOverlays(na,"v-card")]}}),[[resolveDirective("ripple"),na&&qe.ripple]])}),{}}}),makeVDialogProps=propsFactory({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...makeVOverlayProps({origin:"center center",scrollStrategy:"block",transition:{component:VDialogTransition},zIndex:2400})},"VDialog"),VDialog=genericComponent()({name:"VDialog",props:makeVDialogProps(),emits:{"update:modelValue":qe=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(qe,f){let{emit:ze,slots:Ke}=f;const Qe=useProxiedModel(qe,"modelValue"),{scopeId:Pi}=useScopeId(),nn=ref();function ln(un){var Un,qn;const zn=un.relatedTarget,Xn=un.target;if(zn!==Xn&&((Un=nn.value)!=null&&Un.contentEl)&&((qn=nn.value)!=null&&qn.globalTop)&&![document,nn.value.contentEl].includes(Xn)&&!nn.value.contentEl.contains(Xn)){const ys=focusableChildren(nn.value.contentEl);if(!ys.length)return;const vs=ys[0],ea=ys[ys.length-1];zn===vs?ea.focus():vs.focus()}}onBeforeUnmount(()=>{document.removeEventListener("focusin",ln)}),IN_BROWSER&&watch(()=>Qe.value&&qe.retainFocus,un=>{un?document.addEventListener("focusin",ln):document.removeEventListener("focusin",ln)},{immediate:!0});function cn(){var un;ze("afterEnter"),(qe.scrim||qe.retainFocus)&&((un=nn.value)!=null&&un.contentEl)&&!nn.value.contentEl.contains(document.activeElement)&&nn.value.contentEl.focus({preventScroll:!0})}function hn(){ze("afterLeave")}return watch(Qe,async un=>{var zn;un||(await nextTick(),(zn=nn.value.activatorEl)==null||zn.focus({preventScroll:!0}))}),useRender(()=>{const un=VOverlay.filterProps(qe),zn=mergeProps({"aria-haspopup":"dialog"},qe.activatorProps),Xn=mergeProps({tabindex:-1},qe.contentProps);return createVNode(VOverlay,mergeProps({ref:nn,class:["v-dialog",{"v-dialog--fullscreen":qe.fullscreen,"v-dialog--scrollable":qe.scrollable},qe.class],style:qe.style},un,{modelValue:Qe.value,"onUpdate:modelValue":Un=>Qe.value=Un,"aria-modal":"true",activatorProps:zn,contentProps:Xn,height:qe.fullscreen?void 0:qe.height,width:qe.fullscreen?void 0:qe.width,maxHeight:qe.fullscreen?void 0:qe.maxHeight,maxWidth:qe.fullscreen?void 0:qe.maxWidth,role:"dialog",onAfterEnter:cn,onAfterLeave:hn},Pi),{activator:Ke.activator,default:function(){for(var Un=arguments.length,qn=new Array(Un),ys=0;ys<Un;ys++)qn[ys]=arguments[ys];return createVNode(VDefaultsProvider,{root:"VDialog"},{default:()=>{var vs;return[(vs=Ke.default)==null?void 0:vs.call(Ke,...qn)]}})}})}),forwardRefs({},nn)}}),_sfc_main$2=defineComponent({__name:"GridScoreInfoModal",props:{title:{default:""},color:{default:"primary"},width:{default:290}},setup(qe,{expose:f}){const ze=qe,Ke=ref(!1);function Qe(){Ke.value=!0}return f({show:Qe}),(Pi,nn)=>(openBlock(),createBlock(VDialog,{modelValue:unref(Ke),"onUpdate:modelValue":nn[1]||(nn[1]=ln=>isRef(Ke)?Ke.value=ln:null),"max-width":ze.width},{default:withCtx(()=>[createVNode(VCard,{title:ze.title},{default:withCtx(()=>[createVNode(VCardText,null,{default:withCtx(()=>[renderSlot(Pi.$slots,"default")]),_:3}),createVNode(VCardActions,null,{default:withCtx(()=>[createVNode(VSpacer),createVNode(VBtn,{color:ze.color,text:"Close",onClick:nn[0]||(nn[0]=ln=>Ke.value=!1)},null,8,["color"])]),_:1})]),_:3},8,["title"])]),_:3},8,["modelValue","max-width"]))}}),hexToRgb=qe=>{const f=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(qe);return f?{r:parseInt(f[1],16),g:parseInt(f[2],16),b:parseInt(f[3],16)}:void 0},rgbToHex=(qe,f,ze)=>"#"+((1<<24)+(qe<<16)+(f<<8)+ze).toString(16).slice(1),createColorGradient=(qe,f,ze)=>{const Ke=hexToRgb(qe),Qe=hexToRgb(f);if(ze<2||!Ke||!Qe)return[qe];const Pi=[];for(let nn=0;nn<ze;nn++){const ln=nn/(ze-1);Pi.push(rgbToHex(Math.floor(Ke.r+ln*(Qe.r-Ke.r)),Math.floor(Ke.g+ln*(Qe.g-Ke.g)),Math.floor(Ke.b+ln*(Qe.b-Ke.b))))}return Pi};function bind(qe,f){return function(){return qe.apply(f,arguments)}}const{toString}=Object.prototype,{getPrototypeOf}=Object,{iterator,toStringTag}=Symbol,kindOf=(qe=>f=>{const ze=toString.call(f);return qe[ze]||(qe[ze]=ze.slice(8,-1).toLowerCase())})(Object.create(null)),kindOfTest=qe=>(qe=qe.toLowerCase(),f=>kindOf(f)===qe),typeOfTest=qe=>f=>typeof f===qe,{isArray}=Array,isUndefined=typeOfTest("undefined");function isBuffer(qe){return qe!==null&&!isUndefined(qe)&&qe.constructor!==null&&!isUndefined(qe.constructor)&&isFunction(qe.constructor.isBuffer)&&qe.constructor.isBuffer(qe)}const isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView(qe){let f;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?f=ArrayBuffer.isView(qe):f=qe&&qe.buffer&&isArrayBuffer(qe.buffer),f}const isString=typeOfTest("string"),isFunction=typeOfTest("function"),isNumber=typeOfTest("number"),isObject=qe=>qe!==null&&typeof qe=="object",isBoolean=qe=>qe===!0||qe===!1,isPlainObject=qe=>{if(kindOf(qe)!=="object")return!1;const f=getPrototypeOf(qe);return(f===null||f===Object.prototype||Object.getPrototypeOf(f)===null)&&!(toStringTag in qe)&&!(iterator in qe)},isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList"),isStream=qe=>isObject(qe)&&isFunction(qe.pipe),isFormData=qe=>{let f;return qe&&(typeof FormData=="function"&&qe instanceof FormData||isFunction(qe.append)&&((f=kindOf(qe))==="formdata"||f==="object"&&isFunction(qe.toString)&&qe.toString()==="[object FormData]"))},isURLSearchParams=kindOfTest("URLSearchParams"),[isReadableStream,isRequest,isResponse,isHeaders]=["ReadableStream","Request","Response","Headers"].map(kindOfTest),trim=qe=>qe.trim?qe.trim():qe.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function forEach(qe,f,{allOwnKeys:ze=!1}={}){if(qe===null||typeof qe>"u")return;let Ke,Qe;if(typeof qe!="object"&&(qe=[qe]),isArray(qe))for(Ke=0,Qe=qe.length;Ke<Qe;Ke++)f.call(null,qe[Ke],Ke,qe);else{const Pi=ze?Object.getOwnPropertyNames(qe):Object.keys(qe),nn=Pi.length;let ln;for(Ke=0;Ke<nn;Ke++)ln=Pi[Ke],f.call(null,qe[ln],ln,qe)}}function findKey(qe,f){f=f.toLowerCase();const ze=Object.keys(qe);let Ke=ze.length,Qe;for(;Ke-- >0;)if(Qe=ze[Ke],f===Qe.toLowerCase())return Qe;return null}const _global=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,isContextDefined=qe=>!isUndefined(qe)&&qe!==_global;function merge(){const{caseless:qe}=isContextDefined(this)&&this||{},f={},ze=(Ke,Qe)=>{const Pi=qe&&findKey(f,Qe)||Qe;isPlainObject(f[Pi])&&isPlainObject(Ke)?f[Pi]=merge(f[Pi],Ke):isPlainObject(Ke)?f[Pi]=merge({},Ke):isArray(Ke)?f[Pi]=Ke.slice():f[Pi]=Ke};for(let Ke=0,Qe=arguments.length;Ke<Qe;Ke++)arguments[Ke]&&forEach(arguments[Ke],ze);return f}const extend=(qe,f,ze,{allOwnKeys:Ke}={})=>(forEach(f,(Qe,Pi)=>{ze&&isFunction(Qe)?qe[Pi]=bind(Qe,ze):qe[Pi]=Qe},{allOwnKeys:Ke}),qe),stripBOM=qe=>(qe.charCodeAt(0)===65279&&(qe=qe.slice(1)),qe),inherits=(qe,f,ze,Ke)=>{qe.prototype=Object.create(f.prototype,Ke),qe.prototype.constructor=qe,Object.defineProperty(qe,"super",{value:f.prototype}),ze&&Object.assign(qe.prototype,ze)},toFlatObject=(qe,f,ze,Ke)=>{let Qe,Pi,nn;const ln={};if(f=f||{},qe==null)return f;do{for(Qe=Object.getOwnPropertyNames(qe),Pi=Qe.length;Pi-- >0;)nn=Qe[Pi],(!Ke||Ke(nn,qe,f))&&!ln[nn]&&(f[nn]=qe[nn],ln[nn]=!0);qe=ze!==!1&&getPrototypeOf(qe)}while(qe&&(!ze||ze(qe,f))&&qe!==Object.prototype);return f},endsWith=(qe,f,ze)=>{qe=String(qe),(ze===void 0||ze>qe.length)&&(ze=qe.length),ze-=f.length;const Ke=qe.indexOf(f,ze);return Ke!==-1&&Ke===ze},toArray=qe=>{if(!qe)return null;if(isArray(qe))return qe;let f=qe.length;if(!isNumber(f))return null;const ze=new Array(f);for(;f-- >0;)ze[f]=qe[f];return ze},isTypedArray=(qe=>f=>qe&&f instanceof qe)(typeof Uint8Array<"u"&&getPrototypeOf(Uint8Array)),forEachEntry=(qe,f)=>{const Ke=(qe&&qe[iterator]).call(qe);let Qe;for(;(Qe=Ke.next())&&!Qe.done;){const Pi=Qe.value;f.call(qe,Pi[0],Pi[1])}},matchAll=(qe,f)=>{let ze;const Ke=[];for(;(ze=qe.exec(f))!==null;)Ke.push(ze);return Ke},isHTMLForm=kindOfTest("HTMLFormElement"),toCamelCase=qe=>qe.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(ze,Ke,Qe){return Ke.toUpperCase()+Qe}),hasOwnProperty=(({hasOwnProperty:qe})=>(f,ze)=>qe.call(f,ze))(Object.prototype),isRegExp=kindOfTest("RegExp"),reduceDescriptors=(qe,f)=>{const ze=Object.getOwnPropertyDescriptors(qe),Ke={};forEach(ze,(Qe,Pi)=>{let nn;(nn=f(Qe,Pi,qe))!==!1&&(Ke[Pi]=nn||Qe)}),Object.defineProperties(qe,Ke)},freezeMethods=qe=>{reduceDescriptors(qe,(f,ze)=>{if(isFunction(qe)&&["arguments","caller","callee"].indexOf(ze)!==-1)return!1;const Ke=qe[ze];if(isFunction(Ke)){if(f.enumerable=!1,"writable"in f){f.writable=!1;return}f.set||(f.set=()=>{throw Error("Can not rewrite read-only method '"+ze+"'")})}})},toObjectSet=(qe,f)=>{const ze={},Ke=Qe=>{Qe.forEach(Pi=>{ze[Pi]=!0})};return isArray(qe)?Ke(qe):Ke(String(qe).split(f)),ze},noop=()=>{},toFiniteNumber=(qe,f)=>qe!=null&&Number.isFinite(qe=+qe)?qe:f;function isSpecCompliantForm(qe){return!!(qe&&isFunction(qe.append)&&qe[toStringTag]==="FormData"&&qe[iterator])}const toJSONObject=qe=>{const f=new Array(10),ze=(Ke,Qe)=>{if(isObject(Ke)){if(f.indexOf(Ke)>=0)return;if(!("toJSON"in Ke)){f[Qe]=Ke;const Pi=isArray(Ke)?[]:{};return forEach(Ke,(nn,ln)=>{const cn=ze(nn,Qe+1);!isUndefined(cn)&&(Pi[ln]=cn)}),f[Qe]=void 0,Pi}}return Ke};return ze(qe,0)},isAsyncFn=kindOfTest("AsyncFunction"),isThenable=qe=>qe&&(isObject(qe)||isFunction(qe))&&isFunction(qe.then)&&isFunction(qe.catch),_setImmediate=((qe,f)=>qe?setImmediate:f?((ze,Ke)=>(_global.addEventListener("message",({source:Qe,data:Pi})=>{Qe===_global&&Pi===ze&&Ke.length&&Ke.shift()()},!1),Qe=>{Ke.push(Qe),_global.postMessage(ze,"*")}))(`axios@${Math.random()}`,[]):ze=>setTimeout(ze))(typeof setImmediate=="function",isFunction(_global.postMessage)),asap=typeof queueMicrotask<"u"?queueMicrotask.bind(_global):typeof process<"u"&&process.nextTick||_setImmediate,isIterable=qe=>qe!=null&&isFunction(qe[iterator]),utils$1={isArray,isArrayBuffer,isBuffer,isFormData,isArrayBufferView,isString,isNumber,isBoolean,isObject,isPlainObject,isReadableStream,isRequest,isResponse,isHeaders,isUndefined,isDate,isFile,isBlob,isRegExp,isFunction,isStream,isURLSearchParams,isTypedArray,isFileList,forEach,merge,extend,trim,stripBOM,inherits,toFlatObject,kindOf,kindOfTest,endsWith,toArray,forEachEntry,matchAll,isHTMLForm,hasOwnProperty,hasOwnProp:hasOwnProperty,reduceDescriptors,freezeMethods,toObjectSet,toCamelCase,noop,toFiniteNumber,findKey,global:_global,isContextDefined,isSpecCompliantForm,toJSONObject,isAsyncFn,isThenable,setImmediate:_setImmediate,asap,isIterable};function AxiosError$1(qe,f,ze,Ke,Qe){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=qe,this.name="AxiosError",f&&(this.code=f),ze&&(this.config=ze),Ke&&(this.request=Ke),Qe&&(this.response=Qe,this.status=Qe.status?Qe.status:null)}utils$1.inherits(AxiosError$1,Error,{toJSON:function qe(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:utils$1.toJSONObject(this.config),code:this.code,status:this.status}}});const prototype$1=AxiosError$1.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(qe=>{descriptors[qe]={value:qe}});Object.defineProperties(AxiosError$1,descriptors);Object.defineProperty(prototype$1,"isAxiosError",{value:!0});AxiosError$1.from=(qe,f,ze,Ke,Qe,Pi)=>{const nn=Object.create(prototype$1);return utils$1.toFlatObject(qe,nn,function(cn){return cn!==Error.prototype},ln=>ln!=="isAxiosError"),AxiosError$1.call(nn,qe.message,f,ze,Ke,Qe),nn.cause=qe,nn.name=qe.name,Pi&&Object.assign(nn,Pi),nn};const httpAdapter=null;function isVisitable(qe){return utils$1.isPlainObject(qe)||utils$1.isArray(qe)}function removeBrackets(qe){return utils$1.endsWith(qe,"[]")?qe.slice(0,-2):qe}function renderKey(qe,f,ze){return qe?qe.concat(f).map(function(Qe,Pi){return Qe=removeBrackets(Qe),!ze&&Pi?"["+Qe+"]":Qe}).join(ze?".":""):f}function isFlatArray(qe){return utils$1.isArray(qe)&&!qe.some(isVisitable)}const predicates=utils$1.toFlatObject(utils$1,{},null,function qe(f){return/^is[A-Z]/.test(f)});function toFormData$1(qe,f,ze){if(!utils$1.isObject(qe))throw new TypeError("target must be an object");f=f||new FormData,ze=utils$1.toFlatObject(ze,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ys,vs){return!utils$1.isUndefined(vs[ys])});const Ke=ze.metaTokens,Qe=ze.visitor||un,Pi=ze.dots,nn=ze.indexes,cn=(ze.Blob||typeof Blob<"u"&&Blob)&&utils$1.isSpecCompliantForm(f);if(!utils$1.isFunction(Qe))throw new TypeError("visitor must be a function");function hn(qn){if(qn===null)return"";if(utils$1.isDate(qn))return qn.toISOString();if(!cn&&utils$1.isBlob(qn))throw new AxiosError$1("Blob is not supported. Use a Buffer instead.");return utils$1.isArrayBuffer(qn)||utils$1.isTypedArray(qn)?cn&&typeof Blob=="function"?new Blob([qn]):Buffer.from(qn):qn}function un(qn,ys,vs){let ea=qn;if(qn&&!vs&&typeof qn=="object"){if(utils$1.endsWith(ys,"{}"))ys=Ke?ys:ys.slice(0,-2),qn=JSON.stringify(qn);else if(utils$1.isArray(qn)&&isFlatArray(qn)||(utils$1.isFileList(qn)||utils$1.endsWith(ys,"[]"))&&(ea=utils$1.toArray(qn)))return ys=removeBrackets(ys),ea.forEach(function(ta,ra){!(utils$1.isUndefined(ta)||ta===null)&&f.append(nn===!0?renderKey([ys],ra,Pi):nn===null?ys:ys+"[]",hn(ta))}),!1}return isVisitable(qn)?!0:(f.append(renderKey(vs,ys,Pi),hn(qn)),!1)}const zn=[],Xn=Object.assign(predicates,{defaultVisitor:un,convertValue:hn,isVisitable});function Un(qn,ys){if(!utils$1.isUndefined(qn)){if(zn.indexOf(qn)!==-1)throw Error("Circular reference detected in "+ys.join("."));zn.push(qn),utils$1.forEach(qn,function(ea,na){(!(utils$1.isUndefined(ea)||ea===null)&&Qe.call(f,ea,utils$1.isString(na)?na.trim():na,ys,Xn))===!0&&Un(ea,ys?ys.concat(na):[na])}),zn.pop()}}if(!utils$1.isObject(qe))throw new TypeError("data must be an object");return Un(qe),f}function encode$1(qe){const f={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(qe).replace(/[!'()~]|%20|%00/g,function(Ke){return f[Ke]})}function AxiosURLSearchParams(qe,f){this._pairs=[],qe&&toFormData$1(qe,this,f)}const prototype=AxiosURLSearchParams.prototype;prototype.append=function qe(f,ze){this._pairs.push([f,ze])};prototype.toString=function qe(f){const ze=f?function(Ke){return f.call(this,Ke,encode$1)}:encode$1;return this._pairs.map(function(Qe){return ze(Qe[0])+"="+ze(Qe[1])},"").join("&")};function encode(qe){return encodeURIComponent(qe).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function buildURL(qe,f,ze){if(!f)return qe;const Ke=ze&&ze.encode||encode;utils$1.isFunction(ze)&&(ze={serialize:ze});const Qe=ze&&ze.serialize;let Pi;if(Qe?Pi=Qe(f,ze):Pi=utils$1.isURLSearchParams(f)?f.toString():new AxiosURLSearchParams(f,ze).toString(Ke),Pi){const nn=qe.indexOf("#");nn!==-1&&(qe=qe.slice(0,nn)),qe+=(qe.indexOf("?")===-1?"?":"&")+Pi}return qe}class InterceptorManager{constructor(){this.handlers=[]}use(f,ze,Ke){return this.handlers.push({fulfilled:f,rejected:ze,synchronous:Ke?Ke.synchronous:!1,runWhen:Ke?Ke.runWhen:null}),this.handlers.length-1}eject(f){this.handlers[f]&&(this.handlers[f]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(f){utils$1.forEach(this.handlers,function(Ke){Ke!==null&&f(Ke)})}}const transitionalDefaults={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},URLSearchParams$1=typeof URLSearchParams<"u"?URLSearchParams:AxiosURLSearchParams,FormData$1=typeof FormData<"u"?FormData:null,Blob$1=typeof Blob<"u"?Blob:null,platform$1={isBrowser:!0,classes:{URLSearchParams:URLSearchParams$1,FormData:FormData$1,Blob:Blob$1},protocols:["http","https","file","blob","url","data"]},hasBrowserEnv=typeof window<"u"&&typeof document<"u",_navigator=typeof navigator=="object"&&navigator||void 0,hasStandardBrowserEnv=hasBrowserEnv&&(!_navigator||["ReactNative","NativeScript","NS"].indexOf(_navigator.product)<0),hasStandardBrowserWebWorkerEnv=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",origin=hasBrowserEnv&&window.location.href||"http://localhost",utils=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv,hasStandardBrowserEnv,hasStandardBrowserWebWorkerEnv,navigator:_navigator,origin},Symbol.toStringTag,{value:"Module"})),platform={...utils,...platform$1};function toURLEncodedForm(qe,f){return toFormData$1(qe,new platform.classes.URLSearchParams,Object.assign({visitor:function(ze,Ke,Qe,Pi){return platform.isNode&&utils$1.isBuffer(ze)?(this.append(Ke,ze.toString("base64")),!1):Pi.defaultVisitor.apply(this,arguments)}},f))}function parsePropPath(qe){return utils$1.matchAll(/\w+|\[(\w*)]/g,qe).map(f=>f[0]==="[]"?"":f[1]||f[0])}function arrayToObject(qe){const f={},ze=Object.keys(qe);let Ke;const Qe=ze.length;let Pi;for(Ke=0;Ke<Qe;Ke++)Pi=ze[Ke],f[Pi]=qe[Pi];return f}function formDataToJSON(qe){function f(ze,Ke,Qe,Pi){let nn=ze[Pi++];if(nn==="__proto__")return!0;const ln=Number.isFinite(+nn),cn=Pi>=ze.length;return nn=!nn&&utils$1.isArray(Qe)?Qe.length:nn,cn?(utils$1.hasOwnProp(Qe,nn)?Qe[nn]=[Qe[nn],Ke]:Qe[nn]=Ke,!ln):((!Qe[nn]||!utils$1.isObject(Qe[nn]))&&(Qe[nn]=[]),f(ze,Ke,Qe[nn],Pi)&&utils$1.isArray(Qe[nn])&&(Qe[nn]=arrayToObject(Qe[nn])),!ln)}if(utils$1.isFormData(qe)&&utils$1.isFunction(qe.entries)){const ze={};return utils$1.forEachEntry(qe,(Ke,Qe)=>{f(parsePropPath(Ke),Qe,ze,0)}),ze}return null}function stringifySafely(qe,f,ze){if(utils$1.isString(qe))try{return(f||JSON.parse)(qe),utils$1.trim(qe)}catch(Ke){if(Ke.name!=="SyntaxError")throw Ke}return(ze||JSON.stringify)(qe)}const defaults={transitional:transitionalDefaults,adapter:["xhr","http","fetch"],transformRequest:[function qe(f,ze){const Ke=ze.getContentType()||"",Qe=Ke.indexOf("application/json")>-1,Pi=utils$1.isObject(f);if(Pi&&utils$1.isHTMLForm(f)&&(f=new FormData(f)),utils$1.isFormData(f))return Qe?JSON.stringify(formDataToJSON(f)):f;if(utils$1.isArrayBuffer(f)||utils$1.isBuffer(f)||utils$1.isStream(f)||utils$1.isFile(f)||utils$1.isBlob(f)||utils$1.isReadableStream(f))return f;if(utils$1.isArrayBufferView(f))return f.buffer;if(utils$1.isURLSearchParams(f))return ze.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),f.toString();let ln;if(Pi){if(Ke.indexOf("application/x-www-form-urlencoded")>-1)return toURLEncodedForm(f,this.formSerializer).toString();if((ln=utils$1.isFileList(f))||Ke.indexOf("multipart/form-data")>-1){const cn=this.env&&this.env.FormData;return toFormData$1(ln?{"files[]":f}:f,cn&&new cn,this.formSerializer)}}return Pi||Qe?(ze.setContentType("application/json",!1),stringifySafely(f)):f}],transformResponse:[function qe(f){const ze=this.transitional||defaults.transitional,Ke=ze&&ze.forcedJSONParsing,Qe=this.responseType==="json";if(utils$1.isResponse(f)||utils$1.isReadableStream(f))return f;if(f&&utils$1.isString(f)&&(Ke&&!this.responseType||Qe)){const nn=!(ze&&ze.silentJSONParsing)&&Qe;try{return JSON.parse(f)}catch(ln){if(nn)throw ln.name==="SyntaxError"?AxiosError$1.from(ln,AxiosError$1.ERR_BAD_RESPONSE,this,null,this.response):ln}}return f}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:platform.classes.FormData,Blob:platform.classes.Blob},validateStatus:function qe(f){return f>=200&&f<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};utils$1.forEach(["delete","get","head","post","put","patch"],qe=>{defaults.headers[qe]={}});const ignoreDuplicateOf=utils$1.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),parseHeaders=qe=>{const f={};let ze,Ke,Qe;return qe&&qe.split(`
`).forEach(function(nn){Qe=nn.indexOf(":"),ze=nn.substring(0,Qe).trim().toLowerCase(),Ke=nn.substring(Qe+1).trim(),!(!ze||f[ze]&&ignoreDuplicateOf[ze])&&(ze==="set-cookie"?f[ze]?f[ze].push(Ke):f[ze]=[Ke]:f[ze]=f[ze]?f[ze]+", "+Ke:Ke)}),f},$internals=Symbol("internals");function normalizeHeader(qe){return qe&&String(qe).trim().toLowerCase()}function normalizeValue(qe){return qe===!1||qe==null?qe:utils$1.isArray(qe)?qe.map(normalizeValue):String(qe)}function parseTokens(qe){const f=Object.create(null),ze=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let Ke;for(;Ke=ze.exec(qe);)f[Ke[1]]=Ke[2];return f}const isValidHeaderName=qe=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(qe.trim());function matchHeaderValue(qe,f,ze,Ke,Qe){if(utils$1.isFunction(Ke))return Ke.call(this,f,ze);if(Qe&&(f=ze),!!utils$1.isString(f)){if(utils$1.isString(Ke))return f.indexOf(Ke)!==-1;if(utils$1.isRegExp(Ke))return Ke.test(f)}}function formatHeader(qe){return qe.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(f,ze,Ke)=>ze.toUpperCase()+Ke)}function buildAccessors(qe,f){const ze=utils$1.toCamelCase(" "+f);["get","set","has"].forEach(Ke=>{Object.defineProperty(qe,Ke+ze,{value:function(Qe,Pi,nn){return this[Ke].call(this,f,Qe,Pi,nn)},configurable:!0})})}let AxiosHeaders$1=class{constructor(f){f&&this.set(f)}set(f,ze,Ke){const Qe=this;function Pi(ln,cn,hn){const un=normalizeHeader(cn);if(!un)throw new Error("header name must be a non-empty string");const zn=utils$1.findKey(Qe,un);(!zn||Qe[zn]===void 0||hn===!0||hn===void 0&&Qe[zn]!==!1)&&(Qe[zn||cn]=normalizeValue(ln))}const nn=(ln,cn)=>utils$1.forEach(ln,(hn,un)=>Pi(hn,un,cn));if(utils$1.isPlainObject(f)||f instanceof this.constructor)nn(f,ze);else if(utils$1.isString(f)&&(f=f.trim())&&!isValidHeaderName(f))nn(parseHeaders(f),ze);else if(utils$1.isObject(f)&&utils$1.isIterable(f)){let ln={},cn,hn;for(const un of f){if(!utils$1.isArray(un))throw TypeError("Object iterator must return a key-value pair");ln[hn=un[0]]=(cn=ln[hn])?utils$1.isArray(cn)?[...cn,un[1]]:[cn,un[1]]:un[1]}nn(ln,ze)}else f!=null&&Pi(ze,f,Ke);return this}get(f,ze){if(f=normalizeHeader(f),f){const Ke=utils$1.findKey(this,f);if(Ke){const Qe=this[Ke];if(!ze)return Qe;if(ze===!0)return parseTokens(Qe);if(utils$1.isFunction(ze))return ze.call(this,Qe,Ke);if(utils$1.isRegExp(ze))return ze.exec(Qe);throw new TypeError("parser must be boolean|regexp|function")}}}has(f,ze){if(f=normalizeHeader(f),f){const Ke=utils$1.findKey(this,f);return!!(Ke&&this[Ke]!==void 0&&(!ze||matchHeaderValue(this,this[Ke],Ke,ze)))}return!1}delete(f,ze){const Ke=this;let Qe=!1;function Pi(nn){if(nn=normalizeHeader(nn),nn){const ln=utils$1.findKey(Ke,nn);ln&&(!ze||matchHeaderValue(Ke,Ke[ln],ln,ze))&&(delete Ke[ln],Qe=!0)}}return utils$1.isArray(f)?f.forEach(Pi):Pi(f),Qe}clear(f){const ze=Object.keys(this);let Ke=ze.length,Qe=!1;for(;Ke--;){const Pi=ze[Ke];(!f||matchHeaderValue(this,this[Pi],Pi,f,!0))&&(delete this[Pi],Qe=!0)}return Qe}normalize(f){const ze=this,Ke={};return utils$1.forEach(this,(Qe,Pi)=>{const nn=utils$1.findKey(Ke,Pi);if(nn){ze[nn]=normalizeValue(Qe),delete ze[Pi];return}const ln=f?formatHeader(Pi):String(Pi).trim();ln!==Pi&&delete ze[Pi],ze[ln]=normalizeValue(Qe),Ke[ln]=!0}),this}concat(...f){return this.constructor.concat(this,...f)}toJSON(f){const ze=Object.create(null);return utils$1.forEach(this,(Ke,Qe)=>{Ke!=null&&Ke!==!1&&(ze[Qe]=f&&utils$1.isArray(Ke)?Ke.join(", "):Ke)}),ze}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([f,ze])=>f+": "+ze).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(f){return f instanceof this?f:new this(f)}static concat(f,...ze){const Ke=new this(f);return ze.forEach(Qe=>Ke.set(Qe)),Ke}static accessor(f){const Ke=(this[$internals]=this[$internals]={accessors:{}}).accessors,Qe=this.prototype;function Pi(nn){const ln=normalizeHeader(nn);Ke[ln]||(buildAccessors(Qe,nn),Ke[ln]=!0)}return utils$1.isArray(f)?f.forEach(Pi):Pi(f),this}};AxiosHeaders$1.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);utils$1.reduceDescriptors(AxiosHeaders$1.prototype,({value:qe},f)=>{let ze=f[0].toUpperCase()+f.slice(1);return{get:()=>qe,set(Ke){this[ze]=Ke}}});utils$1.freezeMethods(AxiosHeaders$1);function transformData(qe,f){const ze=this||defaults,Ke=f||ze,Qe=AxiosHeaders$1.from(Ke.headers);let Pi=Ke.data;return utils$1.forEach(qe,function(ln){Pi=ln.call(ze,Pi,Qe.normalize(),f?f.status:void 0)}),Qe.normalize(),Pi}function isCancel$1(qe){return!!(qe&&qe.__CANCEL__)}function CanceledError$1(qe,f,ze){AxiosError$1.call(this,qe??"canceled",AxiosError$1.ERR_CANCELED,f,ze),this.name="CanceledError"}utils$1.inherits(CanceledError$1,AxiosError$1,{__CANCEL__:!0});function settle(qe,f,ze){const Ke=ze.config.validateStatus;!ze.status||!Ke||Ke(ze.status)?qe(ze):f(new AxiosError$1("Request failed with status code "+ze.status,[AxiosError$1.ERR_BAD_REQUEST,AxiosError$1.ERR_BAD_RESPONSE][Math.floor(ze.status/100)-4],ze.config,ze.request,ze))}function parseProtocol(qe){const f=/^([-+\w]{1,25})(:?\/\/|:)/.exec(qe);return f&&f[1]||""}function speedometer(qe,f){qe=qe||10;const ze=new Array(qe),Ke=new Array(qe);let Qe=0,Pi=0,nn;return f=f!==void 0?f:1e3,function(cn){const hn=Date.now(),un=Ke[Pi];nn||(nn=hn),ze[Qe]=cn,Ke[Qe]=hn;let zn=Pi,Xn=0;for(;zn!==Qe;)Xn+=ze[zn++],zn=zn%qe;if(Qe=(Qe+1)%qe,Qe===Pi&&(Pi=(Pi+1)%qe),hn-nn<f)return;const Un=un&&hn-un;return Un?Math.round(Xn*1e3/Un):void 0}}function throttle(qe,f){let ze=0,Ke=1e3/f,Qe,Pi;const nn=(hn,un=Date.now())=>{ze=un,Qe=null,Pi&&(clearTimeout(Pi),Pi=null),qe.apply(null,hn)};return[(...hn)=>{const un=Date.now(),zn=un-ze;zn>=Ke?nn(hn,un):(Qe=hn,Pi||(Pi=setTimeout(()=>{Pi=null,nn(Qe)},Ke-zn)))},()=>Qe&&nn(Qe)]}const progressEventReducer=(qe,f,ze=3)=>{let Ke=0;const Qe=speedometer(50,250);return throttle(Pi=>{const nn=Pi.loaded,ln=Pi.lengthComputable?Pi.total:void 0,cn=nn-Ke,hn=Qe(cn),un=nn<=ln;Ke=nn;const zn={loaded:nn,total:ln,progress:ln?nn/ln:void 0,bytes:cn,rate:hn||void 0,estimated:hn&&ln&&un?(ln-nn)/hn:void 0,event:Pi,lengthComputable:ln!=null,[f?"download":"upload"]:!0};qe(zn)},ze)},progressEventDecorator=(qe,f)=>{const ze=qe!=null;return[Ke=>f[0]({lengthComputable:ze,total:qe,loaded:Ke}),f[1]]},asyncDecorator=qe=>(...f)=>utils$1.asap(()=>qe(...f)),isURLSameOrigin=platform.hasStandardBrowserEnv?((qe,f)=>ze=>(ze=new URL(ze,platform.origin),qe.protocol===ze.protocol&&qe.host===ze.host&&(f||qe.port===ze.port)))(new URL(platform.origin),platform.navigator&&/(msie|trident)/i.test(platform.navigator.userAgent)):()=>!0,cookies=platform.hasStandardBrowserEnv?{write(qe,f,ze,Ke,Qe,Pi){const nn=[qe+"="+encodeURIComponent(f)];utils$1.isNumber(ze)&&nn.push("expires="+new Date(ze).toGMTString()),utils$1.isString(Ke)&&nn.push("path="+Ke),utils$1.isString(Qe)&&nn.push("domain="+Qe),Pi===!0&&nn.push("secure"),document.cookie=nn.join("; ")},read(qe){const f=document.cookie.match(new RegExp("(^|;\\s*)("+qe+")=([^;]*)"));return f?decodeURIComponent(f[3]):null},remove(qe){this.write(qe,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function isAbsoluteURL(qe){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(qe)}function combineURLs(qe,f){return f?qe.replace(/\/?\/$/,"")+"/"+f.replace(/^\/+/,""):qe}function buildFullPath(qe,f,ze){let Ke=!isAbsoluteURL(f);return qe&&(Ke||ze==!1)?combineURLs(qe,f):f}const headersToObject=qe=>qe instanceof AxiosHeaders$1?{...qe}:qe;function mergeConfig$1(qe,f){f=f||{};const ze={};function Ke(hn,un,zn,Xn){return utils$1.isPlainObject(hn)&&utils$1.isPlainObject(un)?utils$1.merge.call({caseless:Xn},hn,un):utils$1.isPlainObject(un)?utils$1.merge({},un):utils$1.isArray(un)?un.slice():un}function Qe(hn,un,zn,Xn){if(utils$1.isUndefined(un)){if(!utils$1.isUndefined(hn))return Ke(void 0,hn,zn,Xn)}else return Ke(hn,un,zn,Xn)}function Pi(hn,un){if(!utils$1.isUndefined(un))return Ke(void 0,un)}function nn(hn,un){if(utils$1.isUndefined(un)){if(!utils$1.isUndefined(hn))return Ke(void 0,hn)}else return Ke(void 0,un)}function ln(hn,un,zn){if(zn in f)return Ke(hn,un);if(zn in qe)return Ke(void 0,hn)}const cn={url:Pi,method:Pi,data:Pi,baseURL:nn,transformRequest:nn,transformResponse:nn,paramsSerializer:nn,timeout:nn,timeoutMessage:nn,withCredentials:nn,withXSRFToken:nn,adapter:nn,responseType:nn,xsrfCookieName:nn,xsrfHeaderName:nn,onUploadProgress:nn,onDownloadProgress:nn,decompress:nn,maxContentLength:nn,maxBodyLength:nn,beforeRedirect:nn,transport:nn,httpAgent:nn,httpsAgent:nn,cancelToken:nn,socketPath:nn,responseEncoding:nn,validateStatus:ln,headers:(hn,un,zn)=>Qe(headersToObject(hn),headersToObject(un),zn,!0)};return utils$1.forEach(Object.keys(Object.assign({},qe,f)),function(un){const zn=cn[un]||Qe,Xn=zn(qe[un],f[un],un);utils$1.isUndefined(Xn)&&zn!==ln||(ze[un]=Xn)}),ze}const resolveConfig=qe=>{const f=mergeConfig$1({},qe);let{data:ze,withXSRFToken:Ke,xsrfHeaderName:Qe,xsrfCookieName:Pi,headers:nn,auth:ln}=f;f.headers=nn=AxiosHeaders$1.from(nn),f.url=buildURL(buildFullPath(f.baseURL,f.url,f.allowAbsoluteUrls),qe.params,qe.paramsSerializer),ln&&nn.set("Authorization","Basic "+btoa((ln.username||"")+":"+(ln.password?unescape(encodeURIComponent(ln.password)):"")));let cn;if(utils$1.isFormData(ze)){if(platform.hasStandardBrowserEnv||platform.hasStandardBrowserWebWorkerEnv)nn.setContentType(void 0);else if((cn=nn.getContentType())!==!1){const[hn,...un]=cn?cn.split(";").map(zn=>zn.trim()).filter(Boolean):[];nn.setContentType([hn||"multipart/form-data",...un].join("; "))}}if(platform.hasStandardBrowserEnv&&(Ke&&utils$1.isFunction(Ke)&&(Ke=Ke(f)),Ke||Ke!==!1&&isURLSameOrigin(f.url))){const hn=Qe&&Pi&&cookies.read(Pi);hn&&nn.set(Qe,hn)}return f},isXHRAdapterSupported=typeof XMLHttpRequest<"u",xhrAdapter=isXHRAdapterSupported&&function(qe){return new Promise(function(ze,Ke){const Qe=resolveConfig(qe);let Pi=Qe.data;const nn=AxiosHeaders$1.from(Qe.headers).normalize();let{responseType:ln,onUploadProgress:cn,onDownloadProgress:hn}=Qe,un,zn,Xn,Un,qn;function ys(){Un&&Un(),qn&&qn(),Qe.cancelToken&&Qe.cancelToken.unsubscribe(un),Qe.signal&&Qe.signal.removeEventListener("abort",un)}let vs=new XMLHttpRequest;vs.open(Qe.method.toUpperCase(),Qe.url,!0),vs.timeout=Qe.timeout;function ea(){if(!vs)return;const ta=AxiosHeaders$1.from("getAllResponseHeaders"in vs&&vs.getAllResponseHeaders()),oa={data:!ln||ln==="text"||ln==="json"?vs.responseText:vs.response,status:vs.status,statusText:vs.statusText,headers:ta,config:qe,request:vs};settle(function(ca){ze(ca),ys()},function(ca){Ke(ca),ys()},oa),vs=null}"onloadend"in vs?vs.onloadend=ea:vs.onreadystatechange=function(){!vs||vs.readyState!==4||vs.status===0&&!(vs.responseURL&&vs.responseURL.indexOf("file:")===0)||setTimeout(ea)},vs.onabort=function(){vs&&(Ke(new AxiosError$1("Request aborted",AxiosError$1.ECONNABORTED,qe,vs)),vs=null)},vs.onerror=function(){Ke(new AxiosError$1("Network Error",AxiosError$1.ERR_NETWORK,qe,vs)),vs=null},vs.ontimeout=function(){let ra=Qe.timeout?"timeout of "+Qe.timeout+"ms exceeded":"timeout exceeded";const oa=Qe.transitional||transitionalDefaults;Qe.timeoutErrorMessage&&(ra=Qe.timeoutErrorMessage),Ke(new AxiosError$1(ra,oa.clarifyTimeoutError?AxiosError$1.ETIMEDOUT:AxiosError$1.ECONNABORTED,qe,vs)),vs=null},Pi===void 0&&nn.setContentType(null),"setRequestHeader"in vs&&utils$1.forEach(nn.toJSON(),function(ra,oa){vs.setRequestHeader(oa,ra)}),utils$1.isUndefined(Qe.withCredentials)||(vs.withCredentials=!!Qe.withCredentials),ln&&ln!=="json"&&(vs.responseType=Qe.responseType),hn&&([Xn,qn]=progressEventReducer(hn,!0),vs.addEventListener("progress",Xn)),cn&&vs.upload&&([zn,Un]=progressEventReducer(cn),vs.upload.addEventListener("progress",zn),vs.upload.addEventListener("loadend",Un)),(Qe.cancelToken||Qe.signal)&&(un=ta=>{vs&&(Ke(!ta||ta.type?new CanceledError$1(null,qe,vs):ta),vs.abort(),vs=null)},Qe.cancelToken&&Qe.cancelToken.subscribe(un),Qe.signal&&(Qe.signal.aborted?un():Qe.signal.addEventListener("abort",un)));const na=parseProtocol(Qe.url);if(na&&platform.protocols.indexOf(na)===-1){Ke(new AxiosError$1("Unsupported protocol "+na+":",AxiosError$1.ERR_BAD_REQUEST,qe));return}vs.send(Pi||null)})},composeSignals=(qe,f)=>{const{length:ze}=qe=qe?qe.filter(Boolean):[];if(f||ze){let Ke=new AbortController,Qe;const Pi=function(hn){if(!Qe){Qe=!0,ln();const un=hn instanceof Error?hn:this.reason;Ke.abort(un instanceof AxiosError$1?un:new CanceledError$1(un instanceof Error?un.message:un))}};let nn=f&&setTimeout(()=>{nn=null,Pi(new AxiosError$1(`timeout ${f} of ms exceeded`,AxiosError$1.ETIMEDOUT))},f);const ln=()=>{qe&&(nn&&clearTimeout(nn),nn=null,qe.forEach(hn=>{hn.unsubscribe?hn.unsubscribe(Pi):hn.removeEventListener("abort",Pi)}),qe=null)};qe.forEach(hn=>hn.addEventListener("abort",Pi));const{signal:cn}=Ke;return cn.unsubscribe=()=>utils$1.asap(ln),cn}},streamChunk=function*(qe,f){let ze=qe.byteLength;if(ze<f){yield qe;return}let Ke=0,Qe;for(;Ke<ze;)Qe=Ke+f,yield qe.slice(Ke,Qe),Ke=Qe},readBytes=async function*(qe,f){for await(const ze of readStream(qe))yield*streamChunk(ze,f)},readStream=async function*(qe){if(qe[Symbol.asyncIterator]){yield*qe;return}const f=qe.getReader();try{for(;;){const{done:ze,value:Ke}=await f.read();if(ze)break;yield Ke}}finally{await f.cancel()}},trackStream=(qe,f,ze,Ke)=>{const Qe=readBytes(qe,f);let Pi=0,nn,ln=cn=>{nn||(nn=!0,Ke&&Ke(cn))};return new ReadableStream({async pull(cn){try{const{done:hn,value:un}=await Qe.next();if(hn){ln(),cn.close();return}let zn=un.byteLength;if(ze){let Xn=Pi+=zn;ze(Xn)}cn.enqueue(new Uint8Array(un))}catch(hn){throw ln(hn),hn}},cancel(cn){return ln(cn),Qe.return()}},{highWaterMark:2})},isFetchSupported=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",isReadableStreamSupported=isFetchSupported&&typeof ReadableStream=="function",encodeText=isFetchSupported&&(typeof TextEncoder=="function"?(qe=>f=>qe.encode(f))(new TextEncoder):async qe=>new Uint8Array(await new Response(qe).arrayBuffer())),test=(qe,...f)=>{try{return!!qe(...f)}catch{return!1}},supportsRequestStream=isReadableStreamSupported&&test(()=>{let qe=!1;const f=new Request(platform.origin,{body:new ReadableStream,method:"POST",get duplex(){return qe=!0,"half"}}).headers.has("Content-Type");return qe&&!f}),DEFAULT_CHUNK_SIZE=64*1024,supportsResponseStream=isReadableStreamSupported&&test(()=>utils$1.isReadableStream(new Response("").body)),resolvers={stream:supportsResponseStream&&(qe=>qe.body)};isFetchSupported&&(qe=>{["text","arrayBuffer","blob","formData","stream"].forEach(f=>{!resolvers[f]&&(resolvers[f]=utils$1.isFunction(qe[f])?ze=>ze[f]():(ze,Ke)=>{throw new AxiosError$1(`Response type '${f}' is not supported`,AxiosError$1.ERR_NOT_SUPPORT,Ke)})})})(new Response);const getBodyLength=async qe=>{if(qe==null)return 0;if(utils$1.isBlob(qe))return qe.size;if(utils$1.isSpecCompliantForm(qe))return(await new Request(platform.origin,{method:"POST",body:qe}).arrayBuffer()).byteLength;if(utils$1.isArrayBufferView(qe)||utils$1.isArrayBuffer(qe))return qe.byteLength;if(utils$1.isURLSearchParams(qe)&&(qe=qe+""),utils$1.isString(qe))return(await encodeText(qe)).byteLength},resolveBodyLength=async(qe,f)=>{const ze=utils$1.toFiniteNumber(qe.getContentLength());return ze??getBodyLength(f)},fetchAdapter=isFetchSupported&&(async qe=>{let{url:f,method:ze,data:Ke,signal:Qe,cancelToken:Pi,timeout:nn,onDownloadProgress:ln,onUploadProgress:cn,responseType:hn,headers:un,withCredentials:zn="same-origin",fetchOptions:Xn}=resolveConfig(qe);hn=hn?(hn+"").toLowerCase():"text";let Un=composeSignals([Qe,Pi&&Pi.toAbortSignal()],nn),qn;const ys=Un&&Un.unsubscribe&&(()=>{Un.unsubscribe()});let vs;try{if(cn&&supportsRequestStream&&ze!=="get"&&ze!=="head"&&(vs=await resolveBodyLength(un,Ke))!==0){let oa=new Request(f,{method:"POST",body:Ke,duplex:"half"}),fa;if(utils$1.isFormData(Ke)&&(fa=oa.headers.get("content-type"))&&un.setContentType(fa),oa.body){const[ca,la]=progressEventDecorator(vs,progressEventReducer(asyncDecorator(cn)));Ke=trackStream(oa.body,DEFAULT_CHUNK_SIZE,ca,la)}}utils$1.isString(zn)||(zn=zn?"include":"omit");const ea="credentials"in Request.prototype;qn=new Request(f,{...Xn,signal:Un,method:ze.toUpperCase(),headers:un.normalize().toJSON(),body:Ke,duplex:"half",credentials:ea?zn:void 0});let na=await fetch(qn);const ta=supportsResponseStream&&(hn==="stream"||hn==="response");if(supportsResponseStream&&(ln||ta&&ys)){const oa={};["status","statusText","headers"].forEach(ua=>{oa[ua]=na[ua]});const fa=utils$1.toFiniteNumber(na.headers.get("content-length")),[ca,la]=ln&&progressEventDecorator(fa,progressEventReducer(asyncDecorator(ln),!0))||[];na=new Response(trackStream(na.body,DEFAULT_CHUNK_SIZE,ca,()=>{la&&la(),ys&&ys()}),oa)}hn=hn||"text";let ra=await resolvers[utils$1.findKey(resolvers,hn)||"text"](na,qe);return!ta&&ys&&ys(),await new Promise((oa,fa)=>{settle(oa,fa,{data:ra,headers:AxiosHeaders$1.from(na.headers),status:na.status,statusText:na.statusText,config:qe,request:qn})})}catch(ea){throw ys&&ys(),ea&&ea.name==="TypeError"&&/Load failed|fetch/i.test(ea.message)?Object.assign(new AxiosError$1("Network Error",AxiosError$1.ERR_NETWORK,qe,qn),{cause:ea.cause||ea}):AxiosError$1.from(ea,ea&&ea.code,qe,qn)}}),knownAdapters={http:httpAdapter,xhr:xhrAdapter,fetch:fetchAdapter};utils$1.forEach(knownAdapters,(qe,f)=>{if(qe){try{Object.defineProperty(qe,"name",{value:f})}catch{}Object.defineProperty(qe,"adapterName",{value:f})}});const renderReason=qe=>`- ${qe}`,isResolvedHandle=qe=>utils$1.isFunction(qe)||qe===null||qe===!1,adapters={getAdapter:qe=>{qe=utils$1.isArray(qe)?qe:[qe];const{length:f}=qe;let ze,Ke;const Qe={};for(let Pi=0;Pi<f;Pi++){ze=qe[Pi];let nn;if(Ke=ze,!isResolvedHandle(ze)&&(Ke=knownAdapters[(nn=String(ze)).toLowerCase()],Ke===void 0))throw new AxiosError$1(`Unknown adapter '${nn}'`);if(Ke)break;Qe[nn||"#"+Pi]=Ke}if(!Ke){const Pi=Object.entries(Qe).map(([ln,cn])=>`adapter ${ln} `+(cn===!1?"is not supported by the environment":"is not available in the build"));let nn=f?Pi.length>1?`since :
`+Pi.map(renderReason).join(`
`):" "+renderReason(Pi[0]):"as no adapter specified";throw new AxiosError$1("There is no suitable adapter to dispatch the request "+nn,"ERR_NOT_SUPPORT")}return Ke},adapters:knownAdapters};function throwIfCancellationRequested(qe){if(qe.cancelToken&&qe.cancelToken.throwIfRequested(),qe.signal&&qe.signal.aborted)throw new CanceledError$1(null,qe)}function dispatchRequest(qe){return throwIfCancellationRequested(qe),qe.headers=AxiosHeaders$1.from(qe.headers),qe.data=transformData.call(qe,qe.transformRequest),["post","put","patch"].indexOf(qe.method)!==-1&&qe.headers.setContentType("application/x-www-form-urlencoded",!1),adapters.getAdapter(qe.adapter||defaults.adapter)(qe).then(function(Ke){return throwIfCancellationRequested(qe),Ke.data=transformData.call(qe,qe.transformResponse,Ke),Ke.headers=AxiosHeaders$1.from(Ke.headers),Ke},function(Ke){return isCancel$1(Ke)||(throwIfCancellationRequested(qe),Ke&&Ke.response&&(Ke.response.data=transformData.call(qe,qe.transformResponse,Ke.response),Ke.response.headers=AxiosHeaders$1.from(Ke.response.headers))),Promise.reject(Ke)})}const VERSION$1="1.9.0",validators$1={};["object","boolean","number","function","string","symbol"].forEach((qe,f)=>{validators$1[qe]=function(Ke){return typeof Ke===qe||"a"+(f<1?"n ":" ")+qe}});const deprecatedWarnings={};validators$1.transitional=function qe(f,ze,Ke){function Qe(Pi,nn){return"[Axios v"+VERSION$1+"] Transitional option '"+Pi+"'"+nn+(Ke?". "+Ke:"")}return(Pi,nn,ln)=>{if(f===!1)throw new AxiosError$1(Qe(nn," has been removed"+(ze?" in "+ze:"")),AxiosError$1.ERR_DEPRECATED);return ze&&!deprecatedWarnings[nn]&&(deprecatedWarnings[nn]=!0,console.warn(Qe(nn," has been deprecated since v"+ze+" and will be removed in the near future"))),f?f(Pi,nn,ln):!0}};validators$1.spelling=function qe(f){return(ze,Ke)=>(console.warn(`${Ke} is likely a misspelling of ${f}`),!0)};function assertOptions(qe,f,ze){if(typeof qe!="object")throw new AxiosError$1("options must be an object",AxiosError$1.ERR_BAD_OPTION_VALUE);const Ke=Object.keys(qe);let Qe=Ke.length;for(;Qe-- >0;){const Pi=Ke[Qe],nn=f[Pi];if(nn){const ln=qe[Pi],cn=ln===void 0||nn(ln,Pi,qe);if(cn!==!0)throw new AxiosError$1("option "+Pi+" must be "+cn,AxiosError$1.ERR_BAD_OPTION_VALUE);continue}if(ze!==!0)throw new AxiosError$1("Unknown option "+Pi,AxiosError$1.ERR_BAD_OPTION)}}const validator={assertOptions,validators:validators$1},validators=validator.validators;let Axios$1=class{constructor(f){this.defaults=f||{},this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}async request(f,ze){try{return await this._request(f,ze)}catch(Ke){if(Ke instanceof Error){let Qe={};Error.captureStackTrace?Error.captureStackTrace(Qe):Qe=new Error;const Pi=Qe.stack?Qe.stack.replace(/^.+\n/,""):"";try{Ke.stack?Pi&&!String(Ke.stack).endsWith(Pi.replace(/^.+\n.+\n/,""))&&(Ke.stack+=`
`+Pi):Ke.stack=Pi}catch{}}throw Ke}}_request(f,ze){typeof f=="string"?(ze=ze||{},ze.url=f):ze=f||{},ze=mergeConfig$1(this.defaults,ze);const{transitional:Ke,paramsSerializer:Qe,headers:Pi}=ze;Ke!==void 0&&validator.assertOptions(Ke,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1),Qe!=null&&(utils$1.isFunction(Qe)?ze.paramsSerializer={serialize:Qe}:validator.assertOptions(Qe,{encode:validators.function,serialize:validators.function},!0)),ze.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?ze.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:ze.allowAbsoluteUrls=!0),validator.assertOptions(ze,{baseUrl:validators.spelling("baseURL"),withXsrfToken:validators.spelling("withXSRFToken")},!0),ze.method=(ze.method||this.defaults.method||"get").toLowerCase();let nn=Pi&&utils$1.merge(Pi.common,Pi[ze.method]);Pi&&utils$1.forEach(["delete","get","head","post","put","patch","common"],qn=>{delete Pi[qn]}),ze.headers=AxiosHeaders$1.concat(nn,Pi);const ln=[];let cn=!0;this.interceptors.request.forEach(function(ys){typeof ys.runWhen=="function"&&ys.runWhen(ze)===!1||(cn=cn&&ys.synchronous,ln.unshift(ys.fulfilled,ys.rejected))});const hn=[];this.interceptors.response.forEach(function(ys){hn.push(ys.fulfilled,ys.rejected)});let un,zn=0,Xn;if(!cn){const qn=[dispatchRequest.bind(this),void 0];for(qn.unshift.apply(qn,ln),qn.push.apply(qn,hn),Xn=qn.length,un=Promise.resolve(ze);zn<Xn;)un=un.then(qn[zn++],qn[zn++]);return un}Xn=ln.length;let Un=ze;for(zn=0;zn<Xn;){const qn=ln[zn++],ys=ln[zn++];try{Un=qn(Un)}catch(vs){ys.call(this,vs);break}}try{un=dispatchRequest.call(this,Un)}catch(qn){return Promise.reject(qn)}for(zn=0,Xn=hn.length;zn<Xn;)un=un.then(hn[zn++],hn[zn++]);return un}getUri(f){f=mergeConfig$1(this.defaults,f);const ze=buildFullPath(f.baseURL,f.url,f.allowAbsoluteUrls);return buildURL(ze,f.params,f.paramsSerializer)}};utils$1.forEach(["delete","get","head","options"],function qe(f){Axios$1.prototype[f]=function(ze,Ke){return this.request(mergeConfig$1(Ke||{},{method:f,url:ze,data:(Ke||{}).data}))}});utils$1.forEach(["post","put","patch"],function qe(f){function ze(Ke){return function(Pi,nn,ln){return this.request(mergeConfig$1(ln||{},{method:f,headers:Ke?{"Content-Type":"multipart/form-data"}:{},url:Pi,data:nn}))}}Axios$1.prototype[f]=ze(),Axios$1.prototype[f+"Form"]=ze(!0)});let CancelToken$1=class Uc{constructor(f){if(typeof f!="function")throw new TypeError("executor must be a function.");let ze;this.promise=new Promise(function(Pi){ze=Pi});const Ke=this;this.promise.then(Qe=>{if(!Ke._listeners)return;let Pi=Ke._listeners.length;for(;Pi-- >0;)Ke._listeners[Pi](Qe);Ke._listeners=null}),this.promise.then=Qe=>{let Pi;const nn=new Promise(ln=>{Ke.subscribe(ln),Pi=ln}).then(Qe);return nn.cancel=function(){Ke.unsubscribe(Pi)},nn},f(function(Pi,nn,ln){Ke.reason||(Ke.reason=new CanceledError$1(Pi,nn,ln),ze(Ke.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(f){if(this.reason){f(this.reason);return}this._listeners?this._listeners.push(f):this._listeners=[f]}unsubscribe(f){if(!this._listeners)return;const ze=this._listeners.indexOf(f);ze!==-1&&this._listeners.splice(ze,1)}toAbortSignal(){const f=new AbortController,ze=Ke=>{f.abort(Ke)};return this.subscribe(ze),f.signal.unsubscribe=()=>this.unsubscribe(ze),f.signal}static source(){let f;return{token:new Uc(function(Qe){f=Qe}),cancel:f}}};function spread$1(qe){return function(ze){return qe.apply(null,ze)}}function isAxiosError$1(qe){return utils$1.isObject(qe)&&qe.isAxiosError===!0}const HttpStatusCode$1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(HttpStatusCode$1).forEach(([qe,f])=>{HttpStatusCode$1[f]=qe});function createInstance(qe){const f=new Axios$1(qe),ze=bind(Axios$1.prototype.request,f);return utils$1.extend(ze,Axios$1.prototype,f,{allOwnKeys:!0}),utils$1.extend(ze,f,null,{allOwnKeys:!0}),ze.create=function(Qe){return createInstance(mergeConfig$1(qe,Qe))},ze}const axios=createInstance(defaults);axios.Axios=Axios$1;axios.CanceledError=CanceledError$1;axios.CancelToken=CancelToken$1;axios.isCancel=isCancel$1;axios.VERSION=VERSION$1;axios.toFormData=toFormData$1;axios.AxiosError=AxiosError$1;axios.Cancel=axios.CanceledError;axios.all=function qe(f){return Promise.all(f)};axios.spread=spread$1;axios.isAxiosError=isAxiosError$1;axios.mergeConfig=mergeConfig$1;axios.AxiosHeaders=AxiosHeaders$1;axios.formToJSON=qe=>formDataToJSON(utils$1.isHTMLForm(qe)?new FormData(qe):qe);axios.getAdapter=adapters.getAdapter;axios.HttpStatusCode=HttpStatusCode$1;axios.default=axios;const{Axios,AxiosError,CanceledError,isCancel,CancelToken,VERSION,all,Cancel,isAxiosError,spread,toFormData,AxiosHeaders,HttpStatusCode,formToJSON,getAdapter,mergeConfig}=axios,VAlertTitle=createSimpleFunctional("v-alert-title"),allowedTypes=["success","info","warning","error"],makeVAlertProps=propsFactory({border:{type:[Boolean,String],validator:qe=>typeof qe=="boolean"||["top","end","bottom","start"].includes(qe)},borderColor:String,closable:Boolean,closeIcon:{type:IconValue,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:qe=>allowedTypes.includes(qe)},...makeComponentProps(),...makeDensityProps(),...makeDimensionProps(),...makeElevationProps(),...makeLocationProps(),...makePositionProps(),...makeRoundedProps(),...makeTagProps(),...makeThemeProps(),...makeVariantProps({variant:"flat"})},"VAlert"),VAlert=genericComponent()({name:"VAlert",props:makeVAlertProps(),emits:{"click:close":qe=>!0,"update:modelValue":qe=>!0},setup(qe,f){let{emit:ze,slots:Ke}=f;const Qe=useProxiedModel(qe,"modelValue"),Pi=toRef(()=>{if(qe.icon!==!1)return qe.type?qe.icon??`$${qe.type}`:qe.icon}),{themeClasses:nn}=provideTheme(qe),{colorClasses:ln,colorStyles:cn,variantClasses:hn}=useVariant(()=>({color:qe.color??qe.type,variant:qe.variant})),{densityClasses:un}=useDensity(qe),{dimensionStyles:zn}=useDimension(qe),{elevationClasses:Xn}=useElevation(qe),{locationStyles:Un}=useLocation(qe),{positionClasses:qn}=usePosition(qe),{roundedClasses:ys}=useRounded(qe),{textColorClasses:vs,textColorStyles:ea}=useTextColor(()=>qe.borderColor),{t:na}=useLocale(),ta=toRef(()=>({"aria-label":na(qe.closeLabel),onClick(ra){Qe.value=!1,ze("click:close",ra)}}));return()=>{const ra=!!(Ke.prepend||Pi.value),oa=!!(Ke.title||qe.title),fa=!!(Ke.close||qe.closable);return Qe.value&&createVNode(qe.tag,{class:["v-alert",qe.border&&{"v-alert--border":!!qe.border,[`v-alert--border-${qe.border===!0?"start":qe.border}`]:!0},{"v-alert--prominent":qe.prominent},nn.value,ln.value,un.value,Xn.value,qn.value,ys.value,hn.value,qe.class],style:[cn.value,zn.value,Un.value,qe.style],role:"alert"},{default:()=>{var ca,la;return[genOverlays(!1,"v-alert"),qe.border&&createVNode("div",{key:"border",class:["v-alert__border",vs.value],style:ea.value},null),ra&&createVNode("div",{key:"prepend",class:"v-alert__prepend"},[Ke.prepend?createVNode(VDefaultsProvider,{key:"prepend-defaults",disabled:!Pi.value,defaults:{VIcon:{density:qe.density,icon:Pi.value,size:qe.prominent?44:28}}},Ke.prepend):createVNode(VIcon,{key:"prepend-icon",density:qe.density,icon:Pi.value,size:qe.prominent?44:28},null)]),createVNode("div",{class:"v-alert__content"},[oa&&createVNode(VAlertTitle,{key:"title"},{default:()=>{var ua;return[((ua=Ke.title)==null?void 0:ua.call(Ke))??qe.title]}}),((ca=Ke.text)==null?void 0:ca.call(Ke))??qe.text,(la=Ke.default)==null?void 0:la.call(Ke)]),Ke.append&&createVNode("div",{key:"append",class:"v-alert__append"},[Ke.append()]),fa&&createVNode("div",{key:"close",class:"v-alert__close"},[Ke.close?createVNode(VDefaultsProvider,{key:"close-defaults",defaults:{VBtn:{icon:qe.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var ua;return[(ua=Ke.close)==null?void 0:ua.call(Ke,{props:ta.value})]}}):createVNode(VBtn,mergeProps({key:"close-btn",icon:qe.closeIcon,size:"x-small",variant:"text"},ta.value),null)])]}})}}}),makeVDividerProps=propsFactory({color:String,inset:Boolean,length:[Number,String],opacity:[Number,String],thickness:[Number,String],vertical:Boolean,...makeComponentProps(),...makeThemeProps()},"VDivider"),VDivider=genericComponent()({name:"VDivider",props:makeVDividerProps(),setup(qe,f){let{attrs:ze,slots:Ke}=f;const{themeClasses:Qe}=provideTheme(qe),{textColorClasses:Pi,textColorStyles:nn}=useTextColor(()=>qe.color),ln=computed(()=>{const cn={};return qe.length&&(cn[qe.vertical?"height":"width"]=convertToUnit(qe.length)),qe.thickness&&(cn[qe.vertical?"borderRightWidth":"borderTopWidth"]=convertToUnit(qe.thickness)),cn});return useRender(()=>{const cn=createVNode("hr",{class:[{"v-divider":!0,"v-divider--inset":qe.inset,"v-divider--vertical":qe.vertical},Qe.value,Pi.value,qe.class],style:[ln.value,nn.value,{"--v-border-opacity":qe.opacity},qe.style],"aria-orientation":!ze.role||ze.role==="separator"?qe.vertical?"vertical":"horizontal":void 0,role:`${ze.role||"separator"}`},null);return Ke.default?createVNode("div",{class:["v-divider__wrapper",{"v-divider__wrapper--vertical":qe.vertical,"v-divider__wrapper--inset":qe.inset}]},[cn,createVNode("div",{class:"v-divider__content"},[Ke.default()]),cn]):cn}),{}}}),makeVFormProps=propsFactory({...makeComponentProps(),...makeFormProps()},"VForm"),VForm=genericComponent()({name:"VForm",props:makeVFormProps(),emits:{"update:modelValue":qe=>!0,submit:qe=>!0},setup(qe,f){let{slots:ze,emit:Ke}=f;const Qe=createForm(qe),Pi=ref();function nn(cn){cn.preventDefault(),Qe.reset()}function ln(cn){const hn=cn,un=Qe.validate();hn.then=un.then.bind(un),hn.catch=un.catch.bind(un),hn.finally=un.finally.bind(un),Ke("submit",hn),hn.defaultPrevented||un.then(zn=>{var Un;let{valid:Xn}=zn;Xn&&((Un=Pi.value)==null||Un.submit())}),hn.preventDefault()}return useRender(()=>{var cn;return createVNode("form",{ref:Pi,class:["v-form",qe.class],style:qe.style,novalidate:!0,onReset:nn,onSubmit:ln},[(cn=ze.default)==null?void 0:cn.call(ze,Qe)])}),forwardRefs(Qe,Pi)}}),VSelectionControlGroupSymbol=Symbol.for("vuetify:selection-control-group"),makeSelectionControlGroupProps=propsFactory({color:String,disabled:{type:Boolean,default:null},defaultsTarget:String,error:Boolean,id:String,inline:Boolean,falseIcon:IconValue,trueIcon:IconValue,ripple:{type:[Boolean,Object],default:!0},multiple:{type:Boolean,default:null},name:String,readonly:{type:Boolean,default:null},modelValue:null,type:String,valueComparator:{type:Function,default:deepEqual},...makeComponentProps(),...makeDensityProps(),...makeThemeProps()},"SelectionControlGroup"),makeVSelectionControlGroupProps=propsFactory({...makeSelectionControlGroupProps({defaultsTarget:"VSelectionControl"})},"VSelectionControlGroup");genericComponent()({name:"VSelectionControlGroup",props:makeVSelectionControlGroupProps(),emits:{"update:modelValue":qe=>!0},setup(qe,f){let{slots:ze}=f;const Ke=useProxiedModel(qe,"modelValue"),Qe=useId(),Pi=toRef(()=>qe.id||`v-selection-control-group-${Qe}`),nn=toRef(()=>qe.name||Pi.value),ln=new Set;return provide(VSelectionControlGroupSymbol,{modelValue:Ke,forceUpdate:()=>{ln.forEach(cn=>cn())},onForceUpdate:cn=>{ln.add(cn),onScopeDispose(()=>{ln.delete(cn)})}}),provideDefaults({[qe.defaultsTarget]:{color:toRef(()=>qe.color),disabled:toRef(()=>qe.disabled),density:toRef(()=>qe.density),error:toRef(()=>qe.error),inline:toRef(()=>qe.inline),modelValue:Ke,multiple:toRef(()=>!!qe.multiple||qe.multiple==null&&Array.isArray(Ke.value)),name:nn,falseIcon:toRef(()=>qe.falseIcon),trueIcon:toRef(()=>qe.trueIcon),readonly:toRef(()=>qe.readonly),ripple:toRef(()=>qe.ripple),type:toRef(()=>qe.type),valueComparator:toRef(()=>qe.valueComparator)}}),useRender(()=>{var cn;return createVNode("div",{class:["v-selection-control-group",{"v-selection-control-group--inline":qe.inline},qe.class],style:qe.style,role:qe.type==="radio"?"radiogroup":void 0},[(cn=ze.default)==null?void 0:cn.call(ze)])}),{}}});const makeVSelectionControlProps=propsFactory({label:String,baseColor:String,trueValue:null,falseValue:null,value:null,...makeComponentProps(),...makeSelectionControlGroupProps()},"VSelectionControl");function useSelectionControl(qe){const f=inject(VSelectionControlGroupSymbol,void 0),{densityClasses:ze}=useDensity(qe),Ke=useProxiedModel(qe,"modelValue"),Qe=computed(()=>qe.trueValue!==void 0?qe.trueValue:qe.value!==void 0?qe.value:!0),Pi=computed(()=>qe.falseValue!==void 0?qe.falseValue:!1),nn=computed(()=>!!qe.multiple||qe.multiple==null&&Array.isArray(Ke.value)),ln=computed({get(){const Un=f?f.modelValue.value:Ke.value;return nn.value?wrapInArray(Un).some(qn=>qe.valueComparator(qn,Qe.value)):qe.valueComparator(Un,Qe.value)},set(Un){if(qe.readonly)return;const qn=Un?Qe.value:Pi.value;let ys=qn;nn.value&&(ys=Un?[...wrapInArray(Ke.value),qn]:wrapInArray(Ke.value).filter(vs=>!qe.valueComparator(vs,Qe.value))),f?f.modelValue.value=ys:Ke.value=ys}}),{textColorClasses:cn,textColorStyles:hn}=useTextColor(()=>{if(!(qe.error||qe.disabled))return ln.value?qe.color:qe.baseColor}),{backgroundColorClasses:un,backgroundColorStyles:zn}=useBackgroundColor(()=>ln.value&&!qe.error&&!qe.disabled?qe.color:qe.baseColor),Xn=computed(()=>ln.value?qe.trueIcon:qe.falseIcon);return{group:f,densityClasses:ze,trueValue:Qe,falseValue:Pi,model:ln,textColorClasses:cn,textColorStyles:hn,backgroundColorClasses:un,backgroundColorStyles:zn,icon:Xn}}const VSelectionControl=genericComponent()({name:"VSelectionControl",directives:{Ripple},inheritAttrs:!1,props:makeVSelectionControlProps(),emits:{"update:modelValue":qe=>!0},setup(qe,f){let{attrs:ze,slots:Ke}=f;const{group:Qe,densityClasses:Pi,icon:nn,model:ln,textColorClasses:cn,textColorStyles:hn,backgroundColorClasses:un,backgroundColorStyles:zn,trueValue:Xn}=useSelectionControl(qe),Un=useId(),qn=shallowRef(!1),ys=shallowRef(!1),vs=ref(),ea=toRef(()=>qe.id||`input-${Un}`),na=toRef(()=>!qe.disabled&&!qe.readonly);Qe==null||Qe.onForceUpdate(()=>{vs.value&&(vs.value.checked=ln.value)});function ta(ca){na.value&&(qn.value=!0,matchesSelector(ca.target,":focus-visible")!==!1&&(ys.value=!0))}function ra(){qn.value=!1,ys.value=!1}function oa(ca){ca.stopPropagation()}function fa(ca){if(!na.value){vs.value&&(vs.value.checked=ln.value);return}qe.readonly&&Qe&&nextTick(()=>Qe.forceUpdate()),ln.value=ca.target.checked}return useRender(()=>{var da,qa;const ca=Ke.label?Ke.label({label:qe.label,props:{for:ea.value}}):qe.label,[la,ua]=filterInputAttrs(ze),ga=createVNode("input",mergeProps({ref:vs,checked:ln.value,disabled:!!qe.disabled,id:ea.value,onBlur:ra,onFocus:ta,onInput:fa,"aria-disabled":!!qe.disabled,"aria-label":qe.label,type:qe.type,value:Xn.value,name:qe.name,"aria-checked":qe.type==="checkbox"?ln.value:void 0},ua),null);return createVNode("div",mergeProps({class:["v-selection-control",{"v-selection-control--dirty":ln.value,"v-selection-control--disabled":qe.disabled,"v-selection-control--error":qe.error,"v-selection-control--focused":qn.value,"v-selection-control--focus-visible":ys.value,"v-selection-control--inline":qe.inline},Pi.value,qe.class]},la,{style:qe.style}),[createVNode("div",{class:["v-selection-control__wrapper",cn.value],style:hn.value},[(da=Ke.default)==null?void 0:da.call(Ke,{backgroundColorClasses:un,backgroundColorStyles:zn}),withDirectives(createVNode("div",{class:["v-selection-control__input"]},[((qa=Ke.input)==null?void 0:qa.call(Ke,{model:ln,textColorClasses:cn,textColorStyles:hn,backgroundColorClasses:un,backgroundColorStyles:zn,inputNode:ga,icon:nn.value,props:{onFocus:ta,onBlur:ra,id:ea.value}}))??createVNode(Fragment,null,[nn.value&&createVNode(VIcon,{key:"icon",icon:nn.value},null),ga])]),[[resolveDirective("ripple"),qe.ripple&&[!qe.disabled&&!qe.readonly,null,["center","circle"]]]])]),ca&&createVNode(VLabel,{for:ea.value,onClick:oa},{default:()=>[ca]})])}),{isFocused:qn,input:vs}}}),makeVCheckboxBtnProps=propsFactory({indeterminate:Boolean,indeterminateIcon:{type:IconValue,default:"$checkboxIndeterminate"},...makeVSelectionControlProps({falseIcon:"$checkboxOff",trueIcon:"$checkboxOn"})},"VCheckboxBtn"),VCheckboxBtn=genericComponent()({name:"VCheckboxBtn",props:makeVCheckboxBtnProps(),emits:{"update:modelValue":qe=>!0,"update:indeterminate":qe=>!0},setup(qe,f){let{slots:ze}=f;const Ke=useProxiedModel(qe,"indeterminate"),Qe=useProxiedModel(qe,"modelValue");function Pi(cn){Ke.value&&(Ke.value=!1)}const nn=toRef(()=>Ke.value?qe.indeterminateIcon:qe.falseIcon),ln=toRef(()=>Ke.value?qe.indeterminateIcon:qe.trueIcon);return useRender(()=>{const cn=omit(VSelectionControl.filterProps(qe),["modelValue"]);return createVNode(VSelectionControl,mergeProps(cn,{modelValue:Qe.value,"onUpdate:modelValue":[hn=>Qe.value=hn,Pi],class:["v-checkbox-btn",qe.class],style:qe.style,type:"checkbox",falseIcon:nn.value,trueIcon:ln.value,"aria-checked":Ke.value?"mixed":void 0}),ze)}),{}}}),ListKey=Symbol.for("vuetify:list");function createList(){const qe=inject(ListKey,{hasPrepend:shallowRef(!1),updateHasPrepend:()=>null}),f={hasPrepend:shallowRef(!1),updateHasPrepend:ze=>{ze&&(f.hasPrepend.value=ze)}};return provide(ListKey,f),qe}function useList(){return inject(ListKey,null)}const independentActiveStrategy=qe=>{const f={activate:ze=>{let{id:Ke,value:Qe,activated:Pi}=ze;return Ke=toRaw(Ke),qe&&!Qe&&Pi.size===1&&Pi.has(Ke)||(Qe?Pi.add(Ke):Pi.delete(Ke)),Pi},in:(ze,Ke,Qe)=>{let Pi=new Set;if(ze!=null)for(const nn of wrapInArray(ze))Pi=f.activate({id:nn,value:!0,activated:new Set(Pi),children:Ke,parents:Qe});return Pi},out:ze=>Array.from(ze)};return f},independentSingleActiveStrategy=qe=>{const f=independentActiveStrategy(qe);return{activate:Ke=>{let{activated:Qe,id:Pi,...nn}=Ke;Pi=toRaw(Pi);const ln=Qe.has(Pi)?new Set([Pi]):new Set;return f.activate({...nn,id:Pi,activated:ln})},in:(Ke,Qe,Pi)=>{let nn=new Set;if(Ke!=null){const ln=wrapInArray(Ke);ln.length&&(nn=f.in(ln.slice(0,1),Qe,Pi))}return nn},out:(Ke,Qe,Pi)=>f.out(Ke,Qe,Pi)}},leafActiveStrategy=qe=>{const f=independentActiveStrategy(qe);return{activate:Ke=>{let{id:Qe,activated:Pi,children:nn,...ln}=Ke;return Qe=toRaw(Qe),nn.has(Qe)?Pi:f.activate({id:Qe,activated:Pi,children:nn,...ln})},in:f.in,out:f.out}},leafSingleActiveStrategy=qe=>{const f=independentSingleActiveStrategy(qe);return{activate:Ke=>{let{id:Qe,activated:Pi,children:nn,...ln}=Ke;return Qe=toRaw(Qe),nn.has(Qe)?Pi:f.activate({id:Qe,activated:Pi,children:nn,...ln})},in:f.in,out:f.out}},singleOpenStrategy={open:qe=>{let{id:f,value:ze,opened:Ke,parents:Qe}=qe;if(ze){const Pi=new Set;Pi.add(f);let nn=Qe.get(f);for(;nn!=null;)Pi.add(nn),nn=Qe.get(nn);return Pi}else return Ke.delete(f),Ke},select:()=>null},multipleOpenStrategy={open:qe=>{let{id:f,value:ze,opened:Ke,parents:Qe}=qe;if(ze){let Pi=Qe.get(f);for(Ke.add(f);Pi!=null&&Pi!==f;)Ke.add(Pi),Pi=Qe.get(Pi);return Ke}else Ke.delete(f);return Ke},select:()=>null},listOpenStrategy={open:multipleOpenStrategy.open,select:qe=>{let{id:f,value:ze,opened:Ke,parents:Qe}=qe;if(!ze)return Ke;const Pi=[];let nn=Qe.get(f);for(;nn!=null;)Pi.push(nn),nn=Qe.get(nn);return new Set(Pi)}},independentSelectStrategy=qe=>{const f={select:ze=>{let{id:Ke,value:Qe,selected:Pi}=ze;if(Ke=toRaw(Ke),qe&&!Qe){const nn=Array.from(Pi.entries()).reduce((ln,cn)=>{let[hn,un]=cn;return un==="on"&&ln.push(hn),ln},[]);if(nn.length===1&&nn[0]===Ke)return Pi}return Pi.set(Ke,Qe?"on":"off"),Pi},in:(ze,Ke,Qe)=>{const Pi=new Map;for(const nn of ze||[])f.select({id:nn,value:!0,selected:Pi,children:Ke,parents:Qe});return Pi},out:ze=>{const Ke=[];for(const[Qe,Pi]of ze.entries())Pi==="on"&&Ke.push(Qe);return Ke}};return f},independentSingleSelectStrategy=qe=>{const f=independentSelectStrategy(qe);return{select:Ke=>{let{selected:Qe,id:Pi,...nn}=Ke;Pi=toRaw(Pi);const ln=Qe.has(Pi)?new Map([[Pi,Qe.get(Pi)]]):new Map;return f.select({...nn,id:Pi,selected:ln})},in:(Ke,Qe,Pi)=>Ke!=null&&Ke.length?f.in(Ke.slice(0,1),Qe,Pi):new Map,out:(Ke,Qe,Pi)=>f.out(Ke,Qe,Pi)}},leafSelectStrategy=qe=>{const f=independentSelectStrategy(qe);return{select:Ke=>{let{id:Qe,selected:Pi,children:nn,...ln}=Ke;return Qe=toRaw(Qe),nn.has(Qe)?Pi:f.select({id:Qe,selected:Pi,children:nn,...ln})},in:f.in,out:f.out}},leafSingleSelectStrategy=qe=>{const f=independentSingleSelectStrategy(qe);return{select:Ke=>{let{id:Qe,selected:Pi,children:nn,...ln}=Ke;return Qe=toRaw(Qe),nn.has(Qe)?Pi:f.select({id:Qe,selected:Pi,children:nn,...ln})},in:f.in,out:f.out}},classicSelectStrategy=qe=>{const f={select:ze=>{let{id:Ke,value:Qe,selected:Pi,children:nn,parents:ln}=ze;Ke=toRaw(Ke);const cn=new Map(Pi),hn=[Ke];for(;hn.length;){const zn=hn.shift();Pi.set(toRaw(zn),Qe?"on":"off"),nn.has(zn)&&hn.push(...nn.get(zn))}let un=toRaw(ln.get(Ke));for(;un;){const zn=nn.get(un),Xn=zn.every(qn=>Pi.get(toRaw(qn))==="on"),Un=zn.every(qn=>!Pi.has(toRaw(qn))||Pi.get(toRaw(qn))==="off");Pi.set(un,Xn?"on":Un?"off":"indeterminate"),un=toRaw(ln.get(un))}return qe&&!Qe&&Array.from(Pi.entries()).reduce((Xn,Un)=>{let[qn,ys]=Un;return ys==="on"&&Xn.push(qn),Xn},[]).length===0?cn:Pi},in:(ze,Ke,Qe)=>{let Pi=new Map;for(const nn of ze||[])Pi=f.select({id:nn,value:!0,selected:Pi,children:Ke,parents:Qe});return Pi},out:(ze,Ke)=>{const Qe=[];for(const[Pi,nn]of ze.entries())nn==="on"&&!Ke.has(Pi)&&Qe.push(Pi);return Qe}};return f},trunkSelectStrategy=qe=>{const f=classicSelectStrategy(qe);return{select:f.select,in:f.in,out:(Ke,Qe,Pi)=>{const nn=[];for(const[ln,cn]of Ke.entries())if(cn==="on"){if(Pi.has(ln)){const hn=Pi.get(ln);if(Ke.get(hn)==="on")continue}nn.push(ln)}return nn}}},VNestedSymbol=Symbol.for("vuetify:nested"),emptyNested={id:shallowRef(),root:{register:()=>null,unregister:()=>null,parents:ref(new Map),children:ref(new Map),open:()=>null,openOnSelect:()=>null,activate:()=>null,select:()=>null,activatable:ref(!1),selectable:ref(!1),opened:ref(new Set),activated:ref(new Set),selected:ref(new Map),selectedValues:ref([]),getPath:()=>[]}},makeNestedProps=propsFactory({activatable:Boolean,selectable:Boolean,activeStrategy:[String,Function,Object],selectStrategy:[String,Function,Object],openStrategy:[String,Object],opened:null,activated:null,selected:null,mandatory:Boolean},"nested"),useNested=qe=>{let f=!1;const ze=ref(new Map),Ke=ref(new Map),Qe=useProxiedModel(qe,"opened",qe.opened,qn=>new Set(qn),qn=>[...qn.values()]),Pi=computed(()=>{if(typeof qe.activeStrategy=="object")return qe.activeStrategy;if(typeof qe.activeStrategy=="function")return qe.activeStrategy(qe.mandatory);switch(qe.activeStrategy){case"leaf":return leafActiveStrategy(qe.mandatory);case"single-leaf":return leafSingleActiveStrategy(qe.mandatory);case"independent":return independentActiveStrategy(qe.mandatory);case"single-independent":default:return independentSingleActiveStrategy(qe.mandatory)}}),nn=computed(()=>{if(typeof qe.selectStrategy=="object")return qe.selectStrategy;if(typeof qe.selectStrategy=="function")return qe.selectStrategy(qe.mandatory);switch(qe.selectStrategy){case"single-leaf":return leafSingleSelectStrategy(qe.mandatory);case"leaf":return leafSelectStrategy(qe.mandatory);case"independent":return independentSelectStrategy(qe.mandatory);case"single-independent":return independentSingleSelectStrategy(qe.mandatory);case"trunk":return trunkSelectStrategy(qe.mandatory);case"classic":default:return classicSelectStrategy(qe.mandatory)}}),ln=computed(()=>{if(typeof qe.openStrategy=="object")return qe.openStrategy;switch(qe.openStrategy){case"list":return listOpenStrategy;case"single":return singleOpenStrategy;case"multiple":default:return multipleOpenStrategy}}),cn=useProxiedModel(qe,"activated",qe.activated,qn=>Pi.value.in(qn,ze.value,Ke.value),qn=>Pi.value.out(qn,ze.value,Ke.value)),hn=useProxiedModel(qe,"selected",qe.selected,qn=>nn.value.in(qn,ze.value,Ke.value),qn=>nn.value.out(qn,ze.value,Ke.value));onBeforeUnmount(()=>{f=!0});function un(qn){const ys=[];let vs=qn;for(;vs!=null;)ys.unshift(vs),vs=Ke.value.get(vs);return ys}const zn=getCurrentInstance("nested"),Xn=new Set,Un={id:shallowRef(),root:{opened:Qe,activatable:toRef(()=>qe.activatable),selectable:toRef(()=>qe.selectable),activated:cn,selected:hn,selectedValues:computed(()=>{const qn=[];for(const[ys,vs]of hn.value.entries())vs==="on"&&qn.push(ys);return qn}),register:(qn,ys,vs)=>{if(Xn.has(qn)){un(qn).map(String).join(" -> "),un(ys).concat(qn).map(String).join(" -> ");return}else Xn.add(qn);ys&&qn!==ys&&Ke.value.set(qn,ys),vs&&ze.value.set(qn,[]),ys!=null&&ze.value.set(ys,[...ze.value.get(ys)||[],qn])},unregister:qn=>{if(f)return;Xn.delete(qn),ze.value.delete(qn);const ys=Ke.value.get(qn);if(ys){const vs=ze.value.get(ys)??[];ze.value.set(ys,vs.filter(ea=>ea!==qn))}Ke.value.delete(qn)},open:(qn,ys,vs)=>{zn.emit("click:open",{id:qn,value:ys,path:un(qn),event:vs});const ea=ln.value.open({id:qn,value:ys,opened:new Set(Qe.value),children:ze.value,parents:Ke.value,event:vs});ea&&(Qe.value=ea)},openOnSelect:(qn,ys,vs)=>{const ea=ln.value.select({id:qn,value:ys,selected:new Map(hn.value),opened:new Set(Qe.value),children:ze.value,parents:Ke.value,event:vs});ea&&(Qe.value=ea)},select:(qn,ys,vs)=>{zn.emit("click:select",{id:qn,value:ys,path:un(qn),event:vs});const ea=nn.value.select({id:qn,value:ys,selected:new Map(hn.value),children:ze.value,parents:Ke.value,event:vs});ea&&(hn.value=ea),Un.root.openOnSelect(qn,ys,vs)},activate:(qn,ys,vs)=>{if(!qe.activatable)return Un.root.select(qn,!0,vs);zn.emit("click:activate",{id:qn,value:ys,path:un(qn),event:vs});const ea=Pi.value.activate({id:qn,value:ys,activated:new Set(cn.value),children:ze.value,parents:Ke.value,event:vs});if(ea.size!==cn.value.size)cn.value=ea;else{for(const na of ea)if(!cn.value.has(na)){cn.value=ea;return}for(const na of cn.value)if(!ea.has(na)){cn.value=ea;return}}},children:ze,parents:Ke,getPath:un}};return provide(VNestedSymbol,Un),Un.root},useNestedItem=(qe,f)=>{const ze=inject(VNestedSymbol,emptyNested),Ke=Symbol("nested item"),Qe=computed(()=>toValue(qe)??Ke),Pi={...ze,id:Qe,open:(nn,ln)=>ze.root.open(Qe.value,nn,ln),openOnSelect:(nn,ln)=>ze.root.openOnSelect(Qe.value,nn,ln),isOpen:computed(()=>ze.root.opened.value.has(Qe.value)),parent:computed(()=>ze.root.parents.value.get(Qe.value)),activate:(nn,ln)=>ze.root.activate(Qe.value,nn,ln),isActivated:computed(()=>ze.root.activated.value.has(toRaw(Qe.value))),select:(nn,ln)=>ze.root.select(Qe.value,nn,ln),isSelected:computed(()=>ze.root.selected.value.get(toRaw(Qe.value))==="on"),isIndeterminate:computed(()=>ze.root.selected.value.get(toRaw(Qe.value))==="indeterminate"),isLeaf:computed(()=>!ze.root.children.value.get(Qe.value)),isGroupActivator:ze.isGroupActivator};return onBeforeMount(()=>{!ze.isGroupActivator&&ze.root.register(Qe.value,ze.id.value,f)}),onBeforeUnmount(()=>{!ze.isGroupActivator&&ze.root.unregister(Qe.value)}),f&&provide(VNestedSymbol,Pi),Pi},useNestedGroupActivator=()=>{const qe=inject(VNestedSymbol,emptyNested);provide(VNestedSymbol,{...qe,isGroupActivator:!0})},VListGroupActivator=defineComponent$1({name:"VListGroupActivator",setup(qe,f){let{slots:ze}=f;return useNestedGroupActivator(),()=>{var Ke;return(Ke=ze.default)==null?void 0:Ke.call(ze)}}}),makeVListGroupProps=propsFactory({activeColor:String,baseColor:String,color:String,collapseIcon:{type:IconValue,default:"$collapse"},expandIcon:{type:IconValue,default:"$expand"},prependIcon:IconValue,appendIcon:IconValue,fluid:Boolean,subgroup:Boolean,title:String,value:null,...makeComponentProps(),...makeTagProps()},"VListGroup"),VListGroup=genericComponent()({name:"VListGroup",props:makeVListGroupProps(),setup(qe,f){let{slots:ze}=f;const{isOpen:Ke,open:Qe,id:Pi}=useNestedItem(()=>qe.value,!0),nn=computed(()=>`v-list-group--id-${String(Pi.value)}`),ln=useList(),{isBooted:cn}=useSsrBoot();function hn(Un){var qn;Un.stopPropagation(),!["INPUT","TEXTAREA"].includes((qn=Un.target)==null?void 0:qn.tagName)&&Qe(!Ke.value,Un)}const un=computed(()=>({onClick:hn,class:"v-list-group__header",id:nn.value})),zn=computed(()=>Ke.value?qe.collapseIcon:qe.expandIcon),Xn=computed(()=>({VListItem:{active:Ke.value,activeColor:qe.activeColor,baseColor:qe.baseColor,color:qe.color,prependIcon:qe.prependIcon||qe.subgroup&&zn.value,appendIcon:qe.appendIcon||!qe.subgroup&&zn.value,title:qe.title,value:qe.value}}));return useRender(()=>createVNode(qe.tag,{class:["v-list-group",{"v-list-group--prepend":ln==null?void 0:ln.hasPrepend.value,"v-list-group--fluid":qe.fluid,"v-list-group--subgroup":qe.subgroup,"v-list-group--open":Ke.value},qe.class],style:qe.style},{default:()=>[ze.activator&&createVNode(VDefaultsProvider,{defaults:Xn.value},{default:()=>[createVNode(VListGroupActivator,null,{default:()=>[ze.activator({props:un.value,isOpen:Ke.value})]})]}),createVNode(MaybeTransition,{transition:{component:VExpandTransition},disabled:!cn.value},{default:()=>{var Un;return[withDirectives(createVNode("div",{class:"v-list-group__items",role:"group","aria-labelledby":nn.value},[(Un=ze.default)==null?void 0:Un.call(ze)]),[[vShow,Ke.value]])]}})]})),{isOpen:Ke}}}),makeVListItemSubtitleProps=propsFactory({opacity:[Number,String],...makeComponentProps(),...makeTagProps()},"VListItemSubtitle"),VListItemSubtitle=genericComponent()({name:"VListItemSubtitle",props:makeVListItemSubtitleProps(),setup(qe,f){let{slots:ze}=f;return useRender(()=>createVNode(qe.tag,{class:["v-list-item-subtitle",qe.class],style:[{"--v-list-item-subtitle-opacity":qe.opacity},qe.style]},ze)),{}}}),VListItemTitle=createSimpleFunctional("v-list-item-title"),makeVListItemProps=propsFactory({active:{type:Boolean,default:void 0},activeClass:String,activeColor:String,appendAvatar:String,appendIcon:IconValue,baseColor:String,disabled:Boolean,lines:[Boolean,String],link:{type:Boolean,default:void 0},nav:Boolean,prependAvatar:String,prependIcon:IconValue,ripple:{type:[Boolean,Object],default:!0},slim:Boolean,subtitle:{type:[String,Number,Boolean],default:void 0},title:{type:[String,Number,Boolean],default:void 0},value:null,onClick:EventProp(),onClickOnce:EventProp(),...makeBorderProps(),...makeComponentProps(),...makeDensityProps(),...makeDimensionProps(),...makeElevationProps(),...makeRoundedProps(),...makeRouterProps(),...makeTagProps(),...makeThemeProps(),...makeVariantProps({variant:"text"})},"VListItem"),VListItem=genericComponent()({name:"VListItem",directives:{Ripple},props:makeVListItemProps(),emits:{click:qe=>!0},setup(qe,f){let{attrs:ze,slots:Ke,emit:Qe}=f;const Pi=useLink(qe,ze),nn=computed(()=>qe.value===void 0?Pi.href.value:qe.value),{activate:ln,isActivated:cn,select:hn,isOpen:un,isSelected:zn,isIndeterminate:Xn,isGroupActivator:Un,root:qn,parent:ys,openOnSelect:vs,id:ea}=useNestedItem(nn,!1),na=useList(),ta=computed(()=>{var xl;return qe.active!==!1&&(qe.active||((xl=Pi.isActive)==null?void 0:xl.value)||(qn.activatable.value?cn.value:zn.value))}),ra=toRef(()=>qe.link!==!1&&Pi.isLink.value),oa=computed(()=>!!na&&(qn.selectable.value||qn.activatable.value||qe.value!=null)),fa=computed(()=>!qe.disabled&&qe.link!==!1&&(qe.link||Pi.isClickable.value||oa.value)),ca=toRef(()=>qe.rounded||qe.nav),la=toRef(()=>qe.color??qe.activeColor),ua=toRef(()=>({color:ta.value?la.value??qe.baseColor:qe.baseColor,variant:qe.variant}));watch(()=>{var xl;return(xl=Pi.isActive)==null?void 0:xl.value},xl=>{xl&&ga()}),onBeforeMount(()=>{var xl;(xl=Pi.isActive)!=null&&xl.value&&ga()});function ga(){ys.value!=null&&qn.open(ys.value,!0),vs(!0)}const{themeClasses:da}=provideTheme(qe),{borderClasses:qa}=useBorder(qe),{colorClasses:tl,colorStyles:ol,variantClasses:hl}=useVariant(ua),{densityClasses:wl}=useDensity(qe),{dimensionStyles:_l}=useDimension(qe),{elevationClasses:gl}=useElevation(qe),{roundedClasses:dl}=useRounded(ca),sl=toRef(()=>qe.lines?`v-list-item--${qe.lines}-line`:void 0),kl=computed(()=>({isActive:ta.value,select:hn,isOpen:un.value,isSelected:zn.value,isIndeterminate:Xn.value}));function pl(xl){var al,Fl;Qe("click",xl),!["INPUT","TEXTAREA"].includes((al=xl.target)==null?void 0:al.tagName)&&fa.value&&((Fl=Pi.navigate)==null||Fl.call(Pi,xl),!Un&&(qn.activatable.value?ln(!cn.value,xl):(qn.selectable.value||qe.value!=null)&&hn(!zn.value,xl)))}function Al(xl){const al=xl.target;["INPUT","TEXTAREA"].includes(al.tagName)||(xl.key==="Enter"||xl.key===" ")&&(xl.preventDefault(),xl.target.dispatchEvent(new MouseEvent("click",xl)))}return useRender(()=>{const xl=ra.value?"a":qe.tag,al=Ke.title||qe.title!=null,Fl=Ke.subtitle||qe.subtitle!=null,Ol=!!(qe.appendAvatar||qe.appendIcon),Jo=!!(Ol||Ke.append),cl=!!(qe.prependAvatar||qe.prependIcon),rl=!!(cl||Ke.prepend);return na==null||na.updateHasPrepend(rl),qe.activeColor&&deprecate("active-color",["color","base-color"]),withDirectives(createVNode(xl,mergeProps({class:["v-list-item",{"v-list-item--active":ta.value,"v-list-item--disabled":qe.disabled,"v-list-item--link":fa.value,"v-list-item--nav":qe.nav,"v-list-item--prepend":!rl&&(na==null?void 0:na.hasPrepend.value),"v-list-item--slim":qe.slim,[`${qe.activeClass}`]:qe.activeClass&&ta.value},da.value,qa.value,tl.value,wl.value,gl.value,sl.value,dl.value,hl.value,qe.class],style:[ol.value,_l.value,qe.style],tabindex:fa.value?na?-2:0:void 0,"aria-selected":oa.value?qn.activatable.value?cn.value:qn.selectable.value?zn.value:ta.value:void 0,onClick:pl,onKeydown:fa.value&&!ra.value&&Al},Pi.linkProps),{default:()=>{var nl;return[genOverlays(fa.value||ta.value,"v-list-item"),rl&&createVNode("div",{key:"prepend",class:"v-list-item__prepend"},[Ke.prepend?createVNode(VDefaultsProvider,{key:"prepend-defaults",disabled:!cl,defaults:{VAvatar:{density:qe.density,image:qe.prependAvatar},VIcon:{density:qe.density,icon:qe.prependIcon},VListItemAction:{start:!0}}},{default:()=>{var vl;return[(vl=Ke.prepend)==null?void 0:vl.call(Ke,kl.value)]}}):createVNode(Fragment,null,[qe.prependAvatar&&createVNode(VAvatar,{key:"prepend-avatar",density:qe.density,image:qe.prependAvatar},null),qe.prependIcon&&createVNode(VIcon,{key:"prepend-icon",density:qe.density,icon:qe.prependIcon},null)]),createVNode("div",{class:"v-list-item__spacer"},null)]),createVNode("div",{class:"v-list-item__content","data-no-activator":""},[al&&createVNode(VListItemTitle,{key:"title"},{default:()=>{var vl;return[((vl=Ke.title)==null?void 0:vl.call(Ke,{title:qe.title}))??toDisplayString(qe.title)]}}),Fl&&createVNode(VListItemSubtitle,{key:"subtitle"},{default:()=>{var vl;return[((vl=Ke.subtitle)==null?void 0:vl.call(Ke,{subtitle:qe.subtitle}))??toDisplayString(qe.subtitle)]}}),(nl=Ke.default)==null?void 0:nl.call(Ke,kl.value)]),Jo&&createVNode("div",{key:"append",class:"v-list-item__append"},[Ke.append?createVNode(VDefaultsProvider,{key:"append-defaults",disabled:!Ol,defaults:{VAvatar:{density:qe.density,image:qe.appendAvatar},VIcon:{density:qe.density,icon:qe.appendIcon},VListItemAction:{end:!0}}},{default:()=>{var vl;return[(vl=Ke.append)==null?void 0:vl.call(Ke,kl.value)]}}):createVNode(Fragment,null,[qe.appendIcon&&createVNode(VIcon,{key:"append-icon",density:qe.density,icon:qe.appendIcon},null),qe.appendAvatar&&createVNode(VAvatar,{key:"append-avatar",density:qe.density,image:qe.appendAvatar},null)]),createVNode("div",{class:"v-list-item__spacer"},null)])]}}),[[resolveDirective("ripple"),fa.value&&qe.ripple]])}),{activate:ln,isActivated:cn,isGroupActivator:Un,isSelected:zn,list:na,select:hn,root:qn,id:ea,link:Pi}}}),makeVListSubheaderProps=propsFactory({color:String,inset:Boolean,sticky:Boolean,title:String,...makeComponentProps(),...makeTagProps()},"VListSubheader"),VListSubheader=genericComponent()({name:"VListSubheader",props:makeVListSubheaderProps(),setup(qe,f){let{slots:ze}=f;const{textColorClasses:Ke,textColorStyles:Qe}=useTextColor(()=>qe.color);return useRender(()=>{const Pi=!!(ze.default||qe.title);return createVNode(qe.tag,{class:["v-list-subheader",{"v-list-subheader--inset":qe.inset,"v-list-subheader--sticky":qe.sticky},Ke.value,qe.class],style:[{textColorStyles:Qe},qe.style]},{default:()=>{var nn;return[Pi&&createVNode("div",{class:"v-list-subheader__text"},[((nn=ze.default)==null?void 0:nn.call(ze))??qe.title])]}})}),{}}}),makeVListChildrenProps=propsFactory({items:Array,returnObject:Boolean},"VListChildren"),VListChildren=genericComponent()({name:"VListChildren",props:makeVListChildrenProps(),setup(qe,f){let{slots:ze}=f;return createList(),()=>{var Ke,Qe;return((Ke=ze.default)==null?void 0:Ke.call(ze))??((Qe=qe.items)==null?void 0:Qe.map(Pi=>{var Xn,Un;let{children:nn,props:ln,type:cn,raw:hn}=Pi;if(cn==="divider")return((Xn=ze.divider)==null?void 0:Xn.call(ze,{props:ln}))??createVNode(VDivider,ln,null);if(cn==="subheader")return((Un=ze.subheader)==null?void 0:Un.call(ze,{props:ln}))??createVNode(VListSubheader,ln,null);const un={subtitle:ze.subtitle?qn=>{var ys;return(ys=ze.subtitle)==null?void 0:ys.call(ze,{...qn,item:hn})}:void 0,prepend:ze.prepend?qn=>{var ys;return(ys=ze.prepend)==null?void 0:ys.call(ze,{...qn,item:hn})}:void 0,append:ze.append?qn=>{var ys;return(ys=ze.append)==null?void 0:ys.call(ze,{...qn,item:hn})}:void 0,title:ze.title?qn=>{var ys;return(ys=ze.title)==null?void 0:ys.call(ze,{...qn,item:hn})}:void 0},zn=VListGroup.filterProps(ln);return nn?createVNode(VListGroup,mergeProps({value:ln==null?void 0:ln.value},zn),{activator:qn=>{let{props:ys}=qn;const vs={...ln,...ys,value:qe.returnObject?hn:ln.value};return ze.header?ze.header({props:vs}):createVNode(VListItem,vs,un)},default:()=>createVNode(VListChildren,{items:nn,returnObject:qe.returnObject},ze)}):ze.item?ze.item({props:ln}):createVNode(VListItem,mergeProps(ln,{value:qe.returnObject?hn:ln.value}),un)}))}}}),makeItemsProps=propsFactory({items:{type:Array,default:()=>[]},itemTitle:{type:[String,Array,Function],default:"title"},itemValue:{type:[String,Array,Function],default:"value"},itemChildren:{type:[Boolean,String,Array,Function],default:"children"},itemProps:{type:[Boolean,String,Array,Function],default:"props"},returnObject:Boolean,valueComparator:Function},"list-items");function transformItem$1(qe,f){const ze=getPropertyFromItem(f,qe.itemTitle,f),Ke=getPropertyFromItem(f,qe.itemValue,ze),Qe=getPropertyFromItem(f,qe.itemChildren),Pi=qe.itemProps===!0?typeof f=="object"&&f!=null&&!Array.isArray(f)?"children"in f?omit(f,["children"]):f:void 0:getPropertyFromItem(f,qe.itemProps),nn={title:ze,value:Ke,...Pi};return{title:String(nn.title??""),value:nn.value,props:nn,children:Array.isArray(Qe)?transformItems$1(qe,Qe):void 0,raw:f}}function transformItems$1(qe,f){const ze=pick(qe,["itemTitle","itemValue","itemChildren","itemProps","returnObject","valueComparator"]),Ke=[];for(const Qe of f)Ke.push(transformItem$1(ze,Qe));return Ke}function useItems(qe){const f=computed(()=>transformItems$1(qe,qe.items)),ze=computed(()=>f.value.some(ln=>ln.value===null)),Ke=shallowRef(new Map),Qe=shallowRef([]);watchEffect(()=>{const ln=f.value,cn=new Map,hn=[];for(let un=0;un<ln.length;un++){const zn=ln[un];if(isPrimitive(zn.value)||zn.value===null){let Xn=cn.get(zn.value);Xn||(Xn=[],cn.set(zn.value,Xn)),Xn.push(zn)}else hn.push(zn)}Ke.value=cn,Qe.value=hn});function Pi(ln){const cn=Ke.value,hn=f.value,un=Qe.value,zn=ze.value,Xn=qe.returnObject,Un=!!qe.valueComparator,qn=qe.valueComparator||deepEqual,ys=pick(qe,["itemTitle","itemValue","itemChildren","itemProps","returnObject","valueComparator"]),vs=[];e:for(const ea of ln){if(!zn&&ea===null)continue;if(Xn&&typeof ea=="string"){vs.push(transformItem$1(ys,ea));continue}const na=cn.get(ea);if(Un||!na){for(const ta of Un?hn:un)if(qn(ea,ta.value)){vs.push(ta);continue e}vs.push(transformItem$1(ys,ea));continue}vs.push(...na)}return vs}function nn(ln){return qe.returnObject?ln.map(cn=>{let{raw:hn}=cn;return hn}):ln.map(cn=>{let{value:hn}=cn;return hn})}return{items:f,transformIn:Pi,transformOut:nn}}function transformItem(qe,f){const ze=getPropertyFromItem(f,qe.itemType,"item"),Ke=isPrimitive(f)?f:getPropertyFromItem(f,qe.itemTitle),Qe=getPropertyFromItem(f,qe.itemValue,void 0),Pi=getPropertyFromItem(f,qe.itemChildren),nn=qe.itemProps===!0?omit(f,["children"]):getPropertyFromItem(f,qe.itemProps),ln={title:Ke,value:Qe,...nn};return{type:ze,title:ln.title,value:ln.value,props:ln,children:ze==="item"&&Pi?transformItems(qe,Pi):void 0,raw:f}}function transformItems(qe,f){const ze=[];for(const Ke of f)ze.push(transformItem(qe,Ke));return ze}function useListItems(qe){return{items:computed(()=>transformItems(qe,qe.items))}}const makeVListProps=propsFactory({baseColor:String,activeColor:String,activeClass:String,bgColor:String,disabled:Boolean,expandIcon:IconValue,collapseIcon:IconValue,lines:{type:[Boolean,String],default:"one"},slim:Boolean,nav:Boolean,"onClick:open":EventProp(),"onClick:select":EventProp(),"onUpdate:opened":EventProp(),...makeNestedProps({selectStrategy:"single-leaf",openStrategy:"list"}),...makeBorderProps(),...makeComponentProps(),...makeDensityProps(),...makeDimensionProps(),...makeElevationProps(),itemType:{type:String,default:"type"},...makeItemsProps(),...makeRoundedProps(),...makeTagProps(),...makeThemeProps(),...makeVariantProps({variant:"text"})},"VList"),VList=genericComponent()({name:"VList",props:makeVListProps(),emits:{"update:selected":qe=>!0,"update:activated":qe=>!0,"update:opened":qe=>!0,"click:open":qe=>!0,"click:activate":qe=>!0,"click:select":qe=>!0},setup(qe,f){let{slots:ze}=f;const{items:Ke}=useListItems(qe),{themeClasses:Qe}=provideTheme(qe),{backgroundColorClasses:Pi,backgroundColorStyles:nn}=useBackgroundColor(()=>qe.bgColor),{borderClasses:ln}=useBorder(qe),{densityClasses:cn}=useDensity(qe),{dimensionStyles:hn}=useDimension(qe),{elevationClasses:un}=useElevation(qe),{roundedClasses:zn}=useRounded(qe),{children:Xn,open:Un,parents:qn,select:ys,getPath:vs}=useNested(qe),ea=toRef(()=>qe.lines?`v-list--${qe.lines}-line`:void 0),na=toRef(()=>qe.activeColor),ta=toRef(()=>qe.baseColor),ra=toRef(()=>qe.color);createList(),provideDefaults({VListGroup:{activeColor:na,baseColor:ta,color:ra,expandIcon:toRef(()=>qe.expandIcon),collapseIcon:toRef(()=>qe.collapseIcon)},VListItem:{activeClass:toRef(()=>qe.activeClass),activeColor:na,baseColor:ta,color:ra,density:toRef(()=>qe.density),disabled:toRef(()=>qe.disabled),lines:toRef(()=>qe.lines),nav:toRef(()=>qe.nav),slim:toRef(()=>qe.slim),variant:toRef(()=>qe.variant)}});const oa=shallowRef(!1),fa=ref();function ca(tl){oa.value=!0}function la(tl){oa.value=!1}function ua(tl){var ol;!oa.value&&!(tl.relatedTarget&&((ol=fa.value)!=null&&ol.contains(tl.relatedTarget)))&&qa()}function ga(tl){const ol=tl.target;if(!(!fa.value||["INPUT","TEXTAREA"].includes(ol.tagName))){if(tl.key==="ArrowDown")qa("next");else if(tl.key==="ArrowUp")qa("prev");else if(tl.key==="Home")qa("first");else if(tl.key==="End")qa("last");else return;tl.preventDefault()}}function da(tl){oa.value=!0}function qa(tl){if(fa.value)return focusChild(fa.value,tl)}return useRender(()=>createVNode(qe.tag,{ref:fa,class:["v-list",{"v-list--disabled":qe.disabled,"v-list--nav":qe.nav,"v-list--slim":qe.slim},Qe.value,Pi.value,ln.value,cn.value,un.value,ea.value,zn.value,qe.class],style:[nn.value,hn.value,qe.style],tabindex:qe.disabled?-1:0,role:"listbox","aria-activedescendant":void 0,onFocusin:ca,onFocusout:la,onFocus:ua,onKeydown:ga,onMousedown:da},{default:()=>[createVNode(VListChildren,{items:Ke.value,returnObject:qe.returnObject},ze)]})),{open:Un,select:ys,focus:qa,children:Xn,parents:qn,getPath:vs}}}),makeVMenuProps=propsFactory({id:String,submenu:Boolean,...omit(makeVOverlayProps({closeDelay:250,closeOnContentClick:!0,locationStrategy:"connected",location:void 0,openDelay:300,scrim:!1,scrollStrategy:"reposition",transition:{component:VDialogTransition}}),["absolute"])},"VMenu"),VMenu=genericComponent()({name:"VMenu",props:makeVMenuProps(),emits:{"update:modelValue":qe=>!0},setup(qe,f){let{slots:ze}=f;const Ke=useProxiedModel(qe,"modelValue"),{scopeId:Qe}=useScopeId(),{isRtl:Pi}=useRtl(),nn=useId(),ln=toRef(()=>qe.id||`v-menu-${nn}`),cn=ref(),hn=inject(VMenuSymbol,null),un=shallowRef(new Set);provide(VMenuSymbol,{register(){un.value.add(nn)},unregister(){un.value.delete(nn)},closeParents(vs){setTimeout(()=>{var ea;!un.value.size&&!qe.persistent&&(vs==null||(ea=cn.value)!=null&&ea.contentEl&&!isClickInsideElement(vs,cn.value.contentEl))&&(Ke.value=!1,hn==null||hn.closeParents())},40)}}),onBeforeUnmount(()=>{hn==null||hn.unregister(),document.removeEventListener("focusin",zn)}),onDeactivated(()=>Ke.value=!1);async function zn(vs){var ta,ra,oa;const ea=vs.relatedTarget,na=vs.target;await nextTick(),Ke.value&&ea!==na&&((ta=cn.value)!=null&&ta.contentEl)&&((ra=cn.value)!=null&&ra.globalTop)&&![document,cn.value.contentEl].includes(na)&&!cn.value.contentEl.contains(na)&&((oa=focusableChildren(cn.value.contentEl)[0])==null||oa.focus())}watch(Ke,vs=>{vs?(hn==null||hn.register(),IN_BROWSER&&document.addEventListener("focusin",zn,{once:!0})):(hn==null||hn.unregister(),IN_BROWSER&&document.removeEventListener("focusin",zn))},{immediate:!0});function Xn(vs){hn==null||hn.closeParents(vs)}function Un(vs){var ea,na,ta,ra,oa;if(!qe.disabled)if(vs.key==="Tab"||vs.key==="Enter"&&!qe.closeOnContentClick){if(vs.key==="Enter"&&(vs.target instanceof HTMLTextAreaElement||vs.target instanceof HTMLInputElement&&vs.target.closest("form")))return;vs.key==="Enter"&&vs.preventDefault(),getNextElement(focusableChildren((ea=cn.value)==null?void 0:ea.contentEl,!1),vs.shiftKey?"prev":"next",ca=>ca.tabIndex>=0)||(Ke.value=!1,(ta=(na=cn.value)==null?void 0:na.activatorEl)==null||ta.focus())}else qe.submenu&&vs.key===(Pi.value?"ArrowRight":"ArrowLeft")&&(Ke.value=!1,(oa=(ra=cn.value)==null?void 0:ra.activatorEl)==null||oa.focus())}function qn(vs){var na;if(qe.disabled)return;const ea=(na=cn.value)==null?void 0:na.contentEl;ea&&Ke.value?vs.key==="ArrowDown"?(vs.preventDefault(),vs.stopImmediatePropagation(),focusChild(ea,"next")):vs.key==="ArrowUp"?(vs.preventDefault(),vs.stopImmediatePropagation(),focusChild(ea,"prev")):qe.submenu&&(vs.key===(Pi.value?"ArrowRight":"ArrowLeft")?Ke.value=!1:vs.key===(Pi.value?"ArrowLeft":"ArrowRight")&&(vs.preventDefault(),focusChild(ea,"first"))):(qe.submenu?vs.key===(Pi.value?"ArrowLeft":"ArrowRight"):["ArrowDown","ArrowUp"].includes(vs.key))&&(Ke.value=!0,vs.preventDefault(),setTimeout(()=>setTimeout(()=>qn(vs))))}const ys=computed(()=>mergeProps({"aria-haspopup":"menu","aria-expanded":String(Ke.value),"aria-controls":ln.value,onKeydown:qn},qe.activatorProps));return useRender(()=>{const vs=VOverlay.filterProps(qe);return createVNode(VOverlay,mergeProps({ref:cn,id:ln.value,class:["v-menu",qe.class],style:qe.style},vs,{modelValue:Ke.value,"onUpdate:modelValue":ea=>Ke.value=ea,absolute:!0,activatorProps:ys.value,location:qe.location??(qe.submenu?"end":"bottom"),"onClick:outside":Xn,onKeydown:Un},Qe),{activator:ze.activator,default:function(){for(var ea=arguments.length,na=new Array(ea),ta=0;ta<ea;ta++)na[ta]=arguments[ta];return createVNode(VDefaultsProvider,{root:"VMenu"},{default:()=>{var ra;return[(ra=ze.default)==null?void 0:ra.call(ze,...na)]}})}})}),forwardRefs({id:ln,openChildren:un},cn)}}),activeTypes=["color","file","time","date","datetime-local","week","month"],makeVTextFieldProps=propsFactory({autofocus:Boolean,counter:[Boolean,Number,String],counterValue:[Number,Function],prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,suffix:String,role:String,type:{type:String,default:"text"},modelModifiers:Object,...makeVInputProps(),...makeVFieldProps()},"VTextField"),VTextField=genericComponent()({name:"VTextField",directives:{Intersect},inheritAttrs:!1,props:makeVTextFieldProps(),emits:{"click:control":qe=>!0,"mousedown:control":qe=>!0,"update:focused":qe=>!0,"update:modelValue":qe=>!0},setup(qe,f){let{attrs:ze,emit:Ke,slots:Qe}=f;const Pi=useProxiedModel(qe,"modelValue"),{isFocused:nn,focus:ln,blur:cn}=useFocus(qe),hn=computed(()=>typeof qe.counterValue=="function"?qe.counterValue(Pi.value):typeof qe.counterValue=="number"?qe.counterValue:(Pi.value??"").toString().length),un=computed(()=>{if(ze.maxlength)return ze.maxlength;if(!(!qe.counter||typeof qe.counter!="number"&&typeof qe.counter!="string"))return qe.counter}),zn=computed(()=>["plain","underlined"].includes(qe.variant));function Xn(fa,ca){var la,ua;!qe.autofocus||!fa||(ua=(la=ca[0].target)==null?void 0:la.focus)==null||ua.call(la)}const Un=ref(),qn=ref(),ys=ref(),vs=computed(()=>activeTypes.includes(qe.type)||qe.persistentPlaceholder||nn.value||qe.active);function ea(){var fa;ys.value!==document.activeElement&&((fa=ys.value)==null||fa.focus()),nn.value||ln()}function na(fa){Ke("mousedown:control",fa),fa.target!==ys.value&&(ea(),fa.preventDefault())}function ta(fa){ea(),Ke("click:control",fa)}function ra(fa,ca){fa.stopPropagation(),ea(),nextTick(()=>{Pi.value=null,ca(),callEvent(qe["onClick:clear"],fa)})}function oa(fa){var la;const ca=fa.target;if(Pi.value=ca.value,(la=qe.modelModifiers)!=null&&la.trim&&["text","search","password","tel","url"].includes(qe.type)){const ua=[ca.selectionStart,ca.selectionEnd];nextTick(()=>{ca.selectionStart=ua[0],ca.selectionEnd=ua[1]})}}return useRender(()=>{const fa=!!(Qe.counter||qe.counter!==!1&&qe.counter!=null),ca=!!(fa||Qe.details),[la,ua]=filterInputAttrs(ze),{modelValue:ga,...da}=VInput.filterProps(qe),qa=VField.filterProps(qe);return createVNode(VInput,mergeProps({ref:Un,modelValue:Pi.value,"onUpdate:modelValue":tl=>Pi.value=tl,class:["v-text-field",{"v-text-field--prefixed":qe.prefix,"v-text-field--suffixed":qe.suffix,"v-input--plain-underlined":zn.value},qe.class],style:qe.style},la,da,{centerAffix:!zn.value,focused:nn.value}),{...Qe,default:tl=>{let{id:ol,isDisabled:hl,isDirty:wl,isReadonly:_l,isValid:gl,reset:dl}=tl;return createVNode(VField,mergeProps({ref:qn,onMousedown:na,onClick:ta,"onClick:clear":sl=>ra(sl,dl),"onClick:prependInner":qe["onClick:prependInner"],"onClick:appendInner":qe["onClick:appendInner"],role:qe.role},qa,{id:ol.value,active:vs.value||wl.value,dirty:wl.value||qe.dirty,disabled:hl.value,focused:nn.value,error:gl.value===!1}),{...Qe,default:sl=>{let{props:{class:kl,...pl}}=sl;const Al=withDirectives(createVNode("input",mergeProps({ref:ys,value:Pi.value,onInput:oa,autofocus:qe.autofocus,readonly:_l.value,disabled:hl.value,name:qe.name,placeholder:qe.placeholder,size:1,type:qe.type,onFocus:ea,onBlur:cn},pl,ua),null),[[resolveDirective("intersect"),{handler:Xn},null,{once:!0}]]);return createVNode(Fragment,null,[qe.prefix&&createVNode("span",{class:"v-text-field__prefix"},[createVNode("span",{class:"v-text-field__prefix__text"},[qe.prefix])]),Qe.default?createVNode("div",{class:kl,"data-no-activator":""},[Qe.default(),Al]):cloneVNode(Al,{class:kl}),qe.suffix&&createVNode("span",{class:"v-text-field__suffix"},[createVNode("span",{class:"v-text-field__suffix__text"},[qe.suffix])])])}})},details:ca?tl=>{var ol;return createVNode(Fragment,null,[(ol=Qe.details)==null?void 0:ol.call(Qe,tl),fa&&createVNode(Fragment,null,[createVNode("span",null,null),createVNode(VCounter,{active:qe.persistentCounter||nn.value,value:hn.value,max:un.value,disabled:qe.disabled},Qe.counter)])])}:void 0})}),forwardRefs({},Un,qn,ys)}}),makeVVirtualScrollItemProps=propsFactory({renderless:Boolean,...makeComponentProps()},"VVirtualScrollItem"),VVirtualScrollItem=genericComponent()({name:"VVirtualScrollItem",inheritAttrs:!1,props:makeVVirtualScrollItemProps(),emits:{"update:height":qe=>!0},setup(qe,f){let{attrs:ze,emit:Ke,slots:Qe}=f;const{resizeRef:Pi,contentRect:nn}=useResizeObserver(void 0,"border");watch(()=>{var ln;return(ln=nn.value)==null?void 0:ln.height},ln=>{ln!=null&&Ke("update:height",ln)}),useRender(()=>{var ln,cn;return qe.renderless?createVNode(Fragment,null,[(ln=Qe.default)==null?void 0:ln.call(Qe,{itemRef:Pi})]):createVNode("div",mergeProps({ref:Pi,class:["v-virtual-scroll__item",qe.class],style:qe.style},ze),[(cn=Qe.default)==null?void 0:cn.call(Qe)])})}}),UP=-1,DOWN=1,BUFFER_PX=100,makeVirtualProps=propsFactory({itemHeight:{type:[Number,String],default:null},itemKey:{type:[String,Array,Function],default:null},height:[Number,String]},"virtual");function useVirtual(qe,f){const ze=useDisplay(),Ke=shallowRef(0);watchEffect(()=>{Ke.value=parseFloat(qe.itemHeight||0)});const Qe=shallowRef(0),Pi=shallowRef(Math.ceil((parseInt(qe.height)||ze.height.value)/(Ke.value||16))||1),nn=shallowRef(0),ln=shallowRef(0),cn=ref(),hn=ref();let un=0;const{resizeRef:zn,contentRect:Xn}=useResizeObserver();watchEffect(()=>{zn.value=cn.value});const Un=computed(()=>{var sl;return cn.value===document.documentElement?ze.height.value:((sl=Xn.value)==null?void 0:sl.height)||parseInt(qe.height)||0}),qn=computed(()=>!!(cn.value&&hn.value&&Un.value&&Ke.value));let ys=Array.from({length:f.value.length}),vs=Array.from({length:f.value.length});const ea=shallowRef(0);let na=-1;function ta(sl){return ys[sl]||Ke.value}const ra=debounce(()=>{const sl=performance.now();vs[0]=0;const kl=f.value.length;for(let pl=1;pl<=kl-1;pl++)vs[pl]=(vs[pl-1]||0)+ta(pl-1);ea.value=Math.max(ea.value,performance.now()-sl)},ea),oa=watch(qn,sl=>{sl&&(oa(),un=hn.value.offsetTop,ra.immediate(),wl(),~na&&nextTick(()=>{IN_BROWSER&&window.requestAnimationFrame(()=>{gl(na),na=-1})}))});onScopeDispose(()=>{ra.clear()});function fa(sl,kl){const pl=ys[sl],Al=Ke.value;Ke.value=Al?Math.min(Ke.value,kl):kl,(pl!==kl||Al!==Ke.value)&&(ys[sl]=kl,ra())}function ca(sl){return sl=clamp$1(sl,0,f.value.length-1),vs[sl]||0}function la(sl){return binaryClosest(vs,sl)}let ua=0,ga=0,da=0;watch(Un,(sl,kl)=>{kl&&(wl(),sl<kl&&requestAnimationFrame(()=>{ga=0,wl()}))});let qa=-1;function tl(){if(!cn.value||!hn.value)return;const sl=cn.value.scrollTop,kl=performance.now();kl-da>500?(ga=Math.sign(sl-ua),un=hn.value.offsetTop):ga=sl-ua,ua=sl,da=kl,window.clearTimeout(qa),qa=window.setTimeout(ol,500),wl()}function ol(){!cn.value||!hn.value||(ga=0,da=0,window.clearTimeout(qa),wl())}let hl=-1;function wl(){cancelAnimationFrame(hl),hl=requestAnimationFrame(_l)}function _l(){if(!cn.value||!Un.value)return;const sl=ua-un,kl=Math.sign(ga),pl=Math.max(0,sl-BUFFER_PX),Al=clamp$1(la(pl),0,f.value.length),xl=sl+Un.value+BUFFER_PX,al=clamp$1(la(xl)+1,Al+1,f.value.length);if((kl!==UP||Al<Qe.value)&&(kl!==DOWN||al>Pi.value)){const Fl=ca(Qe.value)-ca(Al),Ol=ca(al)-ca(Pi.value);Math.max(Fl,Ol)>BUFFER_PX?(Qe.value=Al,Pi.value=al):(Al<=0&&(Qe.value=Al),al>=f.value.length&&(Pi.value=al))}nn.value=ca(Qe.value),ln.value=ca(f.value.length)-ca(Pi.value)}function gl(sl){const kl=ca(sl);!cn.value||sl&&!kl?na=sl:cn.value.scrollTop=kl}const dl=computed(()=>f.value.slice(Qe.value,Pi.value).map((sl,kl)=>{const pl=kl+Qe.value;return{raw:sl,index:pl,key:getPropertyFromItem(sl,qe.itemKey,pl)}}));return watch(f,()=>{ys=Array.from({length:f.value.length}),vs=Array.from({length:f.value.length}),ra.immediate(),wl()},{deep:1}),{calculateVisibleItems:wl,containerRef:cn,markerRef:hn,computedItems:dl,paddingTop:nn,paddingBottom:ln,scrollToIndex:gl,handleScroll:tl,handleScrollend:ol,handleItemResize:fa}}function binaryClosest(qe,f){let ze=qe.length-1,Ke=0,Qe=0,Pi=null,nn=-1;if(qe[ze]<f)return ze;for(;Ke<=ze;)if(Qe=Ke+ze>>1,Pi=qe[Qe],Pi>f)ze=Qe-1;else if(Pi<f)nn=Qe,Ke=Qe+1;else return Pi===f?Qe:Ke;return nn}const makeVVirtualScrollProps=propsFactory({items:{type:Array,default:()=>[]},renderless:Boolean,...makeVirtualProps(),...makeComponentProps(),...makeDimensionProps()},"VVirtualScroll"),VVirtualScroll=genericComponent()({name:"VVirtualScroll",props:makeVVirtualScrollProps(),setup(qe,f){let{slots:ze}=f;const Ke=getCurrentInstance("VVirtualScroll"),{dimensionStyles:Qe}=useDimension(qe),{calculateVisibleItems:Pi,containerRef:nn,markerRef:ln,handleScroll:cn,handleScrollend:hn,handleItemResize:un,scrollToIndex:zn,paddingTop:Xn,paddingBottom:Un,computedItems:qn}=useVirtual(qe,toRef(()=>qe.items));return useToggleScope(()=>qe.renderless,()=>{function ys(){var na,ta;const ea=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1)?"addEventListener":"removeEventListener";nn.value===document.documentElement?(document[ea]("scroll",cn,{passive:!0}),document[ea]("scrollend",hn)):((na=nn.value)==null||na[ea]("scroll",cn,{passive:!0}),(ta=nn.value)==null||ta[ea]("scrollend",hn))}onMounted(()=>{nn.value=getScrollParent(Ke.vnode.el,!0),ys(!0)}),onScopeDispose(ys)}),useRender(()=>{const ys=qn.value.map(vs=>createVNode(VVirtualScrollItem,{key:vs.key,renderless:qe.renderless,"onUpdate:height":ea=>un(vs.index,ea)},{default:ea=>{var na;return(na=ze.default)==null?void 0:na.call(ze,{item:vs.raw,index:vs.index,...ea})}}));return qe.renderless?createVNode(Fragment,null,[createVNode("div",{ref:ln,class:"v-virtual-scroll__spacer",style:{paddingTop:convertToUnit(Xn.value)}},null),ys,createVNode("div",{class:"v-virtual-scroll__spacer",style:{paddingBottom:convertToUnit(Un.value)}},null)]):createVNode("div",{ref:nn,class:["v-virtual-scroll",qe.class],onScrollPassive:cn,onScrollend:hn,style:[Qe.value,qe.style]},[createVNode("div",{ref:ln,class:"v-virtual-scroll__container",style:{paddingTop:convertToUnit(Xn.value),paddingBottom:convertToUnit(Un.value)}},[ys])])}),{calculateVisibleItems:Pi,scrollToIndex:zn}}});function useScrolling(qe,f){const ze=shallowRef(!1);let Ke;function Qe(ln){cancelAnimationFrame(Ke),ze.value=!0,Ke=requestAnimationFrame(()=>{Ke=requestAnimationFrame(()=>{ze.value=!1})})}async function Pi(){await new Promise(ln=>requestAnimationFrame(ln)),await new Promise(ln=>requestAnimationFrame(ln)),await new Promise(ln=>requestAnimationFrame(ln)),await new Promise(ln=>{if(ze.value){const cn=watch(ze,()=>{cn(),ln()})}else ln()})}async function nn(ln){var un,zn;if(ln.key==="Tab"&&((un=f.value)==null||un.focus()),!["PageDown","PageUp","Home","End"].includes(ln.key))return;const cn=(zn=qe.value)==null?void 0:zn.$el;if(!cn)return;(ln.key==="Home"||ln.key==="End")&&cn.scrollTo({top:ln.key==="Home"?0:cn.scrollHeight,behavior:"smooth"}),await Pi();const hn=cn.querySelectorAll(":scope > :not(.v-virtual-scroll__spacer)");if(ln.key==="PageDown"||ln.key==="Home"){const Xn=cn.getBoundingClientRect().top;for(const Un of hn)if(Un.getBoundingClientRect().top>=Xn){Un.focus();break}}else{const Xn=cn.getBoundingClientRect().bottom;for(const Un of[...hn].reverse())if(Un.getBoundingClientRect().bottom<=Xn){Un.focus();break}}}return{onScrollPassive:Qe,onKeydown:nn}}const makeSelectProps=propsFactory({chips:Boolean,closableChips:Boolean,closeText:{type:String,default:"$vuetify.close"},openText:{type:String,default:"$vuetify.open"},eager:Boolean,hideNoData:Boolean,hideSelected:Boolean,listProps:{type:Object},menu:Boolean,menuIcon:{type:IconValue,default:"$dropdown"},menuProps:{type:Object},multiple:Boolean,noDataText:{type:String,default:"$vuetify.noDataText"},openOnClear:Boolean,itemColor:String,...makeItemsProps({itemChildren:!1})},"Select"),makeVSelectProps=propsFactory({...makeSelectProps(),...omit(makeVTextFieldProps({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...makeTransitionProps({transition:{component:VDialogTransition}})},"VSelect"),VSelect=genericComponent()({name:"VSelect",props:makeVSelectProps(),emits:{"update:focused":qe=>!0,"update:modelValue":qe=>!0,"update:menu":qe=>!0},setup(qe,f){let{slots:ze}=f;const{t:Ke}=useLocale(),Qe=ref(),Pi=ref(),nn=ref(),{items:ln,transformIn:cn,transformOut:hn}=useItems(qe),un=useProxiedModel(qe,"modelValue",[],dl=>cn(dl===null?[null]:wrapInArray(dl)),dl=>{const sl=hn(dl);return qe.multiple?sl:sl[0]??null}),zn=computed(()=>typeof qe.counterValue=="function"?qe.counterValue(un.value):typeof qe.counterValue=="number"?qe.counterValue:un.value.length),Xn=useForm(qe),Un=computed(()=>un.value.map(dl=>dl.value)),qn=shallowRef(!1);let ys="",vs;const ea=computed(()=>qe.hideSelected?ln.value.filter(dl=>!un.value.some(sl=>(qe.valueComparator||deepEqual)(sl,dl))):ln.value),na=computed(()=>qe.hideNoData&&!ea.value.length||Xn.isReadonly.value||Xn.isDisabled.value),ta=useProxiedModel(qe,"menu"),ra=computed({get:()=>ta.value,set:dl=>{var sl;ta.value&&!dl&&((sl=Pi.value)!=null&&sl.openChildren.size)||dl&&na.value||(ta.value=dl)}}),oa=toRef(()=>ra.value?qe.closeText:qe.openText),fa=computed(()=>{var dl;return{...qe.menuProps,activatorProps:{...((dl=qe.menuProps)==null?void 0:dl.activatorProps)||{},"aria-haspopup":"listbox"}}}),ca=ref(),la=useScrolling(ca,Qe);function ua(dl){qe.openOnClear&&(ra.value=!0)}function ga(){na.value||(ra.value=!ra.value)}function da(dl){checkPrintable(dl)&&qa(dl)}function qa(dl){var Al,xl;if(!dl.key||Xn.isReadonly.value)return;["Enter"," ","ArrowDown","ArrowUp","Home","End"].includes(dl.key)&&dl.preventDefault(),["Enter","ArrowDown"," "].includes(dl.key)&&(ra.value=!0),["Escape","Tab"].includes(dl.key)&&(ra.value=!1),dl.key==="Home"?(Al=ca.value)==null||Al.focus("first"):dl.key==="End"&&((xl=ca.value)==null||xl.focus("last"));const sl=1e3;if(!checkPrintable(dl))return;const kl=performance.now();kl-vs>sl&&(ys=""),ys+=dl.key.toLowerCase(),vs=kl;const pl=ln.value.find(al=>al.title.toLowerCase().startsWith(ys));if(pl!==void 0){un.value=[pl];const al=ea.value.indexOf(pl);IN_BROWSER&&window.requestAnimationFrame(()=>{var Fl;al>=0&&((Fl=nn.value)==null||Fl.scrollToIndex(al))})}}function tl(dl){let sl=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!dl.props.disabled)if(qe.multiple){const kl=un.value.findIndex(Al=>(qe.valueComparator||deepEqual)(Al.value,dl.value)),pl=sl??!~kl;if(~kl){const Al=pl?[...un.value,dl]:[...un.value];Al.splice(kl,1),un.value=Al}else pl&&(un.value=[...un.value,dl])}else{const kl=sl!==!1;un.value=kl?[dl]:[],nextTick(()=>{ra.value=!1})}}function ol(dl){var sl;(sl=ca.value)!=null&&sl.$el.contains(dl.relatedTarget)||(ra.value=!1)}function hl(){var dl;qe.eager&&((dl=nn.value)==null||dl.calculateVisibleItems())}function wl(){var dl;qn.value&&((dl=Qe.value)==null||dl.focus())}function _l(dl){qn.value=!0}function gl(dl){if(dl==null)un.value=[];else if(matchesSelector(Qe.value,":autofill")||matchesSelector(Qe.value,":-webkit-autofill")){const sl=ln.value.find(kl=>kl.title===dl);sl&&tl(sl)}else Qe.value&&(Qe.value.value="")}return watch(ra,()=>{if(!qe.hideSelected&&ra.value&&un.value.length){const dl=ea.value.findIndex(sl=>un.value.some(kl=>(qe.valueComparator||deepEqual)(kl.value,sl.value)));IN_BROWSER&&window.requestAnimationFrame(()=>{var sl;dl>=0&&((sl=nn.value)==null||sl.scrollToIndex(dl))})}}),watch(()=>qe.items,(dl,sl)=>{ra.value||qn.value&&!sl.length&&dl.length&&(ra.value=!0)}),useRender(()=>{const dl=!!(qe.chips||ze.chip),sl=!!(!qe.hideNoData||ea.value.length||ze["prepend-item"]||ze["append-item"]||ze["no-data"]),kl=un.value.length>0,pl=VTextField.filterProps(qe),Al=kl||!qn.value&&qe.label&&!qe.persistentPlaceholder?void 0:qe.placeholder;return createVNode(VTextField,mergeProps({ref:Qe},pl,{modelValue:un.value.map(xl=>xl.props.value).join(", "),"onUpdate:modelValue":gl,focused:qn.value,"onUpdate:focused":xl=>qn.value=xl,validationValue:un.externalValue,counterValue:zn.value,dirty:kl,class:["v-select",{"v-select--active-menu":ra.value,"v-select--chips":!!qe.chips,[`v-select--${qe.multiple?"multiple":"single"}`]:!0,"v-select--selected":un.value.length,"v-select--selection-slot":!!ze.selection},qe.class],style:qe.style,inputmode:"none",placeholder:Al,"onClick:clear":ua,"onMousedown:control":ga,onBlur:ol,onKeydown:qa,"aria-label":Ke(oa.value),title:Ke(oa.value)}),{...ze,default:()=>createVNode(Fragment,null,[createVNode(VMenu,mergeProps({ref:Pi,modelValue:ra.value,"onUpdate:modelValue":xl=>ra.value=xl,activator:"parent",contentClass:"v-select__content",disabled:na.value,eager:qe.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:qe.transition,onAfterEnter:hl,onAfterLeave:wl},fa.value),{default:()=>[sl&&createVNode(VList,mergeProps({ref:ca,selected:Un.value,selectStrategy:qe.multiple?"independent":"single-independent",onMousedown:xl=>xl.preventDefault(),onKeydown:da,onFocusin:_l,tabindex:"-1","aria-live":"polite","aria-label":`${qe.label}-list`,color:qe.itemColor??qe.color},la,qe.listProps),{default:()=>{var xl,al,Fl;return[(xl=ze["prepend-item"])==null?void 0:xl.call(ze),!ea.value.length&&!qe.hideNoData&&(((al=ze["no-data"])==null?void 0:al.call(ze))??createVNode(VListItem,{key:"no-data",title:Ke(qe.noDataText)},null)),createVNode(VVirtualScroll,{ref:nn,renderless:!0,items:ea.value,itemKey:"value"},{default:Ol=>{var vl;let{item:Jo,index:cl,itemRef:rl}=Ol;const nl=mergeProps(Jo.props,{ref:rl,key:Jo.value,onClick:()=>tl(Jo,null)});return((vl=ze.item)==null?void 0:vl.call(ze,{item:Jo,index:cl,props:nl}))??createVNode(VListItem,mergeProps(nl,{role:"option"}),{prepend:Pl=>{let{isSelected:Sl}=Pl;return createVNode(Fragment,null,[qe.multiple&&!qe.hideSelected?createVNode(VCheckboxBtn,{key:Jo.value,modelValue:Sl,ripple:!1,tabindex:"-1"},null):void 0,Jo.props.prependAvatar&&createVNode(VAvatar,{image:Jo.props.prependAvatar},null),Jo.props.prependIcon&&createVNode(VIcon,{icon:Jo.props.prependIcon},null)])}})}}),(Fl=ze["append-item"])==null?void 0:Fl.call(ze)]}})]}),un.value.map((xl,al)=>{function Fl(rl){rl.stopPropagation(),rl.preventDefault(),tl(xl,!1)}const Ol={"onClick:close":Fl,onKeydown(rl){rl.key!=="Enter"&&rl.key!==" "||(rl.preventDefault(),rl.stopPropagation(),Fl(rl))},onMousedown(rl){rl.preventDefault(),rl.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},Jo=dl?!!ze.chip:!!ze.selection,cl=Jo?ensureValidVNode(dl?ze.chip({item:xl,index:al,props:Ol}):ze.selection({item:xl,index:al})):void 0;if(!(Jo&&!cl))return createVNode("div",{key:xl.value,class:"v-select__selection"},[dl?ze.chip?createVNode(VDefaultsProvider,{key:"chip-defaults",defaults:{VChip:{closable:qe.closableChips,size:"small",text:xl.title}}},{default:()=>[cl]}):createVNode(VChip,mergeProps({key:"chip",closable:qe.closableChips,size:"small",text:xl.title,disabled:xl.props.disabled},Ol),null):cl??createVNode("span",{class:"v-select__selection-text"},[xl.title,qe.multiple&&al<un.value.length-1&&createVNode("span",{class:"v-select__selection-comma"},[createTextVNode(",")])])])})]),"append-inner":function(){var Ol,Jo;for(var xl=arguments.length,al=new Array(xl),Fl=0;Fl<xl;Fl++)al[Fl]=arguments[Fl];return createVNode(Fragment,null,[(Ol=ze["append-inner"])==null?void 0:Ol.call(ze,...al),qe.menuIcon?createVNode(VIcon,{class:"v-select__menu-icon",color:(Jo=Qe.value)==null?void 0:Jo.fieldIconColor,icon:qe.menuIcon},null):void 0])}})}),forwardRefs({isFocused:qn,menu:ra,select:tl},Qe)}}),_hoisted_1$1={class:"text-center"},_hoisted_2={class:"text-center"},_hoisted_3={class:"text-center"},_hoisted_4={class:"text-center"},_hoisted_5={class:"text-center"},_hoisted_6={class:"text-center"},_hoisted_7={key:0},_hoisted_8={key:1},_sfc_main$1=defineComponent({__name:"GridScoreExportModal",props:{images:{default:()=>[]}},setup(qe,{expose:f}){const ze=qe,Ke=ref(),Qe=ref(),Pi=ref(!1),nn=ref("https://gridscore.hutton.ac.uk"),ln=ref(),cn=computed(()=>{if(Qe.value&&Qe.value.shareCodes)return Qe.value.shareCodes.ownerCode!==void 0&&Qe.value.shareCodes.ownerCode!==null||Qe.value.shareCodes.editorCode!==void 0&&Qe.value.shareCodes.editorCode!==null}),hn=computed(()=>Qe.value&&Qe.value.traits?Qe.value.traits.filter(ys=>ys.dataType==="int"||ys.dataType==="float"||ys.dataType==="range").sort((ys,vs)=>ys.name.localeCompare(vs.name)):[]),un=computed(()=>{if(Qe.value&&Qe.value.createdOn&&Qe.value.updatedOn){const ys=toLocalDateString(Qe.value.createdOn),vs=toLocalDateString(Qe.value.updatedOn);return(new Date(vs).getTime()-new Date(ys).getTime())/(24*60*60*1e3)+1}else return 1}),zn=computed(()=>{if(nn.value){let ys=nn.value;return ys?(ys.endsWith("/")||(ys+="/"),ys&&!ys.endsWith("api/")&&(ys+="api/"),ys):void 0}else return});watch(hn,async ys=>{ys&&ys.length>0&&(Ke.value=ys[0])});function Xn(){Qe.value=void 0,Ke.value=void 0,ln.value=void 0,Pi.value=!0}function Un(){axios.default({url:`${zn.value}trial/${ln.value}`,method:"get",crossDomain:!0,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(ys=>{Qe.value=ys==null?void 0:ys.data}).catch(ys=>{console.error(ys)})}function qn(){if(!Ke.value)return;const ys={};ze.images.forEach(ea=>{var ta,ra,oa,fa;const na=ea.gridscoreConfig;na&&(ys[`${getGridScoreRowIndex((ta=Qe.value)==null?void 0:ta.layout,na.row)}|${getGridScoreColumnIndex((ra=Qe.value)==null?void 0:ra.layout,na.column)}`]=[{traitId:((oa=Ke.value)==null?void 0:oa.id)||"",values:[`${ea.ratio}`],timestamp:((fa=ea.gridscoreConfig)==null?void 0:fa.timestamp)||new Date().toISOString()}])});const vs={plotTraitDataChangeTransactions:ys};axios.default({url:`${zn.value}trial/${ln.value}/transaction`,method:"post",crossDomain:!0,data:vs,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(ea=>{console.log(ea)}).catch(ea=>{console.error(ea)})}return f({show:Xn}),(ys,vs)=>(openBlock(),createBlock(VDialog,{modelValue:unref(Pi),"onUpdate:modelValue":vs[4]||(vs[4]=ea=>isRef(Pi)?Pi.value=ea:null),"max-width":"720"},{default:withCtx(()=>[createVNode(VCard,{title:"Export to GridScore"},{default:withCtx(()=>[createVNode(VCardText,null,{default:withCtx(()=>vs[5]||(vs[5]=[createTextVNode(" This window will let you export the vegetation index values extracted from your GridScore images back to GridScore. ")])),_:1}),createVNode(VCardText,null,{default:withCtx(()=>[createVNode(VForm,{onSubmit:withModifiers(qn,["prevent"])},{default:withCtx(()=>[createVNode(VRow,null,{default:withCtx(()=>[createVNode(VCol,{cols:"12",md:"6"},{default:withCtx(()=>[createVNode(VTextField,{modelValue:unref(nn),"onUpdate:modelValue":vs[0]||(vs[0]=ea=>isRef(nn)?nn.value=ea:null),label:"GridScore URL",name:"gridscore-url",required:"",type:"url"},null,8,["modelValue"])]),_:1}),createVNode(VCol,{cols:"12",md:"6"},{default:withCtx(()=>[createVNode(VTextField,{modelValue:unref(ln),"onUpdate:modelValue":vs[1]||(vs[1]=ea=>isRef(ln)?ln.value=ea:null),label:"GridScore share code",name:"gridscore-code",required:""},null,8,["modelValue"])]),_:1})]),_:1}),createVNode(VRow,{class:"d-flex flex-column justify-center"},{default:withCtx(()=>[createVNode(VCol,{class:"mx-auto",cols:"6"},{default:withCtx(()=>[createVNode(VBtn,{block:"",class:"mb-5",color:unref(Qe)?void 0:"primary","prepend-icon":"mdi-file-arrow-up-down-outline",text:"Load trial information",onClick:Un},null,8,["color"]),unref(Qe)?(openBlock(),createBlock(VCard,{key:0,color:"surface-variant",subtitle:unref(Qe).description,title:unref(Qe).name,variant:"tonal"},{default:withCtx(()=>[createVNode(VRow,{class:"mb-3"},{default:withCtx(()=>[createVNode(VCol,{cols:"6"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$1,[createBaseVNode("h3",null,[createVNode(VIcon,{icon:"mdi-table-column"})]),createBaseVNode("div",null,toDisplayString(unref(Qe).layout.columns)+" columns",1)])]),_:1}),createVNode(VCol,{cols:"6"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_2,[createBaseVNode("h3",null,[createVNode(VIcon,{class:"rotate-90",icon:"mdi-table-column"})]),createBaseVNode("div",null,toDisplayString(unref(Qe).layout.rows)+" rows",1)])]),_:1}),createVNode(VCol,{cols:"6"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_3,[createBaseVNode("h3",null,[createVNode(VIcon,{icon:"mdi-tag-multiple-outline"})]),createBaseVNode("div",null,toDisplayString(unref(Qe).traits.length)+" traits",1)])]),_:1}),createVNode(VCol,{cols:"6"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_4,[createBaseVNode("h3",null,[createVNode(VIcon,{icon:"mdi-account-outline"})]),createBaseVNode("div",null,toDisplayString((unref(Qe).people||[]).length)+" people",1)])]),_:1}),unref(Qe).updatedOn?(openBlock(),createBlock(VCol,{key:0,cols:"6"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_5,[createBaseVNode("h3",null,[createVNode(VIcon,{icon:"mdi-calendar"})]),createBaseVNode("div",null,toDisplayString(unref(un))+" active days",1)])]),_:1})):createCommentVNode("",!0),unref(Qe).updatedOn?(openBlock(),createBlock(VCol,{key:1,cols:"6"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_6,[createBaseVNode("h3",null,[createVNode(VIcon,{icon:"mdi-calendar"})]),createBaseVNode("div",null,toDisplayString(unref(formatTimeAgo)(unref(Qe).updatedOn)),1)])]),_:1})):createCommentVNode("",!0),createVNode(VCol,{cols:"12"},{default:withCtx(()=>[createVNode(VCardText,null,{default:withCtx(()=>[unref(cn)?(openBlock(),createElementBlock("div",_hoisted_8,[unref(hn)?(openBlock(),createBlock(VSelect,{key:0,modelValue:unref(Ke),"onUpdate:modelValue":vs[2]||(vs[2]=ea=>isRef(Ke)?Ke.value=ea:null),"hide-details":"","item-title":"name","item-value":"id",items:unref(hn),label:"Select trait","return-object":"","single-line":""},null,8,["modelValue","items"])):(openBlock(),createBlock(VAlert,{key:1,text:"No numeric traits found in this trial.",type:"warning",variant:"tonal"}))])):(openBlock(),createElementBlock("div",_hoisted_7,[createVNode(VAlert,{text:"The trial share code you used does not give you permission to write to this trial.",type:"error",variant:"tonal"})]))]),_:1})]),_:1})]),_:1})]),_:1},8,["subtitle","title"])):createCommentVNode("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),createVNode(VDivider),createVNode(VCardActions,null,{default:withCtx(()=>[createVNode(VBtn,{text:"Cancel",onClick:vs[3]||(vs[3]=ea=>Pi.value=!1)}),createVNode(VSpacer),createVNode(VBtn,{color:"primary",disabled:!unref(cn)||!unref(Ke),"prepend-icon":"mdi-upload",text:"Export",variant:"flat",onClick:qn},null,8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),VTabsSymbol=Symbol.for("vuetify:v-tabs"),makeVTabProps=propsFactory({fixed:Boolean,sliderColor:String,hideSlider:Boolean,direction:{type:String,default:"horizontal"},...omit(makeVBtnProps({selectedClass:"v-tab--selected",variant:"text"}),["active","block","flat","location","position","symbol"])},"VTab"),VTab=genericComponent()({name:"VTab",props:makeVTabProps(),setup(qe,f){let{slots:ze,attrs:Ke}=f;const{textColorClasses:Qe,textColorStyles:Pi}=useTextColor(()=>qe.sliderColor),nn=ref(),ln=ref(),cn=computed(()=>qe.direction==="horizontal"),hn=computed(()=>{var zn,Xn;return((Xn=(zn=nn.value)==null?void 0:zn.group)==null?void 0:Xn.isSelected.value)??!1});function un(zn){var Un,qn;let{value:Xn}=zn;if(Xn){const ys=(qn=(Un=nn.value)==null?void 0:Un.$el.parentElement)==null?void 0:qn.querySelector(".v-tab--selected .v-tab__slider"),vs=ln.value;if(!ys||!vs)return;const ea=getComputedStyle(ys).color,na=ys.getBoundingClientRect(),ta=vs.getBoundingClientRect(),ra=cn.value?"x":"y",oa=cn.value?"X":"Y",fa=cn.value?"right":"bottom",ca=cn.value?"width":"height",la=na[ra],ua=ta[ra],ga=la>ua?na[fa]-ta[fa]:na[ra]-ta[ra],da=Math.sign(ga)>0?cn.value?"right":"bottom":Math.sign(ga)<0?cn.value?"left":"top":"center",tl=(Math.abs(ga)+(Math.sign(ga)<0?na[ca]:ta[ca]))/Math.max(na[ca],ta[ca])||0,ol=na[ca]/ta[ca]||0,hl=1.5;animate(vs,{backgroundColor:[ea,"currentcolor"],transform:[`translate${oa}(${ga}px) scale${oa}(${ol})`,`translate${oa}(${ga/hl}px) scale${oa}(${(tl-1)/hl+1})`,"none"],transformOrigin:Array(3).fill(da)},{duration:225,easing:standardEasing})}}return useRender(()=>{const zn=VBtn.filterProps(qe);return createVNode(VBtn,mergeProps({symbol:VTabsSymbol,ref:nn,class:["v-tab",qe.class],style:qe.style,tabindex:hn.value?0:-1,role:"tab","aria-selected":String(hn.value),active:!1},zn,Ke,{block:qe.fixed,maxWidth:qe.fixed?300:void 0,"onGroup:selected":un}),{...ze,default:()=>{var Xn;return createVNode(Fragment,null,[((Xn=ze.default)==null?void 0:Xn.call(ze))??qe.text,!qe.hideSlider&&createVNode("div",{ref:ln,class:["v-tab__slider",Qe.value],style:Pi.value},null)])}})}),forwardRefs({},nn)}}),handleGesture=qe=>{const{touchstartX:f,touchendX:ze,touchstartY:Ke,touchendY:Qe}=qe,Pi=.5,nn=16;qe.offsetX=ze-f,qe.offsetY=Qe-Ke,Math.abs(qe.offsetY)<Pi*Math.abs(qe.offsetX)&&(qe.left&&ze<f-nn&&qe.left(qe),qe.right&&ze>f+nn&&qe.right(qe)),Math.abs(qe.offsetX)<Pi*Math.abs(qe.offsetY)&&(qe.up&&Qe<Ke-nn&&qe.up(qe),qe.down&&Qe>Ke+nn&&qe.down(qe))};function touchstart(qe,f){var Ke;const ze=qe.changedTouches[0];f.touchstartX=ze.clientX,f.touchstartY=ze.clientY,(Ke=f.start)==null||Ke.call(f,{originalEvent:qe,...f})}function touchend(qe,f){var Ke;const ze=qe.changedTouches[0];f.touchendX=ze.clientX,f.touchendY=ze.clientY,(Ke=f.end)==null||Ke.call(f,{originalEvent:qe,...f}),handleGesture(f)}function touchmove(qe,f){var Ke;const ze=qe.changedTouches[0];f.touchmoveX=ze.clientX,f.touchmoveY=ze.clientY,(Ke=f.move)==null||Ke.call(f,{originalEvent:qe,...f})}function createHandlers(){let qe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const f={touchstartX:0,touchstartY:0,touchendX:0,touchendY:0,touchmoveX:0,touchmoveY:0,offsetX:0,offsetY:0,left:qe.left,right:qe.right,up:qe.up,down:qe.down,start:qe.start,move:qe.move,end:qe.end};return{touchstart:ze=>touchstart(ze,f),touchend:ze=>touchend(ze,f),touchmove:ze=>touchmove(ze,f)}}function mounted(qe,f){var ln;const ze=f.value,Ke=ze!=null&&ze.parent?qe.parentElement:qe,Qe=(ze==null?void 0:ze.options)??{passive:!0},Pi=(ln=f.instance)==null?void 0:ln.$.uid;if(!Ke||!Pi)return;const nn=createHandlers(f.value);Ke._touchHandlers=Ke._touchHandlers??Object.create(null),Ke._touchHandlers[Pi]=nn,keys$1(nn).forEach(cn=>{Ke.addEventListener(cn,nn[cn],Qe)})}function unmounted(qe,f){var Pi,nn;const ze=(Pi=f.value)!=null&&Pi.parent?qe.parentElement:qe,Ke=(nn=f.instance)==null?void 0:nn.$.uid;if(!(ze!=null&&ze._touchHandlers)||!Ke)return;const Qe=ze._touchHandlers[Ke];keys$1(Qe).forEach(ln=>{ze.removeEventListener(ln,Qe[ln])}),delete ze._touchHandlers[Ke]}const Touch={mounted,unmounted},VWindowSymbol=Symbol.for("vuetify:v-window"),VWindowGroupSymbol=Symbol.for("vuetify:v-window-group"),makeVWindowProps=propsFactory({continuous:Boolean,nextIcon:{type:[Boolean,String,Function,Object],default:"$next"},prevIcon:{type:[Boolean,String,Function,Object],default:"$prev"},reverse:Boolean,showArrows:{type:[Boolean,String],validator:qe=>typeof qe=="boolean"||qe==="hover"},touch:{type:[Object,Boolean],default:void 0},direction:{type:String,default:"horizontal"},modelValue:null,disabled:Boolean,selectedClass:{type:String,default:"v-window-item--active"},mandatory:{type:[Boolean,String],default:"force"},...makeComponentProps(),...makeTagProps(),...makeThemeProps()},"VWindow"),VWindow=genericComponent()({name:"VWindow",directives:{Touch},props:makeVWindowProps(),emits:{"update:modelValue":qe=>!0},setup(qe,f){let{slots:ze}=f;const{themeClasses:Ke}=provideTheme(qe),{isRtl:Qe}=useRtl(),{t:Pi}=useLocale(),nn=useGroup(qe,VWindowGroupSymbol),ln=ref(),cn=computed(()=>Qe.value?!qe.reverse:qe.reverse),hn=shallowRef(!1),un=computed(()=>{const ra=qe.direction==="vertical"?"y":"x",fa=(cn.value?!hn.value:hn.value)?"-reverse":"";return`v-window-${ra}${fa}-transition`}),zn=shallowRef(0),Xn=ref(void 0),Un=computed(()=>nn.items.value.findIndex(ra=>nn.selected.value.includes(ra.id)));watch(Un,(ra,oa)=>{const fa=nn.items.value.length,ca=fa-1;fa<=2?hn.value=ra<oa:ra===ca&&oa===0?hn.value=!0:ra===0&&oa===ca?hn.value=!1:hn.value=ra<oa}),provide(VWindowSymbol,{transition:un,isReversed:hn,transitionCount:zn,transitionHeight:Xn,rootRef:ln});const qn=toRef(()=>qe.continuous||Un.value!==0),ys=toRef(()=>qe.continuous||Un.value!==nn.items.value.length-1);function vs(){qn.value&&nn.prev()}function ea(){ys.value&&nn.next()}const na=computed(()=>{const ra=[],oa={icon:Qe.value?qe.nextIcon:qe.prevIcon,class:`v-window__${cn.value?"right":"left"}`,onClick:nn.prev,"aria-label":Pi("$vuetify.carousel.prev")};ra.push(qn.value?ze.prev?ze.prev({props:oa}):createVNode(VBtn,oa,null):createVNode("div",null,null));const fa={icon:Qe.value?qe.prevIcon:qe.nextIcon,class:`v-window__${cn.value?"left":"right"}`,onClick:nn.next,"aria-label":Pi("$vuetify.carousel.next")};return ra.push(ys.value?ze.next?ze.next({props:fa}):createVNode(VBtn,fa,null):createVNode("div",null,null)),ra}),ta=computed(()=>qe.touch===!1?qe.touch:{...{left:()=>{cn.value?vs():ea()},right:()=>{cn.value?ea():vs()},start:oa=>{let{originalEvent:fa}=oa;fa.stopPropagation()}},...qe.touch===!0?{}:qe.touch});return useRender(()=>withDirectives(createVNode(qe.tag,{ref:ln,class:["v-window",{"v-window--show-arrows-on-hover":qe.showArrows==="hover"},Ke.value,qe.class],style:qe.style},{default:()=>{var ra,oa;return[createVNode("div",{class:"v-window__container",style:{height:Xn.value}},[(ra=ze.default)==null?void 0:ra.call(ze,{group:nn}),qe.showArrows!==!1&&createVNode("div",{class:"v-window__controls"},[na.value])]),(oa=ze.additional)==null?void 0:oa.call(ze,{group:nn})]}}),[[resolveDirective("touch"),ta.value]])),{group:nn}}}),makeVTabsWindowProps=propsFactory({...omit(makeVWindowProps(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VTabsWindow"),VTabsWindow=genericComponent()({name:"VTabsWindow",props:makeVTabsWindowProps(),emits:{"update:modelValue":qe=>!0},setup(qe,f){let{slots:ze}=f;const Ke=inject(VTabsSymbol,null),Qe=useProxiedModel(qe,"modelValue"),Pi=computed({get(){var nn;return Qe.value!=null||!Ke?Qe.value:(nn=Ke.items.value.find(ln=>Ke.selected.value.includes(ln.id)))==null?void 0:nn.value},set(nn){Qe.value=nn}});return useRender(()=>{const nn=VWindow.filterProps(qe);return createVNode(VWindow,mergeProps({_as:"VTabsWindow"},nn,{modelValue:Pi.value,"onUpdate:modelValue":ln=>Pi.value=ln,class:["v-tabs-window",qe.class],style:qe.style,mandatory:!1,touch:!1}),ze)}),{}}}),makeVWindowItemProps=propsFactory({reverseTransition:{type:[Boolean,String],default:void 0},transition:{type:[Boolean,String],default:void 0},...makeComponentProps(),...makeGroupItemProps(),...makeLazyProps()},"VWindowItem"),VWindowItem=genericComponent()({name:"VWindowItem",directives:{Touch},props:makeVWindowItemProps(),emits:{"group:selected":qe=>!0},setup(qe,f){let{slots:ze}=f;const Ke=inject(VWindowSymbol),Qe=useGroupItem(qe,VWindowGroupSymbol),{isBooted:Pi}=useSsrBoot();if(!Ke||!Qe)throw new Error("[Vuetify] VWindowItem must be used inside VWindow");const nn=shallowRef(!1),ln=computed(()=>Pi.value&&(Ke.isReversed.value?qe.reverseTransition!==!1:qe.transition!==!1));function cn(){!nn.value||!Ke||(nn.value=!1,Ke.transitionCount.value>0&&(Ke.transitionCount.value-=1,Ke.transitionCount.value===0&&(Ke.transitionHeight.value=void 0)))}function hn(){var qn;nn.value||!Ke||(nn.value=!0,Ke.transitionCount.value===0&&(Ke.transitionHeight.value=convertToUnit((qn=Ke.rootRef.value)==null?void 0:qn.clientHeight)),Ke.transitionCount.value+=1)}function un(){cn()}function zn(qn){nn.value&&nextTick(()=>{!ln.value||!nn.value||!Ke||(Ke.transitionHeight.value=convertToUnit(qn.clientHeight))})}const Xn=computed(()=>{const qn=Ke.isReversed.value?qe.reverseTransition:qe.transition;return ln.value?{name:typeof qn!="string"?Ke.transition.value:qn,onBeforeEnter:hn,onAfterEnter:cn,onEnterCancelled:un,onBeforeLeave:hn,onAfterLeave:cn,onLeaveCancelled:un,onEnter:zn}:!1}),{hasContent:Un}=useLazy(qe,Qe.isSelected);return useRender(()=>createVNode(MaybeTransition,{transition:Xn.value,disabled:!Pi.value},{default:()=>{var qn;return[withDirectives(createVNode("div",{class:["v-window-item",Qe.selectedClass.value,qe.class],style:qe.style},[Un.value&&((qn=ze.default)==null?void 0:qn.call(ze))]),[[vShow,Qe.isSelected.value]])]}})),{groupItem:Qe}}}),makeVTabsWindowItemProps=propsFactory({...makeVWindowItemProps()},"VTabsWindowItem"),VTabsWindowItem=genericComponent()({name:"VTabsWindowItem",props:makeVTabsWindowItemProps(),setup(qe,f){let{slots:ze}=f;return useRender(()=>{const Ke=VWindowItem.filterProps(qe);return createVNode(VWindowItem,mergeProps({_as:"VTabsWindowItem"},Ke,{class:["v-tabs-window-item",qe.class],style:qe.style}),ze)}),{}}});function parseItems(qe){return qe?qe.map(f=>isObject$1(f)?f:{text:f,value:f}):[]}const makeVTabsProps=propsFactory({alignTabs:{type:String,default:"start"},color:String,fixedTabs:Boolean,items:{type:Array,default:()=>[]},stacked:Boolean,bgColor:String,grow:Boolean,height:{type:[Number,String],default:void 0},hideSlider:Boolean,sliderColor:String,...makeVSlideGroupProps({mandatory:"force",selectedClass:"v-tab-item--selected"}),...makeDensityProps(),...makeTagProps()},"VTabs"),VTabs=genericComponent()({name:"VTabs",props:makeVTabsProps(),emits:{"update:modelValue":qe=>!0},setup(qe,f){let{attrs:ze,slots:Ke}=f;const Qe=useProxiedModel(qe,"modelValue"),Pi=computed(()=>parseItems(qe.items)),{densityClasses:nn}=useDensity(qe),{backgroundColorClasses:ln,backgroundColorStyles:cn}=useBackgroundColor(()=>qe.bgColor),{scopeId:hn}=useScopeId();return provideDefaults({VTab:{color:toRef(()=>qe.color),direction:toRef(()=>qe.direction),stacked:toRef(()=>qe.stacked),fixed:toRef(()=>qe.fixedTabs),sliderColor:toRef(()=>qe.sliderColor),hideSlider:toRef(()=>qe.hideSlider)}}),useRender(()=>{const un=VSlideGroup.filterProps(qe),zn=!!(Ke.window||qe.items.length>0);return createVNode(Fragment,null,[createVNode(VSlideGroup,mergeProps(un,{modelValue:Qe.value,"onUpdate:modelValue":Xn=>Qe.value=Xn,class:["v-tabs",`v-tabs--${qe.direction}`,`v-tabs--align-tabs-${qe.alignTabs}`,{"v-tabs--fixed-tabs":qe.fixedTabs,"v-tabs--grow":qe.grow,"v-tabs--stacked":qe.stacked},nn.value,ln.value,qe.class],style:[{"--v-tabs-height":convertToUnit(qe.height)},cn.value,qe.style],role:"tablist",symbol:VTabsSymbol},hn,ze),{default:()=>{var Xn;return[((Xn=Ke.default)==null?void 0:Xn.call(Ke))??Pi.value.map(Un=>{var qn;return((qn=Ke.tab)==null?void 0:qn.call(Ke,{item:Un}))??createVNode(VTab,mergeProps(Un,{key:Un.text,value:Un.value}),{default:Ke[`tab.${Un.value}`]?()=>{var ys;return(ys=Ke[`tab.${Un.value}`])==null?void 0:ys.call(Ke,{item:Un})}:void 0})})]}}),zn&&createVNode(VTabsWindow,mergeProps({modelValue:Qe.value,"onUpdate:modelValue":Xn=>Qe.value=Xn,key:"tabs-window"},hn),{default:()=>{var Xn;return[Pi.value.map(Un=>{var qn;return((qn=Ke.item)==null?void 0:qn.call(Ke,{item:Un}))??createVNode(VTabsWindowItem,{value:Un.value},{default:()=>{var ys;return(ys=Ke[`item.${Un.value}`])==null?void 0:ys.call(Ke,{item:Un})}})}),(Xn=Ke.window)==null?void 0:Xn.call(Ke)]}})])}),{}}}),_hoisted_1={class:"mb-5 d-flex justify-space-between align-center"},_sfc_main=defineComponent({__name:"index",setup(qe){const f=useTheme(),ze=/(?<trialName>.+)_(?<date>\d{4}-\d{2}-\d{2})_(?<time>\d{2}-\d{2}-\d{2})_(?<germplasm>.+)_(?<row>\d+)_(?<column>\d+)_.+/,Ke=coreStore(),Qe=ref(0),Pi=ref(),nn=ref(),ln=ref(),cn=ref([{id:getId(),title:"Image",displayTitle:"Image"}]),hn=computed(()=>{const oa=Math.max(...cn.value.map(fa=>fa.ratio||0));return oa>0?createColorGradient(f.current.value.colors.primary,f.current.value.colors.secondary,Math.ceil(oa*100)):[f.current.value.colors.primary]}),un=computed(()=>zn.value.length>0),zn=computed(()=>cn.value?cn.value.filter(oa=>oa.gridscoreConfig!==void 0&&oa.gridscoreConfig!==null):[]);watch(un,async oa=>{Ke.setHasGridScoreImage(oa)});function Xn(oa){cn.value[oa].fileToLoad=void 0}function Un(oa){Pi.value=oa,nextTick(()=>nn.value.show())}function qn(oa,fa){var ua;const ca=truncate(fa,20,TruncationPosition.MIDDLE);cn.value[oa].displayTitle=ca,cn.value[oa].title=fa;const la=(ua=fa.match(ze))==null?void 0:ua.groups;la&&(cn.value[oa].gridscoreConfig={germplasm:la.germplasm,row:+la.row,column:+la.column,timestamp:la.date+" "+la.time.replace(/-/g,":")})}function ys(oa,fa){cn.value[oa].ratio=fa}function vs(){cn.value.push({id:getId(),title:"Image",displayTitle:"Image"}),Qe.value=cn.value.length-1}function ea(oa){oa.forEach(fa=>{cn.value.push({id:getId(),title:"Image",displayTitle:"Image",fileToLoad:fa}),Qe.value=cn.value.length-1})}function na(oa){cn.value.splice(oa,1),Qe.value=Math.max(0,Math.min(cn.value.length-1,oa-1))}function ta(){const oa=utils$2.json_to_sheet(cn.value),fa=utils$2.book_new();utils$2.book_append_sheet(fa,oa,"Vegetation indices"),writeFileSync(fa,`${new Date().toISOString().split("T")[0]}-spriggles.xlsx`)}function ra(){ln.value.show()}return onMounted(()=>{emitter.on("add-tab",vs),emitter.on("add-images",ea),emitter.on("download",ta),emitter.on("export-gridscore",ra)}),onBeforeUnmount(()=>{emitter.off("add-tab",vs),emitter.off("add-images",ea),emitter.off("download",ta),emitter.off("export-gridscore",ra)}),(oa,fa)=>(openBlock(),createElementBlock(Fragment,null,[(openBlock(),createBlock(Teleport,{to:"#appbar .v-toolbar__extension"},[createVNode(VTabs,{modelValue:unref(Qe),"onUpdate:modelValue":fa[0]||(fa[0]=ca=>isRef(Qe)?Qe.value=ca:null),"center-active":""},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(cn),(ca,la)=>(openBlock(),createBlock(VTab,{key:`tab-${la}`,class:"d-flex flex-column image-tab",title:ca.title},{append:withCtx(()=>[createVNode(VProgressLinear,{color:unref(hn)[Math.ceil((ca.ratio||0)*100)-1],"model-value":(ca.ratio||0)*100},null,8,["color","model-value"])]),default:withCtx(()=>[createTextVNode(toDisplayString(ca.displayTitle)+" ",1)]),_:2},1032,["title"]))),128))]),_:1},8,["modelValue"])])),createVNode(VTabsWindow,{modelValue:unref(Qe),"onUpdate:modelValue":fa[1]||(fa[1]=ca=>isRef(Qe)?Qe.value=ca:null)},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(cn),(ca,la)=>(openBlock(),createBlock(VTabsWindowItem,{key:`tab-content-${ca.id}`,value:ca},{default:withCtx(()=>{var ua,ga;return[createBaseVNode("div",_hoisted_1,[createVNode(VBtn,{"prepend-icon":"mdi-delete",text:"Delete tab",onClick:da=>na(la)},null,8,["onClick"]),ca.gridscoreConfig?(openBlock(),createBlock(VChip,{key:0,color:"info",variant:"tonal",onClick:da=>Un(ca)},{prepend:withCtx(()=>[createVNode(VIcon,null,{default:withCtx(()=>fa[2]||(fa[2]=[createBaseVNode("svg",{class:"b-icon bi me-2",fill:"currentColor",height:"20",viewBox:"0 0 24 24",width:"20",xmlns:"http://www.w3.org/2000/svg"},[createBaseVNode("path",{d:"M13.548.048a6.254 6.254 0 0 0-2.42.969c-.35.24-1.017.855-1.217 1.122l-.094.13-.452-.22c-.87-.428-1.577-.589-2.586-.585-.742 0-1.189.071-1.805.275a5.864 5.864 0 0 0-3.39 2.998c-.876 1.856-.727 3.948.408 5.718.05.082.039.102-.267.412a5.699 5.699 0 0 0-1.652 3.638 5.71 5.71 0 0 0 .584 2.994c.793 1.59 2.17 2.664 3.944 3.076.428.099.542.11 1.217.11.722 0 1.047-.039 1.613-.196.07-.02.106.028.259.33a5.787 5.787 0 0 0 3.987 3.068c.49.106 1.397.146 1.871.083a5.826 5.826 0 0 0 3.952-2.296c.624-.836 1.052-1.974 1.119-2.978.015-.2.043-.353.066-.361.024-.008.22-.04.44-.071 2.048-.318 3.799-1.801 4.501-3.818 1.005-2.88-.447-6.087-3.277-7.24l-.29-.118.059-.263c.043-.189.059-.487.059-1.048 0-.663-.012-.844-.083-1.165-.4-1.786-1.522-3.242-3.092-4.011a5.447 5.447 0 0 0-1.354-.483c-.534-.121-1.558-.157-2.1-.07zm-1.667 10.917c.227.11.459.216.522.228.117.03.121.043.062.337a6.288 6.288 0 0 0-.066.565l-.028.353-.314.043a5.936 5.936 0 0 0-.56.11 2.784 2.784 0 0 1-.287.063c-.02 0-.114-.153-.208-.345a5.896 5.896 0 0 0-.295-.514l-.117-.173.42-.443c.231-.244.427-.44.439-.436.012.004.204.098.432.212z"})],-1)])),_:1})]),default:withCtx(()=>[fa[3]||(fa[3]=createTextVNode(" GridScore image "))]),_:2},1032,["onClick"])):createCommentVNode("",!0)]),createVNode(_sfc_main$3,{"file-to-load":ca.fileToLoad,"image-id":ca.id,"neighbor-ids":[(ua=unref(cn)[la-1])==null?void 0:ua.id,(ga=unref(cn)[la+1])==null?void 0:ga.id],onFileLoaded:da=>Xn(la),onRatioChanged:da=>ys(la,da),onTitleChanged:da=>qn(la,da)},null,8,["file-to-load","image-id","neighbor-ids","onFileLoaded","onRatioChanged","onTitleChanged"])]}),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),unref(Pi)&&unref(Pi).gridscoreConfig?(openBlock(),createBlock(_sfc_main$2,{key:0,ref_key:"gridscoreInfoModal",ref:nn,title:"GridScore configuration"},{default:withCtx(()=>[createVNode(VList,null,{default:withCtx(()=>[createVNode(VListItem,{"prepend-icon":"mdi-flower",title:unref(Pi).gridscoreConfig.germplasm},null,8,["title"]),createVNode(VListItem,{"prepend-icon":"mdi-format-list-bulleted",title:unref(Pi).gridscoreConfig.rep},null,8,["title"]),createVNode(VListItem,{"prepend-icon":"mdi-table-column",title:unref(Pi).gridscoreConfig.row},null,8,["title"]),createVNode(VListItem,{title:unref(Pi).gridscoreConfig.column},{prepend:withCtx(()=>[createVNode(VIcon,{class:"rotate-90",icon:"mdi-table-column"})]),_:1},8,["title"]),createVNode(VListItem,{"prepend-icon":"mdi-flower",title:unref(Pi).gridscoreConfig.timestamp},null,8,["title"])]),_:1})]),_:1},512)):createCommentVNode("",!0),unref(zn)?(openBlock(),createBlock(_sfc_main$1,{key:1,ref_key:"gridscoreExportModal",ref:ln,images:unref(zn)},null,8,["images"])):createCommentVNode("",!0)],64))}});export{_sfc_main as default};
